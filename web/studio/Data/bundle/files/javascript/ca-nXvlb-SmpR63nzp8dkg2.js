var OAuthCallback=function(){},OAuthError=function(n){ASC.Files.UI.displayInfoPanel(n,!0)},OAuthPopup=function(n,t,i){var u,r,f;if(ASC.Desktop)return u=ASC.Files.Anchor.modulePath+"#setting=thirdparty&"+(t?"providerKey="+encodeURIComponent(t):i?"providerId="+encodeURIComponent(i):""),location.href=n+"?redirect="+encodeURIComponent(u),null;try{f="height=600,width=1020,resizable=0,status=0,toolbar=0,menubar=0,location=1";r=window.open(n,"Authorization",f)}catch(e){r=window.open(n,"Authorization")}return r};
typeof jq=="undefined"&&(jq=jQuery.noConflict());typeof ASC=="undefined"&&(ASC={});typeof ASC.Files=="undefined"&&(ASC.Files=function(){return{}}());typeof ASC.Files.Constants=="undefined"&&(ASC.Files.Constants={});ASC.Files.Constants.REQUEST_STATUS_DELAY=2e3;ASC.Files.Constants.REQUEST_CONVERT_DELAY=2e3;ASC.Files.Constants.COUNT_ON_PAGE=30;ASC.Files.Constants.entryIdRegExpStr="(\\d+|[a-z]+-\\d+(-.+)*)";ASC.Files.Constants.storageKeyRecent="TeamLabRecentDocuments";ASC.Files.Constants.storageKeyCompactView="TeamLabDocumentsCompactView";ASC.Files.Constants.storageKeyUploaderCompactView="TeamLabDocumentsUploaderCompactView";ASC.Files.Common=function(){var t=function(n){if(typeof n=="undefined"||n===null||n===0)return!1;var t=new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr);return t.test(n)},i=function(n){return jq.browser.safari||jq.browser.mozilla?encodeURI(n):n},r=function(t,i){var r="",f,u;if(typeof t=="object")if(t===null)typeof i!="undefined"&&(r+="<"+i+"><\/"+i+">");else if(t.constructor.toString().indexOf("Array")!==-1)for(u=0,f=t.length;u<f;u++)r+=typeof i!="undefined"?"<"+i+">"+arguments.callee(t[u])+"<\/"+i+">":arguments.callee(t[u]);else{for(u in t)r+=arguments.callee(t[u],u);typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")}else typeof t=="string"?(r=n(t),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")):typeof t!="undefined"&&typeof t.toString!="undefined"&&(r=n(t.toString()),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">"));return r},n=function(n){return n.replace(/&/gim,"&amp;").replace(/</gim,"&lt;").replace(/>/gim,"&gt;")},u=function(){var n=jq.url.attr("protocol");return n+="://",n+=jq.url.attr("host"),jq.url.attr("port")!=null&&(n+=":",n+=jq.url.attr("port")),n},f=function(n){n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation()},e=new RegExp('[\t*+:"<>?|\\\\/]',"gim"),o=function(n){return(n||"").trim().replace(ASC.Files.Common.characterRegExp,"_")};return{getSitePath:u,cancelBubble:f,keyCode:{enter:13,ctrl:17,esc:27,spaceBar:32,pageUP:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insertKey:45,deleteKey:46,A:65,C:67,F:70,N:78,F2:113},characterString:'*+:"<>?|/',characterRegExp:e,replaceSpecCharacter:o,isCorrectId:t,getCorrectHash:i,jsonToXml:r,storeOriginal:!1}}();
window.ASC.Files.Filter=function(){var t=!1,f=function(){if(!t){var n={anykey:!0,anykeytimeout:800,colcount:3,filters:i(),hintDefaultDisable:!1,maxlength:ASC.Files.Constants.MAX_NAME_LENGTH,sorters:e()};ASC.Files.Filter.advansedFilter=jq(".files-filter div").advansedFilter(n).on("setfilter",ASC.Files.Filter.setFilter).on("resetfilter",ASC.Files.Filter.setFilter)}},i=function(){var u=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES,t=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT,i=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES,r=[{id:"selected-type-folder",filtertitle:ASC.Files.FilesJSResource.ButtonFilterType,group:ASC.Files.FilesJSResource.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.FoldersOnly),type:"combobox",title:ASC.Files.FilesJSResource.ButtonFilterFolder,visible:!u&&!t&&!i},{id:"selected-type-text",filtertitle:ASC.Files.FilesJSResource.ButtonFilterType,group:ASC.Files.FilesJSResource.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.DocumentsOnly),type:"combobox",title:ASC.Files.FilesJSResource.ButtonFilterDocument},{id:"selected-type-presentation",filtertitle:ASC.Files.FilesJSResource.ButtonFilterType,group:ASC.Files.FilesJSResource.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.PresentationsOnly),type:"combobox",title:ASC.Files.FilesJSResource.ButtonFilterPresentation},{id:"selected-type-spreadsheet",filtertitle:ASC.Files.FilesJSResource.ButtonFilterType,group:ASC.Files.FilesJSResource.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.SpreadsheetsOnly),type:"combobox",title:ASC.Files.FilesJSResource.ButtonFilterSpreadsheet},{id:"selected-type-image",filtertitle:ASC.Files.FilesJSResource.ButtonFilterType,group:ASC.Files.FilesJSResource.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.ImagesOnly),type:"combobox",title:ASC.Files.FilesJSResource.ButtonFilterImage,visible:!t&&!i},{id:"selected-type-media",filtertitle:ASC.Files.FilesJSResource.ButtonFilterType,group:ASC.Files.FilesJSResource.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.MediaOnly),type:"combobox",title:ASC.Files.FilesJSResource.ButtonFilterMedia,visible:!t&&!i},{id:"selected-type-archive",filtertitle:ASC.Files.FilesJSResource.ButtonFilterType,group:ASC.Files.FilesJSResource.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.ArchiveOnly),type:"combobox",title:ASC.Files.FilesJSResource.ButtonFilterArchive,visible:!t&&!i},{id:"selected-type-file",filtertitle:ASC.Files.FilesJSResource.ButtonFilterType,group:ASC.Files.FilesJSResource.ButtonFilterType,groupby:"type",options:n(ASC.Files.Constants.FilterType.FilesOnly),type:"combobox",title:ASC.Files.FilesJSResource.ButtonFilterFiles,visible:!u&&!t&&!i}],f;return ASC.Resources.Master.Personal!=!0&&(r.push({id:"selected-person",group:ASC.Files.FilesJSResource.ButtonFilterAuthor,groupby:"owner",title:ASC.Files.FilesJSResource.Users,type:"person"}),r.push({id:"selected-group",group:ASC.Files.FilesJSResource.ButtonFilterAuthor,groupby:"owner",title:ASC.Files.FilesJSResource.Departments,type:"group"})),f=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TRASH,jq(".files-filter").data("content")&&r.push({id:"with-content",group:ASC.Files.FilesJSResource.ButtonFilterOther,title:ASC.Files.FilesJSResource.ButtonFilterInContent,type:"flag",visible:!f}),r.push({id:"current-folder",group:ASC.Files.FilesJSResource.ButtonFilterOther,title:ASC.Files.FilesJSResource.ButtonFilterCurrentFolderOnly,type:"flag",visible:!f&&!u&&!t&&!i&&(!ASC.Files.ThirdParty||!ASC.Files.ThirdParty.isThirdParty())}),r},n=function(n){var u=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES,i=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT,r=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES,t=[];return u||i||r||(t=[{def:n==ASC.Files.Constants.FilterType.FoldersOnly,title:ASC.Files.FilesJSResource.ButtonFilterFolder,value:ASC.Files.Constants.FilterType.FoldersOnly}]),t.push({def:n==ASC.Files.Constants.FilterType.DocumentsOnly,title:ASC.Files.FilesJSResource.ButtonFilterDocument,value:ASC.Files.Constants.FilterType.DocumentsOnly},{def:n==ASC.Files.Constants.FilterType.PresentationsOnly,title:ASC.Files.FilesJSResource.ButtonFilterPresentation,value:ASC.Files.Constants.FilterType.PresentationsOnly},{def:n==ASC.Files.Constants.FilterType.SpreadsheetsOnly,title:ASC.Files.FilesJSResource.ButtonFilterSpreadsheet,value:ASC.Files.Constants.FilterType.SpreadsheetsOnly}),i||r||t.push({def:n==ASC.Files.Constants.FilterType.ImagesOnly,title:ASC.Files.FilesJSResource.ButtonFilterImage,value:ASC.Files.Constants.FilterType.ImagesOnly},{def:n==ASC.Files.Constants.FilterType.MediaOnly,title:ASC.Files.FilesJSResource.ButtonFilterMedia,value:ASC.Files.Constants.FilterType.MediaOnly},{def:n==ASC.Files.Constants.FilterType.ArchiveOnly,title:ASC.Files.FilesJSResource.ButtonFilterArchive,value:ASC.Files.Constants.FilterType.ArchiveOnly}),u||i||r||t.push({def:n==ASC.Files.Constants.FilterType.FilesOnly,title:ASC.Files.FilesJSResource.ButtonFilterFiles,value:ASC.Files.Constants.FilterType.FilesOnly}),t},e=function(){var n=r(),t=[{def:n.property=="DateAndTime",dsc:n.property=="DateAndTime"?!n.is_asc:!1,id:"DateAndTime",title:ASC.Files.FilesJSResource.ButtonSortModifiedNew},{def:n.property=="DateAndTimeCreation",dsc:n.property=="DateAndTimeCreation"?!n.is_asc:!1,id:"DateAndTimeCreation",title:ASC.Files.FilesJSResource.ButtonSortCreated},{def:n.property=="AZ",dsc:n.property=="AZ"?!n.is_asc:!0,id:"AZ",title:ASC.Files.FilesJSResource.ButtonSortName},{def:n.property=="Type",dsc:n.property=="Type"?!n.is_asc:!0,id:"Type",title:ASC.Files.FilesJSResource.ButtonSortType},{def:n.property=="Size",dsc:n.property=="Size"?!n.is_asc:!1,id:"Size",title:ASC.Files.FilesJSResource.ButtonSortSize}];return ASC.Resources.Master.Personal!=!0&&t.push({def:n.property=="Author",dsc:n.property=="Author"?!n.is_asc:!1,id:"Author",title:ASC.Files.FilesJSResource.ButtonSortAuthor}),t},o=function(){ASC.Files.Filter.advansedFilter.advansedFilter({filters:i()});var n=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT;ASC.Files.Filter.advansedFilter.advansedFilter("sort",!n)},s=function(){if(!t){t=!0;return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!1)},h=function(n){n=n===!0;var i=!1;n&&t&&(i=!0,t=!1);ASC.Files.Filter.advansedFilter.advansedFilter(null);n&&i&&(t=!0)},c=function(){ASC.Files.Filter.advansedFilter.advansedFilter({filters:[{id:"current-folder",params:{}}]})},l=function(){ASC.Files.Filter.advansedFilter.advansedFilter("resize")},a=function(){return{sorter:r(),text:"",filter:ASC.Files.Constants.FilterType.None,subject:"",isSet:!1,withSubfolders:!1,searchInContent:!1}},v=function(){var n=ASC.Files.Filter.getDefaultFilterSettings(),t,i;return ASC.Files.Filter.advansedFilter==null?n:(t=ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES,i=ASC.Files.Filter.advansedFilter.advansedFilter(),jq(i).each(function(i,r){switch(r.id){case"sorter":var f=u(r.params.id,!r.params.dsc);n.sorter=f;break;case"text":n.text=r.params.value;n.isSet=!0;break;case"selected-person":n.subject=r.params.id;n.isSet=!0;break;case"selected-group":n.subjectGroup=!0;n.subject=r.params.id;n.isSet=!0;break;case"selected-type-folder":case"selected-type-text":case"selected-type-presentation":case"selected-type-spreadsheet":case"selected-type-image":case"selected-type-media":case"selected-type-archive":case"selected-type-file":n.filter=parseInt(r.params.value||ASC.Files.Constants.FilterType.None);n.isSet=n.filter!=ASC.Files.Constants.FilterType.None;break;case"current-folder":t=!0;break;case"with-content":n.searchInContent=!0}}),!t&&n.isSet&&(n.withSubfolders=!0),ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TRASH&&(n.searchInContent=!1),n)},r=function(){return u(jq(".files-filter").data("sort"),jq(".files-filter").data("asc"))},u=function(n,t){return n=typeof n!="undefined"&&n!=""?n:"DateAndTime",t=t===!0,{is_asc:t,property:n}};return{init:f,advansedFilter:null,disableFilter:o,getDefaultFilterSettings:a,getFilterSettings:v,setFilter:s,clearFilter:h,setWithoutSubfolders:c,resize:l}}(),function(n){n(function(){ASC.Files.Filter.init();jq(".files-clear-filter").on("click",function(){return ASC.Files.Filter.clearFilter(),!1});jq("#filesWithoutSubfolders").on("click",function(){return ASC.Files.Filter.setWithoutSubfolders(),!1})})}(jQuery);
window.ASC.Files.TemplateManager=function(){var n=null,u=function(){return n||jq.ajax({url:ASC.Files.Constants.URL_TEMPLATES_HANDLER,"async":!1,success:function(t){n=t}}),n},f=function(n){var t=u();return r(n,t)},e=function(n){var t,f;return typeof n=="undefined"?"":(t=n,typeof n=="string"&&(t=i(n)),f=u(),r(t,f))},i,r;try{var o=new ActiveXObject("Microsoft.XMLDOM"),s=new ActiveXObject("Microsoft.XMLHTTP"),t=o&&s}catch(h){t=!1}return i=function(){return t?function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new ActiveXObject("Microsoft.XMLDOM");if(t.async="false",t.loadXML(n),t.parseError.errorCode!=0)throw"Can't create xml document";return t}:function(n){if(typeof n!="string"||n.length===0)return undefined;var t=new DOMParser;try{t=t.parseFromString(n,"text/xml")}catch(i){throw"Can't create xml document : "+i;}return t}}(),r=function(){function n(n,t){var u=new ActiveXObject("Microsoft.XMLDOM"),f=new ActiveXObject("MSXML2.FreeThreadedDOMDocument"),r,i;return u.load(n),f.load(t),r=new ActiveXObject("Msxml2.XSLTemplate"),r.stylesheet=f,i=r.createProcessor(),i.input=u,i.transform(),i.output}return t?function(t,i){var r="";if(typeof t=="undefined"||t==null||typeof i=="undefined"||i==null)return r;try{i.resolveExternals=!0}catch(u){}try{try{r=t.transformNode(i)}catch(f){r=n(t,i)}}catch(u){throw"Can't translate xml : "+u;}return r}:function(n,t){var i="",u,r;if(typeof n=="undefined"||typeof t=="undefined")return i;try{r=new XSLTProcessor;r.importStylesheet(t);u=r.transformToFragment(n,document)}catch(f){throw"Can't translate xml : "+f;}try{i=jq("<div>").append(u).html()}catch(f){throw"Can't serialized xml : "+f;}return i}}(),{createXML:i,translate:f,translateFromString:e}}();
window.ASC.Files.ServiceManager=function(){var f=!1,e,a="/",v=6e4,t={},i=!0,r=[],y=function(n){if(typeof n!="string"||n.length===0)throw"Incorrect service path";e=n[n.length-1]==="/"?n:n+"/";f=!0},u=[],p=5e3,w=function(){return[ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.ServiceManager.events.GetNews,ASC.Files.ServiceManager.events.GetSiblingsImage,ASC.Files.ServiceManager.events.GetThirdParty,ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.ServiceManager.events.GetTreePath,]},b=function(n,t){for(var r,f,i=0;i<u.length;i++)if(r=u[i],r.eventType==n&&r.params==JSON.stringify(t)){if(f=new Date-r.timeStamp,0<f&&f<p)return c.apply(this,r.data),!0;u.splice(i,1);i--}return!1},o=function(n){return(typeof n!="undefined"?n+"-":"")+Math.floor(Math.random()*1e6)},k=function(n,t){for(var r=0,i=o();n.hasOwnProperty(i)&&r++<1e3;)i=o(t);return i},s=function(n,i,r){var u,f;if(n=n.toLowerCase(),i=i||window,r=r||[],t.hasOwnProperty(n)){u=t[n];for(f in u)u.hasOwnProperty(f)&&(u[f].handler.apply(i,r),u[f].type&1&&delete u[f])}},d=function(n,i,r){var e,u,f;return typeof n!="string"||typeof i!="function"?undefined:(n=n.toLowerCase(),typeof r!="object"&&(r={}),e=r.hasOwnProperty("once")?r.once:!1,u=0,u|=+e*1,t.hasOwnProperty(n)||(t[n]={}),f=k(t[n]),t[n][f]={handler:i,type:u},f)},g=function(n,i){return typeof n!="string"||typeof i=="undefined"?!1:(t(n)&&t[n].hasOwnProperty(i)&&delete userEventHandlers[n][i],!0)},nt=function(){var t,n,r,i;if(f||y(ASC.Files.Constants.URL_WCFSERVICE),t=e,arguments.length===0)return t;for(n=0,r=arguments.length-1;n<r;n++)t+=arguments[n]+a;return i=t+arguments[n],i+((i.search(/\?/)>0?"&":"?")+"_="+(new Date).getTime())},h=function(n){return!n||typeof n!="object"?"":n.text||n.textContent||function(n){var t="",u=n.childNodes,i,f,r;if(!u)return t;for(i=0,f=u.length;i<f;i++){r=u.item(i);switch(r.nodeType){case 1:case 5:t+=arguments.callee(r);break;case 3:case 2:case 4:t+=r.nodeValue}}return t}(n)},c=function(n,t,u,f,e){var y,c,w,k;if(i=!0,typeof LoadingBanner!="undefined"&&typeof LoadingBanner.hideLoading!="undefined"&&LoadingBanner.hideLoading(),e==="error"){var o="",b="",a=null,p,v=null;if(!f.responseXML&&f.responseText.indexOf("<error")==0)try{f.responseXML=ASC.Files.TemplateManager.createXML(f.responseText)}catch(d){}if(f.responseXML){if(a=f.responseXML.getElementsByTagName("message")[0],p=f.responseXML.getElementsByTagName("inner")[0],p&&(v=p.getElementsByTagName("message")[0]),o==="")try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){y=document.createElement("div");o=jq("#content",jq(y).html(f.responseText)).text()}}else if(f.responseText&&(y=document.createElement("div"),o=jq("#content",jq(y).html(f.responseText)).text(),o===""))try{o=eval("["+f.responseText+"]")[0].Detail}catch(d){}a&&typeof a=="object"&&(o=h(a));v&&typeof v=="object"&&(b=h(v));s(n,window,[undefined,t,b||o]);return}if(w="<!DOCTYPE",f.responseText&&f.responseText.indexOf(w)!=0)try{switch(u){case"xml":c=ASC.Files.TemplateManager.createXML(f.responseText);break;case"json":c=JSON.parse(f.responseText);break;default:f.responseXML.xml.indexOf(w)!=0&&(c=ASC.Files.TemplateManager.createXML(f.responseXML.xml)||JSON.parse(f.responseText))}}catch(d){c=f.responseText}s(n,window,[c,t]);r.length!=0&&i==!0&&(k=r.shift(),i=!1,l(k))},tt=function(n,t,i){return function(){for(var r=[n,t,i],f=0,e=arguments.length;f<e;f++)r.push(arguments[f]);jq.inArray(n,w())>=0&&u.push({eventType:n,params:JSON.stringify(t),timeStamp:new Date,data:r});c.apply(this,r)}},n=function(n,t,u,f){var e,s,c;if(typeof n!="undefined"&&typeof t!="undefined"&&typeof u=="string"&&(typeof f=="undefined"&&(f={}),!b(u,f))){(typeof LoadingBanner=="undefined"||typeof LoadingBanner.displayLoading=="undefined")&&(f.showLoading=!1);var a={},h=[],o=f.ajaxcontentType||"application/xml";typeof f!="object"&&(f={});switch((n||"").toLowerCase()){case"delete":case"get":for(e=4,s=arguments.length;e<s;e++)h.push(arguments[e]);break;case"post":for(a=o=="text/xml"||o=="application/xml"?ASC.Files.Common.jsonToXml(arguments[4]):o=="application/json"?JSON.stringify(arguments[4]):arguments[4],e=5,s=arguments.length;e<s;e++)h.push(arguments[e]);break;default:return}c={"async":f.ajaxsync!=!0,data:a,type:n,dataType:t,contentType:o,cache:!0,url:nt.apply(this,h),timeout:v,beforeSend:function(){if(f.showLoading)ASC.Files.Folders&&ASC.Files.Folders.isFirstLoad||(LoadingBanner.displayLoading(),jq(".advansed-filter").advansedFilter("resize"));else return null},complete:tt(u,f,t)};r.length==0&&i==!0?(i=!1,l(c)):r.push(c)}},l=function(n){jq.ajax({"async":n.async,data:n.data,type:n.type,dataType:n.dataType,contentType:n.contentType,cache:n.cache,url:n.url,timeout:n.timeout,beforeSend:n.beforeSend,complete:n.complete})},it=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-create?parentId="+encodeURIComponent(i.parentFolderID)+"&title="+encodeURIComponent(i.title))},rt=function(t,i){i.ajaxsync=!0;n("get","xml",t,i,"folders-files-createfile?parentId="+encodeURIComponent(i.folderID||"")+"&title="+encodeURIComponent(i.fileTitle)+"&templateId="+encodeURIComponent(i.templateId||""))},ut=function(t,i,r){i.showLoading=i.append!=!0;n("post","xml",t,i,r,"folders?parentId="+encodeURIComponent(i.folderId)+"&from="+i.from+"&count="+i.count+"&filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&withSubfolders="+!!i.withSubfolders+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search))},ft=function(t,i){n("get","xml",t,i,"folders-subfolders?parentId="+encodeURIComponent(i.folderId))},et=function(t,i){n("get","json",t,i,"folders-path?folderId="+encodeURIComponent(i.folderId))},ot=function(t,i){n("get","json",t,i,"folders-folder?folderId="+encodeURIComponent(i.folderId))},st=function(t,i,r){n("post","json",t,i,r,"folders-entries?filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&search="+encodeURIComponent(i.search))},ht=function(t,i){i.ajaxsync=!0;n("get",i.dataType||"xml",t,i,"folders-files-getversion?fileId="+encodeURIComponent(i.fileId)+"&version="+(i.version||-1))},ct=function(t,i){n("get","xml",t,i,"folders-files-history?fileId="+encodeURIComponent(i.fileId))},lt=function(t,i){n("get","json",t,i,"folders-files-updateToVersion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version)},at=function(t,i){n("get","json",t,i,"folders-files-updateComment?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&comment="+encodeURIComponent(i.comment))},vt=function(t,i){n("get","json",t,i,"folders-files-completeversion?fileId="+encodeURIComponent(i.fileId)+"&version="+i.version+"&continueVersion="+i.continueVersion)},yt=function(t,i,r){n("post","json",t,i,r,"folders-files-siblings?fileId="+encodeURIComponent(i.fileId)+"&parentId="+encodeURIComponent(i.folderId||"")+"&filter="+i.filter+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&withSubfolders="+!!i.withSubfolders+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search))},pt=function(t,i){n("get","json",t,i,"presigned?fileId="+encodeURIComponent(i.fileId))},wt=function(t,i){n("get","xml",t,i,"folders-rename?folderId="+encodeURIComponent(i.folderId)+"&title="+encodeURIComponent(i.newname))},bt=function(t,i){n("get","xml",t,i,"folders-files-rename?fileId="+encodeURIComponent(i.fileId)+"&title="+encodeURIComponent(i.newname))},kt=function(t,i,r){n("post","json",t,i,r,"folders-files-moveOrCopyFilesCheck?destFolderId="+encodeURIComponent(i.folderToId))},dt=function(t,i,r){n("post","json",t,i,r,"moveorcopy?destFolderId="+encodeURIComponent(i.folderToId)+"&resolve="+i.resolve+"&ic="+(i.isCopyOperation==!0))},gt=function(t,i,r){n("post","json",t,i,r,"folders-files?action=delete")},ni=function(t,i){n("get","json",t,i,"emptytrash")},ti=function(t,i,r){i.showLoading=!0;i.ajaxcontentType="application/json";n("post","json",t,i,r,"bulkdownload")},ii=function(t,i){n("get","json",t,i,"tasks-statuses")},ri=function(t,i){n("get","json",t,i,"tasks")},ui=function(t,i,r){n("post","json",t,i,r,"checkediting")},fi=function(t,i){n("get","json",t,i,"setacelink?fileId="+encodeURIComponent(i.fileId)+"&share="+i.share)},ei=function(t,i,r){n("post","json",t,i,r,"sharedinfo")},oi=function(t,i){n("get","json",t,i,"sharedinfoshort?objectId="+encodeURIComponent(i.objectID))},si=function(t,i,r){n("post","json",t,i,r,"setaceobject?notify="+(i.notify===!0))},hi=function(t,i,r){n("post","json",t,i,r,"removeace")},ci=function(t,i){n("get","json",t,i,"shorten?fileId="+encodeURIComponent(i.fileId))},li=function(t,i){n("get","json",t,i,"publickeys?fileId="+encodeURIComponent(i.fileId))},ai=function(t,i){n("get","json",t,i,"sharedusers?fileId="+encodeURIComponent(i.fileId))},vi=function(t,i,r){n("post","json",t,i,r,"sendeditornotify?fileId="+encodeURIComponent(i.fileId))},yi=function(t,i){n("get","json",t,i,"external?enable="+(i.enable===!0))},pi=function(t,i){n("get","json",t,i,"externalsocialmedia?enable="+(i.enable===!0))},wi=function(t,i,r){n("post","json",t,i,r,"checkconversion")},bi=function(t,i){n("get","json",t,i,"updateifexist?set="+i.value)},ki=function(t,i){n("get","json",t,i,"forcesave?set="+i.value)},di=function(t,i){n("get","json",t,i,"storeforcesave?set="+i.value)},gi=function(t,i){n("get","json",t,i,"changedeleteconfrim?set="+i.value)},nr=function(t,i){i.showLoading=!0;ASC.Files.Folders.isFirstLoad=!1;n("get","json",t,i,"thirdparty-list?folderType="+(i.folderType||0))},tr=function(t,i,r){n("post","json",t,i,r,"thirdparty-save")},ir=function(t,i){n("get","json",t,i,"thirdparty-delete?providerId="+i.providerId)},rr=function(t,i){n("get","json",t,i,"thirdparty?enable="+(i.enable===!0))},ur=function(t,i,r){i.ajaxcontentType="application/json";n("post","json",t,i,r,"docusign-save")},fr=function(t,i){n("get","json",t,i,"docusign-delete")},er=function(t,i,r){n("post","json",t,i,r,"docusign?fileId="+encodeURIComponent(i.fileId))},or=function(t,i,r){n("post","json",t,i,r,"markasread")},sr=function(t,i){n("get","xml",t,i,"getnews?folderId="+encodeURIComponent(i.folderId))},hr=function(t,i){n("get","xml",t,i,"gettemplates?filter="+i.filter+"&from="+i.from+"&count="+i.count+"&subjectGroup="+!!i.subjectGroup+"&subjectID="+i.subjectId+"&searchInContent="+!!i.searchInContent+"&search="+encodeURIComponent(i.search))},cr=function(t,i){n("get","xml",t,i,"folders-files-lock?fileId="+encodeURIComponent(i.fileId)+"&lockfile="+(i.lock===!0))},lr=function(t,i){n("get","json",t,i,"file-favorite?fileId="+encodeURIComponent(i.fileId)+"&favorite="+(i.favorite===!0))},ar=function(t,i){n("get","json",t,i,"edit-history?fileId="+encodeURIComponent(i.fileID)+i.shareLinkParam)},vr=function(t,i){n("get","json",t,i,"edit-diff-url?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+i.shareLinkParam)},yr=function(t,i){n("get","json",t,i,"restore-version?fileId="+encodeURIComponent(i.fileID)+"&version="+i.version+"&url="+encodeURIComponent(i.url)+i.shareLinkParam)},pr=function(t,i){n("get","json",t,i,"mailaccounts")},wr=function(t,i){n("get","json",t,i,"gethelpcenter")},br=function(t,i,r){n("post","json",t,i,r,"changeowner?userId="+i.userId)};return{bind:d,unbind:g,events:{CreateNewFile:"createnewfile",CreateFolder:"createfolder",CheckEditing:"checkediting",GetTreeSubFolders:"gettreesubfolders",GetTreePath:"gettreepath",GetThirdPartyTree:"getthirdpartytree",GetFolderInfo:"getfolderinfo",GetFolderItems:"getfolderitems",GetItems:"getitems",GetFolderItemsTree:"getfolderitemstree",GetMediaFile:"getmediafile",SetAceLink:"setacelink",GetSharedInfo:"getsharedinfo",GetSharedInfoShort:"getsharedinfoshort",GetFileSharedInfo:"getfilesharedinfo",SetAceFileLink:"setacefilelink",GetEncryptionAccess:"getencryptionaccess",SetAceObject:"setaceobject",UnSubscribeMe:"unsubscribeme",GetShortenLink:"getshortenlink",GetPresignedUri:"getpresigneduri",ChangeExternalShareSettings:"changeexternalsharesettings",ChangeExternalShareSocialMediaSettings:"changeexternalsharesocialmediasettings",GetUsers:"getusers",SendEditorNotify:"sendeditornotify",MarkAsRead:"markasread",GetNews:"getnews",ToggleFavorite:"togglefavorite",GetTemplates:"gettemplates",ChangeOwner:"changeowner",FolderRename:"folderrename",FileRename:"filerename",DeleteItem:"deleteitem",EmptyTrash:"emptytrash",GetFileHistory:"getfilehistory",ReplaceVersion:"replaceversion",SetCurrentVersion:"setcurrentversion",UpdateComment:"updatecomment",CompleteVersion:"completeversion",Download:"download",GetTasksStatuses:"getTasksStatuses",TerminateTasks:"terminatetasks",MoveFilesCheck:"movefilescheck",MoveItems:"moveitems",GetSiblingsImage:"getsiblingsimage",GetThirdParty:"getthirdparty",SaveThirdParty:"savethirdparty",DeleteThirdParty:"deletethirdparty",ChangeAccessToThirdparty:"changeaccesstothirdparty",SaveDocuSign:"savedocusign",SendDocuSign:"senddocusign",UpdateIfExist:"updateifexist",Forcesave:"forcesave",StoreForcesave:"storeforcesave",GetHelpCenter:"gethelpcenter",ChangeDeleteConfrim:"changedeleteconfrim",ConvertCurrentFile:"convertcurrentfile",ChunkUploadCheckConversion:"chunkuploadcheckconversion",ChunkUploadGetFileFromServer:"chunkuploadgetfilefromserver",TrackEditFile:"trackeditfile",LockFile:"lockfile",GetEditHistory:"getedithistory",GetDiffUrl:"getdiffurl",RestoreVersion:"restoreversion",GetMails:"getmails",StartMailMerge:"startmailmerge"},createFolder:it,createNewFile:rt,getFolderItems:ut,getTreeSubFolders:ft,getTreePath:et,getFolder:ot,getItems:st,getFile:ht,getFileHistory:ct,setCurrentVersion:lt,updateComment:at,completeVersion:vt,getSiblingsImage:yt,getPresignedUri:pt,renameFolder:wt,renameFile:bt,changeOwner:br,moveFilesCheck:kt,moveItems:dt,deleteItem:gt,emptyTrash:ni,download:ti,getTasksStatuses:ii,terminateTasks:ri,checkEditing:ui,setAceLink:fi,getSharedInfo:ei,getSharedInfoShort:oi,setAceObject:si,unSubscribeMe:hi,getShortenLink:ci,getEncryptionAccess:li,changeExternalShareSettings:yi,changeExternalShareSocialMediaSettings:pi,getUsers:ai,sendEditorNotify:vi,checkConversion:wi,updateIfExist:bi,forcesave:ki,storeForcesave:di,changeDeleteConfrim:gi,getThirdParty:nr,saveThirdParty:tr,deleteThirdParty:ir,changeAccessToThirdparty:rr,saveDocuSign:ur,deleteDocuSign:fr,sendDocuSign:er,markAsRead:or,getNews:sr,getTemplates:hr,lockFile:cr,toggleFavorite:lr,getEditHistory:ar,getDiffUrl:vr,restoreVersion:yr,getMailAccounts:pr,getHelpCenter:wr}}();
window.ASC.Files.UI=function(){var t=!1,i=null,u=new PopupBox("pb_filesUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl"}),n=function(){var t=null,n=[];return{getFiles:function(){return n},setFolder:function(i){i!=t&&(t=i,n=[])},setFile:function(t){n.indexOf(t)<0&&n.push(t)}}}(),f=function(){t===!1&&(t=!0);jq(window).on("resize",function(){r();ASC.Files.UI.fixContentHeaderWidth();e()});jq(window).on("resizeWinTimerWithMaxDelay",function(){r();ASC.Files.UI.fixContentHeaderWidth()});isAutoCleanUpOn=jq("#cbxAutomaticallyCleanUp").is(":checked");autoCleanUpGap=isAutoCleanUpOn?parseInt(jq("#selectGapToAutoCleanUp").val()):-1;ASC.Files.UI.autoCleanUpSetting={isAutoCleanUp:isAutoCleanUpOn,gap:autoCleanUpGap};isAutoCleanUpOn||jq("#selectGapToAutoCleanUp").val("1").trigger("change")},e=function(){jq("#filesMainContent").hasClass("thumbnails")&&(jq("#contentVersions").remove(),clearTimeout(i),i=setTimeout(function(){var n=jq(".display-versions");n.length&&ASC.Files.Folders.showVersions(n)},500))},o=function(){},s=function(n){n=jq(n);n.hasClass("display-versions")&&ASC.Files.Folders.closeVersions();n.remove()},h=function(n,t){return n&&t?ASC.Files.Common.isCorrectId(t)?jq("#filesMainContent .file-row"+ASC.Files.UI.getSelectorId(n+"_"+t)):null:null},c=function(n){return'[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]'},l=function(n){var r,u,i,t;return(n=jq(n),r='input:hidden[name="entry_data"]',n.is(".file-row")||(u=".file-row",n.is(".jstree *")?(u=".tree-node",r='> a input:hidden[name="entry_data"]'):n.closest("#contentVersions").length&&(n=jq(".display-versions")),n=n.closest(u)),n.length==0)?null:(i=n.find(r),!i.length)?null:(t={},t.id=t.entryId=i.attr("data-id"),!ASC.Files.Common.isCorrectId(t.id))?null:(t.entryObject=n,t.access=i.attr("data-access"),t.comment=i.attr("data-comment"),t.content_length=i.attr("data-content_length"),t.content_length_string=i.attr("data-content_length_string"),t.create_by=i.attr("data-create_by"),t.create_by_id=i.attr("data-create_by_id"),t.create_on=i.attr("data-create_on"),t.entryType=(i.attr("data-entryType")||"").trim()==="file"?"file":"folder",t.error=i.attr("data-error"),t.error=t.error!=""?t.error:!1,t.file_status=i.attr("data-file_status"),t.isnew=i.attr("data-isnew")|0,t.modified_by=i.attr("data-modified_by"),t.modified_on=i.attr("data-modified_on"),t.provider_id=i.attr("data-provider_id")|0,t.provider_key=i.attr("data-provider_key"),t.shared=i.attr("data-shared")==="true",t.deny_download=i.attr("data-deny_download")==="true",t.deny_sharing=i.attr("data-deny_sharing")==="true",t.title=(i.attr("data-title")||"").trim(),t.version=i.attr("data-version")|0,t.version_group=i.attr("data-version_group")|0,t.folderUrl=i.attr("data-folder_url"),t.folder_id=i.attr("data-folder_id"),t.folder_is_favorite=i.attr("data-folder_is_favorite"),t.encrypted=i.attr("data-encrypted")==="true",t.thumbnail_status=i.attr("data-thumbnail_status"),t.deleted_permanently_date=i.attr("data-deleted_permanently_date"),t)},a=function(n,t,i){if(n=jq(n),n.length!=0){var r=n.find('input:hidden[name="entry_data"]');r.length&&r.attr(t,i)}},v=function(n){if(typeof n=="undefined"||n==null)return null;var t=n.indexOf("file_")=="0"?"file":"folder",i=n.substring((t+"_").length);return ASC.Files.Common.isCorrectId(i)?{entryType:t,entryId:i}:null},y=function(n,t){return ASC.Files.Common.isCorrectId(t)?ASC.Files.UI.getObjectTitle(ASC.Files.UI.getEntryObject(n,t)):null},p=function(n){return(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),n.length==0)?null:ASC.Files.UI.getObjectData(n).title.trim()},w=function(n,t,i){if(n=="file"){var r=ASC.Files.Utility.GetFileDownloadUrl(t);ASC.Files.Utility.CanWebEdit(i)&&!ASC.Files.Utility.MustConvert(i)?r=ASC.Files.Utility.GetFileWebEditorUrl(t):ASC.Files.Utility.CanWebView(i)?r=ASC.Files.Utility.GetFileWebViewerUrl(t):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(i)?r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.ImageViewer.getPreviewHash(t)):typeof ASC.Files.MediaPlayer!="undefined"&&ASC.Files.MediaPlayer.canPlay(i,!0)&&(r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.MediaPlayer.getPlayHash(t)))}else r=ASC.Files.Constants.URL_BASE+"#"+ASC.Files.Common.getCorrectHash(t);return r},b=function(){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.move("");return}ASC.Files.UI.hideAllContent(!0);ASC.Files.UI.stickContentHeader();ASC.Files.Folders.getFolderItems(!1)},k=function(t){var u=ASC.Files.Constants.storageKeyCompactView,i,r;typeof t=="undefined"&&(i=localStorageManager.getItem(u)||!1,t=i,typeof i=="boolean"&&(t=i?"compact":"normal"));ASC.Files.Folders.closeVersions();jq("#switchViewFolder, #filesMainContent").removeClass("thumbnails normal compact");jq("#switchViewFolder, #filesMainContent").addClass(t);localStorageManager.setItem(u,t);ASC.Files.Folders.showMore&&t!="compact"&&ASC.Files.UI.trackShowMore();ASC.Files.Mouse&&ASC.Files.Mouse.updateMainContentArea();t=="thumbnails"&&(jq("#filesMainContent").find(".file-row .thumb-img img[src='']").each(function(){var n=jq(this),t=n.attr("data-src");n.on("error",ASC.Files.EventHandler.onThumbnailError).attr("src",t)}),r=n.getFiles(),r.length&&Teamlab.createThumbnails(null,{fileIds:r}))},d=function(){return jq("#settingCommon, #settingAdmin, #settingThirdPartyPanel, #helpPanel").is(":visible")},g=function(){var n=jq("#mainContentHeader.stick-panel:visible");n.css("width",n.parent().innerWidth()-parseInt(n.css("margin-left"))-parseInt(n.css("margin-right")))},r=function(){var n=jq("#mainContentHeader.stick-panel:visible"),t=jq(window);n.length!=0&&n.css("left",n.parent().offset().left-t.scrollLeft())},nt=function(){var n=jq("#mainContentHeader .down_arrow");n.length&&(ASC.Files.UI.stickMovingPanel("mainContentHeader",jq("#filesSelectorPanel:visible")),ASC.Files.UI.fixContentHeaderWidth())},tt=function(n,t){var i=jq("#"+n),u,r,o,f,s,e;i.is(":visible")&&(t&&t.hide(),u=n+"Spacer",r=jq("#"+u),o=jq("#"+u+":visible").length==0?i.offset().top:r.offset().top,f=jq(window),s=f.scrollTop(),s>=o?(i.hasClass("stick-panel")||(r.length==0&&(e=document.createElement("div"),e.id=u,document.body.appendChild(e),r=jq("#"+u),r.insertAfter(i),r.css({height:i.css("height"),"padding-bottom":i.css("padding-bottom"),"padding-top":i.css("padding-top")})),r.show(),i.addClass("stick-panel")),i.css("left",i.parent().offset().left-f.scrollLeft())):i.hasClass("stick-panel")&&(r.hide(),i.removeClass("stick-panel"),jq("#mainContentHeader").css("width","auto")))},it=function(n){typeof n=="undefined"&&(n=jq(window).width()>=1200||ASC.Desktop);n?jq(".files-content-panel").height()-jq(".mainPageContent").height()<=jq(".mainPageContent").scrollTop()+350&&ASC.Files.Folders.showMore():jq(document).height()-jq(window).height()<=jq(window).scrollTop()+350&&ASC.Files.Folders.showMore()},rt=function(){var n=jq("#filesTemplateList .file-row");n.eq(n.length-1).position().top==271&&ASC.Files.Folders.getTemplateList(!0)},ut=function(n,t,i,r,u){return ASC.Files.UI.blockObject(ASC.Files.UI.getEntryObject(n,t),i,r,u)},ft=function(n,t,i,r){if(t=t===!0,n=jq(n),n.length&&n.hasClass("checkloading")!=t){jq(n).removeClass("row-hover");n.toggleClass("loading checkloading",t===!0);t===!0?(n.block({message:"",baseZ:99}),typeof i!="undefined"&&i&&n.children("div.blockUI.blockOverlay").attr("title",i)):(n.unblock(),n.css("position",""));var u=n.hasClass("row-selected"),f=n.attr("data-selected")=="true";ASC.Files.UI.selectRow(n,!t&&f);t&&n.attr("data-selected",u);r||ASC.Files.UI.updateMainContentHeader()}},et=function(n){return!n.hasClass("folder-row")&&n.hasClass("on-edit")},ot=function(n){return n.hasClass("file-locked-by")},st=function(n){var t=n.entryObject,i=n.entryType,r=n.title;return i=="file"&&ASC.Files.Folders.folderContainer!="trash"&&!t.hasClass("row-rename")&&ASC.Files.UI.accessEdit(n,t,!0)&&ASC.Files.Utility.CanWebEdit(r)},ht=function(n,t){var i=ASC.Files.Utility.GetFileExtension(t),r=t.substring(0,t.length-i.length);n.html('{0}<span class="file-extension">{1}<\/span>'.format(r,i))},ct=function(t){var u=t||jq("#filesMainContent .file-row"),i=jq("#filesMainContent .files-separator").length>0,r;n.setFolder(ASC.Files.Folders.currentFolder.id);r=ASC.Files.UI.autoCleanUpSetting.isAutoCleanUp;u.each(function(){var u=ASC.Files.UI.getObjectData(this),h=u.entryId,f=u.entryType,t=u.entryObject,o=u.title,s,a,e,c,l,v;ASC.Files.Folders.folderContainer=="trash"?(t.find(".file-lock").remove(),t.find(".template-action").remove(),t.find(".entry-descr .title-created").remove(),t.find(".entry-descr .title-removed").show(),f=="folder"&&(t.find(".create-date").remove(),t.find(".modified-date").show()),r?(t.find(".entry-descr .title-removed").remove(),t.find(".create-date").remove(),t.find(".modified-date").remove(),t.find(".deleted-permanently").show(),t.find(".entry-descr .title-removed-permanently").show()):(t.find(".entry-descr .title-removed-permanently").remove(),t.find(".entry-descr .title-removed").show(),t.find(".deleted-permanently-date").remove(),t.find(".modified-date").show())):(t.find(".entry-descr .title-removed").remove(),t.find(".entry-descr .title-removed-permanently").remove(),t.find(".deleted-permanently-date").remove(),f=="folder"&&t.find(".modified-date").remove());s=t.find(".entry-title .name a");a=f=="file"?ASC.Files.Utility.getCssClassByFileTitle(o):ASC.Files.Utility.getFolderCssClass();t.find(".thumb-img, .thumb-"+f).addClass(a);u.thumbnail_status!=0||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(u)||n.setFile(h);u.thumbnail_status==1&&t.find(".thumb-img img").attr("data-src",ASC.Files.Utility.GetFileThumbnailUrl(h,u.version));f!="folder"||ASC.Files.Folders.folderContainer=="forme"||t.hasClass("new-folder")||t.addClass("min");f!="file"||i||ASC.Files.Folders.folderContainer=="forme"||(t.before("<div class='files-separator'><\/div>"),i=!0);t.hasClass("checkloading")||(f=="file"?(s.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(s,o),ASC.Files.Folders.folderContainer!="trash"&&(e=ASC.Files.UI.getEntryLink(f,h,o),s.attr("href",e).attr("target","_blank"),c=t.find(".file-lock"),ASC.Files.UI.accessEdit(u,t)?t.hasClass("file-locked")&&(l=ASC.Files.FilesJSResource.TitleLockedFile,ASC.Files.UI.lockedForMe(t)&&(v=c.attr("data-name"),l=ASC.Files.FilesJSResource.TitleLockedFileBy.format(v),(ASC.Files.Constants.ADMIN||ASC.Files.Folders.folderContainer=="my")&&t.addClass("file-can-unlock")),c.attr("title",l)):c.remove()),ASC.Files.Utility.MustConvert(o)&&!u.encrypted?(t.find(".pencil:not(.convert-action)").remove(),Teamlab.profile.isVisitor&&!ASC.Files.UI.accessEdit()||ASC.Files.UI.denyDownload(u)||ASC.Files.Folders.folderContainer=="trash"?t.find(".convert-action").remove():t.find(".convert-action").show()):ASC.Files.Utility.CanWebRestrictedEditing(o)&&!u.encrypted?(t.find(".pencil:not(.fillform-action)").remove(),t.find(".fillform-action").show()):(u.encrypted&&(ASC.Desktop?(e=ASC.Files.Utility.GetFileWebEditorUrl(h),s.attr("href",e),t.find(".file-edit").attr("href",e)):(s.removeAttr("href"),t.find(".file-edit").removeAttr("href"))),ASC.Files.UI.editableFile(u)&&(!u.encrypted||ASC.Files.Folders.folderContainer=="privacy"&&ASC.Files.Utility.CanWebEncrypt(o)&&ASC.Desktop&&ASC.Desktop.encryptionSupport())?(ASC.Files.UI.lockEditFile(t,ASC.Files.UI.editingFile(t)),t.find(".convert-action, .fillform-action").remove(),ASC.Files.Utility.CanCoAuhtoring(o)&&!t.hasClass("on-edit-alone")&&t.addClass("can-coauthoring"),u.encrypted||(e=ASC.Files.Utility.GetFileWebEditorUrl(h),t.find(".file-edit").attr("href",e))):(t.addClass("cannot-edit"),t.find(".pencil").remove())),u.encrypted&&(ASC.Files.Folders.folderContainer!="privacy"||!ASC.Desktop||!ASC.Desktop.encryptionSupport()||ASC.Resources.Master.Personal)?t.addClass("without-share"):ASC.Resources.Master.Personal&&!ASC.Files.Utility.CanWebView(o)&&t.addClass("without-share")):ASC.Files.Folders.folderContainer!="trash"&&(e=ASC.Files.UI.getEntryLink(f,h),s.attr("href",e)),(ASC.Files.Folders.folderContainer=="trash"||u.error)&&s.attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)),jq("#filesMainContent").hasClass("without-share")?ASC.Files.Folders.folderContainer!="forme"||u.access!=ASC.Files.Constants.AceStatusEnum.ReadWrite||u.deny_sharing||Teamlab.profile.isVisitor||t.addClass("can-share"):(ASC.Files.Folders.folderContainer=="forme"&&(!ASC.Files.UI.accessEdit(u,t)||ASC.Files.UI.denySharing(u))||ASC.Files.Folders.folderContainer=="privacy"&&(f=="folder"||!ASC.Files.UI.accessEdit(u,t)||ASC.Files.UI.denySharing(u))||ASC.Resources.Master.Personal&&f=="folder"||Teamlab.profile.isVisitor===!0)&&t.addClass("without-share"),jq.browser.msie&&t.find("*").attr("unselectable","on"))});jq("#switchToNormal").length&&ASC.Files.UI.switchFolderView()},lt=function(n,t){var r=jq.fixEvent(n),i,u;if(!(r.button==0||jq.browser.msie&&r.button==1))return!0;t=t||jq(r.srcElement||r.target);try{if(t.is("a, .menu-small"))return!0}catch(r){return!0}if(i=t.is(".file-row")?t:t.closest(".file-row"),u=!jq(i).hasClass("row-selected")||jq(i).find(".checkbox input:visible").is("[type=radio]"),r.shiftKey){ASC.Files.UI.lastSelectedEntry||(ASC.Files.UI.lastSelectedEntry=i);u=!0;var f=jq(".file-row").index(i),e=jq(".file-row").index(ASC.Files.UI.lastSelectedEntry.entryObj),o=Math.min(f,e),s=Math.max(f,e);jq(".file-row:lt("+s+"):gt("+o+")").each(function(){ASC.Files.UI.selectRow(jq(this),u)})}else r.ctrlKey||t.is(".checkbox, .checkbox input")||(jq(".row-selected").length>1&&(u=!0),ASC.Files.UI.checkSelectAll(!1));return ASC.Files.UI.selectRow(i,u),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.lastSelectedEntry=u?{entryObj:i}:null,!0},at=function(){ASC.Files.UI.resetSelectAll(jq("#filesMainContent .file-row:has(.checkbox input[type=checkbox]:not(:checked))").length==0);jq("#filesMainContent .file-row:has(.checkbox input:checked)").length==0?(jq("#mainContentHeader .menuAction.unlockAction").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"&&jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Actions&&ASC.Files.Actions.showActionsViewPanel();typeof ASC.Files.UI.filesSelectedHandler=="function"&&ASC.Files.UI.filesSelectedHandler()},vt=function(n,t){return n?(n.hasClass("file-row")||(n=n.closest(".file-row")),n.hasClass("row-selected")==t)?!1:n.hasClass("checkloading")&&t?!1:((n.hasClass("new-folder")||jq(n).hasClass("row-rename"))&&(t=!1),t===!0&&n.find(".checkbox input:visible").is("[type=radio]")&&(jq("#filesMainContent .checkbox input:checked").prop("checked",!1),jq("#filesMainContent .file-row.row-selected").removeClass("row-selected")),n.find(".checkbox input").prop("checked",t===!0),n.toggleClass("row-selected",t).removeAttr("data-selected"),jq("#filesMainContent .menu-small.active").removeClass("active"),!0):!1},yt=function(n){var t=n!==!0&&jq("#filesMainContent .file-row .checkbox input:checked").length!=0;jq("#filesSelectAllCheck").prop("checked",n===!0||t===!0);jq("#filesSelectAllCheck").prop("indeterminate",t)},pt=function(n){var t=!1,i=".row-selected";n&&(i=":not("+i+")");jq("#filesMainContent .file-row"+i+":not(.checkloading)").each(function(){t=ASC.Files.UI.selectRow(jq(this),n)||t});t&&ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null},wt=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#filesMainContent .file-row:not(.checkloading)").each(function(){var t,i=ASC.Files.UI.getObjectTitle(this);switch(n){case"folder":t=jq(this).hasClass("folder-row");break;case"file":t=!jq(this).hasClass("folder-row");break;case"document":t=ASC.Files.Utility.FileIsDocument(i)&&!jq(this).hasClass("folder-row");break;case"presentation":t=ASC.Files.Utility.FileIsPresentation(i)&&!jq(this).hasClass("folder-row");break;case"spreadsheet":t=ASC.Files.Utility.FileIsSpreadsheet(i)&&!jq(this).hasClass("folder-row");break;case"image":t=ASC.Files.Utility.FileIsImage(i)&&!jq(this).hasClass("folder-row");break;case"media":t=(ASC.Files.Utility.FileIsAudio(i)||ASC.Files.Utility.FileIsVideo(i))&&!jq(this).hasClass("folder-row");break;case"archive":t=ASC.Files.Utility.FileIsArchive(i)&&!jq(this).hasClass("folder-row");break;default:return!1}return ASC.Files.UI.selectRow(jq(this),t),!0});ASC.Files.UI.updateMainContentHeader()},bt=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},kt=function(n,t,i){var r,u,f;if(Teamlab.profile.isOutsider||(n=n||(t?ASC.Files.UI.getObjectData(t):ASC.Files.Folders.currentFolder),r=n?n.entryId:null,u=n?n.entryType:null,u=="folder"&&(r==ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&!ASC.Files.Constants.ADMIN||r==ASC.Files.Constants.FOLDER_ID_SHARE||r==ASC.Files.Constants.FOLDER_ID_RECENT||r==ASC.Files.Constants.FOLDER_ID_FAVORITES||r==ASC.Files.Constants.FOLDER_ID_TEMPLATES||r==ASC.Files.Constants.FOLDER_ID_TRASH||r==ASC.Files.Constants.FOLDER_ID_PROJECT)))return!1;f=parseInt(n?n.access:ASC.Files.Constants.AceStatusEnum.None);u=="folder"&&ASC.Files.Folders&&ASC.Files.Folders.currentFolder&&r==ASC.Files.Folders.currentFolder.id&&(f=parseInt(ASC.Files.Folders.currentFolder.access));switch(f){case ASC.Files.Constants.AceStatusEnum.None:case ASC.Files.Constants.AceStatusEnum.ReadWrite:return!0;case ASC.Files.Constants.AceStatusEnum.Read:case ASC.Files.Constants.AceStatusEnum.Restrict:return!1;case ASC.Files.Constants.AceStatusEnum.CustomFilter:case ASC.Files.Constants.AceStatusEnum.Review:case ASC.Files.Constants.AceStatusEnum.FillForms:case ASC.Files.Constants.AceStatusEnum.Comment:return!!i;default:return n&&n.entryType=="folder"&&(n.entryId===ASC.Files.Constants.FOLDER_ID_SHARE||n.entryId===ASC.Files.Constants.FOLDER_ID_RECENT||n.entryId===ASC.Files.Constants.FOLDER_ID_FAVORITES||n.entryId===ASC.Files.Constants.FOLDER_ID_TEMPLATES||n.entryId===ASC.Files.Constants.FOLDER_ID_PROJECT||n.entryId===ASC.Files.Constants.FOLDER_ID_TRASH)?!1:ASC.Files.Constants.ADMIN||!n||n.create_by_id==Teamlab.profile.id}},dt=function(n){if(Teamlab.profile.isOutsider)return!1;var t=n?ASC.Files.UI.getObjectData(n):ASC.Files.Folders.currentFolder,i=parseInt(t?t.access:ASC.Files.Constants.AceStatusEnum.None),r=t?t.entryId:null,u=t?t.entryType:null;return(u=="folder"&&r==ASC.Files.Folders.currentFolder.id&&(i=ASC.Files.Folders.currentFolder.access),i==ASC.Files.Constants.AceStatusEnum.Restrict)?(ASC.Files.UI.removeEntryObject(n),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.AceStatusEnum_Restrict,!0),!1):ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES?!1:i==ASC.Files.Constants.AceStatusEnum.Read?!1:i==ASC.Files.Constants.AceStatusEnum.None||ASC.Files.Folders.folderContainer=="corporate"&&ASC.Files.Constants.ADMIN||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT&&t.create_by_id==Teamlab.profile.id},gt=function(n){return!n||!n.deny_download?!1:n.access==ASC.Files.Constants.AceStatusEnum.Read||n.access==ASC.Files.Constants.AceStatusEnum.Comment},ni=function(n){return n?n.access!=ASC.Files.Constants.AceStatusEnum.None&&n.access!=ASC.Files.Constants.AceStatusEnum.ReadWrite?!0:n.access==ASC.Files.Constants.AceStatusEnum.ReadWrite&&n.deny_sharing:!1},ti=function(n,t,i){var r=ASC.Files.UI.getEntryObject("file",n);return ASC.Files.UI.lockEditFile(r,t,i)},ii=function(n,t,i){if(!n.hasClass("folder-row"))if(t){n.addClass("on-edit");var r=ASC.Files.FilesJSResource.TitleEditingFile;i&&(r=ASC.Files.FilesJSResource.TitleEditingFileBy.format(i));n.find(".pencil.file-editing").attr("title",r)}else n.removeClass("on-edit")},ri=function(){var t=jq(".files-content-panel #filesMainContent .file-row.on-edit:visible:not(.cannot-edit)"),n;t.length!=0&&(n={entry:jq(t).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray()},ASC.Files.ServiceManager.checkEditing(ASC.Files.ServiceManager.events.CheckEditing,{list:n.entry},{stringList:n}))},ui=function(){clearTimeout(ASC.Files.UI.timeCheckEditing);ASC.Files.UI.timeCheckEditing=setTimeout(ASC.Files.UI.checkEditing,2e4)},fi=function(n,t,i){var f;n=n||ASC.Files.UI.getEntryObject(t,i);var h=localStorageManager.getItem(ASC.Files.Constants.storageKeyCompactView)=="thumbnails"?!0:!1,r=ASC.Files.UI.getObjectData(n),c={entryTooltip:{type:t,title:r.title,create_by:r.create_by,date_type:ASC.Files.Folders.folderContainer=="trash"?"remove":t=="folder"?"create":r.version>1?"update":"upload",modified_on:t=="file"?r.modified_on:ASC.Files.Folders.folderContainer=="trash"?r.modified_on:r.create_on,version:r.version,length_string:r.content_length_string,thumbnail:r.thumbnail_status==1&&!h?ASC.Files.Utility.GetFileThumbnailUrl(i,r.version):!1,error:r.error,provider_key:r.provider_key,total_files:parseInt(n.find(".countFiles").html())||0,total_sub_folder:parseInt(n.find(".countFolders").html())||0,comment:r.comment}},l=ASC.Files.Common.jsonToXml(c),a=ASC.Files.TemplateManager.translateFromString(l),u=n.find(".checkbox"),e=jq("#entryTooltip"),o=jq(window),s=12;e.html(a);f=u.offset().top+u.outerHeight()+e.outerHeight()+s>o.height()+o.scrollTop();jq.dropdownToggle().toggle(u,"entryTooltip",f?s:0,0,!1,null,null,null,f)},ei=function(){clearTimeout(ASC.Files.UI.timeTooltip);jq("#entryTooltip").hide();var n=jq("#filesMainContent .file-row .entry-title .name a[data-title]").removeAttr("data-title");n.attr("title",n.text())},oi=function(){var n=ASC.Files.Constants.COUNT_ON_PAGE-jq("#filesMainContent .file-row").length;n>0&&(ASC.Files.UI.currentPage<ASC.Files.UI.amountPage?ASC.Files.Folders.getFolderItems(!0,n):ASC.Files.Folders.folderContainer&&n>=ASC.Files.Constants.COUNT_ON_PAGE&&ASC.Files.EmptyScreen.displayEmptyScreen())},si=function(n,t){if(ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>1){var i=ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-2],r=ASC.Files.Tree.getFolderTitle(i);jq(n).attr("data-id",i).attr("href",ASC.Files.UI.getEntryLink("folder",i)).attr("title",r).show();jq(t||n).show()}else jq(t||n).hide()},hi=function(n){jq(n).off("keyup").on("keyup",function(){var n=jq(this).val();n.search(ASC.Files.Common.characterRegExp)!=-1&&(jq(this).val(ASC.Files.Common.replaceSpecCharacter(n)),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_SpecCharacter.format(ASC.Files.Common.characterString),!0))})},ci=function(n){if(ASC.Files.UI.canSetDocumentTitle){n=n||ASC.Files.Folders.currentFolder.title;n=n?n+" - ":"";var t=jq(".files-content-panel").attr("data-title")||"TeamLab";document.title=n+t}},li=function(n){ASC.Files.MediaPlayer&&ASC.Files.MediaPlayer.isView&&ASC.Files.MediaPlayer.closePlayer();n=!!n;n||(jq("#treeViewContainer .selected").removeClass("selected"),jq("#treeViewContainer .parent-selected").removeClass("parent-selected"),jq("#mainContentHeader, .files-filter").hide());jq("#treeSecondary .currentCategory").removeClass("currentCategory");jq("#treeSecondary .active").removeClass("active");jq("#settingCommon, #settingAdmin").hide();jq("#settingThirdPartyPanel").hide();jq("#helpPanel").hide();jq("#moreFeatures").hide();jq(".files-content-panel").toggle(n);jq(".mainPageContent").children(".loader-page").remove()},ai=function(n){if(!jq("#helpPanel").length){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.hideAllContent();var t={helpId:n};if(jq("#helpPanel").text().trim().length)ASC.Files.EventHandler.onGetHelpCenter(null,t);else t.update=!0,ASC.Files.ServiceManager.getHelpCenter(ASC.Files.ServiceManager.events.GetHelpCenter,t)},vi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeViewContainer .node-selected").removeClass("node-selected");jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-common").addClass("active");jq("#settingCommon").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsCommon)},yi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeViewContainer .node-selected").removeClass("node-selected");jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-admin").addClass("active");jq("#settingAdmin").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsAdmin)},pi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();ASC.Files.CreateMenu.disableMenu();jq("#moreFeatures").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleMoreFeaturs)},wi=function(){return jq("#personalLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#personalLimitExceedStoragePanel",500),!0):!1},bi=function(){return jq("#tariffLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedStoragePanel",500),!0):!1},ki=function(){return jq("#tariffLimitExceedFileSizePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedFileSizePanel",500),!0):!1},di=function(n,t){return ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),StudioBlockUIManager.blockUI(n,t)},gi=function(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%")},nr=function(n){n.find(".userLink").each(function(){var n=jq(this).attr("id").trim();n!=null&&n!=""&&u.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')})};return{init:f,parseItemId:v,removeEntryObject:s,getEntryObject:h,getObjectData:l,setObjectData:a,getSelectorId:c,getEntryTitle:y,getObjectTitle:p,getEntryLink:w,currentPage:0,amountPage:0,countTotal:0,autoCleanUpSetting:null,updateFolderView:b,switchFolderView:k,isSettingsPanel:d,blockObjectById:ut,blockObject:ft,highlightExtension:ht,addRowHandlers:ct,updateMainContentHeader:at,lastSelectedEntry:null,checkSelectAll:pt,checkSelect:wt,selectRow:vt,clickRow:lt,resetSelectAll:yt,displayInfoPanel:bt,editingFile:et,editableFile:st,lockedForMe:ot,checkEditing:ri,timeCheckEditing:null,checkEditingDefer:ui,lockEditFileById:ti,lockEditFile:ii,accessEdit:kt,accessDelete:dt,denyDownload:gt,denySharing:ni,checkCharacter:hi,canSetDocumentTitle:!0,setDocumentTitle:ci,stickContentHeader:nt,fixContentHeaderWidth:g,stickMovingPanel:tt,trackShowMore:it,trackShowMoreTemplates:rt,displayEntryTooltip:fi,hideEntryTooltip:ei,timeTooltip:null,checkEmptyContent:oi,checkButtonBack:si,hideAllContent:li,displayHelp:ai,displayCommonSetting:vi,displayAdminSetting:yi,displayMoreFeaturs:pi,displayPersonalLimitStorageExceed:wi,displayTariffLimitStorageExceed:bi,displayTariffFileSizeExceed:ki,blockUI:di,setProgressValue:gi,filesSelectedHandler:o,registerUserProfilePopup:nr}}(),function(n){ASC.Files.UI.init();n(function(){jq("#switchToNormal").on("click",function(){ASC.Files.UI.switchFolderView("normal")});jq("#switchToCompact").on("click",function(){ASC.Files.UI.switchFolderView("compact")});jq("#switchToThumbnails").on("click",function(){ASC.Files.UI.switchFolderView("thumbnails")});jq("#filesMainContent").on("click",".file-row",ASC.Files.UI.clickRow);jq("#filesMainContent").on("dblclick",".file-row:not(.checkloading)",function(n){jq(n.srcElement||n.target).is("input, .checkbox, .file-lock, .version, .pencil, .is-new, .btn-row, .menu-small, #contentVersions, #contentVersions *")||jq(this).closest(".file-row").find(".entry-title .name a").trigger("click")});jq("#filesMainContent").on("click",".checkbox input",function(n){ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.clickRow(n,jq(this));jq(this).trigger("blur");ASC.Files.Common.cancelBubble(n)});jq(".menu-action-on-top").on("click",function(){return jq(document).scrollTop(0),!1});jq(document).on("keydown",function(n){var t,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);i=t.target||t.srcElement;try{if(jq(i).is("input,textarea"))return!0}catch(t){return!0}return(r=t.keyCode||t.which,r==ASC.Files.Common.keyCode.A&&t.ctrlKey)?(jq.browser.opera&&setTimeout(function(){jq("#filesSelectAllCheck").trigger("focus")},1),ASC.Files.UI.checkSelectAll(!0),!1):!0});jq(document).on("keyup",function(n){var t,u,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);u=t.target||t.srcElement;try{if(jq(u).is("input,textarea"))return!0}catch(t){return!0}if(i=t.keyCode||t.which,ASC.Files.Folders){if(i==ASC.Files.Common.keyCode.deleteKey&&!t.shiftKey&&!t.altKey)return ASC.Files.Folders.deleteItem(),!1;if(i==ASC.Files.Common.keyCode.F&&t.shiftKey)return ASC.Files.Folders.createFolder(),!1;if(i==ASC.Files.Common.keyCode.N&&t.shiftKey)return ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)&&(ASC.Files.Folders.typeNewDoc="document",ASC.Files.Folders.createNewDoc()),!1;i==ASC.Files.Common.keyCode.F2&&jq("#filesMainContent .file-row.row-selected:visible").length==1&&(r=ASC.Files.UI.getObjectData(jq("#filesMainContent .file-row.row-selected")),ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.rename(r.entryType,r.id))}if(i==ASC.Files.Common.keyCode.esc){if(ASC.Files.Mouse){if(jq("#filesMovingTooltip").is(":visible"))return ASC.Files.Mouse.finishMoveTo(),!1;if(jq("#filesSelector").is(":visible"))return ASC.Files.Mouse.finishSelecting(),!1}return ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ChunkUploads&&ASC.Files.ChunkUploads.hideDragHighlight(),!0}return!0});jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#bottomLoaderPanel").on("drag",".progress-dialog-header",function(){ASC.Files.Actions.hideAllActionPanels()})})}(jQuery);
window.ASC.Files.Mouse=function(){var i=!1,n=null,r=null,o=function(){i===!1&&(i=!0);ASC.Files.Mouse.mouseBtn=!1},s=function(n){return ASC.Files.Mouse.mouseBtn||ASC.Files.Mouse.disableHover?!0:(n=jq.fixEvent(n),this.classList.toggle("row-hover",n.type=="mouseenter"),!0)},h=function(n){return n.nodeName=="HTML"?!0:jq(".popup-modal:visible").length!=0?!0:ASC.Files.MediaPlayer&&ASC.Files.MediaPlayer.isView?!0:jq(n).is("main,             .filter-content,             .mainPageContent,             .files-content-panel,             #mainContentHeader,             #mainContent,             .mainPageContent .layout-bottom-spacer,             #filesMainContent.thumbnails,             .file-row:not(.row-rename):not(.row-selected),             .file-row:not(.row-rename):not(.row-selected) *")?jq(n).is(".textEdit, .checkbox, input"):!0},c=function(){jq("#filesSelector").length!=0&&(ASC.Files.Mouse.mouseSelector.entryItems=[],jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file)").each(function(){var n=jq(this).offset();n.right=n.left+this.offsetWidth;n.bottom=n.top+this.offsetHeight;n.entryObj=jq(this);ASC.Files.Mouse.mouseSelector.entryItems.push(n)}))},l=function(){n=jq("#filesMainContent").offset();n.right=n.left+jq("#filesMainContent")[0].offsetWidth;n.bottom=n.top+jq("#filesMainContent")[0].offsetHeight;n.documentWidth=jq(document).width();n.documentHeight=jq(document).height();var t=jq("main").offset();n.minX=t.left;n.minY=t.top;n.minVisibleY=jq(".mainPageContent").offset().top},u=function(n,t){var i=n.x<t.x;return(i?n:t).y>(i?t:n).x},f=function(n,t){return u({x:n.top,y:n.bottom},{x:t.top,y:t.bottom})&&u({x:n.left,y:n.right},{x:t.left,y:t.right})},a=function(n){var t,i;if(n=jq.fixEvent(n),ASC.Files.Mouse.mouseBtn=n.target.nodeName!="HTML",!(n.button==0||jq.browser.msie&&n.button==1))return!0;t=n.target||n.srcElement;try{if(h(t))return!0}catch(r){return!0}if(jq(t).is(".folder-row:not(.error-entry) .thumb-folder,.file-row:not(.error-entry) .thumb-file,.file-row:not(.error-entry) .thumb-img,.file-row:not(.error-entry) .thumb-img img,.file-row.min:not(.error-entry) .entry-title .name,.file-row:not(.error-entry) .entry-title .name a,.file-row:not(.error-entry) .entry-title .name span"))return ASC.Files.Folders.folderContainer!=="trash"&&(ASC.Files.UI.clickRow(n,jq(t).closest(".file-row")),ASC.Files.Mouse.preparingMoveTo(n)),!0;ASC.Files.Mouse.mouseSelector.startX=n.pageX;ASC.Files.Mouse.mouseSelector.startY=n.pageY;ASC.Files.Mouse.updateMainContentArea();i=jq.browser.msie&&jq.browser.version<9?jq("body"):jq(window);i.off("mousemove.MouseSelect mouseup.MouseSelect").on("mousemove.MouseSelect",ASC.Files.Mouse.continueSelecting).on("mouseup.MouseSelect",ASC.Files.Mouse.finishSelecting);return typeof SmallChat!="undefined"&&SmallChat.minimizeAllWindowsIfLoseFocus&&SmallChat.minimizeAllWindowsIfLoseFocus(n,t),!1},v=function(t){var a,o,i,u,l,h;if(t=jq.fixEvent(t),a=t.target||t.srcElement,typeof a=="undefined")return!0;var v=2,c=Math.max(Math.min(t.pageX,n.documentWidth-v),n.minX),s=Math.max(Math.min(t.pageY,n.documentHeight-v),n.minY),y=Math.abs(c-ASC.Files.Mouse.mouseSelector.startX),p=Math.abs(s-ASC.Files.Mouse.mouseSelector.startY);if(y<5&&p<5)return!0;if(jq("#filesSelector").length==0&&(ASC.Files.Actions.hideAllActionPanels(),jq("#studioPageContent").append('<div id="filesSelector"><\/div>'),ASC.Files.Mouse.collectEntryItems(),jq("body").addClass("select-action"),ASC.Files.Mouse.disableHover=!0),o={left:Math.min(ASC.Files.Mouse.mouseSelector.startX,c),top:Math.min(ASC.Files.Mouse.mouseSelector.startY,s),right:Math.max(ASC.Files.Mouse.mouseSelector.startX,c),bottom:Math.max(ASC.Files.Mouse.mouseSelector.startY,s)},jq("#filesSelector").css({width:y+"px",height:p+"px",left:o.left+"px",top:o.top+"px"}),i=n,t.ctrlKey||f(i,o)){for(u=!1,l=ASC.Files.Mouse.mouseSelector.entryItems.length,h=l;h;h--)i=ASC.Files.Mouse.mouseSelector.entryItems[l-h],f(i,o)?s>=n.minVisibleY&&i.bottom>=n.minVisibleY&&(u=ASC.Files.UI.selectRow(i.entryObj,!0)||u):t.ctrlKey||(u=ASC.Files.UI.selectRow(i.entryObj,!1)||u);u&&(clearTimeout(r),r=setTimeout(ASC.Files.UI.updateMainContentHeader,10))}else ASC.Files.UI.checkSelectAll(!1);return e(t),!1},e=function(n){var t=50,i=15;t>Math.abs(n.pageY-document.documentElement.scrollTop)&&window.scrollBy(0,-i);t>Math.abs(n.pageY-(document.documentElement.scrollTop+document.documentElement.clientHeight))&&window.scrollBy(0,i)},y=function(){jq("#filesSelector").remove();ASC.Files.Mouse.mouseSelector.startX=0;ASC.Files.Mouse.mouseSelector.startY=0;ASC.Files.Mouse.mouseSelector.entryItems=[];ASC.Files.Mouse.mouseBtn=!1;ASC.Files.Mouse.disableHover=!1;var n=jq.browser.msie&&jq.browser.version<9?jq("body"):jq(window);n.off("mousemove.MouseSelect mouseup.MouseSelect");jq("body").removeClass("select-action")},p=function(n,t){var i=["#treeViewContainer li:not(.access-read) > a"],r;ASC.Files.Folders.folderContainer!="privacy"&&(i.push(".to-parent-folder"),ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_TRASH&&i.push("#filesMainContent .folder-row:not(.checkloading):not(.new-folder):not(.error-entry):not(.row-selected)"));r=i.join(",");jq(r).each(function(){var i,r=ASC.Files.UI.getObjectData(this),u;r?i=r.entryId:(i=jq(this).attr("data-id"),t&&i==ASC.Files.Constants.FOLDER_ID_TRASH&&(i=null));ASC.Files.Common.isCorrectId(i)&&(u=r?r.entryObject:ASC.Files.UI.getEntryObject("folder",i),i!=ASC.Files.Folders.currentFolder.id&&ASC.Files.UI.accessEdit(r,u)&&(i!=ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.UI.accessEdit())&&jq(this).addClass(n))})},w=function(n,t,i){var r,e,u,f;return(n=jq.fixEvent(n),n.type=="mouseleave")?(jq("."+i).removeClass(i),null):(r=jq("#treeViewContainer").offset().left,e=r+jq("#treeViewContainer")[0].offsetWidth,jq(this).is("#treeViewContainer *")&&(r>n.pageX||e<n.pageX))?null:(f=ASC.Files.UI.getObjectData(t),u=f?f.entryId:jq(t).attr("data-id"),ASC.Files.Common.isCorrectId(u))?(jq(t).addClass(i),u):null},b=function(n){if((n=jq.fixEvent(n),!(n.button==0||jq.browser.msie&&n.button==1))||ASC.Files.Folders.folderContainer=="trash"||ASC.Files.Folders.folderContainer=="privacy"||jq("#treeViewPanelSelector").length==0)return!1;if(jq("#promptRename").length!=0)return!0;ASC.Files.Mouse.moveToX=n.pageX;ASC.Files.Mouse.moveToY=n.pageY;jq("body").off("mouseout.MouseMove mousemove.MouseMove keyup.MouseMove keydown.MouseMove").on("mouseout.MouseMove mousemove.MouseMove",ASC.Files.Mouse.beginMoveTo);return!0},t=null,k=function(){t={entries:jq("#filesMainContent .file-row:has(.checkbox input:checked)"),isCopyTo:!ASC.Files.UI.accessEdit()||!ASC.Files.UI.accessDelete()};t.isCopyTo||!ASC.Files.ThirdParty||ASC.Files.ThirdParty.isThirdParty()||t.entries.each(function(){var n=ASC.Files.UI.getObjectData(this);if(ASC.Files.ThirdParty.isThirdParty(n))return t.isCopyTo=!0,!1})},d=function(n){if(n=jq.fixEvent(n),!(n.button==0||jq.browser.msie&&n.button==1)||ASC.Files.Mouse.mouseBtn==!1)return jq("body").off("mouseout.MouseMove mousemove.MouseMove keyup.MouseMove keydown.MouseMove"),!1;if(Math.abs(n.pageX-ASC.Files.Mouse.moveToX)<5&&Math.abs(n.pageY-ASC.Files.Mouse.moveToY)<5)return!1;ASC.Files.Actions.hideAllActionPanels();k();jq("#contentVersions").removeClass("version-highlight");jq("#filesMainContent .row-hover").removeClass("row-hover");jq(".may-row-to").removeClass("may-row-to");jq("body").addClass("user-select-none file-mouse-move");ASC.Files.Mouse.highlightFolderTo("may-row-to");jq("body").off("mouseout.MouseMove mousemove.MouseMove mouseup.MouseMove keyup.MouseMove keydown.MouseMove").on("mouseout.MouseMove mousemove.MouseMove",ASC.Files.Mouse.continueMoveTo).on("mouseup.MouseMove",ASC.Files.Mouse.finishMoveTo).on("keyup.MouseMove keydown.MouseMove",function(n){n=jq.fixEvent(n);var t=n.keyCode||n.which;return t==ASC.Files.Common.keyCode.ctrl?ASC.Files.Mouse.continueMoveTo(n):!0}).on("mouseenter.MouseMove mouseleave.MouseMove",".may-row-to",ASC.Files.Mouse.checkMoveTo);return!0},g=function(n){var o,f,r,u,i;if(n=jq.fixEvent(n),ASC.Files.Mouse.mouseBtn==!1)return ASC.Files.Mouse.finishMoveTo(n),!0;if(t.isCopyTo||n.ctrlKey?(o=ASC.Files.FilesJSResource.InfoCopyDescribe,jq("body").addClass("file-mouse-copy")):(o=ASC.Files.FilesJSResource.InfoMoveDescribe,jq("body").removeClass("file-mouse-copy")),jq("#filesMovingTooltip").length==0&&jq("#filesMainContent").parent().after('<div id="filesMovingTooltip" class="studio-action-panel"><\/div>'),f=t.entries.length==1?ASC.Files.UI.getObjectTitle(t.entries[0]):ASC.Files.FilesJSResource.InfoCountDescribe.format(t.entries.length),f=o.format(f,"<b>","<\/b>","<br/>"),jq("#filesMovingTooltip").html(f),r=n.target||n.srcElement,jq(r).is("body")||jq("#filesMovingTooltip").css({left:n.pageX+"px",top:n.pageY+"px"}),jq.browser.opera){r=jq(r);r.hasClass("file-row")||(r=jq(r).closest(".file-row"));u="fix_select_text";i=r.children("#"+u);i.length==0&&(jq("#"+u).remove(),i=document.createElement("INPUT"),i.style.width=0,i.style.height=0,i.style.border=0,i.style.margin=0,i.style.padding=0,i.id=u,i.disabled=!0,r.prepend(i),i=jq("#"+u));try{i.trigger("focus")}catch(n){i.disabled=!1;i.trigger("focus");i.disabled=!0}}return e(n),!0},nt=function(n){ASC.Files.Mouse.moveToFolder=ASC.Files.Mouse.getOverFolderId(n,this,"row-to")},tt=function(n){var i,r;n=jq.fixEvent(n);jq("#contentVersions").addClass("version-highlight");jq(".row-to").removeClass("row-to");jq(".may-row-to").removeClass("may-row-to");jq("body").removeClass("user-select-none file-mouse-move file-mouse-copy");i=ASC.Files.Mouse.moveToFolder;ASC.Files.Mouse.moveToFolder=null;ASC.Files.Common.isCorrectId(i)&&(i==ASC.Files.Constants.FOLDER_ID_TRASH?ASC.Files.Folders.deleteItem():(ASC.Files.Folders.isCopyTo=t.isCopyTo||n.ctrlKey,r=ASC.Files.UI.getEntryTitle("folder",i),ASC.Files.Folders.curItemFolderMoveTo(i,r)));ASC.Files.Folders.isCopyTo=!1;jq("body").off("mouseout.MouseMove mousemove.MouseMove mouseup.MouseMove mouseenter.MouseMove mouseleave.MouseMove keyup.MouseMove keydown.MouseMove");jq("#filesMovingTooltip").remove();t=null},it=function(){var n=jq(this);ASC.Files.UI.hideEntryTooltip();n.one("mouseleave",function(){ASC.Files.UI.hideEntryTooltip()});var t=ASC.Files.UI.getObjectData(n),i=t.entryId,r=t.entryType;n.attr("data-title",!0);n.removeAttr("title");ASC.Files.UI.timeTooltip=setTimeout(function(){ASC.Files.UI.displayEntryTooltip(t.entryObject,r,i)},750)};return{init:o,mouseBtn:!1,disableHover:!1,mouseSelector:{startX:0,startY:0,entryItems:[]},moveToX:0,moveToY:0,moveToFolder:"",updateMainContentArea:l,handleMove:s,collectEntryItems:c,beginSelecting:a,continueSelecting:v,finishSelecting:y,preparingMoveTo:b,beginMoveTo:d,continueMoveTo:g,checkMoveTo:nt,finishMoveTo:tt,overCompactTitle:it,highlightFolderTo:p,getOverFolderId:w}}(),function(n){ASC.Files.Mouse.init();n(function(){jq("#filesMainContent").on("mousedown",".file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)",ASC.Files.Mouse.preparingMoveTo);jq("#mainContent").on("mouseover","#filesMainContent.compact .file-row:not(.checkloading):not(.new-folder):not(.new-file) .entry-title .name a, #filesMainContent.thumbnails .file-row:not(.checkloading):not(.new-folder):not(.new-file) .name a",ASC.Files.Mouse.overCompactTitle);jq(document).on("mousedown.MouseSelect","#studioPageContent:has(#filesMainContent .file-row:visible:not(.checkloading):not(.new-folder):not(.new-file))",ASC.Files.Mouse.beginSelecting);jq(document).on("mouseup.Mouse",function(){ASC.Files.Mouse.mouseBtn=!1});jq("#filesMainContent").on("mouseenter mouseleave",".file-row:not(.checkloading)",ASC.Files.Mouse.handleMove);jq(document).on("dragstart",".row-selected a",function(n){n.preventDefault()})})}(jQuery);
window.ASC.Files.Marker=function(){var n=!1,t=function(){if(n===!1){n=!0;ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MarkAsRead,ASC.Files.EventHandler.onGetTasksStatuses);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetNews,ASC.Files.Marker.onGetNews);jq(document).on("click",function(n){jq.dropdownToggle().registerAutoHide(n,".is-new","#filesNewsPanel")})}},i=function(n){return typeof n=="undefined"||n==null?!1:(jq("#studio_sidePanel .page-menu .is-new").hide(),jq(n.childNodes).each(function(n,t){var i=t.childNodes[0],r=t.childNodes[1],f=i.textContent||i.text,u=r.textContent||r.text;u>0&&jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(f)).text(u).show()}),!0)},r=function(n,t){return ASC.Files.Marker.setNewCount(n,t,0)},u=function(n,t,i){var f=!1,o=(i|0)>0,r=ASC.Files.UI.getEntryObject(n,t).find(".is-new");if(r.is(":visible")){var s=n=="file"?-Math.pow(-1,i):i-(r.html()|0),h=ASC.Files.Tree.pathParts[0],u=jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(h)),c=u.html()|0,e=c+s;u.html(e>0?e:0);e>0?u.show():u.hide();o?n=="folder"&&r.html(i):r.remove();f=!0}return n==="folder"&&(r=jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(t)),r.is(":visible")&&(r.html(i>0?i:0),o?r.show():(r.hide(),jq.inArray(t+"",ASC.Files.Tree.pathParts)!=-1&&jq("#filesMainContent .is-new").remove()),f=!0)),f},f=function(n){var t,i={};return(i.entry=[],typeof n=="undefined"?jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)").each(function(){t=ASC.Files.UI.getObjectData(this);t.entryObject.find(".is-new").length>0&&i.entry.push(t.entryType+"_"+t.entryId)}):typeof n=="object"?(t=n,i.entry.push(t.entryType+"_"+t.entryId)):ASC.Files.Common.isCorrectId(n)&&i.entry.push("folder_"+n),i.entry.length==0)?!1:(ASC.Files.ServiceManager.markAsRead(ASC.Files.ServiceManager.events.MarkAsRead,{list:i.entry,doNow:!0},{stringList:i}),!1)},e=function(n,t){var i,r;if(ASC.Files.Actions.hideAllActionPanels(),!ASC.Files.Common.isCorrectId(t)){if(i=ASC.Files.UI.getObjectData(n),i.entryType=="file"){ASC.Files.Marker.markAsRead(i);return}t=i.entryId}r={top:n.offset().top,left:n.offset().left,width:n.width(),height:n.height()};ASC.Files.ServiceManager.getNews(ASC.Files.ServiceManager.events.GetNews,{folderId:t,targetSize:r,showLoading:!0})},o=function(n){var t,i,r,u;for(jq("#studio_sidePanel .page-menu .is-new").hide(),t=0;t<n.length;t++){if(i=ASC.Files.UI.parseItemId(n[t]),i==null){if(n[t].indexOf("new_")==0){var o=n[t].substring(4).replace(/\?/g,":"),f=JSON.parse(o),s=f.key,e=f.value;e>0&&jq("#studio_sidePanel .page-menu .is-new"+ASC.Files.UI.getSelectorId(s)).text(e).show()}continue}r=i.entryType;u=i.entryId;ASC.Files.UI.blockObjectById(i.entryType,i.entryId,!1,null,!0);ASC.Files.Marker.removeNewIcon(r,u);r=="folder"&&jq.inArray(u+"",ASC.Files.Tree.pathParts)!=-1&&jq("#filesMainContent .is-new").remove()}ASC.Files.UI.updateMainContentHeader();ASC.Files.Actions.showActionsViewPanel()},s=function(n,t,i){var u,c;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(u=ASC.Files.TemplateManager.translate(n),u.length){jq("#filesNewsList").html(u);jq("#filesNewsList .file-row").each(function(){var n=ASC.Files.UI.getObjectData(this),e=n.entryId,t=n.entryType,u=n.entryObject,r=n.title,o=t=="file"?ASC.Files.Utility.getCssClassByFileTitle(r,!0):ASC.Files.Utility.getFolderCssClass(!0),i,f;u.find(".thumb-img, .thumb-"+t).addClass(o);i=u.find(".entry-title .name a");t=="file"&&i.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(i,r);f=ASC.Files.UI.getEntryLink(t,e,r);i.attr("href",f).attr("target","_blank")});var r=t.targetSize,e=jq("#filesNewsPanel"),o=8,f=r.top+r.height+o,s=0,h=e.outerHeight();document.body.clientHeight-(f-pageYOffset+h)<0&&(f=r.top-o,s=h);e.css({top:f-s,left:r.left}).toggle().attr("data-id",t.folderId);c=jq("#filesNewsList .file-row").length;ASC.Files.Marker.setNewCount("folder",t.folderId,c)}else ASC.Files.Marker.removeNewIcon("folder",t.folderId)};return{init:t,removeNewIcon:r,setNewCount:u,markAsRead:f,markRootAsNew:i,getNews:e,onMarkAsRead:o,onGetNews:s}}(),function(n){n(function(){ASC.Files.Marker.init();jq(document).on("click",".is-new",function(){var n=jq(this),t=n.attr("data-id");return ASC.Files.Marker.getNews(n,t),!1});jq("#studioPageContent").on("click","#buttonMarkRead, #mainMarkRead.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Marker.markAsRead()});jq("#filesNewsMarkRead").on("click",function(){ASC.Files.Actions.hideAllActionPanels();var n=jq("#filesNewsPanel").attr("data-id");ASC.Files.Marker.markAsRead(n)});jq("#filesNewsList").on("click",".folder-row:not(.error-entry) .entry-title .name a, .folder-row:not(.error-entry) .thumb-folder",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this).id;return ASC.Files.Folders.clickOnFolder(n),!1});jq("#filesNewsList").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file",function(){var r=ASC.Files.UI.getObjectData(this),o=!0,u,i,n,t,f;if(ASC.Files.MediaPlayer&&(ASC.Files.MediaPlayer.canPlay(r.title)||ASC.Files.Utility.CanImageView(r.title))){ASC.Files.Actions.hideAllActionPanels();var s=jq("#filesNewsList .file-row:not(.folder-row):not(.error-entry)").map(function(n,t){return ASC.Files.UI.getObjectData(t)}),e=[],h=0;for(u=0;u<s.length;u++)i=s[u],(ASC.Files.MediaPlayer.canPlay(i.title)||ASC.Files.Utility.CanImageView(i.title))&&(e.push(i),r.id===i.id&&(h=e.length-1));n=jq("#filesNewsPanel").attr("data-id");t=jq(".is-new"+ASC.Files.UI.getSelectorId(n));ASC.Files.MediaPlayer.init(-1,{playlist:e,playlistPos:h,onCloseAction:function(n){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.navigationSet(n,!1);return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!0)},onMediaChangedAction:function(i){var r=jq("#filesNewsList "+ASC.Files.UI.getSelectorId(i)),e=ASC.Files.UI.getEntryObject("file",i).find(".is-new"),u;!e.is(":visible")&&r.length&&(t.is(":visible")||(t=ASC.Files.UI.getEntryObject("folder",n).find(".is-new")),f=t.html()|0,ASC.Files.Marker.setNewCount("folder",n,f-1));ASC.Files.Marker.removeNewIcon("file",i);r.length&&ASC.Files.UI.getObjectData(r).entryObject.remove();u=ASC.Files.MediaPlayer.getPlayHash(i);ASC.Files.Anchor.move(u,!0)},downloadAction:ASC.Files.Utility.GetFileDownloadUrl})}else o=ASC.Files.Folders.clickOnFile(r);return o||(n=jq("#filesNewsPanel").attr("data-id"),t=jq(".is-new"+ASC.Files.UI.getSelectorId(n)),t.is(":visible")||(t=ASC.Files.UI.getEntryObject("folder",n).find(".is-new")),f=t.html()|0,ASC.Files.Marker.setNewCount("folder",n,f-1)),!1})})}(jQuery);
window.ASC.Files.Actions=function(){var n=!1,u=function(){if(n===!1){n=!0;jq(document).on("click",function(n){jq.dropdownToggle().registerAutoHide(n,"#filesActionsPanel","#filesActionsPanel",function(){ASC.Files.Mouse.disableHover=!1});jq.dropdownToggle().registerAutoHide(n,".row-selected .menu-small","#filesActionPanel",function(){jq(".row-selected .menu-small.active").removeClass("active");jq(".row-selected.row-lonely-select").removeClass("row-lonely-select");ASC.Files.Mouse.disableHover=!1})});jq.dropdownToggle({switcherSelector:"#mainContentHeader .menuActionSelectAll",dropdownID:"filesSelectorPanel",anchorSelector:".menuActionSelectAll",addTop:4});jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"filesVersionPanel",sideToggle:!0,switcherSelector:"#filesVersion",toggleOnOver:!0});jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"filesMovePanel",sideToggle:!0,switcherSelector:"#filesMove",toggleOnOver:!0});jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"foldersMovePanel",sideToggle:!0,switcherSelector:"#foldersMove",toggleOnOver:!0});ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFileSharedInfo,h);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceFileLink,a)}},t=function(n){f(n);e()},f=function(n){var u=!!n.find(".dropdown-item.first-section:visible").length,r=!!n.find(".dropdown-item.second-section:visible").length,t=!!n.find(".dropdown-item.third-section:visible").length,i=!!n.find(".dropdown-item.fourth-section:visible").length;n.find(".dropdown-item-seporator.first-section").toggle(u&&(r||t||i));n.find(".dropdown-item-seporator.second-section").toggle(r&&(t||i));n.find(".dropdown-item-seporator.third-section").toggle(t&&i)},i=function(n){var u=n.find(".dropdown-content:not(.display-none)").filter(function(n,t){return t.style.display!="none"}),r=u.length>0?u[0]:null,t,i;r&&(r.style.minWidth||(t=n.clone().appendTo("body"),t.show().removeClass("display-none"),i=t.find(".dropdown-content:visible"),i.css({overflow:"auto",maxHeight:"none"}),i.find("li").show().removeClass("display-none"),jq(r).css({minWidth:i.width()}),t.remove()))},e=function(){var n=jq("#filesGetLink:visible, #foldersGetLink:visible").first();n.length&&o(n.attr("id"));jq("#filesGetExternalLink").is(":visible")&&s()},o=function(n){var t=ASC.Files.Actions.currentEntryData.entryObject.find(".entry-title .name a").prop("href");ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink);ASC.Files.Actions.clipGetLink=ASC.Clipboard.create(t,n,{onComplete:function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess);ASC.Files.Actions.hideAllActionPanels()}})},s=function(){ASC.Files.ServiceManager.getSharedInfo(ASC.Files.ServiceManager.events.GetFileSharedInfo,{showLoading:!0},{stringList:{entry:[ASC.Files.Actions.currentEntryData.entryType+"_"+ASC.Files.Actions.currentEntryData.id]}})},h=function(n,t,i){var f,r,u;if(i){ASC.Files.UI.displayInfoPanel(i,!0);return}f=n.some(function(n){return n.ace_status==ASC.Files.Constants.AceStatusEnum.FillForms});!1&&f&&jq("#filesFormFillingSettings").show().removeClass("display-none");r=n[0];u=jq("#filesGetExternalLink .toggle");u.toggleClass("off",r.ace_status==ASC.Files.Constants.AceStatusEnum.Restrict);ASC.Files.Actions.clipGetExternalLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetExternalLink);ASC.Files.Actions.clipGetExternalLink=ASC.Clipboard.create(r.link,"filesGetExternalLink",{onComplete:function(){u.hasClass("off")&&ASC.Files.Actions.setAceFileLink();ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess);ASC.Files.Actions.clipGetExternalLink.fromToggleBtn||ASC.Files.Actions.hideAllActionPanels();ASC.Files.Actions.clipGetExternalLink.fromToggleBtn=!1}})},c=function(n){var e=function(n){var t=[ASC.Files.Constants.AceStatusEnum.Read];return ASC.Files.Utility.CanWebEdit(n)&&!ASC.Files.Utility.MustConvert(n)&&t.push(ASC.Files.Constants.AceStatusEnum.ReadWrite),ASC.Files.Utility.CanWebCustomFilterEditing(n)&&t.push(ASC.Files.Constants.AceStatusEnum.CustomFilter),ASC.Files.Utility.CanWebReview(n)&&t.push(ASC.Files.Constants.AceStatusEnum.Review),ASC.Files.Utility.CanWebRestrictedEditing(n)&&t.push(ASC.Files.Constants.AceStatusEnum.FillForms),ASC.Files.Utility.CanWebComment(n)&&t.push(ASC.Files.Constants.AceStatusEnum.Comment),t},t=jq("#defaultAccessRightsSetting"),i,r,u,f;if(t.length){i=+t.find("input[type=radio]:checked").val();r=[];t.find("input[type=checkbox]:checked").each(function(){r.push(+this.value)});u=e(n);for(f of u)if(r.indexOf(f)!=-1)return f;if(u.indexOf(i)!=-1)return i}return ASC.Files.Constants.AceStatusEnum.Read},l=function(){ASC.Files.ServiceManager.setAceLink(ASC.Files.ServiceManager.events.SetAceFileLink,{showLoading:!0,fileId:ASC.Files.Actions.currentEntryData.entryId,share:jq("#filesGetExternalLink .toggle").hasClass("off")?c(ASC.Files.Actions.currentEntryData.title):ASC.Files.Constants.AceStatusEnum.Restrict})},a=function(n,t,i){if(i){ASC.Files.UI.displayInfoPanel(i,!0);return}jq("#filesGetExternalLink .toggle").toggleClass("off");ASC.Files.Actions.currentEntryData.entryObject.toggleClass("__active",n)},v=function(n){var o,p;jq("#buttonUnsubscribe, #buttonDelete, #buttonMoveto, #buttonCopyto, #buttonShare, #buttonMarkRead, #buttonSendInEmail, #buttonAddFaforite, #buttonDownload, #buttonConvert").hide();jq("#mainContentHeader .unlockAction").removeClass("unlockAction");var f=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)"),u=f.length,b=f.filter(":not(.folder-row)").length,l=0;ASC.Files.Tree.displayFavorites()&&ASC.Files.Folders.folderContainer!="trash"&&ASC.Files.Folders.folderContainer!="privacy"&&(l=f.filter(":not(.on-favorite)").length);o=0;ASC.Files.Tree.displayFavorites()&&ASC.Files.Folders.folderContainer!="trash"&&ASC.Files.Folders.folderContainer!="privacy"&&(o=f.filter(".on-favorite").length);var a=u,v=0,y=ASC.Files.ThirdParty&&!ASC.Files.ThirdParty.isThirdParty(),w=0,s=!1,h=0,e=0;if(f.each(function(){var t=jq(this),n,i,r,u;(ASC.Files.UI.editingFile(t)||!ASC.Files.UI.accessDelete(t)||ASC.Files.UI.lockedForMe(t))&&a--;t.find(".is-new:visible").length>0&&v++;n=ASC.Files.UI.getObjectData(t);ASC.Files.ThirdParty?!ASC.Files.ThirdParty.isThirdParty()&&ASC.Files.ThirdParty.isThirdParty(n)?w++:y=!1:y=!1;i=ASC.Files.UI.denyDownload(n);i&&e++;s||t.hasClass("folder-row")||(r=n.title,u=ASC.Files.Utility.GetConvertFormats(r),s=u.length>0&&!n.encrypted&&n.content_length<=ASC.Files.Constants.AvailableFileSize&&!i);!ASC.Resources.Master.Personal&&t.is(":not(.without-share)")&&ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable&&!ASC.Files.UI.denySharing(n)&&(!n.encrypted||ASC.Files.Folders.folderContainer=="privacy"&&ASC.Files.Utility.CanWebEncrypt(n.title)&&ASC.Desktop&&ASC.Desktop.setAccess)&&h++}),u>0&&(u-e>0&&(jq("#buttonDownload, #buttonCopyto").show().find("span").html(u-e),jq("#mainDownload, #mainCopy").addClass("unlockAction")),jq("#buttonRemoveTemplate, #buttonUnsubscribe, #buttonRestore").show().find("span").html(u),jq("#mainRemoveFavorite, #mainRemoveTemplate, #mainUnsubscribe, #mainRestore").addClass("unlockAction"),ASC.Files.Folders.folderContainer=="privacy"&&jq("#buttonCopyto").hide(),ASC.Files.Folders.folderContainer!="forme"&&jq("#buttonUnsubscribe").hide(),ASC.Files.Folders.folderContainer=="favorites"&&jq("#buttonMoveto").hide(),ASC.Files.Folders.folderContainer=="templates"?jq("#buttonMoveto").hide():jq("#buttonRemoveTemplate").hide()),p=b-e,p>0&&(h>0||ASC.Files.Folders.folderContainer=="project")&&jq("#buttonSendInEmail").show().find("span").html(p),l>0?jq("#buttonAddFavorite").show().find("span").html(l):jq("#buttonAddFavorite").hide(),o>0?jq("#buttonRemoveFavorite").show().find("span").html(o):jq("#buttonRemoveFavorite").hide(),s?jq("#buttonConvert").show().find("span").html(u-e):jq("#buttonConvert").hide(),jq("#mainConvert").toggleClass("unlockAction",s),v>0&&(jq("#buttonMarkRead").show().find("span").html(v),jq("#mainMarkRead").addClass("unlockAction")),a>0&&(jq("#buttonDelete, #buttonMoveto").show().find("span").html(a-w),jq("#mainDelete, #mainMove").addClass("unlockAction")),ASC.Files.Folders.folderContainer=="trash"&&(jq("#buttonDelete, #buttonMoveto, #buttonCopyto, #buttonMarkRead").hide(),jq("#mainDelete, #mainMove, #mainCopy").removeClass("unlockAction")),jq("#buttonRestore, #buttonEmptyTrash").hide(),jq("#mainRestore, #mainEmptyTrash").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"?(u>0?(jq("#buttonDownload, #buttonDelete, #buttonRestore").show(),jq("#mainDownload, #mainDelete, #mainRestore").addClass("unlockAction")):(jq("#buttonDownload, #buttonConvert").hide(),jq("#mainDownload, #mainConvert").removeClass("unlockAction")),jq("#buttonEmptyTrash").show(),jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Folders.folderContainer!="project"&&ASC.Files.Folders.folderContainer!="privacy"&&h>0&&(jq("#buttonShare").show().find("span").html(h),jq("#mainShare").addClass("unlockAction")),y&&(jq("#buttonDelete, #buttonMoveto").hide(),jq("#mainDelete, #mainMove").removeClass("unlockAction")),typeof n!="undefined"){var c=jq.fixEvent(n),r=jq("#filesActionsPanel"),k=document.body.clientWidth-(c.pageX-pageXOffset+r.innerWidth())>0?0:r.innerWidth(),d=document.body.clientHeight-(c.pageY-pageYOffset+r.innerHeight())>0?0:r.innerHeight();r.css({top:c.pageY-d,left:c.pageX-k});i(r);r.toggle();t(r);ASC.Files.Mouse.disableHover=!0}},y=function(n,r){var o,e,u,f,l,h,c;if(ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink),o=jq.fixEvent(n),e=jq(o.srcElement||o.target),e.hasClass("active"))return ASC.Files.Actions.hideAllActionPanels(),!0;if(r=r||ASC.Files.UI.getObjectData(e),u=r.entryObject,u.is(".loading"))return!0;ASC.Files.Actions.currentEntryData=r;ASC.Files.UI.checkSelectAll(!1);ASC.Files.UI.selectRow(u,!0);ASC.Files.UI.updateMainContentHeader();var a=ASC.Files.UI.accessEdit(r,u),s=ASC.Files.UI.accessDelete(u),v=Teamlab.profile.isVisitor===!0;return jq("#actionPanelFolders, #actionPanelFiles").hide(),r.entryType==="file"?(jq("#filesOpen,                #filesGotoParent,                #filesEdit,                #filesFillForm,                #filesCreateForm,                #filesByTemplate,                #filesConvert,                #filesDownload,                #filesGetLink,                #filesShareAccess,                #filesGetExternalLink,                #filesChangeOwner,                #filesSendInEmail,                #filesLock,                #filesUnlock,                #filesDocuSign,                #filesUnsubscribe,                #filesVersion,                #filesCompleteVersion,                #filesVersions,                #filesMove,                #filesMoveto,                #filesCopyto,                #filesCopy,                #filesMarkRead,                #filesAddFavorite,                #filesRemoveFavorite,                #filesAddTemplate,                #filesRemoveTemplate,                #filesRename,                #filesRestore,                #filesRemove").show().removeClass("display-none"),f=r.title,ASC.Files.UI.denyDownload(r)&&jq("#filesDownload, #filesConvert, #filesSendInEmail, #filesMoveto, #filesCopyto, #filesCopy").hide().addClass("display-none"),(!ASC.Files.Utility.GetConvertFormats(f).length||r.encrypted||r.content_length>ASC.Files.Constants.AvailableFileSize)&&jq("#filesConvert").hide().addClass("display-none"),ASC.Files.Utility.CanWebView(f)||typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(f)||typeof ASC.Files.MediaPlayer!="undefined"&&ASC.Files.MediaPlayer.canPlay(f,!0)||jq("#filesOpen").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.thirdpartyAvailable()&&jq.inArray(ASC.Files.Utility.GetFileExtension(f),ASC.Files.Constants.DocuSignFormats)!=-1&&!r.encrypted&&jq("#thirdpartyToDocuSign").length+jq("#thirdpartyToDocuSignHelper").length!=0||jq("#filesDocuSign").hide(),(u.find("#contentVersions").length!=0||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty())&&jq("#filesVersions").hide().addClass("display-none"),l=ASC.Files.UI.editingFile(u),l&&(jq("#filesCompleteVersion,                    #filesMoveto,                    #filesRemove").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()&&jq("#filesRename").hide()),u.hasClass("on-favorite")?jq("#filesAddFavorite").hide().addClass("display-none"):(jq("#filesRemoveFavorite").hide().addClass("display-none"),ASC.Files.Tree.displayFavorites()||jq("#filesAddFavorite").hide().addClass("display-none")),ASC.Files.Folders.folderContainer=="favorites"&&jq("#filesMoveto,                    #filesRemove").hide().addClass("display-none"),u.hasClass("is-template")?jq("#filesAddTemplate").hide().addClass("display-none"):(jq("#filesByTemplate, #filesRemoveTemplate").hide().addClass("display-none"),ASC.Files.Tree.displayTemplates()&&ASC.Files.Utility.CanBeTemplate(f)||jq("#filesAddTemplate").hide().addClass("display-none")),ASC.Files.Folders.folderContainer=="templates"&&jq("#filesMoveto,                    #filesRemove").hide().addClass("display-none"),h=ASC.Files.UI.lockedForMe(u),!ASC.Files.UI.editableFile(r)||l&&(!ASC.Files.Utility.CanCoAuhtoring(f)||u.hasClass("on-edit-alone"))||h?jq("#filesEdit,                    #filesFillForm,                    #filesCreateForm").hide().addClass("display-none"):ASC.Files.Utility.CanWebRestrictedEditing(f)&&!r.encrypted?jq("#filesEdit, #filesCreateForm").hide().addClass("display-none"):(jq("#filesFillForm").hide().addClass("display-none"),ASC.Files.Utility.FileIsMasterForm(f)||jq("#filesCreateForm").hide().addClass("display-none")),r.encrypted&&jq("#filesEdit,                    #filesFillForm,                    #filesCreateForm,                    #filesOpen,                    #filesGetLink,                    #filesGetExternalLink,                    #filesSendInEmail,                    #filesCompleteVersion,                    #filesLock,                    #filesUnlock,                    #filesAddTemplate,                    #filesCopyto,                    #filesCopy,                    #filesByTemplate,                    #filesAddFavorite").hide().addClass("display-none"),u.hasClass("file-locked")?jq("#filesLock").hide().addClass("display-none"):jq("#filesUnlock").hide().addClass("display-none"),ASC.Files.Folders.folderContainer=="trash"?jq("#filesOpen,                    #filesGotoParent,                    #filesEdit,                    #filesFillForm,                    #filesCreateForm,                    #filesByTemplate,                    #filesGetLink,                    #filesShareAccess,                    #filesGetExternalLink,                    #filesSendInEmail,                    #filesCompleteVersion,                    #filesLock,                    #filesUnlock,                    #filesDocuSign,                    #filesVersions,                    #filesMoveto,                    #filesCopyto,                    #filesMarkRead,                    #filesAddFavorite,                    #filesRemoveFavorite,                    #filesAddTemplate,                    #filesRemoveTemplate,                    #filesRename").hide().addClass("display-none"):jq("#filesRestore").hide().addClass("display-none"),(!a||h)&&(jq("#filesCompleteVersion,                    #filesRename,                    #filesLock").hide().addClass("display-none"),ASC.Files.Constants.ADMIN||ASC.Files.Folders.folderContainer=="my"||jq("#filesUnlock").hide().addClass("display-none")),v&&(jq("#filesByTemplate,                    #filesLock,                    #filesDocuSign,                    #filesCompleteVersion,                    #filesAddFavorite,                    #filesRemoveFavorite,                    #filesAddTemplate,                    #filesRemoveTemplate").hide().addClass("display-none"),s||jq("#filesRename").hide().addClass("display-none")),ASC.Files.Folders.folderContainer!="corporate"&&jq("#filesChangeOwner").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(r)&&jq("#filesChangeOwner,                    #filesCompleteVersion,                    #filesCopy").hide().addClass("display-none"),(!s||h)&&jq("#filesChangeOwner,                    #filesMoveto,                    #filesRemove").hide().addClass("display-none"),u.is(".without-share *:not(.can-share), .without-share")||ASC.Files.UI.denySharing(r)?(jq("#filesShareAccess").hide().addClass("display-none"),jq("#filesGetExternalLink").hide().addClass("display-none")):jq("#filesGetExternalLink").data("trial")&&!ASC.Files.Utility.CanWebView(f)&&jq("#filesGetExternalLink").hide().addClass("display-none"),u.find(".is-new:visible").length==0&&jq("#filesMarkRead").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="forme"&&(ASC.Files.Folders.folderContainer!="privacy"||s)&&jq("#filesUnsubscribe").hide().addClass("display-none"),ASC.Files.UI.accessEdit()||(jq("#filesCopy").hide().addClass("display-none"),jq("#filesCreateForm").hide().addClass("display-none")),ASC.Files.Folders.folderContainer!="favorites"&&ASC.Files.Folders.folderContainer!="templates"&&ASC.Files.Folders.folderContainer!="recent"&&(!ASC.Files.Filter||!ASC.Files.Filter.getFilterSettings().isSet||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty())&&jq("#filesGotoParent").hide().addClass("display-none"),jq("#filesVersionPanel li:not(.display-none)").length||jq("#filesVersion").hide().addClass("display-none"),jq("#filesMovePanel li:not(.display-none)").length||jq("#filesMove").hide().addClass("display-none"),jq("#filesFormFillingSettings").hide().addClass("display-none"),jq("#actionPanelFiles").show()):(jq("#foldersOpen,                #foldersGotoParent,                #foldersDownload,                #foldersGetLink,                #foldersShareAccess,                #foldersChangeOwner,                #foldersUnsubscribe,                #foldersMove,                #foldersMoveto,                #foldersCopyto,                #foldersMarkRead,                #foldersRename,                #foldersAddFavorite,                #foldersRemoveFavorite,                #foldersRestore,                #foldersRemove,                #foldersRemoveThirdparty,                #foldersChangeThirdparty").show().removeClass("display-none"),ASC.Files.UI.denyDownload(r)&&jq("#foldersDownload, #foldersMove, #foldersMoveto, #foldersCopyto").hide().addClass("display-none"),ASC.Files.Folders.folderContainer=="privacy"&&jq("#foldersCopyto, #foldersAddFavorite, #foldersRemoveFavorite, #foldersGetLink").hide().addClass("display-none"),u.hasClass("on-favorite")?jq("#foldersAddFavorite").hide().addClass("display-none"):(jq("#foldersRemoveFavorite").hide().addClass("display-none"),ASC.Files.Tree.displayFavorites()||jq("#foldersAddFavorite").hide().addClass("display-none")),ASC.Files.Folders.folderContainer=="trash"?jq("#foldersOpen,                    #foldersGotoParent,                    #foldersGetLink,                    #foldersShareAccess,                    #foldersMove,                    #foldersMoveto,                    #foldersCopyto,                    #foldersMarkRead,                    #foldersAddFavorite,                    #foldersRemoveFavorite,                    #foldersRename").hide().addClass("display-none"):jq("#foldersRestore").hide().addClass("display-none"),a&&ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT||jq("#foldersRename,                    #foldersRemoveThirdparty,                    #foldersChangeThirdparty").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="corporate"&&jq("#foldersChangeOwner").hide().addClass("display-none"),s||(jq("#foldersChangeOwner,                    #foldersMoveto,                    #foldersRemove,                    #foldersRemoveThirdparty,                    #foldersChangeThirdparty").hide().addClass("display-none"),v&&jq("#foldersRename").hide().addClass("display-none")),(u.is(".without-share *:not(.can-share), .without-share")||ASC.Files.UI.denySharing(r))&&jq("#foldersShareAccess").hide().addClass("display-none"),u.find(".is-new:visible").length==0&&jq("#foldersMarkRead").hide().addClass("display-none"),ASC.Files.Folders.folderContainer!="forme"&&jq("#foldersUnsubscribe").hide().addClass("display-none"),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(r)?(jq("#foldersChangeOwner").hide().addClass("display-none"),ASC.Files.ThirdParty.isThirdParty()||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_SHARE?jq("#foldersRemoveThirdparty,                        #foldersChangeThirdparty").hide().addClass("display-none"):(ASC.Desktop&&jq("#foldersRemoveThirdparty,                        #foldersChangeThirdparty").hide().addClass("display-none"),r.create_by_id!=Teamlab.profile.id&&jq("#foldersChangeThirdparty").hide().addClass("display-none"),jq("#foldersRemove,                        #foldersMoveto").hide().addClass("display-none"),r.error&&jq("#foldersOpen,                            #foldersDownload,                            #foldersCopyto,                            #foldersRename").hide().addClass("display-none"))):jq("#foldersRemoveThirdparty,                    #foldersChangeThirdparty").hide().addClass("display-none"),(!ASC.Files.Filter||!ASC.Files.Filter.getFilterSettings().isSet||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty())&&jq("#foldersGotoParent").hide().addClass("display-none"),ASC.Files.Folders.folderContainer=="favorites"&&jq("#foldersGotoParent").show().removeClass("display-none"),jq("#foldersMovePanel li:not(.display-none)").length||jq("#foldersMove").hide().addClass("display-none"),jq("#actionPanelFolders").show()),ASC.Clipboard.enable||jq("#filesGetLink, #foldersGetLink").remove(),c=jq("#filesActionPanel"),i(c),jq.showDropDownByContext(o,e,c,function(){ASC.Files.Mouse.disableHover=!0}),t(c),e.is(".menu-small")&&u.addClass("row-lonely-select"),!0},p=function(n){var r=jq.fixEvent(n),t,u,i,f;return typeof r=="undefined"||!r?!0:(t=jq(r.srcElement||r.target),t.is("input[type=text]"))?!0:t.parents(".studio-action-panel").length?!ASC.Desktop:(ASC.Files.Actions.hideAllActionPanels(),!t.parents("#filesMainContent").length)?!ASC.Desktop:(u=ASC.Files.UI.getObjectData(t),!u)?t.is("a[href]")?!0:!1:(i=u.entryObject,i.hasClass("new-folder")||i.hasClass("row-rename")||i.hasClass("error-entry"))?!0:(jq("#filesMainContent .row-hover").removeClass("row-hover"),jq("#filesMainContent .row-lonely-select").removeClass("row-lonely-select"),jq("#filesMainContent .menu-small").removeClass("active"),f=jq("#filesMainContent .file-row.row-selected").length,f>1&&i.hasClass("row-selected")?ASC.Files.Actions.showActionsViewPanel(n):ASC.Files.Actions.showActionsPanel(n,u),!1)},w=function(){ASC.Files.Actions.clipGetLink=ASC.Clipboard.destroy(ASC.Files.Actions.clipGetLink);jq(".studio-action-panel:visible").hide();jq("#filesMainContent .file-row.row-lonely-select").removeClass("row-lonely-select");jq("#filesMainContent .file-row .menu-small").removeClass("active");ASC.Files.UI.hideEntryTooltip();ASC.Files.Mouse.disableHover=!1},b=function(n,t){var i=n.createElement("iframe");return i.src=t,i.id="hiddenIframe",i.style.display="none",n.body.appendChild(i),i},r=function(n){var t=document.querySelector("#hiddenIframe");t||(t=b(document,"about:blank"));t.contentWindow.location.href=n},k=function(n,t,i){var u=ASC.Files.Utility.GetFileWebEditorUrl(n),e=ASC.Files.Utility.GetFileCustomProtocolEditorUrl(n),o=ASC.Files.Utility.GetOpenPrivate(n),f;i.length||(i=jq("#filesNewsList "+ASC.Files.UI.getSelectorId(n)));f=ASC.Files.UI.getObjectData(i);!ASC.Desktop&&f&&f.encrypted?t&&t.location?t.location.href=u:localStorage.getItem("protocoldetector")==1?r(e):window.open(o,"_blank"):t&&t.location?t.location.href=u:t=window.open(u,"_blank")},d=function(n,t){var i=ASC.Files.UI.getEntryObject("file",n),r,f,u;if(ASC.Files.UI.lockEditFile(i,!0),k(n,t,i),r=function(){var t=n;t&&(ASC.Files.UI.lockEditFileById(t,!0),ASC.Files.UI.checkEditing(),ASC.Files.Socket.subscribeChangeEditors(t))},t==undefined)ASC.Files.UI.lockEditFile(i,!0),ASC.Files.Socket.subscribeChangeEditors(n),ASC.Files.UI.checkEditingDefer();else{try{t.onload=r;jq.browser.msie&&(u=function(){f=t.document.getElementsByTagName("body");f[0]==null?setTimeout(u,10):r()},u())}catch(e){}try{t.onunload=function(){n&&ASC.Files.UI.checkEditing()}}catch(e){}}return ASC.Files.Marker.removeNewIcon("file",n)},g=function(n,t){var i=ASC.Files.Utility.GetFileWebViewerUrl(n,t),s=ASC.Files.UI.getEntryObject("file",n),f=ASC.Files.UI.getObjectData(s),u,e,o;return!ASC.Desktop&&f&&f.encrypted?(u=i.slice(i.indexOf("&")),localStorage.getItem("protocoldetector")==1?(e=ASC.Files.Utility.GetFileCustomProtocolEditorUrl(n)+u,r(e)):(o=ASC.Files.Utility.GetOpenPrivate(n)+u,window.open(o,"_blank"))):window.open(i,"_blank"),ASC.Files.Marker.removeNewIcon("file",n)},nt=function(n){if(ASC.Files.Folders.isCopyTo=n===!0,ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.folderContainer!="trash"&&!ASC.Files.Folders.isCopyTo&&!ASC.Files.UI.accessEdit()){var t=jq.grep(jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)"),function(n){return ASC.Files.UI.accessDelete(n)});if(!t.length){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoMoveGroup.format(0));return}}if(ASC.Files.Tree.updateTreePath(),!n&&jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.on-edit):has(.checkbox input:checked)").length==0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoMoveGroup.format(0));return}if(ASC.Files.ThirdParty&&!ASC.Files.Folders.isCopyTo&&!ASC.Files.ThirdParty.isThirdParty()&&jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.third-party-entry):has(.checkbox input:checked)").length==0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoMoveGroup.format(0));return}if(jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").length!=0){jq("#treeViewPanelSelector").removeClass("without-third-party");jq("#treeViewPanelSelector").next().is("#mainContentHeader")||jq("#treeViewPanelSelector").insertBefore("#mainContentHeader");ASC.Files.Tree.showSelect(ASC.Files.Folders.currentFolder.id);jq.dropdownToggle().toggle(".menuActionSelectAll","treeViewPanelSelector");jq("#treeViewPanelSelector").scrollTo(jq("#treeViewPanelSelector").find(".tree-node"+ASC.Files.UI.getSelectorId(ASC.Files.Folders.currentFolder.id)));jq("body").on("click",ASC.Files.Actions.registerHideTree)}},tt=function(n){jq(n.target?n.target:n.srcElement).parents().addBack().is("#treeViewPanelSelector, #foldersMoveto, #filesMoveto, #foldersCopyto, #filesCopyto,                 #foldersRestore, #filesRestore, #buttonMoveto, #buttonCopyto, #buttonRestore,                 #mainMove, #mainCopy, #mainRestore")||(ASC.Files.Actions.hideAllActionPanels(),jq("body").off("click",ASC.Files.Actions.registerHideTree))};return{init:u,showActionsViewPanel:v,showActionsPanel:y,onContextMenu:p,checkEditFile:d,checkViewFile:g,hideAllActionPanels:w,clipGetLink:null,clipGetExternalLink:null,currentEntryData:null,showMoveToSelector:nt,registerHideTree:tt,setAceFileLink:l}}(),function(n){ASC.Files.Actions.init();n(function(){jq("#filesSelectAll").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.checkSelectAll(!0)});jq("#filesSelectFile, #filesSelectFolder, #filesSelectDocument,            #filesSelectPresentation, #filesSelectSpreadsheet, #filesSelectImage, #filesSelectMedia, #filesSelectArchive").on("click",function(){var n=this.id.replace("filesSelect","").toLowerCase();ASC.Files.UI.checkSelect(n)});jq("#filesDownload, #foldersDownload").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.download(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesRename, #foldersRename").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.rename(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesAddFavorite, #filesRemoveFavorite, #foldersAddFavorite, #foldersRemoveFavorite").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.toggleFavorite(ASC.Files.Actions.currentEntryData.entryObject)});jq("#filesAddTemplate, #filesRemoveTemplate").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.toggleTemplate(ASC.Files.Actions.currentEntryData.entryObject)});jq("#filesRemove, #foldersRemove").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.deleteItem(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesShareAccess, #foldersShareAccess").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.denySharing(ASC.Files.Actions.currentEntryData)||ASC.Files.Share.getSharedInfo(ASC.Files.Actions.currentEntryData.entryType+"_"+ASC.Files.Actions.currentEntryData.id,ASC.Files.Actions.currentEntryData.title)});jq("#filesFormFillingSettings").on("click",function(){window.ASC.Files.FormFilling.setFileId(ASC.Files.Actions.currentEntryData.id);window.ASC.Files.FormFilling.getPropertiesAndShowDialog()});jq("#filesGetExternalLink .toggle").on("click",function(n){ASC.Files.UI.denySharing(ASC.Files.Actions.currentEntryData)||(jq(this).hasClass("off")?ASC.Files.Actions.clipGetExternalLink.fromToggleBtn=!0:(n.stopPropagation(),ASC.Files.Actions.setAceFileLink()))});jq("#filesMarkRead, #foldersMarkRead").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Marker.markAsRead(ASC.Files.Actions.currentEntryData)});jq("#filesChangeOwner, #foldersChangeOwner").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.changeOwnerDialog(ASC.Files.Actions.currentEntryData)});jq("#filesSendInEmail").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.denyDownload(ASC.Files.Actions.currentEntryData)||(window.location.href=ASC.Mail.Utility.GetDraftUrl(ASC.Files.Actions.currentEntryData.entryId))});jq("#studioPageContent").on("click","#buttonSendInEmail",function(){ASC.Files.Actions.hideAllActionPanels();var n=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.folder-row):has(.checkbox input:checked)").map(function(){var n=ASC.Files.UI.getObjectData(this);return ASC.Files.UI.denyDownload(n)?0:n.entryId}).filter(function(n,t){return t>0});window.location.href=ASC.Mail.Utility.GetDraftUrl(n.get())});jq("#filesUnsubscribe, #foldersUnsubscribe").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Share.unSubscribeMe(ASC.Files.Actions.currentEntryData.entryType,ASC.Files.Actions.currentEntryData.id)});jq("#filesConvert").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Converter.showToConvert(ASC.Files.Actions.currentEntryData.entryObject)});jq("#filesOpen").on("click",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.clickOnFile(ASC.Files.Actions.currentEntryData,!1),!1});jq("#filesLock, #filesUnlock").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.lockFile(ASC.Files.Actions.currentEntryData.entryObject,ASC.Files.Actions.currentEntryData.id)});jq("#filesLock .toggle, #filesUnlock .toggle").on("click",function(n){n.stopPropagation();jq("#filesLock, #filesUnlock").toggle();ASC.Files.Folders.lockFile(ASC.Files.Actions.currentEntryData.entryObject,ASC.Files.Actions.currentEntryData.id)});jq("#filesCompleteVersion").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.versionComplete(ASC.Files.Actions.currentEntryData.id,0,!1)});jq("#filesVersions").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.showVersions(ASC.Files.Actions.currentEntryData.entryObject,ASC.Files.Actions.currentEntryData.id)});jq("#filesEdit, #filesFillForm").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.clickOnFile(ASC.Files.Actions.currentEntryData,!0)});jq("#filesCreateForm").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.createNewForm(ASC.Files.Actions.currentEntryData)});jq("#filesByTemplate").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.createNewDoc(ASC.Files.Actions.currentEntryData)});jq("#filesCopy").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.createDuplicate(ASC.Files.Actions.currentEntryData)});jq("#foldersOpen").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.clickOnFolder(ASC.Files.Actions.currentEntryData.id)});jq("#filesGotoParent, #foldersGotoParent").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.clickOnFolder(ASC.Files.Actions.currentEntryData.folder_id)});jq("#foldersRemoveThirdparty").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.ThirdParty.showDeleteDialog(null,null,null,ASC.Files.Actions.currentEntryData.title,ASC.Files.Actions.currentEntryData)});jq("#foldersChangeThirdparty").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.ThirdParty.showChangeDialog(ASC.Files.Actions.currentEntryData)});jq("body").on("contextmenu",function(n){return ASC.Files.Actions.onContextMenu(n)});jq("#filesMainContent").on("click",".menu-small",ASC.Files.Actions.showActionsPanel);jq("#studioPageContent").on("click","#buttonMoveto, #buttonCopyto, #buttonRestore,            #mainMove.unlockAction, #mainCopy.unlockAction, #mainRestore.unlockAction,            #filesMoveto, #filesRestore, #filesCopyto,            #foldersMoveto, #foldersRestore, #foldersCopyto",function(){ASC.Files.Actions.showMoveToSelector(this.id=="buttonCopyto"||this.id=="mainCopy"||this.id=="filesCopyto"||this.id=="foldersCopyto")});jq("#filesDocuSign").on("click",function(){return ASC.Files.ThirdParty.showDocuSignDialog(ASC.Files.Actions.currentEntryData),ASC.Files.Actions.hideAllActionPanels(),!1})})}(jQuery);
window.ASC.Files.Anchor=function(){var t=!1,n={error:new RegExp("^error(?:/(\\S+))?"),message:new RegExp("^message(?:/(\\S+))?"),preview:new RegExp("^preview(?:/|%2F)"+ASC.Files.Constants.entryIdRegExpStr),setting:new RegExp("^setting(?:=?(\\w+)?)?"),folder:new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr),help:new RegExp("^help(?:=(\\d+))?"),more:new RegExp("^more"),anyanchor:new RegExp("^(\\S+)?")},r=function(){t===!1&&(t=!0,ASC.Files.Folders&&(ASC.Controls.AnchorController.bind(n.anyanchor,u),ASC.Controls.AnchorController.bind(n.error,f),ASC.Controls.AnchorController.bind(n.message,e),ASC.Controls.AnchorController.bind(n.folder,s),ASC.Controls.AnchorController.bind(n.preview,h),ASC.Controls.AnchorController.bind(n.setting,l),ASC.Controls.AnchorController.bind(n.help,c),ASC.Controls.AnchorController.bind(n.more,o)))},u=function(t){n.error.test(t)||n.message.test(t)||n.preview.test(t)||n.setting.test(t)||n.folder.test(t)||n.help.test(t)||n.more.test(t)||ASC.Files.Anchor.defaultFolderSet()},f=function(n){ASC.Files.UI.displayInfoPanel(decodeURIComponent(n||ASC.Files.FilesJSResource.UnknownErrorText).replace(/\+/g," "),!0);jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},e=function(n){n.length&&ASC.Files.UI.displayInfoPanel(decodeURIComponent(n).replace(/\+/g," "));jq.browser.msie?setTimeout(ASC.Files.Anchor.defaultFolderSet,3e3):ASC.Files.Anchor.defaultFolderSet()},o=function(){ASC.Files.UI.displayMoreFeaturs()},s=function(n){(jq.browser.safari||jq.browser.mozilla||jq.browser.chrome)&&(n=decodeURIComponent(n));ASC.Files.Folders.currentFolder.id=ASC.Files.Common.isCorrectId(n)?n:"";ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.updateFolderView()},h=function(n){(jq.browser.safari||jq.browser.mozilla||jq.browser.chrome)&&(n=decodeURIComponent(n));typeof ASC.Files.MediaPlayer!="undefined"?ASC.Files.MediaPlayer.init(n,{allowConvert:!0,onCloseAction:function(n){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.navigationSet(n,!1);return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!0)},onMediaChangedAction:function(n){ASC.Files.Marker.removeNewIcon("file",n);var t=ASC.Files.MediaPlayer.getPlayHash(n);ASC.Files.Anchor.move(t,!0)},downloadAction:ASC.Files.Utility.GetFileViewUrl,canDelete:function(n){var t=ASC.Files.UI.getEntryObject("file",n);return t.length<=0?!1:!ASC.Files.UI.accessDelete(t)||ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t)?!1:!0},deleteAction:function(n,t){ASC.Files.Folders.deleteItem("file",n,t)}}):ASC.Files.Anchor.defaultFolderSet()},c=function(n){ASC.Files.UI.displayHelp(n)},l=function(n){switch(n){case"thirdparty":if(ASC.Files.ThirdParty)location.hash.indexOf("code")!=-1&&(ASC.Files.Folders.eventAfter=ASC.Files.ThirdParty.processAnchor),ASC.Files.ThirdParty.showSettingThirdParty();else{ASC.Files.Anchor.defaultFolderSet();return}break;case"admin":if(!ASC.Files.Constants.ADMIN){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.displayAdminSetting();break;default:ASC.Files.UI.displayCommonSetting()}ASC.Files.CreateMenu.disableMenu()},a=function(n,t){n=ASC.Files.Common.getCorrectHash(n);t?ASC.Controls.AnchorController.safemove(n):ASC.Controls.AnchorController.move(n)},i=function(n,t){ASC.Files.Common.isCorrectId(n)||(n=ASC.Files.Folders.currentFolder.id);jq("#filesMainContent .file-row").length&&(ASC.Files.UI.lastSelectedEntry=jq("#filesMainContent .file-row:has(.checkbox input:checked)").map(function(){var n=ASC.Files.UI.getObjectData(this);return{entryType:n.entryType,entryId:n.entryId}}));ASC.Files.Anchor.move(n,t===!0)},v=function(n,t){ASC.Files.UI.resetSelectAll();ASC.Files.UI.amountPage=0;t=t===!0;ASC.Files.Common.isCorrectId(n)?(t&&ASC.Files.Folders.currentFolder.id==n||(ASC.Files.Folders.currentFolder.id=n,ASC.Files.Folders.folderContainer=""),i(null,t)):(ASC.Files.Folders.currentFolder.id="",ASC.Files.Folders.folderContainer=n,i(n,t))},y=function(){if(!ASC.Resources.Master.IsAuthenticated){location.reload(!0);return}ASC.Files.Tree&&(ASC.Files.Filter.clearFilter(!0),ASC.Files.Tree.folderIdCurrentRoot?ASC.Files.Folders.currentFolder.id!=ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Anchor.navigationSet(ASC.Files.Tree.folderIdCurrentRoot):ASC.Files.Constants.FOLDER_ID_MY_FILES?(ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_MY_FILES||ASC.Files.UI.isSettingsPanel())&&ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_MY_FILES):ASC.Files.Anchor.navigationSet(ASC.Files.Constants.FOLDER_ID_COMMON_FILES))};return{init:r,move:a,navigationSet:v,defaultFolderSet:y,modulePath:"/Products/Files/"}}(),function(n){n(function(){var n=location.href.toLowerCase();(n.indexOf(ASC.Files.Anchor.modulePath.toLowerCase())!=-1||n.indexOf("/products/projects/tmdocs.aspx"))&&ASC.Files.Anchor.init()})}(jQuery);
window.ASC.Files.Folders=function(){var i=function(n,t){var i=ASC.Files.Filter.getFilterSettings();ASC.Files.ServiceManager.getFolderItems(ASC.Files.ServiceManager.events.GetFolderItems,{folderId:ASC.Files.Folders.currentFolder.id,from:n?jq('#filesMainContent .file-row[name!="addRow"]').length:0,count:t||ASC.Files.Constants.COUNT_ON_PAGE,append:n===!0,filter:i.filter,subjectGroup:i.subjectGroup,subjectId:i.subject,search:i.text,orderBy:i.sorter,withSubfolders:i.withSubfolders,searchInContent:i.searchInContent},{orderBy:i.sorter})},r=function(n,t){var r={entry:jq(typeof n=="object"?n:[n]).map(function(n,t){return t}).toArray()},i=ASC.Files.Filter.getFilterSettings();ASC.Files.ServiceManager.getItems(ASC.Files.ServiceManager.events.GetItems,{parentFolderID:t,filter:i.filter,subjectGroup:i.subjectGroup,subjectId:i.subject,search:i.text},{stringList:r})},u=function(n){var t=ASC.Files.UI.getEntryObject("folder",n);if(ASC.Files.Folders.folderContainer!="trash"||!jq("#filesMainContent").find(t).is(":visible")){if(n==ASC.Files.Constants.FOLDER_ID_PROJECT&&ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Tree.folderIdCurrentRoot!=ASC.Files.Constants.FOLDER_ID_PROJECT){location.href="TMDocs.aspx";return}ASC.Files.Filter.clearFilter(!0);ASC.Files.Anchor.navigationSet(n)}},f=function(n,t,i){var e=n.entryObject,r,u,f;return ASC.Files.Folders.folderContainer=="trash"&&jq("#filesMainContent").find(e).is(":visible")?!1:(r=n.id,u=n.title||ASC.Files.UI.getEntryTitle("file",r),t!=!1&&(i=i||n.version||0),ASC.Files.Utility.CanWebView(u))?(ASC.Files.Utility.MustConvert(u)&&(n.encrypted||ASC.Files.UI.denyDownload(n))&&(t=!1),ASC.Files.Converter.checkCanOpenEditor(r,u,i,t!=!1)):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(u)?ASC.Files.UI.denyDownload(n)?(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_SecurityException,!0),!1):(f=ASC.Files.ImageViewer.getPreviewHash(r),ASC.Files.Anchor.move(f),!1):typeof ASC.Files.MediaPlayer!="undefined"&&ASC.Files.MediaPlayer.canPlay(u,!0)?ASC.Files.UI.denyDownload(n)?(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_SecurityException,!0),!1):(f=ASC.Files.MediaPlayer.getPlayHash(r),ASC.Files.Anchor.move(f),!1):(location.href=ASC.Files.Utility.GetFileDownloadUrl(r,i),ASC.Files.Marker.removeNewIcon("file",r))},e=function(n){var t=jq(n).prop("checked");ASC.Files.ServiceManager.updateIfExist(ASC.Files.ServiceManager.events.UpdateIfExist,{value:t})},o=function(n,t){var i,u,f,r,e;n?(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),i=n):i=t?jq("#filesMainContent .file-row:not(.checkloading):not(.new-file):has(.checkbox input:checked):not(.on-favorite)"):jq("#filesMainContent .file-row:not(.checkloading):not(.new-file):has(.checkbox input:checked).on-favorite");u=[];f=[];i=i.filter(function(){var i=ASC.Files.UI.getObjectData(this),o=i.entryType,s=i.entryObject,n,e;return o=="file"&&(n=s.hasClass("on-favorite"),t!==!0||!n)?(r=n,e=i.entryId,u.push(e),!0):o=="folder"&&(n=s.hasClass("on-favorite"),t!==!0||!n)?(r=n,e=i.entryId,f.push(e),!0):!1});i.toggleClass("on-favorite",!r);e=t!==!0&&r?Teamlab.removeFilesFavorites:Teamlab.addFilesFavorites;e({},{fileIds:u,folderIds:f},function(){i.toggleClass("on-favorite",!r);ASC.Files.Folders.folderContainer=="favorites"&&(ASC.Files.UI.removeEntryObject(i),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.checkEmptyContent())},{error:function(n,t){ASC.Files.UI.displayInfoPanel(t,!0)}})},s=function(n){var t,r,i,u;n?(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),t=n):t=jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)");r=[];t.each(function(){var n=ASC.Files.UI.getObjectData(this),u=n.entryType,f=n.entryObject,t;u=="file"&&(t=n.entryId,r.push(t),i=f.hasClass("is-template"))});t.toggleClass("is-template",!i);u=i?Teamlab.removeFilesTemplates:Teamlab.addFilesTemplates;u({},{fileIds:r},function(){t.toggleClass("is-template",!i);var n=i?ASC.Files.FilesJSResource.InfoTemplateRemove:ASC.Files.FilesJSResource.InfoTemplateAdd;ASC.Files.UI.displayInfoPanel(n);ASC.Files.Folders.folderContainer=="templates"&&(ASC.Files.UI.removeEntryObject(t),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.checkEmptyContent())},{error:function(n,t){ASC.Files.UI.displayInfoPanel(t,!0)}})},h=function(n,t,i){var r=[],f,u;if(!ASC.Files.Common.isCorrectId(t)){if(r=jq("#filesMainContent .file-row:has(.checkbox input:checked)"),r.length==0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.EmptyListSelectedForDownload,!0);return}r.length==1&&(f=ASC.Files.UI.getObjectData(r[0]),t=f.entryId,n=f.entryType)}if(n==="file"){ASC.Files.Marker.removeNewIcon(n,t);location.href=ASC.Files.Utility.GetFileDownloadUrl(t,i);return}if(ASC.Files.Folders.bulkStatuses==!0){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_SecondDownload,!0);return}u=[];ASC.Files.Common.isCorrectId(t)?(u.push({Key:n+"_"+t,Value:""}),ASC.Files.Marker.removeNewIcon(n,t)):r.each(function(){var n=ASC.Files.UI.getObjectData(this);u.push({Key:n.entryType+"_"+n.entryId,Value:""});ASC.Files.Marker.removeNewIcon(n.entryType,n.entryId)});ASC.Files.Folders.bulkDownload(u)},c=function(n){ASC.Files.Folders.bulkStatuses=!0;ASC.Files.ServiceManager.download(ASC.Files.ServiceManager.events.Download,{doNow:!0},n)},n=function(){return'<div class="rename-action"><div class="button gray btn-action __apply name-aplly" title='+ASC.Files.FilesJSResource.TitleCreate+'><\/div><div class="button gray btn-action __reset name-cancel" title='+ASC.Files.FilesJSResource.TitleCancel+"><\/div><\/div>"},l=function(n,t){var i=jq(t||this).closest(".file-row");i.attr("name")?(ASC.Files.UI.removeEntryObject(i),jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen()):(i.removeClass("row-rename").find("#promptRename, .rename-action").remove(),ASC.Files.UI.selectRow(i,!0),ASC.Files.UI.updateMainContentHeader())},a=function(){var i,f,r,e,t,u;if(!ASC.Files.MediaPlayer||!ASC.Files.MediaPlayer.isView){if(!ASC.Files.UI.accessEdit()||ASC.Files.UI.isSettingsPanel()){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_SecurityException,!0);return}if(jq(document).scrollTop(0),i=ASC.Files.UI.getEntryObject("folder","0"),i.length==0){var o={folder:{id:"0",title:ASC.Files.FilesJSResource.TitleNewFolder,access:0,shared:!1,isnew:0}},s=ASC.Files.Common.jsonToXml(o),h=ASC.Files.TemplateManager.translateFromString(s);ASC.Files.EmptyScreen.hideEmptyScreen();f=jq("#filesMainContent");f.prepend(h);jq("#filesMainContent .new-folder").yellowFade().removeClass("new-folder");i=ASC.Files.UI.getEntryObject("folder","0");i.addClass("row-rename");r=i.find(".entry-title .name a");e=ASC.Files.Utility.getFolderCssClass();i.find(".thumb-img, .thumb-folder").addClass(e);t=document.createElement("input");t.id="promptCreateFolder";t.type="text";t.style.display="none";document.body.appendChild(t);t=jq("#promptCreateFolder");t.attr("maxlength",ASC.Files.Constants.MAX_NAME_LENGTH);t.addClass("textEdit input-rename");t.val(ASC.Files.FilesJSResource.TitleNewFolder);t.insertAfter(r);t.show();r.hide();t.trigger("focus");jq.browser.mobile||t.trigger("select");ASC.Files.UI.checkCharacter(t);u=function(n,t){var r=jq(t||this).closest(".file-row"),i=ASC.Files.Common.replaceSpecCharacter(jq("#promptCreateFolder").val().trim()),u;(i==""||i==null||ASC.Resources.Master.CustomMode&&i==="...")&&(i=ASC.Files.FilesJSResource.TitleNewFolder);r.find(".entry-title .name a").show().text(i);r.removeClass("row-rename");jq("#promptCreateFolder").remove();r.find(".rename-action").remove();u={parentFolderID:ASC.Files.Folders.currentFolder.id,title:i};ASC.Files.UI.blockObject(r,!0,ASC.Files.FilesJSResource.DescriptCreate);ASC.Files.ServiceManager.createFolder(ASC.Files.ServiceManager.events.CreateFolder,u)};i.append(n());i.find(".name-aplly").on("click",u);jq("#promptCreateFolder").on("keydown",function(n){var t,i;if(jq("#promptCreateFolder").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.cancelEnter(t,this);break;case ASC.Files.Common.keyCode.enter:u(t,this)}}})}}},v=function(t,i,r){var o,e,u,c,s,l,a,h,f;if(!ASC.Files.MediaPlayer||!ASC.Files.MediaPlayer.isView){if(ASC.Files.UI.isSettingsPanel()){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_SecurityException,!0);return}if(o=function(n,t,i){var f=window.open(ASC.Desktop?"":ASC.Files.Constants.URL_LOADER),u={folderID:n,fileTitle:t,templateId:i,winEditor:f};if(typeof r=="function"){r(u);return}ASC.Files.ServiceManager.createNewFile(ASC.Files.ServiceManager.events.CreateNewFile,u)},!ASC.Files.UI.accessEdit()){t?o(null,t.title,t.entryId):o();return}if(jq(document).scrollTop(0),e=ASC.Files.UI.getEntryObject("file","0"),ASC.Files.UI.removeEntryObject(e),t)u=t.title;else switch(ASC.Files.Folders.typeNewDoc){case"document":u=ASC.Files.FilesJSResource.TitleNewFileText+ASC.Files.Utility.Resource.InternalFormats.Document;break;case"spreadsheet":u=ASC.Files.FilesJSResource.TitleNewFileSpreadsheet+ASC.Files.Utility.Resource.InternalFormats.Spreadsheet;break;case"presentation":u=ASC.Files.FilesJSResource.TitleNewFilePresentation+ASC.Files.Utility.Resource.InternalFormats.Presentation;break;case"masterform":u=ASC.Files.FilesJSResource.TitleNewFileFormTemplate+ASC.Files.Utility.Resource.MasterFormExtension;break;default:return}if(ASC.Files.Utility.CanWebEdit(u)){var v={file:{id:"0",title:u,access:0,shared:!1,version:0,version_group:0}},y=ASC.Files.Common.jsonToXml(v),p=ASC.Files.TemplateManager.translateFromString(y);if(ASC.Files.EmptyScreen.hideEmptyScreen(),c=jq("#filesMainContent"),c.prepend(p),jq("#filesMainContent .new-file").show().yellowFade().removeClass("new-file"),e=ASC.Files.UI.getEntryObject("file","0"),s=function(n,i){var u=jq(i||this).closest(".file-row"),r=ASC.Files.Common.replaceSpecCharacter(jq("#promptCreateFile").val().trim()),f=ASC.Files.UI.getObjectTitle(u),e,s;r==""||r==null||ASC.Resources.Master.CustomMode&&r==="..."?r=f:(e=ASC.Files.Utility.GetFileExtension(f).length,r+=f.substring(f.length-e));u.removeClass("row-rename");jq("#promptCreateFile").remove();u.find(".rename-action").remove();u.find(".entry-title .name a").show().text(r);s=u.find(".entry-title .name a");ASC.Files.UI.highlightExtension(s,r);ASC.Files.UI.blockObject(u,!0,ASC.Files.FilesJSResource.DescriptCreate);o(ASC.Files.Folders.currentFolder.id,r,t?t.entryId:null)},i){s(null,e);return}e.addClass("row-rename");l=e.find(".entry-title .name a");a=ASC.Files.Utility.getCssClassByFileTitle(u);e.find(".thumb-img, .thumb-file").addClass(a);h=ASC.Files.Utility.GetFileExtension(u).length;u=u.substring(0,u.length-h);f=document.createElement("input");f.id="promptCreateFile";f.type="text";f.style.display="none";document.body.appendChild(f);f=jq("#promptCreateFile");f.attr("maxlength",ASC.Files.Constants.MAX_NAME_LENGTH-h);f.addClass("textEdit input-rename");f.val(u);f.insertAfter(l);f.show().trigger("focus");jq.browser.mobile||f.trigger("select");ASC.Files.UI.checkCharacter(f);e.append(n());e.find(".name-aplly").on("click",s);jq("#promptCreateFile").on("keydown",function(n){var t,i;if(jq("#promptCreateFile").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.cancelEnter(t,this)}}});jq("#promptCreateFile").on("keypress",function(n){var t,i;if(jq("#promptCreateFile").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.enter:s(t,this)}}})}}},y=function(n){var t=n.title,i=ASC.Files.Utility.GetFileExtension(t),r=t.substring(0,t.length-i.length)+ASC.Files.Utility.FileExtensionLibrary.OformExts[0];Teamlab.copyDocFileAs(null,n.id,{destFolderId:n.folder_id,destTitle:r},{success:function(t,i){ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.CreateNewFile,{fileId:i.id,show:!0,isStringXml:!1,folderID:n.folder_id,winEditor:!1})},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}})},p=function(n,t,i,r,u,f){Teamlab.updateFileStream({fileId:n,encrypted:!!r,forcesave:!!f},i,{success:function(){(ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.ReplaceVersion,{fileId:n,show:!0,isStringXml:!1}),f)||(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCrateFile.format(t)),ASC.Files.Actions.checkEditFile(n,u))},error:function(n,t){u&&u.close();ASC.Files.UI.displayInfoPanel(t[0],!0)}})},w=function(t,i){var u=ASC.Files.UI.getEntryObject(t,i),e,f,r,o;if(ASC.Files.Folders.folderContainer!="trash"&&ASC.Files.UI.accessEdit(null,u)&&!ASC.Files.UI.lockedForMe(u)&&(ASC.Files.UI.accessDelete(u)||Teamlab.profile.isVisitor!==!0)&&ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT&&(t!=="file"||!ASC.Files.UI.editingFile(u)||!ASC.Files.ThirdParty||!ASC.Files.ThirdParty.isThirdParty())){e=0;jq("#promptRename").length!=0&&jq("#filesMainContent .file-row.row-rename .name-cancel").trigger("click");u.find("#contentVersions").length&&ASC.Files.Folders.closeVersions();u.addClass("row-rename");ASC.Files.UI.selectRow(u,!1);ASC.Files.UI.updateMainContentHeader();f=ASC.Files.UI.getObjectTitle(u);t=="file"&&(e=ASC.Files.Utility.GetFileExtension(f).length,f=f.substring(0,f.length-e));r=document.createElement("input");r.id="promptRename";r.type="text";r.style.display="none";document.body.appendChild(r);r=jq("#promptRename");r.attr("maxlength",ASC.Files.Constants.MAX_NAME_LENGTH-e);r.addClass("textEdit input-rename");r.val(f);r.insertAfter(u.find(".entry-title .name a"));r.show().trigger("focus");jq.browser.mobile||r.trigger("select");ASC.Files.UI.checkCharacter(r);o=function(){var r=ASC.Files.UI.getObjectData(jq("#promptRename")),t=r.entryObject,u=r.entryType,f=r.entryId,i=ASC.Files.UI.getObjectTitle(t),n=ASC.Files.Common.replaceSpecCharacter(jq("#promptRename").val().trim()),e,o;if(n==""||n==null||ASC.Resources.Master.CustomMode&&n==="..."){ASC.Files.UI.selectRow(t,!0);ASC.Files.UI.updateMainContentHeader();return}if(t.removeClass("row-rename"),t.find(".rename-action").remove(),jq("#promptRename").remove(),u=="file"&&(e=ASC.Files.Utility.GetFileExtension(i).length,n+=i.substring(i.length-e)),n==i){ASC.Files.UI.selectRow(t,!0);ASC.Files.UI.updateMainContentHeader();return}t.find(".entry-title .name a").show().text(n);u=="file"&&(o=t.find(".entry-title .name a"),ASC.Files.UI.highlightExtension(o,n));ASC.Files.UI.blockObject(t,!0,ASC.Files.FilesJSResource.DescriptRename);u=="file"?ASC.Files.ServiceManager.renameFile(ASC.Files.ServiceManager.events.FileRename,{fileId:f,name:i,newname:n,show:!0}):ASC.Files.ServiceManager.renameFolder(ASC.Files.ServiceManager.events.FolderRename,{parentFolderID:ASC.Files.Folders.currentFolder.id,folderId:f,name:i,newname:n})};u.append(n());u.find(".name-aplly").on("click",o);u.removeClass("row-selected");jq("#promptRename").on("keydown",function(n){var t,i;if(jq("#promptRename").length!==0&&(t||(t=n),i=t.keyCode||t.which,(i==ASC.Files.Common.keyCode.esc||i==ASC.Files.Common.keyCode.enter)&&jq("#promptRename").length!=0))switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.cancelEnter(t,this);break;case ASC.Files.Common.keyCode.enter:o()}})}},b=function(n,t){if(ASC.Files.Folders.folderContainer!="trash"&&(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),!ASC.Files.UI.lockedForMe(n)||ASC.Files.Constants.ADMIN||ASC.Files.Folders.folderContainer=="my")){var i=n.hasClass("file-locked");n.toggleClass("file-locked",!i);t=t||ASC.Files.UI.getObjectData(n).entryId;ASC.Files.ServiceManager.lockFile(ASC.Files.ServiceManager.events.LockFile,{fileId:t,lock:!i,fileObj:n})}},k=function(n,t){if(ASC.Files.Folders.folderContainer!="trash"&&(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),!n.hasClass("folder-row"))){if(jq("#contentVersions:visible").length!=0){var i=n.hasClass("display-versions");if(ASC.Files.Folders.closeVersions(),i)return}ASC.Files.UI.blockObject(n,!0,ASC.Files.FilesJSResource.DescriptLoadVersion);t=t||ASC.Files.UI.getObjectData(n).entryId;ASC.Files.ServiceManager.getFileHistory(ASC.Files.ServiceManager.events.GetFileHistory,{fileId:t})}},d=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#contentVersions .version-row[data-version-group='"+n+"']:not(.version-group-head)").toggle()},g=function(n,t){jq(".version-operation").css("visibility","hidden");ASC.Files.UI.blockObjectById("file",n,!0,ASC.Files.FilesJSResource.DescriptSetVersion);ASC.Files.ServiceManager.setCurrentVersion(ASC.Files.ServiceManager.events.SetCurrentVersion,{fileId:n,version:t})},nt=function(n,t,i){return ASC.Files.Actions.hideAllActionPanels(),jq(".version-operation").css("visibility","hidden"),ASC.Files.UI.blockObjectById("file",n,!0,ASC.Files.FilesJSResource.DescriptCompleteVersion),ASC.Files.ServiceManager.completeVersion(ASC.Files.ServiceManager.events.CompleteVersion,{fileId:n,version:t,continueVersion:i}),!1},tt=function(){var r,t,f;if(ASC.Files.Actions.hideAllActionPanels(),r=jq(this).closest(".file-row"),!ASC.Files.UI.accessEdit(null,r)||ASC.Files.UI.editingFile(r)||ASC.Files.UI.lockedForMe(r))return!0;var e=jq(this).closest(".version-row"),i=e.find(".version-comment"),u=i.attr("data-comment");ASC.Files.Folders.eraseComment();i.empty();e.addClass("version-row-comment");i.attr("colspan",4);t=document.createElement("input");t.id="promptVersionComment";t.type="text";t.style.display="none";document.body.appendChild(t);t=jq("#promptVersionComment");t.attr("maxlength",255);t.attr("placeholder",ASC.Files.FilesJSResource.EnterComment);t.addClass("textEdit input-rename");t.val(u);i.append(t);t.show();t.trigger("focus");jq.browser.mobile||t.trigger("select");f=function(){var n=jq("#promptVersionComment");i=n.closest(".version-comment");u=i.attr("data-comment");var r=jq(".display-versions"),f=ASC.Files.UI.getObjectData(r).id,e=i.closest(".version-row").attr("data-version"),t=n.val().trim();t!=u&&ASC.Files.ServiceManager.updateComment(ASC.Files.ServiceManager.events.UpdateComment,{fileId:f,version:e,comment:t});ASC.Files.Folders.eraseComment()};i.append(n());i.find(".name-aplly").on("click",f);jq("#promptVersionComment").on("keydown",function(n){var t,i;if(jq("#promptVersionComment").length!=0){t||(t=n);i=t.keyCode||t.which;switch(i){case ASC.Files.Common.keyCode.esc:ASC.Files.Folders.eraseComment();break;case ASC.Files.Common.keyCode.enter:f()}}});jq(document).on("click.Comment",function(n){n=jq.fixEvent(n);jq(n.target||n.srcElement).is(".version-comment:has(#promptVersionComment) *")||(ASC.Files.Folders.eraseComment(),jq(document).off("click.Comment"))});return!1},it=function(){var n=jq(".version-row-comment .version-comment").attr("data-comment");jq(".version-row-comment .version-comment").html('<div class="version-comment-fix">'+Encoder.htmlEncode(n)+"<\/div>").removeAttr("colspan");jq(".version-row-comment").removeClass("version-row-comment")},rt=function(){jq("#contentVersions").remove();jq(".file-row-fix").removeClass("file-row-fix");jq(".display-versions").removeClass("display-versions")},ut=function(n,t){ASC.Files.Actions.hideAllActionPanels();ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.ReplaceVersion,{fileId:n,show:t,isStringXml:!1})},ft=function(n,i,r,u,f){var o=ASC.Files.UI.getEntryTitle("folder",i)||(ASC.Files.Tree?ASC.Files.Tree.getFolderTitle(i):""),s,h,e;if(f.length>1){for(h="",e=0;e<f.length;e++)h+='<li title="{0}">{0}<\/li>'.format(f[e].Value);jq("#overwriteList").html(h);jq("#overwriteListShow").show();s=ASC.Files.FilesJSResource.FilesAlreadyExist.format(f.length,'<b title="'+o+'">'+o+"<\/b>")}else jq("#overwriteListShow").hide(),s=ASC.Files.FilesJSResource.FileAlreadyExist.format('<span title="'+f[0].Value+'">'+f[0].Value+"<\/span>",'<b title="'+o+'">'+o+"<\/b>");jq("#overwriteList, #overwriteListHide").hide();jq("#overwriteMessage").html(s);jq("#buttonConfirmResolve").off("click").on("click",function(){var r=jq(".overwrite-resolve input:checked").val(),o;if(r==ASC.Files.Constants.ConflictResolveType.Skip){for(e=0;e<f.length;e++)ASC.Files.UI.blockObjectById("file",f[e].Key,!1,null,!0),o=jq.inArray("file_"+f[e].Key,n.entry),o!=-1&&n.entry.splice(o,1);ASC.Files.UI.updateMainContentHeader()}PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();u=u==!0;r==ASC.Files.Constants.ConflictResolveType.Overwrite&&t.set(u,n.entry,f.length);ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:i,resolve:r,isCopyOperation:u,doNow:!0},{stringList:n})});jq("#buttonCancelOverwrite").off("click").on("click",function(){for(e=0;e<n.entry.length;e++){var t=ASC.Files.UI.parseItemId(n.entry[e]);ASC.Files.UI.blockObjectById(t.entryType,t.entryId,!1,null,!0)}ASC.Files.UI.updateMainContentHeader();PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog()});ASC.Files.UI.blockUI("#confirmOverwriteFiles",465);PopupKeyUpActionProvider.EnterAction="jq(\"#buttonConfirmResolve\").trigger('click');";PopupKeyUpActionProvider.CloseDialogAction="jq(\"#buttonCancelOverwrite\").trigger('click');"},t=function(){function t(n){var t=0,i,r;if(n.length==0)return t;for(i=0,r=n.length;i<r;i++)t=(t<<5)-t+n.charCodeAt(i)|0;return t}function n(n,i){var r=i.concat().sort();return(n?"copy":"move")+t(r.toString())}function i(t,i){var r=n(t,i),u=+sessionStorage.getItem(r);return sessionStorage.removeItem(r),u}function r(t,i,r){var u=n(t,i);sessionStorage.setItem(u,r)}return{get:i,set:r}}(),et=function(n,t,i,r){var f;if(ASC.Files.Actions.hideAllActionPanels(),n===ASC.Files.Folders.currentFolder.entryId){ASC.Files.Folders.isCopyTo=!1;return}if(f=typeof ASC.Files.ThirdParty!="undefined",!r&&!ASC.Files.Folders.isCopyTo&&f&&ASC.Files.ThirdParty.isThirdParty()&&ASC.Files.ThirdParty.isDifferentThirdParty(n,ASC.Files.Folders.currentFolder.entryId)){ASC.Files.ThirdParty.showMoveThirdPartyMessage(n,t,i);return}var o=f&&(ASC.Files.Folders.isCopyTo==!0||ASC.Files.ThirdParty.isThirdParty()),e=!1,u={};u.entry=[];jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var n=ASC.Files.UI.getObjectData(this),r=n.entryType,t=n.entryObject,s=n.entryId;ASC.Files.Folders.isCopyTo!=!0&&(ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t))||(ASC.Files.Folders.isCopyTo!=!1||ASC.Files.UI.accessDelete(t)?r=="folder"&&jq.inArray(s,i)!=-1?ASC.Files.UI.displayInfoPanel(ASC.Files.Folders.isCopyTo==!0?ASC.Files.FilesJSResource.InfoFolderCopyError:ASC.Files.FilesJSResource.InfoFolderMoveError,!0):!o&&f&&ASC.Files.ThirdParty.isThirdParty(n)||(ASC.Files.UI.blockObject(t,!0,ASC.Files.Folders.isCopyTo==!0?ASC.Files.FilesJSResource.DescriptCopy:ASC.Files.FilesJSResource.DescriptMove,!0),u.entry.push(r+"_"+s)):e=!0)});e&&ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoMoveAccessError,!0);ASC.Files.UI.updateMainContentHeader();u.entry&&u.entry.length!=0&&ASC.Files.ServiceManager.moveFilesCheck(ASC.Files.ServiceManager.events.MoveFilesCheck,{folderToTitle:t,folderToId:n,list:u,isCopyOperation:ASC.Files.Folders.isCopyTo==!0},{stringList:u});ASC.Files.Folders.isCopyTo=!1},ot=function(n){var t={};t.entry=[];jq(n).each(function(n,i){t.entry.push(i.entryType+"_"+i.id)});ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:ASC.Files.Folders.currentFolder.entryId,resolve:2,isCopyOperation:!0,doNow:!0},{stringList:t})},st=function(){jq("#pageNavigatorHolder:visible").length!=0&&jq("#pageNavigatorHolder a").text()!=ASC.Files.FilesJSResource.ButtonShowMoreLoad&&(jq("#pageNavigatorHolder a").text(ASC.Files.FilesJSResource.ButtonShowMoreLoad),ASC.Files.Folders.getFolderItems(!0))},ht=function(n){var t=jq("#ownerSelector").attr("data-id",n.create_by_id),i=t.find(".change-owner-selector").text(n.create_by);if(t.data().useradvancedSelector)t.useradvancedSelector("select",[n.create_by_id]);else t.useradvancedSelector({inPopup:!0,itemsSelectedIds:[n.create_by_id],canadd:!1,showGroups:!0,onechosen:!0,withGuests:!1}).on("showList",function(n,r){jq("#buttonSaveChangeOwner").removeClass("disable");i.html(r.title);t.attr("data-id",r.id)});jq("#changeOwnerTitle").text(n.title);jq("#buttonSaveChangeOwner").addClass("disable");jq("#changeOwner").off("click").on("click","#buttonSaveChangeOwner:not(.disable)",function(){var t=jq("#ownerSelector").attr("data-id");PopupKeyUpActionProvider.CloseDialog();ASC.Files.Folders.changeOwner([n.entryType+"_"+n.entryId],t)});PopupKeyUpActionProvider.EnterAction="jq(\"#buttonSaveChangeOwner\").trigger('click');";ASC.Files.UI.blockUI("#changeOwner",420)},ct=function(n,t){var i={entry:n};ASC.Files.ServiceManager.changeOwner(ASC.Files.ServiceManager.events.ChangeOwner,{list:n,userId:t,parentFolderID:ASC.Files.Folders.currentFolder.id},{stringList:i})},lt=function(){if(ASC.Files.Folders.folderContainer=="trash"){ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.checkSelectAll(!0);jq("#confirmRemoveText").html(ASC.Files.FilesJSResource.ConfirmEmptyTrash);jq("#confirmRemoveList").hide();jq("#confirmRemoveTextToContinue").hide();jq("#confirmRemoveSharpBoxTextDescription").hide();jq("#confirmRemoveTextDescription").show();jq("#removeConfirmBtn").off("click").on("click",function(){PopupKeyUpActionProvider.CloseDialog();ASC.Files.ServiceManager.emptyTrash(ASC.Files.ServiceManager.events.EmptyTrash,{doNow:!0})});ASC.Files.UI.blockUI("#confirmRemove",420);PopupKeyUpActionProvider.EnterAction="jq(\"#removeConfirmBtn\").trigger('click');"}},at=function(n,t,i){var p,u,s,f,e,a,v,o,y;ASC.Files.Actions.hideAllActionPanels();p=ASC.Files.UI.autoCleanUpSetting.gap;u=null;switch(p){case-1:u=null;break;case 1:u=ASC.Files.FilesJSResource.DateOneWeek;break;case 2:u=ASC.Files.FilesJSResource.DateTwoWeeks;break;case 3:u=ASC.Files.FilesJSResource.DateOneMonth;break;case 4:u=ASC.Files.FilesJSResource.DateTwoMonths;break;case 5:u=ASC.Files.FilesJSResource.DateThreeMonths}var w=ASC.Files.Folders.folderContainer,d=ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(),h=u!=null&&w!="trash"&&w!="privacy"&&!d,b=h?ASC.Files.FilesJSResource.ConfirmRemoveListPermanently.format(u):ASC.Files.FilesJSResource.ConfirmRemoveList,r=[];if(n&&t){if(s=ASC.Files.UI.getEntryObject(n,t),!ASC.Files.UI.accessDelete(s)||ASC.Files.UI.editingFile(s)||ASC.Files.UI.lockedForMe(s))return;r.push({entryType:n,entryId:t})}else jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):has(.checkbox input:checked)").each(function(){var n=ASC.Files.UI.getObjectData(this),t=n.entryObject,i=n.entryType,u=n.entryId;if(ASC.Files.ThirdParty&&!ASC.Files.ThirdParty.isThirdParty()&&ASC.Files.ThirdParty.isThirdParty(n))return!0;!ASC.Files.UI.accessDelete(t)||ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t)||r.push({entryType:i,entryId:u})});if(r.length!=0){r.length==1&&(b=h?r[0].entryType=="file"?ASC.Files.FilesJSResource.ConfirmRemoveFilePermanently.format(u):ASC.Files.FilesJSResource.ConfirmRemoveFolderPermanently.format(u):r[0].entryType=="file"?ASC.Files.FilesJSResource.ConfirmRemoveFile:ASC.Files.FilesJSResource.ConfirmRemoveFolder);var c="",l="",k='<label title="{0}"><input type="checkbox" class="checkbox" entryType="{1}" entryId="{2}" checked="checked">{0}<\/label>';for(f=0;f<r.length;f++)e=ASC.Files.UI.getEntryTitle(r[f].entryType,r[f].entryId),r[f].entryType=="file"?(e==null&&ASC.Files.ChunkUploads&&(a=ASC.Files.ChunkUploads.getUploadDataByFileId(r[f].entryId,1),a&&(e=a.name)),l+=k.format(e,r[f].entryType,r[f].entryId)):c+=k.format(e,r[f].entryType,r[f].entryId);jq("#confirmRemoveText").html(b);jq("#confirmRemoveList dd.confirm-remove-files").html(l);jq("#confirmRemoveList dd.confirm-remove-folders").html(c);jq("#confirmRemoveList .confirm-remove-folders, #confirmRemoveList .confirm-remove-files").show();c==""&&jq("#confirmRemoveList .confirm-remove-folders").hide();l==""&&jq("#confirmRemoveList .confirm-remove-files").hide();v=function(){var n,t;jq("#confirmRemoveList").show();n=jq("#confirmRemoveList dd.confirm-remove-folders :checked").length;jq("#confirmRemoveList .confirm-remove-folders-count").text(n);t=jq("#confirmRemoveList dd.confirm-remove-files :checked").length;jq("#confirmRemoveList .confirm-remove-files-count").text(t);jq("#removeConfirmBtn").toggleClass("disable",n+t==0)};v();jq("#confirmRemoveList dd [type='checkbox']").on("change",v);if(o=jq(".files-content-panel").attr("data-deleteConfirm"),jq("#cbxDeleteConfirm").length&&(o=jq("#cbxDeleteConfirm").prop("checked")==!0),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()?(o=!0,jq("#confirmRemoveSharpBoxTextDescription").show()):jq("#confirmRemoveSharpBoxTextDescription").hide(),ASC.Files.Folders.folderContainer=="trash"||ASC.Files.Folders.folderContainer=="privacy"?(o=!0,jq("#confirmRemoveTextDescription").show()):jq("#confirmRemoveTextDescription").hide(),h?jq("#confirmRemoveTextToContinue").show():jq("#confirmRemoveTextToContinue").hide(),y=function(){if(!jq(this).hasClass("disable")){PopupKeyUpActionProvider.CloseDialog();var n={},t=jq("#confirmRemoveList input:checked");t.length!=0&&(n.entry=jq(t).map(function(n,t){var i=jq(t).attr("entryType"),r=jq(t).attr("entryId"),u=ASC.Files.UI.getEntryObject(i,r);return ASC.Files.UI.blockObject(u,!0,ASC.Files.FilesJSResource.DescriptRemove,!0),i+"_"+r}).toArray(),ASC.Files.UI.updateMainContentHeader(),ASC.Files.ServiceManager.deleteItem(ASC.Files.ServiceManager.events.DeleteItem,{list:n.entry,doNow:!0},{stringList:n}),typeof i=="function"&&i())}},o){jq("#removeConfirmBtn").off("click").on("click",y);ASC.Files.UI.blockUI("#confirmRemove",420);PopupKeyUpActionProvider.EnterAction="jq(\"#removeConfirmBtn\").trigger('click');"}else y()}},vt=function(){ASC.Files.Folders.bulkStatuses=!1;ASC.Files.UI.setProgressValue("#tasksProgress",0);jq("#tasksProgress .asc-progress-percent").text("0%");jq("#tasksProgress .progress-dialog-header span").text("");jq("#tasksProgress").hide()},yt=function(){clearTimeout(ASC.Files.Folders.tasksTimeout);ASC.Files.ServiceManager.terminateTasks(ASC.Files.ServiceManager.events.TerminateTasks,{isTerminate:!0,doNow:!0})},pt=function(n){clearTimeout(ASC.Files.Folders.tasksTimeout);ASC.Files.Folders.tasksTimeout=setTimeout(function(){ASC.Files.ServiceManager.getTasksStatuses(ASC.Files.ServiceManager.events.GetTasksStatuses,{doNow:!1})},ASC.Files.Constants.REQUEST_STATUS_DELAY/(n===!0?8:1))},wt=function(n){ASC.Files.ServiceManager.getTemplates(ASC.Files.ServiceManager.events.GetTemplates,{filter:ASC.Files.Constants.FilterType.None,from:n?jq("#filesTemplateList .file-row").length:0,count:ASC.Files.Constants.COUNT_ON_PAGE,append:n===!0,subjectGroup:!1,subjectId:"",search:"",searchInContent:!1})};return{eventAfter:null,currentFolder:{},folderContainer:"",isCopyTo:!1,cancelEnter:l,createFolder:a,replaceVersion:ut,lockFile:b,showVersions:k,closeVersions:rt,toggleVersionSublist:d,makeCurrentVersion:g,enterComment:tt,eraseComment:it,versionComplete:nt,showOverwriteMessage:ft,owerwriteManager:t,curItemFolderMoveTo:et,createDuplicate:ot,changeOwnerDialog:ht,changeOwner:ct,rename:w,deleteItem:at,emptyTrash:lt,toggleFavorite:o,toggleTemplate:s,getFolderItems:i,getItems:r,clickOnFolder:u,clickOnFile:f,updateIfExist:e,showMore:st,createNewDoc:v,createNewForm:y,typeNewDoc:"",replaceFileStream:p,getTemplateList:wt,download:h,bulkDownload:c,getTasksStatuses:pt,cancelTasksStatuses:vt,terminateTasks:yt,tasksTimeout:null,bulkStatuses:!1,isFirstLoad:!0}}(),function(n){n(function(){jq("#pageNavigatorHolder a").on("click",function(){return ASC.Files.Folders.showMore(),!1});jq("#topNewFolder a").on("click",function(){ASC.Files.Folders.createFolder()});jq("#buttonDelete, #mainDelete").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.deleteItem()});jq("#buttonEmptyTrash, #mainEmptyTrash").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.emptyTrash()});jq("#studioPageContent").on("click","#buttonDownload, #mainDownload.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.download()});jq("#filesSelectAllCheck").on("click",function(n){n.stopPropagation();ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.checkSelectAll(jq("#filesSelectAllCheck").prop("checked")==!0);jq(this).trigger("blur")});jq("#filesMainContent").on("click",".file-lock",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.lockFile(this),!1});jq("#filesMainContent").on("click",".favorite",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.toggleFavorite(this),!1});jq("#filesMainContent").on("click",".template-action",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this);return n.id!=0&&ASC.Files.Folders.createNewDoc(n),!1});jq("#filesTemplatesPanel").on("click",function(){ASC.Files.Actions.hideAllActionPanels()});jq("#filesTemplatesPanel").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file, .file-row:not(.folder-row):not(.error-entry) .thumb-img",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this);return n.id!=0&&ASC.Files.Folders.createNewDoc(n),!1});jq("#buttonRemoveFavorite, #mainRemoveFavorite, #buttonAddFavorite").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.toggleFavorite(null,this.id=="buttonAddFavorite")});jq("#buttonRemoveTemplate, #mainRemoveTemplate").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.toggleTemplate()});jq("#filesMainContent").on("click",".version",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.showVersions(this),!1});jq("#filesMainContent").on("click",".version-close",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.closeVersions(),!1});jq("#filesMainContent").on("click",".folder-row:not(.error-entry) .entry-title .name a, .folder-row:not(.error-entry) .thumb-folder, .folder-row:not(.error-entry) .thumb-img, .folder-row.min:not(.error-entry):not(.row-rename) .entry-title .name",function(n){if(ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.folderContainer=="trash")return ASC.Files.UI.clickRow(n,jq(this).closest(".file-row")),!1;var t=ASC.Files.UI.getObjectData(this).id;return t!=0&&ASC.Files.Folders.clickOnFolder(t),!1});jq(".to-parent-folder, .empty-folder-toparent").on("click",function(){var n=jq(this).attr("data-id");return ASC.Files.Folders.clickOnFolder(n),!1});jq("#filesMainContent").on("click",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file, .file-row:not(.folder-row):not(.error-entry) .thumb-img",function(n){if(ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.folderContainer=="trash")return ASC.Files.UI.clickRow(n,jq(this).closest(".file-row")),!1;var t=ASC.Files.UI.getObjectData(this);return t.id!=0&&(t.entryObject.hasClass("is-template")?ASC.Files.Folders.createNewDoc(t):ASC.Files.Folders.clickOnFile(t)),!1});jq("#filesMainContent").on("mouseup",".file-row:not(.folder-row):not(.error-entry) .entry-title .name a, .file-row:not(.folder-row):not(.error-entry) .thumb-file, .file-row:not(.folder-row):not(.error-entry) .thumb-img",function(n){var t,i,r;return n.which==2&&(t=ASC.Files.UI.getObjectData(this),t.id!=0&&(i=t.title||ASC.Files.UI.getEntryTitle("file",t.id),!ASC.Files.Utility.MustConvert(i)&&(ASC.Files.Utility.CanWebView(i)||ASC.Files.Utility.CanWebEdit(i))&&(r=t.entryObject,ASC.Files.UI.lockEditFile(r,!0),ASC.Files.Socket.subscribeChangeEditors(t.id),ASC.Files.UI.checkEditingDefer(),ASC.Files.Actions.hideAllActionPanels()))),!0});jq("#filesMainContent").on("click","#contentVersions",function(){return!1});jq("#filesMainContent").on("click",".version-comment:not(:has(input)):not(:has(.version-comment-fix:empty)), .version-comment-edit",ASC.Files.Folders.enterComment);jq("#filesMainContent").on("click",".version-complete, .version-continue",function(){var n=jq(".display-versions"),t=ASC.Files.UI.getObjectData(n).id,i=jq(this).closest(".version-row").attr("data-version"),r=jq(this).hasClass("version-continue");ASC.Files.Folders.versionComplete(t,i,r)});jq("#filesMainContent").on("click",".version-group-head .version-sublist-toggle",function(){var n=jq(this).closest(".version-row").attr("data-version-group");return ASC.Files.Folders.toggleVersionSublist(n),!1});jq("#filesMainContent").on("click",".version-preview",function(){ASC.Files.Actions.hideAllActionPanels();var n=jq(".display-versions"),t=ASC.Files.UI.getObjectData(n),i=jq(this).closest(".version-row").attr("data-version")||0;return ASC.Files.Folders.clickOnFile(t,!1,i),!1});jq("#filesMainContent").on("click",".version-download",function(){var n=jq(".display-versions"),t=ASC.Files.UI.getObjectData(n).id,i=jq(this).closest(".version-row").attr("data-version");return ASC.Files.Folders.download("file",t,i),!1});jq("#filesMainContent").on("click",".version-restore span",function(){var n=jq(".display-versions"),t=ASC.Files.UI.getObjectData(n).id,i=jq(this).closest(".version-row").attr("data-version");return ASC.Files.Folders.makeCurrentVersion(t,i),!1});jq("#filesMainContent").on("click",".version-comment .name-cancel",ASC.Files.Folders.eraseComment);jq("#filesMainContent").on("click",".file-row > .rename-action > .name-cancel",function(n){return ASC.Files.Folders.cancelEnter(n,this),!1});jq(".overwrite-resolve").on("click","input",function(){jq(".overwrite-resolve.selected").removeClass("selected");jq(this).closest(".overwrite-resolve").addClass("selected")});jq("#overwriteListShow").on("click",function(){jq("#overwriteList, #overwriteListHide").show();jq("#overwriteListShow").hide()});jq("#overwriteListHide").on("click",function(){jq("#overwriteListShow").show();jq("#overwriteList, #overwriteListHide").hide()});jq("#cbxDeleteConfirm").on("change",function(){var n=jq(this).prop("checked")==!0;return ASC.Files.ServiceManager.changeDeleteConfrim(ASC.Files.ServiceManager.events.ChangeDeleteConfrim,{value:n===!0}),!1});jq("#cbxDownloadTarGz").on("change",function(){var n=jq(this).prop("checked");return Teamlab.filesDownloadTarGz(n,{success:function(n,t){jq("#convertFileZip").html(t.title.format("<b>","<\/b>"))},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq("#cbxAutomaticallyCleanUp").on("change",function(){var n=jq(this).prop("checked"),t=jq("#selectGapToAutoCleanUp").val();return Teamlab.changeAutomaticallyCleanUp(n,n?t:-1,{success:function(n,t){ASC.Files.UI.autoCleanUpSetting=t;t.isAutoCleanUp?(jq("#selectGapToAutoCleanUp").removeClass("disabled"),jq("#selectGapToAutoCleanUp").tlcombobox(!0)):jq("#selectGapToAutoCleanUp").tlcombobox(!1)},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq("#selectGapToAutoCleanUp").on("change",function(){jq("#selectGapToAutoCleanUp").tlcombobox();var n=jq("#cbxAutomaticallyCleanUp").prop("checked"),t=jq("#selectGapToAutoCleanUp").val();return Teamlab.changeAutomaticallyCleanUp(n,n?t:-1,{success:function(n,t){ASC.Files.UI.autoCleanUpSetting=t},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq("#selectGapToAutoCleanUp").tlcombobox();jq("#cbxFavorites").on("change",function(){var n=jq(this).prop("checked")==!0;return Teamlab.filesDisplayFavorites(n,{success:function(n,t){ASC.Files.Tree.displayFavorites(t===!0);jq("#cbxFavorites").prop("checked",ASC.Files.Tree.displayFavorites())},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq("#cbxRecent").on("change",function(){var n=jq(this).prop("checked")==!0;return Teamlab.filesDisplayRecent(n,{success:function(n,t){ASC.Files.Tree.displayRecent(t===!0);jq("#cbxRecent").prop("checked",ASC.Files.Tree.displayRecent())},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq("#cbxTemplates").on("change",function(){var n=jq(this).prop("checked")==!0;return Teamlab.filesDisplayTemplates(n,{success:function(n,t){ASC.Files.Tree.displayTemplates(t===!0);ASC.Files.CreateMenu.toggleCreateByTemplate(t===!0);jq("#cbxTemplates").prop("checked",ASC.Files.Tree.displayTemplates())},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq("#defaultAccessRightsSetting input").on("change",function(){var n=[];return jq("#defaultAccessRightsSetting input:checked").each(function(){n.push(+this.value)}),Teamlab.filesChangeDafaultAccessRightsSetting(n,{success:function(){},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}}),!1});jq(".update-if-exist").on("change",function(){ASC.Files.Folders.updateIfExist(this)});jq("#cbxForcesave").on("change",function(){var n=jq(this).prop("checked")==!0;return ASC.Files.ServiceManager.forcesave(ASC.Files.ServiceManager.events.Forcesave,{value:n===!0}),!1});jq("#cbxStoreForcesave").on("change",function(){var n=jq(this).prop("checked")==!0;return ASC.Files.ServiceManager.storeForcesave(ASC.Files.ServiceManager.events.StoreForcesave,{value:n===!0}),!1});jq("#cbxExternalShare").on("change",function(){ASC.Files.Actions.hideAllActionPanels();var n=jq(this).prop("checked")===!0;return ASC.Files.ServiceManager.changeExternalShareSettings(ASC.Files.ServiceManager.events.ChangeExternalShareSettings,{enable:n}),!1});jq("#cbxExternalShareSocialMedia").on("change",function(){ASC.Files.Actions.hideAllActionPanels();var n=jq(this).prop("checked")===!0;return ASC.Files.ServiceManager.changeExternalShareSocialMediaSettings(ASC.Files.ServiceManager.events.ChangeExternalShareSocialMediaSettings,{enable:n}),!1});typeof ASC.Files.Share=="undefined"&&jq("#files_shareaccess_folders, #filesShareAccess,                #filesUnsubscribe, #foldersUnsubscribe").remove();jq(window).on("scroll",function(){return ASC.Files.UI.stickContentHeader(),ASC.Files.UI.trackShowMore(!1),!0});jq(".mainPageContent").on("scroll",function(){return ASC.Files.UI.trackShowMore(!0),!0});jq("#filesTemplateList").on("scroll",function(){ASC.Files.UI.trackShowMoreTemplates()});ASC.Files.Folders.eventAfter=function(){ASC.Files.Folders.isFirstLoad?(ASC.Files.Folders.isFirstLoad=!1,jq("#emptyContainer").is(":visible")||jq(".advansed-filter").advansedFilter("resize")):LoadingBanner.hideLoading()};ASC.Files.Folders.isFirstLoad||LoadingBanner.displayLoading();jq.browser.msie&&setInterval(function(){ASC.Files.UI.setDocumentTitle(ASC.Files.Folders.currentFolder.title)},200)})}(jQuery);
window.ASC.Files.EventHandler=function(){var r=!1,t=null,f=function(){r===!1&&(r=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFolderItems,ASC.Files.EventHandler.onGetFolderItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetItems,ASC.Files.EventHandler.onGetItems),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CheckEditing,ASC.Files.EventHandler.onCheckEditing),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.LockFile,ASC.Files.EventHandler.onLockFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateIfExist,ASC.Files.EventHandler.onUpdateIfExist),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetHelpCenter,ASC.Files.EventHandler.onGetHelpCenter),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateFolder,ASC.Files.EventHandler.onCreateFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CreateNewFile,ASC.Files.EventHandler.onCreateNewFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FolderRename,ASC.Files.EventHandler.onRenameFolder),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.FileRename,ASC.Files.EventHandler.onRenameFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeOwner,ASC.Files.EventHandler.onChangeOwner),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetFileHistory,ASC.Files.EventHandler.onGetFileHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetCurrentVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.CompleteVersion,ASC.Files.EventHandler.onUpdateHistory),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ReplaceVersion,ASC.Files.EventHandler.onGetFile),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UpdateComment,ASC.Files.EventHandler.onUpdateComment),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveFilesCheck,ASC.Files.EventHandler.onMoveFilesCheck),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTemplates,ASC.Files.EventHandler.onGetTemplates),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.MoveItems,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.DeleteItem,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.EmptyTrash,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.Download,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.TerminateTasks,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTasksStatuses,ASC.Files.EventHandler.onGetTasksStatuses),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeExternalShareSettings,ASC.Files.EventHandler.onChangeExternalShareSettings),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeExternalShareSocialMediaSettings,ASC.Files.EventHandler.onChangeExternalShareSocialMediaSettings))},e=function(t,i,r){var u,f,e;if(typeof r!="undefined"||typeof t=="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);ASC.Files.Tree&&ASC.Files.Tree.resetFolder(ASC.Files.Tree.getParentId(i.folderId));ASC.Files.Anchor.defaultFolderSet();return}if(!o(t.getElementsByTagName("folder_info")[0])){ASC.Files.Anchor.defaultFolderSet();return}if(!s(t.getElementsByTagName("path_parts")[0])){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.Marker&&ASC.Files.Marker.markRootAsNew(t.getElementsByTagName("root_folders_id_marked_as_new")[0]);u=t.getElementsByTagName("total")[0];ASC.Files.UI.countTotal=parseInt(u.text||u.textContent)||0;i.append||(jq("#filesMainContent").empty(),jq(document).scrollTop(0),ASC.Files.Folders.folderContainer!="forme"&&jq("#filesMainContent").append("<div class='folders-separator'><\/div>"));f=ASC.Files.TemplateManager.translate(t);n(f);f!==""&&ASC.Files.Filter&&(e=ASC.Files.Filter.getFilterSettings()).isSet?(jq("#filesBreadCrumbs").is(":visible")||(jq("#filesBreadCrumbs").show(),jq(".to-parent-folder").hide()),jq("#filesBreadCrumbs").addClass("with-search-crumbs"),jq("#searchBreadCrumbs").attr("data-id",ASC.Files.Folders.currentFolder.id).attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)).attr("title",ASC.Files.Folders.currentFolder.title).text(ASC.Files.Folders.currentFolder.title),jq("#searchBreadCrumbsSub").toggle(e.withSubfolders&&(!ASC.Files.ThirdParty||!ASC.Files.ThirdParty.isThirdParty()))):jq("#filesBreadCrumbs").removeClass("with-search-crumbs");jq(ASC.Files.UI.lastSelectedEntry).each(function(){var n=ASC.Files.UI.getEntryObject(this.entryType,this.entryId);ASC.Files.UI.selectRow(n,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null;ASC.Files.Folders.eventAfter!=null&&typeof ASC.Files.Folders.eventAfter=="function"&&(ASC.Files.Folders.eventAfter(),ASC.Files.Folders.eventAfter=null);ASC.Files.CreateMenu&&(ASC.Desktop||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PRIVACY&&ASC.Files.Folders.folderContainer!="privacy"?ASC.Files.CreateMenu.disableMenu(ASC.Files.UI.accessEdit()):ASC.Files.CreateMenu.disableMenu(!1));ASC.Files.UI.stickContentHeader()},n=function(n,t){var f,i,r,u,e,o;return ASC.Files.UI.resetSelectAll(),ASC.Files.EmptyScreen.hideEmptyScreen(),n==""?t||ASC.Files.EmptyScreen.displayEmptyScreen():(t?t.length?(f=t.hasClass("row-selected")||t.attr("data-selected")=="true",t.after(n),i=t.next(),i.toggleClass("min",t.hasClass("min")),ASC.Files.UI.removeEntryObject(t)):(jq("#filesMainContent").prepend(n),i=jq('#filesMainContent .file-row[name="addRow"][data-id!="folder_0"][data-id!="file_0"]')):(jq("#filesMainContent").append(n),i=jq("#filesMainContent .file-row:gt(-"+(ASC.Files.Constants.COUNT_ON_PAGE+1)+")")),jq('#filesMainContent .file-row[name="addRow"]').each(function(){var n=ASC.Files.UI.getObjectData(this),t=ASC.Files.UI.getEntryObject(n.entryType,n.id);t.filter('[name!="addRow"]').remove()}),r=parseInt(ASC.Files.Constants.COUNT_ON_PAGE)||0,ASC.Files.UI.amountPage=parseInt((ASC.Files.UI.countTotal/r).toFixed(0)),ASC.Files.UI.amountPage-ASC.Files.UI.countTotal/r<0&&ASC.Files.UI.amountPage++,ASC.Files.UI.currentPage=parseInt((jq('#filesMainContent .file-row[name!="addRow"]').length-1)/r)+1,u=ASC.Files.UI.countTotal-jq("#filesMainContent .file-row").length,ASC.Files.UI.currentPage<ASC.Files.UI.amountPage&&u>0?(jq("#pageNavigatorHolder").show(),ASC.Files.FilesJSResource&&jq("#pageNavigatorHolder a").text(r<u?ASC.Files.FilesJSResource.ButtonShowMoreOf.format(r,u):ASC.Files.FilesJSResource.ButtonShowMore.format(u))):jq("#pageNavigatorHolder").hide(),ASC.Files.Mouse&&ASC.Files.Mouse.collectEntryItems(),ASC.Files.UI.addRowHandlers(i),f&&(ASC.Files.UI.selectRow(i,f),ASC.Files.UI.updateMainContentHeader()),e=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),e.length>0&&(o=jq(e).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray(),ASC.Files.Socket.subscribeChangeEditors(o)),ASC.Files.UI.checkEditingDefer()),i&&i.attr("name",""),i},o=function(n){var t,i;if(typeof n=="undefined"||n==null)return!1;if(!ASC.Files.Folders)return!0;ASC.Files.Folders.currentFolder={};t=jq(n.childNodes);for(i in t)i&&typeof t[i]=="object"&&(ASC.Files.Folders.currentFolder[t[i].tagName]=t[i].textContent||t[i].text||"");if(ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))ASC.Files.Folders.currentFolder.entryId=ASC.Files.Folders.currentFolder.id;else return!1;if(ASC.Files.Folders.currentFolder.entryType="folder",ASC.Files.Share){if(ASC.Files.Folders.currentFolder.access=parseInt(ASC.Files.Folders.currentFolder.access||ASC.Files.Constants.AceStatusEnum.None),ASC.Files.Folders.currentFolder.access==ASC.Files.Constants.AceStatusEnum.Restrict)return ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.AceStatusEnum_Restrict,!0),!1;ASC.Files.Folders.currentFolder.shareable=ASC.Files.Folders.currentFolder.shareable==="true"}return ASC.Files.Tree&&ASC.Files.Folders.currentFolder.id==ASC.Files.Tree.folderIdCurrentRoot&&(ASC.Files.Folders.currentFolder.title=ASC.Files.FilesJSResource.ProjectFiles),ASC.Files.UI.setDocumentTitle(ASC.Files.Folders.currentFolder.title),!0},s=function(n){var t,i;if(typeof n=="undefined"||n==null||(t=jq(n.childNodes).map(function(n,t){var i=t.childNodes[0];return i.textContent||i.text}),t.length==0))return!1;i=parseInt(t[0]);ASC.Files.Tree&&(ASC.Files.Tree.pathParts=t);jq("#mainContentHeader .menuAction").removeClass("unlockAction").hide();jq("#filesMainContent").removeClass("myFiles").removeClass("corporateFiles").removeClass("shareformeFiles").removeClass("recentFiles").removeClass("favoritesFiles").removeClass("templatesFiles").removeClass("privacyFiles").removeClass("trashFiles").removeClass("projectFiles");switch(i){case ASC.Files.Constants.FOLDER_ID_MY_FILES:ASC.Files.Folders.folderContainer="my";jq("#filesMainContent").addClass("myFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_SHARE:ASC.Files.Folders.folderContainer="forme";jq("#filesMainContent").addClass("shareformeFiles");jq("#mainDownload, #mainCopy, #mainMarkRead, #mainUnsubscribe, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_RECENT:ASC.Files.Folders.folderContainer="recent";jq("#filesMainContent").addClass("recentFiles");jq("#mainDownload, #mainCopy, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_FAVORITES:ASC.Files.Folders.folderContainer="favorites";jq("#filesMainContent").addClass("favoritesFiles");jq("#mainDownload, #mainCopy, #mainConvert, #mainRemoveFavorite").show();break;case ASC.Files.Constants.FOLDER_ID_TEMPLATES:ASC.Files.Folders.folderContainer="templates";jq("#filesMainContent").addClass("templatesFiles");jq("#mainDownload, #mainCopy, #mainConvert, #mainRemoveTemplate").show();break;case ASC.Files.Constants.FOLDER_ID_PRIVACY:ASC.Files.Folders.folderContainer="privacy";jq("#filesMainContent").addClass("privacyFiles");jq("#mainDownload, #mainMove, #mainDelete").show();break;case ASC.Files.Constants.FOLDER_ID_COMMON_FILES:ASC.Files.Folders.folderContainer="corporate";jq("#filesMainContent").addClass("corporateFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_PROJECT:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainMarkRead, #mainDelete, #mainConvert").show();break;case ASC.Files.Constants.FOLDER_ID_TRASH:ASC.Files.Folders.folderContainer="trash";jq("#filesMainContent").addClass("trashFiles");jq("#mainDownload, #mainRestore, #mainDelete, #mainEmptyTrash, #mainConvert").show();jq("#mainEmptyTrash").addClass("unlockAction");break;case ASC.Files.Tree.folderIdCurrentRoot:ASC.Files.Folders.folderContainer="project";jq("#filesMainContent").addClass("projectFiles");jq("#mainDownload, #mainMove, #mainCopy, #mainDelete, #mainConvert").show();break;default:if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id))return!1}return ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable&&ASC.Files.Folders.folderContainer!="privacy"&&!ASC.Resources.Master.Personal&&jq("#mainShare").show(),ASC.Files.Filter&&ASC.Files.Filter.disableFilter(),jq("#filesMainContent").toggleClass("without-share",!(ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable)),ASC.Files.Tree&&ASC.Files.Tree.updateTreePath(),ASC.Files.UI.checkButtonBack(".to-parent-folder","#filesBreadCrumbs"),!0},h=function(t,i,r){var e,u,o,f,s;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(ASC.Files.Folders.currentFolder.id==i.parentFolderID){for(i.lonelyType&&(t.__type=i.lonelyType,t=[t]),e="",u=0;u<t.length;u++)o=ASC.Files.Common.jsonToXml(t[u].__type.toLowerCase().indexOf("folder")==-1?{file:t[u]}:{folder:t[u]}),e+=ASC.Files.TemplateManager.translateFromString(o);f=n(e,{});f&&(s=f.hasClass("new-folder"),f.removeClass("new-file new-folder").show().yellowFade(),ASC.Files.Tree&&s&&ASC.Files.Tree.resetFolder(i.parentFolderID))}},c=function(t,i,r){var h=ASC.Files.UI.getEntryObject("file","0"),u,c,f;if(ASC.Files.UI.blockObject(h),u=i.winEditor,typeof r!="undefined"){ASC.Files.UI.removeEntryObject(h);u&&u.close();jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}if(c=ASC.Files.TemplateManager.translate(t),ASC.Files.Folders.currentFolder.id==i.folderID){f=n(c,h);f.show().yellowFade().removeClass("new-file");var e=ASC.Files.UI.getObjectData(f),s=e.title,o=e.entryId;if(ASC.Files.Folders.folderContainer=="privacy"&&ASC.Desktop&&ASC.Desktop.setAccess){ASC.Files.UI.blockObject(f,!0,ASC.Files.FilesJSResource.DescriptCreate);ASC.Desktop.setAccess(o,function(n){n?(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.DesktopMessageStoring),ASC.Files.Folders.replaceFileStream(o,s,n,!0,u)):(ASC.Files.UI.blockObject(f),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCrateFile.format(s)))});return}u!==!1&&ASC.Files.Actions.checkEditFile(o,u)}else f=jq(c),e=ASC.Files.UI.getObjectData(f),s=e.title,o=e.entryId,u!==!1&&ASC.Files.Actions.checkEditFile(o,u);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCrateFile.format(s))},l=function(t,i,r){var e=ASC.Files.UI.getEntryObject("folder","0"),o,u,f;if(typeof r!="undefined"){ASC.Files.UI.removeEntryObject(e);jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();ASC.Files.UI.displayInfoPanel(r,!0);return}ASC.Files.Folders.currentFolder.id==i.parentFolderID?(o=ASC.Files.TemplateManager.translate(t),u=n(o,e),u.yellowFade().removeClass("new-folder"),f=ASC.Files.UI.getObjectData(u).title):f=i.title;ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCrateFolder.format(f))},a=function(t,i,r){var f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var e=ASC.Files.TemplateManager.translate(t),o=i.folderId,u=ASC.Files.UI.getEntryObject("folder",o);u=n(e,u);u.yellowFade().removeClass("new-folder");ASC.Files.UI.selectRow(u,!0);ASC.Files.UI.updateMainContentHeader();f=ASC.Files.UI.getObjectData(u).title;ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(i.parentFolderID);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRenameFolder.format(i.name,f))},v=function(n,t,i){var r,u;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}r=ASC.Files.EventHandler.onGetFile(n,t,i);ASC.Files.UI.selectRow(r.entryObject,!0);ASC.Files.UI.updateMainContentHeader();u=r.title;ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRenameFile.format(t.name,u))},y=function(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var u,f;jq(i.list).each(function(e,o){var h=ASC.Files.UI.parseItemId(o),l,v,c;if(jq(t).each(function(n,t){return t.id==h.entryId?(l=t,!1):!0}),h.entryType=="folder"){var a=ASC.Files.Common.jsonToXml({folder:l}),y=ASC.Files.TemplateManager.translateFromString(a),p=h.entryId,s=ASC.Files.UI.getEntryObject("folder",p);s=n(y,s);s.yellowFade().removeClass("new-folder");ASC.Files.UI.selectRow(s,!0);ASC.Files.UI.updateMainContentHeader();ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(i.parentFolderID);v=ASC.Files.UI.getObjectData(s);u=v.create_by;f=v.title}else a=ASC.Files.Common.jsonToXml({file:l}),c=ASC.Files.EventHandler.onGetFile(a,{fileId:h.entryId,isStringXml:!0,show:!0},r),ASC.Files.UI.selectRow(c.entryObject,!0),ASC.Files.UI.updateMainContentHeader(),u=c.create_by,f=c.title});i.list.length>1?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoChangeOwnerArray.format(Encoder.htmlEncode(u),i.list.length)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoChangeOwner.format(Encoder.htmlEncode(u),f))},p=function(n,t,i){var f=t.fileId,e=ASC.Files.UI.getEntryObject("file",f),r,u;if(typeof i!="undefined"){ASC.Files.UI.blockObject(e);jq(".version-operation").css("visibility","");ASC.Files.UI.displayInfoPanel(i,!0);return}jq.extend(t,{isStringXml:!0,show:!0});r=ASC.Files.Common.jsonToXml({file:n.key});ASC.Files.EventHandler.onGetFile(r,t);u=ASC.Files.Common.jsonToXml({fileList:{entry:n.value}});ASC.Files.EventHandler.onGetFileHistory(u,t)},w=function(n,t,i){var y=t.fileId,r=ASC.Files.UI.getEntryObject("file",y),s,u,e,f,l,a,o;if(ASC.Files.UI.blockObject(r),ASC.Files.UI.updateMainContentHeader(),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(s=t.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(n):ASC.Files.TemplateManager.translate(n),jq("#contentVersions").remove(),jq(".display-versions").removeClass("display-versions"),jq("#filesMainContent").hasClass("thumbnails")){for(u=r;;){if(e=u.next(),!e.length)break;if(e.position().top!=u.position().top)break;u=e}u.after(s);var h=jq("#contentVersions"),v=u.outerWidth(),c=parseInt(u.css("margin-right")),p=jq("#filesMainContent").outerWidth(),w=parseInt(h.css("padding-left"))+parseInt(h.css("padding-right"));h.css("width",parseInt(p/(v+c))*(v+c)-c-w+"px")}else r.append(s).addClass("file-row-fix");r.addClass("display-versions");f=ASC.Files.UI.getObjectData(r);l=!0;!ASC.Files.UI.accessEdit(f,r)||ASC.Files.UI.editingFile(r)||ASC.Files.UI.lockedForMe(r)||Teamlab.profile.isVisitor||f.encrypted?(jq(".version-comment-edit").remove(),jq(".version-operation.version-restore").empty(),jq(".version-complete, .version-continue").remove(),jq(".version-num span").addClass("display-num"),l=!1):jq("#contentVersions").addClass("version-edit");f.deny_download&&jq(".version-download").remove();jq("#contentVersions").addClass("version-highlight");ASC.Files.Utility.CanWebView(f.title)&&jq(".not-preview").removeClass("not-preview");a=jq("#contentVersions .version-row:first").attr("data-version");jq("#contentVersions .version-row[data-version='"+a+"'] .version-restore").empty();o=-1;jq("#contentVersions .version-row").each(function(){var n=jq(this),i=n.attr("data-version-group"),r=n.attr("data-version"),t;i!=o?(r==a?n.find(".version-continue").remove():n.find(".version-complete").remove(),o=i,n.addClass("version-group-head"),t=jq("#contentVersions .version-row[data-version-group="+o+"]"),t.length>1&&n.find(".version-sublist span").addClass("version-sublist-toggle").text(jq.format(ASC.Files.FilesJSResource.RevisionCount,t.length))):l?n.find(".version-num span, .version-continue").remove():n.find(".version-num").empty()});ASC.Files.UI.registerUserProfilePopup(jq("#contentVersions"))},b=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}n=n||"";jq("#contentVersions .version-row[data-version="+t.version+"]").removeClass("version-row-comment").find(".version-comment").attr("data-comment",n).attr("title",n.length?n:"").html('<div class="version-comment-fix">'+Encoder.htmlEncode(n)+"<\/div>")},k=function(t,i,r){var e,o,u,f;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}if(e=i.fileId,ASC.Files.Common.isCorrectId(e))return o=i.isStringXml===!0?ASC.Files.TemplateManager.translateFromString(t):ASC.Files.TemplateManager.translate(t),ASC.Files.Marker.removeNewIcon("file",e),u=ASC.Files.UI.getEntryObject("file",e),u=n(o,u),f=ASC.Files.UI.getObjectData(u),!f||(u=f.entryObject,i.show&&(ASC.Files.EmptyScreen.hideEmptyScreen(),u.removeClass("new-file").show().yellowFade()),u.find(".is-new").is(":visible")&&ASC.Files.Marker.setNewCount(f.entryType,f.entryId,1)),ASC.Files.UI.updateMainContentHeader(),f},d=function(n,t,i){if(typeof i!="undefined"){jq(t.list.entry).each(function(){var n=ASC.Files.UI.parseItemId(this);ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.displayInfoPanel(i,!0);return}n!=null&&n.length>0?ASC.Files.Folders.showOverwriteMessage(t.list,t.folderToId,t.folderToTitle,t.isCopyOperation,n):(ASC.Files.ServiceManager.moveItems(ASC.Files.ServiceManager.events.MoveItems,{folderToId:t.folderToId,resolve:ASC.Files.Constants.ConflictResolveType.Duplicate,isCopyOperation:t.isCopyOperation,doNow:!0},{stringList:t.list}),ASC.Files.Folders.isCopyTo=!1)},u=function(n,t,i,r){var o=ASC.Files.UI.parseItemId(n[0]).entryId,f,s,u,h,c,a,p,w,k,b;for(n=n.slice(1),f=[],s=[],u=0;u<n.length;u++)(h=ASC.Files.UI.parseItemId(n[u]),h!=null)&&(u%2?s.push(h):(f.push(h),ASC.Files.UI.blockObjectById(h.entryType,h.entryId,!1,null,!0)));ASC.Files.UI.updateMainContentHeader();c=ASC.Files.UI.getEntryObject("folder",o);c.removeClass("row-to");var v,y=0,l=0,e="";for(f.length==1&&(e=ASC.Files.UI.getEntryTitle(f[0].entryType,f[0].entryId),(typeof e==undefined||e==null)&&(e="")),u=0;u<f.length;u++)a=ASC.Files.UI.getEntryObject(f[u].entryType,f[u].entryId),f[u].entryType=="file"?l++:(y+=1+(parseInt(a.find(".countFolders").html())||0),l+=parseInt(a.find(".countFiles").html())||0,ASC.Files.Tree&&!v&&(v=ASC.Files.Tree.getParentId(f[u].entryId))),t||ASC.Files.Folders.currentFolder.id==o||(ASC.Files.Marker.removeNewIcon(f[u].entryType,f[u].entryId),ASC.Files.UI.removeEntryObject(a));if(y>0&&(p=c.find(".countFolders"),p.html((parseInt(p.html())||0)+y),ASC.Files.Tree&&(ASC.Files.Tree.reloadFolder(o),t||o==ASC.Files.Folders.currentFolder.id||ASC.Files.Tree.reloadFolder(v||ASC.Files.Folders.currentFolder.id))),l>0&&(w=c.find(".countFiles"),k=ASC.Files.Folders.owerwriteManager.get(t,r),w.html((parseInt(w.html())||0)+l-k)),f.length>0&&ASC.Files.Folders.currentFolder.id!=o&&ASC.Files.UI.checkEmptyContent(),t?f.length==1&&e!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCopyItem.format(e)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCopyGroup.format(i)):f.length==1&&e!=""?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoMoveItem.format(e)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoMoveGroup.format(i)),ASC.Files.Folders.currentFolder.id==o){for(b=[],u=0;u<s.length;u++)ASC.Files.UI.getEntryObject(s[u].entryType,s[u].entryId).length||b.push(s[u].entryType+"_"+s[u].entryId);ASC.Files.Folders.getItems(b,o)}},g=function(n,t){var s=ASC.Files.UI.parseItemId(n[0]).entryId,i,r,f,c;for(n=n.slice(1),i=[],r=0;r<n.length;r++)(f=ASC.Files.UI.parseItemId(n[r]),f!=null)&&(i.push(f),ASC.Files.UI.blockObjectById(f.entryType,f.entryId,!1,null,!0));ASC.Files.UI.updateMainContentHeader();var o,e=!1,u="",h=ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>0&&(ASC.Files.Tree.pathParts[0]!=ASC.Files.Constants.FOLDER_ID_TRASH||s==ASC.Files.Constants.FOLDER_ID_TRASH||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty());for(i.length==1&&(u=ASC.Files.UI.getEntryTitle(i[0].entryType,i[0].entryId),(typeof u==undefined||u==null)&&(u="")),r=0;r<i.length;r++)c=ASC.Files.UI.getEntryObject(i[r].entryType,i[r].entryId),i[r].entryType=="folder"&&(e||(e=!0),ASC.Files.Tree&&!o&&(o=ASC.Files.Tree.getParentId(i[r].entryId))),h&&(ASC.Files.Marker.removeNewIcon(i[r].entryType,i[r].entryId),ASC.Files.UI.removeEntryObject(c),ASC.Files.ChunkUploads.removeUploadItemByFileId(i[r].entryId));e&&ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(o||ASC.Files.Folders.currentFolder.id);i.length>0&&h&&ASC.Files.UI.checkEmptyContent();i.length==1&&u!=""?e>0?ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRemoveFolder.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRemoveFile.format(u)):ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRemoveGroup.format(i.length,t));s==ASC.Files.Constants.FOLDER_ID_TRASH&&ASC.Files.ChunkUploads.initTenantQuota()},nt=function(n,t,i){var s,u,e,o,r,c;if(clearTimeout(ASC.Files.UI.timeCheckEditing),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}for(n||(n=[]),s=jq(".files-content-panel #filesMainContent .file-row.on-edit:not(.cannot-edit)"),u=0;u<s.length;u++){var h=ASC.Files.UI.getObjectData(s[u]),l=h.entryObject,f=h.entryId;for(ASC.Files.UI.lockEditFile(l,!1),e=!0,o=0;o<n.length&&e;o++)f==n[o].Key&&(e=!1);e&&ASC.Files.Folders.replaceVersion(f,!0)}for(r=0;r<n.length;r++)f=n[r].Key,c=n[r].Value,ASC.Files.UI.lockEditFileById(f,!0,c);n.length>0&&ASC.Files.UI.checkEditingDefer()},tt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq(".update-if-exist").prop("checked",n===!0)},it=function(n,t,i){var u,r;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}u=t.lock;u?(r=t.fileObj,r.addClass("file-locked"),ASC.Files.UI.addRowHandlers(r)):(t.show=!0,ASC.Files.Actions.currentEntryData=ASC.Files.EventHandler.onGetFile(n,t,i))},rt=function(n,t,i){if(typeof i!="undefined"||typeof n=="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Actions.hideAllActionPanels();return}jq("#filesTemplateLoader").hide();var r=ASC.Files.TemplateManager.translate(n),u=!r.length;(t.append||(jq("#filesTemplateEmpty").toggle(u),jq("#filesTemplateList").toggle(!u)),u)||(t.append?jq("#filesTemplateList").append(r):jq("#filesTemplateList").html(r),jq("#filesTemplateList .file-row").each(function(){var n=ASC.Files.UI.getObjectData(this),e=n.entryId,t=n.entryType,u=n.entryObject,r=n.title,o=t=="file"?ASC.Files.Utility.getCssClassByFileTitle(r,!0):ASC.Files.Utility.getFolderCssClass(!0),i,f;u.find(".thumb-img, .thumb-"+t).addClass(o);i=u.find(".entry-title .name a");t=="file"&&i.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(i,r);f=ASC.Files.UI.getEntryLink(t,e,r);i.attr("href",f).attr("target","_blank")}))},ut=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Anchor.defaultFolderSet();return}t.update&&(jq("#helpPanel").html(n),StudioManager.initImageZoom());LoadingBanner.hideLoading();jq("#helpPanel").show();showHelpPage(t.helpId);ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsHelp);ASC.Files.CreateMenu.disableMenu()},ft=function(n,r,f){var h,o,e;if(typeof n!="object"&&typeof f!="undefined"||n==null){ASC.Files.Folders.cancelTasksStatuses();ASC.Files.UI.displayInfoPanel(f,!0);return}if(n.length==0){ASC.Files.Folders.cancelTasksStatuses();return}var s=0,c=!1,l,a=[ASC.Files.FilesJSResource.TasksOperationMove,ASC.Files.FilesJSResource.TasksOperationCopy,ASC.Files.FilesJSResource.TasksOperationDelete,ASC.Files.FilesJSResource.TasksOperationBulkdownload,ASC.Files.FilesJSResource.TasksOperationMarkAsRead],v=[ASC.Files.FilesJSResource.DescriptMove,ASC.Files.FilesJSResource.DescriptCopy,ASC.Files.FilesJSResource.DescriptRemove,ASC.Files.FilesJSResource.DescriptBulkdownload,ASC.Files.FilesJSResource.DescriptMarkAsRead];for(n.length!=0&&(jq("#tasksProgress:visible").length==0&&(clearTimeout(t),jq("#tasksProgress").length==0&&(jq("#progressTemplate").clone().attr("id","tasksProgress").prependTo("#bottomLoaderPanel"),jq("#tasksProgress .progress-dialog-header").append('<a title="{0}" class="actions-container close">&times;<\/a>'.format(ASC.Files.FilesJSResource.TitleCancel)),jq("#tasksProgress .progress-dialog-header").append("<span><\/span>")),ASC.Files.UI.setProgressValue("#tasksProgress",0),jq("#tasksProgress .asc-progress-percent").text("0%"),jq("#tasksProgress .progress-dialog-header span").text(""),jq("#tasksProgress").show(),jq.browser.mobile&&(jq("#bottomLoaderPanel").css("bottom","auto"),jq("#bottomLoaderPanel").css("top",jq(window).scrollTop()+jq(window).height()-jq("#bottomLoaderPanel").height()+"px"))),l=n.length>1?ASC.Files.FilesJSResource.TasksOperationMixed.format(n.length):a[n[0].operation],jq("#tasksProgress .progress-dialog-header span").text(l)),i=0;i<n.length;i++)if(h=":",o=n[i].source.trim().split(h),jq(o).each(function(){var t=ASC.Files.UI.parseItemId(this);if(t==null)return!0;ASC.Files.UI.blockObjectById(t.entryType,t.entryId,!0,v[n[i].operation],!0)}),ASC.Files.UI.updateMainContentHeader(),s+=n[i].progress,n[i].finished){if(n[i].result!=null){e=n[i].result.trim().split(h);switch(n[i].operation){case 0:u(e,!1,n[i].processed,o);break;case 1:u(e,!0,n[i].processed,o);break;case 2:g(e,o.length);break;case 3:e[0]&&n[i].error==null&&(location.href=e[0]);ASC.Files.Folders.bulkStatuses=!1;break;case 4:ASC.Files.Marker.onMarkAsRead(e)}}jq(o).each(function(){var n=ASC.Files.UI.parseItemId(this);if(n==null)return!0;ASC.Files.UI.blockObjectById(n.entryType,n.entryId,!1,null,!0)});ASC.Files.UI.updateMainContentHeader();n[i].error!=null&&ASC.Files.UI.displayInfoPanel(n[i].error,!0)}else c=!0;s=n.length==0?100:s/n.length;ASC.Files.UI.setProgressValue("#tasksProgress",s);jq("#tasksProgress .asc-progress-percent").text(s+"%");c?ASC.Files.Folders.getTasksStatuses(r.doNow):(clearTimeout(t),t=setTimeout(ASC.Files.Folders.cancelTasksStatuses,500))},et=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}var r=n===!0;jq("#cbxExternalShare").prop("checked",r);r?jq("#cbxExternalShareSocialMedia").prop("disabled",!1).next().removeClass("gray-text"):jq("#cbxExternalShareSocialMedia").prop("disabled",!0).prop("checked",!1).next().addClass("gray-text");ASC.Files.Share&&ASC.Files.Share.changeExternalShareSettings()},ot=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq("#cbxExternalShareSocialMedia").prop("checked",n===!0);ASC.Files.Share&&ASC.Files.Share.changeExternalShareSettings()},st=function(){jq.browser.msie||(this.parentElement.style.backgroundSize="96px",this.parentElement.removeChild(this))};return{init:f,onGetFolderItems:e,onGetItems:h,onGetFile:k,onCreateNewFile:c,onCreateFolder:l,onRenameFolder:a,onRenameFile:v,onChangeOwner:y,onUpdateHistory:p,onGetFileHistory:w,onUpdateComment:b,onCheckEditing:nt,onLockFile:it,onGetTemplates:rt,onUpdateIfExist:tt,onGetHelpCenter:ut,onMoveFilesCheck:d,onGetTasksStatuses:ft,onChangeExternalShareSettings:et,onChangeExternalShareSocialMediaSettings:ot,onThumbnailError:st}}(),function(n){n(function(){ASC.Files.EventHandler.init();jq("#bottomLoaderPanel").on("click","#tasksProgress a.close",function(){return ASC.Files.Folders.terminateTasks(),!1})})}(jQuery);
window.ASC.Files.Socket=function(){var n=!1,t,i=function(){if(n===!1&&ASC.SocketIO&&!ASC.SocketIO.disabled()){n=!0;t=ASC.SocketIO.Factory.files;t.connect(function(){}).on("changeEditors",function(){ASC.Files.UI.checkEditing()})}},r=function(i){n!==!1&&t.emit("subscribeChangeEditors",i,function(){})};return{init:i,subscribeChangeEditors:r}}(),function(n){n(function(){ASC.Files.Socket.init()})}(jQuery);
/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright 2015 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
!function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n:n(jQuery)}(function(n){function u(r){var u=r||window.event,w=c.call(arguments,1),l=0,s=0,e=0,a=0,b=0,k=0,v,y,p;if(r=n.event.fix(u),r.type="mousewheel","detail"in u&&(e=-1*u.detail),"wheelDelta"in u&&(e=u.wheelDelta),"wheelDeltaY"in u&&(e=u.wheelDeltaY),"wheelDeltaX"in u&&(s=-1*u.wheelDeltaX),"axis"in u&&u.axis===u.HORIZONTAL_AXIS&&(s=-1*e,e=0),l=0===e?s:e,"deltaY"in u&&(e=-1*u.deltaY,l=e),"deltaX"in u&&(s=u.deltaX,0===e&&(l=-1*s)),0!==e||0!==s)return 1===u.deltaMode?(v=n.data(this,"mousewheel-line-height"),l*=v,e*=v,s*=v):2===u.deltaMode&&(y=n.data(this,"mousewheel-page-height"),l*=y,e*=y,s*=y),(a=Math.max(Math.abs(e),Math.abs(s)),(!t||t>a)&&(t=a,o(u,a)&&(t/=40)),o(u,a)&&(l/=40,s/=40,e/=40),l=Math[l>=1?"floor":"ceil"](l/t),s=Math[s>=1?"floor":"ceil"](s/t),e=Math[e>=1?"floor":"ceil"](e/t),i.settings.normalizeOffset&&this.getBoundingClientRect)&&(p=this.getBoundingClientRect(),b=r.clientX-p.left,k=r.clientY-p.top),r.deltaX=s,r.deltaY=e,r.deltaFactor=t,r.offsetX=b,r.offsetY=k,r.deltaMode=0,w.unshift(r,l,s,e),f&&clearTimeout(f),f=setTimeout(h,200),(n.event.dispatch||n.event.handle).apply(this,w)}function h(){t=null}function o(n,t){return i.settings.adjustOldDeltas&&"mousewheel"===n.type&&t%120==0}var f,t,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],c=Array.prototype.slice,e,i;if(n.event.fixHooks)for(e=s.length;e;)n.event.fixHooks[s[--e]]=n.event.mouseHooks;i=n.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=r.length;t;)this.addEventListener(r[--t],u,!1);else this.onmousewheel=u;n.data(this,"mousewheel-line-height",i.getLineHeight(this));n.data(this,"mousewheel-page-height",i.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],u,!1);else this.onmousewheel=null;n.removeData(this,"mousewheel-line-height");n.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var r=n(t),i=r["offsetParent"in n.fn?"offsetParent":"parent"]();return i.length||(i=n("body")),parseInt(i.css("fontSize"),10)||parseInt(r.css("fontSize"),10)||16},getPageHeight:function(t){return n(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})});
jQuery.url=function(){var i={},n={},t={url:window.location,strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},u=function(){str=decodeURI(t.url);for(var r=t.parser[t.strictMode?"strict":"loose"].exec(str),n={},i=14;i--;)n[t.key[i]]=r[i]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,function(i,r,u){r&&(n[t.q.name][r]=u)}),n},f=function(t){return(n.length||r(),t=="base")?n.port!==null&&n.port!==""?n.protocol+"://"+n.host+":"+n.port+"/":n.protocol+"://"+n.host+"/":n[t]===""?null:n[t]},e=function(t){return n.length||r(),n.queryKey[t]===null?null:n.queryKey[t]},r=function(){n=u();o()},o=function(){var t=n.path;i=[];i=n.path.length==1?{}:(t.charAt(t.length-1)=="/"?t.substring(1,t.length-1):path=t.substring(1)).split("/")};return{setMode:function(n){return strictMode=n=="strict"?!0:!1,this},setUrl:function(n){return t.url=n===undefined?window.location:n,r(),this},segment:function(t){return(n.length||r(),t===undefined)?i.length:i[t]===""||i[t]===undefined?null:i[t]},attr:f,param:e}}();
(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery","jquery-ui/ui/widget"],n):typeof exports=="object"?n(require("jquery"),require("./vendor/jquery.ui.widget")):n(window.jQuery)})(function(n){"use strict";function t(t){var i=t==="dragover";return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var u=r.dataTransfer;u&&n.inArray("Files",u.types)!==-1&&this._trigger(t,n.Event(t,{delegatedEvent:r}))!==!1&&(r.preventDefault(),i&&(u.dropEffect="copy"))}}n.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||n('<input type="file"/>').prop("disabled"));n.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);n.support.xhrFormDataFileUpload=!!window.FormData;n.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);n.widget("blueimp.fileupload",{options:{dropZone:n(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&n.each(i,function(n,i){t=t.replace("{"+n+"}",i)}),t},formData:function(n){return n.serializeArray()},add:function(t,i){if(t.isDefaultPrevented())return!1;(i.autoUpload||i.autoUpload!==!1&&n(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:n.support.blobSlice&&function(){var n=this.slice||this.webkitSlice||this.mozSlice;return n.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.loaded=0;this.bitrate=0;this.getBitrate=function(n,t,i){var r=n-this.timestamp;return(!this.bitrate||!i||r>i)&&(this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=n),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&n.support.xhrFileUpload||n.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return n.type(t.formData)==="function"?t.formData(t.form):n.isArray(t.formData)?t.formData:n.type(t.formData)==="object"?(i=[],n.each(t.formData,function(n,t){i.push({name:n,value:t})}),i):[]},_getTotal:function(t){var i=0;return n.each(t,function(n,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?n.extend(t._progress,i):t._progress=i},_initResponseObject:function(n){var t;if(n._response)for(t in n._response)n._response.hasOwnProperty(t)&&delete n._response[t];else n._response={}},_onProgress:function(t,i){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),u;if(i._time&&i.progressInterval&&r-i._time<i.progressInterval&&t.loaded!==t.total)return;i._time=r;u=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0);this._progress.loaded+=u-i._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,i.bitrateInterval);i._progress.loaded=i.loaded=u;i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(r,u,i.bitrateInterval);this._trigger("progress",n.Event("progress",{delegatedEvent:t}),i);this._trigger("progressall",n.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var r=this,i=t.xhr?t.xhr():n.ajaxSettings.xhr();i.upload&&(n(i.upload).bind("progress",function(n){var i=n.originalEvent;n.lengthComputable=i.lengthComputable;n.loaded=i.loaded;n.total=i.total;r._onProgress(n,t)}),t.xhr=function(){return i})},_isInstanceOf:function(n,t){return Object.prototype.toString.call(t)==="[object "+n+"]"},_initXHRData:function(t){var f=this,i,r=t.files[0],e=t.multipart||!n.support.xhrFileUpload,u=n.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=n.extend({},t.headers);t.contentRange&&(t.headers["Content-Range"]=t.contentRange);e&&!t.blob&&this._isInstanceOf("File",r)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.uploadName||r.name)+'"');e?n.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:u,value:t.blob}):n.each(t.files,function(r,f){i.push({name:n.type(t.paramName)==="array"&&t.paramName[r]||u,value:f})})):(f._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,n.each(this._getFormData(t),function(n,t){i.append(t.name,t.value)})),t.blob?i.append(u,t.blob,r.uploadName||r.name):n.each(t.files,function(r,e){(f._isInstanceOf("File",e)||f._isInstanceOf("Blob",e))&&i.append(n.type(t.paramName)==="array"&&t.paramName[r]||u,e,e.uploadName||e.name)})),t.data=i):(t.contentType=r.type||"application/octet-stream",t.data=t.blob||r);t.blob=null},_initIframeSettings:function(t){var i=n("<a><\/a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||"");t.formData=this._getFormData(t);t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(n){this._isXHRUpload(n)?(this._chunkedUpload(n,!0)||(n.data||this._initXHRData(n),this._initProgressListener(n)),n.postMessage&&(n.dataType="postmessage "+(n.dataType||""))):this._initIframeSettings(n)},_getParamName:function(t){var r=n(t.fileInput),i=t.paramName;return i?n.isArray(i)||(i=[i]):(i=[],r.each(function(){for(var t=n(this),u=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)i.push(u),r-=1}),i.length||(i=[r.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=n(t.fileInput.prop("form")),t.form.length||(t.form=n(this.options.fileInput.prop("form"))));t.paramName=this._getParamName(t);t.url||(t.url=t.form.prop("action")||location.href);t.type=(t.type||n.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase();t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST");t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=n.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(n){return n.state?n.state():n.isResolved()?"resolved":n.isRejected()?"rejected":"pending"},_enhancePromise:function(n){return n.success=n.done,n.error=n.fail,n.complete=n.always,n},_getXHRPromise:function(t,i,r){var u=n.Deferred(),f=u.promise();return i=i||this.options.context||f,t===!0?u.resolveWith(i,r):t===!1&&u.rejectWith(i,r),f.abort=u.promise,this._enhancePromise(f)},_addConvenienceMethods:function(t,i){var r=this,u=function(t){return n.Deferred().resolveWith(r,t).promise()};i.process=function(t,f){return(t||f)&&(i._processQueue=this._processQueue=(this._processQueue||u([this])).then(function(){return i.errorThrown?n.Deferred().rejectWith(r,[i]).promise():u(arguments)}).then(t,f)),this._processQueue||u([this])};i.submit=function(){return this.state()!=="pending"&&(i.jqXHR=this.jqXHR=r._trigger("submit",n.Event("submit",{delegatedEvent:t}),this)!==!1&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()};i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))};i.state=function(){return this.jqXHR?r._getDeferredState(this.jqXHR):this._processQueue?r._getDeferredState(this._processQueue):void 0};i.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"};i.progress=function(){return this._progress};i.response=function(){return this._response}},_getUploadedBytes:function(n){var i=n.getResponseHeader("Range"),t=i&&i.split("-"),r=t&&t.length>1&&parseInt(t[1],10);return r&&r+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var u=this,e=t.files[0],o=e.size,r=t.uploadedBytes,f=t.maxChunkSize||o,l=this._blobSlice,s=n.Deferred(),h=s.promise(),a,c;return!(this._isXHRUpload(t)&&l&&(r||(n.type(f)==="function"?f(t):f)<o))||t.data?!1:i?!0:r>=o?(e.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",e.error])):(c=function(){var i=n.extend({},t),h=i._progress.loaded;i.blob=l.call(e,r,r+(n.type(f)==="function"?f(i):f),e.type);i.chunkSize=i.blob.size;i.contentRange="bytes "+r+"-"+(r+i.chunkSize-1)+"/"+o;u._initXHRData(i);u._initProgressListener(i);a=(u._trigger("chunksend",null,i)!==!1&&n.ajax(i)||u._getXHRPromise(!1,i.context)).done(function(f,e,l){r=u._getUploadedBytes(l)||r+i.chunkSize;h+i.chunkSize-i._progress.loaded&&u._onProgress(n.Event("progress",{lengthComputable:!0,loaded:r-i.uploadedBytes,total:r-i.uploadedBytes}),i);t.uploadedBytes=i.uploadedBytes=r;i.result=f;i.textStatus=e;i.jqXHR=l;u._trigger("chunkdone",null,i);u._trigger("chunkalways",null,i);r<o?c():s.resolveWith(i.context,[f,e,l])}).fail(function(n,t,r){i.jqXHR=n;i.textStatus=t;i.errorThrown=r;u._trigger("chunkfail",null,i);u._trigger("chunkalways",null,i);s.rejectWith(i.context,[n,t,r])})},this._enhancePromise(h),h.abort=function(){return a.abort()},c(),h)},_beforeSend:function(n,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(t);this._initProgressObject(t);t._progress.loaded=t.loaded=t.uploadedBytes||0;t._progress.total=t.total=this._getTotal(t.files)||1;t._progress.bitrate=t.bitrate=0;this._active+=1;this._progress.loaded+=t.loaded;this._progress.total+=t.total},_onDone:function(t,i,r,u){var f=u._progress.total,e=u._response;u._progress.loaded<f&&this._onProgress(n.Event("progress",{lengthComputable:!0,loaded:f,total:f}),u);e.result=u.result=t;e.textStatus=u.textStatus=i;e.jqXHR=u.jqXHR=r;this._trigger("done",null,u)},_onFail:function(n,t,i,r){var u=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total);u.jqXHR=r.jqXHR=n;u.textStatus=r.textStatus=t;u.errorThrown=r.errorThrown=i;this._trigger("fail",null,r)},_onAlways:function(n,t,i,r){this._trigger("always",null,r)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var r=this,f,s,e,h,u=r._getAJAXSettings(i),o=function(){return r._sending+=1,u._bitrateTimer=new r._BitrateTimer,f=f||((s||r._trigger("send",n.Event("send",{delegatedEvent:t}),u)===!1)&&r._getXHRPromise(!1,u.context,s)||r._chunkedUpload(u)||n.ajax(u)).done(function(n,t,i){r._onDone(n,t,i,u)}).fail(function(n,t,i){r._onFail(n,t,i,u)}).always(function(n,t,i){if(r._onAlways(n,t,i,u),r._sending-=1,r._active-=1,u.limitConcurrentUploads&&u.limitConcurrentUploads>r._sending)for(var f=r._slots.shift();f;){if(r._getDeferredState(f)==="pending"){f.resolve();break}f=r._slots.shift()}r._active===0&&r._trigger("stop")})};return(this._beforeSend(t,u),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)?(this.options.limitConcurrentUploads>1?(e=n.Deferred(),this._slots.push(e),h=e.then(o)):(this._sequence=this._sequence.then(o,o),h=this._sequence),h.abort=function(){return(s=[undefined,"abort","abort"],!f)?(e&&e.rejectWith(u.context,s),o()):f.abort()},this._enhancePromise(h)):o()},_onAdd:function(t,i){var a=this,p=!0,f=n.extend({},this.options,i),u=i.files,v=u.length,o=f.limitMultiFileUploads,c=f.limitMultiFileUploadSize,b=f.limitMultiFileUploadSizeOverhead,w=0,l=this._getParamName(f),s,e,h,r,y=0;if(!v)return!1;if(c&&u[0].size===undefined&&(c=undefined),(f.singleFileUploads||o||c)&&this._isXHRUpload(f))if(f.singleFileUploads||c||!o)if(!f.singleFileUploads&&c)for(h=[],s=[],r=0;r<v;r=r+1)w+=u[r].size+b,(r+1===v||w+u[r+1].size+b>c||o&&r+1-y>=o)&&(h.push(u.slice(y,r+1)),e=l.slice(y,r+1),e.length||(e=l),s.push(e),y=r+1,w=0);else s=l;else for(h=[],s=[],r=0;r<v;r+=o)h.push(u.slice(r,r+o)),e=l.slice(r,r+o),e.length||(e=l),s.push(e);else h=[u],s=[l];return i.originalFiles=u,n.each(h||u,function(r,u){var f=n.extend({},i);return f.files=h?u:[u],f.paramName=s[r],a._initResponseObject(f),a._initProgressObject(f),a._addConvenienceMethods(t,f),p=a._trigger("add",n.Event("add",{delegatedEvent:t}),f)}),p},_replaceFileInput:function(t){var i=t.fileInput,r=i.clone(!0),u=i.is(document.activeElement);t.fileInputClone=r;n("<form><\/form>").append(r)[0].reset();i.after(r).detach();u&&r.focus();n.cleanData(i.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(n,t){return t===i[0]?r[0]:t});i[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(t,i){var s=this,r=n.Deferred(),u=[],e,f=function(n){n&&!n.entry&&(n.entry=t);r.resolve([n])},h=function(n){s._handleFileTreeEntries(n,i+t.name+"/").done(function(n){r.resolve(n)}).fail(f)},o=function(){e.readEntries(function(n){n.length?(u=u.concat(n),o()):h(u)},f)};return i=i||"",t.isFile?t._file?(t._file.relativePath=i,r.resolve(t._file)):t.file(function(n){n.relativePath=i;r.resolve(n)},f):t.isDirectory?(e=t.createReader(),o()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,i){var r=this;return n.when.apply(n,n.map(t,function(n){return r._handleFileTreeEntry(n,i)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(n.map(i,function(n){var t;return n.webkitGetAsEntry?(t=n.webkitGetAsEntry(),t&&(t._file=n.getAsFile()),t):n.getAsEntry()})):n.Deferred().resolve(n.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=n(t);var r=t.prop("webkitEntries")||t.prop("entries"),i,u;if(r&&r.length)return this._handleFileTreeEntries(r);if(i=n.makeArray(t.prop("files")),i.length)i[0].name===undefined&&i[0].fileName&&n.each(i,function(n,t){t.name=t.fileName;t.size=t.fileSize});else{if(u=t.prop("value"),!u)return n.Deferred().resolve([]).promise();i=[{name:u.replace(/^.*\\/,"")}]}return n.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return!(t instanceof n)||t.length===1?this._getSingleFileInputFiles(t):n.when.apply(n,n.map(t,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(t){var r=this,i={fileInput:n(t.target),form:n(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(u){i.files=u;r.options.replaceFileInput&&r._replaceFileInput(i);r._trigger("change",n.Event("change",{delegatedEvent:t}),i)!==!1&&r._onAdd(t,i)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};i&&i.length&&(n.each(i,function(n,t){var i=t.getAsFile&&t.getAsFile();i&&r.files.push(i)}),this._trigger("paste",n.Event("paste",{delegatedEvent:t}),r)!==!1&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var u=this,i=t.dataTransfer,r={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){r.files=i;u._trigger("drop",n.Event("drop",{delegatedEvent:t}),r)!==!1&&u._onAdd(t,r)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste}));n.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(t,i){var r=n.inArray(t,this._specialOptions)!==-1;r&&this._destroyEventHandlers();this._super(t,i);r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof n||(t.fileInput=n(t.fileInput));t.dropZone instanceof n||(t.dropZone=n(t.dropZone));t.pasteZone instanceof n||(t.pasteZone=n(t.pasteZone))},_getRegExp:function(n){var t=n.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return t!=="url"&&n.type(i)==="string"&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options,r=this.element.data();n.each(this.element[0].attributes,function(n,u){var f=u.name.toLowerCase(),e;/^data-/.test(f)&&(f=f.slice(5).replace(/-[a-z]/g,function(n){return n.charAt(1).toUpperCase()}),e=r[f],t._isRegExpOption(f,e)&&(e=t._getRegExp(e)),i[f]=e)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(n){t.files=n;i._onAdd(null,t)}):(t.files=n.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var e=this,i=n.Deferred(),u=i.promise(),r,f;return u.abort=function(){return(f=!0,r)?r.abort():(i.reject(null,"abort","abort"),u)},this._getFileInputFiles(t.fileInput).always(function(n){if(!f){if(!n.length){i.reject();return}t.files=n;r=e._onSend(null,t);r.then(function(n,t,r){i.resolve(n,t,r)},function(n,t,r){i.reject(n,t,r)})}}),this._enhancePromise(u)}if(t.files=n.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});
window.ASC.Files.Share=function(){function ht(){v||(nt(),r(),dr(),v=!0)}function ct(){var t=n.$addUserBtn.get(0);return t.classList.contains("disable")?!1:(n.userSelector.resetTempData(),n.userSelector.render(),n.userSelector.dialogElement.style.top=t.offsetTop+t.offsetHeight+4+"px",!0)}function lt(){return n.ownerSelector.resetTempData(),n.ownerSelector.render(),!0}function u(){n.$saveBtnMain.removeClass("display-none");n.$saveBtnArrow.removeClass("display-none");w()}function at(){n.$saveBtnMain.addClass("display-none");n.$saveBtnArrow.addClass("display-none");w()}function w(){var i,r,t;if(n.viewSettings.displaySettings){i=!1;for(r in n.selected)if(t=n.selected[r],!t.isOwner&&(!t.isLink||t.access!=ASC.Files.Constants.AceStatusEnum.Restrict)){i=!0;break}n.$settingsBtn.toggleClass("disable",!i)}}function vt(){var i,t,r,u;if(!n.$addLinkBtn.hasClass("disable")&&n.viewSettings.externalLinksAvailable&&!n.viewSettings.externalLinksEnabled)for(i in n.selected)if(t=n.selected[i],t.isLink){r=n.defaultAccessRight==ASC.Files.Constants.AceStatusEnum.ReadWrite?n.viewSettings.canLinkReadWrite?n.defaultAccessRight:ASC.Files.Constants.AceStatusEnum.Read:n.defaultAccessRight;h(i,r);t.shortened=p(t.link);t.shortenedText=f.Shortened;u=n.userDomGenerator.createLink(t);n.contentListElement.prepend(u);n.viewSettings.externalLinksEnabled=!0;n.$addLinkBtn.addClass("disable");n.pagging.contentItemsNumber++;n.$emptyList.hide();break}}function yt(){var i=b(0,n.pagging.renderBy-1),t;n.pagging.searchItemsNumber=i.count;t=n.userDomGenerator.createContentList();t.append(i.fragment);n.searchDialogListParentElement.firstElementChild.replaceWith(t)}function b(t,i){var r={fragment:document.createDocumentFragment(),count:-1},f,u,e;for(f in n.searchResult)if(r.count++,!(r.count<t)){if(r.count>i)break;u=Object.assign({},n.searchResult[f]);u.disabled=n.selected[f]!==undefined;u.selected=u.disabled||n.tmpSelected[f]!==undefined;e=n.userDomGenerator.createGroupItem(u);r.fragment.append(e)}return r.count>i?(r.fragment.append(n.userDomGenerator.createShowMoreRow({name:a.UserSelectorShowMore})),r):(r.count++,r.count==0&&r.fragment.append(n.userDomGenerator.createEmptySearchRow()),r)}function pt(){var t=n.$searchInput.position(),i=n.$searchInput.outerHeight();return n.$searchDialog.css("top",t.top+i+4+"px"),!0}function wt(){return n.userSearcher.clear(),!0}function bt(t,i){t.length?(n.searchResult=Object.assign({},i.groups,i.users),yt(),n.searchDialogHelper.show()):n.searchDialogHelper.hide()}function kt(t){var r,o,s,h,c,l,a,e,v;t.classList.contains("disabled")||(r=Object.assign({},n.searchResult[t.id]),o=n.defaultAccessRight,!r.isGroup&&n.userCache[t.id].isVisitor&&(o=n.defaultAccessRightForVisitor),r.access=o,r.accessName=i(o),r.canEdit=!0,r.canRemove=!0,n.selected[t.id]=r,s=n.contentListElement.lastElementChild,h=s&&s.classList.contains("us-show-more-row"),h||(r.isGroup?(c=n.userDomGenerator.createGroup(r),n.contentListElement.append(c)):(r.withoutTitle=n.viewSettings.showTooltop,l=n.userDomGenerator.createGroupItem(r),n.contentListElement.append(l)),n.pagging.contentItemsNumber++,n.$emptyList.hide()),!r.isGroup&&n.openedGroupElement&&(a=n.groupCache[n.openedGroupElement.id].users.indexOf(t.id),a!=-1&&(e=n.openedGroupElement.nextElementSibling.children[t.id],e&&e.classList.contains("us-name")&&(e.querySelector(".us-access").setAttribute("class","us-access access-"+o),v=n.userDomGenerator.createNameInfoText(f.IndividualRights),e.querySelector(".us-name-text").append(v),e.classList.add("individual")))),n.searchDialogHelper.hide(),u())}function dt(t){var i=b(n.pagging.searchItemsNumber,n.pagging.searchItemsNumber+n.pagging.renderBy-1);n.pagging.searchItemsNumber=i.count;n.searchDialogListParentElement.firstElementChild.append(i.fragment);t.parentElement.remove()}function o(t,i){i?n.tmpSelected[t]=!0:delete n.tmpSelected[t]}function c(i){if(i==t.none){n.selectionMode=i;n.contentListParentElement.classList.remove("rootonly");n.tmpSelected={};n.openedGroupElement?e(r(n.openedGroupElement.id)):r();return}if(i==t.root){if(n.selectionMode==i)return;n.selectionMode=i;n.contentListParentElement.classList.add("rootonly");n.openedGroupElement=null;r();return}if(i==t.group){if(n.selectionMode==i)return;n.selectionMode=i;n.contentListParentElement.classList.remove("rootonly");e(r(n.openedGroupElement.id))}}function k(i){var l=Object.keys(n.tmpSelected).length,r=l>0,u,s,f,e,c,o,h;if(r||i)n.$actionsContainer.show(),n.$searchContainer.hide(),n.$addUserBtn.addClass("disable"),n.$addLinkBtn.addClass("disable"),n.$menuActionRemoveBtn.toggle(n.selectionMode!=t.group);else return n.$actionsContainer.hide(),n.$searchContainer.show(),n.$addUserBtn.removeClass("disable"),n.$addLinkBtn.toggleClass("disable",n.viewSettings.externalLinksEnabled),!1;if(u=!0,s=!0,n.selectionMode==t.root){for(f in n.selected)if((e=n.selected[f],e.canEdit)&&n.tmpSelected[f]===undefined){u=!1;break}for(f in n.tmpSelected)if(e=n.selected[f],!e.canRemove){s=!1;break}}if(n.selectionMode==t.group){c=n.groupCache[n.openedGroupElement.id].users;for(o of c)if(n.userCache[o]&&(h=n.selected[o],h===undefined||h.canEdit)&&n.tmpSelected[o]===undefined){u=!1;break}}return n.$menuActionSelectAllCbx.prop("checked",r&&u),n.$menuActionSelectAllCbx.prop("indeterminate",r&&!u),n.$menuActionChangeBtn.toggleClass("unlockAction",r),n.$menuActionRemoveBtn.toggleClass("unlockAction",r&&s),!0}function gt(i,u){var h,s,c,f,l;if(n.tmpSelected={},u.target.checked){if(h=!0,n.selectionMode==t.group)for(s of n.groupCache[n.openedGroupElement.id].users)n.userCache[s]&&(c=n.selected[s],(c===undefined||c.canEdit)&&o(s,!0));else{for(f in n.selected)n.selected[f].canEdit&&o(f,!0);for(f in n.tmpSelected)if(l=n.selected[f],!l.canRemove){h=!1;break}}n.$menuActionChangeBtn.addClass("unlockAction");n.$menuActionRemoveBtn.toggleClass("unlockAction",h)}else n.$menuActionChangeBtn.removeClass("unlockAction"),n.$menuActionRemoveBtn.removeClass("unlockAction");n.selectionMode==t.group?e(r(n.openedGroupElement.id)):r()}function ni(i,u){var l=u.target.classList.contains("select-all"),b=u.target.classList.contains("select-links"),d=u.target.classList.contains("select-groups"),a=u.target.classList.contains("select-users"),v=u.target.getAttribute("data-access")===null,y=+u.target.getAttribute("data-access"),s,h,p,c,f,w;if(n.selectionMode==t.group){for(s of n.groupCache[n.openedGroupElement.id].users)if(n.userCache[s]&&(h=n.selected[s],h===undefined||h.canEdit)){if(v){o(s,l||a);continue}p=h===undefined?n.selected[n.openedGroupElement.id].access:h.access;o(s,p==y)}}else for(c in n.selected)(f=n.selected[c],f.canEdit)&&(w=v?l||f.isLink&&b||f.isGroup&&d||!f.isLink&&!f.isGroup&&a:f.access==y,o(c,w));k(!0);n.selectionMode==t.group?e(r(n.openedGroupElement.id)):r();n.menuSelectDialogHelper.hide()}function ti(){var t,i,r;if(!n.$menuActionChangeBtn.hasClass("unlockAction"))return!1;n.currentElement=null;var u=!0,f=!0,e=!1,o=!1;for(t in n.tmpSelected){if(i=n.selected[t],i&&i.isLink){u=n.viewSettings.canLinkReadWrite;f=!1;o=!n.viewSettings.externalLinksAvailable;break}if(r=n.userCache[t],r&&r.isVisitor){e=!0;break}}return tt(n.$menuAccessRightsDialog,u,f,e,o),!0}function ii(){var t,i;n.currentElement=null;for(t in n.tmpSelected)(i=n.selected[t],i.canRemove)&&(i.isLink?h(t,ASC.Files.Constants.AceStatusEnum.Restrict):delete n.selected[t]);l()}function l(){n.$actionsContainer.hide();n.$searchContainer.show();n.$addUserBtn.removeClass("disable");n.$addLinkBtn.toggleClass("disable",n.viewSettings.externalLinksEnabled);c(t.none)}function ri(t){n.$linkActionDialog.find("li:not(:last-of-type)").toggle(n.viewSettings.externalLinksAvailable);s(t,n.linkActionDialogHelper,n.$linkActionDialog)}function s(t,i,r,u){var e,o;if(t&&n.currentElement==t&&r.is(":visible")){r.hide();return}i.hide();n.currentElement=t;var s=u===undefined?4:u,h=n.$contentListParent.outerHeight(),f=n.$contentListParent.scrollTop(),c=jq(t),l=c.position(),v=c.outerHeight(),a=f+l.top+v-s;r.css("top",a+"px");i.show();e=r.outerHeight();h+f<a+e&&(o=f+l.top+s-e,o<f?r.css("top",h+f-e+"px"):r.css("top",o+"px"))}function ui(t,i){var u=n.currentElement.id,r=i.target.classList;r.contains("link-action-share")?(s(n.currentElement,n.linkShareDialogHelper,n.$linkShareDialog),n.$linkShareDialogInput.trigger("focus").trigger("select")):r.contains("link-action-embed")?(s(n.currentElement,n.linkEmbedDialogHelper,n.$linkEmbedDialog),n.$linkEmbedDialogInput.trigger("focus").trigger("select")):r.contains("link-action-short")?ut():r.contains("link-action-delete")&&h(u,ASC.Files.Constants.AceStatusEnum.Restrict);n.linkActionDialogHelper.hide()}function h(r,f){var e=n.selected[r];e.access!=f&&(n.targetData.needUpdate=!0,e.access=f,e.accessName=i(f),f==ASC.Files.Constants.AceStatusEnum.Restrict?(e.canEdit=!1,e.canRemove=!1,n.viewSettings.externalLinksEnabled=!1,n.$addLinkBtn.toggleClass("disable",n.selectionMode!=t.none),n.currentElement&&(n.currentElement.remove(),n.pagging.contentItemsNumber--,n.$emptyList.toggle(n.pagging.contentItemsNumber==0))):(e.canEdit=!0,e.canRemove=!0),u())}function fi(t){var t=t.parentElement,r=t.getAttribute("data-group"),i;r==null?(i=g(r,n.pagging.contentItemsNumber,n.pagging.contentItemsNumber+n.pagging.renderBy-1),n.pagging.contentItemsNumber=i.count,n.contentListElement.append(i.fragment)):(i=d(r,n.pagging.usersItemsNumber,n.pagging.usersItemsNumber+n.pagging.renderBy-1),n.pagging.usersItemsNumber=i.count,t.parentElement.append(i.fragment));t.remove()}function ei(){var t,i,f,e;if(n.targetData.ownerIdTmp&&n.selected[n.targetData.ownerIdTmp]||(n.targetData.ownerIdTmp=n.targetData.ownerId),t={},t[n.targetData.ownerIdTmp]=n.selected[n.targetData.ownerIdTmp],n.ownerSelector)n.ownerSelector.changeData(t);else{i={};for(f in n.userCache)e=n.userCache[f],e.isVisitor||(i[f]=e);n.ownerSelector=new UserSelector({userCache:i,groupCache:n.groupCache,selected:t,userDomGenerator:n.userDomGenerator,singleChoice:!0,groupSelection:!1,onSave:function(t){for(var e in t){var i=t[e],f=n.selected[n.targetData.ownerIdTmp],o=Object.assign({},f,{id:i.id,name:i.name,avatar:i.avatar});delete n.selected[f.id];n.selected[i.id]=o;n.targetData.ownerIdTmp=i.id}r();u()}});n.$topButtonContainer.append(n.ownerSelector.dialogElement);n.ownerSelector.dialogElement.style.top="90px";n.ownerSelectorDialogHelper=new DialogHelper(null,n.ownerSelector.dialogElement,lt,null,!1,!0);n.ownerSelector.onCancel=n.ownerSelectorDialogHelper.hide}n.ownerSelectorDialogHelper.show()}function oi(t,i){if(!i.target.classList.contains("uneditable")){var r=t.classList.contains("us-linkname"),f=r?n.viewSettings.canLinkReadWrite:!0,e=!r,u=n.userCache[t.id],o=u&&u.isVisitor,h=r&&!n.viewSettings.externalLinksAvailable;tt(n.$itemAccessRightsDialog,f,e,o,h);s(t,n.itemAccessRightsDialogHelper,n.$itemAccessRightsDialog)}}function si(r){var s=+r.getAttribute("data-id"),l=i(s),o=n.currentElement.id,nt=n.currentElement.classList.contains("us-groupname"),tt=n.currentElement.classList.contains("us-linkname"),p=n.currentElement.querySelector(".us-access"),w,b,v,y,k,a,d,g,c;p.setAttribute("class","us-access access-"+s);p.setAttribute("title",l);nt?(n.selected[o].access=s,n.selected[o].accessName=l,e(n.currentElement,!0)):tt?h(o,s):(w=n.currentElement.getAttribute("data-group"),w?n.selected[o]!==undefined?(n.selected[o].access=s,n.selected[o].accessName=l,c=n.contentListElement.children[o],c&&c.classList.contains("us-name")&&c.querySelector(".us-access").setAttribute("class","us-access access-"+s)):(b=n.userDomGenerator.createNameInfoText(f.IndividualRights),n.currentElement.querySelector(".us-name-text").append(b),n.currentElement.classList.add("individual"),v=n.userCache[o],n.selected[o]={id:o,name:v.displayName,avatar:v.avatarSmall,access:s,accessName:l,canEdit:!0,canRemove:!0},y=n.contentListElement.lastElementChild,k=y&&y.classList.contains("us-show-more-row"),k||(a=Object.assign({},n.selected[o]),a.selected=!1,a.disabled=n.selectionMode==t.group,a.withoutTitle=n.viewSettings.showTooltop,d=n.userDomGenerator.createGroupItem(a),n.contentListElement.append(d),n.pagging.contentItemsNumber++)):(n.selected[o].access=s,n.selected[o].accessName=l,n.openedGroupElement&&(g=n.groupCache[n.openedGroupElement.id].users.indexOf(o),g!=-1&&(c=n.openedGroupElement.nextElementSibling.children[o],c&&c.classList.contains("us-name")&&c.querySelector(".us-access").setAttribute("class","us-access access-"+s)))));!0&&u();n.itemAccessRightsDialogHelper.hide()}function hi(t){var u=+t.getAttribute("data-id"),r,f,e;for(r in n.tmpSelected)f=n.selected[r],f?f.isLink?h(r,u):(f.access=u,f.accessName=i(u)):(e=n.userCache[r],n.selected[r]={id:r,name:e.displayName,avatar:e.avatarSmall,access:u,accessName:i(u),canEdit:!0,canRemove:!0});l();n.menuAccessRightsDialogHelper.hide()}function ci(i){var u,f,s,h;i.classList.contains("unselectable")||(u=n.selected[i.id],f=u===undefined||u.canEdit,f&&(s=i.classList.toggle("selected"),o(i.id,s)),i.classList.contains("us-groupname")||i.classList.contains("us-linkname")?c(t.root):(h=i.getAttribute("data-group"),h===null?c(t.root):c(t.group)),k(!f)||(n.selectionMode=t.none,n.contentListParentElement.classList.remove("rootonly"),n.openedGroupElement?e(r(n.openedGroupElement.id)):r()))}function li(i){n.selectionMode==t.root||i.classList.contains("unopenable")||e(i)}function ai(i,r){n.selectionMode==t.root||ri(i,r)}function vi(){}function e(t,i){t&&!t.classList.contains("unopenable")&&(t!=n.openedGroupElement||i?(n.openedGroupElement&&(n.openedGroupElement.parentElement.classList.remove("opened"),t.id!=n.openedGroupElement.id&&(n.pagging.usersItemsNumber=0)),yi(t.nextElementSibling,t.id),t.parentElement.classList.add("opened"),n.openedGroupElement=t):t.parentElement.classList.toggle("opened"))}function yi(t,i){var u=d(i,0,Math.max(n.pagging.usersItemsNumber,n.pagging.renderBy)-1),r;n.pagging.usersItemsNumber=u.count;r=n.userDomGenerator.createGroupItems();r.append(u.fragment);t.replaceWith(r)}function d(r,u,e){var s={fragment:document.createDocumentFragment(),count:-1},y=n.selected[r].access,p=i(y),w=n.groupCache[r].users,h,c,v,l,o;for(h of w)if((c=n.userCache[h],c)&&(s.count++,!(s.count<u))){if(s.count>e)break;v=n.tmpSelected[h]!==undefined;l=n.selected[h];l?(o=Object.assign({},l),o.group=r,o.selected=v,o.disabled=n.selectionMode==t.group&&!l.canEdit,o.withoutTitle=n.viewSettings.showTooltop,o.individual=!0,o.individualText=f.IndividualRights,s.fragment.append(n.userDomGenerator.createGroupItem(o))):(o={id:h,group:r,name:c.displayName,avatar:c.avatarSmall,selected:v,access:y,accessName:p},o.withoutTitle=n.viewSettings.showTooltop,s.fragment.append(n.userDomGenerator.createGroupItem(o)))}return s.count>e?(s.fragment.append(n.userDomGenerator.createShowMoreRow({name:a.UserSelectorShowMore,group:r})),s):(s.count++,s)}function r(t){var r=g(t,0,Math.max(n.pagging.contentItemsNumber,n.pagging.renderBy)-1),i;return n.pagging.contentItemsNumber=r.count,i=n.userDomGenerator.createContentList(),i.append(r.fragment),n.contentListElement.replaceWith(i),n.contentListElement=i,n.$emptyList.toggle(n.pagging.contentItemsNumber==0),r.outGroupElement}function g(i,r,u){var o={fragment:document.createDocumentFragment(),count:-1,outGroupElement:null},c=n.selectionMode==t.group,y=n.selectionMode==t.root,s,e,l,h,v;for(s in n.selected)if((e=Object.assign({},n.selected[s]),!e.isLink||e.canEdit)&&(o.count++,!(o.count<r))){if(o.count>u)break;e.selected=!c&&n.tmpSelected[s]!=undefined;e.disabled=c||y&&!e.canEdit;e.isLink?(e.shortened=p(e.link),e.shortenedText=f.Shortened,l=n.userDomGenerator.createLink(e),o.fragment.append(l)):e.isGroup?(h=n.userDomGenerator.createGroup(e),s==i&&(o.outGroupElement=h.querySelector(".us-name")),o.fragment.append(h)):(e.withoutTitle=n.viewSettings.showTooltop,v=n.userDomGenerator.createGroupItem(e),o.fragment.append(v))}return o.count>u?(o.fragment.append(n.userDomGenerator.createShowMoreRow({name:a.UserSelectorShowMore})),o):(o.count++,o)}function nt(){function t(t){var i=n.userDomGenerator.createAccessRightsImgDialogContent(n.accessRights);n.userDomGenerator.clearElement(t);t.append(i)}function i(t){var i=n.userDomGenerator.createAccessRightsDialogContent(n.accessRights);t.replaceWith(i)}t(n.$menuAccessRightsDialog.get(0));t(n.$itemAccessRightsDialog.get(0));i(n.$menuSelectDialog.find(".dropdown-content:last").get(0))}function tt(t,i,r,u,f){var e,o;for(e of n.accessRights)if(!e.disabled){if(f&&e.id!=ASC.Files.Constants.AceStatusEnum.Restrict){t.find(".access-rights-item[data-id="+e.id+"]").hide();continue}o=!(e.hideForVisitor&&u)&&(e.id==ASC.Files.Constants.AceStatusEnum.ReadWrite?i:!0)&&(e.id==ASC.Files.Constants.AceStatusEnum.FillForms?r:!0);t.find(".access-rights-item[data-id="+e.id+"]").toggle(o)}}function pi(){n.saveActionDialogHelper.hide();var t=jq(this);if(t.is(n.$saveActionDialogMessage)){n.messageDialogHelper.show();return}if(t.is(n.$saveActionDialogSilent)){n.save(!1,"");return}if(t.is(n.$saveActionDialogCopy)){n.save(!0,"");return}}function wi(){return n.$settingsBtn.hasClass("disable")?!1:(n.$advancedSettingsDialogDenyDownloadCbx.prop("disabled",!1),n.$advancedSettingsDialogDenyDownloadLabel.removeClass("gray-text").show(),n.$advancedSettingsDialogDenySharingCbx.prop("disabled",!1),n.$advancedSettingsDialogDenySharingLabel.removeClass("gray-text").show(),ASC.Files.Folders&&ASC.Files.Folders.folderContainer=="corporate"&&(n.viewSettings.denySharing=!1,n.$advancedSettingsDialogDenySharingCbx.prop("disabled",!0),n.$advancedSettingsDialogDenySharingLabel.addClass("gray-text").hide()),n.targetData.encrypted&&(n.viewSettings.denyDownload=!1,n.$advancedSettingsDialogDenyDownloadCbx.prop("disabled",!0),n.$advancedSettingsDialogDenyDownloadLabel.addClass("gray-text").hide()),n.$advancedSettingsDialogDenyDownloadCbx.prop("checked",n.viewSettings.denyDownload),n.$advancedSettingsDialogDenySharingCbx.prop("checked",n.viewSettings.denySharing),!0)}function bi(){return rr(),rt(),!0}function ki(){return it(),n.$linkShareDialogSocialContainer.find(".facebook, .twitter").toggle(n.$linkSettingsInput.data("social")),!0}function it(){var t=n.selected[n.currentElement.id].link,i;n.$linkShareDialogInput.val(t);i=encodeURIComponent(t);ASC.Resources.Master.UrlShareFacebook?n.$linkShareDialogSocialContainer.find(".facebook").attr("href",ASC.Resources.Master.UrlShareFacebook.format(i,encodeURIComponent(n.viewSettings.title),"","")):n.$linkShareDialogSocialContainer.find(".facebook").remove();ASC.Resources.Master.UrlShareTwitter?n.$linkShareDialogSocialContainer.find(".twitter").attr("href",ASC.Resources.Master.UrlShareTwitter.format(i)):n.$linkShareDialogSocialContainer.find(".twitter").remove();var r=ASC.Files.FilesJSResource.shareLinkMailSubject.format(n.viewSettings.title),u=ASC.Files.FilesJSResource.shareLinkMailBody.format(n.viewSettings.title,t);n.$linkShareDialogSocialContainer.find(".mail").attr("href","mailto:?subject={1}&body={0}".format(encodeURIComponent(u),encodeURIComponent(r)))}function di(){return y(),!0}function gi(t){var f=t.getAttribute("href"),i,r;if(t.classList.contains("mail")&&!ASC.Resources.Master.Personal){i=window.open(ASC.Desktop?"":ASC.Files.Constants.URL_LOADER);r=new ASC.Mail.Message;r.subject=ASC.Files.FilesJSResource.shareLinkMailSubject.format(n.viewSettings.title);var e='<a href="{0}">{1}<\/a>',u=n.selected[n.currentElement.id].link,o=e.format(Encoder.htmlEncode(u),Encoder.htmlEncode(n.viewSettings.title)),s=e.format(Encoder.htmlEncode(u),Encoder.htmlEncode(u)),h=ASC.Files.FilesJSResource.shareLinkMailBody.format(o,s);return r.body=h,ASC.Mail.Utility.SaveMessageInDrafts(r).done(function(n,t){var r=t.messageUrl;i&&i.location?i.location.href=r:i=window.open(r,"_blank")}).fail(function(){i.close();window.location.href=f}),!1}return window.open(f,"new","height=600,width=1020,fullscreen=0,resizable=0,status=0,toolbar=0,menubar=0,location=1"),!1}function y(){var r=jq(this),t,i;r.is(".embed-size-item")&&(r.hasClass("embed-size-6x8")?(n.$linkEmbedDialogSizeCustomWidth.val("600px"),n.$linkEmbedDialogSizeCustomHeight.val("800px")):r.hasClass("embed-size-4x6")?(n.$linkEmbedDialogSizeCustomWidth.val("400px"),n.$linkEmbedDialogSizeCustomHeight.val("600px")):(n.$linkEmbedDialogSizeCustomWidth.val("100%"),n.$linkEmbedDialogSizeCustomHeight.val("100%")));t=n.$linkEmbedDialogSizeCustomWidth.val();i=n.$linkEmbedDialogSizeCustomHeight.val();t=(/\d+(px|%)?/gim.exec(t.toLowerCase().trim())||["100%"])[0];t==Math.abs(t)&&(t+="px");i=(/\d+(px|%)?/gim.exec(i.toLowerCase().trim())||["100%"])[0];i==Math.abs(i)&&(i+="px");n.$linkEmbedDialogSizeCustomWidth.val(t);n.$linkEmbedDialogSizeCustomHeight.val(i);jq(".embed-size-item").removeClass("selected");t=="600px"&&i=="800px"?jq(".embed-size-6x8").addClass("selected"):t=="400px"&&i=="600px"?jq(".embed-size-4x6").addClass("selected"):t=="100%"&&i=="100%"&&jq(".embed-size-1x1").addClass("selected");nr(t,i)}function nr(t,i){t=t||"100%";i=i||"100%";var u=n.selected[n.currentElement.id].link,r="";ASC.Files.Utility.CanWebView(n.viewSettings.title)?(r='<iframe src="{0}" width="{1}" height="{2}" frameborder="0" scrolling="no" allowtransparency><\/iframe>',u=u+"&action=embedded"):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(n.viewSettings.title)&&(r='<img src="{0}" width="{1}" height="{2}" alt="" />');r=r.format(u,t,i);n.$linkEmbedDialogInput.val(r).attr("title",r)}function rt(){var i=n.selected[n.currentElement.id].link,t=p(i);n.currentElement.classList.toggle("shortened",t);n.$linkActionDialogShort.toggle(!t);n.$linkShareDialogShort.toggle(!t)}function p(n){return n?!new RegExp("/Products/Files/","i").test(n):!1}function ut(){var t=n.targetData.entryData?n.targetData.entryData.id:ASC.Files.UI.parseItemId(n.targetData.id).entryId;ASC.Files.ServiceManager.getShortenLink(ASC.Files.ServiceManager.events.GetShortenLink,{fileId:t})}function tr(t,i,r){if(!t||typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.OperationFailedMsg,!0);return}n.selected[n.currentElement.id].link=t;it();rt();ir(t)?ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess):ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.OperationSuccededMsg)}function ir(n){var t=document.createElement("input");t.setAttribute("type","text");t.setAttribute("value",n);t=document.body.appendChild(t);t.select();try{return document.execCommand("copy")}catch(i){return!1}finally{t.remove()}}function rr(){var t=ASC.Files.Utility.CanWebView(n.viewSettings.title)||typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(n.viewSettings.title);n.$linkActionDialogEmbed.toggle(t)}function ft(){return this.select(),!1}function et(n){return n.ctrlKey&&(n.charCode===ASC.Files.Common.keyCode.C||n.keyCode===ASC.Files.Common.keyCode.insertKey)}function ur(){if(!ASC.Clipboard.enable){n.$linkActionDialogCopy.remove();n.$linkShareDialogCopy.remove();n.$linkEmbedDialogCopy.remove();n.$saveActionDialogCopyParent.remove();n.$saveActionDialogSeporator.remove();return}n.clipboard.internalLink=ASC.Clipboard.createManually(n.$saveActionDialogCopy.get(0),{text:function(){return window.location.protocol+"//"+window.location.hostname+n.targetData.entryLink}},function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess)});n.clipboard.externalLinkAction=ASC.Clipboard.createManually(n.$linkActionDialogCopy.get(0),{text:function(){return n.selected[n.currentElement.id].link}},function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess)});n.clipboard.externalLinkShare=ASC.Clipboard.createManually(n.$linkShareDialogCopy.get(0),{text:function(){return n.selected[n.currentElement.id].link}},function(){ASC.Files.UI.displayInfoPanel(ASC.Resources.Master.ResourceJS.LinkCopySuccess)});n.clipboard.externalLinkEmbed=ASC.Clipboard.createManually(n.$linkEmbedDialogCopy.get(0),{target:function(){return n.$linkEmbedDialogInput.get(0)}},function(){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.CodeCopySuccess)})}function fr(t,i,r,u){var o=Array.isArray(t),f,s,e;if(n.targetData.id=o&&t.length==1?t[0]:t,n.targetData.sharingInfo=null,n.targetData.ownerId=null,n.targetData.multiple=Array.isArray(n.targetData.id),n.targetData.encrypted=!1,n.targetData.entryData=null,n.targetData.entryLink=null,n.targetData.isThirdparty=r?u:!1,n.targetData.multiple){ASC.Files.ThirdParty&&(n.targetData.isThirdparty=t.some(function(n){var t=ASC.Files.UI.parseItemId(n),i=ASC.Files.UI.getEntryObject(t.entryType,t.entryId),r=ASC.Files.UI.getObjectData(i);return ASC.Files.ThirdParty.isThirdParty(r)}));return}f=ASC.Files.UI.parseItemId(o?t[0]:t);s=ASC.Files.UI.getEntryObject(f.entryType,f.entryId);n.targetData.entryData=ASC.Files.UI.getObjectData(s);n.targetData.entryData?(n.targetData.encrypted=n.targetData.entryData.encrypted,n.targetData.isThirdparty=ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(n.targetData.entryData)):r===!0&&ASC.Desktop&&ASC.Desktop.setAccess&&(n.targetData.encrypted=!0);n.targetData.encrypted||(e=ASC.Files.UI.getEntryLink(f.entryType,f.entryId,o?i[0]:i),n.targetData.entryLink=e.indexOf(ASC.Files.Constants.URL_BASE)>-1?e:ASC.Files.Constants.URL_BASE+e)}function er(t,i,r,u,f,e,o){var h=Array.isArray(t),c,s;n.viewSettings.title=n.targetData.multiple?t.length.toString():n.targetData.entryData?n.targetData.entryData.title:h?i[0]:i;n.viewSettings.asFlat=r;n.viewSettings.showTooltop=!r&&!ASC.Desktop;n.viewSettings.rootFolderType=u;n.viewSettings.notifyAvailable=!u&&(!ASC.Files.Folders||ASC.Files.Folders.folderContainer=="my"||ASC.Files.Folders.folderContainer=="forme"||ASC.Files.Folders.folderContainer=="privacy");n.viewSettings.externalLinksAvailable=!1;n.viewSettings.externalLinksEnabled=!1;n.viewSettings.originForPost=r&&f?f:"*";n.viewSettings.displaySettings=!n.targetData.isThirdparty;n.viewSettings.denyDownload=r?e:n.targetData.entryData?n.targetData.entryData.deny_download:!1;n.viewSettings.denySharing=r?o:n.targetData.entryData?n.targetData.entryData.deny_sharing:!1;n.viewSettings.canWebCustomFilterEditing=!1;n.viewSettings.canWebReview=!1;n.viewSettings.canWebRestrictedEditing=!1;n.viewSettings.canWebComment=!1;n.viewSettings.canLinkReadWrite=!1;n.targetData.multiple?(n.viewSettings.canWebCustomFilterEditing=!0,n.viewSettings.canWebReview=!0,n.viewSettings.canWebRestrictedEditing=!0,n.viewSettings.canWebComment=!0,i.forEach(function(i,r){return ASC.Files.UI.parseItemId(t[r]).entryType=="folder"?(n.viewSettings.displaySettings=n.viewSettings.canWebCustomFilterEditing=n.viewSettings.canWebReview=n.viewSettings.canWebRestrictedEditing=n.viewSettings.canWebComment=!1,!1):(ASC.Files.Utility.CanWebCustomFilterEditing(i)||(n.viewSettings.canWebCustomFilterEditing=!1),ASC.Files.Utility.CanWebReview(i)||(n.viewSettings.canWebReview=!1),ASC.Files.Utility.CanWebRestrictedEditing(i)||(n.viewSettings.canWebRestrictedEditing=!1),ASC.Files.Utility.CanWebComment(i)||(n.viewSettings.canWebComment=!1),ASC.Files.Utility.CanWebView(i)||(n.viewSettings.displaySettings=!1),n.viewSettings.canWebCustomFilterEditing||n.viewSettings.canWebReview||n.viewSettings.canWebRestrictedEditing||n.viewSettings.canWebComment)}),(n.targetData.isThirdparty||ASC.Files.Folders.folderContainer=="privacy")&&(n.viewSettings.canWebRestrictedEditing=!1)):(c=n.targetData.entryData?n.targetData.entryData.entryType:ASC.Files.UI.parseItemId(h?t[0]:t).entryType,s=n.viewSettings.title,c=="file"?(n.viewSettings.canWebCustomFilterEditing=ASC.Files.Utility.CanWebCustomFilterEditing(s),n.viewSettings.canWebReview=ASC.Files.Utility.CanWebReview(s),n.viewSettings.canWebRestrictedEditing=ASC.Files.Utility.CanWebRestrictedEditing(s),n.viewSettings.canWebComment=ASC.Files.Utility.CanWebComment(s),n.viewSettings.canLinkReadWrite=ASC.Files.Utility.CanWebEdit(s)&&!ASC.Files.Utility.MustConvert(s),n.viewSettings.displaySettings=n.viewSettings.displaySettings&&ASC.Files.Utility.CanWebView(s),n.targetData.isThirdparty&&(n.viewSettings.canWebRestrictedEditing=!1)):n.viewSettings.displaySettings=!1)}function or(t,i,r,u,f,e,o,s,h){fr(t,i,r,s);er(t,i,r,u,f,e,o);var c={entry:n.targetData.multiple?t:[t]};ASC.Files.ServiceManager.getSharedInfo(ASC.Files.ServiceManager.events.GetSharedInfo,{showLoading:!0,defaultAccessRights:h},{stringList:c})}function sr(t){n.targetData.sharingInfo=t;n.targetData.needUpdate=!1;var r={};return t.forEach(function(t){t.id===ASC.Files.Constants.ShareLinkId?(n.viewSettings.externalLinksAvailable=n.$linkSettingsInput.data("available"),n.viewSettings.externalLinksEnabled=t.ace_status!=ASC.Files.Constants.AceStatusEnum.Restrict,n.targetData.encrypted=!1,r[t.id]={id:t.id,link:t.link,name:f.ExternalLink+(n.viewSettings.externalLinksAvailable?"":" ("+f.ExternalLinkDisabled+")"),isLink:!0,canEdit:n.viewSettings.externalLinksEnabled,canRemove:n.viewSettings.externalLinksEnabled,access:t.ace_status,accessName:i(t.ace_status)}):t.is_group?r[t.id]={id:t.id,name:t.title,isGroup:!0,canEdit:!t.locked,canRemove:!(t.locked||t.disable_remove),canOpen:n.groupCache[t.id]!==undefined,access:t.ace_status,accessName:i(t.ace_status)}:(n.userCache[t.id]||(n.userCache[t.id]=window.UserManager.getUser(t.id)),r[t.id]={id:t.id,name:t.title,avatar:n.userCache[t.id].avatarSmall,isOwner:t.owner,canEdit:!(t.locked||t.owner),canRemove:!(t.locked||t.owner||t.disable_remove),access:t.ace_status,accessName:i(t.owner?"owner":t.ace_status)},t.owner&&(n.targetData.ownerId=t.id,!ASC.Files.Folders||ASC.Files.Folders.folderContainer!="corporate"||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty()||n.targetData.isThirdparty||(r[t.id].canChange=!0)))}),r}function hr(){var t=[{id:ASC.Files.Constants.AceStatusEnum.ReadWrite,name:i(ASC.Files.Constants.AceStatusEnum.ReadWrite),hideForVisitor:!n.targetData.entryData||n.targetData.entryData.entryType=="file"}];return n.targetData.encrypted||(n.viewSettings.canWebCustomFilterEditing&&t.push({id:ASC.Files.Constants.AceStatusEnum.CustomFilter,name:i(ASC.Files.Constants.AceStatusEnum.CustomFilter),hideForVisitor:!0}),n.viewSettings.canWebReview&&t.push({id:ASC.Files.Constants.AceStatusEnum.Review,name:i(ASC.Files.Constants.AceStatusEnum.Review),hideForVisitor:!0}),n.viewSettings.canWebRestrictedEditing&&t.push({id:ASC.Files.Constants.AceStatusEnum.FillForms,name:i(ASC.Files.Constants.AceStatusEnum.FillForms),hideForVisitor:!0}),n.viewSettings.canWebComment&&t.push({id:ASC.Files.Constants.AceStatusEnum.Comment,name:i(ASC.Files.Constants.AceStatusEnum.Comment),hideForVisitor:!0}),t.push({id:ASC.Files.Constants.AceStatusEnum.Read,name:i(ASC.Files.Constants.AceStatusEnum.Read),hideForVisitor:!1})),t.push({id:ASC.Files.Constants.AceStatusEnum.Restrict,name:i(ASC.Files.Constants.AceStatusEnum.Restrict),hideForVisitor:!1}),t.push({id:ASC.Files.Constants.AceStatusEnum.Varies,name:i(ASC.Files.Constants.AceStatusEnum.Varies),hideForVisitor:!1,disabled:!0}),t}function cr(t,i){var e=jq("#defaultAccessRightsSetting"),u,f,o,r;e.length?(u=+e.find("input[type=radio]:checked").val(),f=[],e.find("input[type=checkbox]:checked").each(function(){f.push(+this.value)})):i&&(u=i.pop(),f=i);o=[];for(r of t)if(!r.disabled){if(f.indexOf(r.id)!=-1)return r.id;o.push(r.id)}return o.indexOf(u)!=-1?u:n.targetData.encrypted?ASC.Files.Constants.AceStatusEnum.ReadWrite:ASC.Files.Constants.AceStatusEnum.Read}function lr(t,i,r){if(typeof r!="undefined"||typeof t=="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}var f=sr(t),u=hr(),e=cr(u,i.defaultAccessRights);n.changeData(f,u,e);n.show()}function i(n){if(n=="owner")return ASC.Files.FilesJSResource.AceStatusEnum_Owner;n=parseInt(n);switch(n){case ASC.Files.Constants.AceStatusEnum.Read:return ASC.Files.FilesJSResource.AceStatusEnum_Read;case ASC.Files.Constants.AceStatusEnum.ReadWrite:return ASC.Files.FilesJSResource.AceStatusEnum_ReadWrite;case ASC.Files.Constants.AceStatusEnum.CustomFilter:return ASC.Files.FilesJSResource.AceStatusEnum_CustomFilter;case ASC.Files.Constants.AceStatusEnum.Restrict:return ASC.Files.FilesJSResource.AceStatusEnum_Restrict;case ASC.Files.Constants.AceStatusEnum.Varies:return ASC.Files.FilesJSResource.AceStatusEnum_Varies;case ASC.Files.Constants.AceStatusEnum.Review:return ASC.Files.FilesJSResource.AceStatusEnum_Review;case ASC.Files.Constants.AceStatusEnum.FillForms:return ASC.Files.FilesJSResource.AceStatusEnum_FillForms;case ASC.Files.Constants.AceStatusEnum.Comment:return ASC.Files.FilesJSResource.AceStatusEnum_Comment;default:return""}}function ar(){n.targetData.needUpdate?vr():ot(null)}function vr(){ASC.Files.ServiceManager.getSharedInfoShort(ASC.Files.ServiceManager.events.GetSharedInfoShort,{showLoading:!0,objectID:n.targetData.id})}function ot(t,i,r){var u,f;if(typeof r!="undefined"||typeof t=="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}u=t?{needUpdate:!0,sharingSettings:t}:{needUpdate:!1};u.Referer="onlyoffice";f=JSON.stringify(u);window.parent.postMessage(f,n.viewSettings.originForPost)}function yr(t,i,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}n.targetData.entryData&&n.targetData.entryData.entryObject.toggleClass("__active",t)}function pr(t,i){var f=[],h=null,e=!0,c,r,o,u,s,l;for(c in n.selected){r=n.selected[c];o=!0;for(u of n.targetData.sharingInfo)if(u.id===r.id){o=u.ace_status!=r.access;break}o&&f.push({id:r.id,is_group:r.isGroup,ace_status:r.access});r.isOwner&&r.id!=n.targetData.ownerId&&(h=r.id);e&&(e=r.isOwner||r.isLink&&r.access==ASC.Files.Constants.AceStatusEnum.Restrict)}for(u of n.targetData.sharingInfo)n.selected[u.id]||f.push({id:u.id,is_group:u.isGroup,ace_status:ASC.Files.Constants.AceStatusEnum.None});f.length&&(n.targetData.needUpdate=!0);e&&(n.viewSettings.denyDownload=!1,n.viewSettings.denySharing=!1);s=n.viewSettings.displaySettings?{denyDownload:!!n.viewSettings.denyDownload,denySharing:!!n.viewSettings.denySharing}:undefined;l={entries:{entry:n.targetData.id},aces:{entry:f},message:i,advancedSettings:s};ASC.Files.ServiceManager.setAceObject(ASC.Files.ServiceManager.events.SetAceObject,{owner:h,showLoading:!0,notify:t,advancedSettings:s},{ace_collection:l})}function wr(t,i,r){var e,u,f,o;if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}e=n.targetData.multiple?n.targetData.id:[n.targetData.id];for(o of e)u=ASC.Files.UI.parseItemId(o),f=ASC.Files.UI.getEntryObject(u.entryType,u.entryId),f.toggleClass("__active",t.indexOf(o)>-1),i.advancedSettings&&(ASC.Files.UI.setObjectData(f,"data-deny_download",i.advancedSettings.denyDownload),ASC.Files.UI.setObjectData(f,"data-deny_sharing",i.advancedSettings.denySharing));i.owner&&ASC.Files.Folders.changeOwner(e,i.owner);n.targetData.encrypted&&ASC.Desktop&&ASC.Desktop.setAccess&&(LoadingBanner&&LoadingBanner.displayLoading(),ASC.Files.UI.blockObject(n.targetData.id,!0,ASC.Files.FilesJSResource.DescriptCreate),ASC.Desktop.setAccess(u.entryId,function(t){t&&(ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.DesktopMessageStoring),ASC.Files.Folders?ASC.Files.Folders.replaceFileStream(u.entryId,"",t,!0,null,!0):Teamlab.updateFileStream({fileId:u.entryId,encrypted:!0,forcesave:!0},t));LoadingBanner&&LoadingBanner.hideLoading();n.hide()}))}function br(t,i){n.tooltipTimeout=setTimeout(function(){var u=i&&n.openedGroupElement?n.openedGroupElement.nextElementSibling.children[t]:n.contentListElement.children[t];if(u){var r=n.userCache[t],f=n.groupCache[i||r.groups[0]],e={avatar:r.avatarBig,userName:new URL(window.location.protocol+"//"+window.location.hostname+r.profileUrl).searchParams.get("user"),displayName:r.displayName,groups:f?[f]:null,title:r.title},o=jq.tmpl("userProfileCardTmpl",e);n.$itemTooltipDialog.html(o);s(u,n.itemTooltipDialogHelper,n.$itemTooltipDialog,8)}},1e3)}function st(t){n.$itemTooltipDialog.is(t.relatedTarget)||n.$itemTooltipDialog.has(t.relatedTarget).length||(clearTimeout(n.tooltipTimeout),n.itemTooltipDialogHelper.hide())}function kr(){n.$linkSettingsInput.data("available",jq("#cbxExternalShare").prop("checked")).data("social",jq("#cbxExternalShareSocialMedia").prop("checked"))}function dr(){ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetShortenLink,tr);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfoShort,ot);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetSharedInfo,lr);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceLink,yr);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SetAceObject,wr);n.$topButtonContainer.append(n.userSelector.dialogElement);n.userSelectorDialogHelper=new DialogHelper(n.$addUserBtn.get(0),n.userSelector.dialogElement,ct,null,!1,!0);n.userSelector.onCancel=n.userSelectorDialogHelper.hide;n.$addLinkBtn.on("click",vt);n.searchDialogHelper=new DialogHelper(null,n.$searchDialog.get(0),pt,wt,!0,!0);n.$searchInput.on("click",function(n){n.stopPropagation()});n.$searchDialogContentListParent.on("click",".us-name, .us-show-more",function(n){this.classList.contains("us-show-more")?dt(this,n):kt(this,n)});n.$contentListParent.on("click",".us-name, .us-show-more",function(n){this.classList.contains("disabled")||(this.classList.contains("us-show-more")?fi(this,n):this.classList.contains("changeable")&&n.target==this.querySelector(".us-name-text span")?ei(this,n):n.target.classList.contains("us-access")?oi(this,n):n.target.classList.contains("us-avatar")?ci(this,n):this.classList.contains("us-groupname")?li(this,n):this.classList.contains("us-linkname")?ai(this,n):vi(this,n))});n.itemTooltipDialogHelper=new DialogHelper(null,n.$itemTooltipDialog.get(0));n.$contentListParent.on("mouseover mouseout",".us-name:not(.us-linkname):not(.us-groupname):not(.disabled) .us-name-text span",function(n){var t=this.closest(".us-name");n.type=="mouseover"&&br(t.id,t.getAttribute("data-group"));n.type=="mouseout"&&st(n)});n.$itemTooltipDialog.on("mouseout",st);n.menuSelectDialogHelper=new DialogHelper(n.$menuActionSelectAll.get(0),n.$menuSelectDialog.get(0));n.$menuSelectDialog.on("click",".dropdown-item",function(n){ni(this,n)});n.$menuActionSelectAllCbx.on("click",function(t){t.stopPropagation();n.menuSelectDialogHelper.hide();gt(this,t)});n.menuAccessRightsDialogHelper=new DialogHelper(n.$menuActionChangeBtn.get(0),n.$menuAccessRightsDialog.get(0),ti);n.$menuAccessRightsDialog.on("click",".access-rights-item",function(n){hi(this,n);u()});n.$menuActionRemoveBtn.on("click",function(n){this.classList.contains("unlockAction")&&(ii(this,n),u())});n.$menuActionCloseBtn.on("click",function(n){l(this,n)});n.linkActionDialogHelper=new DialogHelper(null,n.$linkActionDialog.get(0),bi);n.$linkActionDialog.on("click",".dropdown-item",function(n){ui(this,n)});n.linkShareDialogHelper=new DialogHelper(null,n.$linkShareDialog.get(0),ki);n.$linkShareDialogInput.on("mousedown",ft);n.$linkShareDialogInput.on("keypress",et);n.$linkShareDialogSocialContainer.on("click","a",function(n){return gi(this,n)});n.$linkShareDialogShort.on("click",ut);n.linkEmbedDialogHelper=new DialogHelper(null,n.$linkEmbedDialog.get(0),di);n.$linkEmbedDialogSizeItem.on("click",y);n.$linkEmbedDialogSizeCustom.on("change",y);n.$linkEmbedDialogInput.on("mousedown",ft);n.$linkEmbedDialogInput.on("keypress",et);n.itemAccessRightsDialogHelper=new DialogHelper(null,n.$itemAccessRightsDialog.get(0));n.$itemAccessRightsDialog.on("click",".access-rights-item",function(n){si(this,n)});n.$saveBtnMain.on("click",function(){n.save(!0,"")});n.saveActionDialogHelper=new DialogHelper(n.$saveBtnArrow.get(0),n.$saveActionDialog.get(0));n.$saveActionDialog.on("click",".dropdown-item",pi);n.$cancelBtn.on("click",function(){n.hide()});n.messageDialogHelper=new DialogHelper(null,n.$messageDialog.get(0));n.$messageDialogSaveBtn.on("click",function(){n.messageDialogHelper.hide();n.save(!0,n.$messageDialogTextarea.val().trim())});n.$messageDialogCancelBtn.on("click",function(){n.messageDialogHelper.hide()});n.advancedSettingsDialogHelper=new DialogHelper(n.$settingsBtn.get(0),n.$advancedSettingsDialog.get(0),wi);n.$advancedSettingsDialogSaveBtn.on("click",function(){n.viewSettings.denyDownload=n.$advancedSettingsDialogDenyDownloadCbx.prop("checked");n.viewSettings.denySharing=n.$advancedSettingsDialogDenySharingCbx.prop("checked");n.advancedSettingsDialogHelper.hide();u()});n.$advancedSettingsDialogCancelBtn.on("click",function(){n.advancedSettingsDialogHelper.hide()});ur()}var a=ASC.Resources.Master.ResourceJS,f=ASC.Files.FilesJSResource,n={},t={none:0,root:1,group:2},v;return n.userCache=window.UserManager.getAllUsers(!0),n.groupCache=window.GroupManager.getAllGroups(),n.accessRights=[],n.defaultAccessRight=null,n.defaultAccessRightForVisitor=null,n.selected={},n.tmpSelected={},n.pagging={renderBy:100,searchItemsNumber:0,contentItemsNumber:0,usersItemsNumber:0},n.searchResult=null,n.selectionMode=t.none,n.currentElement=null,n.openedGroupElement=null,n.tooltipTimeout=null,n.clipboard={internalLink:null,externalLinkAction:null,externalLinkShare:null,externalLinkEmbed:null},n.targetData={id:null,sharingInfo:null,needUpdate:!1,ownerId:null,multiple:!1,encrypted:!1,entryData:null,entryLink:null,isThirdparty:!1},n.viewSettings={title:"",notifyAvailable:!1,externalLinksAvailable:!1,externalLinksEnabled:!1,asFlat:!1,showTooltop:!1,rootFolderType:!1,originForPost:"*",displaySettings:!1,denyDownload:!1,denySharing:!1,canWebCustomFilterEditing:!1,canWebReview:!1,canWebRestrictedEditing:!1,canWebComment:!1,canLinkReadWrite:!1},n.$dialog=jq("#sharingDialog"),n.$dialogHeader=n.$dialog.find(".containerHeaderBlock td:first-of-type"),n.$topButtonContainer=n.$dialog.find(".top-button-container"),n.$addUserBtn=n.$topButtonContainer.find(".user-button"),n.$addLinkBtn=n.$topButtonContainer.find(".link-button"),n.$linkSettingsInput=n.$topButtonContainer.find(".link-settings"),n.$bottomButtonContainer=n.$dialog.find(".bottom-button-container"),n.$saveBtnMain=n.$bottomButtonContainer.find(".button.blue.main-part"),n.$saveBtnArrow=n.$bottomButtonContainer.find(".button.blue.arrow-part"),n.$cancelBtn=n.$bottomButtonContainer.find(".button.gray"),n.$settingsBtn=n.$bottomButtonContainer.find(".settings-link"),n.$actionsContainer=n.$dialog.find(".group-actions"),n.$menuActionSelectAll=n.$actionsContainer.find(".menuActionSelectAll"),n.$menuActionSelectAllCbx=n.$menuActionSelectAll.find("input[type=checkbox]"),n.$menuActionChangeBtn=n.$actionsContainer.find(".menuActionChange"),n.$menuActionRemoveBtn=n.$actionsContainer.find(".menuActionRemove"),n.$menuActionCloseBtn=n.$actionsContainer.find(".menuActionClose"),n.$menuSelectDialog=n.$actionsContainer.find(".menu-select-dialog"),n.$menuAccessRightsDialog=n.$actionsContainer.find(".menu-access-rights-dialog"),n.$searchContainer=n.$dialog.find(".us-hot-search"),n.$searchInput=n.$searchContainer.find(".textEdit"),n.$searchDialog=n.$searchContainer.find(".us-popup-dialog"),n.$searchDialogContentListParent=n.$searchDialog.find(".us-list-parent"),n.$contentListParent=n.$dialog.find(".content-list"),n.$itemAccessRightsDialog=n.$contentListParent.find(".item-access-rights-dialog"),n.$linkActionDialog=n.$contentListParent.find(".link-action-dialog"),n.$linkShareDialog=n.$contentListParent.find(".link-share-dialog"),n.$linkEmbedDialog=n.$contentListParent.find(".link-embed-dialog"),n.$itemTooltipDialog=n.$contentListParent.find(".item-tooltip-dialog"),n.$linkShareDialogSocialContainer=n.$linkShareDialog.find(".link-share-social"),n.$linkShareDialogInput=n.$linkShareDialog.find(".link-share-around input"),n.$linkEmbedDialogSizeItem=n.$linkEmbedDialog.find(".embed-size-item"),n.$linkEmbedDialogSizeCustom=n.$linkEmbedDialog.find(".embed-size-custom"),n.$linkEmbedDialogSizeCustomWidth=n.$linkEmbedDialog.find(".embed-size-width"),n.$linkEmbedDialogSizeCustomHeight=n.$linkEmbedDialog.find(".embed-size-height"),n.$linkEmbedDialogInput=n.$linkEmbedDialog.find(".link-embed-around input"),n.$linkActionDialogCopy=n.$linkActionDialog.find(".link-action-copy"),n.$linkShareDialogCopy=n.$linkShareDialog.find(".link-share-action-copy"),n.$linkEmbedDialogCopy=n.$linkEmbedDialog.find(".link-embed-action-copy"),n.$linkActionDialogEmbed=n.$linkActionDialog.find(".link-action-embed"),n.$linkActionDialogShort=n.$linkActionDialog.find(".link-action-short"),n.$linkShareDialogShort=n.$linkShareDialog.find(".link-share-action-short"),n.$emptyList=n.$dialog.find(".empty-list"),n.$saveActionDialog=n.$dialog.find(".save-action-dialog"),n.$saveActionDialogMessage=n.$saveActionDialog.find(".save-action-message"),n.$saveActionDialogMessageParent=n.$saveActionDialogMessage.parent(),n.$saveActionDialogSilent=n.$saveActionDialog.find(".save-action-silent"),n.$saveActionDialogSilentParent=n.$saveActionDialogSilent.parent(),n.$saveActionDialogCopy=n.$saveActionDialog.find(".save-action-copy"),n.$saveActionDialogCopyParent=n.$saveActionDialogCopy.parent(),n.$saveActionDialogSeporator=n.$saveActionDialogCopyParent.prev(),n.$messageDialog=n.$dialog.find(".message-dialog"),n.$messageDialogTextarea=n.$messageDialog.find("textarea"),n.$messageDialogSaveBtn=n.$messageDialog.find(".button.blue"),n.$messageDialogCancelBtn=n.$messageDialog.find(".button.gray"),n.$advancedSettingsDialog=n.$dialog.find(".advanced-settings-dialog"),n.$advancedSettingsDialogDenyDownloadCbx=n.$advancedSettingsDialog.find(".deny-download"),n.$advancedSettingsDialogDenyDownloadLabel=n.$advancedSettingsDialogDenyDownloadCbx.parent(),n.$advancedSettingsDialogDenySharingCbx=n.$advancedSettingsDialog.find(".deny-sharing"),n.$advancedSettingsDialogDenySharingLabel=n.$advancedSettingsDialogDenySharingCbx.parent(),n.$advancedSettingsDialogSaveBtn=n.$advancedSettingsDialog.find(".button.blue"),n.$advancedSettingsDialogCancelBtn=n.$advancedSettingsDialog.find(".button.gray"),n.searchDialogListParentElement=n.$searchDialogContentListParent.get(0),n.contentListParentElement=n.$contentListParent.get(0),n.contentListElement=n.contentListParentElement.querySelector(".us-list"),n.userDomGenerator=new UserDomGenerator,n.ownerSelector=null,n.userSelector=new UserSelector({userCache:n.userCache,groupCache:n.groupCache,accessRights:n.accessRights,defaultAccessRight:n.defaultAccessRight,selected:n.selected,userDomGenerator:n.userDomGenerator,singleChoice:!1,groupSelection:!0,onSave:function(t,f){var h=n.accessRights.find(function(n){return n.id==f&&!n.hideForVisitor}),c=h?h.id:n.defaultAccessRightForVisitor,e,o,s;for(e in n.selected)t[e]===undefined&&delete n.selected[e];for(e in t)n.selected[e]===undefined&&(o=t[e],s=f,!o.isGroup&&n.userCache[e].isVisitor&&(s=c),o.access=s,o.accessName=i(s),o.canEdit=!0,o.canRemove=!0,n.selected[e]=o);r();u()}}),n.userSearcher=new UserSearcher(n.groupCache,n.userCache,n.$searchContainer.get(0),bt),n.show=function(){n.$addLinkBtn.toggle(n.viewSettings.externalLinksAvailable);n.$addLinkBtn.toggleClass("disable",n.viewSettings.externalLinksEnabled);n.targetData.entryLink?n.$saveActionDialogCopyParent.show():n.$saveActionDialogCopyParent.hide();n.viewSettings.displaySettings=n.viewSettings.displaySettings&&n.targetData.ownerId==Teamlab.profile.id;n.viewSettings.displaySettings?n.$settingsBtn.show():n.$settingsBtn.hide();n.viewSettings.notifyAvailable?(n.$saveActionDialogMessageParent.show(),n.$saveActionDialogSilentParent.show()):(n.$saveActionDialogMessageParent.hide(),n.$saveActionDialogSilentParent.hide());n.targetData.entryLink&&n.viewSettings.notifyAvailable?n.$saveActionDialogSeporator.show():n.$saveActionDialogSeporator.hide();at();n.targetData.entryLink||n.viewSettings.notifyAvailable?(n.$saveBtnMain.addClass("main-part"),n.$saveBtnArrow.removeAttr("style")):(n.$saveBtnMain.removeClass("main-part"),n.$saveBtnArrow.hide());var t=n.viewSettings.rootFolderType||ASC.Files.Folders&&ASC.Files.Folders.folderContainer=="corporate"?ASC.Files.FilesJSResource.AccessSettingsHeader.format(n.viewSettings.title):ASC.Files.FilesJSResource.SharingSettingsHeader.format(n.viewSettings.title);n.viewSettings.showTooltop||n.$contentListParent.off("mouseover mouseout");n.viewSettings.asFlat?(n.$dialog.addClass("flat").show(),PopupKeyUpActionProvider.EnterAction=PopupKeyUpActionProvider.CtrlEnterAction="jq('.button.main-part:visible').trigger('click');",PopupKeyUpActionProvider.CloseDialogAction="ASC.Files.Share.updateForParent();",PopupKeyUpActionProvider.ForceBinding=!0):(n.$dialogHeader.attr("title",t).text(t),StudioBlockUIManager.blockUI(n.$dialog));ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();n.$dialog.trigger("click")},n.hide=function(){PopupKeyUpActionProvider.CloseDialog()},n.save=function(t,i){t=t&&n.viewSettings.notifyAvailable;i=t?i:"";pr(t,i);n.targetData.encrypted||n.hide()},n.changeData=function(t,i,r){n.selected=t;n.accessRights=i;n.defaultAccessRight=r;var u=i.find(function(n){return n.id==r&&!n.hideForVisitor});n.defaultAccessRightForVisitor=u?u.id:ASC.Files.Constants.AceStatusEnum.Read;n.userSelector.changeData(t,i,n.defaultAccessRight);n.pagging.contentItemsNumber=0;n.currentElement=null;n.openedGroupElement=null;nt();l()},v=!1,{init:ht,updateForParent:ar,getSharedInfo:or,changeExternalShareSettings:kr,unSubscribeMe:function(n,t){ASC.Files.Unsubscribe.unSubscribeMe(n,t)}}}();jq(document).ready(function(){(function(){ASC.Files.Share.init();jq("#studioPageContent").on("click","#buttonShare, #mainShare.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();var n=[],t=[];jq("#filesMainContent .file-row:not(.without-share):not(.checkloading):not(.new-folder):not(.new-file):not(.error-entry):not(.files-encrypted):has(.checkbox input:checked)").each(function(){var i=ASC.Files.UI.getObjectData(this),r=i.entryType,u=i.entryId;n.push(r+"_"+u);t.push(i.title)});ASC.Files.Share.getSharedInfo(n,t)});jq("#filesMainContent").on("click",".btn-row",function(){var n=ASC.Files.UI.getObjectData(this),t=n.entryId,i=n.entryType,r=n.title;return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.UI.checkSelectAll(!1),ASC.Files.UI.selectRow(n.entryObject,!0),ASC.Files.UI.updateMainContentHeader(),ASC.Files.Share.getSharedInfo(i+"_"+t,r),!1})})(jQuery)});
window.ASC.Files.Unsubscribe=function(){var n=!1,i=function(){if(!n&&jq("#filesConfirmUnsubscribe").length!=0){ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.UnSubscribeMe,u);jq("#studioPageContent").on("click","#buttonUnsubscribe, #mainUnsubscribe.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();t()});jq("#unsubscribeConfirmBtn").on("click",function(){r()});n=!0}},t=function(n,t){var i;if(ASC.Files.Folders.folderContainer=="forme"||ASC.Files.Folders.folderContainer=="privacy"){var e=[],r="",u="",f='<label title="{0}"><input type="checkbox" class="checkbox" entryType="{1}" entryId="{2}" checked="checked">{0}<\/label>';(n&&t?(e.push({entryType:n,entryId:t}),i=ASC.Files.UI.getEntryTitle(n,t),n=="file"?u+=f.format(i,n,t):r+=f.format(i,n,t)):jq("#filesMainContent .file-row:not(.checkloading):not(.new-folder):not(.new-file):has(.checkbox input:checked)").each(function(){var t=ASC.Files.UI.getObjectData(this),n=t.entryType,o=t.entryId;e.push({entryType:n,entryId:o});i=t.title;n=="file"?u+=f.format(i,n,o):r+=f.format(i,n,o)}),e.length!=0)&&(jq("#confirmUnsubscribeList dd.confirm-remove-files").html(u),jq("#confirmUnsubscribeList dd.confirm-remove-folders").html(r),jq("#confirmUnsubscribeList .confirm-remove-folders, #confirmUnsubscribeList .confirm-remove-files").show(),r==""&&jq("#confirmUnsubscribeList .confirm-remove-folders").hide(),u==""&&jq("#confirmUnsubscribeList .confirm-remove-files").hide(),ASC.Files.UI.blockUI("#filesConfirmUnsubscribe",420),PopupKeyUpActionProvider.EnterAction="jq(\"#unsubscribeConfirmBtn\").trigger('click');")}},r=function(){var t,n,i;jq("#filesConfirmUnsubscribe:visible").length!=0&&(PopupKeyUpActionProvider.CloseDialog(),t=jq("#confirmUnsubscribeList input:checked"),t.length!=0)&&(n={},n.entry=[],i=t.map(function(t,i){var r=jq(i).attr("entryType"),u=jq(i).attr("entryId"),f=ASC.Files.UI.getEntryObject(r,u);return ASC.Files.UI.blockObject(f,!0,ASC.Files.FilesJSResource.DescriptRemove,!0),n.entry.push(r+"_"+u),{entryId:u,entryType:r}}).toArray(),ASC.Files.UI.updateMainContentHeader(),ASC.Files.ServiceManager.unSubscribeMe(ASC.Files.ServiceManager.events.UnSubscribeMe,{parentFolderID:ASC.Files.Folders.currentFolder.id,showLoading:!0,list:i},{stringList:n}))},u=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}var u=t.list,r=!1;jq(u).each(function(n,t){r||t.entryType!="folder"||(r=!0);ASC.Files.Marker.removeNewIcon(t.entryType,t.entryId);var i=ASC.Files.UI.getEntryObject(t.entryType,t.entryId);ASC.Files.UI.removeEntryObject(i)});r&&ASC.Files.Tree&&ASC.Files.Tree.reloadFolder(t.parentFolderID);ASC.Files.UI.checkEmptyContent()};return{init:i,unSubscribeMe:t}}();jq(document).ready(function(){(function(){ASC.Files.Unsubscribe.init()})(jQuery)});
window.ASC.Files.ChunkUploads=function(){var tt=!1,i=null,f,e=0,r={fisrt:!0,can:!1},l=[],it=0,a=null,v=!0,y=document.body,rt=null,wt="value"in document.createElement("progress"),n={QUEUED:0,STARTED:1,STOPED:2,DONE:3,FAILED:4,WAITCONFIRM:5},bt=function(n){tt===!1&&(tt=!0,ASC.Files.ChunkUploads.tenantQuota=n,ft(),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChunkUploadCheckConversion,or),ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChunkUploadGetFileFromServer,vi));k(!0)||jq("#emptyContainer .emptyContainer_dragDrop").remove();window.onbeforeunload=function(){if(ASC.Files.ChunkUploads.uploaderBusy)return ASC.Files.FilesJSResource.ConfirmLeavePage||"Are you sure you want to leave the current page. Downloading files will be interrupted."}},kt=function(){window.Teamlab.getQuotas({},{success:function(n,t){ASC.Files.ChunkUploads.tenantQuota=t;ft()}})},dt=function(n){var i=jq.format("{0}files/{1}/upload/create_session.json",ASC.Resources.Master.ApiPath,n.fid),t=null;return jq.ajax({type:"POST",data:{fileName:n.name,fileSize:n.size,relativePath:n.relativePath||"",encrypted:n.encrypted},url:i,"async":!1,success:function(n){t=n.response},error:function(n){try{var r=JSON.parse(n.responseText),i=r.error.message}catch(u){i=n.statusText}t={success:!1,message:i}}}),t},gt=function(){var t=ASC.Files.Constants.storageKeyUploaderCompactView,n=localStorageManager.getItem(t);jq("#chunkUploadDialog").toggleClass("min",n===!0);jq("#uploadCompactViewCbx").prop("checked",n===!0);jq(".store-original").prop("checked",ASC.Files.Common.storeOriginal===!0)},ni=function(){var n="fileupload",t=jq("<input/>").attr("id",n).attr("type","file").attr("multiple","multiple").css("width","0").css("height","0").hide();t.appendTo(jq("#buttonUpload").parent());jq("#buttonUpload").on("click",function(t){t.preventDefault();jq("#"+n).removeAttr("webkitdirectory").removeAttr("mozdirectory").removeAttr("directory");ASC.Files.Folders.folderContainer=="privacy"&&ASC.Desktop&&ASC.Desktop.encryptionUploadDialog?(i.length&&jq.isEmptyObject(i.data())&&ut(!1),ASC.Desktop.encryptionUploadDialog(ur)):jq("#"+n).trigger("click")});jq("#uploadActions").on("click","#buttonFolderUpload:not(.disable)",function(t){t.preventDefault();jq("#"+n).attr("webkitdirectory",!0).attr("mozdirectory",!0).attr("directory",!0);jq("#"+n).trigger("click")})},ut=function(n){if(i=jq("#fileupload").fileupload({url:null,autoUpload:!1,singleFileUploads:!0,sequentialUploads:!0,maxChunkSize:ASC.Files.Constants.CHUNK_UPLOAD_SIZE,progressInterval:1e3}),n)i.on("fileuploadadd",ui).on("fileuploadsubmit",fi).on("fileuploadsend",et).on("fileuploadchunksend",et).on("fileuploadprogress",ot).on("fileuploadchunkdone",ot).on("fileuploaddone",st).on("fileuploadfail",ei).on("fileuploadalways",oi).on("fileuploadstart",ti).on("fileuploadstop",ii).on("fileuploaddrop",ri)},ft=function(){if(pi(),jq("#buttonUpload").hasClass("not-ready")||jq("#buttonFolderUpload").hasClass("not-ready")){if(e=0,ni(),ut(!0),k(!0)){jq(y).on("dragenter",function(){return!1}).on("dragleave",si).on("dragover",hi).on("drop",ci);jq(y).css({position:"static"})}jq("#buttonUpload, #buttonFolderUpload").removeClass("not-ready")}},ti=function(){b(ASC.Files.FilesJSResource.Uploading);sr();ASC.Files.ChunkUploads.uploaderBusy=!0;jq("#abortUploadigBtn").show()},ii=function(){e&&ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoUploadedSuccess.format(e));ASC.Files.ChunkUploads.initTenantQuota();b(ASC.Files.FilesJSResource.UploadComplete);ASC.Files.ChunkUploads.uploaderBusy=!1;jq("#abortUploadigBtn").hide();e=0;it++;ASC.Files.ChunkUploads.createdSubfolders={}},ri=function(n,t){f&&(jq.each(t.files,function(n,t){t.fid=f}),f=null)},ui=function(i,r){var u=r.files[0],e;if(u){var f=ASC.Files.Folders.currentFolder.id,s=ASC.Files.Share&&ASC.Files.Folders.currentFolder.shareable&&(!ASC.Resources.Master.Personal||ASC.Files.Utility.CanWebEdit(u.name)),o=!0;ASC.Files.Common.isCorrectId(u.fid)?f=u.fid:o=ASC.Files.Folders.folderContainer=="privacy"?!!ASC.Desktop:ASC.Files.UI.accessEdit();o&&(u.id=pt(),u.percent=0,u.loaded=0,(e=li(u,f))===!0?(!u.relativePath&&u.webkitRelativePath&&(u.relativePath=u.webkitRelativePath.slice(0,-u.name.length)),u.name=ASC.Files.Common.replaceSpecCharacter(u.name),u.fid=f,u.canShare=s,u.status=n.QUEUED,p(u,!1),r.id=pt(),r.session=it,lt(u)&&v&&(u.status=n.WAITCONFIRM,ASC.Files.ConfrimConvert.showDialog(ar,"ASC.Files.ChunkUploads.abortForWaitingConfirm();",!0)),ASC.Files.ChunkUploads.uploadQueue.push(r)):e!==!1&&(u.canShare=!1,u.status=n.FAILED,p(u,!1),t(u.id,e)));ASC.Files.ChunkUploads.uploaderBusy||d()}},fi=function(i,r){var f=r.files[0],e=dt(f),o;e.success?(r.url=e.data.location,f.status=n.STARTED,jq(this).fileupload("option","url",e.data.location),yi(f.fid,f.relativePath,e.data.path||[])):(f.status=n.FAILED,jq(this).fileupload("option","url",null),o=u(e.message),ASC.Files.UI.displayInfoPanel(o,!0),t(f.id,o))},et=function(t,i){var r=i.files[0];return r.status==n.STARTED},ot=function(i,r){var f=r.files[0],s=r.result,e,h;typeof s=="undefined"||s&&s.success?(f.percent=parseInt(r.loaded/r.total*100,10),f.loaded=r.loaded,f.actionText==ASC.Files.FilesJSResource.FileUploading&&(w(f),b(null,r.session)),s&&s.data&&s.data.uploaded&&(st(i,r),e=o(n.STARTED),e&&e.files[0].id==f.id&&e.abort())):(e=o(n.STARTED),f.percent=100,f.loaded=f.size,f.status=n.FAILED,h=u(s.message),ASC.Files.UI.displayInfoPanel(h,!0),t(f.id,h),e&&e.files[0].id==f.id&&e.abort())},st=function(i,r){var f=r.files[0],o,s,l,a,h,c;f.status!=n.DONE&&(f.percent=100,f.loaded=f.size,o=r.result,o.success?(f.status=n.DONE,f.data=o.data,e++,s=lt(f),l=!s||s&&ASC.Files.Common.storeOriginal,f.data.folderId!=ASC.Files.Folders.currentFolder.id||ASC.Files.Filter&&ASC.Files.Filter.getFilterSettings().isSet?(a=(f.relativePath||"").split("/")[0],h=f.fid+"/"+a,ASC.Files.ChunkUploads.createdSubfolders[h]?g(ASC.Files.ChunkUploads.createdSubfolders[h]):g(f.data.folderId)):ASC.Files.UI.isSettingsPanel()||ai(f.data.id,f.data.version,l),s?(fr(f.data.id,f.data.version),p(f,!0),ASC.Files.ChunkUploads.converterBusy||(ASC.Files.ChunkUploads.converterBusy=!0,vt())):w(f)):(f.status=n.FAILED,c=u(o.message),ASC.Files.UI.displayInfoPanel(c,!0),t(f.id,c)))},ei=function(i,r){var f=r.files[0],e,o;f.percent=100;f.loaded=f.size;r.errorThrown=="abort"||r.textStatus=="abort"?f.status!=n.FAILED&&(f.status=n.STOPED,c(f.id),e=jq(this).fileupload("option","url"),e+=(e.indexOf("?")==-1?"?":"&")+"abort=true",jq.ajax({type:"POST",url:e,"async":!0,success:function(n){n.success||ASC.Files.UI.displayInfoPanel(n.message,!0)},error:function(n,t,i){ASC.Files.UI.displayInfoPanel(i,!0)}})):(f.status=n.FAILED,o=r.errorThrown||r.textStatus,o&&(error=u(o),ASC.Files.UI.displayInfoPanel(error,!0),t(f.id,error)))},oi=function(){d()},si=function(n){n.relatedTarget==null&&(rt=setTimeout(ASC.Files.ChunkUploads.hideDragHighlight,1))},hi=function(n){clearTimeout(rt);var t=n.originalEvent.dataTransfer;return ht(t)?(jq.browser.webkit&&(t.dropEffect="copy"),bi(n),!1):!0},ci=function(n){var t=n.originalEvent.dataTransfer;return ht(t)?(ASC.Files.ChunkUploads.hideDragHighlight(),!1):!0},li=function(n,t){var f=ASC.Files.Utility.GetFileExtension(n.name),i,r,u;if(ASC.Files.Constants.UPLOAD_FILTER&&jq.inArray(f,ASC.Files.Utility.Resource.ExtsUploadable)==-1)return i=ASC.Files.FilesJSResource.ErrorMassage_NotSupportedFormat,ASC.Files.UI.displayInfoPanel(i,!0),i;if(r=n.size,r<=0)return i=ASC.Files.FilesJSResource.ErrorMassage_EmptyFile,ASC.Files.UI.displayInfoPanel(i,!0),i;if(!ASC.Files.ThirdParty||!ASC.Files.ThirdParty.isThirdParty(null,"folder",t)){if(ASC.Files.ChunkUploads.tenantQuota==null)return!1;if(u=jq(".popup-modal:visible").length!=0,ASC.Resources.Master.Personal&&ASC.Files.ChunkUploads.tenantQuota.userStorageSize&&ASC.Files.ChunkUploads.tenantQuota.userAvailableSize<r)return i=jq.format(ASC.Files.FilesJSResource.ErrorMassage_StorageSize,FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.userAvailableSize)),(u||!ASC.Files.UI.displayPersonalLimitStorageExceed())&&ASC.Files.UI.displayInfoPanel(i,!0),i;if(ASC.Files.ChunkUploads.tenantQuota.availableSize<r)return i=jq.format(ASC.Files.FilesJSResource.ErrorMassage_StorageSize,FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.availableSize)),(u||!ASC.Files.UI.displayTariffLimitStorageExceed())&&ASC.Files.UI.displayInfoPanel(i,!0),i;if(ASC.Files.ChunkUploads.tenantQuota.maxFileSize<r)return i=jq.format("{0} ({1})",ASC.Files.FilesJSResource.ErrorMassage_FileSize,FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.maxFileSize)),(u||!ASC.Files.UI.displayTariffFileSizeExceed())&&ASC.Files.UI.displayInfoPanel(i,!0),i}return!0},s=function(n){if(n=jq(n),n.is(".fu-row")||(n=n.closest(".fu-row")),n.length==0)return null;var t=n.attr("id");return h(t)},h=function(n,t){for(var i,r=ASC.Files.ChunkUploads.uploadQueue.length;r>0;r--)if(i=ASC.Files.ChunkUploads.uploadQueue[r-1].files[0],(i.id==n||i.data&&i.data.id==n)&&(!t||i.data&&i.data.version==parseInt(t)))return i;return null},ai=function(n,t,i){ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.ChunkUploadGetFileFromServer,{fileId:n,version:t,show:i,isStringXml:!1})},vi=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}yt(t.fileId,n,t.show)},yi=function(n,t,i){var f,o,e,r,u;n==ASC.Files.Folders.currentFolder.id&&(f=i[i.length-1],n&&f&&n!=f)&&(ASC.Files.Filter&&(o=ASC.Files.Filter.getFilterSettings()).isSet&&o.filter!=ASC.Files.Constants.FilterType.FoldersOnly||(t=(t||"").split("/")[0],e=n+"/"+t,ASC.Files.ChunkUploads.createdSubfolders[e])||(r=-1,jq(i).each(function(t,i){return i==n?(r=t,!1):!0}),r!=-1)&&((u=i[r+1],ASC.Files.ChunkUploads.createdSubfolders[e]=u,ASC.Files.UI.getEntryObject("folder",u).length)||ASC.Files.ServiceManager.getFolder(ASC.Files.ServiceManager.events.GetItems,{folderId:u,parentFolderID:n,lonelyType:"folder"})))},u=function(n){return((n=n||"error")=="error"||n.indexOf("NetworkError:")===0)&&(n=ASC.Files.FilesJSResource.UnknownErrorText),n},p=function(n,t){if(n){n.fileTypeCssClass=ASC.Files.Utility.getCssClassByFileTitle(n.name,!0);n.percent=0;n.showAnim=!wt;t?(n.actionText=ASC.Files.FilesJSResource.FileConverting,n.completeActionText=ASC.Files.FilesJSResource.FileConverted):(n.actionText=ASC.Files.FilesJSResource.FileUploading,n.completeActionText=ASC.Files.FilesJSResource.FileUploaded);var i=jq("#fileUploaderRowTmpl").tmpl(n),r=jq("#"+n.id);r.length!=0?r.replaceWith(i):(jq("#uploadFilesTable tbody").append(i),jq("#uploadFilesTable").parent().scrollTo("#"+n.id));t?jq("#"+n.id).addClass("convert"):jq("#"+n.id).addClass("upload")}},w=function(t){if(t){var i=jq("#"+t.id);ASC.Files.UI.setProgressValue(i,t.percent);t.status==n.DONE&&t.percent==100&&setTimeout(function(){i.removeClass("upload").removeClass("convert").addClass("done");t.hasOwnProperty("convertedData")&&(i.find(".fu-title-cell span").text(t.convertedData.title).attr("title",t.convertedData.title),i.find(".ftFile_21").attr("class",ASC.Files.Utility.getCssClassByFileTitle(t.convertedData.title,!0)))},ASC.Files.Constants.REQUEST_CONVERT_DELAY/4)}},t=function(n,t){jq("#"+n).removeClass("upload").removeClass("convert").removeClass("done").removeClass("canceled").addClass("error");jq("#"+n+" .popup_helper").text(t||ASC.Files.FilesJSResource.UnknownErrorText)},c=function(n){jq("#"+n).removeClass("upload").removeClass("convert").removeClass("done").removeClass("error").addClass("canceled")},b=function(t,i){var r;if(!t){var u=0,f=0,e=0;jq.each(ASC.Files.ChunkUploads.uploadQueue,function(t,r){if(r.session==i){var o=r.files[0];o.status!=n.STOPED&&(u++,f+=o.size,e+=o.loaded)}});r=parseInt(e/f*100,10);r==100&&(r=99);t=r>0?ASC.Files.FilesJSResource.UploadingProgress.format(u,r):ASC.Files.FilesJSResource.Uploading}jq("#chunkUploadDialogHeader").text(t)},pi=function(){var n=window.FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.usedSize),t=window.FileSizeManager.filesSizeToString(ASC.Files.ChunkUploads.tenantQuota.storageSize);jq("#chunkUploadDialog .upload-info-container .free-space").text(ASC.Files.FilesJSResource.UsedSize.format(n,t))},k=function(n){var t=function(){var t="draggable"in document.createElement("span");return n?t:t?ASC.Desktop&&ASC.Files.Folders.folderContainer=="privacy"?!1:!0:!1}();return i.fileupload({dropZone:t?jq(y):null}),t},ht=function(n){return k()?jq.browser.safari?!1:n?n.types.contains&&!n.types.contains("Files")?!1:n.types.indexOf&&n.types.indexOf("Files")==-1?!1:!0:!1:!1},wi=function(){jq(".may-drop-to").removeClass("may-drop-to");jq(".drop-to").removeClass("drop-to");jq("#mainContent").removeClass("selected");r.fisrt=!0},bi=function(n){r.fisrt&&(ASC.Files.Mouse.highlightFolderTo("may-drop-to",!0),r.can=ASC.Files.UI.accessEdit()&&ASC.Files.Folders.folderContainer!="privacy",jq("#mainContent").toggleClass("selected",r.can),r.fisrt=!1);jq(".drop-to").removeClass("drop-to");var i=n.target||n.srcElement,t=jq(i).closest(".may-drop-to");t.length?(f=ASC.Files.Mouse.getOverFolderId(n,t,"drop-to"),jq("#mainContent").toggleClass("selected",!1)):(jq("#mainContent").toggleClass("selected",r.can),f=null)},o=function(n){for(var t=0;t<ASC.Files.ChunkUploads.uploadQueue.length;t++)if(ASC.Files.ChunkUploads.uploadQueue[t].files[0].status==n)return ASC.Files.ChunkUploads.uploadQueue[t];return null},d=function(){var t=o(n.QUEUED);t&&(ASC.Files.ChunkUploads.uploaderBusy=!0,t.submit())},ki=function(t){var i=s(t),r;i!=null&&(r=o(n.STARTED),r&&r.files[0].id==i.id?r.abort():i.status==n.QUEUED&&(i.percent=100,i.loaded=i.size,i.status=n.STOPED,c(i.id)))},di=function(t){jq.each(ASC.Files.ChunkUploads.uploadQueue,function(t,i){var r=i.files[0];r.status==n.QUEUED&&(r.percent=100,r.loaded=r.size,r.status=n.STOPED)});var i=o(n.STARTED);i&&i.abort();t?(jq("#uploadFilesTable tbody").html(""),ASC.Files.ChunkUploads.uploadQueue=[]):jq("#uploadFilesTable .fu-row:not(.done)").each(function(){var n=jq(this).attr("id");c(n)})},gi=function(n){var t=s(n),i;t.canShare&&(i=t.convertedData?t.convertedData:t.data,ASC.Files.Share.getSharedInfo("file_"+i.id,i.title))},nr=function(n){var e=s(n),u=e.convertedData?e.convertedData:e.data,o,i,h,f,r,t;if(ASC.Files.MediaPlayer&&(ASC.Files.MediaPlayer.canPlay(u.title)||ASC.Files.Utility.CanImageView(u.title))){for(o=jq("#chunkUploadDialog .fu-row.done").map(function(n,t){return s(t)}),i=[],f=0;f<o.length;f++)r=o[f],t=r.convertedData?r.convertedData:r.data,t.uploadId=r.id,(ASC.Files.MediaPlayer.canPlay(t.title)||ASC.Files.Utility.CanImageView(t.title))&&(i.push(t),u.id===t.id&&(h=i.length-1));ASC.Files.MediaPlayer.init(-1,{playlist:i,playlistPos:h,onCloseAction:function(n){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.navigationSet(n,!1);return}ASC.Files.Anchor.navigationSet(ASC.Files.Folders.currentFolder.id,!0)},onMediaChangedAction:function(n){ASC.Files.Marker.removeNewIcon("file",n);var t=ASC.Files.MediaPlayer.getPlayHash(n);ASC.Files.Anchor.move(t,!0)},downloadAction:ASC.Files.Utility.GetFileDownloadUrl,canDelete:function(n){var t=ASC.Files.UI.getEntryObject("file",n);return!ASC.Files.UI.accessDelete(t)||ASC.Files.UI.editingFile(t)||ASC.Files.UI.lockedForMe(t)?!1:!0},deleteAction:function(n,t){ASC.Files.Folders.deleteItem("file",n,function(){var r=i.filter(function(t){return t.id===n});ct(r[0].uploadId);t()})}})}else ASC.Files.Folders.clickOnFile(u,!0)},tr=function(n){var t=jq(n).closest(".fu-row"),i=t.attr("id");jq(n).helper({BlockHelperID:i+" .popup_helper",position:"fixed"})},ir=function(n){jq("#fileupload").prop("disabled",n)},ct=function(n){jq("#"+n).remove();var t=jq("#chunkUploadDialog");t.find("#uploadFilesTable tr").length||t.hide()},rr=function(n){var t,i,r,u;if(jq("#chunkUploadDialog").is(":visible")){for(t=null,i=0;i<l.length;i++)if(r=l[i].files[0],u=r.data||null,u&&u.id==n){t=r.id;break}t&&ct(t)}},ur=function(n){n.encrypted=!0;i.fileupload("add",{files:[n]})},lt=function(n){return ASC.Files.Constants.ENABLE_UPLOAD_CONVERT?n.encrypted?!1:ASC.Files.Utility.MustConvert(n.name):!1},fr=function(n,t){ASC.Files.Marker.removeNewIcon("file",n);ASC.Files.ChunkUploads.convertQueue.push({id:n,version:t,needToRun:!0})},at=function(n,t){var i=-1;jq.each(ASC.Files.ChunkUploads.convertQueue,function(r,u){u.id==n&&u.version==t&&(i=r)});i!=-1&&ASC.Files.ChunkUploads.convertQueue.splice(i,1)},er=function(n,t){jq.each(ASC.Files.ChunkUploads.convertQueue,function(i,r){r.id==n&&r.version==t&&(r.needToRun=!1)})},vt=function(){var n={};n.entry=[];jq.each(ASC.Files.ChunkUploads.convertQueue,function(t,i){n.entry.push({entry:[i.id,i.version,i.needToRun===!0]})});n.entry.length>0?ASC.Files.ServiceManager.checkConversion(ASC.Files.ServiceManager.events.ChunkUploadCheckConversion,{},{stringListList:n}):ASC.Files.ChunkUploads.converterBusy=!1},or=function(n,i,r){var c,o,f,e,y;if(typeof n!="object"&&typeof r!="undefined"||n==null?r=r||ASC.Files.FilesJSResource.ErrorMassage_ErrorConvert:n.length||(r=ASC.Files.FilesJSResource.ErrorMassage_ErrorConvert),typeof r!="undefined"){c=u(r);ASC.Files.UI.displayInfoPanel(r,!0);clearTimeout(a);jq.each(ASC.Files.ChunkUploads.convertQueue,function(n,i){var r=h(i.id,i.version);r&&t(r.id,c)});nt();ASC.Files.ChunkUploads.convertQueue.clear();ASC.Files.ChunkUploads.converterBusy=!1;return}for(o=0;o<n.length;o++)if(f=JSON.parse(n[o].source),e=h(f.id,f.version),er(f.id,f.version),n[o].error!="")c=u(n[o].error),ASC.Files.UI.displayInfoPanel(c,!0),at(f.id,f.version),e&&(t(e.id,c),nt(e.data.id));else{var l=n[o].progress||0,v=!1,s=null;n[o].result&&(s=JSON.parse(n[o].result));l==100&&s&&(s.folderId!=ASC.Files.Folders.currentFolder.id||ASC.Files.Filter&&ASC.Files.Filter.getFilterSettings().isSet?g(e.fid):ASC.Files.UI.isSettingsPanel()||(y=s.fileXml,yt(ASC.Files.Common.storeOriginal?s.id:e.data.id,y,!0)),nt(f.id),l=100,v=!0,at(f.id,f.version));e&&(e.percent=l,v&&s&&(e.convertedData=s),w(e))}ASC.Files.ChunkUploads.convertQueue.length==0?(ASC.Files.ChunkUploads.converterBusy=!1,clearTimeout(a)):a=setTimeout(vt,ASC.Files.Constants.REQUEST_CONVERT_DELAY)},g=function(n){var i=ASC.Files.UI.getEntryObject("folder",n),t=i.find(".countFiles");t.html((parseInt(t.html())||0)+1)},sr=function(){jq("#chunkUploadDialog:visible").length==0&&(ASC.Files.Actions.hideAllActionPanels(),gt(),jq("#chunkUploadDialog").show())},hr=function(){ASC.Files.ChunkUploads.abortUploading(!0);jq("#chunkUploadDialog").hide();v=!0},cr=function(){jq("#chunkUploadDialog").toggleClass("min")},lr=function(n){var t=jq(n).prop("checked"),i=ASC.Files.Constants.storageKeyUploaderCompactView;localStorageManager.setItem(i,t)},yt=function(n,t,i){var r={fileId:n,show:i,isStringXml:!0};ASC.Files.EventHandler.onGetFile(t,r)},nt=function(n){var t,i;n?(t=ASC.Files.UI.getEntryObject("file",n),t.length!=0&&t.hasClass("new-file")&&(ASC.Files.EmptyScreen.hideEmptyScreen(),t.removeClass("new-file").show().yellowFade())):(i=jq("#filesMainContent .new-file"),i.length>0&&(ASC.Files.EmptyScreen.hideEmptyScreen(),i.removeClass("new-file").show().yellowFade()))},pt=function(){var n=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},ar=function(){setTimeout(function(){v=!1;for(var t=0;t<ASC.Files.ChunkUploads.uploadQueue.length;t++)ASC.Files.ChunkUploads.uploadQueue[t].files[0].status==n.WAITCONFIRM&&(ASC.Files.ChunkUploads.uploadQueue[t].files[0].status=n.QUEUED);ASC.Files.ChunkUploads.uploaderBusy||d()})},vr=function(){for(var t=0;t<ASC.Files.ChunkUploads.uploadQueue.length;t++)ASC.Files.ChunkUploads.uploadQueue[t].files[0].status==n.WAITCONFIRM&&(ASC.Files.ChunkUploads.uploadQueue[t].files[0].percent=100,ASC.Files.ChunkUploads.uploadQueue[t].files[0].loaded=ASC.Files.ChunkUploads.uploadQueue[t].files[0].size,ASC.Files.ChunkUploads.uploadQueue[t].files[0].status=n.STOPED,c(ASC.Files.ChunkUploads.uploadQueue[t].files[0].id))};return{uploadQueue:l,uploaderBusy:!1,convertQueue:[],converterBusy:!1,init:bt,initTenantQuota:kt,tenantQuota:null,abortFileUploading:ki,abortUploading:di,abortForWaitingConfirm:vr,clickOnUploadedFile:nr,shareUploadedFile:gi,showUploadingErrorText:tr,disableBrowseButton:ir,closeUploadDialod:hr,toggleUploadDialod:cr,changeCompactView:lr,createdSubfolders:{},hideDragHighlight:wi,removeUploadItemByFileId:rr,getUploadDataByFileId:h}}(),function(n){n(function(){if(jq("#chunkUploadDialog").length!=0){ASC.Files.Common.storeOriginal=jq("#chunkUploadDialog .store-original").prop("checked");jq("#chunkUploadDialog .actions-container.close").on("click",function(){ASC.Files.ChunkUploads.closeUploadDialod()});jq("#chunkUploadDialog .actions-container.minimize, #chunkUploadDialog .actions-container.maximize").on("click",function(){ASC.Files.ChunkUploads.toggleUploadDialod()});jq("#chunkUploadDialog").on("dblclick",".progress-dialog-header",function(){ASC.Files.ChunkUploads.toggleUploadDialod()});jq("#chunkUploadDialog").on("click",".fu-row.done .share",function(){ASC.Files.ChunkUploads.shareUploadedFile(this)});jq("#chunkUploadDialog").on("click",".fu-row.done .ftFile_21,.fu-row.done .fu-title-cell span",function(){ASC.Files.ChunkUploads.clickOnUploadedFile(this)});jq("#chunkUploadDialog").on("click",".fu-row.upload .abort-file-uploadig",function(){ASC.Files.ChunkUploads.abortFileUploading(this)});jq("#chunkUploadDialog").on("click","#abortUploadigBtn",function(){ASC.Files.ChunkUploads.abortUploading(!1)});jq("#chunkUploadDialog").on("click",".upload-error",function(){ASC.Files.ChunkUploads.showUploadingErrorText(this)});jq.dropdownToggle({switcherSelector:"#uploadSettingsSwitcher",dropdownID:"uploadSettingsPanel",afterShowFunction:function(){var n=jq("#uploadSettingsSwitcher").position(),t=jq("#uploadSettingsSwitcher").height()+5;jq("#uploadSettingsPanel").css({top:n.top+t+"px",left:n.left+"px"})}});jq("#chunkUploadDialog").on("change","#uploadCompactViewCbx",function(){ASC.Files.ChunkUploads.changeCompactView(this)});jq("#chunkUploadDialog .files-container").on("scroll",function(){ASC.Files.Actions.hideAllActionPanels()})}})}(jQuery);
window.ASC.Files.Converter=function(){var t=!1,i=function(){t===!1&&(t=!0,ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ConvertCurrentFile,ASC.Files.Converter.onConvertCurrentFile))},r=function(n,t,i,r){var f,u;if(!ASC.Files.Utility.MustConvert(t)||r==!1)return r==!1||!ASC.Files.Utility.CanWebEdit(t)?(f=ASC.Files.Actions.checkViewFile(n,r?null:i),ASC.Files.UI.updateMainContentHeader(),f):(u=ASC.Files.UI.getEntryObject("file",n),u.find("#contentVersions:visible").length==0||ASC.Files.UI.editingFile(u)||(ASC.Files.Folders.closeVersions(),ASC.Files.Folders.showVersions(u)),f=ASC.Files.Actions.checkEditFile(n),ASC.Files.UI.updateMainContentHeader(),f);if(jq("#progressCopyConvertId").val(n),jq("#progressCopyConvertVersion").val(i),jq("#progressCopyConvertView").val(r==!1),!ASC.Files.Utility.FileIsDocument(t)&&!ASC.Files.Utility.FileIsSpreadsheet(t)&&!ASC.Files.Utility.FileIsPresentation(t))return!0;if(ASC.Files.UI.blockUI("#confirmCopyConvert",500),jq("#convertPassword").val(""),PopupKeyUpActionProvider.EnterAction="jq(\"#confirmCopyConvert .blue:visible:not(.disable):first\").trigger('click')",jq("#progressCopyConvert, #convertPasswordPanel, #copyAndConvertOpen").hide(),jq("#copyConvertDescript, #confirmCopyAndConvert").show(),jq("#goToCopySplitter, #goToCopyFolder, #confirmCopyConvertToMyText, #confirmCopyConvertLabelText").hide(),u=ASC.Files.UI.getEntryObject("file",n),u.is(":visible"))if(ASC.Files.UI.accessEdit())ASC.Files.UI.accessDelete(u)&&!ASC.Files.UI.lockedForMe(u)&&(jq("#confirmCopyConvertLabelText").show(),jq("#confirmCopyConvertLabelText input").prop("disabled",!1));else{if(Teamlab.profile.isVisitor)return PopupKeyUpActionProvider.CloseDialog(),location.href=ASC.Files.Utility.GetFileDownloadUrl(n,i),ASC.Files.Marker.removeNewIcon("file",n);jq("#confirmCopyConvertToMyText").show()}else if(Teamlab.profile.isVisitor)return PopupKeyUpActionProvider.CloseDialog(),location.href=ASC.Files.Utility.GetFileDownloadUrl(n,i),ASC.Files.Marker.removeNewIcon("file",n);return!0},u=function(){PopupKeyUpActionProvider.CloseDialogAction="ASC.Files.Converter.convertFileEnd(null, null, true);";jq("#copyConvertDescript, #convertPasswordPanel, #confirmCopyAndConvert, #progressCopyConvert .convert-status").hide();jq("#progressCopyConvert, #copyAndConvertOpen, #progressCopyConvertRun").show();jq("#copyAndConvertOpen").addClass("disable");var n=jq("#progressCopyConvertId").val(),t=jq("#progressCopyConvertVersion").val(),i=jq("#convertPassword").val();ASC.Files.UI.setProgressValue("#progressCopyConvert",0);jq("#progressCopyConvert .asc-progress-percent").text("0%");ASC.Files.Marker.removeNewIcon("file",n);ASC.Files.Converter.convertFileStep(n,t,i,!0)},f=function(n,t,i){var c,f,s,e,u,l;if(PopupKeyUpActionProvider.CloseDialogAction="",jq("#progressCopyConvert .convert-status").hide(),!t){i?PopupKeyUpActionProvider.CloseDialog():jq("#progressCopyConvertError").show();return}jq("#copyAndConvertOpen").removeClass("disable");var a=JSON.parse(n),v=a.id,r=JSON.parse(t),o=r.id,h=r.title;if(jq("#progressCopyConvertId").val(o),jq("#progressCopyConvertEnd").show(),r.folderId!=ASC.Files.Folders.currentFolder.id){jq("#progressCopyConvertEndTo, #goToCopySplitter, #goToCopyFolder").show();ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCrateFileIn.format(h,r.folderTitle));jq(".convert-end-to").html(r.folderTitle);jq("#goToCopyFolder").attr("data-id",r.folderId);return}c=r.fileXml;f=ASC.Files.TemplateManager.translateFromString(c);ASC.Files.EmptyScreen.hideEmptyScreen();s=ASC.Files.UI.getEntryObject("file",v);s.length==0||ASC.Files.Common.storeOriginal?(e=ASC.Files.UI.getEntryObject("file",o),e.length?(e.after(f),ASC.Files.UI.removeEntryObject(e)):jq("#filesMainContent").prepend(f)):s.replaceWith(f);u=ASC.Files.UI.getEntryObject("file",o);l=ASC.Files.UI.getObjectData(u);u=l.entryObject;u.removeClass("new-file").yellowFade();ASC.Files.UI.addRowHandlers(u);ASC.Files.UI.resetSelectAll();ASC.Files.Actions.showActionsViewPanel();ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoCrateFile.format(h))},e=function(){var n,t;PopupKeyUpActionProvider.CloseDialog();n=jq("#progressCopyConvertId").val();jq("#progressCopyConvertView").val()=="true"?(t=ASC.Files.Utility.GetFileWebViewerUrl(n),window.open(t,"_blank")):ASC.Files.Actions.checkEditFile(n)},o=function(){PopupKeyUpActionProvider.CloseDialogAction="";jq("#progressCopyConvert, #copyAndConvertOpen").hide();jq("#convertPasswordPanel, #confirmCopyAndConvert").show();jq("#convertPassword").val("").trigger("focus")},s=function(t){var i;t=t||jq("#filesMainContent .file-row:has(.checkbox input:checked)");i={documents:[],spreadsheets:[],presentations:[],other:[]};jq("#convertFileZip").toggle(jq(t).length>1);jq(t).each(function(){var t=ASC.Files.UI.getObjectData(this),n,r,f,s,e,o,u;if(!ASC.Files.UI.denyDownload(t)){if(n=t.title,r=t.id,t.entryType=="file"){if(f=[{name:ASC.Files.FilesJSResource.OriginalFormat,value:ASC.Files.Utility.GetFileExtension(n)}],!t.encrypted&&t.content_length<=ASC.Files.Constants.AvailableFileSize&&(e=ASC.Files.Utility.GetConvertFormats(n),e))for(o=0;o<e.length;o++)f.push({name:e[o],value:e[o]});s=ASC.Files.Utility.getCssClassByFileTitle(n);r="file_"+r}else f=[{name:"",value:""}],s=ASC.Files.Utility.getFolderCssClass(),r="folder_"+r;u={fileConvertFormats:{format:f},fileCssClass:s,fileTitle:n,fileId:r};f.length==1?i.other.push(u):ASC.Files.Utility.FileIsDocument(n)?i.documents.push(u):ASC.Files.Utility.FileIsSpreadsheet(n)?i.spreadsheets.push(u):ASC.Files.Utility.FileIsPresentation(n)?i.presentations.push(u):i.other.push(u)}});var r=[{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(ASC.Files.Utility.Resource.InternalFormats.Document),blockTitle:ASC.Files.FilesJSResource.Documents,blockFormats:{format:n(i.documents)},files:{file:i.documents}},{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(ASC.Files.Utility.Resource.InternalFormats.Spreadsheet),blockTitle:ASC.Files.FilesJSResource.Spreedsheets,blockFormats:{format:n(i.spreadsheets)},files:{file:i.spreadsheets}},{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(ASC.Files.Utility.Resource.InternalFormats.Presentation),blockTitle:ASC.Files.FilesJSResource.Presentations,blockFormats:{format:n(i.presentations)},files:{file:i.presentations}},{blockCssClass:ASC.Files.Utility.getCssClassByFileTitle(),blockTitle:ASC.Files.FilesJSResource.Other,blockFormats:{format:[]},files:{file:i.other}}],u=ASC.Files.Common.jsonToXml({entryData:{fileTypeBlock:r}}),f=ASC.Files.TemplateManager.translateFromString(u);jq("#convertFileList").html(f);jq("#convertFileList select").each(function(){jq(this).tlcombobox()});jq(".cnvrt-file-block-body .cnvrt-title-content").each(function(){var n=jq(this),t=n.text();ASC.Files.UI.highlightExtension(n,t)});ASC.Files.UI.blockUI("#convertAndDownload",600)},n=function(n){var i=[],h,u,t,f,o,r,s,e;if(n.length==0)return i;for(i.push({name:ASC.Files.FilesJSResource.OriginalFormat,value:"original"}),h=n[0].fileConvertFormats.format.length,u=0,t=1;t<n.length;t++)n[t].fileConvertFormats.format.length<h&&(u=t);for(t=0;t<n[u].fileConvertFormats.format.length;t++){for(f=n[u].fileConvertFormats.format[t].value,o=!0,r=0;r<n.length;r++){for(s=!1,e=0;e<n[r].fileConvertFormats.format.length;e++)n[r].fileConvertFormats.format[e].value==f&&(s=!0);s||(o=!1)}o&&i.push({name:f,value:f})}return i.push({name:ASC.Files.FilesJSResource.CustomFormat,value:"custom"}),i},h=function(n){var o=jq(n).find("option:selected").text(),r,t,f;if(jq(n).parents(".cnvrt-format-title-content").find(".cnvrt-format-title").text(o),jq(n).attr("file-id"))r=jq(n).parents(".cnvrt-file-block").find(".cnvrt-file-block-head"),t=jq(r).find("select.select-format"),jq(t).val("custom"),jq(t).tlcombobox(),f=jq(t).find("option:selected").text(),jq(r).find(".cnvrt-format-title").text(f);else{var i=jq(n).parents(".cnvrt-file-block"),e=jq(i).find(".cnvrt-file-block-body"),u=jq(n).val();u=="original"?(jq(i).removeClass("cnvrt-file-block-open").addClass("cnvrt-file-block-closed"),jq(e).find("select.select-format").each(function(){var n=jq(this).find("option:first").val(),t=jq(this).find("option:first").text();jq(this).val(n);jq(this).tlcombobox();jq(this).parents(".cnvrt-format-title-content").find(".cnvrt-format-title").text(t)})):u=="custom"?jq(i).removeClass("cnvrt-file-block-closed").addClass("cnvrt-file-block-open"):(jq(i).removeClass("cnvrt-file-block-open").addClass("cnvrt-file-block-closed"),jq(e).find("select.select-format").each(function(){jq(this).val(u);jq(this).tlcombobox();var n=jq(this).find("option:selected").text();jq(this).parents(".cnvrt-format-title-content").find(".cnvrt-format-title").text(n)}))}},c=function(n,t,i,r){var u={},f;u.entry=[];f={entry:[n,t,r===!0,i]};u.entry.push([f]);ASC.Files.ServiceManager.checkConversion(ASC.Files.ServiceManager.events.ConvertCurrentFile,{fileId:n,version:t,password:i},{stringListList:u})},l=function(n,t,i){if(typeof n!="object"&&typeof i!="undefined"||n==null)i=i||ASC.Files.FilesJSResource.ErrorMassage_ErrorConvert;else if(n.length&&n[0]){if(n[0].error&&(i=n[0].error,n[0].result=="password")){!t.password||ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_PasswordFile,!0);ASC.Files.Converter.convertFilePasswordRequest();return}}else i=ASC.Files.FilesJSResource.ErrorMassage_ErrorConvert;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);ASC.Files.Converter.convertFileEnd();return}var r=n[0],u=r.progress||0;if(ASC.Files.UI.setProgressValue("#progressCopyConvert",u),jq("#progressCopyConvert .asc-progress-percent").text(u+"%"),u>=100){ASC.Files.Converter.convertFileEnd(r.source,r.result);return}setTimeout(function(){ASC.Files.Converter.convertFileStep(t.fileId,t.version,t.password)},ASC.Files.Constants.REQUEST_CONVERT_DELAY)};return{init:i,checkCanOpenEditor:r,convertCurrentFile:u,convertFileStep:c,convertFileEnd:f,convertFileOpen:e,convertFilePasswordRequest:o,showToConvert:s,changeFormat:h,onConvertCurrentFile:l}}(),function(n){n(function(){ASC.Files.Converter.init();jq("#studioPageContent").on("click","#buttonConvert, #mainConvert.unlockAction",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Converter.showToConvert()});jq("#filesMainContent").on("click",".pencil.file-edit, .can-coauthoring .pencil.file-editing, .pencil.convert-action, .pencil.fillform-action",function(){ASC.Files.Actions.hideAllActionPanels();var n=ASC.Files.UI.getObjectData(this),t=n.entryId,i=n.title,r=n.version;return ASC.Files.Converter.checkCanOpenEditor(t,i,r),!1});jq("#convertFileList").on("click",".cnvrt-status-content, .cnvrt-file-block-head .cnvrt-title-content, .cnvrt-file-block-head .cnvrt-format-icon-content",function(){var n=jq(this).parents(".cnvrt-file-block"),t=jq(n).hasClass("cnvrt-file-block-open");jq(n).toggleClass("cnvrt-file-block-open",!t).toggleClass("cnvrt-file-block-closed",t)});jq("#convertFileList").on("change","select.select-format",function(){ASC.Files.Converter.changeFormat(this)});jq("#convertFileList").on("click",".cnvrt-file-block-head input[type=checkbox]",function(){var n=jq(this).parents(".cnvrt-file-block"),t=jq(this).prop("checked");jq(n).toggleClass("cnvrt-file-block-active",t);jq(n).find("input[type=checkbox]").prop("checked",t);jq(n).find(".cnvrt-file-row").toggleClass("cnvrt-file-row-active",t)});jq("#convertFileList").on("click",".cnvrt-file-block-body input[type=checkbox]",function(){var n=jq(this).parents(".cnvrt-file-block"),r=jq(this).parents(".cnvrt-file-row"),u=jq(this).parents(".cnvrt-file-block-body").find("input[type=checkbox]").length,t=jq(this).parents(".cnvrt-file-block-body").find("input[type=checkbox]:checked").length,i=jq(this).prop("checked");jq(r).toggleClass("cnvrt-file-row-active",i);i?(jq(n).addClass("cnvrt-file-block-active"),t==u?jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!0).prop("indeterminate",!1):jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!0).prop("indeterminate",!0)):(jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!1).prop("indeterminate",!1),t==0?jq(n).removeClass("cnvrt-file-block-active"):jq(n).find(".cnvrt-file-block-head input[type=checkbox]").prop("checked",!0).prop("indeterminate",!0))});jq("#buttonStartConvert").on("click",function(){var n=[],t;if(jq("#convertFileList .cnvrt-file-block-body select.select-format").each(function(){var u=jq(this).parents(".cnvrt-file-row"),r,t,i;jq(u).hasClass("cnvrt-file-row-active")&&(r=jq(this).val(),t=jq(this).attr("file-id"),n.push({Key:t,Value:r}),i=ASC.Files.UI.parseItemId(t),ASC.Files.Marker.removeNewIcon(i.entryType,i.entryId))}),jq("#convertFileList .cnvrt-file-block-body input[type=hidden]").each(function(){var r=jq(this).parents(".cnvrt-file-row"),i,t;jq(r).hasClass("cnvrt-file-row-active")&&(i=jq(this).val(),fileId=jq(this).attr("file-id"),n.push({Key:fileId,Value:i}),t=ASC.Files.UI.parseItemId(fileId),ASC.Files.Marker.removeNewIcon(t.entryType,t.entryId))}),n.length!=0){if(PopupKeyUpActionProvider.CloseDialog(),n.length==1&&(t=ASC.Files.UI.parseItemId(n[0].Key),t.entryType=="file")){fileId=t.entryId;location.href=ASC.Files.Utility.GetFileDownloadUrl(fileId,0,n[0].Value);return}ASC.Files.Folders.bulkDownload(n)}});jq("#confirmCopyAndConvert").on("click",ASC.Files.Converter.convertCurrentFile);jq("#confirmCopyConvert").on("click","#copyAndConvertOpen:not(.disable)",function(){ASC.Files.Converter.convertFileOpen()});jq("#confirmCopyConvert").on("click","#goToCopyFolder",function(){var n=jq(this).attr("data-id");ASC.Files.Filter.clearFilter(!0);ASC.Files.Anchor.navigationSet(n);PopupKeyUpActionProvider.CloseDialog()})})}(jQuery);
window.ASC.Files.ConfrimConvert=function(){var n=!1,t=function(){if(n===!1){n=!0;jq(".store-original").on("change",function(){r(this)})}},i=function(n,t,i){if(!(jq("#confirmConvert:visible").length>0)){i=i===!0;var r=jq("#confirmConvert").attr(i?"data-save":"data-open");if(r=="true"){typeof n=="function"&&n.call();return}jq("#confirmConvertSave,#confirmConvertSaveDescript").toggle(i);jq("#confirmConvertEdit,#confirmConvertEditDescript").toggle(!i);jq("#confirmConvertContinue").off("click").on("click",function(){jq("#confirmConvertContinue").off("click");jq("#confirmConvertHide").prop("checked")&&Teamlab.hideConfirmConvert(i,{success:function(){jq("#confirmConvert").attr(i?"data-save":"data-open",!0)}});PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();typeof n=="function"&&n.call()});PopupKeyUpActionProvider.CloseDialogAction=t;ASC.Files.UI.blockUI("#confirmConvert",530)}},r=function(n){var t=jq(n).prop("checked");Teamlab.filesStoreOriginal(t,{success:function(n,t){ASC.Files.Common.storeOriginal=t===!0;jq(".store-original").prop("checked",ASC.Files.Common.storeOriginal)},error:function(n,t){ASC.Files.UI.displayInfoPanel(t[0],!0)}})};return{init:t,showDialog:i}}(),function(n){n(function(){ASC.Files.ConfrimConvert.init()})}(jQuery);
window.ASC.Files.CreateMenu=function(){var n=!1,t=function(){n===!1&&(n=!0);jq.dropdownToggle({switcherSelector:"#menuCreateNewButton:not(.disable)",dropdownID:"newDocumentPanel",inPopup:!0,addTop:4});jq.dropdownToggle({switcherSelector:"#menuUploadActionsButton:not(.disable)",dropdownID:"uploadActions",rightPos:!0,beforeShowFunction:function(){jq("#buttonFolderUpload").toggleClass("disable",ASC.Files.Folders.folderContainer=="privacy")},inPopup:!0,addTop:4});jq.dropdownToggle({switcherSelector:"#createByTemplate:not(.disable)",dropdownID:"filesTemplatesPanel",sideToggle:!0,addLeft:4,beforeShowFunction:function(){jq("#filesTemplateLoader").show();jq("#filesTemplateEmpty, #filesTemplateList").hide();ASC.Files.Folders.getTemplateList()}});jq("body").append(jq("#createMasterFormPanel"));jq.dropdownToggle({addLeft:4,addTop:-4,dropdownID:"createMasterFormPanel",sideToggle:!0,switcherSelector:"#createMasterFormPointer",toggleOnOver:!0})},i=function(){ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)||(jq("#createDocument").remove(),jq("#emptyContainer .empty-folder-create-document").remove());ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Spreadsheet)||(jq("#createSpreadsheet").remove(),jq("#emptyContainer .empty-folder-create-spreadsheet").remove());ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Presentation)||(jq("#createPresentation").remove(),jq("#emptyContainer .empty-folder-create-presentation").remove());ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.MasterFormExtension)||(jq("#createMasterFormPointer, #createMasterFormPanel").remove(),jq("#emptyContainer .empty-folder-create-masterform").remove());jq(".empty-folder-create-editor a").length||jq(".empty-folder-create-editor").remove()},r=function(n){var t=jq("#menuUploadActionsButton, #buttonUpload, #buttonFolderUpload, #createDocument, #createSpreadsheet, #createPresentation, #createMasterFormPointer, #createMasterForm, #createMasterFormFromFile, #createNewFolder"+(ASC.Files.Tree.folderIdCurrentRoot?"":", .page-menu .menu-actions .menu-main-button"));t.toggleClass("disable",!n);ASC.Files.ChunkUploads.disableBrowseButton(!n);n&&jq("#createMasterFormFromFile").toggleClass("disable",ASC.Files.Folders.folderContainer=="privacy")},u=function(n){jq("#createByTemplate").toggleClass("display-none",!n)};return{init:t,updateCreateDocList:i,disableMenu:r,toggleCreateByTemplate:u}}(),function(n){ASC.Files.CreateMenu.init();n(function(){function n(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.typeNewDoc=this.id.replace("create","").toLowerCase();ASC.Files.Folders.createNewDoc()}ASC.Files.CreateMenu.updateCreateDocList();jq(document).on("click","#createDocument:not(.disable), #createSpreadsheet:not(.disable), #createPresentation:not(.disable)",n);jq("#createMasterForm").on("click",function(t){if(this.classList.contains("disable")){t.stopPropagation();return}n.call(this)});jq("#emptyContainer .empty-folder-create a").on("click",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.typeNewDoc=jq(this).hasClass("empty-folder-create-document")?"document":jq(this).hasClass("empty-folder-create-spreadsheet")?"spreadsheet":jq(this).hasClass("empty-folder-create-presentation")?"presentation":jq(this).hasClass("empty-folder-create-masterform")?"masterform":"";ASC.Files.Folders.createNewDoc()});jq(document).on("click","#createNewFolder:not(.disable), #emptyContainer .empty-folder-create-folder",function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.Folders.createFolder()})})}(jQuery);
window.ASC.Files.EmptyScreen=function(){var n=!1,t=function(){n===!1&&(n=!0);jq.dropdownToggle({switcherSelector:"#emptyContainer .hintCreate",dropdownID:"hintCreatePanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintUpload",dropdownID:"hintUploadPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintOpen",dropdownID:"hintOpenPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:"#emptyContainer .hintEdit",dropdownID:"hintEditPanel",fixWinSize:!1})},i=function(){ASC.Files.UI.hideAllContent(!0);ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting());jq("#filesMainContent, #switchViewFolder, #mainContentHeader, #pageNavigatorHolder, #filesBreadCrumbs").hide();jq("#emptyContainer > div").hide();ASC.Files.Filter&&ASC.Files.Filter.getFilterSettings().isSet?jq("#emptyContainer_filter").show():(jq(".files-filter").hide(),jq("#emptyContainer .empty-folder-create").toggle(ASC.Files.Folders.folderContainer=="privacy"?!!ASC.Desktop:ASC.Files.UI.accessEdit()),!ASC.Files.Tree||ASC.Files.Tree.pathParts.length>1?(jq("#emptyContainer_subfolder").show(),ASC.Files.UI.checkButtonBack(".empty-folder-toparent")):jq("#emptyContainer_"+ASC.Files.Folders.folderContainer).show());jq("#emptyContainer").show();ASC.Files.UI.stickContentHeader()},r=function(){jq("#filesMainContent").is(":visible")&&jq("#mainContentHeader").is(":visible")||(ASC.Files.UI.hideAllContent(!0),ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),jq("#emptyContainer").hide(),ASC.Files.UI.checkButtonBack(".to-parent-folder","#filesBreadCrumbs"),jq(".files-filter").show(),ASC.Files.Filter&&ASC.Files.Filter.resize(),jq("#filesMainContent, #switchViewFolder, #mainContentHeader").show(),ASC.Files.UI.stickContentHeader())};return{init:t,hideEmptyScreen:r,displayEmptyScreen:i}}(),function(n){jq("#hintCreatePanel").length!=0&&(ASC.Files.EmptyScreen.init(),n(function(){}))}(jQuery);
window.FileChoisePopup=function(){var f=!1,n,t,i,r,u,e=function(){f||(f=!0,o(),s())},o=function(){n=jq("#fileChoisePopupDialod");t=n.find(".loader-page");i=jq("#frameContainer");u=jq("#createMasterFormFromFile");r=jq("<iframe/>",{frameborder:0,height:"566px",id:"fileChoiceFrame",scrolling:"no",onload:"javascript:FileChoisePopup.frameOnLoad();return false;"});r.appendTo(i)},s=function(){u.on("click",h);window.addEventListener("message",function(n){if(n&&typeof n.data=="string"){var t=null;try{t=JSON.parse(n.data)}catch(i){console.error(i);return}if(!t||!t.fileId){PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI();return}c(t)}},!1)},h=function(f){if(u.hasClass("disable")){f.stopPropagation();return}r.attr("src",i.data("frame")+"&folderid="+ASC.Files.Folders.currentFolder.id);ASC.Files.Actions.hideAllActionPanels();StudioBlockUIManager.blockUI(n,1e3,{bindEvents:!1});t.show()},c=function(n){title=n.fileTitle;lenExt=ASC.Files.Utility.GetFileExtension(title).length;title=title.substring(0,title.length-lenExt);PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI();ASC.Files.Folders.createNewDoc({title:title+ASC.Files.Utility.Resource.MasterFormExtension,entryId:n.fileId},!1,l)},l=function(n){Teamlab.copyDocFileAs(null,n.templateId,{destFolderId:n.folderID,destTitle:n.fileTitle},{success:function(t,i){ASC.Files.ServiceManager.getFile(ASC.Files.ServiceManager.events.CreateNewFile,{fileId:i.id,show:!0,isStringXml:!1,folderID:n.folderID,winEditor:n.winEditor})},error:function(t,i){var r=ASC.Files.UI.getEntryObject("file","0");ASC.Files.UI.blockObject(r);ASC.Files.UI.removeEntryObject(r);jq("#filesMainContent .file-row").length==0&&ASC.Files.EmptyScreen.displayEmptyScreen();n.winEditor&&n.winEditor.close();ASC.Files.UI.displayInfoPanel(i[0],!0)}})},a=function(){t.hide()};return{init:e,frameOnLoad:a}}(jQuery),function(){window.FileChoisePopup.init()}(jQuery);
window.ASC.Files.ThirdParty=function(){var r=!1,s={Box:{key:"Box",customerTitle:ASC.Files.FilesJSResource.FolderTitleBoxNet,providerTitle:ASC.Files.FilesJSResource.TypeTitleBoxNet,getTokenUrl:ASC.Files.Constants.URL_OAUTH_BOX},BoxNet:{key:"BoxNet",customerTitle:ASC.Files.FilesJSResource.FolderTitleBoxNet,providerTitle:ASC.Files.FilesJSResource.TypeTitleBoxNet},DropBox:{key:"DropBox",customerTitle:ASC.Files.FilesJSResource.FolderTitleDropBox,providerTitle:ASC.Files.FilesJSResource.TypeTitleDropBox},DropboxV2:{key:"DropboxV2",customerTitle:ASC.Files.FilesJSResource.FolderTitleDropBox,providerTitle:ASC.Files.FilesJSResource.TypeTitleDropBox,getTokenUrl:ASC.Files.Constants.URL_OAUTH_DROPBOXV2},DocuSign:{key:"DocuSign",customerTitle:ASC.Files.FilesJSResource.FolderTitleDocuSign,providerTitle:ASC.Files.FilesJSResource.TypeTitleDocuSign,getTokenUrl:ASC.Files.Constants.URL_OAUTH_DOCUSIGN,link:ASC.Files.Constants.URL_OAUTH_DOCUSIGN_LINK},Google:{key:"Google",customerTitle:ASC.Files.FilesJSResource.FolderTitleGoogle,providerTitle:ASC.Files.FilesJSResource.TypeTitleGoogle,getTokenUrl:"http://www.onlyoffice.com"},GoogleDrive:{key:"GoogleDrive",customerTitle:ASC.Files.FilesJSResource.FolderTitleGoogle,providerTitle:ASC.Files.FilesJSResource.TypeTitleGoogle,getTokenUrl:ASC.Files.Constants.URL_OAUTH2_GOOGLE},OneDrive:{key:"OneDrive",customerTitle:ASC.Files.FilesJSResource.FolderTitleSkyDrive,providerTitle:ASC.Files.FilesJSResource.TypeTitleSkyDrive,getTokenUrl:ASC.Files.Constants.URL_OAUTH_SKYDRIVE},SharePoint:{key:"SharePoint",customerTitle:ASC.Files.FilesJSResource.FolderTitleSharePoint,providerTitle:ASC.Files.FilesJSResource.TypeTitleSharePoint,urlRequest:!0},SkyDrive:{key:"SkyDrive",customerTitle:ASC.Files.FilesJSResource.FolderTitleSkyDrive,providerTitle:ASC.Files.FilesJSResource.TypeTitleSkyDrive,getTokenUrl:ASC.Files.Constants.URL_OAUTH_SKYDRIVE},WebDav:{key:"WebDav",customerTitle:ASC.Files.FilesJSResource.FolderTitleWebDav,providerTitle:ASC.Files.FilesJSResource.TypeTitleWebDav,urlRequest:!0},kDrive:{key:"kDrive",customerTitle:ASC.Files.FilesJSResource.FolderTitlekDrive,providerTitle:ASC.Files.FilesJSResource.TypeTitlekDrive},Yandex:{key:"Yandex",customerTitle:ASC.Files.FilesJSResource.FolderTitleYandex,providerTitle:ASC.Files.FilesJSResource.TypeTitleYandex,faqUrl:"https://yandex.ru/support/id/authorization/app-passwords.html#app-passwords"}},n,h=function(){if(r===!1){r=!0;ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetThirdParty,bt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SaveThirdParty,kt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.DeleteThirdParty,dt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.ChangeAccessToThirdparty,gt);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SaveDocuSign,ni);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.SendDocuSign,ti);jq(document).on("click",function(n){jq.dropdownToggle().registerAutoHide(n,".account-row .menu-small","#thirdPartyActionPanel")})}jq("#thirdpartyToDocuSignAddMessage").on("click",function(){return st(),!1});jq("#thirdpartyToDocuSignRemoveMessage").on("click",function(){return f(),jq("#thirdpartyToDocuSignMessage").val(""),!1});jq.dropdownToggle({dropdownID:"thirdpartyToDocuSignFolderSelector",inPopup:!0,switcherSelector:"#thirdpartyToDocuSignFolder"});n=new ASC.Files.TreePrototype("#docuSignFolderSelector");n.clickOnFolder=e;jq("#thirdpartyToDocuSignUserSelector").useradvancedSelector({inPopup:!0,showGroups:!0,showme:!1}).on("showList",ht);jq("#thirdpartyToDocuSignRecipientsList").on("click",".ds-user-link-delete",ct)},c=function(n,i,r){return n||i?n||(n=ASC.Files.UI.getObjectData(ASC.Files.UI.getEntryObject(i,r)),!n&&i=="folder"&&ASC.Files.Tree&&(n=ASC.Files.Tree.getFolderData(r))):n=ASC.Files.Folders.currentFolder,t(n)!=null},t=function(n){return ASC.Files.ThirdParty.thirdPartyList[n.provider_key]},l=function(){jq("#thirdPartyEditor").length!=0&&(yt(),ASC.Files.UI.hideAllContent(),jq("#treeViewContainer .node-selected").removeClass("node-selected"),jq("#treeSetting").addClass("currentCategory open"),jq(".settings-link-thirdparty").addClass("active"),jq("#settingThirdPartyPanel").show(),ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsThirdParty))},a=function(n){var u=t(n),i=jq.extend(u,{id:n.provider_id,customerTitle:n.title,folderId:n.id}),r;jq('#thirdPartyEditor div[id$="InfoPanel"]').hide();jq("#thirdPartyConnectionUrl, #thirdPartyPassword").val("");jq("#thirdPartyConnectionUrl").closest(".thirdparty-editor-row").hide();jq("#thirdPartyPassword").closest(".thirdparty-editor-row").hide();i.getTokenUrl?jq("#thirdPartyAccount").attr("data-provider",i.key).attr("data-providerId",i.id).closest(".thirdparty-editor-row").show():(jq("#thirdPartyAccount").closest(".thirdparty-editor-row").hide(),jq("#thirdPartyPassword").closest(".thirdparty-editor-row").show(),i.urlRequest&&jq("#thirdPartyConnectionUrl").closest(".thirdparty-editor-row").show());for(r in ASC.Files.ThirdParty.thirdPartyList)jq("#thirdPartyAccount span, #thirdPartyTitle").removeClass(r);jq("#thirdPartyAccount").attr("data-token","");jq("#thirdPartyAccount span, #thirdPartyTitle").addClass(i.key);jq("#thirdPartyTitle").trigger("focus");jq("#thirdPartyTitle").val(i.customerTitle);ASC.Files.UI.checkCharacter(jq("#thirdPartyTitle"));jq("#thirdPartyPanel input").prop("disabled",!1);jq("#thirdPartyCorporate").prop("checked",!1);LoadingBanner.hideLoaderBtn("#thirdPartyEditor");jq("#submitThirdParty").off("click").on("click",function(){return v(i),!1});jq("#thirdPartyCorporate").prop("checked",ASC.Files.Folders.folderContainer=="corporate");jq("#thirdPartyDialogCaption").text(ASC.Files.FilesJSResource.ThirdPartyEditorCaption.format(i.providerTitle));ASC.Files.UI.blockUI("#thirdPartyEditor",400);PopupKeyUpActionProvider.EnterAction="jq(\"#submitThirdParty\").trigger('click');"},v=function(n){var r=jq("#thirdPartyConnectionUrl").val().trim(),u=jq("#thirdPartyPassword").val().trim(),t=jq("#thirdPartyTitle").val().trim();t=ASC.Files.Common.replaceSpecCharacter(t);var f=jq("#thirdPartyCorporate").prop("checked")===!0,e=jq("#thirdPartyAccount").attr("data-token"),i=jq('#thirdPartyEditor div[id$="InfoPanel"]');if(i.hide(),t==""){i.show().find("div").text(ASC.Files.FilesJSResource.ErrorMassage_FieldsIsEmpty);return}jq("#thirdPartyPanel input").prop("disabled",!0);LoadingBanner.showLoaderBtn("#thirdPartyEditor");n.folderId&&ASC.Files.UI.blockObjectById("folder",n.folderId,!0,ASC.Files.FilesJSResource.DescriptChangeInfo);o(n.id,n.key,t,r,"",u,e,f,n.folderId)},y=function(n,i,r,u,f){if(n=n||(f?f.provider_id:null),n!=null||i==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key){var e=f?f.entryId:null;r=r||t(f).providerTitle;jq("#thirdPartyDeleteDescr").html(ASC.Files.FilesJSResource.ConfirmDeleteThirdParty.format(u,r));jq("#deleteThirdParty").off("click").on("click",function(){return ASC.Files.UI.blockObjectById("folder",e,!0,ASC.Files.FilesJSResource.DescriptRemove),PopupKeyUpActionProvider.CloseDialog(),pt(n,i,u,e),!1});ASC.Files.UI.blockUI("#thirdPartyDelete",400);PopupKeyUpActionProvider.EnterAction="jq(\"#deleteThirdParty\").trigger('click');"}},p=function(n){if(!n)return!1;var t=jq("#account_"+n.key);return t.length>0?(jq(t).find("input:visible:first").trigger("focus"),jq(t).yellowFade(),!1):(n.getTokenUrl?(OAuthCallback=function(t){i(n,t)},OAuthPopup(n.getTokenUrl,n.key)):i(n),!1)},w=function(n){return OAuthCallback=function(t){var i=jq("#account_"+n.provider_id);i.find(".account-hidden-token").val(t)},OAuthPopup(n.getTokenUrl,null,n.provider_id),!1},b=function(){if(!jq("#thirdPartyEditor").is(":visible"))return!1;var t=jq("#thirdPartyAccount").attr("data-provider"),n=ASC.Files.ThirdParty.thirdPartyList[t];return n?(OAuthCallback=function(n){jq("#thirdPartyAccount").attr("data-token",n)},OAuthPopup(n.getTokenUrl,null,jq("#thirdPartyAccount").attr("data-providerId")),!1):!1},i=function(n,t){var r={canCorporate:ASC.Files.Constants.ADMIN&&!ASC.Resources.Master.Personal,canEdit:!0,corporate:!1,customer_title:n.customerTitle,isNew:!0,link:n.link,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,provider_id:n.key,provider_key:n.key,provider_title:n.providerTitle,getTokenUrl:n.getTokenUrl,faqUrl:n.faqUrl},u,f,i;if(n.key==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key){if(t){ASC.Files.ServiceManager.saveDocuSign(ASC.Files.ServiceManager.events.SaveDocuSign,{thirdParty:n},t);return}r.canEdit=!1;r.isNew=!1;ASC.Files.ThirdParty.docuSignAttached(!0)}u=ASC.Files.Common.jsonToXml({third_partyList:{entry:r}});f=ASC.Files.TemplateManager.translateFromString(u);jq("#thirdPartyAccountList").append(f);jq("#emptyThirdPartyContainer").hide();jq("#thirdPartyAccountContainer").show();i=jq("#account_"+r.provider_id);r.isNew&&(ASC.Files.UI.checkCharacter(jq(i).find(".account-input-folder")),jq(i).find(".account-hidden-token").val(t),jq(i).find(".account-settings-container").show(),n.getTokenUrl||(jq(i).find(".account-log-pass-container").show(),n.urlRequest&&jq(i).find(".account-field-url").show()),jq(i).find("input:visible:first").trigger("focus"));jq(i).yellowFade()},u=function(n){var t=jq(n).is(".account-row")?jq(n):jq(n).parents(".account-row"),r,u,i;ASC.Files.UI.checkCharacter(jq(t).find(".account-input-folder"));r=jq(t).find(".account-hidden-customer-title").val().trim();jq(t).find(".account-input-folder").val(r);jq(t).find(".account-settings-container").show();u=jq(t).find(".account-hidden-provider-key").val().trim();i=ASC.Files.ThirdParty.thirdPartyList[u];i&&!i.getTokenUrl&&(jq(t).find(".account-log-pass-container").show(),i.urlRequest&&jq(t).find(".account-field-url").show());jq(t).find("input:visible:first").trigger("focus")},k=function(n){var t=jq(n).parents(".account-row"),i=parseInt(jq(t).find(".account-hidden-provider-id").val());if(!i){jq(t).remove();jq("#thirdPartyAccountList .account-row").length==0&&(jq("#thirdPartyAccountContainer").hide(),jq("#emptyThirdPartyContainer").show());return}jq(t).find(".account-settings-container").hide()},d=function(n){var t=jq(n).parents(".account-row"),i=parseInt(jq(t).find(".account-hidden-provider-id").val()),r=jq(t).find(".account-hidden-provider-key").val().trim(),u=jq(t).find(".account-hidden-provider-title").val().trim(),f=jq(t).find(".account-hidden-customer-title").val().trim();ASC.Files.ThirdParty.showDeleteDialog(i,r,u,f)},g=function(n){var t=jq(n).parents(".account-row"),i=null,u=parseInt(jq(t).find(".account-hidden-provider-id").val());u&&(i=u);var f=jq(t).find(".account-hidden-provider-key").val().trim(),e=jq(t).find(".account-input-folder").val().trim(),s=jq(t).find(".account-input-url").val().trim(),h=(jq(t).find(".account-input-login").val()||"").trim(),c=jq(t).find(".account-input-pass").val().trim(),l=jq(t).find(".account-hidden-token").val().trim(),a=jq(t).find(".account-cbx-corporate").prop("checked")===!0,r=ASC.Files.ThirdParty.thirdPartyList[f];if(e==""||!i&&!r.getTokenUrl&&(h==""||c=="")||!i&&r.urlRequest&&s==""){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_FieldsIsEmpty,!0);return}if(!i&&r.getTokenUrl&&l==""){ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_MustLogin,!0);return}jq(t).find("input").prop("disabled",!0);jq(t).find("a.button.account-save-link").addClass("disable");o(i,f,e,s,h,c,l,a)},nt=function(n){var t=jq(n).prop("checked");wt(t===!0);jq(".settings-link-thirdparty, .tree-thirdparty").toggleClass("display-none",t!==!0)},tt=function(){ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.blockUI("#thirdPartyNewAccount",500)},it=function(n){var r=jq.fixEvent(n),t=jq(r.srcElement||r.target),f=jq(t).parents(".account-row"),i;if(jq(f).is(":has(.account-settings-container)"))jq("#accountEditLinkContainer").show().off("click").on("click",function(){ASC.Files.Actions.hideAllActionPanels();u(t)});else jq("#accountEditLinkContainer").hide();jq("#accountDeleteLinkContainer").off("click").on("click",function(){ASC.Files.Actions.hideAllActionPanels();d(t)});return i=jq("#thirdPartyActionPanel"),i.css({top:t.offset().top+t.outerHeight(),left:"auto",right:jq(window).width()-t.offset().left-t.width()-2,margin:"5px -8px 0 0"}),i.toggle(),!0},rt=function(n,t){if(!ASC.Files.Common.isCorrectId(n)||!ASC.Files.Common.isCorrectId(t))return!1;var i=function(n){var t=/^\d+/.exec(n),i;return t!=null?"onlyoffice":(i=/([^\|]+)(\|.*)?/,t=i.exec(n)[1],(t||"").replace(/-$/,""))},r=i(n),u=i(t);return r!=u},ut=function(n,i,r){var u=t(ASC.Files.Folders.currentFolder).providerTitle;jq("#moveThirdPartyMessage").html(jq.format(ASC.Files.FilesJSResource.ConfirmThirdPartyMoveMessage,"<br/><br/>",u));jq("#buttonMoveThirdParty").off("click").on("click",function(){PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();ASC.Files.Folders.curItemFolderMoveTo(n,i,r,!0)});jq("#buttonCopyThirdParty").off("click").on("click",function(){PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog();ASC.Files.Folders.isCopyTo=!0;ASC.Files.Folders.curItemFolderMoveTo(n,i,r,!0)});jq("#buttonCancelMoveThirdParty").off("click").on("click",function(){ASC.Files.Folders.isCopyTo=!1;PopupKeyUpActionProvider.CloseDialogAction="";PopupKeyUpActionProvider.CloseDialog()});ASC.Files.UI.blockUI("#thirPartyConfirmMove",420);PopupKeyUpActionProvider.EnterAction="jq(\"#buttonMoveThirdParty\").trigger('click');";PopupKeyUpActionProvider.CloseDialogAction="jq(\"#buttonCancelMoveThirdParty\").trigger('click');"},ft=function(){return!!jq(".settings-link-thirdparty").length},et=function(n){return typeof n!="undefined"&&jq(".add-account-button.DocuSign").attr("data-signed",!!n),jq(".add-account-button.DocuSign").attr("data-signed")=="true"},ot=function(t){var u,r,i,s,o;if(jq("#thirdpartyToDocuSignHelper").length){ASC.Files.UI.blockUI("#thirdpartyToDocuSignHelper",500);return}if(!ASC.Files.ThirdParty.docuSignAttached()){ASC.Files.ThirdParty.addAccountButton(null,ASC.Files.ThirdParty.thirdPartyList.DocuSign.key);return}u=ASC.Files.FilesJSResource.DocuSignDialogHeader.format(t.title);jq("#thirdpartyToDocuSign .thirdparty-todocusign-header").attr("title",u).text(u);r=jq("#thirdpartyToDocuSign .thirdparty-todocusign-title");r.attr("title",t.title).attr("placeholder",t.title).val(t.title);ASC.Files.UI.checkCharacter(r);i=ASC.Files.Folders.currentFolder.id;s=n.getFolderData(i);ASC.Files.UI.accessEdit(s)||(i=ASC.Files.Constants.FOLDER_ID_MY_FILES);e(i);n.setCurrent(i);jq("#thirdpartyToDocuSignRecipientsList").hide();jq("#thirdpartyToDocuSignUserSelector").useradvancedSelector("reset");o=function(){var n=r.val(),u,f;if(n.length<1)return r.trigger("focus"),!1;i=jq("#thirdpartyToDocuSignFolder").attr("data-id");u=jq("#thirdpartyToDocuSignMessage:visible").val();f=jq("#thirdpartyToDocuSignRecipientsList .userLink").map(function(n,t){return jq(t).attr("data-uid")}).toArray();PopupKeyUpActionProvider.CloseDialog();ASC.Files.UI.blockObject(t.entryObject,!0,ASC.Files.FilesJSResource.DescriptDocuSign);var e={docusign_data:{folderId:i,message:u,name:n,users:{entry:f}}},o=window.open(ASC.Desktop?"":ASC.Files.Constants.URL_LOADER),s={fileId:t.id,entryObject:t.entryObject,winSign:o};return ASC.Files.ServiceManager.sendDocuSign(ASC.Files.ServiceManager.events.SendDocuSign,s,e),!1};jq("#thirdpartyToDocuSignSend").off("click").on("click",o);jq("#thirdpartyToDocuSign").on("keydown",function(n){var t,i,r;if(!jq("#thirdpartyToDocuSign").is(":visible")||(t||(t=n),i=jq(t.srcElement||t.target),jq(i).is("#thirdpartyToDocuSignMessage")&&!t.ctrlKey))return!0;r=t.keyCode||t.which;switch(r){case ASC.Files.Common.keyCode.enter:o()}return!0});f();ASC.Files.UI.blockUI("#thirdpartyToDocuSign",400)},f=function(){jq("#thirdpartyToDocuSignRemoveMessage").hide();jq("#thirdpartyToDocuSign").removeClass("with-message");jq("#thirdpartyToDocuSignAddMessage").show()},st=function(){jq("#thirdpartyToDocuSignAddMessage").hide();jq("#thirdpartyToDocuSign").addClass("with-message");jq("#thirdpartyToDocuSignRemoveMessage").show()},ht=function(n,t){jq("#thirdpartyToDocuSignRecipientsList").empty();t.forEach(function(n){n.decodedTitle=Encoder.htmlDecode(n.title);var t=ASC.Files.Common.jsonToXml({userItem:n}),i=ASC.Files.TemplateManager.translateFromString(t);jq("#thirdpartyToDocuSignRecipientsList").append(i)});jq("#thirdpartyToDocuSignRecipientsList").show();ASC.Files.UI.registerUserProfilePopup(jq("#thirdpartyToDocuSignRecipientsList"))},ct=function(){var n=jq(this).closest(".ds-user-link"),t=n.find(".userLink").attr("data-uid");jq("#thirdpartyToDocuSignUserSelector").useradvancedSelector("unselect",[t]);n.remove();jq("#thirdpartyToDocuSignRecipientsList .userLink").length||jq("#thirdpartyToDocuSignRecipientsList").hide()},e=function(t){var u,i,r;return n.rollUp(),n.setCurrent(t),u=n.getFolderData(t),ASC.Files.UI.accessEdit(u)?(i=n.getFolderTitle(t),jq("#thirdpartyToDocuSignFolder a").attr("title",i).text(i),jq("#thirdpartyToDocuSignFolder").attr("data-id",t),ASC.Files.Actions.hideAllActionPanels(),!0):(r=ASC.Files.FilesJSResource.ErrorMassage_SecurityException,(t==ASC.Files.Constants.FOLDER_ID_PROJECT||t==ASC.Files.Constants.FOLDER_ID_SHARE)&&(r=ASC.Files.FilesJSResource.ErrorMassage_SecurityException_PrivateRoot),ASC.Files.UI.displayInfoPanel(r,!0),n.expandFolder(t),!1)},lt=function(t){ASC.Files.Common.isCorrectId(t)&&jq("#thirdPartyEditor").length!=0&&n.resetFolder(t)},at=function(){var n,t,r,e=location.hash.substr(1).split("&"),f;if(jq(e).each(function(i,u){var f=u.split("=");f[0]=="providerKey"?n=f[1]:f[0]=="providerId"?t=f[1]:f[0]=="code"&&(r=f[1])}),n){if(f=ASC.Files.ThirdParty.thirdPartyList[n],!f)return;i(f,r);return}t&&(u("#account_"+t),jq("#thirdPartyAccount").attr("data-token",r))},vt=function(n,t){var i,u,r;return(ASC.Files.Actions.hideAllActionPanels(),t||(t=jq(this).attr("data-provider")),i=ASC.Files.ThirdParty.thirdPartyList[t],!i)?!0:jq("#thirdPartyEditor").is(":visible")?(ASC.Files.ThirdParty.changeTokenThirdPartyAccount(),!1):(PopupKeyUpActionProvider.CloseDialog(),u=jq(this).closest(".account-row"),u.length)?(i.provider_id=jq(u).find(".account-hidden-provider-id").val(),ASC.Files.ThirdParty.editTokenThirdPartyAccount(i),!1):(r=function(){return ASC.Files.ThirdParty.addNewThirdPartyAccount(i)},jq("#settingThirdPartyPanel:visible").length==0)?(i.getTokenUrl?r():ASC.Files.Folders.eventAfter=r,ASC.Files.Anchor.move("setting=thirdparty"),!1):(r(),!1)},yt=function(){ASC.Files.ServiceManager.getThirdParty(ASC.Files.ServiceManager.events.GetThirdParty,{showLoading:!0})},o=function(n,t,i,r,u,f,e,o,s){var h={providerId:n,providerKey:t,folderTitle:i,login:u,password:f,token:e,corporate:o,folderId:s},c={third_party:{auth_data:{login:u,password:f,token:e,url:r},corporate:o,customer_title:i,provider_id:n,provider_key:t}};ASC.Files.ServiceManager.saveThirdParty(ASC.Files.ServiceManager.events.SaveThirdParty,h,c)},pt=function(n,t,i,r){var u={providerId:n,providerKey:t,folderId:r,customerTitle:i};t==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key?(u.providerId=0,ASC.Files.ServiceManager.deleteDocuSign(ASC.Files.ServiceManager.events.DeleteThirdParty,u)):ASC.Files.ServiceManager.deleteThirdParty(ASC.Files.ServiceManager.events.DeleteThirdParty,u)},wt=function(n){ASC.Files.ServiceManager.changeAccessToThirdparty(ASC.Files.ServiceManager.events.ChangeAccessToThirdparty,{enable:n===!0})},bt=function(n,t,i){var r,u;if(LoadingBanner.hideLoading(),typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}if(r=ASC.Files.ThirdParty.docuSignAttached(),n.length>0||r){u=jq(n).map(function(n,t){var i=ASC.Files.ThirdParty.thirdPartyList[t.provider_key];return{canCorporate:ASC.Files.Constants.ADMIN&&!ASC.Resources.Master.Personal,canEdit:!0,corporate:t.isnew==1,customer_title:t.title,error:t.error,id:t.id,isNew:!1,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,provider_id:t.provider_id,provider_key:t.provider_key,provider_title:i.providerTitle,getTokenUrl:i.getTokenUrl}}).toArray();r&&u.push({canEdit:!1,canCorporate:!1,corporate:!1,customer_title:ASC.Files.ThirdParty.thirdPartyList.DocuSign.customerTitle,id:0,isNew:!1,link:ASC.Files.ThirdParty.thirdPartyList.DocuSign.link,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,provider_id:ASC.Files.ThirdParty.thirdPartyList.DocuSign.key,provider_key:ASC.Files.ThirdParty.thirdPartyList.DocuSign.key,provider_title:ASC.Files.ThirdParty.thirdPartyList.DocuSign.providerTitle});var f={third_partyList:{entry:u}},e=ASC.Files.Common.jsonToXml(f),o=ASC.Files.TemplateManager.translateFromString(e);jq("#thirdPartyAccountList").html(o);jq("#emptyThirdPartyContainer").hide();jq("#thirdPartyAccountContainer").show()}else jq("#thirdPartyAccountList .account-row").remove(),jq("#thirdPartyAccountContainer").hide(),jq("#emptyThirdPartyContainer").show();ASC.Files.Folders.eventAfter!=null&&typeof ASC.Files.Folders.eventAfter=="function"&&(ASC.Files.Folders.eventAfter(),ASC.Files.Folders.eventAfter=null)},kt=function(n,t,i){var p=jq('#thirdPartyEditor div[id$="InfoPanel"]'),f,u,v,y,h,o;if(typeof i!="undefined"){jq("#settingThirdPartyPanel:visible").length>0?(ASC.Files.UI.displayInfoPanel(i,!0),f=typeof t.folderId!="undefined"?jq("#"+t.folderId):jq("#account_"+(t.providerId||t.providerKey)),f.find("input").prop("disabled",!1),f.find("a.button.account-save-link").removeClass("disable"),u=f.find(".account-input-url"),u.is(":visible")||(u=f.find(".account-input-login"),u.is(":visible")||(u=f.find(".account-input-pass"),u.is(":visible")||(u=f.find(".account-input-folder")))),u.trigger("focus")):(p.show().find("div").text(i),jq("#thirdPartyPanel input").prop("disabled",!1),LoadingBanner.hideLoaderBtn("#thirdPartyEditor"));return}PopupKeyUpActionProvider.CloseDialog();var s=t.folderTitle,r=null,e=t.folderId;if(jq("#settingThirdPartyPanel:visible").length>0){t.providerId=t.providerId?t.providerId:0;var c=ASC.Files.ThirdParty.thirdPartyList[n.provider_key],w={id:n.id,corporate:t.corporate,customer_title:n.title,provider_id:n.provider_id,provider_title:c.providerTitle,provider_key:n.provider_key,isNew:!1,max_name_length:ASC.Files.Constants.MAX_NAME_LENGTH,canCorporate:ASC.Files.Constants.ADMIN&&!ASC.Resources.Master.Personal,error:n.error,canEdit:n.provider_key!=ASC.Files.ThirdParty.thirdPartyList.DocuSign.key,getTokenUrl:c.getTokenUrl},b=ASC.Files.Common.jsonToXml({third_partyList:{entry:w}}),l=ASC.Files.TemplateManager.translateFromString(b),a=jq("#account_"+t.providerId);a.length?jq(a).replaceWith(l):(jq("#thirdPartyAccountList").append(l),jq("#emptyThirdPartyContainer").hide(),jq("#thirdPartyAccountContainer").show())}else v=t.corporate?ASC.Files.Constants.FOLDER_ID_COMMON_FILES:ASC.Files.Constants.FOLDER_ID_MY_FILES,v==ASC.Files.Folders.currentFolder.id?(y=ASC.Files.Common.jsonToXml({folder:n}),h=ASC.Files.TemplateManager.translateFromString(y),ASC.Files.EmptyScreen.hideEmptyScreen(),r=ASC.Files.UI.getEntryObject("folder",e),r?(r.replaceWith(h),r=ASC.Files.UI.getEntryObject("folder",e)):(jq("#filesMainContent").prepend(h),r=jq("#filesMainContent .new-folder:first")),r.yellowFade().removeClass("new-folder"),ASC.Files.UI.resetSelectAll(),s=ASC.Files.UI.getObjectTitle(r)):e&&(ASC.Files.UI.getEntryObject("folder",e).remove(),ASC.Files.UI.checkEmptyContent()),r&&r.is(":visible")&&ASC.Files.UI.addRowHandlers(r);o=ASC.Files.Tree.getParentId(n.id);ASC.Files.Tree.reloadFolder(o);t.corporate?o!=ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&ASC.Files.Tree.reloadFolder(ASC.Files.Constants.FOLDER_ID_COMMON_FILES):o!=ASC.Files.Constants.FOLDER_ID_MY_FILES&&ASC.Files.Tree.reloadFolder(ASC.Files.Constants.FOLDER_ID_MY_FILES);ASC.Files.UI.displayInfoPanel(e?ASC.Files.FilesJSResource.InfoChangeThirdParty.format(s):ASC.Files.FilesJSResource.InfoSaveThirdParty.format(s,t.corporate?ASC.Files.FilesJSResource.CorporateFiles:ASC.Files.FilesJSResource.MyFiles));t.providerId||(ASC.Files.Filter.clearFilter(!0),ASC.Files.Anchor.navigationSet(n.id))},dt=function(n,t,i){var o,f,s;if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}var h=t.providerId,r=t.providerKey,e=t.folderId||n,c=t.customerTitle,u=ASC.Files.UI.getEntryObject("folder",e);u!=null&&u.length?(ASC.Files.UI.removeEntryObject(u),ASC.Files.UI.checkEmptyContent()):r==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key&&ASC.Files.ThirdParty.docuSignAttached(!1);o=r==ASC.Files.ThirdParty.thirdPartyList.DocuSign.key?r:h;f=jq("#account_"+o);f.length>0&&(jq(f).remove(),jq("#thirdPartyAccountList .account-row").length==0&&(jq("#thirdPartyAccountContainer").hide(),jq("#emptyThirdPartyContainer").show()));s=ASC.Files.Tree.getParentId(e);ASC.Files.Tree.reloadFolder(s);ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.InfoRemoveThirdParty.format(c))},gt=function(n,t,i){if(typeof i!="undefined"){ASC.Files.UI.displayInfoPanel(i,!0);return}jq("#cbxEnableSettings").prop("checked",n===!0)},ni=function(n,t,r){if(typeof r!="undefined"){ASC.Files.UI.displayInfoPanel(r,!0);return}i(t.thirdParty)},ti=function(n,t,i){var r=t.winSign;if(ASC.Files.UI.blockObject(t.entryObject),typeof i!="undefined"){r.close();ASC.Files.UI.displayInfoPanel(i,!0);return}r&&r.location?r.location.href=n:r=window.open(n,"_blank")};return{init:h,thirdPartyList:s,isThirdParty:c,isDifferentThirdParty:rt,showChangeDialog:a,showDeleteDialog:y,addAccountButton:vt,addNewThirdPartyAccount:p,editTokenThirdPartyAccount:w,changeTokenThirdPartyAccount:b,cancelThirdPartyAccount:k,saveThirdPartyAccount:g,showSettingThirdParty:l,changeAccessToThirdpartySettings:nt,showThirdPartyNewAccount:tt,processAnchor:at,showThirdPartyActionsPanel:it,showMoveThirdPartyMessage:ut,thirdpartyAvailable:ft,docuSignAttached:et,showDocuSignDialog:ot,docuSignFolderSelectorReset:lt}}(),function(n){jq("#thirdPartyEditor").length!=0&&n(function(){jq('#thirdPartyEditor div[id$="InfoPanel"]').removeClass("infoPanel").addClass("errorBox").css("margin","10px 16px 0");jq(".add-account-button, .edit-account-button").on("click",ASC.Files.ThirdParty.addAccountButton);jq("#thirdPartyAccountList").on("click",".edit-account-button",ASC.Files.ThirdParty.addAccountButton);jq("#thirdPartyAccountList").on("click","a.account-cancel-link",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ThirdParty.cancelThirdPartyAccount(this),!1});jq("#thirdPartyAccountList").on("click","a.account-save-link:not(.disable)",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ThirdParty.saveThirdPartyAccount(this),!1});jq("#cbxEnableSettings").on("change",function(){return ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ThirdParty.changeAccessToThirdpartySettings(this),!1});jq(".account-connect").on("click",function(){var n=function(){return ASC.Files.ThirdParty.showThirdPartyNewAccount()};if(jq("#settingThirdPartyPanel:visible").length==0){ASC.Files.Folders.eventAfter=n;ASC.Files.Anchor.move("setting=thirdparty");return}n()});jq("#thirdPartyAccountList").on("click",".menu-small",ASC.Files.ThirdParty.showThirdPartyActionsPanel);jq("#thirdPartyAccountList").on("keyup",".account-input-url, .account-input-login, .account-input-pass, .account-input-folder, .account-cbx-corporate",function(n){var r;r||(r=n);r=jq.fixEvent(r);var u=r.keyCode||r.which,i=jq(this).closest(".account-row"),t=jq(this);if(u==ASC.Files.Common.keyCode.enter){if(!t.val().trim().length)return;if(t.is(".account-input-url")&&(t=i.find(".account-input-login").is(":visible")?i.find(".account-input-login").trigger("focus"):i.find(".account-input-pass").trigger("focus")),!t.val().trim().length)return;if(t.is(".account-input-login")&&(t=i.find(".account-input-pass").trigger("focus")),!t.val().trim().length)return;if(t.is(".account-input-pass")&&(t=i.find(".account-input-folder").trigger("focus")),!t.val().trim().length)return;i.find(".account-save-link").trigger("click")}else u==ASC.Files.Common.keyCode.esc&&i.find(".account-cancel-link").trigger("click")});jq("#thirdPartyAccountList").on("click",".pass-visibility",function(){var t=jq(this),n=t.prev(".account-input-pass");t.toggleClass("visible");n.attr("type")=="password"?n.attr("type","text"):n.attr("type","password")});ASC.Files.ThirdParty.init()})}(jQuery);
window.ASC.Files.Tree=function(){var f=!1,n,t,i=!1,r=!1,u=!1,e=!1,o=function(){var o,s,h,c,l;f===!1&&(f=!0,o=null,jq(".files-content-panel").attr("data-rootid")&&(ASC.Files.Tree.folderIdCurrentRoot=jq(".files-content-panel").attr("data-rootid"),o=ASC.Files.Constants.FOLDER_ID_PROJECT),n=new ASC.Files.TreePrototype("#treeViewContainer",o),n.clickOnFolder=w,o&&n.expandFolder(o),t=new ASC.Files.TreePrototype("#treeViewSelector"),t.clickOnFolder=b,s=t.getFolderData(ASC.Files.Constants.FOLDER_ID_PRIVACY),s&&(e=!0,s.entryObject.addClass("privacy-node")),h=n.getFolderData(ASC.Files.Constants.FOLDER_ID_FAVORITES),h&&(i=!h.entryObject.hasClass("display-none")),c=n.getFolderData(ASC.Files.Constants.FOLDER_ID_RECENT),c&&(r=!c.entryObject.hasClass("display-none")),l=n.getFolderData(ASC.Files.Constants.FOLDER_ID_TEMPLATES),l&&(u=!l.entryObject.hasClass("display-none")))},s=function(i){return n.getFolderTitle(i)||t.getFolderTitle(i)},h=function(t){return n.getParentId(t)},c=function(t){return n.getFolderData(t)},l=function(){for(var r,i=0;i<ASC.Files.Tree.pathParts.length-1;i++)r=ASC.Files.Tree.pathParts[i],n.getFolderData(ASC.Files.Tree.pathParts[i+1])||n.resetFolder(r),n.expandFolder(r,!0,!0);n.setCurrent(ASC.Files.Folders.currentFolder.id);(ASC.Files.Tree.pathParts.length!=1||t.getFolderData(ASC.Files.Folders.currentFolder.id))&&t.setCurrent(ASC.Files.Folders.currentFolder.id)},a=function(){if(t.rollUp(),t.setCurrent(ASC.Files.Folders.currentFolder.id),e){var n=ASC.Files.Folders.folderContainer=="privacy";t.entryObject().toggleClass("only-privacy",n)}},v=function(n){var r=t.getFolderTitle(n),u=t.getPath(n),i=jq(u).map(function(n,i){return t.getFolderTitle(i)});return i.push(r),i.toArray().join(" > ")},y=function(i){if(!ASC.Files.Common.isCorrectId(i))return!1;var r=n.resetFolder(i);return t.resetFolder(i),ASC.Files.ThirdParty&&ASC.Files.ThirdParty.docuSignFolderSelectorReset(i),r},p=function(t){var i=ASC.Files.Tree.resetFolder(t);i&&n.expandFolder(t)},w=function(t){var f,r,e,u,o,i;if(ASC.Files.Tree.folderIdCurrentRoot&&ASC.Files.Tree.folderIdCurrentRoot!=ASC.Files.Constants.FOLDER_ID_PROJECT&&(f=jq.inArray(t+"",ASC.Files.Tree.pathParts)!=-1,!f&&(r=n.getPath(t),e=jq.inArray(ASC.Files.Folders.currentFolder.id,r)!=-1,!e))){u=t;r.length&&(u=r[0]);o=n.getFolderData(u);i=o.folderUrl;i=i.substring(0,i.lastIndexOf("#"));i=i+"#"+ASC.Files.Common.getCorrectHash(t);location.href=i;return}ASC.Files.Filter.clearFilter(!0);ASC.Files.Anchor.navigationSet(t);return},b=function(n){var f=t.getFolderData(n),u,i,r;return ASC.Files.UI.accessEdit(f)?(u=t.getFolderTitle(n),i=t.getPath(n),i.push(n),ASC.Files.Folders.curItemFolderMoveTo(n,u,i),!0):(r=ASC.Files.FilesJSResource.ErrorMassage_SecurityException,(n==ASC.Files.Constants.FOLDER_ID_PROJECT||n==ASC.Files.Constants.FOLDER_ID_SHARE)&&(r=ASC.Files.FilesJSResource.ErrorMassage_SecurityException_PrivateRoot),ASC.Files.UI.displayInfoPanel(r,!0),t.expandFolder(n),!1)},k=function(t){if(t===undefined)return i;i=t===!0;var r=n.getFolderData(ASC.Files.Constants.FOLDER_ID_FAVORITES).entryObject;return r.toggleClass("display-none",!i),i},d=function(t){if(t===undefined)return r;r=t===!0;var i=n.getFolderData(ASC.Files.Constants.FOLDER_ID_RECENT).entryObject;return i.toggleClass("display-none",!r),r},g=function(t){if(t===undefined)return u;u=t===!0;var i=n.getFolderData(ASC.Files.Constants.FOLDER_ID_TEMPLATES).entryObject;return i.toggleClass("display-none",!u),u};return{init:o,resetFolder:y,reloadFolder:p,getFolderTitle:s,getParentId:h,pathParts:[],folderIdCurrentRoot:null,updateTreePath:l,showSelect:a,getPathTitle:v,getFolderData:c,displayFavorites:k,displayRecent:d,displayTemplates:g}}(),function(n){n(function(){jq("#treeViewPanelSelector").length!=0&&ASC.Files.Tree.init()})}(jQuery);
window.ASC.Files.TreePrototype=function(n,t){var r=function(n){return n==c?i:ASC.Files.UI?i.find(".tree-node"+ASC.Files.UI.getSelectorId(n)):i.find('.tree-node[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]')},u=function(n){return jq(n).attr("data-id")},o=function(n){var t=r(n);return t.parents(".jstree .tree-node")},a=function(n,t,i){(n.find("ul").html()||"").trim()!=""&&s(n);t!=""?(n.removeClass("jstree-empty").append("<ul>"+t+"<\/ul>"),n.find("ul a").each(function(){var n=u(this),t=ASC.Files.UI.getEntryLink("folder",n);jq(this).attr("href",t)}),(n.is(l)||l.has(n).length)&&n.find("li").addClass("access-read")):n.addClass("jstree-empty");n.find(".jstree-load-node").removeClass("jstree-load-node");i!==!1&&n.addClass("jstree-open").removeClass("jstree-closed")},s=function(n){n.is(".tree-node")||(n=n.find(".tree-node"));n.addClass("jstree-closed").removeClass("jstree-open jstree-empty").children("ul").remove()},e=function(n,t,i,f){if(ASC.Files.Common.isCorrectId(t))var e=r(t);else e=jq(this).parent(),t=u(e);e.length&&t!=ASC.Files.Constants.FOLDER_ID_FAVORITES&&t!=ASC.Files.Constants.FOLDER_ID_RECENT&&t!=ASC.Files.Constants.FOLDER_ID_TEMPLATES&&t!=ASC.Files.Constants.FOLDER_ID_TRASH&&(e.is(":has(ul)")?e.toggleClass("jstree-closed",i!=null?!i:null).toggleClass("jstree-open",i):y(t,f))},v=function(){var n=jq(this).parent(),t=u(n),i=f.clickOnFolder(t)!==!1;return h(n,i),!1},h=function(n,t){i.find(".node-selected").removeClass("node-selected");i.find(".parent-selected").removeClass("parent-selected");n.addClass("node-selected");n.parents(".jstree .jstree-closed").addClass("jstree-open").removeClass("jstree-closed");n.parents(".jstree .tree-node").addClass("parent-selected");f.selectedFolderId=t?u(n):null},y=function(n,t){ASC.Files.Common.isCorrectId(n)&&(r(n).find(".jstree-expander").addClass("jstree-load-node"),ASC.Files.ServiceManager.getTreeSubFolders(ASC.Files.ServiceManager.events.GetTreeSubFolders,{treeNodeRoot:i,folderId:n,ajaxsync:t===!0}))},p=function(n){ASC.Files.Common.isCorrectId(n)&&ASC.Files.ServiceManager.getTreePath(ASC.Files.ServiceManager.events.GetTreePath,{folderId:n,ajaxsync:!0})},w=function(n,t,u){if(typeof u!="undefined"){f.errorMessage(u);return}var o=t.folderId,s=ASC.Files.TemplateManager.translate(n),e=r(o);if(!e.length){if(c!=null)return;e=i}a(e,s,i==t.treeNodeRoot)},b=function(n,t,i){if(typeof i!="undefined"){f.errorMessage(i);return}n.pop();jq(n).each(function(n,t){e(null,t,!0,!0)})};this.getFolderTitle=function(n){return r(n).children("a:first").text().trim()};this.getPath=function(n){return o(n).map(function(n,t){return u(t)}).toArray().reverse()};this.getParentId=function(n){var t=o(n);return t.length?u(t[0]):0};this.setCurrent=function(n){var t=r(n);t.length||(p(n),t=r(n));h(t,!0)};this.resetFolder=function(n){var t=r(n),i=t.hasClass("jstree-open");return s(t),i};this.rollUp=function(){i.removeClass("node-selected");i.find(".parent-selected").removeClass("parent-selected");i.find(".jstree-open").addClass("jstree-closed").removeClass("jstree-open");f.selectedFolderId=null};this.expandFolder=function(n,t,i){return e(null,n,t,i)};this.selectedFolderId=null;this.clickOnFolder=function(){};this.errorMessage=function(n){ASC.Files.UI&&ASC.Files.UI.displayInfoPanel(n,!0)};this.getFolderData=function(n){var t=r(n);return ASC.Files.UI?ASC.Files.UI.getObjectData(t):{entryId:n,entryType:"folder",entryObject:t,title:getFolderTitle(n)}};this.getDefaultFolderId=function(){return u(i.find(".tree-node:visible:first"))};this.displayAsRoot=function(n){var t=r(n);jq(".jstree-root-as").removeClass("jstree-root-as");t.parents(".tree-node").addClass("jstree-root-parent").addBack().addClass("jstree-root-as");jq(".jstree-root-out").removeClass("jstree-root-out");t.parent().children('.tree-node:not([data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"])').addClass("jstree-root-out")};this.entryObject=function(){return i};var f=this,i=jq(n),c=t,l=i.find("li[data-id="+ASC.Files.Constants.FOLDER_ID_PRIVACY+"]");i.on("click",".jstree-expander",e);i.on("dblclick","a",e);i.on("click","a",v);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreeSubFolders,w);ASC.Files.ServiceManager.bind(ASC.Files.ServiceManager.events.GetTreePath,b)};

