/*
    Copyright (c) Ascensio System SIA 2022. All rights reserved.
    https://www.onlyoffice.com
*/
jQuery.template("userActionMenuTemplate",'<ul class="dropdown-content">{{if ($data.canEdit === "true") && ($data.isAdmin === true || $data.isMe === true ) && (user.status !== "blocked")}}<li><a class="edit-profile dropdown-item with-icon edit">${ASC.People.Resources.PeopleResource.LblEdit}<\/a><\/li>{{/if}}        {{if ($data.canDel === "true") && ($data.isAdmin === true) && (user.status === "blocked")}}<li><a class="enable-profile dropdown-item with-icon enable-item">${ASC.People.Resources.PeopleResource.EnableUserButton}<\/a><\/li>{{/if}}        {{if ($data.canEdit === "true") && ($data.isAdmin === true || $data.isMe === true) && (user.status !== "blocked") && (user.status !== "waited") && (user.isLDAP === "false") && (user.isSSO === "false")}}<li><a class="change-password dropdown-item with-icon block">${ASC.People.Resources.PeopleResource.LblChangePassword}<\/a><\/li>{{/if}}        {{if ($data.isAdmin === true || $data.isMe === true) && (user.status !== "blocked") && (user.status !== "waited") && (user.isLDAP === "false") && (user.isSSO === "false")}}<li><a class="change-email dropdown-item with-icon add-email">${ASC.People.Resources.PeopleResource.LblChangeEmail}<\/a><\/li>{{/if}}        {{if ($data.isAdmin === true || $data.isMe === true) && (user.status === "waited")}}<li><a class="email-activation dropdown-item with-icon email">${ASC.People.Resources.PeopleResource.LblSendActivation}<\/a><\/li>{{/if}}        {{if ($data.canDel === "true") && ($data.isAdmin === true) && ($data.isMe !== true) && (user.status !== "blocked") && (user.isLDAP === "false")}}<li><a class="block-profile dropdown-item with-icon disable-item">${ASC.People.Resources.PeopleResource.DisableUserButton}<\/a><\/li>{{/if}}        {{if (user.isOwner !== "true") && ($data.canDel === "true") && ($data.isAdmin === true) && (user.status === "blocked") && (user.isLDAP === "false")}}<li class="dropdown-item-seporator"><\/li><li><a class="reassign-data dropdown-item with-icon reassign-data">${ASC.People.Resources.PeopleResource.LblReassignData}<\/a><\/li><li><a class="remove-data dropdown-item with-icon delete">${ASC.People.Resources.PeopleResource.LblRemoveData}<\/a><\/li>{{/if}}        {{if (user.isOwner !== "true") && ((($data.canDel === "true") && ($data.isAdmin === true) && (user.status === "blocked") && (user.isLDAP === "false")) || ($data.isMe === true) && (user.isLDAP === "false"))}}<li class="dropdown-item-seporator"><\/li><li><a class="delete-profile dropdown-item with-icon delete">${ASC.People.Resources.PeopleResource.LblDeleteProfile}<\/a><\/li>{{/if}}<\/ul>');jQuery.template("userListTemplate",'{{each(i, user) users}}<tr id="user_${user.id}" class="item profile {{if ($data.isAdmin === true || user.isMe === true) && (user.isMe === true || user.isPortalOwner !== true)}} with-entity-menu {{/if}} {{if user.isTerminated}} blocked{{else user.isPending === true}} waited{{/if}} {{if user.isChecked == true}} selected{{/if}}"        data-id="${user.id}"        data-username="${user.userName}"        data-email="${user.email}"        data-displayname="${user.displayName}"        data-status="{{if user.isTerminated}}blocked{{else user.isActivated === false}}waited{{/if}}"        data-isAdmin="${user.isAdmin}"        data-isOwner="${user.isPortalOwner}"        data-isVisitor="${user.isVisitor}"        data-isLDAP="${user.isLDAP}"        data-isSSO="${user.isSSO}">{{if ($data.isAdmin === true)}}<td class="check-list" id="checkRow_${user.id}"><input type="checkbox" id="checkUser_${user.id}" class="checkbox-user"                   {{if user.isChecked== true}}checked="checked"{{/if}}/><\/td>{{/if}}<td class="icon-list"><a class="ava" href="${user.link}"><img src="{{if $data.isRetina}}${user.avatar}{{else}}${user.avatarSmall}{{/if}}" title="${user.displayName}" alt=""/>{{if (user.isVisitor)}}<span class="role collaborator" title="${ASC.Resources.Master.Guest}"><\/span>{{/if}}                {{if (user.isAdmin || listAdminModules.length) && (!user.isPortalOwner)}}<span class="role admin" title="${ASC.Resources.Master.TemplateResource.Administrator}"><\/span>{{/if}}                {{if (user.isPortalOwner)}}<span class="role owner" title="${ASC.Resources.Master.TemplateResource.Owner}"><\/span>{{/if}}                {{if (user.isTerminated || user.isActivated === false)}}<span class="status"><\/span>{{/if}}<\/a><\/td><td class="name"><a class="link bold" href="${user.link}">${user.displayName}<\/a>{{if ($data.isAdmin === true || $data.isPortalOwner === true)}}                {{if (user.isLDAP === true)}}<span class="ldap-lock" title="${ASC.Resources.Master.LdapUsersListLockTitle}"><\/span>{{/if}}                {{if (user.isSSO === true)}}<span class="sso-lock" title="${ASC.Resources.Master.SsoUsersListLockTitle}"><\/span>{{/if}}                            {{/if}}            {{if user.bithdayDaysLeft != null}}<div class="birthday">{{if user.bithdayDaysLeft == 0}}${ASC.Resources.Master.TemplateResource.DrnToday}            {{else user.bithdayDaysLeft==1}}${ASC.Resources.Master.TemplateResource.DrnTomorrow}            {{else user.bithdayDaysLeft==2}}${ASC.Resources.Master.TemplateResource.In} ${ASC.Resources.Master.TemplateResource.Yet2}            {{else user.bithdayDaysLeft==3}}${ASC.Resources.Master.TemplateResource.In} ${ASC.Resources.Master.TemplateResource.Yet3}            {{/if}}<\/div>{{/if}}<div class="title">{{if user.isGroupManager && user.title.length}}<span class="inner-text manager">${Encoder.htmlEncode(user.title, true)}<\/span>{{else}}<span class="inner-text">${Encoder.htmlEncode(user.title, true)}<\/span>{{/if}}<\/div><\/td><td class="group">{{if user.groups.length === 1}}<a class="link dotted text-overflow" title="${user.groups[0].name}" href="#group=${user.groups[0].id}">${user.groups[0].name}<\/a>{{else user.groups.length > 1}}<span id="peopleGroupsSwitcher_${user.id}" class="withHoverArrowDown"><span class="link dotted">${user.groups.length} ${ASC.Resources.Master.Departments}<\/span><\/span><div id="peopleGroups_${user.id}" class="studio-action-panel"><ul class="dropdown-content">{{each(i, gr) user.groups}}<li><a class="dropdown-item" href="#group=${gr.id}">${gr.name}<\/a><\/li>{{/each}}<\/ul><\/div>{{/if}}<\/td><td class="location"><span class="inner-text">${Encoder.htmlEncode(user.location, true)}<\/span><\/td><td class="info">{{if user.isTerminated}}<span class="red-text">${ASC.People.Resources.PeopleResource.BlockedMessage}<\/span>{{else}}          {{if user.isPending === true && user.email}}<span class="email gray-text">${ASC.People.Resources.PeopleResource.WaitingForConfirmation}<\/span>{{/if}}       {{/if}}      {{if user.isActivated && !user.isTerminated && user.email}}<div id="peopleEmail_${id}" class="btn email"><span class="link dotted">${user.email}<\/span><\/div><div id="peopleEmailSwitcher_${id}" class="studio-action-panel"><ul class="dropdown-content"><li><a class="send-email dropdown-item">${ASC.People.Resources.PeopleResource.LblSendEmail}<\/a><\/li>{{if !user.isMe && !user.isTerminated}}<li><a class="open-dialog dropdown-item">${ASC.People.Resources.PeopleResource.LblSendMessage}<\/a><\/li>{{/if}}<\/ul><\/div>{{else}}        &nbsp;      {{/if}}<\/td><td class="menu-action-list">{{if ($data.isAdmin === true || user.isMe === true) && (user.isMe === true || user.isPortalOwner !== true)}}<div id="peopleMenu_${id}" class="entity-menu" title="${ASC.People.Resources.PeopleResource.Actions}"><\/div>{{/if}}<\/td><\/tr>{{/each}}');jQuery.template("depAddPopupBodyTemplate",'<div class="clearFix block-cnt-splitter requiredField" ><span class="requiredErrorText">${ASC.People.Resources.PeopleResource.ErrorEmptyName}<\/span><div class="headerPanelSmall header-base-small">${ASC.People.Resources.PeopleResource.Title}:<\/div><input type="text" id="studio_newDepName" class="textEdit" style="width: 99%;" maxlength="100" /><\/div><div class="clearFix block-cnt-splitter"><div class="headerPanelSmall header-base-small">${ASC.People.Resources.DepartmentMaster}:<\/div><span id="headAdvancedSelector" class="link dotline plus">${ASC.Resources.Master.ChooseUser}<\/span><div id="departmentManager" class="advanced-selector-select-result display-none"><span class="result-name" data-id=""><\/span><span class="reset-icon"><\/span><\/div><\/div><div class="clearFix"><div class="headerPanelSmall header-base-small" >${ASC.People.Resources.PeopleResource.Members}:<\/div><span id="membersAdvancedSelector" class="link dotline plus">${ASC.People.Resources.PeopleResource.AddMembers}<\/span><div class="members-dep-list"><ul id="membersDepartmentList" class="advanced-selector-list-results"><\/ul><\/div><\/div><div id="depActionBtn" class="middle-button-container"><a class="button blue middle">${ASC.People.Resources.PeopleResource.AddButton}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle">${ASC.People.Resources.PeopleResource.CancelButton}<\/a><\/div>');jQuery.template("reassignStatus",'<div class="${statusClass}">${statusMessage}<\/div>{{if errorMessage}}<div class="red-text">${ASC.People.Resources.PeopleResource.ReassignStatusError}:&nbsp;${errorMessage}<\/div>{{/if}}');jQuery.template("groupListTemplate",'{{each(i, group) groups}}<li class="menu-sub-item" data-id="${group.id}"><a class="menu-item-label outer-text text-overflow" title="${group.name}">${group.name}<\/a><\/li>{{/each}}');jQuery.template("userRecord",'<tr id="hoverItem" class="userItem clearFix"><td class="check"><input class="check" type="checkbox"/><\/td><td class="name"><div class="clearFix"><div class="firstname"><input type="text" class="studioEditableInput firstName last" value="${FirstName}" maxlength="64" /><\/div><div class="lastname"><input type="text" class="studioEditableInput lastName last" value="${LastName}" maxlength="64" /><\/div><\/div><\/td><td class="email"><input type="text" class="studioEditableInput email last" value="${Email}" maxlength="64" /><\/td><td class="status"><span class="link dotline statusValue"><\/span><\/td><\/tr>');jQuery.template("userWizard",'<tr class="userItem clearFix"><td class="fileHeader"><div class="clearFix"><div class="headerContainer">{{tmpl \'headItems\'}}<\/div><div class="userContainer">{{tmpl \'userItems\'}}<\/div><\/div><\/td><td class="optionsContainer">{{each headItem}}            {{tmpl($value, {cols: columns}) \'selectContainer\'}}            {{/each}}<\/td><\/tr>');jQuery.template("headItems",'{{each headItem}}<input type="text" class="studioEditableInputWizard example" value="${$value}" maxlength="64" readonly="readonly"/><br/>{{/each}}');jQuery.template("userItems",'{{each userItem}}<input type="text" class="studioEditableInputWizard example" value="${$value}" maxlength="64" readonly="readonly"/><br/>{{/each}}');jQuery.template("selectContainer",'{{if $item.cols === $data }}<select class="optionMenu" data-prev="${$data}">{{else}}<select class="optionMenu" data-prev="emptyOption">{{/if}}<option value="emptyOption">${ASC.People.Resources.PeopleResource.NotImport}<\/option>{{each $item.cols}}        {{if $value.Key != "status" }}            {{if $value.Value === $data }}<option value="${$value.Key}" selected>${$value.Value}<\/option>{{else}}<option value="${$value.Key}">${$value.Value}<\/option>{{/if}}        {{/if}}    {{/each}}<\/select>');jQuery.template("wizardStepsTmpl",'<div id="${id}" class="wizard"><span class="importStepName">${name}<\/span><span class="importCounter"><\/span><\/div>');jQuery.template("compliancetTableHeader",'<tr><td  class="innerTab first">${ASC.People.Resources.PeopleResource.FieldsInFile}<\/td><td  class="innerTab">${ASC.People.Resources.PeopleResource.ExampleValues}<span class="newRandomUser"><\/span><\/td><td  class="innerTab last">${ASC.People.Resources.PeopleResource.FieldsOnPortal}<\/td><\/tr>');jQuery.template("selectionTableHeader",'<tr><td  class="selectionInnerTab first">${ASC.People.Resources.PeopleResource.FirstName}<\/td><td  class="selectionInnerTab">${ASC.People.Resources.PeopleResource.LastName}<\/td><td  class="selectionInnerTab last">${ASC.People.Resources.PeopleResource.Email}<\/td><\/tr>');
var PeopleManager=new function(){this.GroupHeader="";this.SelectedCount="";this.UserLimit="";this.GuestLimit=""};
(function(){function n(n,t){jq("#peopleFilter").advansedFilter({nonetrigger:!0,hintDefaultDisable:!0,sorters:[{id:t.sortby,dsc:t.sortorder}],filters:[{id:"text",params:{value:t.query}},{id:"selected-group",params:t.groupId?{id:t.groupId}:null},{id:"selected-employee-status-active",params:t.employeestatus?{value:t.employeestatus}:null},{id:"selected-employee-status-disabled",params:t.employeestatus?{value:t.employeestatus}:null},{id:"selected-activation-status-active",params:t.activationstatus?{value:t.activationstatus}:null},{id:"selected-activation-status-pending",params:t.activationstatus?{value:t.activationstatus}:null},{id:"selected-type-admin",params:t.type?{value:t.type}:null},{id:"selected-type-user",params:t.type?{value:t.type}:null},{id:"selected-type-visitor",params:t.type?{value:t.type}:null}]});(t.groupId||t.employeestatus||t.activationstatus||t.type)&&jq("#peopleFilter").addClass("has-filters")}jq(window).on("people-render-profiles",n)})();
typeof ASC=="undefined"&&(ASC={});typeof ASC.People=="undefined"&&(ASC.People={});ASC.People.PageNavigator=function(){var n,t,i=function(){function u(i,r){var u=r.__total||r.__count;n.drawPageNavigator(r.page,u);t||(t=jq("#totalUsers"));t.text(u)}var i=ASC.People,r=i.Resources;n=new ASC.Controls.PageNavigator.init("ASC.People.PageNavigator.pgNavigator","#peoplePageNavigator",25,3,1,r.PreviousPage,r.NextPage);n.changePageCallback=function(n){i.PeopleController.moveToPage(n)};jq(window).on("people-render-profiles",u)};return{init:i,get pgNavigator(){return n}}}();jq(document).ready(function(){ASC.People.PageNavigator.init()});
typeof ASC=="undefined"&&(ASC={});typeof ASC.People=="undefined"&&(ASC.People=function(){return{}}());ASC.People.PeopleController=function(){function nt(){LoadingBanner.displayLoading()}function tt(){LoadingBanner.hideLoading()}function yt(){jq(".mainPageContent").children(".loader-page").css({top:jq(window).height()/2+"px"})}function pt(){d=!1;jq(".mainPageContent").children(".loader-page").remove();jq(".profile-title, #filterContainer, #tableForPeopleNavigation").removeClass("display-none");jq("#peopleFilter").advansedFilter("resize")}function h(n){for(var t,i,u=[],r=0,f=n.length;r<f;r++)t=n[r],t.groups=window.GroupManager.getGroups(window.UserManager.getUser(t.id).groups),t.link="Profile.aspx?user="+encodeURIComponent(t.userName),i=wt(t.birthdayApiString),i>=0&&i<4&&(t.bithdayDaysLeft=i),u.push(t);return u}function wt(n){function t(n){if(n<1||n>9999)throw new Error("ArgumentOutOfRange_Year");return n%4==0?n%100==0?n%400==0:!0:!1}function i(n){var u=new Date,i=new Date(u.getTime()+(u.getTimezoneOffset()+ASC.Resources.Master.CurrentTenantTimeZone.UtcOffset)*6e4),f=t(i.getFullYear())||n.getMonth()==1&&n.getDate()==29?2e3:2001,e=new Date(f,i.getMonth(),i.getDate()),o=new Date(f,n.getMonth(),n.getDate()),r=Math.round((o-e)/864e5);return r<0&&(r+=365),r}if(!n)return-1;var r=window.ServiceFactory.serializeUtcDate(n);return i(r)}function bt(n){var t,i;n=n||{};n.fields="id,status,isAdmin,isOwner,isVisitor,activationStatus,userName,email,displayName,avatarSmall,listAdminModules,birthday,title,location,isLDAP,isSSO";jq.cookies.get("is_retina")&&(n.fields+=",avatar");t=jq.anchorToObject(ASC.Controls.AnchorController.getAnchor());for(i in t)if(t.hasOwnProperty(i))switch(i){case"sortby":n.sortby=t[i];break;case"sortorder":n.sortorder=t[i];break;case"query":n.filtervalue=decodeURIComponent(t[i]);break;case"group":n.groupId=t[i];break;case"employeestatus":n.employeestatus=t[i];break;case"activationstatus":n.activationstatus=t[i];break;case"type":n.type=t[i]}if(n.hasOwnProperty("employeestatus"))switch(n.employeestatus){case"active":n.employeestatus=1;break;case"disabled":n.employeestatus=2;break;default:delete n.employeestatus}if(n.hasOwnProperty("activationstatus"))switch(n.activationstatus){case"active":n.activationstatus=1;break;case"pending":n.activationstatus=2;break;default:delete n.activationstatus}if(n.hasOwnProperty("type")){switch(n.type){case"user":n.employeeType=1;break;case"visitor":n.employeeType=2;break;case"admin":n.isadministrator=!0}delete n.type}return n}function et(n){n.filter("tr.profile").each(function(){var t=jq(this),n=jq(this).attr("data-id"),u=t.find("td.info:first [id^='peopleEmailSwitcher'] .dropdown-item"),r,i;u.on("click",dt);r=t.find(".btn.email:first");r.length==1&&jq.dropdownToggle({dropdownID:"peopleEmailSwitcher_"+n,switcherSelector:"#peopleEmail_"+n,addTop:4,addLeft:17,rightPos:!0,showFunction:function(){jq(this).parents("tr.profile:first").addClass("hover")},hideFunction:function(){jq(this).parents("tr.profile:first").removeClass("hover")}});i=t.find("td.group:first .withHoverArrowDown");i.length==1&&jq.dropdownToggle({dropdownID:"peopleGroups_"+n,switcherSelector:"#peopleGroupsSwitcher_"+n,addTop:4,addLeft:17,rightPos:!0,showFunction:function(n,t){t.is(":hidden")?n.addClass("active"):n.removeClass("active")},hideFunction:function(){i.removeClass("active")}})})}function kt(t,i){for(var f,e,c,s,h=[],r=0,o=n.length;r<o;r++)h.push(n[r].id);for(f=!1,e=jq.getAnchorParam("group",ASC.Controls.AnchorController.getAnchor()),r=0,o=i.length;r<o;r++)c=jq.inArray(i[r].id,h),i[r].isChecked=c!=-1,i[r].isGroupManager=i[r].groups.some(function(n){return e?e==n.id&&n.manager==i[r].userName:n.manager==i[r].userName}),f=f||i[r].isGroupManager;e&&f&&(i=i.sort(function(n){return-1*n.isGroupManager}));u=i;s=jq.tmpl("userListTemplate",{users:i,isAdmin:Teamlab.profile.isAdmin||window.ASC.Resources.Master.IsProductAdmin,isRetina:g});jq("#peopleData tbody").empty().append(s);et(jq(s));jq(window).trigger("people-render-profiles",[t,i]);at();di()}function gt(n,t){t=h(t);t!=null&&t.length>0?(kt(n,t),jq("#emptyContentForPeopleFilter").addClass("display-none"),jq(".people-content").removeClass("display-none"),pi()):(jq(window).trigger("people-render-profiles",[n,t]),jq(".people-content").addClass("display-none"),jq("#emptyContentForPeopleFilter").removeClass("display-none"));jq("#peopleHeaderMenu .on-top-link").trigger("click")}function ni(){window.location.href=jq.clearUrl()}function ti(n,t){DepartmentManagement.EditDepartmentOpenDialog(t)}function ii(n,t){return n==null||t==null?!1:(n=jq.removeParam("p",n),n=jq.removeParam("c",n),n=jq.removeParam("sortby",n),n=jq.removeParam("sortorder",n),n=jq.removeParam("query",n),t=jq.removeParam("p",t),t=jq.removeParam("c",t),t=jq.removeParam("sortby",t),t=jq.removeParam("sortorder",t),t=jq.removeParam("query",t),jq.isEqualAnchors(jq.anchorToObject(t),jq.anchorToObject(n)))}function ri(){var n=ASC.Controls.AnchorController.getAnchor(),t,u,e,f,o,h;if(r===n)return undefined;if(t=jq.anchorToObject(n),u=r!=null?jq.anchorToObject(r):null,!t.hasOwnProperty("sortorder"))if(u!=null&&u.hasOwnProperty("sortby")&&u.hasOwnProperty("sortorder"))t.sortby=u.sortby,t.sortorder=u.sortorder;else if(t.sortby=ASC.People.Data.userDisplayFormat==1?"firstname":"lastname",t.sortorder="ascending",u==null&&(Teamlab.profile.isAdmin||window.ASC.Resources.Master.IsProductAdmin)){e=!1;f=window.UserManager.getAllUsers(!0);for(o in f)if(f.hasOwnProperty(o)&&(h=f[o],h.isActivated===!0&&h.isOwner===!1)){e=!0;break}e&&(t.employeestatus="active")}n=jq.objectToAnchor(t);ii(r,n)||(n=jq.removeParam("p",n),n=jq.removeParam("c",n));ASC.Controls.AnchorController.safemove(n);r=n;i.CurrentPageNumber=1;s(1,"pageOfProfilesList");it();jq(window).trigger("change-group",[jq.getAnchorParam("group")||null])}function ui(){var n=jq.getAnchorParam("group")||null;n!=null&&Teamlab.getGroup({},n,{filter:null,before:nt,after:tt,success:ti})}function ot(t,i,r){var u,f;if(jq("#peopleActionMenu").hide(),jq("#peopleMenu_"+t).removeClass("active"),i==1&&e.availableUsersCount==0&&r=="false"){jq("#tariffLimitExceedUsersPanel").length?TariffLimitExceed.showLimitExceedUsers():toastr.error(ASC.Resources.Master.ResourceJS.UserSelectorErrorLimitUsers);return}u=[];u.push(t);f={userIds:u};Teamlab.updateUserStatus({},i,f,{success:function(t,i){var u=h(i),r,f;for(ut(t,u),r=0,f=u.length;r<f;r++)jq.inArray(u[r],n)==-1&&n.push(u[r]);c();toastr.success(ASC.People.Resources.PeopleJSResource.SuccessChangeUserStatus);k()},before:nt,after:tt,error:function(n,t){toastr.error(t)}})}function st(n){var t=jq("#user_"+n),i=t.attr("data-email"),r=t.attr("data-username"),s=t.attr("data-displayname"),h=t.attr("data-status"),c=t.attr("data-isOwner"),f=t.attr("data-isVisitor"),u=jq("#peopleActionMenu"),l=u.attr("data-canedit").toLowerCase(),a=u.attr("data-candel").toLowerCase(),v=t.attr("data-isLDAP"),y=t.attr("data-isSSO"),e={id:n,email:i,username:r,status:h,isOwner:c,isLDAP:v,isSSO:y},p=jq.tmpl("userActionMenuTemplate",{user:e,isAdmin:Teamlab.profile.isAdmin||window.ASC.Resources.Master.IsProductAdmin,isMe:e.id===Teamlab.profile.id,canEdit:l,canDel:a}),o;u.html(p);o=u.find(".dropdown-item");o.on("click",function(e){var o=jq(e.target);u.hide();jq("#peopleMenu_"+n).removeClass("active");jq(this).hasClass("edit-profile")?window.location.replace("ProfileAction.aspx?action=edit&user="+encodeURIComponent(r)):jq(this).hasClass("change-password")?PasswordTool.ShowPwdReminderDialog("1",i):jq(this).hasClass("change-email")?ASC.EmailOperationManager.showEmailChangeWindow(i,n):jq(this).hasClass("email-activation")?ASC.EmailOperationManager.sendEmailActivationInstructions(i,n,function(n){t.attr("data-email",n.request.args.email)}):jq(this).hasClass("block-profile")?ot(n,2,f):jq(this).hasClass("enable-profile")?ot(n,1,f):jq(this).hasClass("reassign-data")?window.location.replace("Reassigns.aspx?user="+encodeURIComponent(r)):jq(this).hasClass("remove-data")?window.location.replace("Reassigns.aspx?remove=true&user="+encodeURIComponent(r)):jq(this).hasClass("delete-profile")&&(n==Teamlab.profile.id?(jq("#studio_deleteProfileDialog").find(".email").attr("href","../../addons/mail/#composeto/email="+i).html(i),StudioBlockUIManager.blockUI("#studio_deleteProfileDialog",400)):ProfileManager.RemoveUser(n,s,r))})}function fi(){var t=jq("#peopleActionMenu"),n;t.length==1&&(n=-200,jq.dropdownToggle({dropdownID:"peopleActionMenu",switcherSelector:"#peopleData .entity-menu",addTop:0,addLeft:n,fixWinSize:!0,showFunction:function(t,i){var r=t.attr("id").split("_")[1],u;r&&(st(r),t.addClass("active"),u=parseInt(i.css("left"))-i.innerWidth()+29-n,i.css("left",u),jq("#peopleData .entity-menu.active").length>1?(jq("#peopleData .entity-menu.active").not(t).removeClass("active"),i.hide()):i.is(":hidden")||t.removeClass("active"))},hideFunction:function(){jq("#peopleData .entity-menu.active").removeClass("active")}}))}function ei(){jq.tmpl("template-blockUIPanel",{id:"confirmationDeleteDepartmentPanel",headerTest:ASC.People.Resources.PeopleResource.Confirmation,innerHtmlText:'<div class="confirmationAction"><\/div>',OKBtn:ASC.People.Resources.PeopleResource.LblOKButton,CancelBtn:ASC.People.Resources.PeopleResource.LblCancelButton}).insertAfter("#peopleActionMenu");jq.tmpl("template-blockUIPanel",{id:"studio_deleteProfileDialog",headerTest:jq("#studio_deleteProfileDialogBody").attr("data-header")}).insertAfter("#studio_deleteProfileDialogBody");jq("#studio_deleteProfileDialog .containerBodyBlock:first").replaceWith(jq("#studio_deleteProfileDialogBody").removeClass("display-none").addClass("containerBodyBlock"));(Teamlab.profile.isAdmin||window.ASC.Resources.Master.IsProductAdmin)&&(jq("#changeTypeDialogBody").length==1&&(jq.tmpl("template-blockUIPanel",{id:"changeTypeDialog",headerTest:ASC.People.Resources.PeopleResource.ChangeTypeDialogHeader}).insertAfter("#changeTypeDialogBody"),jq("#changeTypeDialog .containerBodyBlock:first").replaceWith(jq("#changeTypeDialogBody").removeClass("display-none").addClass("containerBodyBlock"))),jq("#changeStatusDialogBody").length==1&&(jq.tmpl("template-blockUIPanel",{id:"changeStatusDialog",headerTest:ASC.People.Resources.PeopleResource.ChangeStatusDialogHeader}).insertAfter("#changeStatusDialogBody"),jq("#changeStatusDialog .containerBodyBlock:first").replaceWith(jq("#changeStatusDialogBody").removeClass("display-none").addClass("containerBodyBlock"))),jq.tmpl("template-blockUIPanel",{id:"deleteUsersDialog",headerTest:ASC.People.Resources.PeopleResource.DeleteUserProfiles,innerHtmlText:['<div class="confirmationAction">',ASC.People.Resources.PeopleResource.DeleteUsersDescriptionText,"<\/div>","<div>",ASC.People.Resources.NotBeUndone,"<\/div>",'<div class="warning-header red-text">',ASC.People.Resources.Warning,"<\/div>",'<div class="confirmationAction">',ASC.People.Resources.PeopleResource.DeleteUsersDataConfirmation,"<\/div>",'<a class="link dotline showBtn">',ASC.People.Resources.PeopleResource.ShowSelectedUserList,"<\/a>",'<a class="link dotline hideBtn display-none">',ASC.People.Resources.PeopleResource.HideSelectedUserList,"<\/a>",'<div class="user-list-for-group-operation display-none"><\/div>','<div class="error-popup display-none"><\/div>'].join(""),OKBtn:ASC.People.Resources.PeopleResource.LblOKButton,CancelBtn:ASC.People.Resources.PeopleResource.LblCancelButton}).insertAfter("#changeTypePanel"),jq.tmpl("template-blockUIPanel",{id:"resendInviteDialog",headerTest:ASC.People.Resources.PeopleResource.ResendInviteDialogHeader,innerHtmlText:["<div>",ASC.People.Resources.PeopleResource.ResendInviteDialogTargetUsers,"<\/div>","<div>",ASC.People.Resources.PeopleResource.ResendInviteDialogAfterActivation,"<\/div>",'<a class="link dotline showBtn">',ASC.People.Resources.PeopleResource.ShowSelectedUserList,"<\/a>",'<a class="link dotline hideBtn display-none">',ASC.People.Resources.PeopleResource.HideSelectedUserList,"<\/a>",'<div class="user-list-for-group-operation display-none"><\/div>','<div class="error-popup display-none"><\/div>'].join(""),OKBtn:ASC.People.Resources.PeopleResource.LblOKButton,OKBtnID:"resentInviteOkBtn",CancelBtn:ASC.People.Resources.PeopleResource.LblCancelButton,CancelBtnID:"resentInviteCancelBtn"}).insertAfter("#changeTypePanel"))}function oi(){jq.tmpl("template-emptyScreen",{ID:"emptyContentForPeopleFilter",ImgSrc:ASC.People.Data.emptyScreenPeopleFilter,Header:ASC.People.Resources.PeopleResource.NotFoundTitle,Describe:ASC.People.Resources.PeopleResource.NotFoundDescription,ButtonHTML:["<a class='clearFilterButton link dotline' href='javascript:void(0);'","onclick='ASC.People.PeopleController.resetAllFilters();'>",ASC.People.Resources.PeopleResource.ClearButton,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#peopleContent")}function it(){var t=jq.cookies.get("countOfProfilesList"),l,a;t&&(i.EntryCountOnPage=t.key);t=jq.cookies.get("pageOfProfilesList");t&&(i.CurrentPageNumber=t.key);var r=i.EntryCountOnPage,n=i.CurrentPageNumber,u=jq.getAnchorParam("type")||null,f=jq.getAnchorParam("employeestatus")||null,e=jq.getAnchorParam("activationstatus")||null,o=jq.getAnchorParam("group")||null,s=jq.getAnchorParam("sortby")||ASC.People.Data.userDisplayFormat==1?"firstname":"lastname",h=jq.getAnchorParam("sortorder")=="descending"||!1,c=decodeURIComponent(jq.getAnchorParam("query"));n=isFinite(+n)?+n:0;jq("#countOfRows").val(r).tlCombobox();l={sortby:s,sortorder:h,page:n,type:u,employeestatus:f,activationstatus:e,groupId:o,query:c};a=bt({StartIndex:(n>0?n-1:n)*r,Count:r,sortby:s,sortorder:h,employeestatus:f,activationstatus:e});Teamlab.getProfilesByFilter(l,{filter:a,before:function(){d||nt()},after:function(){d?pt():tt()},success:gt});u||status||o||c.length||jq("#peopleFilter").advansedFilter(null)}var ft=!1,d=!0,r=null,u=[],n=[],f=1,o=1,e={},i,g,dt=function(n){var t=jq(this);peopleActions.callMethodByClassname(t.attr("class"),this,[n,t]);jq(document.body).trigger("click")},si=function(){if(ft!==!1)return undefined;ft=!0;g=jq.cookies.get("is_retina");i=ASC.People.PageNavigator.pgNavigator;yt();oi();dr();ei();k();gr();nu();fi();ASC.Controls.AnchorController.bind(ri)},ht=function(n){for(var i={},t=null,r=0,u=n.length;r<u;r++){t=n[r];switch(t.id){case"sorter":i.sortby=t.params.id;i.sortorder=t.params.sortOrder;break;case"text":i.query=encodeURIComponent(t.params.value);break;case"selected-employee-status-active":case"selected-employee-status-disabled":i.employeestatus=t.params.value;break;case"selected-activation-status-active":case"selected-activation-status-pending":i.activationstatus=t.params.value;break;case"selected-type-admin":case"selected-type-user":case"selected-type-visitor":i.type=t.params.value;break;case"selected-group":i.group=t.params.id}}return i},hi=function(n,t,r,u,f){i.CurrentPageNumber=1;s(1,"pageOfProfilesList");l();var e=ASC.Controls.AnchorController.getAnchor(),o=ht(f);r.id==="text"&&(e=jq.removeParam("p",e),e=jq.removeParam("c",e));e=jq.anchorToObject(e);o=jq.mergeAnchors(e,o);jq.isEqualAnchors(o,e)||ASC.Controls.AnchorController.move(jq.objectToAnchor(o))},ci=function(n,t,u,f){i.CurrentPageNumber=1;s(1,"pageOfProfilesList");l();var o=jq.anchorToObject(ASC.Controls.AnchorController.getAnchor()),e=ht(f);return u.id==="text"&&(r=jq.removeParam("query",r)),jq.isEqualAnchors(e,o)||ASC.Controls.AnchorController.move(jq.objectToAnchor(e)),u.id==="text"?it():void 0},li=function(){var n=jq.getAnchorParam("group")||null;n!=null&&Teamlab.deleteGroup({},n,{before:function(){LoadingBanner.showLoaderBtn("#confirmationDeleteDepartmentPanel")},after:function(){LoadingBanner.hideLoaderBtn("#confirmationDeleteDepartmentPanel")},success:ni})},ai=function(){i.CurrentPageNumber=1;s(1,"pageOfProfilesList");l();r=jq.removeParam("query",r);ASC.Controls.AnchorController.move("")},vi=function(n){i.CurrentPageNumber=n;s(n,"pageOfProfilesList");it()},yi=function(n){if(!isNaN(n)){var t=n*1;i.EntryCountOnPage=t;s(t,"countOfProfilesList");ASC.People.PeopleController.moveToPage("1")}},s=function(n,t){if(t&&t!=""){var i={key:n};jq.cookies.set(t,i,{path:location.pathname})}},tu=function(){var t=911,n;jq(window).width()>1200&&(t=jq(window).width()-330);n=t-defaultSize.mainContent;n=n>0?n:0;jq("#SubTasksBody .taskList .taskPlace .taskName").each(function(){var t=defaultSize.taskRowEntryTitleName;jq(this).css("max-width",t+n+"px")})},pi=function(){jq("#peopleHeaderMenu").show();jq(window).trigger("scroll")},ct=function(){jq("#peopleHeaderMenu").find(".menuChangeType, .menuChangeStatus, .menuSendInvite, .menuRemoveUsers, .menuWriteLetter").removeClass("unlockAction").off("click");jq("#changeTypePanel, #changeStatusPanel").hide()},c=function(){var s=0,h=0,r=0,c=0,l=1,a=1,v=1,y=1,u=jq("#peopleHeaderMenu .menuChangeType"),f=jq("#peopleHeaderMenu .menuChangeStatus"),w=jq("#changeTypePanel"),b=jq("#changeStatusPanel"),e=jq("#peopleHeaderMenu .menuSendInvite"),o=jq("#peopleHeaderMenu .menuRemoveUsers"),k=jq("#peopleHeaderMenu .menuWriteLetter"),i,p,t;if(n.length===0){ct();return}for(i=0,p=n.length;i<p;i++)t=n[i],r++,t.isTerminated?t.isLDAP||c++:(t.isAdmin||t.listAdminModules.length||t.isPortalOwner||h++,t.isActivated||t.isSSO||s++),t.isVisitor?a--:l--,t.isTerminated?y--:v--,(t.isPortalOwner||t.isLDAP)&&r--;k.addClass("unlockAction");f.hasClass("unlockAction")||f.addClass("unlockAction");r>0?(b.find(".dropdown-item").removeClass("disable"),v>0&&jq("#changeStatusPanel ul li:last-child a").addClass("disable"),y>0&&jq("#changeStatusPanel ul li:first-child a").addClass("disable")):f.removeClass("unlockAction");u.hasClass("unlockAction")||u.addClass("unlockAction");h>0?(w.find(".dropdown-item").removeClass("disable"),l>0&&jq("#changeTypePanel ul li:last-child a").addClass("disable"),a>0&&jq("#changeTypePanel ul li:first-child a").addClass("disable")):u.removeClass("unlockAction");s>0?e.hasClass("unlockAction")||e.addClass("unlockAction"):e.removeClass("unlockAction");c>0?o.hasClass("unlockAction")||o.addClass("unlockAction"):o.removeClass("unlockAction")},wi=function(t){for(var s,i,f,o=jq(t).is(":checked"),e=[],r=0,h=n.length;r<h;r++)e.push(n[r].id);for(r=0,s=u.length;r<s;r++)i=u[r],f=jq.inArray(i.id,e),o&&f==-1&&(n.push(i),e.push(i.id),jq("#user_"+i.id).addClass("selected"),jq("#checkUser_"+i.id).prop("checked",!0)),o||f==-1||(n.splice(f,1),e.splice(f,1),jq("#user_"+i.id).removeClass("selected"),jq("#checkUser_"+i.id).prop("checked",!1));rt(n.length);c()},bi=function(){var n=jq(this).attr("id").split("_")[1].trim();lt(n,!jq("#checkUser_"+n).is(":checked"))},ki=function(n){var t=jq(this).attr("id").split("_")[1].trim();lt(t,this.checked);n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation()},lt=function(t,i){for(var s,f,e=null,r=0,o=u.length;r<o;r++)t==u[r].id&&(e=u[r]);for(s=[],r=0,o=n.length;r<o;r++)s.push(n[r].id);f=jq.inArray(t,s);jq("#checkUser_"+t).prop("checked",i===!0);i?(jq("#user_"+t).addClass("selected"),f==-1&&e!=null&&n.push(e),at()):(jq("#mainSelectAll").prop("checked",!1),jq("#user_"+t).removeClass("selected"),f!=-1&&n.splice(f,1));rt(n.length);c()},l=function(){n=[];jq("#peopleData input:checkbox").prop("checked",!1);jq("#mainSelectAll").prop("checked",!1);jq("#peopleData tr.selected").removeClass("selected");rt(n.length);ct()},at=function(){var n=jq("#peopleData tbody tr").length,t=jq("#peopleData input[id^=checkUser_]:checked").length;jq("#mainSelectAll").prop("checked",n==t)},rt=function(n){n>0?(jq("#peopleHeaderMenu .menu-action-checked-count > span").text(jq.format(PeopleManager.SelectedCount,n)),jq("#peopleHeaderMenu .menu-action-checked-count").show()):(jq("#peopleHeaderMenu .menu-action-checked-count > span").text(""),jq("#peopleHeaderMenu .menu-action-checked-count").hide())},di=function(){jq("#peopleHeaderMenu .menu-action-simple-pagenav").html("");var n=jq("<div><\/div>"),t=0,i=jq("#tableForPeopleNavigation .pagerPrevButtonCSSClass"),r=jq("#tableForPeopleNavigation .pagerNextButtonCSSClass");i.length!=0&&(t++,i.clone().appendTo(n));r.length!=0&&(t++,t===2&&jq("<span style='padding: 0 8px;'>&nbsp;<\/span>").clone().appendTo(n),r.clone().appendTo(n));n.children().length!=0?(n.appendTo("#peopleHeaderMenu .menu-action-simple-pagenav"),jq("#peopleHeaderMenu .menu-action-simple-pagenav").show()):jq("#peopleHeaderMenu .menu-action-simple-pagenav").hide()},gi=function(n){jq("#changeTypePanel").hide();var t=parseInt(jq(n).attr("data-type"));nr(t);StudioBlockUIManager.blockUI("#changeTypeDialog",500);PopupKeyUpActionProvider.ClearActions();PopupKeyUpActionProvider.EnterAction="jq(\".changeTypeDialogOk\").trigger('click');"},nr=function(n){var i;f=n;var r=jq("#changeTypeDialog"),u=jq("#changeTypeDialog .user-list-for-group-operation"),o=tr();t(r);b(r);a(o,u);jq(".changeTypeDialogTariff").hide();jq("#userTypeInfo .action-info").removeClass("display-none");jq("#changeTypeDialog .selected-users-info").removeClass("display-none");f==1?(jq(".visitorContainer").addClass("display-none"),jq(".userContainer").removeClass("display-none"),jq("#userTypeInfo").removeClass("display-none"),jq("#visitorTypeInfo").addClass("display-none"),jq(".changeTypeDialogTariff").length&&(jq(".changeTypeDialogTariff").show(),jq(".changeTypeDialogTariff~.changeTypeDialogOk").length),i=e.availableUsersCount,jq("#userTypeInfo .tariff-limit").html(jq.format(PeopleManager.UserLimit,"<b>",i,"<\/b>")),vt(u,i),i==0&&(jq("#userTypeInfo .action-info").addClass("display-none"),jq("#changeTypeDialog .selected-users-info").addClass("display-none"))):f==2&&(jq(".userContainer").addClass("display-none"),jq(".visitorContainer").removeClass("display-none"),jq("#visitorTypeInfo").removeClass("display-none"),jq("#userTypeInfo").addClass("display-none"),jq(".changeTypeDialogTariff").length&&(jq(".changeTypeDialogTariff").show(),jq(".changeTypeDialogTariff~.changeTypeDialogOk").length),i=e.maxVisitors-e.visitorsCount,jq("#visitorTypeInfo .tariff-limit").html(jq.format(PeopleManager.GuestLimit,"<b>",i,"<\/b>")),e.maxVisitors!=-1&&vt(u,i),i==0&&(jq("#userTypeInfo .action-info").addClass("display-none"),jq("#changeTypeDialog .selected-users-info").addClass("display-none")));r.find("input[disabled]").length==r.find("input").length?jq(".changeTypeDialogOk").addClass("disable"):jq(".changeTypeDialogOk").removeClass("disable")},tr=function(){for(var t,i=jq.extend(!0,[],n),r=0,u=i.length;r<u;r++)t=i[r],(t.isPortalOwner||t.isAdmin||t.isMe)&&(t.locked=!0),t.listAdminModules.length&&(t.locked=!0),t.isTerminated&&(t.locked=!0),f!=1||t.isVisitor||(t.locked=!0),f==2&&t.isVisitor&&(t.locked=!0);return i},vt=function(n,t){if(typeof t!="undefined"&&t!=null){var i=jq(n),r=0;i.find("input[type=checkbox]").each(function(n,i){var u=jq(i);u.attr("locked")?u.prop("checked",!1).prop("disabled",!0):t>0&&r<t?(u.prop("checked",!0).prop("disabled",!1),r++):u.prop("checked",!1).prop("disabled",!0)});i.on("click","input[type=checkbox]",function(){ir(this,n,t)})}},ir=function(n,t,i){var f=jq(n),e=jq(t),r=e.find("input[type=checkbox]"),u;if(f.is(":checked")){if(u=r.filter(":checked").length,u>i){f.prop("checked",!1);return}u==i&&r.each(function(n,t){var i=jq(t);i.is(":checked")||i.prop("disabled",!0)})}else r.each(function(n,t){var i=jq(t);i.attr("locked")?i.prop("checked",!1).prop("disabled",!0):i.prop("disabled",!1)})},rr=function(){var n=jq("#changeTypeDialog"),r=jq("#changeTypeDialog .user-list-for-group-operation"),i=y(r),u={userIds:i};if(i.length==0)return jq.unblockUI(),!1;Teamlab.updateUserType({},f,u,{success:function(i,r){var u=h(r);ut(i,u);jq("#changeTypePanel .dropdown-item").removeClass("disable");jq("#changeTypePanel .dropdown-item[data-type="+f+"]").addClass("disable");t(n);jq.unblockUI();toastr.success(ASC.People.Resources.PeopleJSResource.SuccessChangeUserType);k()},error:function(i,r){t(n);w(n,r)},after:function(){t(n)},before:function(){p(n)}})},ur=function(n){jq("#changeStatusPanel").hide();var t=parseInt(jq(n).attr("data-status"));fr(t);StudioBlockUIManager.blockUI("#changeStatusDialog",650);PopupKeyUpActionProvider.ClearActions();PopupKeyUpActionProvider.EnterAction="jq(\"#changeStatusOkBtn\").trigger('click');"},fr=function(n){var r;o=n;var i=jq("#changeStatusDialog"),u=jq("#changeStatusDialog .user-list-for-group-operation"),f=er();t(i);b(i);a(f,u);jq("#changeStatusTariff").hide();jq("#changeStatusOkBtn").removeClass("gray").addClass("blue");jq("#activeStatusInfo .action-info").removeClass("display-none");jq("#changeStatusDialog .selected-users-info").removeClass("display-none");o==1?(jq("#activeStatusInfo").removeClass("display-none"),jq("#terminateStatusInfo").addClass("display-none"),jq("#changeStatusTariff").length&&(jq("#changeStatusTariff").show(),jq("#changeStatusTariff~#changeStatusOkBtn").length&&jq("#changeStatusOkBtn").removeClass("blue").addClass("gray")),r=e.availableUsersCount,jq("#activeStatusInfo .tariff-limit").html(jq.format(PeopleManager.UserLimitExcludingGuests,"<b>",r,"<\/b>")),or(u,r)):o==2&&(jq("#activeStatusInfo").addClass("display-none"),jq("#terminateStatusInfo").removeClass("display-none"));i.find("input[disabled]").length==i.find("input").length?jq("#changeStatusOkBtn").addClass("disable"):jq("#changeStatusOkBtn").removeClass("disable")},er=function(){for(var t,i=jq.extend(!0,[],n),r=0,u=i.length;r<u;r++)t=i[r],(t.isPortalOwner||t.isMe||t.isLDAP)&&(t.locked=!0),o!=1||t.isTerminated||(t.locked=!0),o==2&&t.isTerminated&&(t.locked=!0);return i},or=function(n,t){if(typeof t!="undefined"&&t!=null){var i=jq(n),r=0;i.find("input[type=checkbox]").each(function(n,i){var u=jq(i);u.attr("locked")?u.prop("checked",!1).prop("disabled",!0):u.attr("user-isvisitor")=="true"?u.prop("checked",!0).prop("disabled",!1):t>0&&r<t?(u.prop("checked",!0).prop("disabled",!1),r++):u.prop("checked",!1).prop("disabled",!0)});i.on("click","input[type=checkbox]",function(){sr(this,n,t)})}},sr=function(n,t,i){var r=jq(n),e=jq(t),u=e.find("input[type=checkbox]"),o=r.attr("user-isvisitor")=="true",f;if(!o)if(r.is(":checked")){if(f=u.filter(function(){var n=jq(this);return n.is(":checked")&&n.attr("user-isvisitor")!="true"}).length,f>i){r.prop("checked",!1);return}f==i&&u.each(function(n,t){var i=jq(t);i.is(":checked")||i.attr("user-isvisitor")=="true"||i.prop("disabled",!0)})}else u.each(function(n,t){var i=jq(t);i.attr("locked")?i.prop("checked",!1).prop("disabled",!0):i.prop("disabled",!1)})},hr=function(){var n=jq("#changeStatusDialog"),r=jq("#changeStatusDialog .user-list-for-group-operation"),i=y(r),u={userIds:i};if(i.length==0)return jq.unblockUI(),!1;Teamlab.updateUserStatus({},o,u,{success:function(i,r){var u=h(r);ut(i,u);t(n);jq.unblockUI();c();toastr.success(ASC.People.Resources.PeopleJSResource.SuccessChangeUserStatus);k()},error:function(i,r){t(n);w(n,r)},after:function(){t(n)},before:function(){p(n)}})},cr=function(){jq("#changeTypePanel, #changeStatusPanel, #otherFunctionCnt").hide();lr();StudioBlockUIManager.blockUI("#resendInviteDialog",500);PopupKeyUpActionProvider.ClearActions();PopupKeyUpActionProvider.EnterAction="jq(\"#resendInviteDialog .button.blue\").trigger('click');"},lr=function(){var n=jq("#resendInviteDialog"),i=jq("#resendInviteDialog .user-list-for-group-operation"),r=ar();t(n);b(n);a(r,i)},ar=function(){for(var t,i=jq.extend(!0,[],n),r=0,u=i.length;r<u;r++)t=i[r],(t.isActivated||t.isTerminated||t.isLDAP||t.isSSO)&&(t.locked=!0);return i},vr=function(){var n=jq("#resendInviteDialog"),r=jq("#resendInviteDialog .user-list-for-group-operation"),i=y(r),u={userIds:i};if(i.length==0)return jq.unblockUI(),!1;Teamlab.sendInvite({},u,{success:function(){t(n);jq.unblockUI();toastr.success(ASC.People.Resources.PeopleJSResource.SuccessSendInvitation)},error:function(i,r){t(n);w(n,r)},after:function(){t(n)},before:function(){p(n)}})},yr=function(){jq("#changeTypePanel, #changeStatusPanel, #otherFunctionCnt").hide();pr();StudioBlockUIManager.blockUI("#deleteUsersDialog",500);PopupKeyUpActionProvider.ClearActions();PopupKeyUpActionProvider.EnterAction="jq(\"#deleteUsersDialog .button.blue\").trigger('click');"},pr=function(){var n=jq("#deleteUsersDialog"),i=jq("#deleteUsersDialog .user-list-for-group-operation"),r=wr();t(n);b(n);a(r,i)},wr=function(){for(var t,i=jq.extend(!0,[],n),r=0,u=i.length;r<u;r++)t=i[r],(!t.isTerminated||t.isLDAP)&&(t.locked=!0);return i},br=function(){var n=jq("#deleteUsersDialog"),r=jq("#deleteUsersDialog .user-list-for-group-operation"),i=y(r),u={userIds:i};if(i.length==0)return jq.unblockUI(),!1;Teamlab.removeUsers({},u,{success:function(){t(n);jq.unblockUI();window.location.reload(!0)},error:function(i,r){t(n);w(n,r)},after:function(){t(n)},before:function(){p(n)}})},kr=function(){var i,r,t,u;for(jq("#changeTypePanel, #changeStatusPanel, #otherFunctionCnt").hide(),i=jq.extend(!0,[],n),r=[],t=0,u=i.length;t<u;t++)r.push(i[t].email);window.open("../../addons/mail/#composeto/email="+r.join(),"_blank")},ut=function(t,i){for(var r,s,f,c,e,l,o=0,h=i.length;o<h;o++){for(r=i[o],r.isChecked=!0,s=jq.tmpl("userListTemplate",{users:[r],isAdmin:Teamlab.profile.isAdmin||window.ASC.Resources.Master.IsProductAdmin,isRetina:g}),jq("#user_"+r.id).replaceWith(s),f=0,c=u.length;f<c;f++)r.id==u[f].id&&(u[f]=r);for(e=0,l=n.length;e<l;e++)r.id==n[e].id&&(n[e]=r);et(jq(s))}},a=function(n,t){var i=jq(t);i.html("");i.off("click","input[type=checkbox]");jq(n).each(function(n,t){var f=jq("<div/>"),u=jq("<label/>"),r=jq("<input/>");r.attr("type","checkbox");r.attr("user-id",t.id);r.attr("user-isVisitor",t.isVisitor);t.locked?(r.attr("locked",t.id).prop("checked",!1).prop("disabled",!0),u.addClass("gray-text")):r.prop("checked",!0).prop("disabled",!1);u.html(t.displayName);r.prependTo(u);u.appendTo(f);f.appendTo(i)})},v=function(n){var t=jq(n).parents("div.containerBodyBlock:first"),r=t.find("a.showBtn"),u=t.find("a.hideBtn"),i=t.find("div.user-list-for-group-operation");i.hasClass("display-none")?(r.addClass("display-none"),u.removeClass("display-none"),i.removeClass("display-none")):(r.removeClass("display-none"),u.addClass("display-none"),i.addClass("display-none"))},y=function(n){var i=jq(n).find("input[type=checkbox]:checked"),t=[];return i.each(function(n,i){var r=jq(i).attr("user-id").trim();t.push(r)}),t},p=function(n){LoadingBanner.showLoaderBtn(n);jq(n).find("input[type=checkbox]").prop("disabled",!0)},t=function(n){LoadingBanner.hideLoaderBtn(n);jq(n).find("input[type=checkbox]").each(function(){jq(this).attr("locked")||jq(this).prop("disabled",!1)})},w=function(n,t){jq(n).find(".error-popup").html(t).removeClass("display-none")},b=function(n){jq(n).find(".error-popup").html("").addClass("display-none")},dr=function(){var n=[];(Teamlab.profile.isAdmin||window.ASC.Resources.Master.IsProductAdmin)&&n.push({type:"combobox",id:"selected-employee-status-active",title:ASC.People.Resources.PeopleJSResource.LblActive,filtertitle:ASC.People.Resources.PeopleJSResource.LblStatus,group:ASC.People.Resources.PeopleJSResource.LblStatus,groupby:"selected-employee-status-value",options:[{value:"active",classname:"active",title:ASC.People.Resources.PeopleJSResource.LblActive,def:!0},{value:"disabled",classname:"disabled",title:ASC.People.Resources.PeopleJSResource.LblTerminated}],hashmask:"type/{0}"},{type:"combobox",id:"selected-employee-status-disabled",title:ASC.People.Resources.PeopleJSResource.LblTerminated,filtertitle:ASC.People.Resources.PeopleJSResource.LblStatus,group:ASC.People.Resources.PeopleJSResource.LblStatus,groupby:"selected-employee-status-value",options:[{value:"active",classname:"active",title:ASC.People.Resources.PeopleJSResource.LblActive},{value:"disabled",classname:"disabled",title:ASC.People.Resources.PeopleJSResource.LblTerminated,def:!0}],hashmask:"type/{0}"});n.push({type:"combobox",id:"selected-activation-status-active",title:ASC.People.Resources.PeopleJSResource.LblActive,filtertitle:ASC.People.Resources.PeopleResource.Email,group:ASC.People.Resources.PeopleResource.Email,groupby:"selected-activation-status-value",options:[{value:"active",classname:"active",title:ASC.People.Resources.PeopleJSResource.LblActive,def:!0},{value:"pending",classname:"pending",title:ASC.People.Resources.PeopleJSResource.LblPending}],hashmask:"type/{0}"},{type:"combobox",id:"selected-activation-status-pending",title:ASC.People.Resources.PeopleJSResource.LblPending,filtertitle:ASC.People.Resources.PeopleResource.Email,group:ASC.People.Resources.PeopleResource.Email,groupby:"selected-activation-status-value",options:[{value:"active",classname:"active",title:ASC.People.Resources.PeopleJSResource.LblActive},{value:"pending",classname:"pending",title:ASC.People.Resources.PeopleJSResource.LblPending,def:!0}],hashmask:"type/{0}"},{type:"combobox",id:"selected-type-admin",title:ASC.Resources.Master.Admin,filtertitle:ASC.People.Resources.PeopleJSResource.LblByType,group:ASC.People.Resources.PeopleJSResource.LblByType,groupby:"selected-profile-type-value",options:[{value:"admin",classname:"admin",title:ASC.Resources.Master.Admin,def:!0},{value:"user",classname:"user",title:ASC.Resources.Master.User},{value:"visitor",classname:"visitor",title:ASC.Resources.Master.Guest}],hashmask:"type/{0}"},{type:"combobox",id:"selected-type-user",title:ASC.Resources.Master.User,filtertitle:ASC.People.Resources.PeopleJSResource.LblByType,group:ASC.People.Resources.PeopleJSResource.LblByType,groupby:"selected-profile-type-value",options:[{value:"admin",classname:"admin",title:ASC.Resources.Master.Admin},{value:"user",classname:"user",title:ASC.Resources.Master.User,def:!0},{value:"visitor",classname:"visitor",title:ASC.Resources.Master.Guest}],hashmask:"type/{0}"},{type:"combobox",id:"selected-type-visitor",title:ASC.Resources.Master.Guest,filtertitle:ASC.People.Resources.PeopleJSResource.LblByType,group:ASC.People.Resources.PeopleJSResource.LblByType,groupby:"selected-profile-type-value",options:[{value:"admin",classname:"admin",title:ASC.Resources.Master.Admin},{value:"user",classname:"user",title:ASC.Resources.Master.User},{value:"visitor",classname:"visitor",title:ASC.Resources.Master.Guest,def:!0}],hashmask:"type/{0}"},{type:"group",id:"selected-group",title:ASC.Resources.Master.Department,group:ASC.People.Resources.PeopleJSResource.LblOther,hashmask:"group/{0}"});ASC.People.PeopleController.advansedFilter=jq("#peopleFilter").advansedFilter({maxfilters:-1,anykey:!1,store:!1,hintDefaultDisable:!0,sorters:[{id:"firstname",title:ASC.Resources.Master.ResourceJS.FirstName,dsc:!1,def:ASC.People.Data.userDisplayFormat==1},{id:"lastname",title:ASC.Resources.Master.ResourceJS.LastName,dsc:!1,def:ASC.People.Data.userDisplayFormat==2}],filters:n}).on("setfilter",ASC.People.PeopleController.setFilter).on("resetfilter",ASC.People.PeopleController.resetFilter).on("resetallfilters",ASC.People.PeopleController.resetAllFilters);PeopleManager.SelectedCount=ASC.People.Resources.PeopleJSResource.SelectedCount;PeopleManager.UserLimit=ASC.People.Resources.PeopleJSResource.TariffActiveUserLimit;PeopleManager.GuestLimit=ASC.People.Resources.PeopleJSResource.TariffGuestLimit;PeopleManager.UserLimitExcludingGuests=ASC.People.Resources.PeopleJSResource.TariffActiveUserLimitExcludingGuests},k=function(){Teamlab.getQuotas({},{success:function(n,t){e=t},error:function(){}})},gr=function(){ScrolledGroupMenu.init({menuSelector:"#peopleHeaderMenu",menuAnchorSelector:"#mainSelectAll",menuSpacerSelector:".people-content .header-menu-spacer",userFuncInTop:function(){jq("#peopleHeaderMenu .menu-action-on-top").hide()},userFuncNotInTop:function(){jq("#peopleHeaderMenu .menu-action-on-top").show()}})},nu=function(){jq.dropdownToggle({dropdownID:"changeTypePanel",switcherSelector:"#peopleHeaderMenu .menuChangeType.unlockAction",addTop:4,addLeft:0});jq.dropdownToggle({dropdownID:"changeStatusPanel",switcherSelector:"#peopleHeaderMenu .menuChangeStatus.unlockAction",addTop:4,addLeft:0});jq("#peopleHeaderMenu").on("click",".menuSendInvite.unlockAction",function(){return cr(),!1});jq("#peopleHeaderMenu").on("click",".menuRemoveUsers.unlockAction",function(){return yr(),!1});jq("#peopleHeaderMenu").on("click",".menuWriteLetter.unlockAction",function(){return kr(),!1});jq("#peopleHeaderMenu").on("click","#mainDeselectAll",function(){return l(),!1});jq("#peopleHeaderMenu").on("click",".on-top-link",function(){return window.scrollTo(0,0),!1});jq("#changeTypePanel").on("click","a.dropdown-item:not(.disable)",function(){return gi(this),!1});jq("#changeStatusPanel").on("click","a.dropdown-item:not(.disable)",function(){return ur(this),!1});jq("#changeTypeDialog").on("click","a.showBtn, a.hideBtn",function(){return v(this),!1});jq("#changeTypeDialog").on("click",".changeTypeDialogOk:not(.disable)",function(){return rr(),!1});jq("#changeTypeDialog").on("click",".changeTypeDialogCancel:not(.disable)",function(){return jq.unblockUI(),!1});jq("#changeStatusDialog").on("click","a.showBtn, a.hideBtn",function(){return v(this),!1});jq("#changeStatusDialog").on("click","#changeStatusOkBtn:not(.disable)",function(){return hr(),!1});jq("#changeStatusDialog").on("click","#changeStatusCancelBtn:not(.disable)",function(){return jq.unblockUI(),!1});jq("#resendInviteDialog").on("click","a.showBtn, a.hideBtn",function(){return v(this),!1});jq("#resendInviteDialog").on("click","a.button.blue:not(.disable)",function(){return vr(),!1});jq("#resendInviteDialog").on("click","a.button.gray:not(.disable)",function(){return jq.unblockUI(),!1});jq("#deleteUsersDialog").on("click","a.showBtn, a.hideBtn",function(){return v(this),!1});jq("#deleteUsersDialog").on("click","a.button.blue:not(.disable)",function(){return br(),!1});jq("#deleteUsersDialog").on("click","a.button.gray:not(.disable)",function(){return jq.unblockUI(),!1});jq("#tableForPeopleNavigation").on("change","select",function(){yi(this.value)});jq("body").off("contextmenu").on("contextmenu",function(n){var t=jq.fixEvent(n),r,i,u,f;return typeof t=="undefined"||!t?!0:(r=jq(t.srcElement||t.target),i=jq("#peopleActionMenu"),!r.parents("#peopleData").length)?(i.hide(),!0):(u=r.closest("tr.with-entity-menu"),u.length)?(f=u.attr("id").split("_")[1],st(f),jq("#peopleData .entity-menu.active").removeClass("active"),i.show(),i.hide(),jq.showDropDownByContext(t,r,i),!1):!0});jq.dropdownToggle({dropdownID:"otherFunctionCnt",switcherSelector:"#peopleHeaderMenu .otherFunctions",position:"fixed",addTop:4,addLeft:0,rightPos:!0})};return{init:si,setFilter:hi,resetFilter:ci,moveToPage:vi,resetAllFilters:ai,getEditGroup:ui,deleteGroup:li,selectAll:wi,selectRow:bi,selectCheckbox:ki}}();jq(document).ready(function(){var n=jq("#peopleData");if(n.length){ASC.People.PeopleController.init();n.on("click",".check-list",ASC.People.PeopleController.selectRow);n.on("click",".checkbox-user",ASC.People.PeopleController.selectCheckbox)}});
jQuery.extend({getAnchorParam:function(n,t){var t=t||window.location.href.toLowerCase(),r=new RegExp("[#&]"+n+"=([^&]*)"),i=r.exec("#"+t);return i==null?"":i[1]},hasParam:function(n,t){var i=new RegExp("(\\#|&|^)"+n+"=","g");return i.test(t)},removeParam:function(n,t){if(t==="")return"";var i=new RegExp("(\\#|&|^)"+n+"=([^&]*)");return t.replace(i,"")},addParam:function(n,t,i){return n.length&&(n+="&"),n+t+"="+i},changeParamValue:function(n,t,i){var u=["\\#","&","^"],r,f,e;if(jq.hasParam(t,n)){for(r=0;r<u.length;r++)f=new RegExp(u[r]+t+"[=][0-9a-z-]*"),e=u[r]=="^"?"":u[r],n=n.replace(f,e+t+"="+i);return n}return jq.addParam(n,t,i)},clearUrl:function(){var n=window.location.href;return n.indexOf("#")==-1?n:n.split("#")[0]},mergeAnchors:function(n,t){var r={};for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);for(i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r},anchorToObject:function(n){var i,t,r;for(n=n.charAt(0)==="#"?n.substring(1):n,i={},n=n.split("&"),t=0,r=n.length;t<r;t++)n[t]=n[t].split("="),n[t].length===2&&(i[n[t][0]]=n[t][1]);return i},objectToAnchor:function(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push(t+"="+n[t]);return i.join("&")},isEqualAnchors:function(n,t){for(var i in n)if(n.hasOwnProperty(i)&&!t.hasOwnProperty(i)||n[i]!==t[i])return!1;for(i in t)if(t.hasOwnProperty(i)&&!n.hasOwnProperty(i)||t[i]!==n[i])return!1;return!0}});String.prototype.htmlEncode=function(){return jQuery(document.createElement("div")).text(this.toString()).html()};typeof ASC=="undefined"&&(ASC={});ASC.People=ASC.People||{};ASC.People.model=ASC.People.model||{};ASC.People.eventSource={document:"document",filter:"filter",anchor:"anchor",navigator:"navigator"};ASC.People.model.groups=ASC.People.model.groups||[];ASC.People.model.profiles=ASC.People.model.profiles||[];ASC.People.eventHandler={create:function(n,t){return t.prototype={source:n,handle:function(n,t){this.source&&this.source===t.source||typeof this[n]=="function"&&this[n](t)}},new t}};ASC.People.controller={registryHandler:function(n){this.subscribers[this.subscribers.length]=n},publish:function(n,t,i){for(var r=0,u=this.subscribers.length;r<u;r++)typeof this.subscribers[r].handle=="function"&&this.subscribers[r].handle(t,i)},make:function(n,t){var i,r;for(i in this)n.prototype[i]=this[i];if(n.prototype.subscribers=[],typeof t=="object"&&typeof t.length!="undefined")for(i=0,r=t.length;i<r;i++)n.prototype.subscribers.push(t[i]);else typeof views=="object"&&n.prototype.subscribers.push(t);return new n}};
var DepartmentManagement=new function(){this._groupId=null;this._deleteGroup="";this.isInitHeadSelector=!1;this.isInitMembersSelector=!1;this.initDepartmentDialog=function(){var t=jq("#headAdvancedSelector"),n=jq("#membersAdvancedSelector"),i;if(DepartmentManagement.isInitMembersSelector)n.useradvancedSelector("reset");else{i=jq("#departmentManager .result-name").attr("data-id");DepartmentManagement.isInitMembersSelector=!0;n.useradvancedSelector({itemsDisabledIds:i.length?[i]:[],canadd:!0,showGroups:!0,inPopup:!0}).on("showList",function(n,t){var r=jq.tmpl("template-selector-selected-items",{Items:t}),i;jq("#membersDepartmentList").html(r);i=[];t.forEach(function(n){i.push(n.id)})});jq("#membersDepartmentList").on("click","li .reset-icon:not(.disabled)",function(){var i=jq(this),t=i.parents("li");n.useradvancedSelector("unselect",[t.attr("data-id")]);t.remove()})}if(DepartmentManagement.isInitHeadSelector)t.useradvancedSelector("reset");else{DepartmentManagement.isInitHeadSelector=!0;t.useradvancedSelector({canadd:!0,showGroups:!0,onechosen:!0,inPopup:!0,withGuests:!1}).on("showList",function(t,i){var r=jq("#departmentManager"),u=r.find(".result-name").attr("data-id");n.useradvancedSelector("undisable",u.length?[u]:[]);n.useradvancedSelector("disable",[i.id]);jq("#membersDepartmentList li[data-id="+i.id+"]").remove();r.find(".result-name").attr("data-id",i.id).html(i.title);r.removeClass("display-none");jq(this).hide()});jq("#departmentManager").find(".reset-icon").on("click",function(){jq(this).hasClass("disabled")||(n.useradvancedSelector("undisable",[jq("#departmentManager .result-name").attr("data-id")]),jq("#departmentManager").addClass("display-none"),jq("#departmentManager .result-name").attr("data-id","").text(""),t.show())})}};this.AddDepartmentOpenDialog=function(){HideRequiredError();DepartmentManagement.initDepartmentDialog();StudioBlockUIManager.blockUI("#studio_departmentAddDialog",400);jq("#studio_departmentAddDialog .infoPanel").hide();jq("#studio_newDepName").val("");jq("#headAdvancedSelector").show();jq("#departmentManager").addClass("display-none");jq("#departmentManager .result-name").text("");jq("#membersDepartmentList li").remove();jq("#membersAdvancedSelector").useradvancedSelector("reset");this._groupId=null;jq("#studio_departmentAddDialog .grouptitle").html(ASC.Resources.Master.AddDepartmentHeader);jq("#studio_departmentAddDialog .middle-button-container a.blue").html(ASC.Resources.Master.ResourceJS.AddButton);PopupKeyUpActionProvider.ClearActions();PopupKeyUpActionProvider.EnterAction="DepartmentManagement.AddDepartmentCallback()"};this.EditDepartmentOpenDialog=function(n){var c=n.id,l=n.name,t=n.manager,s=n.members,i,r,u,f,e,o,h;HideRequiredError();DepartmentManagement.initDepartmentDialog();StudioBlockUIManager.blockUI("#studio_departmentAddDialog",400);jq("#studio_departmentAddDialog .infoPanel").hide();PopupKeyUpActionProvider.ClearActions();PopupKeyUpActionProvider.EnterAction="DepartmentManagement.AddDepartmentCallback()";this._groupId=c;jq("#studio_departmentAddDialog .grouptitle").html(ASC.Resources.Master.EditDepartmentHeader);jq("#studio_departmentAddDialog .middle-button-container .blue").html(ASC.Resources.Master.ResourceJS.EditButton);jq("#studio_newDepName").val(l);i=jq("#headAdvancedSelector");r=jq("#membersAdvancedSelector");t&&t.id&&t.id!=="4a515a15-d4d6-4b8e-828e-e0586f18f3a3"&&(u=jq("#departmentManager"),u.find(".result-name").attr("data-id",t.id).html(t.displayName),u.removeClass("display-none"),i.hide(),i.useradvancedSelector("select",[t.id]),r.useradvancedSelector("disable",[t.id]));f=jq(".members-dep-list");jq("#membersDepartmentList").html("");f.append('<div class="loading-link">'+ASC.Resources.Master.ResourceJS.LoadingPleaseWait+"<\/div>");s.length&&(e=[],o=[],s.forEach(function(n){e.push(n.id);n.id!==t.id&&o.push({id:n.id,title:n.displayName})}),r.useradvancedSelector("select",e),h=jq.tmpl("template-selector-selected-items",{Items:o.sort(SortData)}),jq("#membersDepartmentList").html(h));f.find(".loading-link").remove()};this.AddDepartmentCallback=function(){var n,t,i,r;if(!jq("#headAdvancedSelector + .advanced-selector-container").is(":visible")&&!jq("#membersAdvancedSelector + .advanced-selector-container").is(":visible")){if(n=jq("#studio_newDepName"),jq(n).val().trim()===""){ShowRequiredError(n);return}t=jq("#departmentManager .result-name").attr("data-id");i=[];jq("#membersDepartmentList li").each(function(n,t){i.push(jq(t).attr("data-id"))});r={groupManager:t.length?t:"00000000-0000-0000-0000-000000000000",groupName:n.val(),groupId:DepartmentManagement._groupId,members:i};DepartmentManagement.LockDepartmentDialog();DepartmentManagement._groupId==null?Teamlab.addGroup(null,r,{success:function(){DepartmentManagement.CloseAddDepartmentDialog();window.onbeforeunload=null;window.location.reload(!0)},error:function(n,t){DepartmentManagement.UnlockDepartmentDialog();jq("#studio_departmentAddDialog .infoPanel").html("<div>"+t+"<\/div>");jq("#studio_departmentAddDialog .infoPanel").show()}}):Teamlab.updateGroup(null,DepartmentManagement._groupId,r,{success:function(){DepartmentManagement.CloseAddDepartmentDialog();window.location.reload(!0)},error:function(n,t){DepartmentManagement.UnlockDepartmentDialog();jq("#studio_departmentAddDialog .infoPanel").html("<div>"+t+"<\/div>");jq("#studio_departmentAddDialog .infoPanel").show()}})}};this.CloseAddDepartmentDialog=function(){PopupKeyUpActionProvider.ClearActions();jq.unblockUI()};this.LockDepartmentDialog=function(){jq("#headAdvancedSelector, #membersAdvancedSelector, #departmentManager .reset-icon, #membersDepartmentList .reset-icon").addClass("disabled");LoadingBanner.showLoaderBtn("#studio_departmentAddDialog")};this.UnlockDepartmentDialog=function(){jq("#headAdvancedSelector, #membersAdvancedSelector, #departmentManager .reset-icon , #membersDepartmentList .reset-icon").removeClass("disabled");LoadingBanner.hideLoaderBtn("#studio_departmentAddDialog")}};jq(document).ready(function(){jq.tmpl("template-blockUIPanel",{id:"studio_departmentAddDialog",headerTest:ASC.People.Resources.AddDepartmentDlgTitle,headerClass:"grouptitle"}).insertAfter("#peopleSidepanel");jq.tmpl("depAddPopupBodyTemplate",null).appendTo("#studio_departmentAddDialog .containerBodyBlock");jq("#depActionBtn").on("click",".button.blue",function(){DepartmentManagement.AddDepartmentCallback()});jq("#depActionBtn").on("click",".button.gray",function(){DepartmentManagement.CloseAddDepartmentDialog()})});
window.peopleActions=function(){var n=function(n,t,i){if((" "+n+" ").indexOf(" disabled ")!==-1)return undefined;for(var r="",f=0,u=typeof n=="string"?n.split(/\s+/):[],f=u?u.length:0;f--;)r=u[f].replace(/-/g,"_"),typeof peopleActions[r]=="function"&&peopleActions[r].apply(t,i)},i=function(n){var t=jq.tmpl("userListTemplate",{users:[n.Data],isAdmin:Teamlab.profile.isAdmin||window.ASC.Resources.Master.IsProductAdmin});jq("#peopleData tr.profile").length==0&&(jq("#emptyContentForPeopleFilter").addClass("display-none"),jq(".people-content").removeClass("display-none"));jq("#peopleData").prepend(t);ASC.Controls.AnchorController.trigger()};return{callMethodByClassname:n,add_group:function(){DepartmentManagement.AddDepartmentOpenDialog()},update_group:function(){ASC.People.PeopleController.getEditGroup()},delete_group:function(){jq("#confirmationDeleteDepartmentPanel .confirmationAction").html(jq.format(ASC.Resources.Master.ConfirmRemoveDepartment,"<b>"+jq(".profile-title:first>.header").html()+"<\/b>"));jq("#confirmationDeleteDepartmentPanel .middle-button-container>.button.blue.middle").off("click").on("click",function(){ASC.People.PeopleController.deleteGroup()});StudioBlockUIManager.blockUI("#confirmationDeleteDepartmentPanel",500);PopupKeyUpActionProvider.ClearActions();PopupKeyUpActionProvider.EnterAction="ASC.People.PeopleController.deleteGroup();"},add_profiles:function(){location.href="/Products/People/Import.aspx"},send_invites:function(){InvitesResender.Show()},send_email:function(n,t){var r=t.parents("tr.item.profile:first").attr("data-id"),i;r&&(i=t.parents("tr.item.profile:first").attr("data-email"),i&&window.open("../../addons/mail/#composeto/email="+i,"_blank"))},open_dialog:function(n,t){var r=t.parents("tr.item.profile:first").attr("data-id"),i;if(r&&(i=t.parents("tr.item.profile:first").attr("data-username"),i))try{ASC.Controls.JabberClient.open(i)}catch(u){}},invite_link:function(){PopupKeyUpActionProvider.ClearActions();jq("#otherActions").hide();StudioBlockUIManager.blockUI("#inviteLinkContainer",550);ASC.InvitePanel.bindClipboardEvent()}}}();
typeof ASC=="undefined"&&(ASC={});typeof ASC.People=="undefined"&&(ASC.People=function(){return{}}());ASC.People.Reassigns=function(){function i(n,t,i,r){n.html(jq.tmpl("reassignStatus",{statusClass:t,statusMessage:i,errorMessage:r}))}function a(t,u){var f=t.attr("data-step");if(u.status==r.queued){i(t,"queued",ASC.People.Resources.PeopleResource.ReassignStatusQueued,null);return}f<u.percentage?i(t,"finished",n?ASC.People.Resources.PeopleResource.RemovingStatusFinished:ASC.People.Resources.PeopleResource.ReassignStatusFinished,null):f==u.percentage?u.status==r.failed?i(t,"error",n?ASC.People.Resources.PeopleResource.RemovingStatusAborted:ASC.People.Resources.PeopleResource.ReassignStatusAborted,u.error):i(t,"started",ASC.People.Resources.PeopleResource.ReassignStatusStarted,null):i(t,"notstarted",n?ASC.People.Resources.PeopleResource.RemovingStatusNotStarted:ASC.People.Resources.PeopleResource.ReassignStatusNotStarted,null)}function c(n,i){var r,u;n&&(t=n,r=window.UserManager.getUser(t),jq(".from-user-link").attr("href",r.profileUrl).html(r.displayName));i&&(f=i,u=window.UserManager.getUser(f),jq(".to-user-link").attr("href",u.profileUrl).html(u.displayName))}function v(){var r=jq("#userSelector");if(r.length){r.useradvancedSelector({itemsChoose:[],itemsDisabledIds:[],canadd:!1,isAdmin:!1,showGroups:!0,withGuests:!1,onechosen:!0});r.on("showList",function(n,t){jq(this).html(t.title);f=t.id;jq(".start-btn").removeClass("disable")})}jq(".start-btn").on("click",function(){var i,r;jq(this).hasClass("disable")||(e=!1,i={before:LoadingBanner.displayLoading,after:LoadingBanner.hideLoading,success:function(n,t){c(t.fromUser,t.toUser);u(!1);s(t)},error:function(n,t){toastr.error(t[0])}},n?Teamlab.startRemove({},t,i):(r=jq(".delete-profile-container input[type=checkbox]").is(":checked"),Teamlab.startReassign({},t,f,r,i)))});jq(".abort-btn").on("click",function(){e=!0;var r={before:LoadingBanner.displayLoading,after:LoadingBanner.hideLoading,success:function(){var t=jq(".progress-container .progress-block .started"),r=t.length?t.parent():jq(".progress-container .progress-block .progress-desc:first");i(r,"aborted",n?ASC.People.Resources.PeopleResource.RemovingStatusAborted:ASC.People.Resources.PeopleResource.ReassignStatusAborted,null);toastr.warning(n?ASC.People.Resources.PeopleResource.RemovingAbortToastrMsg:ASC.People.Resources.PeopleResource.ReassignAbortToastrMsg);o(!1,!0,!1)},error:function(n,t){toastr.error(t[0])}};n?Teamlab.terminateRemove({},t,r):Teamlab.terminateReassign({},t,r)});jq(".restart-btn").on("click",function(){u(!0)})}function u(n){n?(jq(".action-container").removeClass("display-none"),jq(".progress-container").addClass("display-none")):(jq(".action-container").addClass("display-none"),jq(".progress-container").removeClass("display-none"))}function o(n,t,i){n?jq(".abort-btn").removeClass("display-none"):jq(".abort-btn").addClass("display-none");t?jq(".restart-btn").removeClass("display-none"):jq(".restart-btn").addClass("display-none");i?jq(".ok-btn").removeClass("display-none"):jq(".ok-btn").addClass("display-none")}function s(t){jq(".progress-block .progress-row .progress-desc").each(function(n,i){a(jq(i),t)});t.status==r.failed&&toastr.error(n?ASC.People.Resources.PeopleResource.RemovingErrorToastrMsg:ASC.People.Resources.PeopleResource.ReassignErrorToastrMsg);t.isCompleted?o(!1,t.status==r.failed,t.status==r.done):(o(!0,!1,!1),setTimeout(p,l))}function y(){var i={before:LoadingBanner.displayLoading,after:LoadingBanner.hideLoading,success:function(n,t){t&&t.hasOwnProperty("isCompleted")?(c(t.fromUser,t.toUser),u(!1),s(t)):u(!0)},error:function(n,t){u(!0);toastr.error(t[0])}};n?Teamlab.getRemoveProgress({},t,i):Teamlab.getReassignProgress({},t,i)}function p(){if(!e){var i={success:function(n,t){s(t)},error:function(n,t){toastr.error(t[0])}};n?Teamlab.getRemoveProgress({},t,i):Teamlab.getReassignProgress({},t,i)}}function w(i,r){i&&!h&&(t=i,n=r,v(),y(),h=!0)}var h=!1,n=!1,e=!1,t=null,f=null,l=3e3,r={queued:0,started:1,done:2,failed:3};return{init:w}}();
(function(n){function t(n){var t=jq(this);peopleActions.callMethodByClassname(t.attr("class"),this,[n,t]);jq(document.body).trigger("click")}function u(t,i){var u=n("#peopleSidepanel"),o=ASC.People.Resources.PeopleJSResource.People,e;i=i||"@persons";jq(".profile-title .menu-small").hide();jq(".profile-title .header").html(o);jq(".profile-title .header").attr("title",o);switch(i){case"@persons":document.title=r;u.find("li.menu-sub-item.active").removeClass("active");u.find("li.menu-item").removeClass("active").filter('li[data-id="'+i+'"]:first').addClass("active open");break;case"@clients":break;case"@freelancers":break;default:u.find("li.menu-item.active").removeClass("active");u.find("li.menu-sub-item").removeClass("active").filter('li[data-id="'+i+'"]:first').addClass("active");e=jq(".menu-sub-list li.active a").html();jq(".profile-title .header").html(e).attr("title",e);document.title=f(e)+" - "+o;jq(".profile-title .menu-small").show();jq.dropdownToggle({dropdownID:"actionGroupMenu",switcherSelector:".profile-title .menu-small",addTop:0,addLeft:-11,showFunction:function(n,t){t.is(":hidden")?n.addClass("active"):n.removeClass("active")},hideFunction:function(){jq(".profile-title .menu-small.active").removeClass("active")}})}}function f(t){return n("<div/>").html(t).text()}function e(){jq("#studio_sidePanel").find("a.dropdown-item:not(.invite-link)").on("click",t);jq("#actionGroupMenu").find("a.dropdown-item").on("click",t);o()}function o(){if(ASC.Clipboard.enable)jq(window).one("onOpenSideNavOtherActions",function(){window.sideNavInviteLinkClip=ASC.Clipboard.destroy(window.sideNavInviteLinkClip);var n=jq("#shareInviteUserLink").val();sideNavInviteLinkClip=ASC.Clipboard.create(n,"sideNavInviteLink",{onComplete:function(){window.peopleActions.invite_link();typeof toastr!="undefined"?toastr.success(ASC.Resources.Master.ResourceJS.LinkCopySuccess):jq("#shareInviteUserLink, #sideNavInviteLink").yellowFade()}})});else jq("#sideNavInviteLink").on("click",function(){window.peopleActions.invite_link()})}function s(){var n=jq.tmpl("groupListTemplate",{groups:window.GroupManager.getGroupsArray()});jq("#groupList").empty().append(n);n.length&&jq("#groupListContainer .menu-item:first").toggleClass("none-sub-list sub-list")}function h(){jq(window).on("change-group",u)}function i(n){var i=ASC.Controls.AnchorController.getAnchor(),t;if(!i){location.hash="";return}if(t=jq.anchorToObject(i),t==null){location.hash="";return}n?t.group=n:delete t.group;i=jq.objectToAnchor(t);location.hash=i}function c(){var n="/Products/People/",t=jq("#peopleFilter").length;if(jq("#groupList .menu-item-label").each(function(r,u){var f=jq(u).parents(".menu-sub-item").attr("data-id");if(t)jq(u).on("click",function(){i(f)});else jq(u).attr("href",n+"#employeestatus=active&group="+f)}),t)jq("#defaultLinkPeople").on("click",function(){i(null)});else jq("#defaultLinkPeople").attr("href",n+"#employeestatus=active");jq(".people-import-banner_img").on("click",function(){location.href=n+"Import.aspx"})}var r=document.title;n(function(){e();s();h();c()})})(jQuery);

