jQuery.template("projects_projectTmpl",'<tr {{if status !== 0}} class="noActiveProj" {{/if}} id="${id}">{{if !isSimpleView}}<td class="checkbox"><input type="checkbox"/><\/td><td class="status">{{tmpl({canEdit: $item.data.canEdit, status: ASC.Projects.StatusList.getById($item.data.status)}) \'projects_statusChangeContainer\'}}<\/td>{{/if}}<td class="nameProject stretch">{{if isPrivate}}<span title="${ASC.Projects.Resources.ProjectResource.HiddenProject}" class="private"><\/span>{{/if}}<a href="${projLink}" class="linkHeaderMedium {{if status !== 0}} gray-text{{/if}}">${title}<\/a><\/td><td class="taskCount">{{if taskCount != 0}}<a href="${linkTasks}" title="${ASC.Projects.Resources.ProjectResource.TitleProjectOpenTasks}">${taskCount}<\/a>{{/if}}<\/td><td class="responsible"><span class=\'userLink{{if responsible.id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\' || (responsible.isTerminated && !Teamlab.profile.isAdmin)}} not-action{{/if}}\' title="{{if !isSimpleView}}${ASC.Projects.Resources.ProjectResource.TitleProjectManager}{{/if}}">${responsible.displayName}<\/span>{{if participants != 0}}<a class="participants" title="${ASC.Projects.Resources.ProjectResource.TitleProjectTeam}" href="${linkParticip}">+${participants}<\/a>{{/if}}<\/td>{{if isSimpleView}}<td class="trash">{{if canEdit || canLinkContact}}<img src="${StudioManager.GetImage(\'unlink_16.png\')}"                    title="${ASC.Projects.Resources.ProjectsCommonResource.UnlinkProjects}" class="trash_delete" /><div class="trash_progress loader-middle" title=""><\/div>{{/if}}<\/td>{{/if}}<\/tr>');jQuery.template("memberTemplate",'<table class="listContainer"><tbody>{{each team}}<tr class="with-entity-menu pm-projectTeam-participantContainer {{if isProjectAdmin || isAdmin || isManager}} disable{{/if}}" data-partisipantId="${id}"><td style="" class="user-info"><div class="pm-projectTeam-userPhotoContainer {{if $data.isRetina}}retina{{/if}}"><img src="{{if $data.isRetina}}${avatar}{{else}}${avatarSmall}{{/if}}"/>{{if status == 2}}<span class="status-blocked"><\/span>{{/if}}                    {{if project.canEditTeam}}                    {{if isVisitor}}<span class="role collaborator"><\/span>{{/if}}                    {{if isAdmin && status!=2}}<span class="role admin"><\/span>{{/if}}                    {{/if}}<\/div><div class="user-info-container"><a class="user-name {{if typeof title === \'undefined\' }} without-title{{/if}}" href="${profileUrl}" title="${displayName}">${displayName}<\/a>{{if typeof title !== \'undefined\'}}<span title="${title}">${title}<\/span>{{/if}}<\/div><\/td>{{if project.canEditTeam && project.isPrivate}}<td class="right-settings">{{if status!=2}}<div>{{each security}}                    {{tmpl(security[$index], {showSplitter: $index !== security.length - 1}) \'projects_securityItem\'}}                    {{/each}}<\/div>{{/if}}<\/td>{{/if}}<td class="menupoint-container">{{if !(isVisitor && isMe)}}<div class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/div>{{/if}}<\/td><\/tr>{{/each}}<\/tbody><\/table>');jQuery.template("member_template_without_photo",'<table class="listContainer"><tbody>{{each team}}<tr class="with-entity-menu pm-projectTeam-participantContainer {{if isAdmin || isManager}} disable{{/if}}" data-partisipantId="${id}"><td style="" class="user-info"><div class="user-info-container"><a class="user-name {{if typeof title === \'undefined\' }} without-title{{/if}}" href="${profileUrl}" title="${displayName}">${displayName}<\/a><\/div><\/td>{{if project.canEditTeam && project.isPrivate}}<td class="right-settings">{{if status!=2}}<div>{{each security}}                    {{tmpl(security[$index], {showSplitter: $index !== security.length - 1}) \'projects_securityItem\'}}                    {{/each}}<\/div>{{/if}}<\/td>{{/if}}<td class="menupoint-container"><div class="reset-action"><\/div><\/td><\/tr>{{/each}}<\/tbody><\/table>');jQuery.template("projects_securityItem",'<span class="right-checker pm-projectTeam-modulePermission{{if check}}On{{else}}Off{{/if}} {{if defaultDisabled}}no-dotted{{/if}}" data-flag="${flag}"><span>${title}<\/span><\/span>{{if $item.showSplitter}}<span class="splitter"><\/span>{{/if}}');jQuery.template("projectParticipant",'<li class="items-display-list_i" participantid="${id}"><span class="item-name"><a class="link" href="${profileUrl}" target="_blank">${title}<\/a><\/span><div class="reset-action" data-userid="${id}" title="$ASC.Projects.Resources.ProjectsCommonResource.Delete"><\/div><\/li>');jQuery.template("projects_team",'<div class="header-base block-cnt-splitter">${ASC.Projects.Resources.ProjectResource.ProjectLeader}<\/div><div class="block-cnt-splitter clearFix"><div class="pm-projectTeam-projectLeaderCard" style="float: left;"><img class="managerAvatar" src="${manager.avatar}"/><div class="manager-info" data-manager-guid="${manager.id}"><div><a class="link header-base middle bold" href="${manager.profileUrl}">${manager.displayName}<\/a><\/div>{{if manager.groups && manager.groups.length}}<div>${manager.groups[0].name}<\/div>{{/if}}<div>${Encoder.htmlEncode(manager.title)}<\/div><\/div><\/div><div style="margin-left: 380px; padding: 0 20px;"><div>${ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermission}:<\/div><div class="simple-marker-list">${ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleA}<\/div><!--<% if (!ProjectSecurity.IsPrivateDisabled) { %>--><div class="simple-marker-list">{{html jq.format(ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleB, "<span id=\'PrivateProjectHelp\' class=\'baseLinkAction\'>", "<\/span>")}}<\/div><div class="simple-marker-list">{{html jq.format(ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleC, "<span id=\'RestrictAccessHelp\' class=\'baseLinkAction\'>", "<\/span>", "<br/>")}}<\/div><div class="popup_helper" id="AnswerForPrivateProjectTeam"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.ProjectsCommonResource.HelpAnswerPrivateProjectTeam), "<br/>", "<b>", "<\/b>")}}                    {{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.ProjectsCommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><div class="popup_helper" id="AnswerForRestrictAccessTeam"><p>{{html Encoder.htmlEncode(ASC.Projects.Resources.ProjectsCommonResource.HelpAnswerRestrictAccessTeam)}}                    {{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.ProjectsCommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><!--<% } else { %><div class="simple-marker-list">${ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleForOpen}<\/div><% } %>--><\/div><\/div><div class="block-cnt-splitter">{{if project.canEditTeam}}<div id="pm-projectTeam-Selector" class="link dotline plus">${ASC.Projects.Resources.ProjectResource.ManagmentTeam}<\/div>{{/if}}<\/div><div id="team_container" class="block-cnt-splitter {{if !project.canEditTeam}} no-access{{/if}}">{{tmpl \'memberTemplate\'}}<\/div>');
jQuery.template("projects_milestoneTemplate",'<tr id="${id}" class="with-entity-menu ${status} with-checkbox"><td class="checkbox"><input type="checkbox"/><\/td><td class="status">{{tmpl({canEdit: $item.data.canEdit, status: ASC.Projects.StatusList.getById($item.data.status)}) \'projects_statusChangeContainer\'}}<\/td><td class="title stretch">{{if isKey == true}}<span class="key" title="${ASC.Projects.Resources.MilestoneResource.RootMilestone}"><\/span>{{/if}}<a href="javascript:void(0)" class="linkHeaderMedium {{if $item.data.status === 1}} gray-text{{/if}}">${title}<\/a><\/td><td class="activeTasksCount">{{if activeTasksCount != 0 || closedTasksCount != 0}}            {{if status !== 1}}<a href="${activeTasksLink}" title="${ASC.Projects.Resources.ProjectResource.TitleMilestoneOpenTasks}">${activeTasksCount}<\/a>{{else}}                ${activeTasksCount}            {{/if}}        {{/if}}<\/td><td class="slash">{{if activeTasksCount != 0 || closedTasksCount != 0}}            /        {{/if}}<\/td><td class="closedTasksCount">{{if activeTasksCount != 0 || closedTasksCount != 0}}            {{if status !== 1}}<a href="${closedTasksLink}" title="${ASC.Projects.Resources.ProjectResource.TitleMilestoneClosedTasks}">${closedTasksCount}<\/a>{{else}}                ${closedTasksCount}            {{/if}}        {{/if}}<\/td><td class="deadline">{{if overdue }}<span class="overdue">${deadline}<\/span>{{else}}<span>${deadline}<\/span>{{/if}}<\/td><td class="responsible"><div><span {{if responsibleId==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\' || (isTerminated && !Teamlab.profile.isAdmin)}} class="not-action"{{/if}} title="${ASC.Projects.Resources.ProjectResource.TitleMilestoneResponsibleUser}">${responsible}<\/span><\/div><\/td><td class="actions">{{if (canEdit && !Teamlab.profile.isVisitor) || canDelete}}<div class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/div>{{/if}}<\/td><\/tr>');
jQuery.template("projects_timeTrackingTmpl",'<tr id="timeSpendRecord${id}" class="timeSpendRecord with-entity-menu with-checkbox" timeid="${id}"><td class="checkbox"><input type="checkbox"/><\/td><td class="pm-ts-statusColumn"><div class="check">{{tmpl({canEdit: $item.data.canEditPaymentStatus, status: ASC.Projects.StatusList.getById($item.data.paymentStatus)}) \'projects_statusChangeContainer\'}}<\/div><\/td><td class="pm-ts-dateColumn">${displayDateCreation}<\/td><td class="pm-ts-noteColumn stretch"><a href="Tasks.aspx?prjID=${relatedProject}&id=${relatedTask}">${relatedTaskTitle}<\/a><span>${note}<\/span><\/td><td class="pm-ts-hoursColumn">${jq.timeFormat(hours).split(":")[0]}${ASC.Projects.Resources.TimeTrackingResource.ShortHours} ${jq.timeFormat(hours).split(":")[1]}${ASC.Projects.Resources.TimeTrackingResource.ShortMinutes}<\/td><td class="pm-ts-personColumn">{{if person != null}}<span {{if person.id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} class="not-action"{{/if}} title="${person.displayName}">${person.displayName}<\/span>{{else}}<span {{if createdBy.id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} class="not-action"{{/if}} title="${createdBy.displayName}">${createdBy.displayName}<\/span>{{/if}}<\/td><td class="pm-ts-actionsColumn">{{if canEdit == true}}<div class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/div>{{/if}}<\/td><\/tr>');
jQuery.template("projects_templatesEditMilestoneTmpl",'<div class="milestone" id="m_${number}"><div class="mainInfo menuButtonContainer with-entity-menu"><span class="daysCount" value="${duration}"><span>${duration}<\/span><\/span><div class="titleContainerEdit"><span class="title">${title}<\/span><\/div><a class="addTask">+ ${ASC.Projects.Resources.ProjectTemplatesResource.Task}<\/a><span class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/span><\/div>{{if displayTasks}}<div class="milestoneTasksContainer" style="display: block;">{{else}}<div class="milestoneTasksContainer">{{/if}}<div class="listTasks" milestone="m_${number}">{{each(i, task) tasks}}<div id="${number}_${i+1}" class="task menuButtonContainer with-entity-menu"><div class="titleContainer"><span class="title">${task.title}<\/span><\/div><span class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/span><\/div>{{/each}}<\/div><\/div><\/div>');jQuery.template("projects_templatesEditTaskTmpl",'<div class="task menuButtonContainer with-entity-menu" id="t_${number}"><div class="titleContainer"><span class="title">${title}<\/span><\/div><span class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/span><\/div>');jQuery.template("projects_templatesCreateMilestoneTmpl",'<div class="milestone" id="m_${number}"><div class="mainInfo menuButtonContainer with-entity-menu"><span class="dueDate"><span>${date}<\/span><\/span><div class="titleContainer"><span class="title">${title}<\/span><\/div><a class="addTask">+ ${ASC.Projects.Resources.ProjectTemplatesResource.Task}<\/a><span class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/span>{{if chooseRep}}<span class="chooseResponsible"><span class="link dotline" guid="${chooseRep.id}">${chooseRep.name}<\/span><\/span>{{/if}}<\/div>{{if displayTasks}}<div class="milestoneTasksContainer" style="display: block;">{{else}}<div class="milestoneTasksContainer">{{/if}}<div class="listTasks" milestone="m_${number}">{{each(i, task) tasks}}<div id="${number}_${i+1}" class="task menuButtonContainer with-entity-menu"><div class="titleContainer"><span class="title">${task.title}<\/span><\/div><span class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/span>{{if chooseRep}}<span class="chooseResponsible nobody"><span class="link dotline">${ASC.Projects.Resources.ProjectsJSResource.ChooseResponsible}<\/span><\/span>{{/if}}<\/div>{{/each}}<\/div><\/div>');jQuery.template("projects_templatesCreateTaskTmpl",'<div class="task menuButtonContainer with-entity-menu" id="t_${number}"><div class="titleContainer"><span class="title">${title}<\/span><\/div><span class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/span>{{if chooseRep}}<span class="chooseResponsible"><span class="link dotline" guid="${chooseRep.id}">${chooseRep.name}<\/span><\/span>{{else}}                {{if selectResp}}<span class="chooseResponsible nobody"><span class="link dotline">${ASC.Projects.Resources.ProjectsJSResource.ChooseResponsible}<\/span><\/span>{{/if}}            {{/if}}<\/div>');jQuery.template("projects_templateTmpl",'<tr class="with-entity-menu template menuButtonContainer" id="${id}"><td class="stretch"><a href="ProjectTemplates.aspx?id=${id}&action=edit" class="title">${title}<\/a><span class="description">(${milestones} ${ASC.Projects.Resources.ProjectTemplatesResource.Milestones}, ${tasks} ${ASC.Projects.Resources.ProjectTemplatesResource.Tasks})<\/span><\/td><td><span class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/span><\/td><\/tr>');jQuery.template("projects_tabsNavigator","{{each tabs}}    {{tmpl($item.data.tabs[$index], {showSplitter: $index !== $item.data.tabs.length - 1}) 'projects_tabsNavigatorItem'}}    {{/each}}");jQuery.template("projects_tabsNavigatorItem",'{{if $item.data.href}}<a class="tabsNavigationLink {{if $item.data.selected}}selectedTab{{/if}}" id="${$item.data.divID}_tab" href="${$item.data.href}">${$item.data.title}{{if $item.data.count}}<span class="count">(${$item.data.count}){{/if}}<\/span><\/a>{{else}}<span class="tabsNavigationLink {{if $item.data.selected}}selectedTab{{/if}}" id="${$item.data.divID}_tab">${$item.data.title}{{if $item.data.count}}<span class="count">(${$item.data.count}){{/if}}<\/span><\/span>{{/if}}    {{if $item.showSplitter}}<span class="splitter"><\/span>{{/if}}');
jQuery.template("projects_taskListItemTmpl",'<div class="task with-entity-menu clearFix{{if !$item.data.subtasks.length}} noSubtasks{{/if}}{{if $item.data.canEdit}} canedit{{/if}}{{if $item.data.status == 2}} closed{{/if}}" taskid="${id}">{{if ($item.data.canEdit && !Teamlab.profile.isVisitor) || $item.data.canCreateTimeSpend || $item.data.canDelete}}<div class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/div>{{else}}<div class="nomenupoint"><\/div>{{/if}}<div class="checkbox"><input title="Select" type="checkbox"><\/div><div class="check">{{tmpl({canEdit: $item.data.canEdit, status: ASC.Projects.StatusList.getByData($item.data)}) \'projects_statusChangeContainer\'}}<\/div><div class="taskPlace"><div class="taskName">{{if $item.data.priority == 1}}<span class="high_priority"><\/span>{{/if}}<a href="Tasks.aspx?prjID=${projectOwner.id}&id=${id}" class="linkHeaderMedium{{if $item.data.status == 2}} gray-text{{/if}}">${title}<\/a><\/div><div class="subtasksCount">{{tmpl \'projects_numSubtasksTmpl\'}}<\/div><\/div>{{if $item.data.responsibles.length > 1}}<div class="user"><span class="other" title="${ASC.Projects.Resources.ProjectResource.TitleTaskResponsibleUsers}">${responsibles.length} ${ASC.Projects.Resources.TaskResource.Responsibles}<\/span><\/div>{{else}}<div class="user">{{if $item.data.responsible == null}}<span>${ASC.Projects.Resources.TaskResource.NoResponsible}<\/span>{{else}}<span {{if responsible.id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\' || (responsible.isTerminated && !Teamlab.profile.isAdmin)}}class="not-action"{{else}} title="${ASC.Projects.Resources.ProjectResource.TitleTaskResponsibleUser}"{{/if}}>${responsible.displayName}<\/span>{{/if}}<\/div>{{/if}}        {{if $item.data.displayDateDeadline.length}}<div class="deadline"><span class="timeLeft {{if ASC.Projects.TasksManager.compareDates($item.data.deadline)}}red{{/if}}">${displayDateDeadline}<\/span><\/div>{{else}}        {{if $item.data.milestone != null}}<div class=\'deadline\'><span class="timeLeft {{if ASC.Projects.TasksManager.compareDates($item.data.milestone.deadline)}}red{{/if}}">${milestone.displayDateDeadline}<\/span><span class="milestone" title="${ASC.Projects.Resources.TaskResource.Milestone + \': \' + milestone.title}"><\/span><\/div>{{/if}}         {{/if}}<\/div><div taskid="${id}" class="subtasks"{{if !$item.data.subtasks.length || $item.data.status == 2}} style="display:none;"{{/if}}>{{tmpl \'projects_subtasksTemplate\'}}        {{if $item.data.canEdit || $item.data.canCreateSubtask}}<div class="quickAddSubTaskLink icon-link plus" {{if ($item.data.status == 1 || $item.data.status == 4) && ($item.data.subtasks.length)}}visible="true"{{else}}visible="false" style="display:none;"{{/if}}><span class="link dotline" taskid="${id}">${ASC.Projects.Resources.TaskResource.AddNewSubtask}<\/span><\/div>{{/if}}<div class="st_separater"><\/div><\/div>');jQuery.template("projects_taskListResponsibles",'{{each responsibles}}    {{if $index >= 0}}<li userId="${id}" class="user dropdown-item{{if id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} not-action{{/if}}" title="${displayName}">${displayName}<\/li>{{/if}}    {{/each}}');jQuery.template("projects_milestoneForMoveTaskPanelTmpl",'<div class="ms"><input id="ms_${id}" value="${id}" type="radio" name="milestones" {{if checked}} checked="checked" {{/if}}/><label for="ms_${id}">{{if displayDateDeadline}}[${displayDateDeadline}] {{/if}}${title}<\/label><\/div>');jQuery.template("projects_numSubtasksTmpl",'{{if ASC.Projects.TasksManager.openedCount($item.data.subtasks)}}<span class="collaps link dotline" title="${ASC.Projects.Resources.ProjectResource.TitleTaskOpenSubtasks}" taskid="${id}">+{{html ASC.Projects.TasksManager.openedCount($item.data.subtasks)}}<\/span>{{else}}    {{if $item.data.canCreateSubtask}}<span class="add">+ ${ASC.Projects.Resources.TaskResource.Subtask}<\/span>{{/if}}    {{/if}}');jQuery.template("projects_taskActionUser",'{{each $data}}<div data-value="${$value.id}" class="user">${$value.title}<\/div>{{/each}}');
jQuery.template("projects_taskDescriptionSubtasksContainerTmpl",'{{tmpl "projects_subtasksTemplate"}}    {{if canEdit || canCreateSubtask}}<div class="quickAddSubTaskLink icon-link plus" {{if status == 1 || status == 4}} visible="true" {{else}}visible="false" style="display:none;"{{/if}}><span class="link dotline">${ASC.Projects.Resources.TaskResource.AddNewSubtask}<\/span><\/div>{{/if}}<div class="st_separater"><\/div>');jQuery.template("projects_taskLinks",'<tr data-taskid="${id}" class="linked-task with-entity-menu{{if relatedTaskObject.invalidLink}} invalid-link{{/if}} {{if status==2}} gray-text{{/if}}"><td class="title stretch">{{if relatedTaskObject.invalidLink}}<span class="attantion">&nbsp;<\/span>{{/if}}<a class="task-name {{if status==2}} gray-text{{/if}}" href="Tasks.aspx?prjID=${projectId}&id=${id}" target="_blank">${title}<\/a><\/td><td class="start-date" title="${ASC.Projects.Resources.TaskResource.TaskStartDate}">{{if displayDateStart != ""}}${displayDateStart}{{/if}}<\/td><td class="end-date" title="${ASC.Projects.Resources.TaskResource.EndDate}">{{if displayDateDeadline != ""}}${displayDateDeadline}{{/if}}<\/td><td class="link-type" title="${ASC.Projects.Resources.ProjectResource.GanttLinkType}" data-type="${relatedTaskObject.linkType}">${relatedTaskObject.linkTypeText}<\/td><td class="duration{{if relatedTaskObject.invalidLink}} red-text{{/if}}" title="${ASC.Projects.Resources.TaskResource.RelatedTaskIntervalDesc}">{{if relatedTaskObject.invalidLink}}-{{/if}}{{if relatedTaskObject.delay!=0}}${relatedTaskObject.delay}{{/if}}<\/td><td class="actions">{{if canEdit}}<div class="entity-menu" data-taskid="${id}" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/div>{{/if}}<\/td><\/tr>');jQuery.template("projects_taskLinksContainer",'<div class="popup_helper" id="hintInvalidLink"><p>${ASC.Projects.Resources.TaskResource.RelatedLinkInvalid}            {{if ASC.Resources.Master.HelpLink}}<a href="${ASC.Resources.Master.HelpLink.concat(\'/guides/link-tasks.aspx\')}" target="_blank">${ASC.Projects.Resources.ProjectsCommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><div id="linkedTasksContainer" class="display-none"><table id="relatedTasks" class="task-links">{{each tasks}}            {{tmpl($item.data.tasks[$index]) \'projects_taskLinks\'}}            {{/each}}<\/table><table id="editTable" class="task-links display-none"><tbody><tr class="linked-task edit-link-container"><td class="title stretch"><select id="taskSelector"><option value="-1" selected="selected">${ASC.Projects.Resources.TaskResource.ChooseTaskForLink}<\/option><\/select><\/td><td class="link-type" colspan="4"><span id="linkTypeSelector"><\/span><\/td><td class="actions"><a id="addLink" class="button gray small">${ASC.Projects.Resources.ProjectResource.OkButton}<\/a><\/td><\/tr><\/tbody><\/table><div class="linked-tasks-buttons{{if !canEdit}} display-none{{/if}}"><span class="icon-link plus"><a id="addNewLink" class="baseLinkAction">${ASC.Projects.Resources.TaskResource.CreateNewLink}<\/a><\/span><span class="splitter-buttons"><\/span><\/div><\/div>');
jQuery.template("projects_subtasksTemplate","{{each subtasks}}        {{tmpl($item.data.subtasks[$index], {taskStatus: $item.data.status}) 'projects_subtaskTemplate'}}      {{/each}}");jQuery.template("projects_subtaskTemplate",'<div id="${id}" class="with-entity-menu subtask clearFix {{if $item.data.status == 2}} closed{{/if}}{{if $item.data.canEdit}} canedit{{/if}}" {{if $item.data.canEdit && $item.data.status != 2 && $item.taskStatus != 2}} draggable="true" {{/if}}>{{if $item.data.canEdit}}<div class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/div>{{else}}<div class="nomenupoint"><\/div>{{/if}}<div class="check"><input type="checkbox" {{if $item.data.status == 2}} checked="checked" {{/if}} {{if !$item.data.canEdit || $item.taskStatus == 2}} disabled="true" {{/if}} /><\/div><div class="taskName{{if $item.data.canEdit}} canedit{{/if}}"><span>{{html jq.linksParser(jq.htmlEncodeLight($item.data.title))}}<\/span><\/div>{{if $item.data.responsible == null}}<div class="not user"><span>${ASC.Projects.Resources.TaskResource.NoResponsible}<\/span><\/div>{{else}}<div class="user" title="${$item.data.responsible.displayName}">${$item.data.responsible.displayName}<\/div>{{/if}}<\/div>');jQuery.template("projects_fieldForAddSubtask",'<table id="quickAddSubTaskField" class="add-subtask-field-wrapper display-none"><tr><td class="subtask-name border-style"><input class="subtask-name-input" type="text" value="${title}" data-subtaskid="${subtaskid}" maxlength="255"/><\/td><td class="subtask-responsible border-style"><span class="subtask-responsible-selector link dotline">{{if responsible != null}}${responsible.displayName}{{else}}${ASC.Projects.Resources.TaskResource.NoResponsible}{{/if}}<\/span><\/td><td class="subtask-add-button"><a class="button gray">${ASC.Projects.Resources.ProjectResource.OkButton}<\/a><\/td><\/tr><\/table>');
jQuery.template("projects_discussionTemplate",'<div class="container-list"><div class="header-list clearFix"><div class="avatar-list"><img src="${authorAvatar}" alt="${authorName}"/><\/div><div class="describe-list"><div class="title-list"><a href="${discussionUrl}">${title}<\/a>{{if status == 1}}<span class="status">${ASC.Projects.Resources.MessageResource.ArchiveDiscussionStatus}<\/span>{{/if}}<\/div><div class="info-list"><span class="caption-list">${ASC.Projects.Resources.MessageResource.AuthorTitle}:<\/span><span class="name-list author{{if authorId==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\'}} not-action{{/if}}" data-authorId="${authorId}">${authorName}<\/span><\/div>{{if projectTitle}}<div class="info-list"><span class="caption-list">${ASC.Projects.Resources.ProjectResource.Project}:<\/span><span class="name-list project" data-projectId="${projectId}">${projectTitle}<\/span><\/div>{{/if}}<div class="date-list">${createdDate}<span class="time-list">${createdTime}<\/span><\/div><\/div><\/div><div class="content-list">{{html htmlUtility.getFull(text)}}                                {{if hasPreview}}<div><a class="read-more" target="_blank" href="${discussionUrl}"><font>${ASC.Projects.Resources.MessageResource.ReadMore}<\/font><\/a><\/div>{{/if}}<div class="comment-list"><a href="${commentsUrl}">${ASC.Projects.Resources.MessageResource.Comments}: ${commentsCount}<\/a>{{if canComment}}<a href="${writeCommentUrl}">${ASC.Projects.Resources.ProjectsCommonResource.WriteComment}<\/a>{{/if}}<\/div><\/div><\/div>');jQuery.template("projects_discussionActionTemplate",'<div class="discussionContainer"><div class="discussionHeaderContainer"><span class="discussionHeader">${title}<\/span><\/div><div class="discussionAuthorAvatar"><img src="${authorAvatarUrl}" alt="${authorName}"/><\/div><div class="discussionDescriptionContainer"><div><a class="link bold" href="${authorPageUrl}">${authorName}<\/a><span class="discussionCreatedDate">${createOn}<\/span><\/div><div class="discussionAuthorTitle">${authorTitle}<\/div><div class="discussionText">{{html content}}<\/div><div style="clear: both;"><\/div><\/div><\/div>');jQuery.template("projects_discussionTab",'<div id="discussionParticipantsContainer" class="participantsContainer display-none"><div id="manageParticipantsSelector" class="link dotline plus">${ASC.Projects.Resources.ProjectsCommonResource.AddParticipants}<\/div><ul id="discussionParticipantsTable" class="items-display-list">{{tmpl \'projects_subscribedUsers\'}}<\/ul><div style="clear: both;"><\/div><\/div><div class="popup_helper" id="hintSubscribersPrivateProject"><p>${ASC.Projects.Resources.ProjectsCommonResource.hintSubscribersPrivateProject}<\/p><\/div>');jQuery.template("projects_subscribedUsers","{{each newListParticipants}}    {{tmpl($item.data.newListParticipants[$index]) 'projects_subscribedUser'}}    {{/each}}     {{each notSeePartisipant}}    {{tmpl($item.data.notSeePartisipant[$index]) 'projects_subscribedUser'}}    {{/each}}");jQuery.template("projects_subscribedUser",'<li class="items-display-list_i" guid=\'${id}\'><span class="item-name"><a class="link {{if hidden}}gray{{/if}}" href="${profileUrl}" target="_blank">${displayName}<\/a><\/span>{{if !descriptionFlag}}<div class="reset-action"><\/div>{{/if}}<\/li>');jQuery.template("projects_tabs",'<div class="tabs-section" id="${id}"><span class="header-base">${title}{{if count}} (${count}){{/if}}<\/span><span id="switcher${id}" class="toggle-button" data-switcher="${state}" data-showtext="${ASC.Projects.Resources.ProjectsCommonResource.Show}" data-hidetext="${ASC.Projects.Resources.ProjectsCommonResource.Hide}">{{if state === 0}}            ${ASC.Projects.Resources.ProjectsCommonResource.Hide}            {{else}}            ${ASC.Projects.Resources.ProjectsCommonResource.Show}            {{/if}}<\/span><\/div>');jQuery.template("discussion_buttons","<div id=\"discussionButtonsContainer\" class=\"big-button-container\"><a id='discussionActionButton' class='button blue big'>${action}<\/a><span class=\"splitter-buttons\"><\/span><a id='discussionPreviewButton' class='button blue big ${disable}'>${ASC.Projects.Resources.ProjectsCommonResource.Preview}<\/a><span class=\"splitter-buttons\"><\/span><a id='discussionCancelButton' class='button gray big'>${ASC.Projects.Resources.ProjectsCommonResource.Cancel}<\/a><\/div>");
jQuery.template("projects_statusChangePanel",'<div id="statusChangePanel" class="studio-action-panel"><ul id="statusList" class="dropdown-content">{{each statuses}}<li id="statusItem_${id}" class="${cssClass} dropdown-item">${text}<\/li>{{/each}}<\/ul><\/div>');jQuery.template("projects_statusChangeContainer",'<div class="changeStatusCombobox{{if canEdit}} canEdit{{else}} noEdit{{/if}}"><span title="${status.text}" class="${status.cssClass}"><\/span>{{if canEdit}}<span class="arrow"><\/span>{{/if}}<\/div>');jQuery.template("projects_panelFrame",'<div id="${panelId}" class="studio-action-panel"><div class="panel-content"><\/div><\/div>');jQuery.template("projects_actionMenuContent",'<ul class="dropdown-content">{{each menuItems}}            {{if seporator }}<li class="dropdown-item-seporator"><\/li>{{else}}                {{if classname }}<li id="${id}" class="dropdown-item with-icon ${classname}"><span title="${text}">${text}<\/span><\/li>{{else}}<li id="${id}" class="dropdown-item"><span title="${text}">${text}<\/span><\/li>{{/if}}            {{/if}}        {{/each}}<\/ul>');jQuery.template("projects_linedListWithCheckbox",'<ul class="dropdown-content lined">{{each menuItems}}<li class="dropdown-item {{if classname}}${classname}{{/if}}"><input id="${id}" type="checkbox" /><label for="${id}" title="${title}">${title}<\/label><\/li>{{/each}}<\/ul>');jQuery.template("projects_descriptionPanelContent",'{{if creationDate}}<div class="date"><div class="param">${ASC.Projects.Resources.TaskResource.CreatingDate}:<\/div><div class="value">${creationDate}<\/div><\/div>{{/if}}    {{if createdBy}}<div class="createdby"><div class="param">${ASC.Projects.Resources.TaskResource.CreatedBy}:<\/div><div class="value">${createdBy}<\/div><\/div>{{/if}}    {{if typeof startDate == "string"}}<div class="startdate"><div class="param">${ASC.Projects.Resources.TaskResource.TaskStartDate}:<\/div><div class="value">${startDate}<\/div><\/div>{{/if}}    {{if closedDate}}<div class="closed"><div class="param">${ASC.Projects.Resources.TaskResource.Closed}:<\/div><div class="value">${closedDate}<\/div><\/div>{{/if}}    {{if closedBy}}<div class="closedby"><div class="param">${ASC.Projects.Resources.TaskResource.ClosedBy}:<\/div><div class="value">${closedBy}<\/div><\/div>{{/if}}    {{if project}}<div class="project"><div class="param">${ASC.Projects.Resources.TaskResource.Project}:<\/div><div class="value"><span {{if typeof(projectStatus) !=="undefined" && projectStatus !== 1}} class="link dotline" {{/if}}  projectid="${projectId}">{{html project}}<\/span><\/div><\/div>{{/if}}    {{if milestone}}<div class="milestone"><div class="param">${ASC.Projects.Resources.TaskResource.Milestone}:<\/div><div class="value"><span {{if typeof(milestoneStatus) !=="undefined" && milestoneStatus !== 1}} class="link dotline" {{/if}}  projectid="${projectId}" milestone="${milestoneId}">{{html milestone}}<\/span><\/div><\/div>{{/if}}    {{if description}}<div class="descr"><div class="param">${ASC.Projects.Resources.TaskResource.Description}:<\/div><div class="value"><div class="descrValue">{{html jq.linksParser(jq.htmlEncodeLight(description))}}<\/div>{{if readMore}}<a class="readMore" target="_blank" href="${readMore}">${ASC.Projects.Resources.ProjectsCommonResource.ReadMore}<\/a>{{/if}}<\/div><\/div>{{/if}}');jQuery.template("projects_groupActionMenu",'<ul id="groupActionMenu" class="clearFix contentMenu contentMenuDisplayAll"><li class="menuAction menuActionSelectAll menuActionSelectLonely"><div class="menuActionSelect"><input id="selectAll" type="checkbox" title="${ASC.Projects.Resources.TimeTrackingResource.GroupMenuSelectAll}"/><\/div>{{if multiSelector}}<div class="down_arrow" title="Select"><\/div><div id="groupActionMenuSelector" class="studio-action-panel"><ul class="dropdown-content">{{each multiSelector}}<li id="${id}"><a class="dropdown-item">${title}<\/a><\/li>{{/each}}<\/ul><\/div>{{/if}}<\/li>{{each actions}}<li class="menuAction" id="${id}" title="${title}"><span>${title}<\/span>{{if multi}}<div class="down_arrow"><\/div><div id="${id}Selector" class="studio-action-panel"><ul class="dropdown-content">{{each multi}}<li id="${id}"><a class="dropdown-item">${title}<\/a><\/li>{{/each}}<\/ul><\/div>{{/if}}<\/li>{{/each}}<li class="menu-action-checked-count"><span><\/span><a id="deselectAll" class="link dotline small">${ASC.Projects.Resources.TimeTrackingResource.GroupMenuDeselectAll}<\/a><\/li><li class="menu-action-simple-pagenav" style="display: list-item;"><\/li><li class="menu-action-on-top"><a class="on-top-link" onclick="javascript:window.scrollTo(0, 0);">${ASC.Projects.Resources.TimeTrackingResource.GroupMenuOnTop}<\/a><\/li><\/ul>');jQuery.template("projects_totalTimeText",'<div class=\'total-time-forFilter\' id=\'totalTimeText\'><span><\/span><span class="total-count">${ASC.Projects.Resources.TimeTrackingResource.TotalTimeCommon}<b><span class="hours"><\/span>${ASC.Projects.Resources.TimeTrackingResource.Hours}<span class="minutes"><\/span>${ASC.Projects.Resources.TimeTrackingResource.Minutes}<\/b><\/span><span class="billed-count">${ASC.Projects.Resources.TimeTrackingResource.TotalTimeBilled}<b><span class="hours"><\/span>${ASC.Projects.Resources.TimeTrackingResource.Hours}<span class="minutes"><\/span>${ASC.Projects.Resources.TimeTrackingResource.Minutes}<\/b><\/span><\/div>');jQuery.template("projects_navPanel",'<div class="project-info-container"><div class="project-total-info project-title header-with-menu with-entity-menu"><span class="main-title-icon ${$item.data.icon}"><\/span>{{if $item.data.private}}<span class="private"><\/span>{{/if}}<span id="essenceTitle" class="text-overflow" title="${$item.data.title}">${$item.data.title}<\/span><span class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/span><\/div><div id="projectTabs" class="display-none tabsNavigationLinkBox"><\/div><\/div>');jQuery.template("projects_emptyScreen",'<table><tbody><tr><td><div class="emptyScrImage ${img}"><\/div><\/td><td><div class="emptyScrTd"><div class="header-base-big">${$item.data.header}<\/div><div class="emptyScrDscr">${$item.data.description}<\/div>{{if $item.data.button.canCreate()}}<div class="emptyScrBttnPnl"><span class="link dotline {{if $item.data.button.clear}}clearFilterButton{{else}}addFirstElement{{/if}}">${$item.data.button.title}<\/span><\/div>{{/if}}<\/div><\/td><\/tr><\/tbody><\/table>');jQuery.template("projects_description",'<div class="descriptionContainer">{{if status.items.length }}<div><span class="title">${ASC.Projects.Resources.ProjectsCommonResource.Status}:<\/span><span class="value">{{if status.canChange }}<span class="link dotline status">${status.current.title}<\/span>{{else}}                    ${status.current.title}                {{/if}}<\/span><\/div>{{/if}}        {{each data}}        {{tmpl($item.data.data[$index]) \'projects_description_item\'}}        {{/each}}<\/div>');jQuery.template("projects_description_item",'{{if typeof value != "undefined" && value.length}}<div><span class="title">${title}:<\/span><span class="value">{{if typeof href != "undefined" && href.length}}<a href="${href}">${value}<\/a>{{else typeof wrapper != "undefined" && wrapper.length}}        {{html jq.format(wrapper, value)}}        {{else}}        {{html value}}        {{/if}}<\/span><\/div>{{/if}}');jQuery.template("projects_dashboard_empty_screen",'<div id="projects_dashboard_empty_screen_container"><div class="backdrop" blank-page=""><\/div><div id="content" blank-page="" class="dashboard-center-box projects"><a class="close">&times;<\/a><div class="content"><div class="slick-carousel">{{each blocks}}<div class="module-block slick-carousel-item clearFix"><div class="img"><img src="/Products/Projects/App_Themes/default/images/dashboard/${image}"/><\/div><div class="text"><div class="title">${title}<\/div>{{each text}}<p>${$value}<\/p>{{/each}}<\/div><\/div>{{/each}}<\/div><\/div><div class="dashboard-buttons"><a class="button huge create-button" href="/Products/Projects/Projects.aspx?action=add">${ASC.Projects.Resources.ProjectsCommonResource.CreateProjectButtonText}<\/a><\/div><\/div><\/div>');jQuery.template("projects_move_task_panel",'<div class="describe-text">${describe.title}<\/div><div class="taskTitls ms"><b>${describe.description}<\/b><\/div><div class="describe-text ms">${ASC.Projects.Resources.TaskResource.WillBeMovedToMilestone}:<\/div><div class="milestonesList">{{tmpl(milestones) \'projects_milestoneForMoveTaskPanelTmpl\'}}<\/div><div class="middle-button-container"><a href="javascript:void(0)" class="button blue middle">${describe.moveToMilestone}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle" href="javascript:void(0)">${ASC.Projects.Resources.ProjectsCommonResource.Cancel}<\/a><\/div>');jQuery.template("projects_common_popup_header",'<span class="commonPopupHeaderTitle">${title}<\/span>');jQuery.template("projects_task_action",'{{tmpl \'projects_common_action\'}}<div id="pm-milestoneBlock" class="display-none"><div class="pm-headerLeft">${ASC.Projects.Resources.MilestoneResource.Milestone}:<\/div><div class="pm-fieldRight"><div id="taskMilestone" data-id="" class="link dotline advansed-select-container">${ASC.Projects.Resources.ProjectsCommonResource.Select}<\/div><\/div><div style="clear: both"><\/div><\/div><div id="pm-respBlock" class="display-none"><div class="pm-headerLeft userAddHeader">${ASC.Projects.Resources.TaskResource.TaskResponsible}:<\/div><div class="userAdd"><div id="responsibleSelectContainer"><\/div><span id="taskResponsible" class="link dotline advansed-select-container">${ASC.Projects.Resources.TaskResource.Add}<\/span><div class="float-right notify display-none"><input type="checkbox" id="notify" checked="checked"/><label for="notify">${ASC.Projects.Resources.MessageResource.SubscribeUsers}<\/label><\/div><div id="fullFormUserList"><\/div><\/div><\/div><div style="clear: both"><\/div><div class="pm-headerLeft notify"><\/div><div style="clear: both" class="notify"><\/div><div class="pm-headerLeft" style="line-height: 21px;">${ASC.Projects.Resources.TaskResource.TaskStartDate}:<\/div><div class="pm-fieldRight"><span class="requiredErrorText startDate-error" error="${ASC.Projects.Resources.ProjectsCommonResource.TaskCompareDateError}" style="margin-right: 24px;"><\/span><input type="text" id="taskStartDate" class="textEditCalendar" autocomplete="off"/><\/div><div style="clear: both"><\/div><div class="pm-headerLeft" style="line-height: 21px;">${ASC.Projects.Resources.TaskResource.DeadLine}:<\/div><div class="pm-fieldRight"><input type="text" id="taskDeadline" class="textEditCalendar"  autocomplete="off"/><span class="splitter"><\/span><span class="link dotline deadline_left" data-value="0">${ASC.Projects.Resources.ProjectsCommonResource.Today}<\/span><span class="splitter"><\/span><span class="link dotline deadline_left" data-value="3">3            ${ASC.Projects.Resources.DayGenitiveSingular}<\/span><span class="splitter"><\/span><span class="link dotline deadline_left" data-value="7">${ASC.Projects.Resources.ReportResource.Week}<\/span><\/div><div style="clear: both"><\/div><div><div class="pm-headerLeft">${ASC.Projects.Resources.TaskResource.Priority}:<\/div><div class="pm-fieldRight"><input type="checkbox" name="priority" value="1" id="priority"/><label class="priority high" for="priority">${ASC.Projects.Resources.TaskResource.HighPriority}<\/label><\/div><div style="clear: both"><\/div><\/div><div style="clear: both"><\/div><div class="display-none" id="copySubtasksContainer"><div class="pm-headerLeft">${ASC.Projects.Resources.ProjectsCommonResource.Copy}:<\/div><div class="pm-fieldRight"><div class="copy"><input type="checkbox" name="copySubtasks" value="1" id="copySubtasks"/><label class="copy" for="copySubtasks">${ASC.Projects.Resources.TaskResource.Subtasks}<\/label><\/div><div class="copy files"><input type="checkbox" name="copyFiles" value="1" id="copyFiles"/><label class="copy" for="copyFiles">${ASC.Projects.Resources.ProjectsCommonResource.DocsModuleTitle}<\/label><\/div><\/div><\/div><div class="success-popup display-none">${ASC.Projects.Resources.ProjectsCommonResource.TaskAddedMessage}<a id="taskLink" href="javascript:void(0)">${ASC.Projects.Resources.TaskResource.GoToTheTask}<\/a><\/div><div class="error-popup display-none"><\/div><div class="pm-action-block big-button-container"><a id="saveTaskAction" href="javascript:void(0)" class="button blue middle">${ASC.Projects.Resources.ProjectsCommonResource.Save}<\/a><span class="splitter-buttons"><\/span><a id="createTaskAndCreateNew" href="javascript:void(0)" class="button gray middle">${ASC.Projects.Resources.ProjectsCommonResource.SaveAndAddMore}<\/a><span class="splitter-buttons"><\/span><a id="closeTaskAction" class="button gray middle" href="javascript:void(0)">${ASC.Projects.Resources.ProjectsCommonResource.Cancel}<\/a><\/div>');jQuery.template("projects_milestone_action",'{{tmpl \'projects_common_action\'}}<div id="milestoneResponsibleContainer" class="block-cnt-splitter requiredField"><span class="requiredErrorText">${ASC.Projects.Resources.MilestoneResource.ChooseResponsible}<\/span><div class="headerPanelSmall">${ASC.Projects.Resources.MilestoneResource.Responsible}:<\/div><div id="milestoneResponsible" data-id="" class="link dotline advansed-select-container">${ASC.Projects.Resources.ProjectsCommonResource.Select}<\/div><div class="notifyResponsibleContainer"><input id="notifyResponsibleCheckbox" type="checkbox" checked="checked"/><label for="notifyResponsibleCheckbox">${ASC.Projects.Resources.MilestoneResource.NotifyResponsible}<\/label><\/div><div id="noActiveParticipantsMilNote" class="float-right gray-text display-none">${ASC.Projects.Resources.ProjectsJSResource.NoActiveParticipantsNote}<\/div><\/div><div style="clear: both"><\/div><div id="milestoneDeadlineContainer" class="block-cnt-splitter requiredField"><div class="headerPanelSmall">${ASC.Projects.Resources.MilestoneResource.MilestoneDeadline}:<\/div><div id="milestoneDeadlineSelectorContainer"><input type="text" id="milestoneDeadlineInputBox" class="textEditCalendar" autocomplete="off"/><span class="link dotline deadlineLeft" data-value="7">${ASC.Projects.Resources.MilestoneResource.DeadlineInWeek}<\/span><span class="link dotline deadlineLeft" data-value="1">${ASC.Projects.Resources.MilestoneResource.DeadlineInMonth}<\/span><span class="link dotline deadlineLeft" data-value="2">${ASC.Projects.Resources.MilestoneResource.DeadlineInTwoMonths}<\/span><\/div><\/div><div id="milestoneKeyContainer"><input id="milestoneKeyCheckBox" type="checkbox"/><label for="milestoneKeyCheckBox">${ASC.Projects.Resources.MilestoneResource.RootMilestone}<\/label><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForProjectMilestone\', popup: true });" title="${ASC.Projects.Resources.ProjectsCommonResource.HelpQuestionProjectMilestone}"><\/div><div class="popup_helper" id="AnswerForProjectMilestone"><p>{{html jq.format(ASC.Projects.Resources.ProjectsCommonResource.HelpAnswerProjectMilestone, "<br/>", "<b>", "<\/b>")}}<\/p><\/div><\/div><div id="milestoneNotifyManagerContainer"><input id="milestoneNotifyManagerCheckBox" type="checkbox"/><label for="milestoneNotifyManagerCheckBox">${ASC.Projects.Resources.MilestoneResource.RemindMe}<\/label><\/div><div class="error-popup display-none"><\/div><div id="milestoneActionButtonsContainer" class="big-button-container"><a id="milestoneActionButton" href="javascript:void(0)" class="button blue middle"           add="${ASC.Projects.Resources.MilestoneResource.AddMilestoneButton}" update="${ASC.Projects.Resources.ProjectsCommonResource.SaveChanges}"><\/a><span class="splitter-buttons"><\/span><a id="milestoneActionCancelButton" href="javascript:void(0)" class="button gray middle" onclick="javascript:jq.unblockUI();">${ASC.Projects.Resources.ProjectsCommonResource.Cancel}<\/a><\/div>');jQuery.template("projects_common_action",'<div class="block-cnt-splitter titlePanel requiredField"><span class="requiredErrorText title">${title.error}<\/span><div class="headerPanelSmall">${title.header}:<\/div><input class="textEdit" maxlength="250"/><\/div><div class="block-cnt-splitter"><div class="headerPanelSmall">${description}:<\/div><textarea cols="22" rows="3"><\/textarea><\/div><div class="block-cnt-splitter requiredField projectContaner"><span class="requiredErrorText">${project.error}<\/span><div class="headerPanelSmall">${project.header}:<\/div><div data-id="" class="link dotline advansed-select-container">${ASC.Projects.Resources.ProjectsCommonResource.Select}<\/div><\/div>');jQuery.template("projects_choose_responsible","<span class='chooseResponsible nobody'><span class='link dotline'>${ASC.Projects.Resources.ProjectsJSResource.ChooseResponsible}<\/span><\/span>");
jQuery.template("projects_commonWarning",'{{each notes}}<p>${$value}<\/p>{{/each}}<div class="errorBox display-none"><\/div><div class="middle-button-container"><a class="button blue middle">${okButton}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle cancel">${ASC.Projects.Resources.ProjectsCommonResource.Cancel}<\/a><\/div>');jQuery.template("projects_editTimerPopup",'<div id="TimeLogTaskTitle" class="header-base block-cnt-splitter"><\/div><div class="addLogPanel-infoPanel"><div class="addLogPanel-infoPanelBody"><span class="header-base gray-text">${ASC.Projects.Resources.ProjectsCommonResource.SpentTotally}<\/span><span class="splitter-buttons"><\/span><span id="TotalHoursCount" class="header-base"><\/span><span class="splitter-buttons"><\/span><\/div><\/div><div class="warnBox" style="display:none;" id="timeTrakingErrorPanel"><\/div><div class="block-cnt-splitter" style="float:right"><div class="headerPanelSmall"><b>${ASC.Projects.Resources.TaskResource.TaskResponsible}:<\/b><\/div><select style="width: 220px;" class="comboBox pm-report-select" id="teamList"><\/select><\/div><div><div class="block-cnt-splitter" style="float:left;margin-right:20px"><div class="headerPanelSmall"><b>${ASC.Projects.Resources.ProjectsCommonResource.Time}:<\/b><\/div><input id="inputTimeHours" type="text" placeholder="${ASC.Projects.Resources.ProjectsCommonResource.WatermarkHours}" class="textEdit" maxlength="2" /><span class="splitter">:<\/span><input id="inputTimeMinutes" type="text" placeholder="${ASC.Projects.Resources.ProjectsCommonResource.WatermarkMinutes}" class="textEdit" maxlength="2" /><\/div><div class="block-cnt-splitter"><div class="headerPanelSmall"><b>${ASC.Projects.Resources.ProjectsCommonResource.Date}:<\/b><\/div><input id="timeTrakingDate" class="textEditCalendar" style="margin-right: 3px"/><\/div><\/div><div style="clear:both"><\/div><div class="block-cnt-splitter"><div class="headerPanelSmall"><b>${ASC.Projects.Resources.ProjectResource.ProjectDescription}:<\/b><\/div><textarea id="timeDescription" rows="7" cols="20" maxlength="250"><\/textarea><\/div><div class="middle-button-container"><a href="javascript:void(0)" class="button blue middle">${ASC.Projects.Resources.ProjectsCommonResource.SaveChanges}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle" href="javascript:void(0)" onclick="javascript: jq.unblockUI();">${ASC.Projects.Resources.ProjectsCommonResource.Cancel}<\/a><\/div>');
jQuery.template("projects_reportFilterList","{{if radio.length}}<div class=\"filter-option-container\">{{each radio}}        {{tmpl($item.data.radio[$index]) 'projects_reportFilterRadio'}}        {{/each}}<\/div>{{/if}}    {{each combo}}    {{tmpl($item.data.combo[$index]) 'projects_reportFilterCombo'}}    {{/each}}    {{each check}}    {{tmpl($item.data.check[$index]) 'projects_reportFilterCheck'}}    {{/each}}    {{each checkcombo}}    {{tmpl($item.data.checkcombo[$index]) 'projects_reportFilterCombo'}}    {{/each}}");jQuery.template("projects_reportFilterCombo",'<div class="filter-item-container {{if hidden}} display-none {{/if}}">{{if describe.length }}<span class="describe-text">${describe}:<\/span><span class="splitter"><\/span>{{/if}}<span id="${id}" class="link dotline">${defaultText}<\/span><\/div>');jQuery.template("projects_reportFilterRadio",'<input id="${id}" name="${name}" {{if checked}} checked="checked" {{/if}} value="${value}" type="radio"><label for="${id}">${describe}<\/label><span class="splitter"><\/span>');jQuery.template("projects_reportFilterCheck",'<div class="filter-item-container {{if hidden}} display-none {{/if}} {{if withcombo}} with-combo {{/if}}"><input id="${id}" {{if checked}} checked="checked" {{/if}} type="checkbox"><label for="${id}">${describe}<\/label><\/div>');
jQuery.template("projects_action_create",'<div id="pageHeader"><div class="pageTitle">${pageTitle}<\/div><div style="clear: both"><\/div><\/div>{{if showTemplates }}<div id="templateContainer" class="block-cnt-splitter"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.SelectProjectTemplate}<\/div><span id="templateSelect" data-id="" class="link dotline advansed-select-container">${ASC.Projects.Resources.ProjectsCommonResource.Select}<\/span><\/div>{{/if}}<div id="projectTitleContainer" class="block-cnt-splitter requiredField"><span class="requiredErrorText">${ASC.Projects.Resources.ProjectsJSResource.EmptyProjectTitle}<\/span><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.ProjectTitle}<\/div><div class="inputTitleContainer" style="width: 100%"><input ID="projectTitle" class="textEdit" type="text" value="${project.title}" maxlength="250"/><\/div><div style="clear: both;"><\/div><\/div><div class="popup_helper" id="AnswerForFollowProject"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.ProjectsCommonResource.HelpAnswerFollowProject), "<br/>", "<b>", "<\/b>")}}<\/p><\/div><div id="projectDescriptionContainer" class="block-cnt-splitter"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.ProjectDescription}<\/div><div class="dottedHeaderContent"><textarea ID="projectDescription" style="width: 100%" rows="6">${project.description}<\/textarea><\/div><\/div><div id="projectManagerContainer" class="block-cnt-splitter requiredField"><span class="requiredErrorText">${ASC.Projects.Resources.ProjectsJSResource.EmptyProjectManager}<\/span><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.ProjectLeader}<\/div><div><span id="projectManagerSelector" data-id="${project.manager.id}" class="link dotline">${project.manager.name}<\/span><\/div>{{if !hideChooseTeam}}<div class="notifyManagerContainer"><input id="notifyManagerCheckbox" type="checkbox"/><label for="notifyManagerCheckbox">${ASC.Projects.Resources.ProjectResource.NotifyProjectManager}<\/label><\/div>{{/if}}<div style="clear: both;"><\/div><\/div><div id="projectTeamContainer" class="block-cnt-splitter {{if hideChooseTeam}} display-none{{/if}}"><div class="headerPanelSmall clearFix"><div class="float-left">${ASC.Projects.Resources.ProjectResource.ProjectTeam}<\/div><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForProjectTeam\' });" title="${ASC.Projects.Resources.ProjectsCommonResource.HelpQuestionProjectTeam}"><\/div><div class="popup_helper" id="AnswerForProjectTeam"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.ProjectsCommonResource.HelpAnswerProjectTeam), "<br/>", "<b>", "<\/b>")}}<br/>{{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.ProjectsCommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><\/div><div><span id="projectTeamSelector" class="link dotline plus">${ASC.Projects.Resources.ProjectResource.ManagmentTeam}<\/span><\/div><div id="projectParticipantsContainer" class="items-display-list"><\/div><input type="hidden" id="projectParticipants"/><\/div>{{if showTemplates }}    {{tmpl \'projects_action_template\'}}    {{/if}}    {{if IsProjectCreatedFromCrm}}<div id="projectContactsContainer"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectsCommonResource.ProjectLinkedWithContacts}<\/div><div class="no-linked-contacts">${ASC.Projects.Resources.ProjectsCommonResource.NoCRMContactsForLink}<\/div><div id="contactListBox"><table id="contactTable" class="table-list padding4"><tbody><\/tbody><\/table><\/div><\/div>{{/if}}    {{if typeof project.status !== "undefined" }}<div id="projectStatusContainer"><div class="headerPanelSmall clearFix"><div class="float-left">${ASC.Projects.Resources.ProjectResource.ProjectStatus}<\/div><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForProjectStatus\' });" title="${ASC.Projects.Resources.ProjectsCommonResource.HelpQuestionProjectStatus}"><\/div><div class="popup_helper" id="AnswerForProjectStatus"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.ProjectsCommonResource.HelpAnswerProjectStatus), "<br/>", "<b>", "<\/b>")}}<\/p><\/div><\/div><span id="projectStatus" class="link dotline" data-id="${project.status.id}">${project.status.title}<\/span><\/div>{{/if}}<div id="projectTagsContainer" class="dottedHeader"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectResource.Tags}<\/div><div class="dottedHeaderContent"><span id="tags" class="link dotline">${ASC.Projects.Resources.ProjectResource.SelectTags}<\/span><span id="tagsContainer">${project.tags}<\/span><\/div><\/div>{{if !IsPrivateDisabled}}<div id="projectVisibilityContainer"><div class="headerPanelSmall clearFix"><div class="popup_helper" id="AnswerForPrivateProject"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.ProjectsCommonResource.HelpAnswerPrivateProject), "<br/>", "<b>", "<\/b>")}}<br/>{{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.ProjectsCommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><\/div><div class="checkboxContainer"><input id="projectPrivacyCkeckbox" type="checkbox" {{if project.private}}checked{{/if}}/><label for="projectPrivacyCkeckbox">${ASC.Projects.Resources.ProjectResource.IUnerstandForEditHidden}<\/label><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForPrivateProject\' });" title="${ASC.Projects.Resources.ProjectsCommonResource.HelpQuestionPrivateProject}"><\/div><\/div><\/div>{{/if}}    {{if typeof project.status === "undefined" && !hideChooseTeam}}<div class="checkboxContainer"><input id="followingProjectCheckbox" type="checkbox"/><label for="followingProjectCheckbox">${ASC.Projects.Resources.ProjectResource.FollowingProjects}<\/label><div class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'AnswerForFollowProject\' });" title="${ASC.Projects.Resources.ProjectsCommonResource.HelpQuestionFollowProject}"><\/div><\/div><div class="checkboxContainer"><input id="notifyProjectCheckbox" type="checkbox" disabled="disabled"/><label for="notifyProjectCheckbox">${ASC.Projects.Resources.ProjectTemplatesResource.NotifyResponsibles}<\/label><\/div>{{/if}}<div id="projectActionsContainer" class="big-button-container"><a id="projectActionButton" class="button blue big">${actionButton}<\/a><span class="splitter-buttons"><\/span>{{if project.url}}<a id="cancelEditProject" href="${project.url}" class="button gray big">${ASC.Projects.Resources.ProjectsCommonResource.Cancel}<\/a><span class="splitter-buttons"><\/span>{{if project.canDelete}}<a id="projectDeleteButton" class="button gray big">${ASC.Projects.Resources.ProjectResource.ProjectDeleted}<\/a>{{/if}}        {{else}}<a id="cancelEditProject" class="button gray big">${ASC.Projects.Resources.ProjectsCommonResource.Cancel}<\/a>{{/if}}<\/div>');jQuery.template("projects_action_template",'<div class="display-none"><p id="milestoneError">${ASC.Projects.Resources.ProjectTemplatesResource.MilestoneError}<\/p><p id="taskError">${ASC.Projects.Resources.ProjectTemplatesResource.TaskError}<\/p><\/div><div class="block-cnt-splitter"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectTemplatesResource.EditProjStructure}<\/div><div id="listAddedMilestone"><\/div><div id="addMilestone"><a class="link dotline plus">${ASC.Projects.Resources.ProjectResource.AddMilestone}<\/a><\/div><p class="unlocatedTaskTitle">${ASC.Projects.Resources.ProjectTemplatesResource.TasksWithoutMilestone}<\/p><div id="noAssignTaskContainer"><div id="listNoAssignListTask"><\/div><div class="addTaskContainer"><a class="link dotline plus">${ASC.Projects.Resources.ProjectResource.AddTask}<\/a><\/div><\/div><div id="addMilestoneContainer" target=""><div>{{if edit}}<select><option selected="selected" duration="0.5" value=\'${ASC.Projects.Common.chooseMonthNumeralCase(0.5)}\'>${ASC.Projects.Common.chooseMonthNumeralCase(0.5)}<\/option>{{each month}}<option duration="${$value}" value=\'${ASC.Projects.Common.chooseMonthNumeralCase($value)}\'>${ASC.Projects.Common.chooseMonthNumeralCase($value)}<\/option>{{/each}}<\/select>{{else}}<input class="textEditCalendar" id="dueDate" type="text" autocomplete="off" />{{/if}}<input id="newMilestoneTitle" type="text" placeholder="${ASC.Projects.Resources.ProjectTemplatesResource.AddMilestoneTitle}" maxlength="250" /><\/div><div><a class="button gray">${ASC.Projects.Resources.ProjectResource.OkButton}<\/a><\/div><\/div><div id="addTaskContainer" target=""><div><input id="newTaskTitle" type="text" placeholder="${ASC.Projects.Resources.ProjectTemplatesResource.AddTaskTitle}" maxlength="250" /><\/div><div><a class="button gray">${ASC.Projects.Resources.ProjectResource.OkButton}<\/a><\/div><\/div><div id="taskActionPanel" class="studio-action-panel"><ul class="actionList dropdown-content"><li id="editTask" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.Edit}<\/li><li id="removeTask" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.Delete}<\/li><\/ul><\/div><div id="milestoneActions" class="studio-action-panel"><ul class="actionList dropdown-content"><li id="editMilestone" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.Edit}<\/li><li id="addTaskInMilestone" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.AddTask}<\/li><li id="removeMilestone" class="dropdown-item">${ASC.Projects.Resources.ProjectTemplatesResource.Delete}<\/li><\/ul><\/div><div id="projectMemberPanel" class="studio-action-panel"><ul class="dropdown-content actionList" nobodyitemtext="${ASC.Projects.Resources.ProjectTemplatesResource.NoResponsible}" chooseresptext="${ASC.Projects.Resources.ProjectTemplatesResource.ChooseResponsible}" class="actionList"><\/ul><\/div><\/div>');
jQuery.template("projects_settings",'{{if ASC.Projects.Master.IsModuleAdmin}}<span class="header-base">${ASC.Projects.Resources.ProjectsCommonResource.CommonSettings}<\/span><div class="settings-box"><input id="cbxEnableSettings" class="on-off-checkbox" {{if everebodyCanCreate}}checked="checked"{{/if}} type="checkbox"><label for="cbxEnableSettings">${ASC.Projects.Resources.ProjectsCommonResource.SettingsWhoCanCreateProject}<\/label><\/div><div class="settings-box"><input id="cbxHideSettings" class="on-off-checkbox" {{if hideEntitiesInPausedProjects}} checked="checked"{{/if}} type="checkbox"><label for="cbxHideSettings">${ASC.Projects.Resources.ProjectsCommonResource.HideEntitiesInPausedProjects}<\/label><\/div>{{/if}}<div {{if ASC.Projects.Master.IsModuleAdmin}} class="settings-box" {{/if}}><span class="header-base">${ASC.Projects.Resources.ProjectsCommonResource.PersonalSettings}<\/span><div class="settings-box"><div class="header-base-small headerPanelSmall">${ASC.Projects.Resources.ProjectsCommonResource.StartPage}<\/div><span id="startModule" class="top-align link dotline">${startModuleTitle}<\/span><\/div>{{if !Teamlab.profile.isVisitor}}<div class="settings-box folderSelectorBox"><div class="header-base-small headerPanelSmall">${ASC.Projects.Resources.ProjectsCommonResource.ReportFolder}<\/div><input type="text" class="folderSelector textEdit" readonly="readonly"/><div class="button gray middle">${ASC.Resources.Master.TemplateResource.Choose}<\/div><\/div>{{/if}}<\/div>');jQuery.template("projects_settings_custom_statuses_box",'<div>${ASC.Projects.Resources.ProjectsCommonResource.CustomStatusDescriptionBox}<\/div><div class="settings-box"><a id="newStatus" class="button gray"><span class="plus">${ASC.Projects.Resources.ProjectsCommonResource.CustomStatusNew}<\/span><\/a>{{each customStatuses}}        {{tmpl($item.data.customStatuses[$index]) \'projects_settings_custom_statuses\'}}        {{/each}}<\/div>');jQuery.template("projects_settings_custom_statuses",'<div class="custom-status" data-type="${id}"><div class="header-base-small headerPanelSmall">${title}<\/div>{{if state.can}}<div class="settings-box"><input id="cbxAvailable${id}" class="on-off-checkbox" {{if state.on}} checked="checked" {{/if}} {{if !state.enabled}} disabled="disabled" {{/if}} type="checkbox"><label for="cbxAvailable${id}">${ASC.Projects.Resources.ProjectsCommonResource.ChangeCustomStatusAvailable}<\/label><\/div>{{/if}}<div class="settings-box">{{each $item.data.sub}}        {{tmpl($item.data.sub[$index]) \'projects_settings_custom_status\'}}        {{/each}}<\/div><\/div>');jQuery.template("projects_settings_custom_status",'<div class="grid-page" data-id="${id}"><div class="sort_drag_handle borderBase">&nbsp;<\/div><div><img src="data:${imageType};base64,${image}"/><\/div><div><span>${title}<\/span><\/div><div><span>${description}<\/span><\/div><div class="with-entity-menu"><div class="entity-menu " title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/div><\/div><\/div>');jQuery.template("projects_settings_status_edit",'<div class="commonActionPanel"><div class="block-cnt-splitter"><div id="changeIcon"><img src="data:${imageType};base64,${image}"/><span class="baseLinkAction">${ASC.Projects.Resources.ProjectsCommonResource.ChangeIconCustomStatus}<\/span><\/div><div id="changeColor"><div style="background-color:${color}"><\/div><span class="baseLinkAction">${ASC.Projects.Resources.ProjectsCommonResource.ChangeColorCustomStatus}<\/span><\/div><\/div><div class="block-cnt-splitter titlePanel requiredField"><span class="requiredErrorText title">${ASC.Projects.Resources.ProjectsCommonResource.EmptyStatusTitle}<\/span><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectsCommonResource.CustomStatusTitle}:<\/div><input class="textEdit" maxlength="250" value="${title}"/><\/div><div class="block-cnt-splitter"><div class="headerPanelSmall">${ASC.Projects.Resources.ProjectsCommonResource.CustomStatusDescription}:<\/div><textarea cols="22" rows="3">${description}<\/textarea><\/div>{{if !isDefault }}<div class="block-cnt-splitter"><span>${ASC.Projects.Resources.ProjectsCommonResource.CustomStatusCategory}:<\/span><span id="changeCategory" class="baseLinkAction">${category}<\/span><\/div>{{/if}}<div class="errorBox display-none"><\/div><div class="middle-button-container"><a class="button blue middle">${ASC.Projects.Resources.ProjectsCommonResource.Save}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle cancel">${ASC.Projects.Resources.ProjectsCommonResource.Cancel}<\/a><\/div><\/div><div id="popup_iconPanel" class="studio-action-panel"><div>{{each ASC.Projects.Master.Settings.icons}}<img src="data:image/svg+xml;base64,${$value}"/>{{/each}}<div><input type="file" id="imageUpload" accept="image/svg+xml"/><a id="uploadButton" class="button gray">Upload<\/a><\/div><\/div><\/div><div id="popup_colorPanel" class="studio-action-panel"><div>{{each ASC.Projects.Master.Settings.colors}}<div style="background-color:${$value}"><\/div>{{/each}}<\/div><\/div><div id="popup_categoryPanel" class="studio-action-panel"><div>{{each ASC.Projects.Resources.Statuses}}<div data-id="${-ASC.Projects.Resources.Statuses[$index].id}">${ASC.Projects.Resources.Statuses[$index].title}<\/div>{{/each}}<\/div><\/div>');
jQuery.template("simpleContactTmpl",'<tr id="contactItem_${id}" {{if typeof showActionMenu !== "undefined" && showActionMenu === true}}class="with-entity-menu"{{/if}}><td style="width:40px;"><div class="contactItemPhotoImgContainer{{if isShared === true}} sharedContact{{/if}}">{{if isCompany == true}}<img class="contactItemPhotoImg" src="${ASC.CRM.Data.SmallSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${smallFotoUrl}\');" />{{else}}<img class="contactItemPhotoImg" src="${ASC.CRM.Data.SmallSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${smallFotoUrl}\');" />{{/if}}<img class="contactItemPhotoImg" style="display:none;" alt="${displayName}" title="${displayName}"/><\/div><\/td><td class="main-info-contact" style="width:50%;"><div class="contactTitle">{{if typeof(id)=="number"}}<a class="linkHeaderMedium" href="${contactLink}">${displayName}<\/a>{{else}}<span class="header-base-small">${displayName}<\/span>{{/if}}<\/div>{{if isCompany == false && typeof (company) != "undefined" && company != null && showCompanyLink}}<div class="contactTitle">${ASC.CRM.Resources.CRMContactResource.Company}:<a href="${company.contactLink}" data-id="${company.id}" id="contact_${id}_company_${company.id}" class="linkMedium crm-companyInfoCardLink">${company.displayName}<\/a><\/div>{{/if}}<\/td><td class="contact-info-contact"><div class="primaryDataContainer">{{each(i, item) commonData}}                    {{if item.infoType == 0 && item.isPrimary}}<span title="${item.data}">${item.data}<\/span>{{/if}}                {{/each}}<\/div><div class="primaryDataContainer">{{each(i, item) commonData}}                    {{if item.infoType == 1 && item.isPrimary}}<a title="${item.data}" href="mailto:${item.data}" class="linkMedium">${item.data}<\/a>{{/if}}                {{/each}}<\/div><\/td><td style="width:25px;">{{if typeof showActionMenu !== "undefined" && showActionMenu === true}}<div title="${ASC.CRM.Resources.CRMCommonResource.Actions}" class="entity-menu" id="simpleContactMenu_${id}"                    data-displayName="${displayName}"                     data-email="{{if primaryEmail !== null}}${primaryEmail.data}{{/if}}"                ><\/div>{{else typeof showUnlinkBtn !== "undefined" && showUnlinkBtn === true}}<img src="${StudioManager.GetImage(\'unlink_16.png\')}"               class="contact-info-link-img"               title="${ASC.CRM.Resources.CRMCommonResource.UnlinkContact}"               onclick=\'ASC.CRM.ListContactView.removeMember({{if typeof(id)=="number"}}${id}{{else}}"${id}"{{/if}});\'               id="trashImg_${id}" /><div id="loaderImg_${id}" class="loader-middle baseList_loaderImg"><\/div>{{/if}}<\/td><\/tr>');jQuery.template("simpleContactActionMenuTmpl",'<div id="simpleContactActionMenu" class="studio-action-panel"><ul class="dropdown-content"><li><a class="unlinkContact dropdown-item with-icon unlink">${ASC.CRM.Resources.CRMCommonResource.UnlinkContact}<\/a><\/li><li><a class="writeEmail dropdown-item with-icon email">${ASC.CRM.Resources.CRMContactResource.WriteEmail}<\/a><\/li><li><a class="viewMailingHistory dropdown-item with-icon history">${ASC.CRM.Resources.CRMCommonResource.ViewMailingHistoryWithParticipant}<\/a><\/li><\/ul><\/div>');
jQuery.template("contactSelectorContainerTmpl",'<div id="selector_${ObjName}"><div class="contactSelector-itemList"><\/div><\/div>');jQuery.template("contactSelectorRowTmpl",'<div id="item_${ObjID}" class="contactSelector-item">{{tmpl "contactSelectorContentTmpl"}}    {{if ShowOnlySelectorContent === false}}        {{tmpl "contactSelectorContactInfoContentTmpl"}}    {{/if}}    {{if ShowNewCompanyContent === true||ShowNewContactContent === true}}        {{tmpl "contactSelectorNewContactContentTmpl"}}    {{/if}}<\/div>');jQuery.template("contactSelectorContentTmpl",'<div id="selectorContent_${ObjID}" class="contactSelector-selectorContent" style="{{if ShowOnlySelectorContent===false&&selectedContact != null}}display:none;{{/if}}"><table cellspacing="0" cellpadding="1" class="contactSelector-inputContainer" width="100%" style="height: 18px;"><tbody><tr><td width="16px" class="borderBase" style="border-right: 0 none;"><label class="searchButton" id="searchImg_${ObjID}" onclick="window.${ObjName}.quickSearch(\'${ObjID}\');"><\/label><img align="absmiddle" id="loaderImg_${ObjID}" src="${StudioManager.GetImage(\'loader_16.gif\')}" style="display:none;"/><\/td><td class="borderBase" style="border-left: 0 none; border-right: 0 none;"><input type="text" id="contactTitle_${ObjID}" value="" class="textEdit" placeholder="${WatermarkText}" autocomplete="off"/><input type="hidden" id="contactID_${ObjID}" value="{{if selectedContact != null}}${selectedContact.id}{{/if}}"/><\/td><td width="16px" class="borderBase" style="border-left: 0 none;"><label class="crossButton" style="display:none;" onclick="window.${ObjName}.crossButtonEventClick(\'${ObjID}\');"                     title="${ASC.CRM.Resources.CRMCommonResource.Cancel}"><\/label><\/td>{{if ShowDeleteButton === true}}<td width="16px;"><a class="crm-deleteLink" title="${DeleteContactText}" onclick="window.${ObjName}.deleteContact(\'${ObjID}\');">&nbsp;<\/a><\/td>{{/if}}                {{if ShowAddButton === true}}<td width="16px;"><a title="${AddButtonText}" class="crm-addNewLink" onclick="window.${ObjName}.AddNewSelector(jq(this));">&nbsp;<\/a><\/td>{{/if}}<\/tr><\/tbody><\/table>{{tmpl "contactSelectorNoMatchesTmpl"}}<\/div>');jQuery.template("contactSelectorNoMatchesTmpl",'<div id="noMatches_${ObjID}" class="borderBase noMatches"><div>${ASC.CRM.Resources.CRMCommonResource.NoMatches}<\/div>{{if ShowNewCompanyContent === true}}<div><a class="link blue dotline small plus" onclick="window.${ObjName}.showNewCompany(\'${ObjID}\');">${ASC.CRM.Resources.CRMContactResource.AddNewCompany}<\/a><\/div>{{/if}}    {{if ShowNewContactContent === true}}<div><a class="link blue dotline small plus" onclick="window.${ObjName}.showNewContact(\'${ObjID}\');">${ASC.CRM.Resources.CRMContactResource.AddNewContact}<\/a><\/div>{{/if}}<\/div>');jQuery.template("contactSelectorContactInfoContentTmpl",'<div id="infoContent_${ObjID}" {{if selectedContact==null}}style="display: none;"{{/if}}><table width="100%" cellspacing="0" cellpadding="3"><tbody><tr>{{if ShowContactImg === true}}<td width="40px"><img src="{{if selectedContact != null}}${selectedContact.smallFotoUrl}{{/if}}" /><\/td>{{/if}}<td><span class="splitter"><b>{{if selectedContact != null}}${selectedContact.displayName}{{/if}}<\/b><\/span>{{if ShowChangeButton === true}}<a class="crm-removeLink" title="${ASC.CRM.Resources.CRMCommonResource.UnlinkContact}" onclick="window.${ObjName}.changeContact(\'${ObjID}\');">&nbsp;<\/a>{{/if}}                                        {{if ShowDeleteButton === true}}<a class="crm-deleteLink" title="${DeleteContactText}" onclick="window.${ObjName}.deleteContact(\'${ObjID}\');">&nbsp;<\/a>{{/if}}                    {{if ShowAddButton === true}}<a title="${AddButtonText}" class="crm-addNewLink" onclick="window.${ObjName}.AddNewSelector(jq(this));">&nbsp;<\/a>{{/if}}<\/td><\/tr><\/tbody><\/table><\/div>');jQuery.template("contactSelectorNewContactContentTmpl",'<div id="newContactContent_${ObjID}" style="display: none;"><table width="100%" cellspacing="0" cellpadding="3"><tbody><tr><td width="40px">{{if ShowNewCompanyContent === true}}<img id="newCompanyImg_${ObjID}" src="${ASC.CRM.Data.SmallSizePhotoCompany}" />{{/if}}                    {{if ShowNewContactContent === true}}<img id="newContactImg_${ObjID}" src="${ASC.CRM.Data.SmallSizePhoto}" style="display:none;"/>{{/if}}<input type="hidden" id="hiddenIsCompany_${ObjID}" /><\/td><td class="name-container-block"><span class="splitter">{{if ShowNewCompanyContent === true}}<input type="text" id="newCompanyTitle_${ObjID}" class="textEdit" placeholder="${ASC.CRM.Resources.CRMContactResource.CompanyName}" autocomplete="off"/>{{/if}}                    {{if ShowNewContactContent === true}}<input type="text" id="newContactFirstName_${ObjID}" class="textEdit" placeholder="${ASC.CRM.Resources.CRMContactResource.FirstName}" autocomplete="off" style="display:none;"/><span class="splitter"><\/span><input type="text" id="newContactLastName_${ObjID}" class="textEdit" placeholder="${ASC.CRM.Resources.CRMContactResource.LastName}" autocomplete="off" style="display:none;"/>{{/if}}<\/span><a class="crm-acceptLink" title="${ASC.CRM.Resources.CRMCommonResource.Add}" onclick="window.${ObjName}.acceptNewContact(\'${ObjID}\');">&nbsp;<\/a><a class="crm-rejectLink" title="${ASC.CRM.Resources.CRMCommonResource.Cancel}" onclick="window.${ObjName}.rejectNewContact(\'${ObjID}\');">&nbsp;<\/a>{{if ShowAddButton === true}}<a title="${AddButtonText}" class="crm-addNewLink" onclick="window.${ObjName}.AddNewSelector(jq(this));">&nbsp;<\/a>{{/if}}<\/td><\/tr><\/tbody><\/table><\/div>');
jQuery.template("contactInfoCardResourcesTmpl",'<div id="contactInfoCardResources" class="display-none"        data-one="${ASC.CRM.Resources.CRMJSResource.OneContact}"        data-no="${ASC.CRM.Resources.CRMJSResource.NoContacts}"        data-many="${ASC.CRM.Resources.CRMJSResource.ManyContacts}"><\/div>');jQuery.template("contactInfoCardTmpl",'<div class="crm-contactInfoCard" id="contactInfoCard_${id}">{{if isPrivateForMe == false}}<a href="${contactLink}">{{if isCompany == true}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto;" src="${ASC.CRM.Data.MediumSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{else}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto;" src="${ASC.CRM.Data.MediumSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{/if}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto;display:none;" alt="${displayName}" title="${displayName}"/><\/a>{{else}}        {{if isCompany == true}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto 10px; float: left;" src="${ASC.CRM.Data.MediumSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{else}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto 10px; float: left;" src="${ASC.CRM.Data.MediumSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{/if}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto 10px; float: left;display:none;" alt="${displayName}" title="${displayName}"/>{{/if}}<div class="infoCardContent">{{if isPrivateForMe == true}}<label class="crm-private-lock"><\/label><span class="crm-task-title header-base-medium">${displayName}<\/span>{{else}}<a title="${displayName}" class="linkHeader" style="display: inline-block;                margin-bottom: 6px;text-decoration: underline;" href="${contactLink}">${displayName}<\/a>{{if isCompany == true && typeof(personsCount) != "undefined"}}<div class="personsCountString" style="margin-bottom: 6px;" data-one="${ASC.CRM.Resources.CRMJSResource.OneContact}" data-no="${ASC.CRM.Resources.CRMJSResource.NoContacts}" data-many="${ASC.CRM.Resources.CRMJSResource.ManyContacts}">{{if personsCount == 0}}                    ${jq("#contactInfoCardResources").attr("data-no")}                {{else personsCount == 1}}                    1 ${jq("#contactInfoCardResources").attr("data-one")}                {{else}}                    ${personsCount} ${jq("#contactInfoCardResources").attr("data-many")}                {{/if}}<\/div>{{else}}<div style="margin-bottom: 6px;">${title}<\/div>{{/if}}<ul>{{each(i, item) commonData}}                    {{if item.infoType == 1 && item.isPrimary}}<li><div class="crm-email"><a class="linkMedium" href="mailto:${item.data}">${item.data}<\/a>&nbsp;<span class="text-medium-describe">(${item.categoryName})<\/span><\/div><\/li>{{/if}}                    {{if item.infoType == 0 && item.isPrimary}}<li><div class="crm-phone">${item.data}&nbsp;<span class="text-medium-describe">(${item.categoryName})<\/span><\/div><\/li>{{/if}}                {{/each}}                {{if typeof (primaryAddress) != "undefined" && primaryAddress != null}}<li><div class="crm-address">{{html primaryAddress.Data}}&nbsp;<span class="text-medium-describe">(${primaryAddress.categoryName})<\/span><br/><a class="linkMedium" style="text-decoration: underline;" href="${primaryAddress.Href}" target="_blank">${ASC.CRM.Resources.CRMContactResource.ShowOnMap}<\/a><\/div><\/li>{{/if}}<\/ul>{{/if}}<\/div><\/div>');
(function(n){var t=ASC.Resources.Master.ResourceJS,i=Teamlab,r=function(t,i){this.$element=n(t);this.options=n.extend({},n.fn.projectadvancedSelector.defaults,i);this.init()};r.prototype=n.extend({},n.fn.advancedSelector.Constructor.prototype,{constructor:r,initCreationBlock:function(){var n=this,r={},u=[],f;r.newoptions=[{title:t.SelectorTitle,type:"input",tag:"title"},{title:t.SelectorManager,type:"select",tag:"manager"}];r.newbtn=t.CreateButton;n.displayAddItemBlock.call(n,r);f={employeeStatus:1,employeeType:1};i.getSimpleProfilesByFilter({},{before:function(){n.showLoaderSimpleSelector.call(n,"manager")},filter:f,success:function(r,f){for(var e=0,o=f.length;e<o;e++)f[e].id==i.profile.id?u.unshift({title:t.MeLabel,id:f[e].id}):u.push({title:f[e].displayName,id:f[e].id});n.initDataSimpleSelector.call(n,{tag:"manager",items:u});n.hideLoaderSimpleSelector.call(n,"manager")},error:function(n,t){toastr.error(t)}})},initAdvSelectorData:function(){},rewriteObjectItem:function(n){var t=this;t.items=n.map(function(n){return{id:n.id,title:n.title,description:n.description,isPrivate:n.isPrivate,responsible:n.responsible,deadline:n.deadline}});t.items=t.items.sort(t.options.sortMethod||SortData);t.showItemsListAdvSelector.call(t)},createNewItemFn:function(){var n=this,r=n.$advancedSelector.find(".advanced-selector-add-new-block"),e=r.find(".advanced-selector-btn-add"),u,f={title:r.find(".title input").val().trim(),responsibleid:r.find(".manager input").attr("data-id"),notify:!1,description:"",tags:"",private:!1};if(f.title||(n.showErrorField.call(n,{field:r.find(".title"),error:t.ProjectSelectorEmptyTitleError}),u=!0),f.responsibleid||(n.showErrorField.call(n,{field:r.find(".manager"),error:t.ProjectSelectorEmptyManagerError}),u=!0),!f.responsibleid&&r.find(".manager input").val()&&(n.showErrorField.call(n,{field:r.find(".manager"),error:t.ProjectSelectorNotPersonError}),u=!0),u){r.find(".error input").first().trigger("focus");return}i.addPrjProject({},f,{before:function(){n.displayLoadingBtn.call(n,{btn:e,text:t.LoadingProcessing})},error:function(t,i){n.showServerError.call(n,{field:e,error:i})},success:function(t,i){i=this.__responses[0];var r={id:i.id,title:i.title};n.actionsAfterCreateItem.call(n,{newitem:r,response:i})},after:function(){n.hideLoadingBtn.call(n,e)}})}});n.fn.projectadvancedSelector=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var f=n(this),u=f.data("projectadvancedSelector"),e=n.extend({},n.fn.projectadvancedSelector.defaults,f.data(),typeof t=="object"&&t);u||f.data("projectadvancedSelector",u=new r(this,e));typeof t=="string"&&u[t].apply(u,i)})};n.fn.projectadvancedSelector.defaults=n.extend({},n.fn.advancedSelector.defaults,{showme:!0,addtext:t.ProjectSelectorAddText,noresults:t.ProjectSelectorNoResult,noitems:t.ProjectSelectorNoItems,emptylist:t.ProjectSelectorEmptyList})})(jQuery);
ProgressDialog=function(){function w(i,r,u,o){if(!jq("#progressDialog").length){f=LoadingBanner;e=r;n=i;t=u;o&&o===1?r.append(jq.tmpl("progressBarTmpl",{header:n.header||"",percentage:n.percentage||0})):r.append(jq.tmpl("progressDialogTmpl",{header:n.header||"",footer:n.footer||""}));jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#progressDialog .actions-container.close").off("click").on("click",it);jq("#progressDialog").off("click").on("click",".progress-error",b);t!==null&&y()}}function b(){var n=jq(this).closest(".pd-row").index()+1;jq(this).helper({BlockHelperID:"progressDialogBodyTable tr:nth-child("+n+") .popup_helper",position:"fixed"})}function h(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%");n.next().text(t+"%")}function k(n,t){h("#progressDialog progress",n);jq("#progressDialog").find("#progressDialogHeader").text(t)}function c(){jq("#progressDialog").show()}function r(){clearTimeout(s);jq("#progressDialog").hide();jq("#progressDialogBodyTable tbody").empty()}function l(n){jq("#progressDialogHeader").text(n)}function d(n,t){function i(n){var t=new RegExp('[\t*+:"<>?|\\\\/]',"gim");return(n||"").trim().replace(t,"_")}jq("#"+t.id).length||(t.fileName=i(t.fileName),t.fileTypeCssClass=ASC.Files.Utility.getCssClassByFileTitle(t.fileName,!0),jq("#progressDialogBodyTable tbody").append(jq.tmpl(n,t)),jq("#progressDialogBodyTable").parent().scrollTo("#"+t.id))}function a(n,t){h("#"+n+" progress",t)}function g(n){jq("#"+n).removeClass("done").removeClass("error").addClass("started")}function nt(n,t){jq("#"+n).removeClass("started").removeClass("done").addClass("error").removeAttr("id").find(".popup_helper").text(t)}function tt(n,t){jq("#"+n).removeClass("started").removeClass("error").addClass("done").removeAttr("id").find(".linkMedium").attr("href",t)}function it(){if(t===null)return r();t.terminate?t.terminate({success:function(){u();r()},error:o}):r()}function rt(n){p();t.generate(n,{success:v,error:o})}function v(t,r){if(!r||typeof r.id=="undefined"||jq.isEmptyObject(r)){u();return}d("progressDialogRowTmpl",r);c();switch(r.status){case i.Queued:case i.Started:var f=typeof r.percentage!="undefined"?Math.round(r.percentage):r.status===i.Queued?10:60;l(f>0?n.progress.format(f):n.header);a(r.id,f);g(r.id);s=setTimeout(y,1600);break;case i.Done:case i.Failed:u();l(n.header);a(r.id,100);r.exception?(nt(r.id,r.exception),toastr.error(r.exception)):tt(r.id,r.fileUrl?r.fileUrl:ASC.Files.Utility.GetFileWebEditorUrl(r.fileId))}}function y(){p();t.status({success:v,error:o})}function o(n,t){u();toastr.error(t[0])}function p(){f.showLoaderBtn(e)}function u(){f.hideLoaderBtn(e)}var i={Queued:0,Started:1,Done:2,Failed:3},f,e,s,n,t;return{init:w,show:c,close:r,generate:rt,setProgress:k}}();
/*!
	Autosize 3.0.17
	license: MIT
	http://www.jacklmoore.com/autosize
*/
!function(n,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var i={exports:{}};t(i.exports,i);n.autosize=i.exports}}(this,function(n,t){"use strict";function f(n){function l(){var r=window.getComputedStyle(n,null);"vertical"===r.resize?n.style.resize="none":"both"===r.resize&&(n.style.resize="horizontal");i="content-box"===r.boxSizing?-(parseFloat(r.paddingTop)+parseFloat(r.paddingBottom)):parseFloat(r.borderTopWidth)+parseFloat(r.borderBottomWidth);isNaN(i)&&(i=0);t()}function f(t){var i=n.style.width;n.style.width="0px";n.offsetWidth;n.style.width=i;n.style.overflowY=t;e()}function a(n){for(var t=[];n&&n.parentNode&&n.parentNode instanceof Element;)n.parentNode.scrollTop&&t.push({node:n.parentNode,scrollTop:n.parentNode.scrollTop}),n=n.parentNode;return t}function e(){var u=n.style.height,f=a(n),t=document.documentElement&&document.documentElement.scrollTop,r;return n.style.height="auto",r=n.scrollHeight+i,0===n.scrollHeight?void(n.style.height=u):(n.style.height=r+"px",o=n.clientWidth,f.forEach(function(n){n.node.scrollTop=n.scrollTop}),void(t&&(document.documentElement.scrollTop=t)))}function t(){var u;e();var t=window.getComputedStyle(n,null),i=Math.round(parseFloat(t.height)),o=Math.round(parseFloat(n.style.height));(i!==o?"visible"!==t.overflowY&&f("visible"):"hidden"!==t.overflowY&&f("hidden"),s!==i)&&(s=i,u=r("autosize:resized"),n.dispatchEvent(u))}if(n&&n.nodeName&&"TEXTAREA"===n.nodeName&&!u.has(n)){var i=null,o=n.clientWidth,s=null,h=function(){n.clientWidth!==o&&t()},c=function(i){window.removeEventListener("resize",h,!1);n.removeEventListener("input",t,!1);n.removeEventListener("keyup",t,!1);n.removeEventListener("autosize:destroy",c,!1);n.removeEventListener("autosize:update",t,!1);u["delete"](n);Object.keys(i).forEach(function(t){n.style[t]=i[t]})}.bind(n,{height:n.style.height,resize:n.style.resize,overflowY:n.style.overflowY,overflowX:n.style.overflowX,wordWrap:n.style.wordWrap});n.addEventListener("autosize:destroy",c,!1);"onpropertychange"in n&&"oninput"in n&&n.addEventListener("keyup",t,!1);window.addEventListener("resize",h,!1);n.addEventListener("input",t,!1);n.addEventListener("autosize:update",t,!1);u.add(n);n.style.overflowX="hidden";n.style.wordWrap="break-word";l()}}function e(n){if(n&&n.nodeName&&"TEXTAREA"===n.nodeName){var t=r("autosize:destroy");n.dispatchEvent(t)}}function o(n){if(n&&n.nodeName&&"TEXTAREA"===n.nodeName){var t=r("autosize:update");n.dispatchEvent(t)}}var u="function"==typeof Set?new Set:function(){var n=[];return{has:function(t){return Boolean(n.indexOf(t)>-1)},add:function(t){n.push(t)},"delete":function(t){n.splice(n.indexOf(t),1)}}}(),r=function(n){return new Event(n)},i;try{new Event("test")}catch(s){r=function(n){var t=document.createEvent("Event");return t.initEvent(n,!0,!1),t}}i=null;"undefined"==typeof window||"function"!=typeof getComputedStyle?(i=function(n){return n},i.destroy=function(n){return n},i.update=function(n){return n}):(i=function(n,t){return n&&Array.prototype.forEach.call(n.length?n:[n],function(n){return f(n,t)}),n},i.destroy=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],e),n},i.update=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],o),n});t.exports=i});
!function(n){"use strict";"function"==typeof define&&define.amd?define(["jquery"],n):"undefined"!=typeof exports?module.exports=n(require("jquery")):n(jQuery)}(function(n){"use strict";var t=window.Slick||{};(t=function(){var t=0;return function(i,r){var f,u=this;u.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:n(i),appendDots:n(i),arrows:!0,asNavFor:null,prevArrow:'<button class="slick-prev" aria-label="Previous" type="button">Previous<\/button>',nextArrow:'<button class="slick-next" aria-label="Next" type="button">Next<\/button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(t,i){return n('<button type="button" />').text(i+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,focusOnChange:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3};u.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,scrolling:!1,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,swiping:!1,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1};n.extend(u,u.initials);u.activeBreakpoint=null;u.animType=null;u.animProp=null;u.breakpoints=[];u.breakpointSettings=[];u.cssTransitions=!1;u.focussed=!1;u.interrupted=!1;u.hidden="hidden";u.paused=!0;u.positionProp=null;u.respondTo=null;u.rowCount=1;u.shouldClick=!0;u.$slider=n(i);u.$slidesCache=null;u.transformType=null;u.transitionType=null;u.visibilityChange="visibilitychange";u.windowWidth=0;u.windowTimer=null;f=n(i).data("slick")||{};u.options=n.extend({},u.defaults,r,f);u.currentSlide=u.options.initialSlide;u.originalSettings=u.options;void 0!==document.mozHidden?(u.hidden="mozHidden",u.visibilityChange="mozvisibilitychange"):void 0!==document.webkitHidden&&(u.hidden="webkitHidden",u.visibilityChange="webkitvisibilitychange");u.autoPlay=n.proxy(u.autoPlay,u);u.autoPlayClear=n.proxy(u.autoPlayClear,u);u.autoPlayIterator=n.proxy(u.autoPlayIterator,u);u.changeSlide=n.proxy(u.changeSlide,u);u.clickHandler=n.proxy(u.clickHandler,u);u.selectHandler=n.proxy(u.selectHandler,u);u.setPosition=n.proxy(u.setPosition,u);u.swipeHandler=n.proxy(u.swipeHandler,u);u.dragHandler=n.proxy(u.dragHandler,u);u.keyHandler=n.proxy(u.keyHandler,u);u.instanceUid=t++;u.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/;u.registerBreakpoints();u.init(!0)}}()).prototype.activateADA=function(){this.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})};t.prototype.addSlide=t.prototype.slickAdd=function(t,i,r){var u=this;if("boolean"==typeof i)r=i,i=null;else if(i<0||i>=u.slideCount)return!1;u.unload();"number"==typeof i?0===i&&0===u.$slides.length?n(t).appendTo(u.$slideTrack):r?n(t).insertBefore(u.$slides.eq(i)):n(t).insertAfter(u.$slides.eq(i)):!0===r?n(t).prependTo(u.$slideTrack):n(t).appendTo(u.$slideTrack);u.$slides=u.$slideTrack.children(this.options.slide);u.$slideTrack.children(this.options.slide).detach();u.$slideTrack.append(u.$slides);u.$slides.each(function(t,i){n(i).attr("data-slick-index",t)});u.$slidesCache=u.$slides;u.reinit()};t.prototype.animateHeight=function(){var n=this,t;1===n.options.slidesToShow&&!0===n.options.adaptiveHeight&&!1===n.options.vertical&&(t=n.$slides.eq(n.currentSlide).outerHeight(!0),n.$list.animate({height:t},n.options.speed))};t.prototype.animateSlide=function(t,i){var u={},r=this;r.animateHeight();!0===r.options.rtl&&!1===r.options.vertical&&(t=-t);!1===r.transformsEnabled?!1===r.options.vertical?r.$slideTrack.animate({left:t},r.options.speed,r.options.easing,i):r.$slideTrack.animate({top:t},r.options.speed,r.options.easing,i):!1===r.cssTransitions?(!0===r.options.rtl&&(r.currentLeft=-r.currentLeft),n({animStart:r.currentLeft}).animate({animStart:t},{duration:r.options.speed,easing:r.options.easing,step:function(n){n=Math.ceil(n);!1===r.options.vertical?(u[r.animType]="translate("+n+"px, 0px)",r.$slideTrack.css(u)):(u[r.animType]="translate(0px,"+n+"px)",r.$slideTrack.css(u))},complete:function(){i&&i.call()}})):(r.applyTransition(),t=Math.ceil(t),u[r.animType]=!1===r.options.vertical?"translate3d("+t+"px, 0px, 0px)":"translate3d(0px,"+t+"px, 0px)",r.$slideTrack.css(u),i&&setTimeout(function(){r.disableTransition();i.call()},r.options.speed))};t.prototype.getNavTarget=function(){var i=this,t=i.options.asNavFor;return t&&null!==t&&(t=n(t).not(i.$slider)),t};t.prototype.asNavFor=function(t){var i=this.getNavTarget();null!==i&&"object"==typeof i&&i.each(function(){var i=n(this).slick("getSlick");i.unslicked||i.slideHandler(t,!0)})};t.prototype.applyTransition=function(n){var t=this,i={};i[t.transitionType]=!1===t.options.fade?t.transformType+" "+t.options.speed+"ms "+t.options.cssEase:"opacity "+t.options.speed+"ms "+t.options.cssEase;!1===t.options.fade?t.$slideTrack.css(i):t.$slides.eq(n).css(i)};t.prototype.autoPlay=function(){var n=this;n.autoPlayClear();n.slideCount>n.options.slidesToShow&&(n.autoPlayTimer=setInterval(n.autoPlayIterator,n.options.autoplaySpeed))};t.prototype.autoPlayClear=function(){var n=this;n.autoPlayTimer&&clearInterval(n.autoPlayTimer)};t.prototype.autoPlayIterator=function(){var n=this,t=n.currentSlide+n.options.slidesToScroll;n.paused||n.interrupted||n.focussed||(!1===n.options.infinite&&(1===n.direction&&n.currentSlide+1===n.slideCount-1?n.direction=0:0===n.direction&&(t=n.currentSlide-n.options.slidesToScroll,n.currentSlide-1==0&&(n.direction=1))),n.slideHandler(t))};t.prototype.buildArrows=function(){var t=this;!0===t.options.arrows&&(t.$prevArrow=n(t.options.prevArrow).addClass("slick-arrow"),t.$nextArrow=n(t.options.nextArrow).addClass("slick-arrow"),t.slideCount>t.options.slidesToShow?(t.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),t.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),t.htmlExpr.test(t.options.prevArrow)&&t.$prevArrow.prependTo(t.options.appendArrows),t.htmlExpr.test(t.options.nextArrow)&&t.$nextArrow.appendTo(t.options.appendArrows),!0!==t.options.infinite&&t.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):t.$prevArrow.add(t.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))};t.prototype.buildDots=function(){var i,r,t=this;if(!0===t.options.dots){for(t.$slider.addClass("slick-dotted"),r=n("<ul />").addClass(t.options.dotsClass),i=0;i<=t.getDotCount();i+=1)r.append(n("<li />").append(t.options.customPaging.call(this,t,i)));t.$dots=r.appendTo(t.options.appendDots);t.$dots.find("li").first().addClass("slick-active")}};t.prototype.buildOut=function(){var t=this;t.$slides=t.$slider.children(t.options.slide+":not(.slick-cloned)").addClass("slick-slide");t.slideCount=t.$slides.length;t.$slides.each(function(t,i){n(i).attr("data-slick-index",t).data("originalStyling",n(i).attr("style")||"")});t.$slider.addClass("slick-slider");t.$slideTrack=0===t.slideCount?n('<div class="slick-track"/>').appendTo(t.$slider):t.$slides.wrapAll('<div class="slick-track"/>').parent();t.$list=t.$slideTrack.wrap('<div class="slick-list"/>').parent();t.$slideTrack.css("opacity",0);!0!==t.options.centerMode&&!0!==t.options.swipeToSlide||(t.options.slidesToScroll=1);n("img[data-lazy]",t.$slider).not("[src]").addClass("slick-loading");t.setupInfinite();t.buildArrows();t.buildDots();t.updateDots();t.setSlideClasses("number"==typeof t.currentSlide?t.currentSlide:0);!0===t.options.draggable&&t.$list.addClass("draggable")};t.prototype.buildRows=function(){var t,i,r,f,c,u,e,n=this,o,s,h;if(f=document.createDocumentFragment(),u=n.$slider.children(),n.options.rows>1){for(e=n.options.slidesPerRow*n.options.rows,c=Math.ceil(u.length/e),t=0;t<c;t++){for(o=document.createElement("div"),i=0;i<n.options.rows;i++){for(s=document.createElement("div"),r=0;r<n.options.slidesPerRow;r++)h=t*e+(i*n.options.slidesPerRow+r),u.get(h)&&s.appendChild(u.get(h));o.appendChild(s)}f.appendChild(o)}n.$slider.empty().append(f);n.$slider.children().children().children().css({width:100/n.options.slidesPerRow+"%",display:"inline-block"})}};t.prototype.checkResponsive=function(t,i){var f,u,e,r=this,o=!1,s=r.$slider.width(),h=window.innerWidth||n(window).width();if("window"===r.respondTo?e=h:"slider"===r.respondTo?e=s:"min"===r.respondTo&&(e=Math.min(h,s)),r.options.responsive&&r.options.responsive.length&&null!==r.options.responsive){u=null;for(f in r.breakpoints)r.breakpoints.hasOwnProperty(f)&&(!1===r.originalSettings.mobileFirst?e<r.breakpoints[f]&&(u=r.breakpoints[f]):e>r.breakpoints[f]&&(u=r.breakpoints[f]));null!==u?null!==r.activeBreakpoint?(u!==r.activeBreakpoint||i)&&(r.activeBreakpoint=u,"unslick"===r.breakpointSettings[u]?r.unslick(u):(r.options=n.extend({},r.originalSettings,r.breakpointSettings[u]),!0===t&&(r.currentSlide=r.options.initialSlide),r.refresh(t)),o=u):(r.activeBreakpoint=u,"unslick"===r.breakpointSettings[u]?r.unslick(u):(r.options=n.extend({},r.originalSettings,r.breakpointSettings[u]),!0===t&&(r.currentSlide=r.options.initialSlide),r.refresh(t)),o=u):null!==r.activeBreakpoint&&(r.activeBreakpoint=null,r.options=r.originalSettings,!0===t&&(r.currentSlide=r.options.initialSlide),r.refresh(t),o=u);t||!1===o||r.$slider.trigger("breakpoint",[r,o])}};t.prototype.changeSlide=function(t,i){var f,e,o,r=this,u=n(t.currentTarget),s;switch(u.is("a")&&t.preventDefault(),u.is("li")||(u=u.closest("li")),o=r.slideCount%r.options.slidesToScroll!=0,f=o?0:(r.slideCount-r.currentSlide)%r.options.slidesToScroll,t.data.message){case"previous":e=0===f?r.options.slidesToScroll:r.options.slidesToShow-f;r.slideCount>r.options.slidesToShow&&r.slideHandler(r.currentSlide-e,!1,i);break;case"next":e=0===f?r.options.slidesToScroll:f;r.slideCount>r.options.slidesToShow&&r.slideHandler(r.currentSlide+e,!1,i);break;case"index":s=0===t.data.index?0:t.data.index||u.index()*r.options.slidesToScroll;r.slideHandler(r.checkNavigable(s),!1,i);u.children().trigger("focus");break;default:return}};t.prototype.checkNavigable=function(n){var t,i,r;if(t=this.getNavigableIndexes(),i=0,n>t[t.length-1])n=t[t.length-1];else for(r in t){if(n<t[r]){n=i;break}i=t[r]}return n};t.prototype.cleanUpEvents=function(){var t=this;t.options.dots&&null!==t.$dots&&(n("li",t.$dots).off("click.slick",t.changeSlide).off("mouseenter.slick",n.proxy(t.interrupt,t,!0)).off("mouseleave.slick",n.proxy(t.interrupt,t,!1)),!0===t.options.accessibility&&t.$dots.off("keydown.slick",t.keyHandler));t.$slider.off("focus.slick blur.slick");!0===t.options.arrows&&t.slideCount>t.options.slidesToShow&&(t.$prevArrow&&t.$prevArrow.off("click.slick",t.changeSlide),t.$nextArrow&&t.$nextArrow.off("click.slick",t.changeSlide),!0===t.options.accessibility&&(t.$prevArrow&&t.$prevArrow.off("keydown.slick",t.keyHandler),t.$nextArrow&&t.$nextArrow.off("keydown.slick",t.keyHandler)));t.$list.off("touchstart.slick mousedown.slick",t.swipeHandler);t.$list.off("touchmove.slick mousemove.slick",t.swipeHandler);t.$list.off("touchend.slick mouseup.slick",t.swipeHandler);t.$list.off("touchcancel.slick mouseleave.slick",t.swipeHandler);t.$list.off("click.slick",t.clickHandler);n(document).off(t.visibilityChange,t.visibility);t.cleanUpSlideEvents();!0===t.options.accessibility&&t.$list.off("keydown.slick",t.keyHandler);!0===t.options.focusOnSelect&&n(t.$slideTrack).children().off("click.slick",t.selectHandler);n(window).off("orientationchange.slick.slick-"+t.instanceUid,t.orientationChange);n(window).off("resize.slick.slick-"+t.instanceUid,t.resize);n("[draggable!=true]",t.$slideTrack).off("dragstart",t.preventDefault);n(window).off("load.slick.slick-"+t.instanceUid,t.setPosition)};t.prototype.cleanUpSlideEvents=function(){var t=this;t.$list.off("mouseenter.slick",n.proxy(t.interrupt,t,!0));t.$list.off("mouseleave.slick",n.proxy(t.interrupt,t,!1))};t.prototype.cleanUpRows=function(){var t,n=this;n.options.rows>1&&((t=n.$slides.children().children()).removeAttr("style"),n.$slider.empty().append(t))};t.prototype.clickHandler=function(n){!1===this.shouldClick&&(n.stopImmediatePropagation(),n.stopPropagation(),n.preventDefault())};t.prototype.destroy=function(t){var i=this;i.autoPlayClear();i.touchObject={};i.cleanUpEvents();n(".slick-cloned",i.$slider).detach();i.$dots&&i.$dots.remove();i.$prevArrow&&i.$prevArrow.length&&(i.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),i.htmlExpr.test(i.options.prevArrow)&&i.$prevArrow.remove());i.$nextArrow&&i.$nextArrow.length&&(i.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),i.htmlExpr.test(i.options.nextArrow)&&i.$nextArrow.remove());i.$slides&&(i.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){n(this).attr("style",n(this).data("originalStyling"))}),i.$slideTrack.children(this.options.slide).detach(),i.$slideTrack.detach(),i.$list.detach(),i.$slider.append(i.$slides));i.cleanUpRows();i.$slider.removeClass("slick-slider");i.$slider.removeClass("slick-initialized");i.$slider.removeClass("slick-dotted");i.unslicked=!0;t||i.$slider.trigger("destroy",[i])};t.prototype.disableTransition=function(n){var t=this,i={};i[t.transitionType]="";!1===t.options.fade?t.$slideTrack.css(i):t.$slides.eq(n).css(i)};t.prototype.fadeSlide=function(n,t){var i=this;!1===i.cssTransitions?(i.$slides.eq(n).css({zIndex:i.options.zIndex}),i.$slides.eq(n).animate({opacity:1},i.options.speed,i.options.easing,t)):(i.applyTransition(n),i.$slides.eq(n).css({opacity:1,zIndex:i.options.zIndex}),t&&setTimeout(function(){i.disableTransition(n);t.call()},i.options.speed))};t.prototype.fadeSlideOut=function(n){var t=this;!1===t.cssTransitions?t.$slides.eq(n).animate({opacity:0,zIndex:t.options.zIndex-2},t.options.speed,t.options.easing):(t.applyTransition(n),t.$slides.eq(n).css({opacity:0,zIndex:t.options.zIndex-2}))};t.prototype.filterSlides=t.prototype.slickFilter=function(n){var t=this;null!==n&&(t.$slidesCache=t.$slides,t.unload(),t.$slideTrack.children(this.options.slide).detach(),t.$slidesCache.filter(n).appendTo(t.$slideTrack),t.reinit())};t.prototype.focusHandler=function(){var t=this;t.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*",function(i){i.stopImmediatePropagation();var r=n(this);setTimeout(function(){t.options.pauseOnFocus&&(t.focussed=r.is(":focus"),t.autoPlay())},0)})};t.prototype.getCurrent=t.prototype.slickCurrentSlide=function(){return this.currentSlide};t.prototype.getDotCount=function(){var n=this,i=0,r=0,t=0;if(!0===n.options.infinite)if(n.slideCount<=n.options.slidesToShow)++t;else for(;i<n.slideCount;)++t,i=r+n.options.slidesToScroll,r+=n.options.slidesToScroll<=n.options.slidesToShow?n.options.slidesToScroll:n.options.slidesToShow;else if(!0===n.options.centerMode)t=n.slideCount;else if(n.options.asNavFor)for(;i<n.slideCount;)++t,i=r+n.options.slidesToScroll,r+=n.options.slidesToScroll<=n.options.slidesToShow?n.options.slidesToScroll:n.options.slidesToShow;else t=1+Math.ceil((n.slideCount-n.options.slidesToShow)/n.options.slidesToScroll);return t-1};t.prototype.getLeft=function(n){var f,r,i,e,t=this,u=0;return t.slideOffset=0,r=t.$slides.first().outerHeight(!0),!0===t.options.infinite?(t.slideCount>t.options.slidesToShow&&(t.slideOffset=t.slideWidth*t.options.slidesToShow*-1,e=-1,!0===t.options.vertical&&!0===t.options.centerMode&&(2===t.options.slidesToShow?e=-1.5:1===t.options.slidesToShow&&(e=-2)),u=r*t.options.slidesToShow*e),t.slideCount%t.options.slidesToScroll!=0&&n+t.options.slidesToScroll>t.slideCount&&t.slideCount>t.options.slidesToShow&&(n>t.slideCount?(t.slideOffset=(t.options.slidesToShow-(n-t.slideCount))*t.slideWidth*-1,u=(t.options.slidesToShow-(n-t.slideCount))*r*-1):(t.slideOffset=t.slideCount%t.options.slidesToScroll*t.slideWidth*-1,u=t.slideCount%t.options.slidesToScroll*r*-1))):n+t.options.slidesToShow>t.slideCount&&(t.slideOffset=(n+t.options.slidesToShow-t.slideCount)*t.slideWidth,u=(n+t.options.slidesToShow-t.slideCount)*r),t.slideCount<=t.options.slidesToShow&&(t.slideOffset=0,u=0),!0===t.options.centerMode&&t.slideCount<=t.options.slidesToShow?t.slideOffset=t.slideWidth*Math.floor(t.options.slidesToShow)/2-t.slideWidth*t.slideCount/2:!0===t.options.centerMode&&!0===t.options.infinite?t.slideOffset+=t.slideWidth*Math.floor(t.options.slidesToShow/2)-t.slideWidth:!0===t.options.centerMode&&(t.slideOffset=0,t.slideOffset+=t.slideWidth*Math.floor(t.options.slidesToShow/2)),f=!1===t.options.vertical?n*t.slideWidth*-1+t.slideOffset:n*r*-1+u,!0===t.options.variableWidth&&(i=t.slideCount<=t.options.slidesToShow||!1===t.options.infinite?t.$slideTrack.children(".slick-slide").eq(n):t.$slideTrack.children(".slick-slide").eq(n+t.options.slidesToShow),f=!0===t.options.rtl?i[0]?-1*(t.$slideTrack.width()-i[0].offsetLeft-i.width()):0:i[0]?-1*i[0].offsetLeft:0,!0===t.options.centerMode&&(i=t.slideCount<=t.options.slidesToShow||!1===t.options.infinite?t.$slideTrack.children(".slick-slide").eq(n):t.$slideTrack.children(".slick-slide").eq(n+t.options.slidesToShow+1),f=!0===t.options.rtl?i[0]?-1*(t.$slideTrack.width()-i[0].offsetLeft-i.width()):0:i[0]?-1*i[0].offsetLeft:0,f+=(t.$list.width()-i.outerWidth())/2)),f};t.prototype.getOption=t.prototype.slickGetOption=function(n){return this.options[n]};t.prototype.getNavigableIndexes=function(){var i,n=this,t=0,r=0,u=[];for(!1===n.options.infinite?i=n.slideCount:(t=-1*n.options.slidesToScroll,r=-1*n.options.slidesToScroll,i=2*n.slideCount);t<i;)u.push(t),t=r+n.options.slidesToScroll,r+=n.options.slidesToScroll<=n.options.slidesToShow?n.options.slidesToScroll:n.options.slidesToShow;return u};t.prototype.getSlick=function(){return this};t.prototype.getSlideCount=function(){var i,r,t=this;return r=!0===t.options.centerMode?t.slideWidth*Math.floor(t.options.slidesToShow/2):0,!0===t.options.swipeToSlide?(t.$slideTrack.find(".slick-slide").each(function(u,f){if(f.offsetLeft-r+n(f).outerWidth()/2>-1*t.swipeLeft)return i=f,!1}),Math.abs(n(i).attr("data-slick-index")-t.currentSlide)||1):t.options.slidesToScroll};t.prototype.goTo=t.prototype.slickGoTo=function(n,t){this.changeSlide({data:{message:"index",index:parseInt(n)}},t)};t.prototype.init=function(t){var i=this;n(i.$slider).hasClass("slick-initialized")||(n(i.$slider).addClass("slick-initialized"),i.buildRows(),i.buildOut(),i.setProps(),i.startLoad(),i.loadSlider(),i.initializeEvents(),i.updateArrows(),i.updateDots(),i.checkResponsive(!0),i.focusHandler());t&&i.$slider.trigger("init",[i]);!0===i.options.accessibility&&i.initADA();i.options.autoplay&&(i.paused=!1,i.autoPlay())};t.prototype.initADA=function(){var t=this,f=Math.ceil(t.slideCount/t.options.slidesToShow),r=t.getNavigableIndexes().filter(function(n){return n>=0&&n<t.slideCount}),i,u;for(t.$slides.add(t.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),null!==t.$dots&&(t.$slides.not(t.$slideTrack.find(".slick-cloned")).each(function(i){var u=r.indexOf(i);n(this).attr({role:"tabpanel",id:"slick-slide"+t.instanceUid+i,tabindex:-1});-1!==u&&n(this).attr({"aria-describedby":"slick-slide-control"+t.instanceUid+u})}),t.$dots.attr("role","tablist").find("li").each(function(i){var u=r[i];n(this).attr({role:"presentation"});n(this).find("button").first().attr({role:"tab",id:"slick-slide-control"+t.instanceUid+i,"aria-controls":"slick-slide"+t.instanceUid+u,"aria-label":i+1+" of "+f,"aria-selected":null,tabindex:"-1"})}).eq(t.currentSlide).find("button").attr({"aria-selected":"true",tabindex:"0"}).end()),i=t.currentSlide,u=i+t.options.slidesToShow;i<u;i++)t.$slides.eq(i).attr("tabindex",0);t.activateADA()};t.prototype.initArrowEvents=function(){var n=this;!0===n.options.arrows&&n.slideCount>n.options.slidesToShow&&(n.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},n.changeSlide),n.$nextArrow.off("click.slick").on("click.slick",{message:"next"},n.changeSlide),!0===n.options.accessibility&&(n.$prevArrow.on("keydown.slick",n.keyHandler),n.$nextArrow.on("keydown.slick",n.keyHandler)))};t.prototype.initDotEvents=function(){var t=this;!0===t.options.dots&&(n("li",t.$dots).on("click.slick",{message:"index"},t.changeSlide),!0===t.options.accessibility&&t.$dots.on("keydown.slick",t.keyHandler));!0===t.options.dots&&!0===t.options.pauseOnDotsHover&&n("li",t.$dots).on("mouseenter.slick",n.proxy(t.interrupt,t,!0)).on("mouseleave.slick",n.proxy(t.interrupt,t,!1))};t.prototype.initSlideEvents=function(){var t=this;t.options.pauseOnHover&&(t.$list.on("mouseenter.slick",n.proxy(t.interrupt,t,!0)),t.$list.on("mouseleave.slick",n.proxy(t.interrupt,t,!1)))};t.prototype.initializeEvents=function(){var t=this;t.initArrowEvents();t.initDotEvents();t.initSlideEvents();t.$list.on("touchstart.slick mousedown.slick",{action:"start"},t.swipeHandler);t.$list.on("touchmove.slick mousemove.slick",{action:"move"},t.swipeHandler);t.$list.on("touchend.slick mouseup.slick",{action:"end"},t.swipeHandler);t.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},t.swipeHandler);t.$list.on("click.slick",t.clickHandler);n(document).on(t.visibilityChange,n.proxy(t.visibility,t));!0===t.options.accessibility&&t.$list.on("keydown.slick",t.keyHandler);!0===t.options.focusOnSelect&&n(t.$slideTrack).children().on("click.slick",t.selectHandler);n(window).on("orientationchange.slick.slick-"+t.instanceUid,n.proxy(t.orientationChange,t));n(window).on("resize.slick.slick-"+t.instanceUid,n.proxy(t.resize,t));n("[draggable!=true]",t.$slideTrack).on("dragstart",t.preventDefault);n(window).on("load.slick.slick-"+t.instanceUid,t.setPosition);n(t.setPosition)};t.prototype.initUI=function(){var n=this;!0===n.options.arrows&&n.slideCount>n.options.slidesToShow&&(n.$prevArrow.show(),n.$nextArrow.show());!0===n.options.dots&&n.slideCount>n.options.slidesToShow&&n.$dots.show()};t.prototype.keyHandler=function(n){var t=this;n.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===n.keyCode&&!0===t.options.accessibility?t.changeSlide({data:{message:!0===t.options.rtl?"next":"previous"}}):39===n.keyCode&&!0===t.options.accessibility&&t.changeSlide({data:{message:!0===t.options.rtl?"previous":"next"}}))};t.prototype.lazyLoad=function(){function f(i){n("img[data-lazy]",i).each(function(){var i=n(this),r=n(this).attr("data-lazy"),f=n(this).attr("data-srcset"),e=n(this).attr("data-sizes")||t.$slider.attr("data-sizes"),u=document.createElement("img");u.onload=function(){i.animate({opacity:0},100,function(){f&&(i.attr("srcset",f),e&&i.attr("sizes",e));i.attr("src",r).animate({opacity:1},200,function(){i.removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading")});t.$slider.trigger("lazyLoaded",[t,i,r])})};u.onerror=function(){i.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error");t.$slider.trigger("lazyLoadError",[t,i,r])};u.src=r})}var u,i,r,t=this;if(!0===t.options.centerMode?!0===t.options.infinite?r=(i=t.currentSlide+(t.options.slidesToShow/2+1))+t.options.slidesToShow+2:(i=Math.max(0,t.currentSlide-(t.options.slidesToShow/2+1)),r=t.options.slidesToShow/2+1+2+t.currentSlide):(i=t.options.infinite?t.options.slidesToShow+t.currentSlide:t.currentSlide,r=Math.ceil(i+t.options.slidesToShow),!0===t.options.fade&&(i>0&&i--,r<=t.slideCount&&r++)),u=t.$slider.find(".slick-slide").slice(i,r),"anticipated"===t.options.lazyLoad)for(var e=i-1,o=r,s=t.$slider.find(".slick-slide"),h=0;h<t.options.slidesToScroll;h++)e<0&&(e=t.slideCount-1),u=(u=u.add(s.eq(e))).add(s.eq(o)),e--,o++;f(u);t.slideCount<=t.options.slidesToShow?f(t.$slider.find(".slick-slide")):t.currentSlide>=t.slideCount-t.options.slidesToShow?f(t.$slider.find(".slick-cloned").slice(0,t.options.slidesToShow)):0===t.currentSlide&&f(t.$slider.find(".slick-cloned").slice(-1*t.options.slidesToShow))};t.prototype.loadSlider=function(){var n=this;n.setPosition();n.$slideTrack.css({opacity:1});n.$slider.removeClass("slick-loading");n.initUI();"progressive"===n.options.lazyLoad&&n.progressiveLazyLoad()};t.prototype.next=t.prototype.slickNext=function(){this.changeSlide({data:{message:"next"}})};t.prototype.orientationChange=function(){var n=this;n.checkResponsive();n.setPosition()};t.prototype.pause=t.prototype.slickPause=function(){var n=this;n.autoPlayClear();n.paused=!0};t.prototype.play=t.prototype.slickPlay=function(){var n=this;n.autoPlay();n.options.autoplay=!0;n.paused=!1;n.focussed=!1;n.interrupted=!1};t.prototype.postSlide=function(t){var i=this;i.unslicked||(i.$slider.trigger("afterChange",[i,t]),i.animating=!1,i.slideCount>i.options.slidesToShow&&i.setPosition(),i.swipeLeft=null,i.options.autoplay&&i.autoPlay(),!0===i.options.accessibility&&(i.initADA(),i.options.focusOnChange&&n(i.$slides.get(i.currentSlide)).attr("tabindex",0).focus()))};t.prototype.prev=t.prototype.slickPrev=function(){this.changeSlide({data:{message:"previous"}})};t.prototype.preventDefault=function(n){n.preventDefault()};t.prototype.progressiveLazyLoad=function(t){t=t||1;var r,u,f,e,o,i=this,s=n("img[data-lazy]",i.$slider);s.length?(r=s.first(),u=r.attr("data-lazy"),f=r.attr("data-srcset"),e=r.attr("data-sizes")||i.$slider.attr("data-sizes"),(o=document.createElement("img")).onload=function(){f&&(r.attr("srcset",f),e&&r.attr("sizes",e));r.attr("src",u).removeAttr("data-lazy data-srcset data-sizes").removeClass("slick-loading");!0===i.options.adaptiveHeight&&i.setPosition();i.$slider.trigger("lazyLoaded",[i,r,u]);i.progressiveLazyLoad()},o.onerror=function(){t<3?setTimeout(function(){i.progressiveLazyLoad(t+1)},500):(r.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),i.$slider.trigger("lazyLoadError",[i,r,u]),i.progressiveLazyLoad())},o.src=u):i.$slider.trigger("allImagesLoaded",[i])};t.prototype.refresh=function(t){var r,u,i=this;u=i.slideCount-i.options.slidesToShow;!i.options.infinite&&i.currentSlide>u&&(i.currentSlide=u);i.slideCount<=i.options.slidesToShow&&(i.currentSlide=0);r=i.currentSlide;i.destroy(!0);n.extend(i,i.initials,{currentSlide:r});i.init();t||i.changeSlide({data:{message:"index",index:r}},!1)};t.prototype.registerBreakpoints=function(){var u,f,i,t=this,r=t.options.responsive||null;if("array"===n.type(r)&&r.length){t.respondTo=t.options.respondTo||"window";for(u in r)if(i=t.breakpoints.length-1,r.hasOwnProperty(u)){for(f=r[u].breakpoint;i>=0;)t.breakpoints[i]&&t.breakpoints[i]===f&&t.breakpoints.splice(i,1),i--;t.breakpoints.push(f);t.breakpointSettings[f]=r[u].settings}t.breakpoints.sort(function(n,i){return t.options.mobileFirst?n-i:i-n})}};t.prototype.reinit=function(){var t=this;t.$slides=t.$slideTrack.children(t.options.slide).addClass("slick-slide");t.slideCount=t.$slides.length;t.currentSlide>=t.slideCount&&0!==t.currentSlide&&(t.currentSlide=t.currentSlide-t.options.slidesToScroll);t.slideCount<=t.options.slidesToShow&&(t.currentSlide=0);t.registerBreakpoints();t.setProps();t.setupInfinite();t.buildArrows();t.updateArrows();t.initArrowEvents();t.buildDots();t.updateDots();t.initDotEvents();t.cleanUpSlideEvents();t.initSlideEvents();t.checkResponsive(!1,!0);!0===t.options.focusOnSelect&&n(t.$slideTrack).children().on("click.slick",t.selectHandler);t.setSlideClasses("number"==typeof t.currentSlide?t.currentSlide:0);t.setPosition();t.focusHandler();t.paused=!t.options.autoplay;t.autoPlay();t.$slider.trigger("reInit",[t])};t.prototype.resize=function(){var t=this;n(window).width()!==t.windowWidth&&(clearTimeout(t.windowDelay),t.windowDelay=window.setTimeout(function(){t.windowWidth=n(window).width();t.checkResponsive();t.unslicked||t.setPosition()},50))};t.prototype.removeSlide=t.prototype.slickRemove=function(n,t,i){var r=this;if(n="boolean"==typeof n?!0===(t=n)?0:r.slideCount-1:!0===t?--n:n,r.slideCount<1||n<0||n>r.slideCount-1)return!1;r.unload();!0===i?r.$slideTrack.children().remove():r.$slideTrack.children(this.options.slide).eq(n).remove();r.$slides=r.$slideTrack.children(this.options.slide);r.$slideTrack.children(this.options.slide).detach();r.$slideTrack.append(r.$slides);r.$slidesCache=r.$slides;r.reinit()};t.prototype.setCSS=function(n){var r,u,t=this,i={};!0===t.options.rtl&&(n=-n);r="left"==t.positionProp?Math.ceil(n)+"px":"0px";u="top"==t.positionProp?Math.ceil(n)+"px":"0px";i[t.positionProp]=n;!1===t.transformsEnabled?t.$slideTrack.css(i):(i={},!1===t.cssTransitions?(i[t.animType]="translate("+r+", "+u+")",t.$slideTrack.css(i)):(i[t.animType]="translate3d("+r+", "+u+", 0px)",t.$slideTrack.css(i)))};t.prototype.setDimensions=function(){var n=this,t;!1===n.options.vertical?!0===n.options.centerMode&&n.$list.css({padding:"0px "+n.options.centerPadding}):(n.$list.height(n.$slides.first().outerHeight(!0)*n.options.slidesToShow),!0===n.options.centerMode&&n.$list.css({padding:n.options.centerPadding+" 0px"}));n.listWidth=n.$list.width();n.listHeight=n.$list.height();!1===n.options.vertical&&!1===n.options.variableWidth?(n.slideWidth=Math.ceil(n.listWidth/n.options.slidesToShow),n.$slideTrack.width(Math.ceil(n.slideWidth*n.$slideTrack.children(".slick-slide").length))):!0===n.options.variableWidth?n.$slideTrack.width(5e3*n.slideCount):(n.slideWidth=Math.ceil(n.listWidth),n.$slideTrack.height(Math.ceil(n.$slides.first().outerHeight(!0)*n.$slideTrack.children(".slick-slide").length)));t=n.$slides.first().outerWidth(!0)-n.$slides.first().width();!1===n.options.variableWidth&&n.$slideTrack.children(".slick-slide").width(n.slideWidth-t)};t.prototype.setFade=function(){var i,t=this;t.$slides.each(function(r,u){i=t.slideWidth*r*-1;!0===t.options.rtl?n(u).css({position:"relative",right:i,top:0,zIndex:t.options.zIndex-2,opacity:0}):n(u).css({position:"relative",left:i,top:0,zIndex:t.options.zIndex-2,opacity:0})});t.$slides.eq(t.currentSlide).css({zIndex:t.options.zIndex-1,opacity:1})};t.prototype.setHeight=function(){var n=this,t;1===n.options.slidesToShow&&!0===n.options.adaptiveHeight&&!1===n.options.vertical&&(t=n.$slides.eq(n.currentSlide).outerHeight(!0),n.$list.css("height",t))};t.prototype.setOption=t.prototype.slickSetOption=function(){var u,f,e,i,r,t=this,o=!1;if("object"===n.type(arguments[0])?(e=arguments[0],o=arguments[1],r="multiple"):"string"===n.type(arguments[0])&&(e=arguments[0],i=arguments[1],o=arguments[2],"responsive"===arguments[0]&&"array"===n.type(arguments[1])?r="responsive":void 0!==arguments[1]&&(r="single")),"single"===r)t.options[e]=i;else if("multiple"===r)n.each(e,function(n,i){t.options[n]=i});else if("responsive"===r)for(f in i)if("array"!==n.type(t.options.responsive))t.options.responsive=[i[f]];else{for(u=t.options.responsive.length-1;u>=0;)t.options.responsive[u].breakpoint===i[f].breakpoint&&t.options.responsive.splice(u,1),u--;t.options.responsive.push(i[f])}o&&(t.unload(),t.reinit())};t.prototype.setPosition=function(){var n=this;n.setDimensions();n.setHeight();!1===n.options.fade?n.setCSS(n.getLeft(n.currentSlide)):n.setFade();n.$slider.trigger("setPosition",[n])};t.prototype.setProps=function(){var n=this,t=document.body.style;n.positionProp=!0===n.options.vertical?"top":"left";"top"===n.positionProp?n.$slider.addClass("slick-vertical"):n.$slider.removeClass("slick-vertical");void 0===t.WebkitTransition&&void 0===t.MozTransition&&void 0===t.msTransition||!0===n.options.useCSS&&(n.cssTransitions=!0);n.options.fade&&("number"==typeof n.options.zIndex?n.options.zIndex<3&&(n.options.zIndex=3):n.options.zIndex=n.defaults.zIndex);void 0!==t.OTransform&&(n.animType="OTransform",n.transformType="-o-transform",n.transitionType="OTransition",void 0===t.perspectiveProperty&&void 0===t.webkitPerspective&&(n.animType=!1));void 0!==t.MozTransform&&(n.animType="MozTransform",n.transformType="-moz-transform",n.transitionType="MozTransition",void 0===t.perspectiveProperty&&void 0===t.MozPerspective&&(n.animType=!1));void 0!==t.webkitTransform&&(n.animType="webkitTransform",n.transformType="-webkit-transform",n.transitionType="webkitTransition",void 0===t.perspectiveProperty&&void 0===t.webkitPerspective&&(n.animType=!1));void 0!==t.msTransform&&(n.animType="msTransform",n.transformType="-ms-transform",n.transitionType="msTransition",void 0===t.msTransform&&(n.animType=!1));void 0!==t.transform&&!1!==n.animType&&(n.animType="transform",n.transformType="transform",n.transitionType="transition");n.transformsEnabled=n.options.useTransform&&null!==n.animType&&!1!==n.animType};t.prototype.setSlideClasses=function(n){var u,i,r,f,t=this,e;(i=t.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),t.$slides.eq(n).addClass("slick-current"),!0===t.options.centerMode)?(e=t.options.slidesToShow%2==0?1:0,u=Math.floor(t.options.slidesToShow/2),!0===t.options.infinite&&(n>=u&&n<=t.slideCount-1-u?t.$slides.slice(n-u+e,n+u+1).addClass("slick-active").attr("aria-hidden","false"):(r=t.options.slidesToShow+n,i.slice(r-u+1+e,r+u+2).addClass("slick-active").attr("aria-hidden","false")),0===n?i.eq(i.length-1-t.options.slidesToShow).addClass("slick-center"):n===t.slideCount-1&&i.eq(t.options.slidesToShow).addClass("slick-center")),t.$slides.eq(n).addClass("slick-center")):n>=0&&n<=t.slideCount-t.options.slidesToShow?t.$slides.slice(n,n+t.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):i.length<=t.options.slidesToShow?i.addClass("slick-active").attr("aria-hidden","false"):(f=t.slideCount%t.options.slidesToShow,r=!0===t.options.infinite?t.options.slidesToShow+n:n,t.options.slidesToShow==t.options.slidesToScroll&&t.slideCount-n<t.options.slidesToShow?i.slice(r-(t.options.slidesToShow-f),r+f).addClass("slick-active").attr("aria-hidden","false"):i.slice(r,r+t.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"));"ondemand"!==t.options.lazyLoad&&"anticipated"!==t.options.lazyLoad||t.lazyLoad()};t.prototype.setupInfinite=function(){var i,r,u,t=this;if(!0===t.options.fade&&(t.options.centerMode=!1),!0===t.options.infinite&&!1===t.options.fade&&(r=null,t.slideCount>t.options.slidesToShow)){for(u=!0===t.options.centerMode?t.options.slidesToShow+1:t.options.slidesToShow,i=t.slideCount;i>t.slideCount-u;i-=1)r=i-1,n(t.$slides[r]).clone(!0).attr("id","").attr("data-slick-index",r-t.slideCount).prependTo(t.$slideTrack).addClass("slick-cloned");for(i=0;i<u+t.slideCount;i+=1)r=i,n(t.$slides[r]).clone(!0).attr("id","").attr("data-slick-index",r+t.slideCount).appendTo(t.$slideTrack).addClass("slick-cloned");t.$slideTrack.find(".slick-cloned").find("[id]").each(function(){n(this).attr("id","")})}};t.prototype.interrupt=function(n){var t=this;n||t.autoPlay();t.interrupted=n};t.prototype.selectHandler=function(t){var i=this,u=n(t.target).is(".slick-slide")?n(t.target):n(t.target).parents(".slick-slide"),r=parseInt(u.attr("data-slick-index"));r||(r=0);i.slideCount<=i.options.slidesToShow?i.slideHandler(r,!1,!0):i.slideHandler(r)};t.prototype.slideHandler=function(n,t,i){var u,f,s,e,o,h=null,r=this;if(t=t||!1,!(!0===r.animating&&!0===r.options.waitForAnimate||!0===r.options.fade&&r.currentSlide===n))if(!1===t&&r.asNavFor(n),u=n,h=r.getLeft(u),e=r.getLeft(r.currentSlide),r.currentLeft=null===r.swipeLeft?e:r.swipeLeft,!1===r.options.infinite&&!1===r.options.centerMode&&(n<0||n>r.getDotCount()*r.options.slidesToScroll))!1===r.options.fade&&(u=r.currentSlide,!0!==i?r.animateSlide(e,function(){r.postSlide(u)}):r.postSlide(u));else if(!1===r.options.infinite&&!0===r.options.centerMode&&(n<0||n>r.slideCount-r.options.slidesToScroll))!1===r.options.fade&&(u=r.currentSlide,!0!==i?r.animateSlide(e,function(){r.postSlide(u)}):r.postSlide(u));else{if(r.options.autoplay&&clearInterval(r.autoPlayTimer),f=u<0?r.slideCount%r.options.slidesToScroll!=0?r.slideCount-r.slideCount%r.options.slidesToScroll:r.slideCount+u:u>=r.slideCount?r.slideCount%r.options.slidesToScroll!=0?0:u-r.slideCount:u,r.animating=!0,r.$slider.trigger("beforeChange",[r,r.currentSlide,f]),s=r.currentSlide,r.currentSlide=f,r.setSlideClasses(r.currentSlide),r.options.asNavFor&&(o=(o=r.getNavTarget()).slick("getSlick")).slideCount<=o.options.slidesToShow&&o.setSlideClasses(r.currentSlide),r.updateDots(),r.updateArrows(),!0===r.options.fade)return!0!==i?(r.fadeSlideOut(s),r.fadeSlide(f,function(){r.postSlide(f)})):r.postSlide(f),void r.animateHeight();!0!==i?r.animateSlide(h,function(){r.postSlide(f)}):r.postSlide(f)}};t.prototype.startLoad=function(){var n=this;!0===n.options.arrows&&n.slideCount>n.options.slidesToShow&&(n.$prevArrow.hide(),n.$nextArrow.hide());!0===n.options.dots&&n.slideCount>n.options.slidesToShow&&n.$dots.hide();n.$slider.addClass("slick-loading")};t.prototype.swipeDirection=function(){var i,r,u,n,t=this;return i=t.touchObject.startX-t.touchObject.curX,r=t.touchObject.startY-t.touchObject.curY,u=Math.atan2(r,i),(n=Math.round(180*u/Math.PI))<0&&(n=360-Math.abs(n)),n<=45&&n>=0?!1===t.options.rtl?"left":"right":n<=360&&n>=315?!1===t.options.rtl?"left":"right":n>=135&&n<=225?!1===t.options.rtl?"right":"left":!0===t.options.verticalSwiping?n>=35&&n<=135?"down":"up":"vertical"};t.prototype.swipeEnd=function(){var t,i,n=this;if(n.dragging=!1,n.swiping=!1,n.scrolling)return n.scrolling=!1,!1;if(n.interrupted=!1,n.shouldClick=!(n.touchObject.swipeLength>10),void 0===n.touchObject.curX)return!1;if(!0===n.touchObject.edgeHit&&n.$slider.trigger("edge",[n,n.swipeDirection()]),n.touchObject.swipeLength>=n.touchObject.minSwipe){switch(i=n.swipeDirection()){case"left":case"down":t=n.options.swipeToSlide?n.checkNavigable(n.currentSlide+n.getSlideCount()):n.currentSlide+n.getSlideCount();n.currentDirection=0;break;case"right":case"up":t=n.options.swipeToSlide?n.checkNavigable(n.currentSlide-n.getSlideCount()):n.currentSlide-n.getSlideCount();n.currentDirection=1}"vertical"!=i&&(n.slideHandler(t),n.touchObject={},n.$slider.trigger("swipe",[n,i]))}else n.touchObject.startX!==n.touchObject.curX&&(n.slideHandler(n.currentSlide),n.touchObject={})};t.prototype.swipeHandler=function(n){var t=this;if(!(!1===t.options.swipe||"ontouchend"in document&&!1===t.options.swipe||!1===t.options.draggable&&-1!==n.type.indexOf("mouse")))switch(t.touchObject.fingerCount=n.originalEvent&&void 0!==n.originalEvent.touches?n.originalEvent.touches.length:1,t.touchObject.minSwipe=t.listWidth/t.options.touchThreshold,!0===t.options.verticalSwiping&&(t.touchObject.minSwipe=t.listHeight/t.options.touchThreshold),n.data.action){case"start":t.swipeStart(n);break;case"move":t.swipeMove(n);break;case"end":t.swipeEnd(n)}};t.prototype.swipeMove=function(n){var f,e,r,u,i,o,t=this;return i=void 0!==n.originalEvent?n.originalEvent.touches:null,!(!t.dragging||t.scrolling||i&&1!==i.length)&&(f=t.getLeft(t.currentSlide),t.touchObject.curX=void 0!==i?i[0].pageX:n.clientX,t.touchObject.curY=void 0!==i?i[0].pageY:n.clientY,t.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(t.touchObject.curX-t.touchObject.startX,2))),o=Math.round(Math.sqrt(Math.pow(t.touchObject.curY-t.touchObject.startY,2))),!t.options.verticalSwiping&&!t.swiping&&o>4?(t.scrolling=!0,!1):(!0===t.options.verticalSwiping&&(t.touchObject.swipeLength=o),e=t.swipeDirection(),void 0!==n.originalEvent&&t.touchObject.swipeLength>4&&(t.swiping=!0,n.preventDefault()),u=(!1===t.options.rtl?1:-1)*(t.touchObject.curX>t.touchObject.startX?1:-1),!0===t.options.verticalSwiping&&(u=t.touchObject.curY>t.touchObject.startY?1:-1),r=t.touchObject.swipeLength,t.touchObject.edgeHit=!1,!1===t.options.infinite&&(0===t.currentSlide&&"right"===e||t.currentSlide>=t.getDotCount()&&"left"===e)&&(r=t.touchObject.swipeLength*t.options.edgeFriction,t.touchObject.edgeHit=!0),t.swipeLeft=!1===t.options.vertical?f+r*u:f+r*(t.$list.height()/t.listWidth)*u,!0===t.options.verticalSwiping&&(t.swipeLeft=f+r*u),!0!==t.options.fade&&!1!==t.options.touchMove&&(!0===t.animating?(t.swipeLeft=null,!1):void t.setCSS(t.swipeLeft))))};t.prototype.swipeStart=function(n){var i,t=this;if(t.interrupted=!0,1!==t.touchObject.fingerCount||t.slideCount<=t.options.slidesToShow)return t.touchObject={},!1;void 0!==n.originalEvent&&void 0!==n.originalEvent.touches&&(i=n.originalEvent.touches[0]);t.touchObject.startX=t.touchObject.curX=void 0!==i?i.pageX:n.clientX;t.touchObject.startY=t.touchObject.curY=void 0!==i?i.pageY:n.clientY;t.dragging=!0};t.prototype.unfilterSlides=t.prototype.slickUnfilter=function(){var n=this;null!==n.$slidesCache&&(n.unload(),n.$slideTrack.children(this.options.slide).detach(),n.$slidesCache.appendTo(n.$slideTrack),n.reinit())};t.prototype.unload=function(){var t=this;n(".slick-cloned",t.$slider).remove();t.$dots&&t.$dots.remove();t.$prevArrow&&t.htmlExpr.test(t.options.prevArrow)&&t.$prevArrow.remove();t.$nextArrow&&t.htmlExpr.test(t.options.nextArrow)&&t.$nextArrow.remove();t.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")};t.prototype.unslick=function(n){var t=this;t.$slider.trigger("unslick",[t,n]);t.destroy()};t.prototype.updateArrows=function(){var n=this;Math.floor(n.options.slidesToShow/2);!0===n.options.arrows&&n.slideCount>n.options.slidesToShow&&!n.options.infinite&&(n.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),n.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===n.currentSlide?(n.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),n.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):n.currentSlide>=n.slideCount-n.options.slidesToShow&&!1===n.options.centerMode?(n.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),n.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):n.currentSlide>=n.slideCount-1&&!0===n.options.centerMode&&(n.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),n.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))};t.prototype.updateDots=function(){var n=this;null!==n.$dots&&(n.$dots.find("li").removeClass("slick-active").end(),n.$dots.find("li").eq(Math.floor(n.currentSlide/n.options.slidesToScroll)).addClass("slick-active"))};t.prototype.visibility=function(){var n=this;n.options.autoplay&&(n.interrupted=document[n.hidden]?!0:!1)};n.fn.slick=function(){for(var u,i=this,r=arguments[0],f=Array.prototype.slice.call(arguments,1),e=i.length,n=0;n<e;n++)if("object"==typeof r||void 0===r?i[n].slick=new t(i[n],r):u=i[n].slick[r].apply(i[n].slick,f),void 0!==u)return u;return i}});
(function(){function h(t){return typeof t=="string"&&(t=n.getElementById(t)),t}function t(n,t,r){if(i.addEventListener)n&&n.addEventListener(t,r,!1);else if(i.attachEvent){var u=function(){r.call(n,i.event)};n&&n.attachEvent("on"+t,u)}}function c(n,t){return n.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function l(n,t){c(n,t)||(n.className+=" "+t)}function f(n,t){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");n.className=n.className.replace(i," ")}function a(n){var t,u,i,f,e=r(n);return t=e.left,i=e.top,u=t+n.offsetWidth,f=i+n.offsetHeight,{left:t,right:u,top:i,bottom:f}}function v(t){var i,r,u;return!t.pageX&&t.clientX?(i=1,r=document.body,r.getBoundingClientRect&&(u=r.getBoundingClientRect(),i=(u.right-u.left)/r.clientWidth),{x:t.clientX/i+n.body.scrollLeft+n.documentElement.scrollLeft,y:t.clientY/i+n.body.scrollTop+n.documentElement.scrollTop}):{x:t.pageX,y:t.pageY}}function o(n){return n.replace(/.*(\/|\\)/,"")}function s(n){return/[.]/.exec(n)?/[^.]+$/.exec(n.toLowerCase()):""}var n=document,i=window,u=function(){var t=n.createElement("div");return function(n){t.innerHTML=n;var i=t.childNodes[0];return t.removeChild(i),i}}(),r,e;r=document.documentElement.getBoundingClientRect?function(n){var f=n.getBoundingClientRect(),e=n.ownerDocument,i=e.body,r=e.documentElement,o=r.clientTop||i.clientTop||0,s=r.clientLeft||i.clientLeft||0,t=1,u,h,c;return i.getBoundingClientRect&&(u=i.getBoundingClientRect(),t=(u.right-u.left)/i.clientWidth),t>1&&(o=0,s=0),h=f.top/t+(window.pageYOffset||r&&r.scrollTop/t||i.scrollTop/t)-o,c=f.left/t+(window.pageXOffset||r&&r.scrollLeft/t||i.scrollLeft/t)-s,{top:h,left:c}}:function(n){if(i.jQuery)return jQuery(n).offset();var t=0,r=0;do t+=n.offsetTop||0,r+=n.offsetLeft||0;while(n=n.offsetParent);return{left:r,top:t}};e=function(){var n=0;return function(){return"ValumsAjaxUpload"+n++}}();Ajax_upload=AjaxUpload=function(t,i){var r,u;t.jquery?t=t[0]:typeof t=="string"&&/^#.*/.test(t)&&(t=t.slice(1));t=h(t);this._input=null;this._button=t;this._disabled=!1;this._submitting=!1;this._justClicked=!1;this._parentDialog=n.body;this._isInPopup=!1;window.jQuery&&jQuery.ui&&jQuery.ui.dialog&&(r=jQuery(this._button).parents(".ui-dialog"),r.length&&(this._parentDialog=r[0]));this._settings={action:"upload.php",name:"userfile",id:null,title:"",data:{},autoSubmit:!0,responseType:!1,onChange:function(){},onSubmit:function(){},onComplete:function(){}};for(u in i)this._settings[u]=i[u];this._settings.parentDialog&&(this._parentDialog=this._settings.parentDialog);this._settings.isInPopup&&(this._isInPopup=this._settings.isInPopup);this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(n){this._settings.data=n},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},destroy:function(){this._input&&(this._input.parentNode&&this._input.parentNode.removeChild(this._input),this._input=null)},_createInput:function(){var r=this,i=n.createElement("input"),u,f;i.setAttribute("type","file");i.setAttribute("name",this._settings.name);i.setAttribute("class","fileuploadinput"+(this._settings.name==="userfile"?"":this._settings.name));i.setAttribute("title",this._settings.title);this._settings.accept&&i.setAttribute("accept",this._settings.accept);u={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583};for(f in u)i.style[f]=u[f];i.style.opacity==="0"||(i.style.filter="alpha(opacity=0)");this._parentDialog.appendChild?this._parentDialog.appendChild(i):this._parentDialog.append(i);t(i,"change",function(){r.justClicked=!1;var n=o(this.value);r._settings.onChange.call(r,n,s(n))!=!1&&r._settings.autoSubmit&&r.submit()});/safari/i.test(navigator.userAgent)&&!window.chrome&&t(i,"click",function(){r.justClicked=!0;setTimeout(function(){r.justClicked=!1},3e3)});this._input=i},_rerouteClicks:function(){var i=this,u,e={top:0,left:0},o=!1;t(i._button,"mouseover",function(){i._input&&!o&&(o=!0,u=a(i._button),i._parentDialog!=n.body&&(i._isInPopup?(e.top=jq(i._button).offset().top-jq(i._button).position().top,e.left=jq(i._button).offset().left-jq(i._button).position().left):e=r(i._parentDialog)))});t(document,"mousemove",function(n){var t=i._input,r;if(!t||!o){!t||o||t.style.display=="none"||i.justClicked||(t.style.display="none");return}if(i._disabled){f(i._button,"hover");t.style.display="none";return}r=v(n);r.x>=u.left&&r.x<=u.right&&r.y>=u.top&&r.y<=u.bottom?(t.style.top=r.y-e.top+"px",t.style.left=r.x-e.left+"px",t.style.display="block",l(i._button,"hover")):(o=!1,i.justClicked||(t.style.display="none"),f(i._button,"hover"))})},_createIframe:function(){var i=e(),t=u('<iframe src="javascript:false;" name="'+i+'" />');return t.id=i,t.style.display="none",n.body.appendChild(t),t},submit:function(){var h=this,u=this._settings,f,i,r,e;this._input.value!==""&&(f=o(this._input.value),u.onSubmit.call(this,f,s(f))==!1?(n.body.removeChild(this._input),this._input=null,this._createInput()):(i=this._createIframe(),r=this._createForm(i),r.appendChild(this._input),r.submit(),n.body.removeChild(r),r=null,this._input=null,this._createInput(),e=!1,t(i,"load",function(){var t,r;if(i.src=="javascript:'%3Chtml%3E%3C/html%3E';"||i.src=="javascript:'<html><\/html>';"){e&&setTimeout(function(){n.body.removeChild(i)},0);return}(t=i.contentDocument?i.contentDocument:frames[i.id].document,t.readyState&&t.readyState!="complete")||t.body&&t.body.innerHTML=="false"||t.body&&t.body.innerHTML==""||(t.XMLDocument?r=t.XMLDocument:t.body?(r=t.body.innerHTML,u.responseType&&u.responseType.toLowerCase()=="json"&&(t.body.firstChild&&t.body.firstChild.nodeName.toUpperCase()=="PRE"&&(r=t.body.firstChild.firstChild.nodeValue),r=r?window.eval("("+r+")"):{})):r=t,u.onComplete.call(h,f,r),e=!0,i.src="javascript:'<html><\/html>';")})))},_createForm:function(t){var f=this._settings,i=u('<form method="post" enctype="multipart/form-data"><\/form>'),e,r;i.style.display="none";i.action=f.action;i.target=t.name;n.body.appendChild(i);for(e in f.data)r=n.createElement("input"),r.type="hidden",r.name=e,r.value=f.data[e],i.appendChild(r);return i}}})();
(function(n){var t=ASC.Projects.Resources.ProjectsJSResource,r=Teamlab,u=ASC.Resources.Master.ResourceJS,i=function(t,i){this.$element=n(t);this.options=n.extend({},n.fn.tagsadvancedSelector.defaults,i);this.init()};i.prototype=n.extend({},n.fn.advancedSelector.Constructor.prototype,{constructor:i,initCreationBlock:function(){var n=this,i={newoptions:[{title:t.TagsSelectorTitle,type:"input",tag:"title"}],newbtn:u.CreateButton};n.displayAddItemBlock.call(n,i)},initAdvSelectorData:function(){var n=this;n.rewriteObjectItem.call(n,[])},rewriteObjectItem:function(n){var t=this;t.items=n.map(function(n){return{id:n.id,title:n.title,description:n.description,isPrivate:n.isPrivate,responsible:n.responsible,deadline:n.deadline}});t.items=t.items.sort(t.options.sortMethod||SortData);t.showItemsListAdvSelector.call(t)},createNewItemFn:function(){var n=this,i=n.$advancedSelector.find(".advanced-selector-add-new-block"),u=i.find(".advanced-selector-btn-add"),f={data:i.find(".title input").val().trim()};if(!f.data){n.showErrorField.call(n,{field:i.find(".title"),error:t.TagsSelectorEmptyTitleError});i.find(".error input").first().trigger("focus");return}r.addPrjTag({},f,{before:function(){n.displayLoadingBtn.call(n,{btn:u,text:t.LoadingProcessing})},error:function(t,i){n.showServerError.call(n,{field:u,error:i})},success:function(t,i){i=this.__responses[0];var r={id:i.id,title:i.title};n.actionsAfterCreateItem.call(n,{newitem:r,response:i})},after:function(){n.hideLoadingBtn.call(n,u)}})}});n.fn.tagsadvancedSelector=function(t){var r=Array.prototype.slice.call(arguments,1);return this.each(function(){var f=n(this),u=f.data("tagsadvancedSelector"),e=n.extend({},n.fn.tagsadvancedSelector.defaults,f.data(),typeof t=="object"&&t);u||f.data("tagsadvancedSelector",u=new i(this,e));typeof t=="string"&&u[t].apply(u,r)})};n.fn.tagsadvancedSelector.defaults=n.extend({},n.fn.advancedSelector.defaults,{addtext:t.TagsSelectorAddText,noresults:t.TagsSelectorNoResult,noitems:t.TagsSelectorNoItems,emptylist:t.TagsSelectorEmptyList})})(jQuery);
Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(n){"use strict";var f,i,t,e,r,s,u,o;if(n===undefined||n===null)throw new TypeError("Cannot convert first argument to object");for(f=Object(n),i=1;i<arguments.length;i++)if(t=arguments[i],t!==undefined&&t!==null)for(e=Object.keys(Object(t)),r=0,s=e.length;r<s;r++)u=e[r],o=Object.getOwnPropertyDescriptor(t,u),o!==undefined&&o.enumerable&&(f[u]=t[u]);return f}});jQuery.extend({getAnchorParam:function(n,t){var r=new RegExp("[#&]"+n+"=([^&]*)"),i=r.exec("#"+t);return i==null?"":i[1]},hasParam:function(n,t){var i=new RegExp("(\\#|&|^)"+n+"=","g");return i.test(t)},removeParam:function(n,t){var i=new RegExp("[#&]"+n+"=([^&]*)");return t.replace(i,"")},addParam:function(n,t,i){return n.length&&(n+="&"),n+t+"="+i},changeParamValue:function(n,t,i){if(jq.hasParam(t,n)){var r=new RegExp(t+"[=][0-9a-z-]*");return n.replace(r,t+"="+i)}return jq.addParam(n,t,i)},format:function(n){var i,t;if(arguments.length<=1)return n;for(i=arguments.length-2,t=0;t<=i;++t)n=n.replace(new RegExp("\\{"+t+"\\}","gi"),arguments[t+1]);return n},timeFormat:function(n){var u=parseFloat(n),r=Math.floor(u),t=Math.floor((u-r)*60),i=Math.round(((u-r)*60-t)*60);return i<10?i="0"+i:i==60&&(i="00",t=t+1),t<10?t="0"+t:t==60&&(t="00",r=r+1),r+":"+t+":"+i}});jQuery.fn.swap=function(n){n=jQuery(n)[0];var t=this[0],i=t.cloneNode(!0),u=n.cloneNode(!0),r=this;return t.parentNode.replaceChild(u,t),n.parentNode.replaceChild(i,n),r[0]=i,this.pushStack(r)};String.prototype.contains||(String.prototype.contains=function(){return String.prototype.indexOf.apply(this,arguments)!==-1});Array.prototype.findIndex||(Array.prototype.findIndex=function(n){var t;if(this==null)throw new TypeError("Array.prototype.findIndex called on null or undefined");if(typeof n!="function")throw new TypeError("predicate must be a function");var i=Object(this),u=i.length>>>0,f=arguments[1],r;for(t=0;t<u;t++)if(r=i[t],n.call(f,r,t,i))return t;return-1});
ASC.Projects.Tab=function(n,t,i,r,u,f,e,o){this.title=n;this.count=t;this.divID=i;this.$container=r;this.selected=u?u.indexOf("#")===0?location.href.toLowerCase().endsWith(u.toLowerCase())||o&&location.hash.indexOf(o)==0:location.href.toLowerCase().indexOf(u.toLowerCase())>0:!1;this.link=u;this.sublink=o;this.isVisibleSelector=f;this.emptyScreen=e};ASC.Projects.Tab.prototype.select=function(){var i,n,t,r;if(this.selected=!0,i=this,n=jq("#emptyScrCtrlPrj"),this.count()===0&&this.emptyScreen){this.$container.hide();n.html(jq.tmpl("projects_emptyScreen",this.emptyScreen)).show();t=n.find(".addFirstElement");t.off("click").on("click",function(){n.hide();i.$container.show();i.emptyScreen.button.onclick()});r=location.hash.substring(1);r===this.emptyScreen.button.hash&&t.length>0&&t.trigger("click")}else this.$container&&(n.hide(),this.$container.show());this.link.indexOf("#")===0&&(this.sublink&&location.hash.indexOf(this.sublink)==0||ASC.Projects.Common.setHash(this.link));this.rewrite()};ASC.Projects.Tab.prototype.unselect=function(){this.selected=!1;this.$container&&this.$container.hide();this.rewrite()};ASC.Projects.Tab.prototype.rewrite=function(){this.getDiv().replaceWith(jq.tmpl("projects_tabsNavigatorItem",this))};ASC.Projects.Tab.prototype.getDiv=function(){return jq("#"+this.divID+"_tab")};ASC.Projects.ProjectTab=function(n,t,i,r,u,f,e){this.href=r?r+"?prjID="+n.id:"";this.onclick=f;ASC.Projects.Tab.call(this,t,i,u,undefined,r,e)};ASC.Projects.ProjectTab.prototype=new ASC.Projects.Tab;ASC.Projects.DescriptionTab=function(){function u(){return t=this,n={data:[],status:{items:[],current:{},canChange:!1}},i=jq(".tab"),t}function f(){var u,f;if(i.html(jq.tmpl("projects_description",n)),r(),u=n.status.items,u.length){f=i.find(".status");f.advancedSelector({height:30*u.length,itemsChoose:u,itemsSelectedIds:[n.status.current.id],showSearch:!1,onechosen:!0,sortMethod:function(){return 0}});f.on("showList",function(n,t){var i=u.find(function(n){return n.id==t.id});i.handler()})}return t}function r(){i.show()}function e(){i.hide()}function o(i,r,u,f){return n.data.push({title:i,value:r,href:u,wrapper:f}),t}function s(i){return n.status.items=i,t}function h(i){return n.status.current=i,t}function c(n){var r=i.find(".status");return r.advancedSelector("select",[n.toString()]),t}function l(i){return n.status.canChange=i,t}var n,i,t;return{init:u,push:o,setStatuses:s,resetStatus:c,setStatusRight:l,setCurrentStatus:h,tmpl:f,show:r,hide:e}}();ASC.Projects.TabCollection=function(){function r(r){var u,f;i=r;u=i.filter(function(n){return typeof n.isVisibleSelector=="function"?n.isVisibleSelector():!0});t=jq("#projectTabs");t.html(jq.tmpl("projects_tabsNavigator",{tabs:u})).show();t.off("click").on("click",".tabsNavigationLink",function(t){var r=jq(this).attr("id"),i=u.find(function(n){return n.divID+"_tab"===r});if(i)return(n.unselect(),i.select(),n=i,typeof n.onclick=="function")?n.onclick.call(this,{id:n.getDiv(),href:n.getDiv().attr("href")},t):!0});f=u.some(function(n){return n.selected});f||(u[0].selected=!0);u.forEach(function(n){n.selected?n.select():n.unselect()});n=u.find(function(n){return n.selected})}var i,n,t;return{init:r}}();ASC.Projects.InfoContainer=function(){var t=".project-info-container",n,i=function(i,r,u){jq(t).replaceWith(jq.tmpl("projects_navPanel",i));n=jq(t);ASC.Projects.Base.initActionPanel(r&&r().menuItems.length>0?r:undefined,n);u&&ASC.Projects.TabCollection.init(u);n.show()},r=function(t){n.find("#essenceTitle").attr("title",t).text(t)};return{init:i,updateTitle:r}}();ASC.Projects.ActionMenuItem=function(n,t,i,r,u){this.id=n;this.text=t;this.handler=i;this.classname=r||null;this.seporator=!!u};ASC.Projects.DescriptionPanel=function(){function e(n,t,i){if(i){o(n,t);n.on("mouseenter",i.selector,function(n){var r=jq(n.target),t=i.getItem(n.target);s(t,r,i.getLink?i.getLink(t):undefined)});n.on("mouseleave",i.selector,function(){u(!1)})}}function o(t,r){if(!n){t.append(jq.tmpl("projects_panelFrame",{panelId:"descrPanel"}));n=jq("#descrPanel");n.on("mouseenter",function(){i=!0});n.on("mouseleave",function(){i=!1;u()});n.on(f,".project .value .link",function(){u(!1);r.add("project",jq(this).attr("projectId"),["tag","milestone","myprojects"])});n.on(f,".milestone .value .link",function(){r.add("milestone",jq(this).attr("milestone"))})}}function s(u,f,e){if(typeof u!="undefined"&&!(r>0)){r=setTimeout(function(){var y=n.find(".panel-content"),r={},a=u.displayDateCrtdate||u.created,o=u.description,s="",v=jq.getURLParam("prjID")?undefined:u.projectId,c,l;typeof u.createdBy!="undefined"&&(s=typeof u.createdBy=="string"?u.createdBy:u.createdBy.displayName);t(a)&&(r.creationDate=a);t(o)&&(r.description=o,e&&(o.indexOf("\n")>2||o.length>80)&&(r.readMore=e));t(v)&&(r.project=jq.htmlEncodeLight(u.projectTitle),r.projectId=u.projectId,c=ASC.Projects.Common.getProjectById(v),r.projectStatus=typeof c!="undefined"?c.status:undefined);t(s)&&(r.createdBy=Encoder.htmlEncode(s));t(u.displayDateUptdate)&&(u.statusname==="closed"||u.status==="closed"||u.status===2)&&(r.closedDate=u.displayDateUptdate.substr(0,10),t(u.updatedBy)&&(r.closedBy=Encoder.htmlEncode(u.updatedBy.displayName)));t(u.displayDateStart)&&(r.startDate=u.displayDateStart);t(u.milestone)&&(r.milestone=Encoder.htmlEncode("["+u.milestone.displayDateDeadline+"] "+u.milestone.title),r.milestoneId=u.milestone.id,l=ASC.Projects.Common.getMilestoneById(u.milestone.id),r.milestoneStatus=typeof l!="undefined"?l.status:undefined);y.html(jq.tmpl("projects_descriptionPanelContent",r));h(f);i=!0},500,this);return}}function u(t){r<=0||typeof n=="undefined"||(i=t,setTimeout(function(){i||(n.hide(),clearTimeout(r),r=-1)},50))}function t(n){return n?typeof n=="string"?n.trim()!="":!0:!1}function h(t){var i=t.offset(),r,u;(i.top||i.left)&&(r=i.left,u=c(i.top+t.outerHeight(),t),n.css({left:r,top:u}),n.show())}function c(t,i){var r=n.innerHeight(),u=jq(window),f=u.scrollTop(),e=u.height();return r<t&&e+f-r<=t&&(t=t-n.outerHeight(),i&&(t=t-i.outerHeight())),t}var n,i,r,f="click";return{init:e,hide:u}}();ASC.Projects.Event=function(n,t){return{event:n,handler:t}};ASC.Projects.EventBinder=function(){function i(i){i&&Array.isArray(i)&&(n=i.map(function(n){return t.bind(n.event,n.handler)}))}function r(){while(n.length){var i=n.shift();t.unbind(i)}}var t=Teamlab,n=[];return{bind:i,unbind:r}}();ASC.Projects.GroupActionPanel=function(){function ut(b,tt){var et,it,ot,st,ht,ut,ft,ct;for(r=tt,u=b.actions,n=0,k=b.getItemByCheckbox,t&&t.remove(),e=jq("#groupActionContainer"),e.append(jq.tmpl(rt,b)),t=jq("#groupActionMenu"),et=u.length-1;et>=0;et--)if(it=u[et],ot=jq("#"+it.id),it.multi){ot.on(a,function(n){ot.hasClass(f)||n.stopPropagation()});for(jq.dropdownToggle({switcherSelector:"#"+it.id,dropdownID:it.id+"Selector",position:"fixed",simpleToggle:!0}),st=0;st<it.multi.length;st++)d(it.multi[st],function(){return!ot.hasClass(f)||jq(this).find("a").hasClass(y)})}else d(it,function(){return!this.classList.contains(f)});if(o=t?t.find(".menu-action-checked-count"):[],t){ht={menuSelector:"#groupActionMenu",menuAnchorSelector:"#selectAll",menuSpacerSelector:"#groupActionContainer .header-menu-spacer",userFuncInTop:function(){t.find(w).hide()},userFuncNotInTop:function(){t.find(w).show()}};ScrolledGroupMenu.init(ht);i=jq("#selectAll");i.off(c).on(c,function(){jq("#groupActionMenuSelector").hide();var t=r.find(".checkbox input"),u=r.find("tr");return i.is(":"+s)&&!i.is(":"+v)&&n===0?(n=t.length,t.each(function(n,t){t.checked=!0}),u.addClass(h),nt(),p()):l(),!1});jq("#deselectAll").off(a).on(a,function(){l()})}r.off(c+".ga").on(c+".ga",".checkbox input",g);if(ut=b.multiSelector,ut)for(jq.dropdownToggle({switcherSelector:"#groupActionContainer .menuActionSelectAll",dropdownID:"groupActionMenuSelector",anchorSelector:".menuActionSelectAll",position:"fixed",simpleToggle:!0}),ft=ut.length-1;ft>=0;ft--){ct=function(n){return function(){l();var t=b.getLineByCondition(n.condition);t.forEach(function(n){var t=n.find(".checkbox input[type='checkbox']");t.prop("checked","checked");g.call(t)})}}(ut[ft]);jq("#"+ut[ft].id).on("click",ct)}}function d(n,t){var i=function(n){return function(){t.call(this)||n.handler(tt().map(function(n){return n.id}))}}(n);jq("#"+n.id).on("click",i)}function g(){var t=jq(this),u=r.find(".checkbox input").length;t.is(":"+s)?(n++,t.parents(b).addClass(h)):(n--,t.parents(b).removeClass(h));n>0?nt():it();i.prop(s,n>0);i.prop(v,n>0&&n<u);p()}function l(){var t=r.find(".checkbox input"),u=r.find("tr");n=0;t.each(function(n,t){t.checked=!1});u.removeClass(h);it();p();i.prop(v,!1);i.prop(s,!1)}function p(){n>0?(o.show(),o.find("span").text(n+" "+ASC.Projects.Resources.ProjectsJSResource.GroupMenuSelectedItems)):o.hide()}function nt(){for(var n,i,t,r=tt(),e=u.length;e--;){if(n=u[e],n.multi)for(jq("#"+n.id+"Selector a").removeClass(y),t=0;t<n.multi.length;t++){var o=n.multi[t],s=r.every(o.checker),h=jq("#"+o.id+" a");s?i=!0:h.addClass(y)}else i=r.every(n.checker);i?jq("#"+n.id).addClass(f):jq("#"+n.id).removeClass(f)}}function tt(){var n=r.find(".checkbox input:checked").toArray();return n.map(k)}function it(){for(var t,n=u.length;n--;)t=u[n],jq("#"+t.id).removeClass(f)}function ft(){e&&e.hide()}var e,t,i,r,n=0,rt="projects_groupActionMenu",o,s="checked",h="checked-row",w=".menu-action-on-top",b=".with-checkbox",c="change",a="click",f="unlockAction",v="indeterminate",y="disable",u,k;return{init:ut,hide:ft,deselectAll:l}}();ASC.Projects.StatusList=function(){function a(s,h){var a,c,y;if(s){f=Teamlab.profile.id;t=s;a="#statusChangePanel";i=h;jq(a).remove();i.append(jq.tmpl("projects_statusChangePanel",s));n=jq(a);i.on(l,e,v);for(c=0;c<s.statuses.length;c++){y=function(n,i){return function(){jq(this).hasClass(u)||t.handler(r,n,i)}}(s.statuses[c].id,s.statuses[c].statusType);jq("#statusItem_"+s.statuses[c].id).on("click",y)}jq("body").off("click.body3").on("click.body3",function(){setTimeout(function(){o()},1)})}}function v(){var i=t.getItem(this),w=n.is(":visible"),v=jq(this),y=i.id,e=typeof i.status!="undefined"?i.status:i.paymentStatus,p=v.offset(),s,l,h,a;if(o(),r===y&&w)return undefined;if(r=y,v.addClass("selected"),n.css({left:p.left,top:p.top+28}),n.find("li").show().removeClass(u),e<0&&(e=-e),n.find("#statusItem_"+c(i).id).addClass(u),e===1&&n.find(".paused").hide(),s=typeof i.projectId!="undefined"?ASC.Projects.Master.Projects.find(function(n){return n.id===i.projectId}):i,s||(s=ASC.Projects.Common.getProjectByIdFromCache(i.projectId)),i.createdBy.id!==f&&!ASC.Projects.Master.IsModuleAdmin&&s.responsibleId!==f)for(l=t.statuses,h=0;h<l.length;h++)a=l[h],a.available===!1&&n.find("."+a.cssClass).hide();return n.show(),!1}function o(){n&&n.hide();i.find(e).removeClass("selected")}function s(n){return t.statuses.find(function(t){return n===t.id})}function h(n){return t.statuses.find(function(t){return t.hasOwnProperty("statusType")?t.statusType===n&&t.isDefault:t.id===n})}function c(n){var t;return t=typeof n.customTaskStatus!="undefined"?s(n.customTaskStatus):h(n.status),t||h(n.status)}var l="click",e=".changeStatusCombobox.canEdit",r,u="active",t,f,n,i;return{init:a,getById:s,getByData:c}}();
typeof ASC=="undefined"&&(ASC={});typeof ASC.Projects=="undefined"&&(ASC.Projects={});ASC.Projects.Common=function(){function b(){!c&&jq(".mobileApp-banner").length&&(c=!0)}function k(){h||(h=!0,typeof t!="undefined"?(typeof t.Projects!="undefined"&&t.Projects!=null&&(t.Projects=r.create("prj-projects",null,t.Projects.response)),typeof t.Tags!="undefined"&&t.Tags!=null&&(t.Tags=t.Tags.response),typeof t.Team!="undefined"&&t.Team!=null&&(t.TeamWithBlockedUsers=r.create("prj-projectpersons",null,t.Team.response),t.Team=n.Common.removeBlockedUsersFromTeam(t.TeamWithBlockedUsers)),typeof t.Milestones!="undefined"&&t.Milestones!=null&&(t.Milestones=r.create("prj-milestones",null,t.Milestones.response),t.Milestones=t.Milestones.sort(y))):ASC.Projects.Master={})}function d(){var o=jq.getURLParam("action"),h=jq.getURLParam("id"),c=jq.getURLParam("prjID"),f=location.href,e=document.location.pathname.match(/[^\/]+$/),l=n.Resources.StartModules,v,a;Teamlab.profile.isVisitor&&(l=n.Resources.StartModules=l.filter(function(n){return n.StartModuleType!==3}));e===null?(v=l.find(function(n){return n.StartModuleType===t.StartModuleType})||l[0],e=t.Projects.length!==0?v.Page:"Projects.aspx",f=document.location.pathname+e,history.pushState({href:f},{href:f},f)):e=e[0];g();s(n.TaskAction);s(n.MilestoneAction);f=f.toLowerCase();jq.getURLParam("prjId")&&f.indexOf("ganttchart.aspx")===-1&&f.indexOf("timer.aspx")===-1?n.projectNavPanel.init():n.projectNavPanel.hide();s(n.navSidePanel);e=e.toLowerCase();switch(e){case"tasks.aspx":i=h?n.TaskDescriptionPage:n.TasksManager;break;case"messages.aspx":o&&(i=n.DiscussionAction,ckeditorConnector.load(function(){n.Common.ckEditor=jq("#ckEditor").ckeditor({toolbar:"PrjMessage",extraPlugins:"oembed,teamlabcut,codemirror",removePlugins:"div",filebrowserUploadUrl:"fckuploader.ashx?esid=projects_comments"}).editor;n.Common.ckEditor.on("change",i.showHidePreview)}));h&&o==null&&(i=n.DiscussionDetails);h==null&&o==null&&(i=n.Discussions);break;case"milestones.aspx":i=n.AllMilestones;break;case"projects.aspx":o==null?i=c==null?n.AllProject:n.Description:(i=n.ProjectAction,jq(".mainPageContent").children(".loader-page").hide());jq("#projectTitleContainer .inputTitleContainer").css("width","100%");o==="edit"&&(jq(".dottedHeader").removeClass("dottedHeader"),jq("#projectDescriptionContainer").show(),jq("#notifyManagerCheckbox").prop("disabled",!0),jq("#projectTagsContainer").show());break;case"projectteam.aspx":i=n.ProjectTeam;break;case"timer.aspx":i=n.TimeTraking;break;case"timetracking.aspx":n.TimeTrakingEdit.init();i=n.TimeSpendActionPage;break;case"projecttemplates.aspx":i=n.Templates;break;case"reports.aspx":i=jq.getURLParam("tmplId")||jq.getURLParam("reportType")?n.ReportView:n.GeneratedReport;break;case"contacts.aspx":i=n.Contacts;break;case"import.aspx":i=n.Import;break;case"ganttchart.aspx":i=n.GantChartPage;break;case"settings.aspx":i=n.SettingsManager}i&&i.hasOwnProperty("init")&&i.init();h===null&&o===null&&c&&(a=u[Number(c)],typeof a!="undefined"?r.call(r.events.getPrjProject,this,[null,a]):(r.bind(r.events.getPrjProject,function(n,t){u[t.id]=t}),r.getPrjProject({},c)))}function g(){location.href.toLowerCase().indexOf("ganttchart.aspx")>0||typeof i!="undefined"&&typeof i.unbindListEvents=="function"&&i.unbindListEvents()}function s(n){n&&n.hasOwnProperty("init")&&n.init()}function nt(){function n(n,i){function o(n){return function(t){return t.id!==n.id}}var r,e;for(f=[],r=0;r<i.length;r++)e=i[r],t.Projects=t.Projects.filter(o(e)),delete u[e.id]}e.length||(e.push(r.bind(r.events.getException,function(n,t){t&&t[0]==="unauthorized request"&&(window.location="/Auth.aspx")})),e.push(r.bind(r.events.updatePrjProjectStatus,function(n,i){f=[];i.status===0?typeof p(i.id)=="undefined"&&t.Projects.push(i):t.Projects=t.Projects.filter(function(n){return n.id!==i.id});u[i.id]=i})),e.push(r.bind(r.events.removePrjProjects,n)),e.push(r.bind(r.events.removePrjProject,function(t,i){n(null,[i])})))}function tt(){function f(n,t,i){return{image:n,title:t,text:i}}var r,e,u;if(t.ProjectsCount===0&&!l&&i!==n.ProjectAction&&i!==n.Import&&i!==n.GantChartPage&&i!==n.ReportView&&i!==n.Templates&&i!==n.SettingsManager&&t.CanCreateProject){r=n.Resources.ProjectsCommonResource;e={blocks:[f("design-project-hierarchy.png",r.DashboardDesignProjectHierarchy,[r.DashboardDesignProjectHierarchyFirstLine,r.DashboardDesignProjectHierarchySecondLine,r.DashboardDesignProjectHierarchyThirdLine]),f("track-time-and-progress.png",r.DashboardTrackTimeAndProgress,[r.DashboardTrackTimeAndProgressFirstLine,r.DashboardTrackTimeAndProgressSecondLine,r.DashboardTrackTimeAndProgressThirdLine]),f("manage-access-rights.png",r.DashboardManageAccessRights,[r.DashboardManageAccessRightsFirstLine,r.DashboardManageAccessRightsSecondLine,r.DashboardManageAccessRightsThirdLine]),f("use-more-tools.png",r.DashboardUseMoreTools,[r.DashboardUseMoreToolsFirstLine,r.DashboardUseMoreToolsSecondLine,r.DashboardUseMoreToolsThirdLine])]};jq.tmpl("projects_dashboard_empty_screen",e).appendTo("body");u=jq("#projects_dashboard_empty_screen_container");u.on("click",".close",function(){u.remove()});jq(document).on("keyup",function(n){var t;n.keyCode?t=n.keyCode:n.which&&(t=n.which);t==27&&u.remove()});u.find(".slick-carousel").slick({slidesToShow:1,slidesToScroll:1,arrows:!0,dots:!0,fade:!0,centerMode:!0});u.find(".slick-next").trigger("focus");l=!0}}function y(n,t){var i=v(n.deadline,t.deadline);return i?i:v(n.title,t.title,!0)}function ct(n,t,i){n.append(jq.tmpl("projects_panelFrame",{panelId:t}));var r=jq("#"+t);return r.find(".panel-content").html(jq.tmpl("projects_actionMenuContent",i)),r}function p(n){for(var r,i=0,u=t.Projects.length;i<u;i++)if(r=t.Projects[i],r.id==n)return r;return undefined}function lt(n){for(var r,i=0,u=t.Milestones.length;i<u;i++)if(r=t.Milestones[i],r.id==n)return r;return undefined}function at(n){return u[n]}function vt(t,i){var r=u[t.projectOwner.id];if(r){switch(i){case 0:r.taskCount++;r.taskCountTotal++;break;case 1:t.status===2?r.taskCount--:r.taskCount++;break;case 2:t.status===1&&(r.taskCount--,r.taskCountTotal--)}n.projectNavPanel.rewriteTaskTab()}}function yt(t,i){var r=u[t.projectId];if(r){switch(i){case 0:r.milestoneCount++;break;case 1:t.status===1?r.milestoneCount--:r.milestoneCount++;break;case 2:t.status===0&&r.milestoneCount--}n.projectNavPanel.rewriteMilestoneTab()}}function pt(t){var i=n.Resources;return t===0?"":t+" "+wt(t,i.MonthNominative,i.MonthGenitiveSingular,i.MonthGenitivePlural)}function wt(n,t,i,r){return n===.5&&ASC.Resources.Master.TwoLetterISOLanguageName==="ru"?i:n===1?t:bt(n,t,i,r)}function bt(n,t,i,r){var u,f;if(ASC.Resources.Master.TwoLetterISOLanguageName==="ru"){u=[2,0,1,1,1,2,2,2,2,2];n=Math.abs(n);f=u[(n%100/10!=1?1:0)*(n%10)];switch(f){case 0:return t;case 1:return i;default:return r}}else return n===1?t:r}function kt(n){if(n&&n.originalEvent&&n.originalEvent.ctrlKey)return!0;jq(".studio-action-panel").hide();var t=jq(this),i=t.attr("href");return w(i),!1}function w(i){history.pushState({href:i},{href:i},i);var u=jq.getURLParam("prjID");return u?r.getPrjTeam({},u,function(i,r){t.TeamWithBlockedUsers=r;t.Team=a(r);n.Base.clearTables();jq("#filterContainer").hide();o()}):(n.Base.clearTables(),jq("#filterContainer").hide(),o()),!1}function dt(n){if(t.customStatuses){n();return}r.getPrjStatuses({success:function(i,r){t.customStatuses=r.sort(function(n,t){return n.statusType<t.statusType?-1:n.statusType>t.statusType?1:n.order<t.order?-1:n.order>t.order?1:0});n()},error:function(){}})}function gt(n){var i=location.hash===""?location.href.replace("#",""):location.href.substring(0,location.href.indexOf("#")),t;n.indexOf("#")!==0&&(n="#"+n);t=i+n;history.replaceState({href:t},{href:t},t)}var h=!1,c=!1,n=ASC.Projects,r=Teamlab,i,f=[],u=[],l=!1,e=[],t=n.Master,o=function(){window.onpopstate=null;b();k();nt();d();tt();setTimeout(function(){window.onpopstate=o},200)},a=function(n){return n.filter(function(n){return n.status===1})},it=function(){i.onDeleteComment()},rt=function(n,t,i){var s=290,u=660,e=jq.browser,f;e.safari?u=584:e.opera&&(u=620);e.msie&&(s=290,u=660);navigator.userAgent.indexOf("OPR/")>0&&(u=738);var h="width="+s+",height="+u+",resizable=yes,scrollbars=yes",c="displayTimerWindow",r=null,o;try{r=window.open("",c,h)}catch(l){}try{o=!r||typeof r.ASC=="undefined"?!1:!0}catch(l){o=!0}f="Timer.aspx";n&&(f+="?prjID="+n,t&&(f+="&taskId="+t,i&&(f+="&userID="+i)));o||(r=window.open(f,c,h));try{r&&r.focus()}catch(l){}},ut=function(n){return n.filter(function(n){return!n.isVisitor})},ft=function(n){return typeof t.Team=="undefined"?!1:t.Team.find(function(t){return t.id===n})},et=function(){return r.profile.isAdmin||t.IsModuleAdmin},ot=function(t,i,r,u,f){var o=n.Common,e=[-1,-1,-1,-1];return e[0]=o.linkTypeEnum.start_start,i&&u?(e[1]=o.linkTypeEnum.end_end,i<=r?e[3]=o.linkTypeEnum.end_start:u<=t?e[2]=o.linkTypeEnum.start_end:(f.invalidLink=!0,t<=r?e[3]=o.linkTypeEnum.end_start:e[2]=o.linkTypeEnum.start_end)):u?(e[2]=o.linkTypeEnum.start_end,u>t&&(f.invalidLink=!0)):i&&(e[3]=o.linkTypeEnum.end_start,i<r&&(f.invalidLink=!0)),e},st=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},ht=function(){var o,n,u;if(f.length)return f;var r=[],e=[],i=t.Projects;if(!i)return[];for(o=i.length,n=0;n<o;n++)u={value:i[n].id,title:i[n].title,canCreateTask:i[n].canCreateTask,canCreateMilestone:i[n].canCreateMilestone},i[n].isInTeam?r.push(u):e.push(u);return r.length>0&&(r[r.length-1].classname="separator"),f=r.concat(e)},v=function(n,t,i){return i?n<t?-1:n>t?1:0:n<t?1:n>t?-1:0};return{chooseMonthNumeralCase:pt,createActionPanel:ct,currentUserIsModuleAdmin:et,currentUserIsProjectManager:function(n){return t.Projects.some(function(t){return t.id==n&&t.responsibleId===r.profile.id})},displayInfoPanel:st,emptyGuid:"00000000-0000-0000-0000-000000000000",events:{loadTags:"loadTags",loadProjects:"loadProjects",loadTeam:"loadTeam",loadMilestones:"loadMilestones"},excludeVisitors:ut,filterParamsForListProjects:{sortBy:"title",sortOrder:"ascending",status:"open",fields:"id,title,security,isPrivate,status,responsible"},filterParamsForListMilestones:{sortBy:"deadline",sortOrder:"descending",status:"open",fields:"id,title,deadline"},filterParamsForListTasks:{sortBy:"deadline",sortOrder:"ascending"},goToWithoutReload:kt,goToHrefWithoutReload:w,getPossibleTypeLink:ot,getProjectsForFilter:ht,getProjectById:p,getMilestoneById:lt,getProjectByIdFromCache:at,changeTaskCountInProjectsCache:vt,changeMilestoneCountInProjectsCache:yt,baseInit:o,initCustomStatuses:dt,linkTypeEnum:{start_start:0,end_end:1,start_end:2,end_start:3},milestoneSort:y,removeBlockedUsersFromTeam:a,removeComment:it,showTimer:rt,setHash:gt,userInProjectTeam:ft}}();ASC.Projects.ReportGenerator=function(){function u(){r||(r=!0,i=ProgressDialog,n=Teamlab,i.init({header:t.ReportBuilding,footer:t.ReportBuildingInfo.format("<a class='link underline' href='/Products/Files/'>","<\/a>"),progress:t.ReportBuildingProgress},jq("#studioPageContent .mainPageContent"),{terminate:n.terminateProjectsReport,status:n.getProjectsReportStatus,generate:n.generateProjectsReport}))}function f(n){u();i.generate({uri:n})}var t=ASC.Projects.Resources.ProjectsJSResource,n,i,r=!1;return{generate:f}}();jq(document).ready(function(){ASC.Projects.Common.baseInit()});
ASC.Projects.navSidePanel=function(){function ci(){function n(n,t){var i,u;for(ii(),i=0;i<t.length;i++)r.find("li[id="+t[i].id+"]").remove();u=r.find("li");u.length===0&&(jq("#myProjectsExpander").remove(),r.removeAttr("id"))}if(o=Teamlab,t=jq.getURLParam("prjID"),c||(c=jq("#createNewDiscussion")),t!==null?c.attr("href","Messages.aspx?action=add&prjID="+t):c.attr("href","Messages.aspx?action=add"),ri){fi();return}o.bind(o.events.updatePrjProjectStatus,ii);o.bind(o.events.removePrjProjects,n);o.bind(o.events.removePrjProject,function(t,i){n(null,[i])});i=Teamlab.profile.id;ri=!0;l=jq("#menuCreateNewButton");h=jq("#createNewButton");d=jq("#createNewTask");g=jq("#createNewMilestone");nt=jq("#createNewTimer");a=jq("#menuTMDocs");y=jq("#menuMessages");p=jq("#menuTasks");tt=jq("#menuMilestones");st=jq("#menuTimeTracking");ui=jq("#menuTemplates");v=jq("#menuSettings");si=jq("#menuImport");e=jq("#menuProjects");r=jq("#myProjectsConteiner");u=jq(".page-menu");it=u.find("#menuMyProjects");ht=u.find("#menuFollowedProjects");ct=u.find("#menuActiveProjects");lt=u.find("#menuMyMilestones");at=u.find("#menuUpcomingMilestones");vt=u.find("#menuMyTasks");yt=u.find("#menuUpcomingTasks");pt=u.find("#menuMyDiscussions");wt=u.find("#menuLatestDiscussion");fi();li();ii();l.on("click",function(){return l.hasClass(ut)?!1:!0});d.on("click",function(){var n=location.hash.substring(1),i=jq.getAnchorParam("responsible_for_milestone",n)||jq.getAnchorParam("tasks_responsible",n)||jq.getAnchorParam("project_manager",n)||jq.getAnchorParam("team_member",n)||jq.getAnchorParam("author",n),r={projectId:t||jq.getAnchorParam("project",n),milestoneId:jq.getAnchorParam("milestone",n)};return i&&(r.responsibles=[{id:i}]),ASC.Projects.TaskAction.showCreateNewTaskForm(r),h.hide(),!1});g.on("click",function(){return ASC.Projects.MilestoneAction.showNewMilestonePopup(),h.hide(),!1});nt.on("click",function(){var i=jq(".menu-list").find(".menu-item."+ft).attr("id"),n=jq.getURLParam("ID");return t?(i==="menuTasks"||document.location.href.toLowerCase().indexOf(et.toLowerCase())>0)&&n?k.showTimer(t,n):k.showTimer(t):k.showTimer(),h.hide(),!1});r.find(".expander").on("click",function(n){var t=jq(this).closest(".menu-sub-item");jq(t).hasClass(f)?jq(t).removeClass(f):jq(t).addClass(f);n.stopPropagation()})}function fi(){var c,h,o;jq(".menu-list li.filter, li.menu-item, div.menu-item, li.menu-sub-item").removeClass(s);c=location.pathname.split("/");h=c[c.length-1].toLowerCase();t=jq.getURLParam("prjID");h==="tmdocs.aspx"&&(a.removeClass("none-sub-list"),a.addClass("sub-list open"),t?a.find("a").attr("href","TMDocs.aspx"):(a.find("a").attr("href","#"),a.addClass(s)));t&&(h=w.toLowerCase());h===bt.toLowerCase()&&y.addClass(s);h===w.toLowerCase()&&(r.find("li[id="+t+"]").length?(e.addClass(f),r.addClass(hi),r.find("li[id="+t+"]").addClass(s)):e.addClass(n),e.addClass(ft));h===dt.toLowerCase()&&tt.addClass(s);h===kt.toLowerCase()&&p.addClass(s);h===et.toLowerCase()&&st.addClass(s);h==="reports.aspx"&&jq("#menuReports").addClass(n);h==="projecttemplates.aspx"&&ui.addClass(n);o=document.location.hash;h==="settings.aspx"&&(v.hasClass("open")||v.find(".expander").trigger("click"),o==="#status"?v.find(" .menu-sub-item:nth-child(2)").addClass(n):v.find(" .menu-sub-item:first").addClass(n));var l=jq(".menu-list").find(".menu-item."+n).attr("id"),u=!1,b=location.href.toLowerCase().indexOf(w.toLowerCase()),k=jq.getURLParam("action");!t&&!k&&b>0&&(o.indexOf("team_member="+i)>0?(r.length?it.closest("div").addClass(n):it.closest("li").addClass(n),u=!0):o.indexOf("followed=true")>0?(ht.parent("li").addClass(n),u=!0):o.indexOf("status=open")>0&&(ct.parent("li").addClass(n),e.addClass(f),u=!0),u&&e.removeClass(n));l==="menuMilestones"&&(u=!1,o.indexOf("user_tasks="+i)>0&&o.indexOf("status=open")>0?(lt.parent("li").addClass(n),u=!0):o.indexOf("user_tasks="+i)>0&&o.indexOf("&deadlineStart=")>0&&(at.parent("li").addClass(n),u=!0),u&&tt.removeClass(n));l==="menuTasks"&&p.hasClass(f)&&(u=!1,o.indexOf("tasks_responsible="+i)>0&&o.indexOf("status=open")>0?(vt.parent("li").addClass(n),u=!0):o.indexOf("tasks_responsible="+i)>0&&o.indexOf("&deadlineStart=")>0&&(yt.parent("li").addClass(n),u=!0),u&&p.removeClass(n));l=="menuMessages"&&y.hasClass(f)&&(u=!1,o.indexOf("author="+i)>0?(pt.parent("li").addClass(n),u=!0):o.indexOf("createdStart=")>0&&(wt.parent("li").addClass(n),u=!0),u&&y.removeClass(n))}function li(){var u=new Date,t=new Date(u.getFullYear(),u.getMonth(),u.getDate()),l=t.getTime(),c,a,h,w,f,k;t.setDate(t.getDate()+7);c=t.getTime();t=new Date(u.getFullYear(),u.getMonth(),u.getDate());a=t.getTime();t.setDate(t.getDate()-7);var d=t.getTime(),o=".category-wrapper a",g=[ot(e.find(o)),ot(it,"team_member="+i+"&status=open"),ot(ht,"status=open&followed=true"),ot(ct,"status=open"),gt(tt.find(o)),gt(lt,"user_tasks="+i+"&status=open"),gt(at,"user_tasks="+i+"&deadlineStart="+l+"&deadlineStop="+c),ni(p.find(o)),ni(vt,"tasks_responsible="+i+"&status=open"),ni(yt,"tasks_responsible="+i+"&deadlineStart="+l+"&deadlineStop="+c),ti(y.find(o)),ti(wt,"createdStart="+d+"&createdStop="+a),ti(pt,"author="+i),b(st.find("a"),et)],s=location.href.toLowerCase();if(jq.getURLParam("id")==null||s.contains("messages.aspx")&&!s.contains("action")||s.contains("tasks.aspx"))for(ai(g),h=r.find("li a"),w=function(){return function(){return ei()?(ASC.Projects.Common.goToWithoutReload.call(this),!1):!0}},f=0,k=h.length;f<k;f++)jq(h[f]).on("click",w(h[f]));if(s.contains("settings.aspx"))v.find(".menu-sub-item:nth-child(2) a").on("click",function(){var t=jq(this).parent();t.siblings().removeClass(n);t.addClass(n);ASC.Projects.Common.goToWithoutReload.call(jq(this))})}function ot(n,t){return b(n,w,rt.AllProject.basePath,t)}function gt(n,t){return b(n,dt,rt.AllMilestones.basePath,t)}function ni(n,t){return b(n,kt,rt.TasksManager.basePath,t)}function ti(n,t){return b(n,bt,rt.Discussions.basePath,t)}function b(n,t,i,r){var u=t;return r&&(u+="#"+i+"&"+r),{id:n,href:u}}function ai(n){n.forEach(function(n){n.id.attr("href",n.href);n.id.on("click",function(t){return oi.call(this,n,t)})})}function ii(){for(var n,e=ASC.Projects.Master.Projects,s=jq("#createNewProject"),a=jq("#createProjectTempl"),t=!1,i=!1,r=!1,u=!1,o=ASC.Projects.Master.CanCreateProject,f=0,v=e.length;f<v;f++)(n=e[f],n.status===0)&&(n.canCreateMilestone&&(t=!0),n.canCreateTask&&(i=!0),n.canCreateMessage&&(r=!0),n.canCreateTimeSpend&&n.taskCountTotal>0&&(u=!0));t?g.show():g.hide();i?d.show():d.hide();r?c.show():c.hide();u?nt.show():nt.hide();t||i||r||u||o?l.removeClass(ut):h.find(".dropdown-item-seporator").length===0?l.addClass(ut):h.find(".dropdown-item-seporator:first").hide();Teamlab.profile.isVisitor&&window.location.href.toLowerCase().indexOf("tmdocs.aspx")>-1&&l.addClass(ut);o||(s.hide(),a.hide())}function ei(){var n=document.location.pathname.match(/[^\/]+$/)[0].toLowerCase();return!!(window.history&&window.history.replaceState)&&!jq.getURLParam("action")&&(n===w.toLowerCase()||n===bt.toLowerCase()||n===kt.toLowerCase()||n===dt.toLowerCase()||n===et.toLowerCase()||n==="projectteam.aspx")}function oi(n,t){return ei()?t.which===1&&t.ctrlKey||t.which===2?!0:location.href.endsWith(n.href)?!1:(t.stopPropagation(),history.pushState({href:n.href},{href:n.href},n.href),k.baseInit(),!1):!0}var t,ri,k=ASC.Projects.Common,h,d,g,nt,c,l,a,y,p,tt,st,ui,v,si,e,r,u,it,ht,ct,lt,at,vt,yt,pt,wt,rt=ASC.Projects,o,f="open",n="active",ut="disable",ft="currentCategory",hi=f+" "+ft,s=n+" "+ft,w="Projects.aspx",bt="Messages.aspx",kt="Tasks.aspx",dt="Milestones.aspx",et="TimeTracking.aspx",i;return{init:ci,onClick:oi}}(jQuery);
ASC.Projects.TaskAction=function(){function ir(){hi=i.profile.id;y=jq.getURLParam("prjID");n=jq("#addTaskPanel");b=n.find("input.textEdit");f=n.find("textarea");g=n.find(".projectContaner");e=g.find(".advansed-select-container");s=jq("#taskMilestone");l=jq("#taskResponsible");h=jq("#taskStartDate");r=jq("#taskDeadline");r.val("");ct=jq("#notify");k=jq("#priority");it=jq("#copySubtasks");rt=jq("#copySubtasksContainer");d=jq("#copyFiles");kt=rt.find(".copy.files");lt=jq("#fullFormUserList");jq(e,s,l).css("max-width",300);jq.browser.mobile&&jq("#ui-datepicker-div").addClass("blockMsg");var t=jq(r).add(h);t.datepicker({selectDefaultDate:!1});t.mask(ASC.Resources.Master.DatePatternJQ);t.on("keydown",rr).off("change").on("change",li);r.on("change",function(){var t=ii(r),n=new Date;n.setHours(0);n.setMinutes(0);n.setSeconds(0);var u=i.serializeTimestamp(n),f=i.serializeTimestamp(new Date(n.getFullYear(),n.getMonth(),n.getDate()+3,0,0,0)),e=i.serializeTimestamp(new Date(n.getFullYear(),n.getMonth(),n.getDate()+7,0,0,0));t===u?tt(0):t===f?tt(3):t===e?tt(7):tt(-1)})}function rr(n){n.keyCode===13&&li(n)}function li(n){var t=jq(n.target),i=t.datepicker("getDate");t.unmask().trigger("blur").mask(ASC.Resources.Master.DatePatternJQ);t.datepicker("setDate",i)}function tt(t){var i="dotline",r="bold";n.find(".deadline_left").removeClass(r).removeClass(i).addClass(i);n.find("[data-value="+t+"]").removeClass(i).addClass(r)}function ur(){function s(n){if(ut){var t=a.getProjectsForFilter().filter(vi).map(ri);e.projectadvancedSelector("rewriteItemList",t,[]);n()&&t.length&&(e.projectadvancedSelector("reset"),e.projectadvancedSelector("selectBeforeShow",t[0]))}}n.on(vt,"#fullFormUserList .user",function(){var n=jq(this),t=n.attr("data-value");n.remove();l.advancedSelector("unselect",[t]);v=v.filter(function(n){return n.id!==t});v.length||lt.hide();ti()});n.on(vt,".deadline_left",function(){var t=parseInt(jq(this).attr("data-value"),10),n=new Date;n.setDate(n.getDate()+t);r.datepicker("setDate",n);tt(t)});jq("#saveTaskAction, #createTaskAndCreateNew").on(vt,function(){var n,r,h,f,s;jq(this).hasClass("disable")||(ai(),n=fr(),er(n))||(vr(),o===u.update?((t.milestoneId||0)!=parseInt(n.milestoneId,10)&&(r="taskLinksRemoveWarning"),t.links.length&&(h=t.links.some(function(n){return n.linkType==2&&n.parentTaskId==t.id})),!n.deadline&&h&&(r="taskLinksRemoveDeadlineWarning"),t.links.length&&r?ASC.Projects.Base.showCommonPopup(r,function(){for(var u,r=t.links,i=0;i<r.length;++i)u={dependenceTaskId:r[i].dependenceTaskId,parentTaskId:r[i].parentTaskId},Teamlab.removePrjTaskLink({},r[i].dependenceTaskId,u,{success:function(){}});pi({},t.id,n)},kr):pi({},t.id,n)):o===u.add?(f=e.attr("data-id"),s={saveAndView:jq(this).attr("id")=="saveTaskAction"},i.addPrjTask(s,f,n,{error:ui})):o===u.copy&&(f=e.attr("data-id"),n.copyFrom=t.id,n.copySubtasks=it.is(":checked"),n.copyFiles=d.is(":checked"),n.removeOld=jq(this).attr("id")=="createTaskAndCreateNew",s={saveAndView:!0,removeOld:n.removeOld},i.copyPrjTask(s,f,n,{error:ui})))});n.find("#closeTaskAction").on(vt,ei);var f=i.events;i.bind(f.addPrjMilestone,iu);i.bind(f.removePrjMilestone,function(n,t){c==t.projectId&&wt(t.projectId)});i.bind(f.addPrjTask,yr);i.bind(f.copyPrjTask,function(n,r){i.call(f.addPrjTask,this,[n,r]);n.removeOld&&i.call(f.removePrjTask,this,[n,t])});i.bind(f.updatePrjProjectStatus,function(n,t){s(function(){return c===t.id&&t.status===1})});i.bind(f.removePrjProjects,function(n,t){s(function(){var n=t.find(function(n){return n.id===c});return typeof n!="undefined"})});i.bind(f.removePrjProject,function(n,t){s(function(){return t.id===c})})}function ti(){var t=n.find(".notify"),i=v.length;if(!i||i===1&&v[0].id===hi){t.hide();return}t.show()}function ai(){n.find(".titlePanel").removeClass(yt);g.removeClass(yt);n.find(".startDate-error").hide();h.removeClass(st);r.removeClass(st)}function fr(){var n={title:b.val().trim(),description:f.val(),notify:ct.is(":checked"),milestoneId:s.attr("data-id"),priority:k.is(":checked")?1:0,projectId:e.attr("data-id")};v.length&&(n.responsibles=v.map(function(n){return n.id}));try{r.val().length&&(n.deadline=ii(r));h.val().length&&(n.startDate=ii(h))}catch(t){}return n}function ii(n){var t=n.datepicker("getDate");return t?(t.setHours(0),t.setMinutes(0),t.setSeconds(0),i.serializeTimestamp(t)):""}function er(t){var i=!1;return t.title.length||(n.find(".titlePanel").addClass(yt),i=!0),t.projectId||o===u.update||(g.addClass(yt),i=!0),or()&&(i=!0),i}function or(){var u=h.val().trim(),f=r.val().trim(),e,o,t=!1,i;return u==""&&f==""?!1:(u&&!jq.isDateFormat(u)?(h.addClass(st),t=!0):e=h.datepicker("getDate"),f&&!jq.isDateFormat(f)?(r.addClass(st),t=!0):o=r.datepicker("getDate"),e&&o&&e>o&&(i=n.find(".startDate-error"),i.text(i.attr("error")),i.show(),h.addClass(st),t=!0),t)}function sr(){hr();cr();lr();y&&ht({},et.Team)}function hr(){dt=a.getProjectsForFilter().filter(vi).map(ri);e.projectadvancedSelector({itemsChoose:dt,onechosen:!0,inPopup:!0,sortMethod:function(){return 0}});e.on("showList",function(n,t){e.attr("data-id",t.id).text(t.title).attr("title",t.title);ar(t)})}function vi(n){return n.canCreateTask}function ri(n){return{id:n.value,title:n.title}}function cr(){var n={onechosen:!0,inPopup:!0,sortMethod:a.milestoneSort,noresults:ASC.Resources.Master.ResourceJS.MilestoneSelectorNoResult,noitems:ASC.Resources.Master.ResourceJS.MilestoneSelectorNoItems};s.projectadvancedSelector(n);s.on("showList",function(n,t){s.attr("data-id",t.id).text(t.title).attr("title",t.title)})}function lr(){l.advancedSelector({showSearch:!0,inPopup:!0,noresults:at.NoActiveParticipantsNote}).on("showList",function(n,t){lt.empty().show();v=t;lt.html(jq.tmpl("projects_taskActionUser",[v]));ti();n.stopPropagation()})}function ar(i){c=i.id;c>0&&(jq(".popupActionPanel").hide(),n.find(".requiredErrorText.project").hide(),jq("#pm-milestoneBlock, #pm-respBlock").removeClass(nr),fi(),wt(c),c==y?ht({},et.Team):wi({},c),o===u.copy&&t&&(d.prop("checked",!1),c!==t.projectId?kt.hide():kt.show()))}function vr(){yi([b,f,h,r,ct,k,it,d],!0);jq(".success-popup, .error-popup").hide();ot.showLoaderBtn(n)}function pt(){yi([b,f,h,r,ct,k,it,d]);ot.hideLoaderBtn(n)}function yi(n,t){var i="disabled";n.forEach(function(n){t?n.prop(i,!0):n.prop(i,!1)})}function yr(i,r){i.saveAndView?(ei(),a.displayInfoPanel(at.TaskAdded)):(n.find("#taskLink").attr("href","Tasks.aspx?prjID="+r.projectId+"&id="+r.id),pt(),t=r,di(ki()),n.find(".success-popup").show(),b.trigger("focus"));var u=a.getProjectById(r.projectOwner.id);u&&u.taskCountTotal++;a.changeTaskCountInProjectsCache(r,0)}function ui(t,i){var r=n.find(".error-popup");ot.hideLoaderBtn(n);r.text(i[0]);r.show();setTimeout(r.hide,3e3);pt()}function pi(n,t,r){i.updatePrjTask(n,t,r,{error:ui})}function wt(n){var i=et.Milestones.filter(function(t){return t.status===0&&t.projectId==n}),r;gi=i;p=i.map(pr);p.unshift(ni);s.projectadvancedSelector("reset");s.projectadvancedSelector("rewriteItemList",p,[]);t&&(r=p.find(function(n){return n.id==t.milestoneId}),s.projectadvancedSelector("reset"),s.projectadvancedSelector("selectBeforeShow",r||ni))}function pr(n){return{id:n.id,title:"["+n.displayDateDeadline+"] "+n.title,deadline:n.deadline}}function wi(n,t){i.getPrjTeam(n,t,{success:ht})}function ht(n,i){w=a.excludeVisitors(i);w=a.removeBlockedUsersFromTeam(w);fi();t&&t.responsibles.length&&t.projectId==c&&w?l.advancedSelector("rewriteItemList",w.map(function(n){return{id:n.id,title:n.displayName}}),t.responsibles.map(function(n){return n.id})):l.advancedSelector("rewriteItemList",w.map(function(n){return{id:n.id,title:n.displayName}}),[]);bi()}function bi(){t&&t.responsibles.length&&t.projectId==c&&w&&l.trigger("showList",[t.responsibles.map(function(n){return{id:n.id,title:n.displayName}})]);t&&!t.responsibles.length&&o!==u.add&&fi();ti()}function fi(){l.advancedSelector("reset");l.advancedSelector("selectBeforeShow",[])}function ki(){var n={title:"",description:"",responsibles:[],priority:null,startDate:null,deadline:null};return y=jq.getURLParam("prjID"),y&&(n.projectId=y),n}function wr(n){return n&&(bt||e.attr("data-id")!=n.toString())}function di(t){var a,w,c;ai();n.find(".success-popup, .error-popup").hide();n.find(".notify");b.val(t.title);f.val(t.description);wr(t.projectId)?(a=dt.find(function(n){return n.id==t.projectId})||t.projectOwner,a?e.projectadvancedSelector("selectBeforeShow",a):(jq("#pm-milestoneBlock").hide(),wt(t.projectId),wi({},t.projectId))):(y&&(wt(t.projectId),ht({},et.Team)),t.milestoneId&&(s.projectadvancedSelector("reset"),w=p.find(function(n){return n.id==t.milestoneId}),s.projectadvancedSelector("selectBeforeShow",w||ni)),bi());c="setDate";t.deadline?(r.datepicker(c,t.deadline),r.trigger("change")):o!==u.add&&(r.datepicker(c,null),tt(-1));t.startDate?h.datepicker(c,t.startDate):o!==u.add&&h.datepicker(c,null);t.priority?k.prop("checked",!0):k.prop("checked",!1);o===u.update?(dr(),g.hide()):(f.height(60),g.show());var v=n.find("#saveTaskAction"),i=jq("#createTaskAndCreateNew"),l=nt.ProjectsCommonResource;o===u.update?(i.hide(),i.siblings(".splitter-buttons").first().hide(),rt.hide(),v.html(l.SaveChanges),n.find(".containerHeaderBlock table td:first").html(at.EditThisTask)):o===u.add?(i.show(),i.siblings(".splitter-buttons").show(),rt.hide(),v.html(l.Save),n.find(".containerHeaderBlock table td:first").html(at.CreateNewTask)):o===u.copy&&(i.html(l.Replace),i.show(),i.siblings(".splitter-buttons").show(),it.prop("checked",!1),d.prop("checked",!1),rt.show(),v.html(l.Copy),n.find(".containerHeaderBlock table td:first").html(nt.TaskResource.CopyTaskHeader));bt&&(bt=!1);ot.hideLoading()}function br(i){t=i;pt();di(i);ci.blockUI(n,550)}function kr(){pt();ci.blockUI(n,550)}function ei(){jq.unblockUI()}function dr(){var i="overflowY",r,t;f.height(60);f.css(i,"auto");var u=parseInt(f.attr("cols"),10),e=f.val(),n=e.split("\n").length;if(n>4){if(n>26){f.height(400);f.css(i,"scroll");return}f.height(n*15)}r=e.length;r>u*6&&(t=Math.floor(r/(u*2.5)),t>27?(f.height(400),f.css(i,"scroll")):t>n&&f.height(t*15))}function oi(n,t){if(!ut){var i=nt.TaskResource;jq("#addTaskPanel").html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"ASC.Projects.TaskAction.closeTaskForm();",IsPopup:!0},header:{data:{title:i.AddTask},title:"projects_common_popup_header"},body:{title:"projects_task_action",data:{title:{error:i.EachTaskMustHaveTitle,header:i.TaskTitle},description:i.TaskDescription,project:{error:i.ChooseProject,header:nt.ProjectResource.Project}}}}));ir();ur();sr();ut=!0}ot.displayLoading();o=t;br(n)}function iu(n,t){e.attr("data-id")==t.projectId&&(p.push({id:t.id,title:"["+t.displayDateDeadline+"] "+t.title,deadline:t.deadline}),s.projectadvancedSelector("rewriteItemList",p,[]))}var u={add:0,update:1,copy:2},si,o=u.add,bt=!0,t=null,n=null,b=null,f=null,e=null,s=null,l=null,h=null,r=null,ct=null,k=null,it=null,d=null,rt=null,kt=null,lt=null,g,hi,y,gi=[],ut,ft=[],dt=[],p=[],gt=ASC.Projects,et=gt.Master,nt=gt.Resources,at=nt.ProjectsJSResource,ni={id:0,title:nt.TaskResource.None,deadline:""},a=gt.Common,ot=LoadingBanner,ci=StudioBlockUIManager,w,vt="click",st="red-border",nr="display-none",yt="requiredFieldError",i,c,v=[],tr=function(){si||(si=!0,i=Teamlab)},gr=function(n){oi(jq.extend(ki(),n),u.add)},nu=function(n){oi(n,u.update)},tu=function(n){oi(n,u.copy)},ru=function(){ut&&y==e.attr("data-id")&&ht({},et.Team)},uu=function(n){function f(n){return n.canCreateTask&&(!r||ft.some(function(t){return n.value==t}))}var i,t,r,u;if(ut){if(n.length===ft.length){for(i=!0,t=n.length-1;t>=0;--t)if(ft[t]!==n[t]){i=!1;break}if(i)return}ft=n;r=ft.length;u=a.getProjectsForFilter();e.projectadvancedSelector("rewriteItemList",u.filter(f).map(ri),[])}};return{init:tr,showUpdateTaskForm:nu,showCreateNewTaskForm:gr,showCopyTaskForm:tu,onUpdateProjectTeam:ru,filterProjectsByIdInCombobox:uu,closeTaskForm:ei}}(jQuery);
ASC.Projects.MilestoneAction=function(){function wt(){function e(n){if(ot){var t=s.getProjectsForFilter().filter(kt).map(dt);u.projectadvancedSelector("rewriteItemList",t,[]);n()&&t.length&&(u.projectadvancedSelector("reset"),u.projectadvancedSelector("selectBeforeShow",t[0]))}}if(!st){st=!0;jq("#milestoneActionPanel").html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"PopupKeyUpActionProvider.CloseDialog();",IsPopup:!0},header:{data:{title:v.ProjectResource.AddMilestone},title:"projects_common_popup_header"},body:{title:"projects_milestone_action",data:{title:{error:v.MilestoneResource.NoTitleMessage,header:v.MilestoneResource.Title},description:v.MilestoneResource.Description,project:{header:v.ProjectResource.Project,error:v.MilestoneResource.ChooseProject}}}}));n=jq("#milestoneActionPanel");o=jq("#milestoneResponsibleContainer");a=o.find("#milestoneResponsible");b=o.find(".notifyResponsibleContainer");t=jq("#milestoneDeadlineInputBox");g=jq("#milestoneDeadlineContainer");h=n.find(".projectContaner");u=h.find(".advansed-select-container");nt=n.find(".titlePanel");c=n.find(".textEdit");y=n.find("textarea");p=jq("#milestoneKeyCheckBox");w=jq("#milestoneNotifyManagerCheckBox");l=jq("#milestoneActionButton");yt=n.find(".deadlineLeft");ut=jq("#notifyResponsibleCheckbox");vt=i.profile.id;f=jq.getURLParam("prjID");i.profile.isAdmin&&(ei=!0);t.on("change",function(){t.val().trim()!=""&&g.removeClass(r);var u=bt(),n=new Date,f=i.serializeTimestamp(new Date(n.getFullYear(),n.getMonth(),n.getDate()+7,0,0,0)),e=i.serializeTimestamp(new Date(n.getFullYear(),n.getMonth()+1,n.getDate(),0,0,0)),o=i.serializeTimestamp(new Date(n.getFullYear(),n.getMonth()+2,n.getDate(),0,0,0));u===f?k(7):u===e?k(1):u===o?k(2):k(-1)});c.on("keyup",function(){c.val().trim()!=""&&nt.removeClass(r)});yt.on("click",function(){var i=parseInt(jq(this).attr("data-value")),n;k(i);n=new Date;i==7?n.setDate(n.getDate()+i):n.setMonth(n.getMonth()+i);t.datepicker("setDate",n)});l.on("click",function(){var s,i,e;if(!l.hasClass(et))return(h.removeClass(r),o.removeClass(r),g.removeClass(r),nt.removeClass(r),f=jq.getURLParam("prjID"),s=n.attr("milestoneId"),i={projectId:u.attr("data-id")||f,responsible:a.attr("data-id"),notifyResponsible:ut.is(":checked"),title:c.val().trim(),description:y.val(),isKey:p.is(":checked"),isNotify:w.is(":checked")},t.val().length&&jq.isDateFormat(t.val())&&(i.deadline=bt()),e=!1,i.projectId||(h.addClass(r),e=!0),i.responsible||(b.hide(),o.addClass(r),e=!0),i.deadline||(g.addClass(r),e=!0),i.title.length||(nt.addClass(r),e=!0),i.projectId||(h.addClass(r),e=!0),e)?!1:(tt.showLoaderBtn(n),n.attr("type")=="update"?vi(s,i):ai(i),!1)});jq("#milestoneActionCancelButton").on("click",function(){location.href.toLowerCase().indexOf(pt)>0&&ASC.Projects.GantChartPage.enableChartEvents()});i.bind(i.events.updatePrjProjectStatus,function(n,t){e(function(){return it===t.id&&t.status===1})});i.bind(i.events.removePrjProjects,function(n,t){e(function(){var n=t.find(function(n){return n.id===it});return typeof n!="undefined"})});i.bind(i.events.removePrjProject,function(n,t){e(function(){return t.id===it})})}}function bt(){var n=t.datepicker("getDate");return n?(n.setHours(0),n.setMinutes(0),n.setSeconds(0),i.serializeTimestamp(n)):""}function kt(n){return n.canCreateMilestone}function dt(n){return{id:n.value,title:n.title}}function ci(n,t){h.removeClass(r);o.show();b.hide();f=jq.getURLParam("prjID");f==n.id?ct({serverData:!0,responsible:t}):ui(n.id,{responsible:t})}function yi(n){n.keyCode===13&&ri(n)}function ri(n){var t=jq(n.target),i=t.datepicker("getDate");t.unmask().trigger("blur").mask(ASC.Resources.Master.DatePatternJQ);t.datepicker("setDate",i)}function k(t){var i="dotline",r="bold";n.find(".deadlineLeft").removeClass(r).removeClass(i).addClass(i);n.find("[data-value="+t+"]").removeClass(i).addClass(r)}function pi(n,i){ti();f=jq.getURLParam("prjID");ASC.Projects.Master.Milestones.push(i);ASC.Projects.Master.Milestones=ASC.Projects.Master.Milestones.sort(s.milestoneSort);jq.unblockUI();s.displayInfoPanel(ht.MilestoneAdded);t.unmask();s.changeMilestoneCountInProjectsCache(i,0);lt(i.id,i.projectId,0)}function ui(n,t){i.getPrjProjectTeamPersons(t,n,{success:ct})}function fi(){StudioBlockUIManager.blockUI(n,550);c.trigger("focus")}var at,ot,ei,vt,f,st,d=[],rt=[],u,a,t,o,b,g,h,nt,c,n,yt,y,p,w,l,ut,r="requiredFieldError",e="disabled",ft="display-none",et="disable",pt="ganttchart.aspx",v=ASC.Projects.Resources,ht=v.ProjectsJSResource,s=ASC.Projects.Common,i,tt,it,oi=function(){at||(i=Teamlab,tt=LoadingBanner,at=!0)},si=function(){jq(u,a).css("max-width",300);rt=s.getProjectsForFilter().filter(kt).map(dt);u.projectadvancedSelector({itemsChoose:rt,onechosen:!0,inPopup:!0,sortMethod:function(){return 0}});u.on("showList",function(n,t,i){u.attr("data-id",t.id).text(t.title).attr("title",t.title);it=t.id;ci(t,i)})},hi=function(){var n={onechosen:!0,inPopup:!0,noresults:ASC.Resources.Master.ResourceJS.UserSelectorNoResults};f=jq.getURLParam("prjID");f&&(n.itemsChoose=s.excludeVisitors(ASC.Projects.Master.Team).map(function(n){return{id:n.id,title:n.displayName}}));a.projectadvancedSelector(n);a.on("showList",function(n,t){a.attr("data-id",t.id).html(t.title).attr("title",t.title);li(t)});o.show()},gt=function(n){ot||(ot=!0,si(n),hi(n));f=jq.getURLParam("prjID");var t=location.hash.substring(1),r=f||jq.getAnchorParam("project",t),i=rt.find(function(n){return n.id==r}),e=jq.getAnchorParam("responsible_for_milestone",t)||jq.getAnchorParam("tasks_responsible",t)||jq.getAnchorParam("project_manager",t)||jq.getAnchorParam("team_member",t)||jq.getAnchorParam("author",t);i&&u.projectadvancedSelector("selectBeforeShow",i,n?n.resposible:e)},li=function(n){o.removeClass(r);n.id&&n.id!=vt?(b.show(),ut.prop("checked",!0)):b.hide()},ai=function(n){ni();var t={projectId:n.projectId};i.addPrjMilestone(t,n.projectId,n,{success:pi,error:wi})},vi=function(n,t){ni();i.updatePrjMilestone({},n,t,{success:function(t,i){lt(n,i.projectId,0);for(var r=0;r<ASC.Projects.Master.Milestones.length;r++)if(ASC.Projects.Master.Milestones[r].id==i.id){ASC.Projects.Master.Milestones[r]=i;break}}})},ni=function(){t.prop(e,!0);c.prop(e,!0);y.prop(e,!0);p.prop(e,!0);w.prop(e,!0)},ti=function(){st&&(t.prop(e,!1),c.prop(e,!1).val(""),y.prop(e,!1).val(""),p.prop(e,!1).prop("checked",!1),w.prop(e,!1),tt.hideLoaderBtn(n))},ii=function(){n.removeAttr("type");ut.prop("checked",!0);u.attr("data-id")||(o.hide(),b.hide());h.removeClass(r);g.removeClass(r);t.val("");t.datepicker({popupContainer:"#milestoneActionPanel",selectDefaultDate:!0});t.mask(ASC.Resources.Master.DatePatternJQ);t.on("keydown",yi).on("change",ri);jq.browser.mobile&&jq("#ui-datepicker-div").addClass("blockMsg");var i=new Date;i.setDate(i.getDate()+7);t.datepicker("setDate",i);k(7);o.removeClass(r);a.projectadvancedSelector("reset");nt.removeClass(r);c.val("");y.val("");p.prop("checked",!1);w.prop("checked",!1);tt.hideLoaderBtn(n)},wi=function(i,r){var o,s,u;for(location.href.toLowerCase().indexOf(pt)>0&&ASC.Projects.GantChartPage.enableChartEvents(),o=n.find(".errorBox"),s=jq("#milestoneActionButtonsContainer"),o.text(r[0]),o.removeClass(ft),l.addClass(et),tt.hideLoaderBtn(n),s.css("marginTop","8px"),s.show(),setTimeout(function(){o.addClass(ft);s.css("marginTop","43px");t.prop(e,!1);c.prop(e,!1);y.prop(e,!1);p.prop(e,!1);w.prop(e,!1)},3e3),f=jq.getURLParam("prjID"),location.href.toLowerCase().indexOf("milestones.aspx")>0&&f==i.projectId&&ASC.Projects.AllMilestones.removeMilestonesActionsForManager(),u=0;u<ASC.Projects.Master.Projects.length;u++)if(i.projectId==ASC.Projects.Master.Projects[u].id){ASC.Projects.Master.Projects[u].canCreateMilestone=!1;break}},ct=function(n,t){var u,r,f,e;n.serverData&&!t&&(t=ASC.Projects.Master.Team);t=s.excludeVisitors(t);t=s.removeBlockedUsersFromTeam(t);t=t.filter(function(n){return!n.isVisitor}).map(function(n){return{id:n.id,title:n.id==i.profile.id?ASC.Resources.Master.ResourceJS.MeLabel:n.displayName}});u=t.find(function(t){return t.id==n.responsible});u?r=u:(f=jq("#noActiveParticipantsMilNote"),t.length?(e=s.getProjectById(it),f.addClass(ft),l.removeClass(et),r=t.find(function(n){return n.id===e.responsibleId})||t[0]):(f.removeClass(ft),l.addClass(et),r=[{id:"",title:v.ProjectsCommonResource.Select}]));a.projectadvancedSelector("rewriteItemList",t,[r.id]);a.projectadvancedSelector("selectBeforeShow",r);h.is(":visible")&&o.show()},lt=function(n,t,r){i.getPrjTeam({},t,function(i,u){var f=ASC.Resources.Master.ApiPath+"calendar/caldavevent.json",e={calendarId:"Project_"+t,uid:"Milestone_"+n,responsibles:jq.map(u,function(n){return n.id})};jq.ajax({type:r===0||r===1?"put":"delete",url:f,data:e,complete:function(){}})})},bi=function(i){var e,r;wt();gt(i);ii();n.attr("type","update");n.attr("milestoneId",i.id);l.html(l.attr("update"));e=n.find(".containerHeaderBlock table td:first");e.html(ht.EditMilestone);i.deadline&&(t.datepicker("setDate",i.deadline),t.trigger("change"));c.val(i.title);y.val(i.description);h.hide();s.currentUserIsModuleAdmin()||s.currentUserIsProjectManager(i.project)||o.hide();p.prop("checked",i.isKey);w.prop("checked",i.isNotify);f=jq.getURLParam("prjID");f==i.project&&u.attr("data-id")==f?ct({serverData:!0,responsible:i.responsible}):(r=rt.find(function(n){return n.id==i.project}),r?u.trigger("showList",[r,i.responsible]):(u.attr("data-id",i.project),ui(i.project,{responsible:i.responsible})));fi()},ki=function(){wt();gt();ii();l.html(l.attr("add"));var t=n.find(".containerHeaderBlock table td:first");return t.html(ht.AddMilestone),h.show(),u.attr("data-id")&&o.show(),fi(),!1},di=function(n){function e(n){return n.canCreateMilestone&&(!r||d.some(function(t){return n.value==t}))}function o(n){return{id:n.value,title:n.title}}var i,t,r,f;if(n.length===d.length){for(i=!0,t=n.length-1;t>=0;--t)if(d[t]!==n[t]){i=!1;break}if(i)return}d=n;r=d.length;f=s.getProjectsForFilter();u.projectadvancedSelector("rewriteItemList",f.filter(e).map(o),[])};return{init:oi,showNewMilestonePopup:ki,onGetMilestoneBeforeUpdate:bi,updateCaldavMilestone:lt,unlockMilestoneActionPage:ti,filterProjectsByIdInCombobox:di}}(jQuery);jq(document).ready(function(){autosize(jq("textarea"))});
ASC.Projects.projectNavPanel=function(){function nt(t,f){var k;if(Number(jq.getURLParam("id"))===0&&jq.getURLParam("action")==null){n=f;var l=s.ProjectsJSResource,e=ASC.Projects.ProjectTab.bind(null,n),b=ASC.Projects.navSidePanel.onClick;v=new e(l.OverviewModule,function(){return 0},"Projects.aspx","overViewModule",b);h=new e(l.TasksModule,function(){return n.taskCount},"Tasks.aspx","tasksModule",b,function(){return!0});c=new e(l.MilestonesModule,function(){return n.milestoneCount},"Milestones.aspx","milestonesModule",b,function(){return!0});y=new e(l.DiscussionsModule,function(){return n.discussionCount},"Messages.aspx","messagesModule",b,function(){return n.security.canReadMessages});r=new e(l.TimeTrackingModule,function(){return n.timeTrackingTotal},"TimeTracking.aspx","timetrackingModule",b,function(){return!i.profile.isVisitor});p=new e(l.DocumentsModule,function(){return n.documentsCount},"TMDocs.aspx","tmdocsModule",null,function(){return n.security.canReadFiles});u=new e(l.ContactsModule,function(){return n.contactsCount},"Contacts.aspx","contactsModule",null,function(){return n.security.canReadContacts});o=new e(l.TeamModule,function(){return n.participantCount},"ProjectTeam.aspx","projectteamModule",b);w=new e(s.ProjectResource.GanttGart,function(){return 0},"GanttChart.aspx","ganttchartModule",null,function(){return!jq.browser.mobile&&n.status===0&&n.security.canReadTasks&&n.security.canReadMilestones});k={icon:"projects",title:n.title,private:n.isPrivate};ASC.Projects.InfoContainer.init(k,tt,[v,h,c,y,r,p,u,o,w]);a=jq(d);jq("#projectTabs").removeClass("display-none");jq("#CommonListContainer").show()}}function tt(){var t=[],i;return n.canEdit&&t.push(new ASC.Projects.ActionMenuItem("pa_edit",e.Edit,it)),n.canDelete&&t.push(new ASC.Projects.ActionMenuItem("pa_delete",e.Delete,rt)),i=ASC.Projects.Master.Team.some(function(n){return n.id===Teamlab.profile.id}),Teamlab.profile.isOutsider||i||t.push(new ASC.Projects.ActionMenuItem("pa_follow",n.isFollow?e.Unfollow:e.Follow,ut)),{menuItems:t}}function it(){location.href="Projects.aspx?prjID="+n.id+"&action=edit"}function rt(){ASC.Projects.Base.showCommonPopup("projectRemoveWarning",function(){i.removePrjProject(n.id,{success:st,error:ht})})}function ut(){i.subscribeProject({followed:!n.isFollow},f,{success:ot})}function ft(){function s(n){var t=n.trim();return typeof n=="number"&&(t=jq.timeFormat(t)),t===""&&(t="00:00"),t=t.split(":"),{hours:parseInt(t[0],10),minutes:parseInt(t[1],10)}}function h(n){return(n.minutes>59&&(n.hours+=1,n.minutes-=60),n.minutes<0&&(n.hours-=1,n.minutes+=60),n.hours===0&&n.minutes===0)?"":jq.format("{0}:{1}{2}",n.hours,n.minutes<10?"0":"",n.minutes)}var e=i.events;et();t(e.getPrjProject,nt);t(e.removePrjTask,function(t,u){u.status!==2&&u.projectId==f&&jq.getURLParam("id")===null&&i.getPrjTimeById({},n.id,{success:function(t,i){n.timeTrackingTotal=i;r.rewrite()}})});t(e.updatePrjTeam,function(t,i){n.participantCount=i.length;o.rewrite()});t(e.removePrjTeam,function(){n.participantCount--;o.rewrite()});t(e.getCrmContactsForProject,function(t,i){n.contactsCount=i.length;u.rewrite()});t(e.addCrmContactForProject,function(){n.contactsCount++;u.rewrite()});t(e.removeCrmContactFromProject,function(){n.contactsCount--;u.rewrite()});t(e.removePrjTime,function(t,i){var u,f,e;if(n){for(u=s(n.timeTrackingTotal),f=i.length;f--;)e=s(i[f].hours),u.hours-=e.hours,u.minutes-=e.minutes;n.timeTrackingTotal=h(u);r.rewrite()}});t(e.updatePrjTime,function(t,i){var f=t.oldTime,e=s(i.hours),u=s(n.timeTrackingTotal);u.hours-=f.hours;u.hours+=e.hours;u.minutes-=f.minutes;u.minutes+=e.minutes;n.timeTrackingTotal=h(u);r.rewrite()})}function t(n,t){l.push(i.bind(n,t))}function et(){while(l.length){var n=l.shift();i.unbind(n)}}function ot(t){n.isFollow=t.followed}function st(){jq.unblockUI();ASC.Projects.Common.goToHrefWithoutReload("/Products/Projects/")}function ht(){jq.unblockUI()}function ct(){f=undefined;typeof a!="undefined"&&a.hide()}function lt(){h.rewrite()}function at(){c.rewrite()}var v,h,c,y,r,p,o,w,u,f,b,i,k,s,e,n,l=[],d=".project-info-container",a,g=function(){f!==jq.getURLParam("PrjID")&&(i=Teamlab,k=LoadingBanner,s=ASC.Projects.Resources,e=s.ProjectsCommonResource,f=jq.getURLParam("PrjID"),b||ft(),b=!0)};return{init:g,hide:ct,rewriteTaskTab:lt,rewriteMilestoneTab:at}}(jQuery);
ASC.Projects.ProjectsAdvansedFilter=function(){function to(){if(wt=!0,delete window.userSelector,typeof c!="undefined"){var n=jq("#ProjectsAdvansedFilter").is(":visible");n&&c.attr("style","visibility:visible");c.removeClass("is-init");jq("#ProjectsAdvansedFilter").advansedFilter("resetText")}}function io(n){er=n.basePath;var t=/sortBy=(.+)\&sortOrder=(.+)/ig.exec(er);t&&t.length===3&&(lu=t[1]);ui=n}function ue(){var d=location.hash.substring(1),f,y,e,w,n,r,t,o,v,u,k;if(d===""){ASC.Projects.Common.setHash("");return}for(f=p(bi),y=p(ki),f||(f=lu),e=0,w=b.filters.length;e<w;e++)if(n=b.filters[e],n.visible)if(n.id==="text"?r=p(n.id):n.id.indexOf(hu)>-1&&(t=n.id.substring(hu.length),i&&t.endsWith("_p")&&(t=t.substring(0,t.length-2)),r=n.type===l?p(t+"Start"):p(t)),o=p(n.groupby),r||o)switch(n.type){case s:case di:n.params={id:r.toLowerCase()};break;case h:case"text":v=(r||o).toLowerCase();n.options.some(function(n){return n.value==v})&&(n.params={value:v});break;case a:n.params={};break;case l:n.params={from:r,to:p(n.id.substring(2)+"Stop")}}else n.reset=!0,delete n.params;for(u=0,k=b.sorters.length;u<k;u++)b.sorters[u].selected=b.sorters[u].id===f,b.sorters[u].sortOrder=y;c.advansedFilter({filters:b.filters,sorters:b.sorters})}function rr(n){return n.id||n.value}function r(n,t,i){return jq.changeParamValue(n,t,i)}function oo(n,t){var i=ir(t,"anchor"),r=location.hash.substring(1);if(wt&&r.length&&!ro(i)){wt=!1;ue();return}wt?wt=!1:ASC.Projects.PageNavigator.reset();ui.currentFilter=ir(t,"data");ui.getData();i!==r&&ASC.Projects.Common.setHash(i)}function so(n,t){ASC.Projects.PageNavigator.reset();var i=ir(t,"anchor");ASC.Projects.Common.setHash(i);ui.currentFilter=ir(t,"data");ui.getData()}function ei(n,t,r,u,f){i=jq.getURLParam("prjID");su=uo();tr=fo();d=eo();var e=yo(r);return ao(t,e),po(f,e),lo(u,e),vo(n,e),b=e,e}function t(n,t,i,r,u,f,e,o,s,h,c,l){var a={type:i,id:r,title:u,filtertitle:f,group:e,hashmask:o,groupby:s,visible:n,enable:n};typeof h!="undefined"&&h!=null&&(a.options=h);typeof c!="undefined"&&c!=null&&(a.bydefault=c);typeof l!="undefined"&&l!=null&&(a.defaulttitle=l);t.push(a)}function g(r,u,e,o,c){t(r,u,i?h:s,e,n.Me,o+":",o,f,c,i?d:null,{id:y})}function ee(i,r,u,f){t(i,r,di,dt,n.Groups,n.Group+":",u,ne,f)}function oi(i,r,u){for(var e,o=u.some(function(n){return typeof n.sub!="undefined"}),f=0,s=u.length;f<s;f++)e=u.map(function(n){return jq.extend({},n)}),e[f].def=!0,e[f].sub?t(i,r,h,e[f].value,e[f].title,n.ByStatus+":",n.ByStatus,fu,gf,e[f].sub):t(i,r,h,e[f].value,e[f].title,n.ByStatus+":",n.ByStatus,fu,gf,o?[e[f]]:e)}function ur(r,u){t(i==null&&r,u,a,ti,n.MyProjects,"",n.ByProject,ti,gi);t(i==null&&r,u,h,ni,n.OtherProjects,n.ByProject+":",n.ByProject,we,gi,pt.getProjectsForFilter(),null,n.Select);t(i==null&&r,u,h,gt,n.ByTag,n.ByTag+":",n.ByProject,null,gi,tr,null,n.Select);t(i==null&&r,u,a,lt,n.WithoutTag,"",n.ByProject,lt,gi)}function fr(n,i){var u="hidden",r;for(i=i||1,r=0;r<i;r++)t(!1,n,a,u+r,u,"",u+r)}function e(n,t,i,r,u,f){for(var e,h=!1,o=0,s=t.length;o<s;o++)if(e=t[o],e.id===i){n&&!e.visible&&(e.visible=!0);e.def=f;h=!0;break}if(f)for(o=0;o<s;o++)(e=t[o],e.id!==i)&&e.def&&!e.visible&&(e.def=!1);h||t.push({id:i,title:r,sortOrder:u,def:f,visible:n})}function si(n,t,i){for(var r=t,u=n.length;r<u;r++)n[r].id=i+n[r].id,n[r].groupid=i+n[r].group}function o(n){return n+"_p"}function oe(n,t,i){var u=jq.changeParamValue(location.hash.substring(1),n,t),r,f;if(i)for(r=0,f=i.length;r<f;r++)u=jq.removeParam(i[r],u);ASC.Projects.Common.setHash(u);ue()}function ts(n,t,i){t!=="4a515a15-d4d6-4b8e-828e-e0586f18f3a3"&&oe(n,t,i)}var wt=!0,er="",lu="",c,b,au="t_",vu="p_",yu="m_",pu="d_",wu="r_",hi="team_member",or="me_team_member",bt="me_responsible_for_milestone",st="responsible_for_milestone",sr="me_project_manager",ci="project_manager",li="me_author",ht="author",hr="user",ut="me_tasks_responsible",nt="tasks_responsible",cr="me_tasks_creator",ai="tasks_creator",kt="me_tasks",ct="user_tasks",vi="noresponsible",dt="group",ft="followed",gt="tag",lt="notag",lr="text",ni="project",ti="myprojects",v="milestone",at="mymilestones",yi="nomilestones",ar="status",bu="substatus",k="open",tt="closed",vr="archived",yr="paused",pr="notChargeable",wr="notBilled",br="billed",ku="period",du="today2",kr="created",gu="previousweek2",nf="previousmonth2",tf="period2",et="overdue",pi="today",wi="upcoming",dr="recent",se="today3",he="yesterday",ce="currentweek",le="previousweek",ae="currentmonth",ve="previousmonth",ye="currentyear",pe="previousyear",ii="deadline",rf="deadlineStart",uf="deadlineStop",ff="createdStart",ef="createdStop",sf="periodStart",hf="periodStop",gr="entity",cf="project_entity",lf="milestone_entity",af="discussion_entity",vf="team_entity",yf="task_entity",pf="subtask_entity",wf="time_entity",bf="comment_entity",bi="sortBy",ki="sortOrder",s="person",h="combobox",a="flag",di="group",l="daterange",u="userid",kf="creatorid",nu="taskuserid",df="managerid",gi="projectGroup",gf="status",tu="createdGroup",ot="deadlineGroup",iu="periodGroup",vt="/{0}",ru=vt+"/{1}",f=s+vt,uu=kr+ru,fu=h+vt,yt=ii+ru,ne=dt+vt,we=ni+vt,be=v+vt,eu=ku+ru,it="ascending",w="descending",ke="comments",ri="create_on",nr="title",te="deadline",ou=[hi,or,bt,st,sr,ci,li,ht,hr,ut,nt,cr,ai,kt,ct,vi,dt,ft,gt,lr,ni,ti,v,yi,at,ar,bu,k,tt,vr,yr,"payment_status",pr,wr,br,et,pi,wi,dr,rf,uf,ff,ef,sf,hf,gr,cf,lf,af,vf,yf,pf,wf,bf,bi,ki],ie,ui,rt=Teamlab,re=ASC.Projects,de=re.Resources,n=de.ProjectsFilterResource,pt=re.Common,i=jq.getURLParam("prjID"),y=rt.profile.id,su,tr,d,ge=jq("body"),no="click.filter",hu,cu,fi=function(n,t,r){if(ie=this,i=jq.getURLParam("prjID"),hu=n,to(),io(t),typeof c=="undefined")ge.on(no,".clearFilterButton",function(){return c.advansedFilter(null),!1});c=jq("#ProjectsAdvansedFilter").advansedFilter({store:!0,anykey:!0,hintDefaultDisable:!1,colcount:3,anykeytimeout:1e3,filters:r.filters,sorters:r.sorters}).off("setfilter").off("resetfilter").on("setfilter",oo).on("resetfilter",so)},p=function(n,t){var u="[#&]"+n+"=([^&]*)",f=new RegExp(u),r="#",i;return r+=t?t:location.hash.substring(1),i=f.exec(r),i==null?"":i[1]},ro=function(n){var t=location.hash.substring(1),f=p(ki,t),e=p(bi,t),i,r,u;for(e===""&&f===""&&(t=er+"&"+t),i=ou.length;i--;)if(r=p(ou[i],n),u=p(ou[i],t),r!==u)return!1;return!0},ir=function(n,t){var f={},u="",b=n.advansedFilter(),c,l,h="true",d,w,p;for(i&&(f.projectId=i),d=b.length,ie.baseFilter=d===1&&b[0].id==="sorter",w=0;w<d;w++){var g=b[w],e=g.params,it=g.options,a=e.id,s=e.value,y=g.id;y!=="sorter"&&y!=="text"&&(y=y.substring(2));switch(y){case or:case hi:f.participant=a;u=r(u,hi,f.participant);break;case sr:case ci:f.manager=a;u=r(u,ci,f.manager);break;case bt:case o(bt):case st:case o(st):f.milestoneResponsible=rr(e);u=r(u,st,f.milestoneResponsible);break;case ut:case o(ut):case nt:case o(nt):f.participant=rr(e);u=r(u,nt,f.participant);break;case cr:case ai:f.creator=a;u=r(u,ai,f.creator);break;case li:case ht:case o(ht):f.participant=rr(e);u=r(u,ht,f.participant);break;case hr:f.user=a;u=r(u,hr,f.user);break;case dt:f.departament=a;u=r(u,dt,f.departament);break;case yi:f.nomilestone=h;u=r(u,yi,h);break;case at:f.mymilestones=h;u=r(u,at,h);break;case v:if(s===null)continue;f.milestone=s;u=r(u,v,f.milestone);break;case vi:f.participant="00000000-0000-0000-0000-000000000000";u=r(u,vi,h);break;case ti:f.myprojects=h;u=r(u,ti,h);break;case ni:if(s===null)continue;f.projectId=s;u=r(u,ni,f.projectId);break;case kt:case o(kt):case ct:case o(ct):f.taskResponsible=rr(e);u=r(u,ct,f.taskResponsible);break;case ft:f.follow=h;u=jq.changeParamValue(u,ft,h);break;case gt:if(s===null)continue;f.tag=s;u=r(u,gt,f.tag);break;case lt:f.tag=-1;u=r(u,lt,h);break;case k:case yr:case vr:case tt:case ar:case pr:case wr:case br:if(s===null)continue;p=it.find(function(n){return n.value==s});p&&typeof p.sub=="boolean"&&p.sub?(f.substatus=p.value,u=r(u,bu,f.substatus)):(f.status=s,u=r(u,ar,f.status));break;case et:f.status="open";f.deadlineStop=rt.serializeTimestamp(new Date);u=r(u,et,h);break;case pi:case wi:case ii:c=e.from;l=e.to;f.deadlineStart=rt.serializeTimestamp(new Date(c));f.deadlineStop=rt.serializeTimestamp(new Date(l));u=r(u,rf,c);u=r(u,uf,l);break;case du:case dr:case kr:case gu:case nf:case tf:c=e.from;l=e.to;f.createdStart=rt.serializeTimestamp(new Date(c));f.createdStop=rt.serializeTimestamp(new Date(l));u=r(u,ff,c);u=r(u,ef,l);break;case se:case he:case ce:case le:case ae:case ve:case ye:case pe:case ku:c=e.from;l=e.to;f.periodStart=rt.serializeTimestamp(new Date(c));f.periodStop=rt.serializeTimestamp(new Date(l));u=r(u,sf,c);u=r(u,hf,l);break;case lr:f.FilterValue=s;u=r(u,lr,f.FilterValue);break;case cf:case lf:case af:case vf:case yf:case pf:case wf:case bf:case gr:if(s===null)continue;f.entity=s;u=r(u,gr,f.entity);break;case"sorter":f.sortBy=a;f.sortOrder=e.sortOrder;u=r(u,bi,f.sortBy);u=r(u,ki,f.sortOrder)}}return t==="anchor"?u:f},uo=function(){var n=ASC.Projects.Master.Milestones;return n?(i&&(n=n.filter(function(n){return n.status===0&&n.projectId==i})),n.map(function(n){return{value:n.id,title:jq.format("[{0}] {1}",n.displayDateDeadline,n.title)}})):[]},fo=function(){return ASC.Projects.Master.Tags},eo=function(){return typeof ASC.Projects.Master.Team=="undefined"?[]:ASC.Projects.Master.Team.map(function(n){return{value:n.id,title:n.displayName}})},fe=function(){typeof c!="undefined"&&typeof c.filter!="undefined"&&c.advansedFilter("resize")},ho=function(){typeof c!="undefined"&&c.hide()},co=function(){if(typeof c!="undefined"){var n=jq("#ProjectsAdvansedFilter").is(":visible");n||(c.show(),fe())}},lo=function(r,c){var p=new Date,g=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0),nt=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0),v,tt,b;return nt.setDate(nt.getDate()-7),v=[],c&&c.filters&&(v=c.filters),tt=v.length,t(typeof pt.userInProjectTeam(y)!="undefined"&&i!=null&&r,v,h,o(li),n.MyDiscussions,n.Author+":",n.Author,f,u,d,{value:y}),t(i!=null&&r,v,h,o(ht),n.OtherParticipant,n.Author+":",n.ByParticipant,f,u,d,{value:y}),t(i==null&&r,v,s,li,n.MyDiscussions,n.Author+":",n.Author,f,u,null,{id:y}),t(i==null&&r,v,s,ht,n.OtherUsers,n.Author+":",n.Author,f,u),ur(r,v),oi(r,v,[{value:k,title:n.StatusOpenDiscussion},{value:vr,title:n.StatusArchivedDiscussion}]),t(r,v,l,du,n.Today," ",n.ByCreateDate,uu,tu,null,{from:g.getTime(),to:g.getTime()}),t(r,v,l,dr,n.Recent," ",n.ByCreateDate,uu,tu,null,{from:nt.getTime(),to:g.getTime()}),t(r,v,l,kr,n.CustomPeriod," ",n.ByCreateDate,uu,tu),t(r,v,a,ft,n.FollowDiscussions,"",n.Other,ft),fr(v),si(v,tt,pu),b=[],c&&c.sorters&&(b=c.sorters),e(r,b,ke,n.ByComments,w,!0),e(r,b,ri,n.ByCreateDate,w),e(r,b,nr,n.ByTitle,w),{filters:v,sorters:b}},ao=function(r,c){var p=new Date,nt=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0),rt=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,0,0,0),v,ut,b;return rt.setDate(rt.getDate()+7),v=[],c&&c.filters&&(v=c.filters),ut=v.length,g(typeof pt.userInProjectTeam(y)!="undefined"&&i!=null&&r,v,o(bt),n.ByResponsible,u),t(typeof pt.userInProjectTeam(y)!="undefined"&&i!=null&&r,v,h,o(kt),n.MyTasks,n.Tasks+":",n.Tasks,f,nu,d,{value:y}),t(i!=null&&r,v,h,o(st),n.OtherParticipant,n.ByResponsible+":",n.ByResponsible,f,u,d,null,n.Select),t(i!=null&&r,v,h,o(ct),n.OtherParticipant,n.ByResponsible+":",n.Tasks,f,u,d,null,n.Select),g(i==null&&r,v,bt,n.ByResponsible,u),t(i==null&&r,v,s,st,n.OtherUsers,n.ByResponsible+":",n.ByResponsible,f,u),t(i==null&&r,v,s,kt,n.MyTasks,n.Tasks+":",n.Tasks,f,nu,null,{id:y}),t(i==null&&r,v,s,ct,n.OtherUsers,n.Tasks+":",n.Tasks,f,nu),oi(r,v,[{value:k,title:n.StatusOpenMilestone},{value:tt,title:n.StatusClosedMilestone}]),t(r,v,a,et,n.Overdue,"",n.DueDate,et,ot),t(r,v,l,pi,n.Today," ",n.DueDate,yt,ot,null,{from:nt.getTime(),to:nt.getTime()}),t(r,v,l,wi,n.UpcomingMilestones," ",n.DueDate,yt,ii,null,{from:nt.getTime(),to:rt.getTime()}),t(r,v,l,ii,n.CustomPeriod," ",n.DueDate,yt,ot),ur(r,v),fr(v),si(v,ut,yu),b=[],c&&c.sorters&&(b=c.sorters),e(r,b,te,n.ByDeadline,it,!0),e(r,b,ri,n.ByCreateDate,w),e(r,b,nr,n.ByTitle,it),{filters:v,sorters:b}},vo=function(i,r){var o=[],l,c;return r&&r.filters&&(o=r.filters),l=o.length,g(i,o,sr,n.ProjectMenager,df),t(i,o,s,ci,n.OtherUsers,n.ProjectMenager+":",n.ProjectMenager,f,df),g(i,o,or,n.TeamMember,u),t(i,o,s,hi,n.OtherUsers,n.TeamMember+":",n.TeamMember,f,u),t(i,o,di,di,n.Groups,n.Groups+":",n.TeamMember,ne,u),oi(i,o,[{value:k,title:n.StatusOpenProject},{value:yr,title:n.StatusSuspend},{value:tt,title:n.StatusClosedProject}]),t(i,o,a,ft,n.FollowProjects,"",n.Other,ft),tr&&(t(i,o,h,gt,n.ByTag,n.Tag+":",n.Other,fu,null,tr,null,n.Select),t(i,o,a,lt,n.WithoutTag,"",n.Other,lt)),fr(o,2),si(o,l,vu),c=[],r&&r.sorters&&(c=r.sorters),e(i,c,nr,n.ByTitle,it,!0),e(i,c,ri,n.ByCreateDate,w),{filters:o,sorters:c}},yo=function(r,c){function wt(n){if(cu)return cu.filter(function(t){return t.statusType===n}).map(function(t){return{value:t.id,title:t.title,sub:!0,statusType:n}})}var ft=new Date,ct=new Date(ft.getFullYear(),ft.getMonth(),ft.getDate(),0,0,0,0),lt=new Date(ft.getFullYear(),ft.getMonth(),ft.getDate(),0,0,0,0),p,vt,b;lt.setDate(lt.getDate()+7);p=[];c&&c.filters&&(p=c.filters);vt=p.length;g(typeof pt.userInProjectTeam(y)!="undefined"&&i!=null&&r,p,o(ut),n.ByResponsible,u);t(i!=null&&r,p,s,o(nt),n.OtherParticipant,n.ByResponsible+":",n.ByResponsible,f,u,d,null,n.Select);g(i==null&&r,p,ut,n.ByResponsible,u);t(i==null&&r,p,s,nt,n.OtherUsers,n.ByResponsible+":",n.ByResponsible,f,u);ee(r,p,n.ByResponsible,u);t(r,p,a,vi,n.NoResponsible,"",n.ByResponsible,"noresponsible",u);g(r,p,cr,n.ByCreator,kf);t(r,p,s,ai,n.OtherUsers,n.ByCreator+":",n.ByCreator,f,kf);ur(r,p);t(r,p,a,at,n.MyMilestones,null,n.ByMilestone,"mymilestones",v);t(r,p,a,yi,ASC.Projects.Resources.ProjectsJSResource.NoMilestone,null,n.ByMilestone,"nomilestone",v);t(r,p,h,v,n.OtherMilestones,n.ByMilestone+":",n.ByMilestone,"milestone/{0}",v,su,null,n.Select);var st=wt(1),ht=wt(2),rt=[];return st?st.length===1?rt.push({value:k,title:st[0].title}):st.length>1&&rt.push({value:k,title:n.StatusAllOpenTask,sub:[{value:k,title:n.StatusAllOpenTask}].concat(st)}):rt.push({value:k,title:n.StatusOpenTask}),ht?ht.length===1?rt.push({value:tt,title:ht[0].title}):ht.length>1&&rt.push({value:tt,title:n.StatusAllClosedTask,sub:[{value:tt,title:n.StatusAllClosedTask}].concat(ht)}):rt.push({value:tt,title:n.StatusClosedTask}),oi(r,p,rt),t(r,p,a,et,n.Overdue,null,n.DueDate,et,ot),t(r,p,l,pi,n.Today," ",n.DueDate,yt,ot,null,{from:ct.getTime(),to:ct.getTime()}),t(r,p,l,wi,n.UpcomingMilestones," ",n.DueDate,yt,ot,null,{from:ct.getTime(),to:lt.getTime()}),t(r,p,l,ii,n.CustomPeriod," ",n.DueDate,yt,ot),si(p,vt,au),b=[],c&&c.sorters&&(b=c.sorters),e(r,b,te,n.ByDeadline,it,!0),e(r,b,"priority",n.ByPriority,w),e(r,b,ri,n.ByCreateDate,w),e(r,b,"start_date",n.ByStartDate,w),e(r,b,nr,n.ByTitle,it),e(r,b,"sort_order",n.ByOrder,it),{filters:p,sorters:b}},po=function(r,c){var st=new Date,b=new Date(st.getFullYear(),st.getMonth(),st.getDate(),0,0,0,0),ft=new Date(b),ht,et,ot,k,tt,p,ct,rt;return ft.setDate(b.getDate()-b.getDay()+1),ht=new Date(b),ht.setDate(b.getDate()-b.getDay()+7),et=new Date(ft),et.setDate(ft.getDate()-7),ot=new Date(ft),ot.setDate(ft.getDate()-1),k=new Date(b),k.setMonth(b.getMonth()-1),k.setDate(1),tt=new Date(k),tt.setMonth(k.getMonth()+1),tt.setDate(tt.getDate()-1),et=et.getTime(),ot=ot.getTime(),k=k.getTime(),tt=tt.getTime(),p=[],c&&c.filters&&(p=c.filters),ct=p.length,ur(r,p),t(r,p,a,at,n.MyMilestones,"",n.ByMilestone,at,v),t(r,p,h,v,n.OtherMilestones,n.ByMilestone+":",n.ByMilestone,be,v,su,null,n.Select),g(typeof pt.userInProjectTeam(y)!="undefined"&&i!=null&&r,p,o(ut),n.ByResponsible,u),t(i!=null&&r,p,s,o(nt),n.OtherParticipant,n.ByResponsible+":",n.ByResponsible,f,u,d,null,n.Select),g(i==null&&r,p,ut,n.ByResponsible,u),t(i==null&&r,p,s,nt,n.OtherUsers,n.ByResponsible+":",n.ByResponsible,f,u),ee(r,p,n.ByResponsible,u),oi(r,p,[{value:pr,title:n.PaymentStatusNotChargeable},{value:wr,title:n.PaymentStatusNotBilled},{value:br,title:n.PaymentStatusBilled}]),t(r,p,l,gu,n.PreviousWeek," ",n.TimePeriod,eu,iu,null,{from:et,to:ot}),t(r,p,l,nf,n.PreviousMonth," ",n.TimePeriod,eu,iu,null,{from:k,to:tt}),t(r,p,l,tf,n.CustomPeriod," ",n.TimePeriod,eu,iu),fr(p),si(p,ct,wu),rt=[],c&&c.sorters&&(rt=c.sorters),e(r,rt,"date",n.ByDate,w,!0),e(r,rt,"hours",n.ByHours,it),e(r,rt,"note",n.ByNote,it),e(r,rt,ri,n.ByCreateDate,w),{filters:p,sorters:rt}},wo=function(n){fi.call(this,pu,n,ei(!1,!1,!1,!0,!1))},bo=function(n){fi.call(this,yu,n,ei(!1,!0,!1,!1,!1))},ko=function(n){fi.call(this,vu,n,ei(!0,!1,!1,!1,!1))},go=function(n,t){cu=t;fi.call(this,au,n,ei(!1,!1,!0,!1,!1))},ns=function(n){fi.call(this,wu,n,ei(!1,!1,!1,!1,!0))};return{add:oe,addUser:ts,baseFilter:!0,resize:fe,show:co,hide:ho,createAdvansedFilterForDiscussion:wo,createAdvansedFilterForMilestones:bo,createAdvansedFilterForProjects:ko,createAdvansedFilterForTasks:go,createAdvansedFilterForTimeTracking:ns}}();
typeof ASC=="undefined"&&(ASC={});typeof ASC.Projects=="undefined"&&(ASC.Projects={});ASC.Projects.PageNavigator=function(){function a(){if(r&&r!==""){var i=localStorage[f]?JSON.parse(localStorage[f]):{};i[r]={entryCountOnPage:n,currentPage:t};localStorage[f]=JSON.stringify(i)}}function w(i){isNaN(i)||n!==i&&(n=i*1,t=0,u.EntryCountOnPage=n,o.getData(!1))}function k(){var i=localStorage[f]?JSON.parse(localStorage[f]):undefined,u;u=i&&i.hasOwnProperty(r)?i[r]:{entryCountOnPage:r.startsWith("discussionsKeyForPagination")?10:ASC.Projects.Master.EntryCountOnPage,currentPage:0};n=parseInt(u.entryCountOnPage);t=parseInt(u.currentPage)}function v(){c.show()}var c=jq("#tableForNavigation"),f="projectsPagination",n=0,t=0,r,l,u,e,i,y=jq("#totalCount"),o,s=[10,20,30,40],h=[25,50,75,100],p=function(f,c){l=this;r=c.pagination;e=ASC.Projects.Resources.ProjectsJSResource;o=f;var v=jq.getURLParam("prjID");if(v&&(r+=v),k(),typeof i=="undefined"){i=jq("#countOfRows");i.advancedSelector({height:120,width:60,itemsSelectedIds:n,onechosen:!0,showSearch:!1,itemsChoose:s.concat(h).map(function(n){return{id:n,title:n}}),sortMethod:function(){return 0}}).on("showList",function(n,t){i.attr("data-id",t.id).text(t.title).attr("title",t.title);w(t.id)})}i.advancedSelector("reset");c.small?(i.advancedSelector("undisable",s),i.advancedSelector("disable",h)):(i.advancedSelector("undisable",h),i.advancedSelector("disable",s));i.advancedSelector("select",[n]);i.attr("data-id",n).text(n).attr("title",n);typeof l.pgNavigator=="undefined"?(u=new ASC.Controls.PageNavigator.init("ASC.Projects.PageNavigator.pgNavigator","#divForTaskPager",n,parseInt(ASC.Projects.Master.VisiblePageCount),t+1,e.PreviousPage,e.NextPage),u.NavigatorParent="#divForTaskPager"):(u.EntryCountOnPage=n,u.CurrentPageNumber=t+1);u.changePageCallback=function(n){t=n-1;o.getData(!0);a()}},b=function(n){y.text(n);u.drawPageNavigator(t+1,n);a();n&&v()},d=function(){c.hide()},g=function(i){var r=Math.floor(i/n);t>=r&&(t=r-1)},nt=function(){t=0};return{init:p,update:b,get entryCountOnPage(){return n},get currentPage(){return t},get pgNavigator(){return u},hide:d,show:v,setMaxPage:g,reset:nt}}();ASC.Projects.Base=function(){function pt(){et||(et=!0,rt=LoadingBanner,t=ASC.Projects.PageNavigator,e=ASC.Projects.ProjectsAdvansedFilter,l=ASC.Projects.Resources,i=l.TaskResource,u=l.ProjectsCommonResource,f=l.ProjectResource,o=l.MilestoneResource,d=l.TimeTrackingResource,g=l.MessageResource,nt=l.ProjectTemplatesResource,lt={projectRemoveWarning:r([f.DeleteProjectPopup,u.PopupNoteUndone],f.DeleteProject,f.DeleteProject),projectsRemoveWarning:r([f.DeleteProjectsPopup,u.PopupNoteUndone],f.DeleteProjects,f.DeleteProjects),taskRemoveWarning:r([i.RemoveTaskPopup,u.PopupNoteUndone],i.RemoveTask,i.RemoveTask),tasksRemoveWarning:r([i.RemoveTasksPopup,u.PopupNoteUndone],i.RemoveTasks,i.RemoveTasks),milestoneRemoveWarning:r([o.DeleteMilestonePopup,u.PopupNoteUndone],o.DeleteMilestone,o.DeleteMilestone),milestonesRemoveWarning:r([o.DeleteMilestonesPopup,u.PopupNoteUndone],o.DeleteMilestones,o.DeleteMilestones),trackingRemoveWarning:r([d.DeleteTimersQuestion,u.PopupNoteUndone],d.DeleteTimers,d.DeleteTimers),discussionRemoveWarning:r([g.DeleteDiscussionPopup,u.PopupNoteUndone],g.DeleteMessage,g.DeleteMessage),projectTemplateRemoveWarning:r([nt.RemoveQuestion,u.PopupNoteUndone],nt.RemoveTemplateTitlePopup,nt.RemoveTemplateTitlePopup),taskLinksRemoveWarning:r([jq.format(u.TaskMoveNote,"")],u.OneTaskMoveButton,u.MoveTaskHeader),taskLinksRemoveDeadlineWarning:r([jq.format(u.UpdateDeadlineNote,"")],u.TaskUpdateButton,u.UpdateDeadlineHeader),closedTaskQuestion:r([i.TryingToCloseTheTask,i.BetterToReturn],i.EndAllSubtasksCloseTask,i.ClosingTheTask),closedTasksQuestion:r([i.TryingToCloseTasks,i.BetterToReturnTasks],i.EndAllSubtasksCloseTasks,i.ClosingTasks),projectOpenTaskWarning:r([f.NotClosePrjWithActiveTasks],f.ViewActiveTasks,f.ViewActiveTasks),projectOpenMilestoneWarning:r([f.NotClosedPrjWithActiveMilestone],f.ViewActiveMilestones,f.CloseProject),closeMilestoneWithOpenTasks:r([o.NotCloseMilWithActiveTasks],f.ViewActiveTasks,o.CloseMilestone),createNewLinkError:r([i.ErrorCreateNewLink],f.OkButton,i.ErrorCreateNewLink)})}function wt(){if(tt)w.hide(),c.hide(),ht.show();else{if(y>0)return;y=setTimeout(function(){rt.displayLoading()},500)}}function ti(n){location.hash.indexOf(st)>0&&ASC.Projects.Common.displayInfoPanel(n,!0)}function ii(){location.href=location.pathname+"?prjID="+jq.getURLParam("prjID")+"#"+st}function ui(n,i,r){if(v=n.groupMenu,t&&t.pgNavigator&&t.update(r),i.length){gt.hide();typeof e!="undefined"&&e.show();v&&(ASC.Projects.GroupActionPanel.init(v,n.$container),a.show(),a.find(".contentMenu").show());n.$container.html(jq.tmpl(n.tmplName,i));n.$container.show();t&&t.pgNavigator&&t.show();ut();v&&ScrolledGroupMenu.resizeContentHeaderWidth(a.find(".contentMenu"));return}if(r==undefined||r===0){t.hide();v&&a.hide();at({},{filter:{Count:0,StartIndex:0},success:function(t){var i;e.baseFilter||!t.__total?(e.hide(),i=n.baseEmptyScreen):(e.show(),i=jq.extend({img:"filter",button:{title:ASC.Projects.Resources.ProjectsFilterResource.ClearFilter,clear:!0,canCreate:function(){return!0}}},n.filterEmptyScreen));jq("#emptyScrCtrlPrj").html(jq.tmpl("projects_emptyScreen",i)).show();jq("#emptyScrCtrlPrj .addFirstElement").off(s).on(s,i.button.onclick);ut()}});return}if(t&&t.currentPage>=0){t.setMaxPage(r);this.getData();return}ut()}function fi(n,i){wt();this.currentFilter.Count=t.entryCountOnPage;this.currentFilter.StartIndex=t.entryCountOnPage*t.currentPage;at=n;n({},{filter:this.currentFilter,success:function(){bt();i.apply(null,arguments)}})}function kt(t,i){function r(){n&&n.hide();jq(".menuopen").removeClass("menuopen");jq(h).removeClass(it);k=undefined}if(!t){i&&i.find(h).hide();return}i||(i=c);ft.push(i);i.off(s,h).on(s,h,function(){var u,r,i,f;if(n&&(jq(h).removeClass(it),n.remove()),jq(this).is(k))return k=undefined,undefined;for(k=jq(this),u=t.call(this,dt(this)),n=ASC.Projects.Common.createActionPanel(c,"actionPanel",u),r=u.menuItems,i=r.length-1;i>=0;i--){f=function(t){return function(){n.hide();jq(".studio-action-panel").hide();jq(".entity-menu").removeClass("active");t.handler()}}(r[i]);jq("#"+r[i].id).on(s,f)}return ei.call(this)});jq("body").off("contextmenu.projects").on("contextmenu.projects",function(t){for(var i=jq(t.srcElement||t.target),e=!1,f=0;f<ft.length;f++)if(jq.contains(ft[f][0],i[0])){e=!0;break}if(!e)return r(),!0;if(!(i.is(p)||i.parents(p).length)||(dt(i).find(h).trigger("click"),!n))return!0;var u=jq.fixEvent(t),o=document.body.clientWidth-(u.pageX-pageXOffset+n.innerWidth())>0?0:n.innerWidth(),s=document.body.clientHeight-(u.pageY-pageYOffset+n.innerHeight())>0?0:n.innerHeight();return n.css({top:u.pageY-s,left:u.pageX-o}),!1});jq("body").off(ot+"1").on(ot+"1",function(n){setTimeout(function(){var t=jq(n.target?n.target:n.srcElement);t.is(h)||t.parents(h).length||r()},1)})}function dt(n){var t=jq(n);return t.is(p)||(t=t.parents(p)),t}function ei(){var t=jq(this),i=t.offset(),r=si(i,t),u=oi(i,t);n.find(".dropdown-item").show();t.addClass(it);n.css({left:r,top:u}).show()}function oi(t,i){var r=t.top+i.outerHeight(),u=n.innerHeight(),f=jq(window),e=f.scrollTop(),o=f.height();return u<r&&o+e-u<=r&&(r=r-n.outerHeight(),i&&(r=r-i.outerHeight())),r}function si(t,i){var u=jq(window),f=u.width(),e=u.scrollLeft(),r=t.left;return t.left+i.width()+n.outerWidth()>e+f&&(r=r-n.outerWidth()+i.outerWidth(!0)),r}function hi(){typeof ct!="undefined"&&ct.off();typeof n!="undefined"&&n.off();c.off();b.off();yt.unbind()}function r(n,t,i){return{notes:n,okButton:t,header:i}}var tt=!0,v=!1,y=-1,et=!1,ot="click.body",s="click",h=".entity-menu",p=".with-entity-menu",it="active",st="elementNotFound",w=jq("#filterContainer"),c=jq("#CommonListContainer"),b=jq("#commonPopupContainer"),ht=jq(".mainPageContent .loader-page"),gt=jq("#emptyScrCtrlPrj"),a=jq("#groupActionContainer"),ct,n,k,rt,t,e,l,i,u,f,o,d,g,nt,lt,at,vt=ASC.Projects.DescriptionPanel,yt=ASC.Projects.EventBinder,ni=function(n,i,r,u,f,o){pt();wt();ti(n.elementNotFoundError);document.title=jq.format("{0} - {1}",n.moduleTitle,ASC.Projects.Resources.ProjectsJSResource.ProductName);i&&t.init(this,i);ASC.Projects.StatusList.init(r,c);kt(u);yt.bind(f);vt.init(c,e,o)},ut=function(){tt?(tt=!1,ht.hide(),w.show(),e&&e.resize(),c.show()):(y>0&&(clearTimeout(y),y=-1),w.is(":visible")||(w.show(),e&&e.resize()),rt.hideLoading())},ri=function(n,t,i){pt();var r=lt[n];b.html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"PopupKeyUpActionProvider.CloseDialog();",IsPopup:!0},header:{data:{title:r.header},title:"projects_common_popup_header"},body:{data:r,title:"projects_commonWarning"}}));b.off(s).on(s,".blue",t||function(){jq.unblockUI()}).on(s,".gray",i||function(){jq.unblockUI()});PopupKeyUpActionProvider.EnterAction="jq('.commonPopupContent .blue').trigger('click');";StudioBlockUIManager.blockUI(b,400)},bt=function(){vt.hide(!1);t&&t.hide();jq("#tableListProjects tbody, #milestonesList tbody, .taskList, #discussionsList, #timeSpendsList tbody, [id$='EmptyScreenForFilter'], [id^='emptyList'], .tab, .emptyScrCtrl, #descriptionTab, #descriptionTab > div").hide();var n=jq("#totalTimeText");n.length&&n.remove();a.hide()},ft=[];return{baseInit:ni,clearTables:bt,getData:fi,showCommonPopup:ri,$commonListContainer:c,$groupeMenu:a,showOrHideData:ui,unbindEvents:hi,initActionPanel:kt,setElementNotFound:ii}}();
ASC.Projects.SubtasksManager=function(){function ht(n){return ft(n),!1}function ct(n,i){var r={title:n.title,responsible:c,description:""};return t.updatePrjSubtask({},i,n.id,r,{success:g}),!1}function lt(n,i){return u=jq(".subtasks[taskid="+i+"]"),t.copyPrjSubtask({taskid:i},i,n,{success:d}),!1}function at(n,i){return t.removePrjSubtask({taskId:i},i,n,{success:wt}),!1}function vt(n){var f=n.attr("id"),i=h(f),r=i.taskid,e=p(r),u=ASC.Projects.ActionMenuItem,t=[];return i.status!=2&&(i.responsible||t.push(new u("sta_accept",s.TaskResource.AcceptSubtask,ct.bind(null,i,r),"accept")),i.canEdit&&t.push(new u("sta_edit",s.TaskResource.Edit,ht.bind(null,f,r),"edit")),e.canCreateSubtask&&t.push(new u("sta_copy",s.ProjectsCommonResource.Copy,lt.bind(null,f,r),"move-or-copy"))),i.canEdit&&(t.length==3&&t.push(new u(null,null,null,null,!0)),t.push(new u("sta_remove",s.ProjectsCommonResource.Delete,at.bind(null,f,r),"delete"))),{menuItems:t}}function d(t,i){if(u.find(".subtask").length){var r=u.find(".quickAddSubTaskLink");jq.tmpl("projects_subtaskTemplate",i).insertBefore(r)}else jq.tmpl("projects_subtaskTemplate",i).prependTo(u),u.show();jq(".subtask-loader").remove();n=jq(".subtask-name-input");n.prop("disabled",!1);n.val("");n.trigger("focus")}function g(n,t){jq('.subtask[id="'+t.id+'"]').replaceWith(jq.tmpl("projects_subtaskTemplate",t));f();kt(t)}function yt(n,t){y(n.find(".check"));setTimeout(function(){n.yellowFade()},0);var i={title:n.find(".taskName span").text().trim(),responsible:c,status:"closed"};nt({},t,n.attr("id"),i)}function nt(n,i,r,u){t.updatePrjSubtask(n,i,r,u,{success:pt})}function pt(n,t){var i=w(t.id),r=jq(i).closest(".subtasks");i.remove();t.status==1?jq.tmpl("projects_subtaskTemplate",t).prependTo(r):jq.tmpl("projects_subtaskTemplate",t).appendTo(r);jq(".subtask-loader").remove()}function wt(n,t){w(t.id).remove()}function y(n){n.hasClass("check")&&n.find("input").hide();n.prepend('<div class="subtask-loader"><\/div>')}function tt(n){r&&r.hasOwnProperty(n)?it(r[n]):t.getPrjTeam({projectId:n},n,{success:function(n,t){r[n.projectId]=t;it(t)}})}function it(t){function e(n){return{id:n.id,title:n.displayName}}var i=o.excludeVisitors(t),f={id:"00000000-0000-0000-0000-000000000000",displayName:ASC.Projects.Resources.TaskResource.NoResponsible},u=jq(".subtask-responsible-selector"),r;i=o.removeBlockedUsersFromTeam(i);i=[f].concat(i);r=k[a];r||(r=f);u.advancedSelector({height:270,showSearch:!1,onechosen:!0,itemsChoose:i.map(e),sortMethod:function(){return 0},inPopup:!0,$parent:jq(".mainPageContent")}).on("showList",function(t,i){u.attr("data-id",i.id).html(i.title).attr("title",i.title);n=jq(".subtask-name-input");n.trigger("focus")});u.advancedSelector("selectBeforeShow",e(r))}function rt(){var i,r;if(n=jq(".subtask-name-input"),u=n.closest(".subtasks"),i={title:n.val().trim()},i.title.length==0)return e?n.trigger("focus"):f(),!1;i.responsible=jq(".subtask-responsible-selector").attr("data-id");i.taskId=u.attr("taskid");r={taskid:i.taskId};y(n.closest(".subtask-name"));e?(i.id=n.data("subtaskid"),t.updatePrjSubtask(r,i.taskId,i.id,i,{success:g})):t.addPrjSubtask(r,i.taskId,i,{success:d})}function ft(t){var s;f();e=!0;var r=w(t),i=h(t),c=i.taskid,l=p(c),u={subtaskid:t,title:i.title,taskid:i.taskid,projectid:l.projectId,responsible:i.responsible==null?null:i.responsible.id};a=i.responsible==null?o.emptyGuid:i.responsible.id;jq.tmpl("projects_fieldForAddSubtask",u).insertAfter(r);tt(u.projectid);r.addClass("edited");s=jq("#quickAddSubTaskField");s.removeClass("display-none");n=jq(".subtask-name-input");n.prop("disabled",!1);n.trigger("focus")}function f(){jq("#quickAddSubTaskField").remove();e||(jq(".task:not(.closed)").next().find(".quickAddSubTaskLink").show(),jq("#subtaskContainer .quickAddSubTaskLink").show());jq(".subtask.edited").removeClass("edited");e=!1}function bt(n){i=n}function p(n){for(var t=0,r=i.length;t<r;t++)if(i[t].id==n)return i[t]}function h(n){for(var u,t,e,r=0,f=i.length;r<f;r++)for(u=i[r].subtasks,t=0,e=u.length;t<e;t++)if(u[t].id==n)return u[t]}function kt(n){for(var u,t,e,r=0,f=i.length;r<f;r++)for(u=i[r].subtasks,t=0,e=u.length;t<e;t++)if(u[t].id==n.id){u[t]=n;return}}function w(n){return jq(".subtasks div[id="+n+"]:visible")}function dt(){function i(t){jq(t.currentTarget).addClass("move-target");n.find(".task.canedit:not(.closed)").addClass("can-move")}function r(t){jq(t.currentTarget).removeClass("move-target");n.find(".task.can-move").removeClass("can-move");n.find(".task.move-dest").removeClass("move-dest")}function u(){var i=n.find(".move-target"),r=n.find(".move-dest");if(i.length&&r.length){var e=i.attr("id"),u=i.closest(".subtasks").attr("taskid"),f=r.attr("taskid");if(u==f)return;t.movePrjSubtask({fromTaskId:parseInt(u)},f,e,{success:function(n,t){i.remove();jq.tmpl("projects_subtaskTemplate",t).prependTo(r.next(".subtasks"))},error:function(n,t){o.displayInfoPanel(t[0],!0)},before:function(){LoadingBanner.displayLoading()},after:function(){LoadingBanner.hideLoading()}})}}function f(t){var r,i,u;if(t.preventDefault(),n.find(".move-dest").removeClass("move-dest"),r=jq(t.target),i=r.closest(".can-move"),i.length){i.addClass("move-dest");return}if(u=r.closest(".subtasks"),u.length&&(i=u.prev(".can-move"),i.length)){i.addClass("move-dest");return}}if(!jq.browser.mobile&&!("ontouchstart"in window)){var n=jq("#CommonListContainer .taskList");n.on("dragover",f);n.on("drop",u);n.on("dragstart",".subtask",i);n.on("dragend",".subtask",r)}}var o=ASC.Projects.Common,c,l,r={},u=null,e=!1,a=null,b,i,v="click",n,t,s=ASC.Projects.Resources,et=27,ot=13,k,st=function(){if(!b){b=!0;t=Teamlab;k=UserManager.getAllUsers(!0);c=t.profile.id;l=jq.getURLParam("prjID");l&&(r={},r[l]=ASC.Projects.Master.Team);ASC.Projects.DescriptionPanel.init(jq("#CommonListContainer"),null,{getItem:function(n){var t=jq(n),i=t.parents(".subtask");return h(i.attr("id"))},selector:".subtask .taskName span"});jq(document).on("dblclick",".subtask .taskName",function(){var n=jq(this),t;return!n.is(".canedit")||n.parent(".subtask").is(".closed")?!1:(t=n.parent(".subtask").attr("id"),ft(t),!0)});jq(document).on(v,".subtask-add-button .button",function(){return rt(),!1});jq(document).on("keydown",".subtask-name-input",function(n){switch(n.which){case et:f();break;case ot:jq(this).prop("disabled",!0);rt()}});jq(document).on("change",".subtask .check input",function(){var n=jq(this).parents(".subtask"),t=n.attr("id"),r=h(t),i=r.taskid;jq(this).is(":checked")?yt(n,i):(y(n.closest(".check")),nt({},i,t,{status:"open"}))});jq(document).on(v,".quickAddSubTaskLink span",function(){return ut(jq(this).parent()),!1});jq(document).on(v,"#quickAddSubTaskField",function(){n=jq(".subtask-name-input");n.trigger("focus")});t.bind(t.events.updatePrjTeam,function(n,t){r[n.projectId]=t})}},ut=function(t){f();var i=p(t.parents(".subtasks").attr("taskid"));i&&(jq.tmpl("projects_fieldForAddSubtask",{subtaskid:"-1",title:"",projectid:"",responsible:null}).insertAfter(t),a=null,tt(i.projectId),t.hide(),jq("#quickAddSubTaskField").removeClass("display-none"),n=jq(".subtask-name-input"),n.trigger("focus"))};return{init:st,hideSubtaskFields:f,addFirstSubtask:ut,setTasks:bt,showEntityMenu:vt,initDragDrop:dt}}(jQuery);
ASC.Projects.TasksManager=function(){function ui(){t=Teamlab;nt===!1?(i=this,r.initCustomStatuses(function(){var i,r,t,n,u;if(h.customStatuses.length){for(i=document.createElement("style"),r="",t=0;t<h.customStatuses.length;t++)n=h.customStatuses[t],u="custom-task-status-"+n.id,r+=jq.format("#CommonListContainer .{0} { background: url('data:{1};base64,{2}') }",u,n.imageType,n.image),at.push({cssClass:u,text:n.title,id:n.id,statusType:n.statusType,isDefault:n.isDefault,available:n.available});i.innerHTML=r;document.body.appendChild(i)}vt()})):vt()}function vt(){var w,f,c;if(tt=t.profile.id,a=jq.getURLParam("prjID"),v=LoadingBanner,nt===!1){nt=!0;function p(n){return n.canCreateTask}w=[{id:"gaChangeStatus",title:n.ChangeStatus,multi:h.customStatuses.map(function(n){return{id:"ga"+n.id,title:n.title,handler:li.bind(null,n),checker:function(t){return t.canEdit&&ht.getByData(t).id!==n.id}}})},{id:"gaMove",title:l.Move,handler:ai,checker:function(n,t,i){if(t>0){var r=i[t-1];if(r&&r.projectId!==n.projectId)return!1}return n.canEdit&&n.status!==2}},{id:"gaDelete",title:k.ProjectsCommonResource.Delete,handler:vi,checker:function(n){return n.canDelete}}];i.showOrHideData=i.showOrHideData.bind(i,{$container:e,tmplName:ct,baseEmptyScreen:{img:"tasks",header:n.NoTasksCreated,description:jq.format(t.profile.isVisitor?n.TasksHelpTheManageVisitor:n.TasksHelpTheManage,n.DescrEmptyListTaskFilter),button:{title:n.AddFirstTask,onclick:pt,canCreate:function(){return a&&!it&&(it=r.getProjectByIdFromCache(a)),a?p(it):h.Projects.some(p)}}},filterEmptyScreen:{header:n.NoTasks,description:n.DescrEmptyListTaskFilter},groupMenu:{actions:w,getItemByCheckbox:rt,getLineByCondition:function(n){return u.filter(n).map(function(n){return e.find("[taskid="+n.id+"]")})},multiSelector:h.customStatuses.map(function(n){return{id:"gas"+n.id,title:n.title,condition:function(t){return ht.getByData(t).id===n.id}}})}});i.getData=i.getData.bind(i,t.getPrjTasks,er);bi()}f=ASC.Projects.Event;c=t.events;i.baseInit({moduleTitle:l.TasksModule,elementNotFoundError:l.TaskNotFound},{pagination:"tasksKeyForPagination"},{handler:ki,getItem:rt,statuses:at},fi,[f(c.addPrjTask,or),f(c.updatePrjTask,ni),f(c.updatePrjTaskStatus,lr),f(c.removePrjTask,sr),f(c.addSubtask,ti),f(c.removeSubtask,ii),f(c.updateSubtask,hr),f(c.moveSubtask,cr),f(c.getPrjProject,function(n,t){it=t})],{getItem:rt,selector:".task .taskName a",getLink:function(n){return"Tasks.aspx?prjID="+n.projectOwner.id+"&id="+n.id}});s.init();s.initDragDrop();g.createAdvansedFilterForTasks(i,h.customStatuses);a&&(ri=h.Team);ft.on(y,".user",function(){g.addUser("tasks_responsible",jq(this).attr("userId"),["noresponsible"])});jq(".addTask").on(y,function(){return pt(),!1});e.on(y,".task .user",function(n){var t=jq(this);if(!t.find("span.not-action").length){var u=t.parent().attr(b),i=o(u),r=i.responsible?i.responsible.id:null;r==null?g.add("noresponsible",!0,["tasks_responsible","group"]):g.addUser("tasks_responsible",r,["noresponsible","group"]);n.stopPropagation()}});e.on(y,".task .other",function(n){jq(".studio-action-panel").hide();ft.html(jq.tmpl("projects_taskListResponsibles",rt(n.target)));rr.call(this);n.stopPropagation()});e.on(y,".task",function(n){var t=jq(n.target?n.target:n.srcElement);if(!t.is("a")&&!t.is(".changeStatusCombobox.canEdit")&&!t.parent().is(".changeStatusCombobox.canEdit")&&!t.is(".entity-menu")&&!t.is("input")&&!t.parent().is(".entity-menu")&&!t.is(".noSubtasks:not(.canedit)")){s.hideSubtaskFields();var r=jq(this).attr(b),i=o(r),u=!i.subtasks||i.subtasks.every(function(n){return n.status===2});wt(i,i.status===1&&u)}})}function fi(t){var h;if(s.hideSubtaskFields(),t.is(".subtask"))return s.showEntityMenu(t);var e=t.attr(b),i=o(e),u=[],f=ASC.Projects.ActionMenuItem;return i.status!==2&&(i.canEdit&&u.push(new f("ta_edit",n.Edit,oi.bind(null,i),"edit")),i.canCreateSubtask&&u.push(new f("ta_subtask",n.AddSubtask,si.bind(null,e),"subtask-v2")),i.responsible||u.push(new f("ta_accept",n.AcceptSubtask,ei.bind(null,i),"accept")),u.length&&u.push(new f(null,null,null,null,!0)),i.canEdit&&i.responsibles&&i.responsibles.some(function(n){return n.id!=tt})&&u.push(new f("ta_mesres",n.MessageResponsible,pi.bind(null,e),"notify-responsible"))),i.canCreateTimeSpend&&u.push(new f("ta_time",n.TrackTime,wi.bind(null,i),"track-time")),i.status!==2&&(i.canEdit&&u.push(new f("ta_move",n.MoveToMilestone,hi.bind(null,i),"move-to-milestone")),h=r.getProjectById(i.projectId),h&&h.canCreateTask&&u.push(new f("ta_copy",k.ProjectsCommonResource.Copy,yi.bind(null,i),"move-or-copy"))),i.canDelete&&(u.length>=3&&u.push(new f(null,null,null,null,!0)),u.push(new f("ta_remove",k.ProjectsCommonResource.Delete,ci.bind(null,e),"delete"))),{menuItems:u}}function ei(n){var i={title:n.title.trim(),priority:n.priority,responsibles:[tt]},u=n.deadline,r;return u&&(i.deadline=new Date(u),i.deadline.setHours(0),i.deadline.setMinutes(0),i.deadline=t.serializeTimestamp(i.deadline)),r=n.description,r&&(i.description=r),typeof n.milestone!="undefined"&&n.milestone!=null&&(i.milestoneid=n.milestone.id),t.updatePrjTask({},n.id,i),!1}function oi(n){return f.TaskAction.showUpdateTaskForm(n),!1}function si(n){s.hideSubtaskFields();var t=d(n);return t.is(":visible")||dt(t),s.addFirstSubtask(t.find(".quickAddSubTaskLink")),!1}function hi(n){return gt([n]),!1}function ci(n){return i.showCommonPopup("taskRemoveWarning",function(){t.removePrjTask({taskId:n},n)}),!1}function li(n,t){for(var e,f=t.map(o),r=!1,u=0;u<f.length;u++)if(e=f[u],r=e.subtasks.some(function(n){return n.status===1}),r)break;return n.statusType===2&&r?i.showCommonPopup("closedTasksQuestion",function(){yt(n,t);jq.unblockUI()}):yt(n,t),!1}function yt(n,i){t.updatePrjTasksStatus({taskids:i,status:n.statusType,statusId:n.id},{before:function(){v.displayLoading()},after:function(){v.hideLoading()},success:function(n,i){for(var u=0;u<i.length;u++)t.call(t.events.updatePrjTaskStatus,this,[{disableMessage:!0},i[u]]);ut.deselectAll();r.displayInfoPanel(l.TasksUpdated)}})}function ai(n){return gt(n.map(o)),!1}function vi(n){return i.showCommonPopup("tasksRemoveWarning",function(){t.removePrjTasks({taskids:n},{before:function(){v.displayLoading()},after:function(){v.hideLoading()},success:function(n,i){for(var u=0;u<i.length;u++)t.call(t.events.removePrjTask,this,[{disableMessage:!0},i[u]]);r.displayInfoPanel(l.TasksRemoved)}});jq.unblockUI()}),!1}function yi(n){return f.TaskAction.showCopyTaskForm(n),!1}function pi(n){return nr({},n),!1}function wi(n){return r.showTimer(n.projectId,n.id,n.responsible||tt),!1}function bi(){r.createActionPanel(i.$commonListContainer,"othersPanel",{menuItems:[]});jq("#othersPanel .dropdown-content").attr("id","othersListPopup");ft=jq("#othersListPopup");w=jq("#moveTaskPanel");w.on(y,".blue",function(){function e(){t.updatePrjTasksMilestone(s,{error:function(){jq.unblockUI()},before:function(){v.displayLoading()},after:function(){v.hideLoading()},success:function(n,i){for(var u=0;u<i.length;u++)t.call(t.events.updatePrjTask,this,[{disableMessage:!0},i[u]]);ut.deselectAll();r.displayInfoPanel(l.TasksUpdated)}})}for(var i,u=lt,o=u.map(function(n){return n.id}),n=[],s={milestoneid:w.find(".milestonesList input:checked").attr("value"),taskids:o},f=0;f<u.length;f++)i=u[f],i.links&&i.links.length&&(n=n.concat(i.links));n.length?ASC.Projects.Base.showCommonPopup("taskLinksRemoveWarning",function(){for(var r,i=0;i<n.length;++i)r={dependenceTaskId:n[i].dependenceTaskId,parentTaskId:n[i].parentTaskId},t.removePrjTaskLink({},n[i].dependenceTaskId,r,{success:function(){}});e()},function(){jq.unblockUI();StudioBlockUIManager.blockUI(w,550)}):e()}).on(y,".gray",function(){return jq.unblockUI(),!1})}function ki(n,t,i){var u,f,r;i===2?(u=o(n),f=u.subtasks.some(function(n){return n.status===1}),f?ir(n,t):bt(n,t)):(r=c(n),r.find(".check div").hide(),r.find(".check").append(et),kt({},n,1,t))}function pt(){f.TaskAction.showCreateNewTaskForm()}function wt(n,t){var i=d(n.id),r;return(t&&s.addFirstSubtask(i.find(".quickAddSubTaskLink")),r=n.subtasks.length,i.is(":visible"))?(i.hide(),!0):!r&&!t?!1:(r&&dt(i),i.show(),!0)}function o(n){for(var t=0,i=u.length;t<i;t++)if(u[t].id==n)return u[t]}function rt(n){return o(jq(n).parents(".task").attr(b))}function di(n){for(var t=0,i=u.length;t<i;t++)if(u[t].id==n.id){u[t]=n;break}}function gi(n,t){for(var i=0,r=n.subtasks.length;i<r;i++)if(n.subtasks[i].id===t.id){n.subtasks[i]=t;break}}function bt(n,t){jq(".taskProcess").remove();c(n).find(".check").html(et);kt({},n,2,t)}function kt(n,i,u,f){t.updatePrjTask(n,i,{status:u,statusId:f},{error:function(n,t){var u=c(i);u.find(".taskProcess").remove();u.find(".check div").show();r.displayInfoPanel(t[0],!0)}})}function nr(i,u){t.notifyPrjTaskResponsible(i,u,{success:r.displayInfoPanel.bind(null,n.MessageSend)})}function ot(n){var t=n.id,i=c(t),r=i.find(".subtasksCount");r.html(jq.tmpl("projects_numSubtasksTmpl",n))}function tr(n){return new Date>n}function dt(n){var t=n.find(".subtask.closed");n.find(".st_separater").after(t);n.show()}function ir(n,t){i.showCommonPopup("closedTaskQuestion",function(){bt(n,t);jq.unblockUI()})}function gt(t){var f=h.Milestones.filter(function(n){return n.status===0&&n.projectId==t[0].projectId}).concat([{id:0,title:n.None}]),i,u;lt=t;f.forEach(function(n){n.checked=t.some(function(t){return(t.milestoneId||0)==n.id})});t.length===1?(i=n.MoveTaskToAnotherMilestone,u={title:n.Task,description:t[0].title,moveToMilestone:n.MoveToMilestone}):(i=n.MoveTasksToAnotherMilestone,u={title:n.TasksCount,description:t.length,moveToMilestone:n.MoveTasksToMilestone});w.html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"PopupKeyUpActionProvider.CloseDialog();",IsPopup:!0},header:{data:{title:i},title:"projects_common_popup_header"},body:{title:"projects_move_task_panel",data:{milestones:f.sort(r.milestoneSort),describe:u}}}));StudioBlockUIManager.blockUI(w,550);PopupKeyUpActionProvider.EnterAction="$moveTaskPanel.find('.blue').trigger('click');"}function rr(){var r=jq(this),u=r.offset(),e=u.left,n=u.top+r.outerHeight(),t=jq("#othersPanel"),i=t.innerHeight(),f=jq(window),o=f.scrollTop(),s=f.height();i<n&&s+o-i<=n&&(n=n-i);t.css({left:e,top:n}).show();jq("body").off("click.body2").on("click.body2",function(){setTimeout(function(){t&&t.hide()},1)})}function ur(n){for(var i=0,t=0;t<n.length;t++)n[t].status!=2&&i++;return i}function fr(){nt&&(i.unbindEvents(),e.off())}function st(n,t){var i=ASC.Resources.Master.ApiPath+"calendar/caldavevent.json",r={calendarId:"Project_"+n.projectId,uid:"Task_"+n.id,responsibles:jq.map(n.responsibles,function(n){return n.id})};jq.ajax({type:t===0||t===1?"put":"delete",url:i,data:r,complete:function(){}});(t===0||t===1)&&Teamlab.getPrjTeam({},n.projectId,function(t,r){var e=jq.map(r,function(n){return n.id}),o=jq.map(n.responsibles,function(n){return n.id}),u=e.filter(function(n){return o.indexOf(n)<0}),f;u.length>0&&(f={calendarId:"Project_"+n.projectId,uid:"Task_"+n.id,responsibles:u},jq.ajax({type:"delete",url:i,data:f,complete:function(){}}))})}function er(n,t){u=t;i.$commonListContainer.height("auto");e.height("auto");p=n.__total!=undefined?n.__total:0;i.showOrHideData(t,p);s.setTasks(t);e.off("click.taskItem").on("click.taskItem",".taskName a",f.Common.goToWithoutReload)}function or(n,t){(st(t,0),a=jq.getURLParam("prjId"),a&&a!=t.projectId||jq.getURLParam("id")!==null)||(p++,u.unshift(t),i.showOrHideData(u,p),e.find(".task:first").yellowFade())}function ni(n,t){st(t,t.status);var i=t.id;d(i).remove();c(i).replaceWith(jq.tmpl(ct,t));c(i).yellowFade();di(t);jq.unblockUI();n&&n.disableMessage||r.displayInfoPanel(l.TaskUpdated)}function sr(n,t){var f,e;st(t,2);f=t.id;c(f).remove();d(f).remove();p--;u=u.filter(function(n){return n.id!==f});i.showOrHideData(u,p);c(f).html(et);jq.unblockUI();n&&n.disableMessage||r.displayInfoPanel(l.TaskRemoved);e=r.getProjectById(t.projectOwner.id);e&&e.taskCountTotal--;r.changeTaskCountInProjectsCache(t,2)}function ti(n,t){var i=o(t.taskid);i.subtasks.push(t);ot(i)}function ii(n,t){var r=t.taskid,i=o(r);i.subtasks=i.subtasks.filter(function(n){return n.id!==t.id});t.status==1&&ot(i);d(r).find(".subtask").length||wt(i)}function hr(n,t){var i=o(t.taskid);gi(i,t);ot(i)}function cr(n,t){var i=t.taskid;t.taskid=n.fromTaskId;ii(n,t);t.taskid=i;ti(n,t)}function lr(n,t){var i=o(t.id);i.status!==t.status&&r.changeTaskCountInProjectsCache(t,1);ut.deselectAll();ni(n,t);setTimeout(function(){c(t.Id).yellowFade()},0)}function c(n,t){return e.find(jq.format(".task[{0}={1}]{2}",b,n,t?":first":""))}function d(n,t){return e.find(jq.format(".subtasks[{0}={1}]{2}",b,n,t?":first":""))}var f=ASC.Projects,k=f.Resources,n=k.TaskResource,l=k.ProjectsJSResource,g=f.ProjectsAdvansedFilter,r=f.Common,s=f.SubtasksManager,h=f.Master,ut=f.GroupActionPanel,ht=f.StatusList,nt=!1,tt,a,u=[],ri=undefined,p=0,e=jq(".taskList"),w,ft,it,v,i,t,y="click",ct="projects_taskListItemTmpl",b="taskid",et='<div class="taskProcess"><\/div>',lt,at=[];return jq.extend({init:ui,openedCount:ur,compareDates:tr,unbindListEvents:fr,basePath:"sortBy=deadline&sortOrder=ascending"},ASC.Projects.Base)}(jQuery);
ASC.Projects.TaskDescriptionPage=function(){function ir(){function i(t){n.files.push(t);lt.rewrite()}dt=n.project.projectFolder;var t="task";f=Attachments;n.canEdit||f.banOnEditing();ProjectDocumentsPopup.init(dt,f.isAddedFile,f.appendToListAttachFiles);f.isLoaded=!1;f.init(t,function(){return n.id});f.setFolderId(dt);f.loadFiles(n.files);f.bind("addFile",function(n,r){r.attachFromPrjDocFlag||r.isNewFile?u.addPrjEntityFiles(null,l,t,[r.id],{success:function(){i(r)}}):i(r)});f.bind("deleteFile",function(i,r){u.removePrjEntityFiles({},l,t,r,{success:function(){n.files=n.files.filter(function(n){return n.id!=r});f.deleteFileFromLayout(r);lt.rewrite()}})});f.bind("loadAttachments",function(n,t){t<1&&ii.show()})}function li(n){return n.forEach(function(n){n.commentList.length&&(n.commentList=li(n.commentList))}),n.filter(function(n){return!(n.inactive&&n.commentList.length===0)})}function ai(){var i,t,f;if(bt=[],i=r.filterParamsForListTasks,i.projectId=wt,i.status=1,i.milestone=n.milestone?n.milestoneId:0,n.links)for(t=0;t<n.links.length;t++)f=n.links[t].parentTaskId==n.id?n.links[t].dependenceTaskId:n.links[t].parentTaskId,bt.push(f),g[f]=n.links[t];u.getPrjTasks({},{success:au,filter:i})}function vi(){setTimeout(function(){nt||at.hide(100)},200)}function rr(n){CommentsManagerObj.isShowAddCommentBtn=n.canCreateComment;CommentsManagerObj.total=n.comments.length;CommentsManagerObj.isEmpty=n.comments.length===0;CommentsManagerObj.moduleName="projects_Task";CommentsManagerObj.comments=jq.base64.encode(JSON.stringify(n.comments));CommentsManagerObj.objectID="common";CommentsManagerObj.onLoadComplete=function(){window.CKEDITOR_mentionsFeed=ASC.Projects.Master.Team};CommentsManagerObj.Init();CommentsManagerObj.objectID=n.id;jq("#hdnObjectID").val(n.id);jq("#commentsTitle").remove();ci.css("width","100%");var t=ei+".comments";jq("#btnCancel").off(t).on(t,function(){ht=!1;tt.select()});jq("#mainCommentsContainer div[id^='container_'] a[id^='edit_']").off(t).on(t,function(){ht=!0});jq(document).off("keydown.taskdescr").on("keydown.taskdescr",function(n){n.keyCode==27&&(st(!0),ot.show())})}function ur(n){s.empty();s.attr("taskid",n.id);var t="projects_taskDescriptionSubtasksContainerTmpl";n.subtasks.length==0?jq.tmpl(t,n).prependTo(s):(jq.tmpl(t,n).prependTo(s),s.find(".st_separater").after(s.find(".closed")),n.status==2&&(s.find(".quickAddSubTaskLink").remove(),s.find(".subtask .check input").prop("disabled",!0)),p.selected&&s.show());jq(document).off("keydown.description").on("keydown.description",".subtask-name-input",function(n){switch(n.which){case 27:p.select()}})}function fr(){var t={title:n.title,responsibles:[ft],description:n.description,priority:n.priority};return n.deadline&&(t.deadline=n.deadline),n.milestoneId&&(t.milestoneid=n.milestoneId),u.updatePrjTask({},l,t),!1}function er(){s.find(".subtask").length!=s.find(".subtask.closed").length?kr.call(this):gi.call(this)}function or(){jq("body").css("cursor","wait");u.updatePrjTask({},l,{status:1,statusId:this.id},{success:di});jq(".pm_taskTitleClosedByPanel").hide()}function sr(){h.TaskAction.showUpdateTaskForm(n)}function hr(){ASC.Projects.Base.showCommonPopup("taskRemoveWarning",function(){u.removePrjTask({},l)})}function cr(){r.showTimer(n.projectId,n.id)}function lr(n){pi(!0,n)}function ar(n){ki(n,!0)}function vr(i){var u="",f=jq.timeFormat(i.timeSpend).split(":"),o={hours:f[0],minutes:f[1]};i.status==2&&(u=i.updatedBy!=undefined?i.updatedBy.displayName:i.createdBy.displayName);var s=i.createdBy.id===ft||ui.IsModuleAdmin||i.project.responsible.id===ft,h=ui.customStatuses.filter(function(n){return s||n.available}).map(function(n){return{title:n.title,handler:n.statusType===1?or:er,id:Math.abs(n.id).toString()}}),c=ui.customStatuses.find(function(n){return i.customTaskStatus?n.id===i.customTaskStatus:n.statusType===i.status&&n.isDefault}),r=ASC.Projects.DescriptionTab;r.init().push(e.ProjectResource.Project,nr(i.projectOwner.title),"Tasks.aspx?prjID="+i.projectOwner.id).push(e.MilestoneResource.Milestone,i.milestone?jq.format("[{0}] {1}",i.milestone.displayDateDeadline,i.milestone.title):"").push(t.TaskStartDate,i.displayDateStart).push(t.EndDate,i.displayDateDeadline,undefined,ASC.Projects.TasksManager.compareDates(i.deadline)?"<span class='deadlineLate'>{0}<\/span>":undefined).push(t.Priority,i.priority===1?t.HighPriority:undefined,undefined,'<span class="colorPriority high"><span>{0}<\/span><\/span>').push(t.AssignedTo,i.responsibles.length===0?t.WithoutResponsible:i.responsibles.map(function(n){return n.displayName}).join(", ")).push(e.ProjectsCommonResource.SpentTotally,i.canCreateTimeSpend&&i.timeSpend?jq.format("{0} {1}",o.hours+e.TimeTrackingResource.ShortHours,o.minutes+e.TimeTrackingResource.ShortMinutes):"","TimeTracking.aspx?prjID="+i.projectOwner.id+"&id="+i.id).push(t.CreatingDate,i.displayDateCrtdate).push(t.TaskProducer,i.createdBy.displayName).push(t.ClosingDate,i.status===2?i.displayDateUptdate:"").push(t.ClosedBy,u).push(e.ProjectsCommonResource.Description,jq.linksParser(nr(i.description))).setStatuses(h).setCurrentStatus(c).setStatusRight(n.canEdit).tmpl();gt.selected?r.show():r.hide();i.canEdit||jq("div.buttonContainer").remove();i.timeSpend&&jq(".timeSpend").show();jq(".subscribeLink").show()}function yr(t){var i=ct[t],u=n.startDate?n.startDate:n.crtdate,f=i.startDate?i.startDate:i.crtdate,e=n.deadline?n.deadline:undefined,o=i.deadline?i.deadline:undefined,s=r.getPossibleTypeLink(u,e,f,o,!0);s[2]==r.linkTypeEnum.start_end?it.text(y.RelatedLinkTypeSE).data("value",r.linkTypeEnum.start_end):it.text(y.RelatedLinkTypeES).data("value",r.linkTypeEnum.end_start)}function yt(n,t){var i=Math.abs(n.getTime()-t.getTime());return(i=Math.floor(i/864e5),i==0)?0:i==1?i+" "+y.DelayDay:i+" "+y.DelayDays}function pr(t,i,u){var e=t.startDate?t.startDate:t.crtdate,o=i.startDate?i.startDate:i.crtdate,s=t.deadline?t.deadline:t.milestone?t.milestone.deadline:undefined,h=i.deadline?i.deadline:i.milestone?i.milestone.deadline:undefined,f={};f.invalidLink=!1;f.delay=0;f.possibleLinkType=r.getPossibleTypeLink(e,s,o,h,f);f.linkType=u.linkType;u.linkType==2&&(u.parentTaskId==n.id?(f.linkType=r.linkTypeEnum.end_start,f.possibleLinkType[3]!=r.linkTypeEnum.end_start&&(f.invalidLink=!0)):(f.linkType=r.linkTypeEnum.start_end,f.possibleLinkType[2]!=r.linkTypeEnum.start_end&&(f.invalidLink=!0)));switch(f.linkType){case r.linkTypeEnum.start_start:f.linkTypeText=y.RelatedLinkTypeSS;f.delay=yt(e,o);f.invalidLink=!1;break;case r.linkTypeEnum.end_end:f.linkTypeText=y.RelatedLinkTypeEE;f.delay=yt(s,h);f.invalidLink=!1;break;case r.linkTypeEnum.start_end:f.linkTypeText=y.RelatedLinkTypeSE;f.delay=yt(h,e);break;case r.linkTypeEnum.end_start:f.linkTypeText=y.RelatedLinkTypeES;f.delay=yt(s,o)}return f}function yi(t,i){var r=ct[t];return r?(r.relatedTaskObject=pr(n,r,i),r):null}function pi(n,t){var r,f,u,e,s;n?(r=w.find("tr[data-taskid="+t+"]"),o.css("position","absolute"),f=r.offset().top-jq("#linkedTasksContainer").offset().top-1+"px",o.css("top",f),o.attr("data-edit","edit"),u=i.find("option[value="+t+"]"),u.removeClass(k),u.prop("selected",!0),i.trigger("change"),e=g[t],a=e,a.targetTaskId=t,s=parseInt(r.find(".link-type").data("type")),it.data("value",s)):(o.is(":visible")&&st(!0),o.addClass("border-top"),o.addClass("border-bottom"),w.css("marginTop","0"),i.val("-1"),it.text(""));o.removeClass(k)}function st(n){a&&(n&&i.find("option[value="+a.targetTaskId+"]").addClass(k),a=null);i.val("-1");o.css("position","static");o.removeClass("border-top");o.removeClass("border-bottom");o.addClass(k);v.selected&&v.select()}function wr(){var n=i.find("option:first"),t,r;for(i.empty(),i.append(n),t=0,r=d.length;t<r;t++)n=document.createElement("option"),n.setAttribute("value",d[t].id),g[d[t].id]&&n.setAttribute("class",k),n.appendChild(document.createTextNode(d[t].title)),i.append(n)}function pt(){i.find("."+k).length==i.find("option").length-1||n.status==2?rt.addClass("disabled"):rt.removeClass("disabled")}function br(){for(var u,r=[],f=n.links.length,t=0;t<f;t++)u=n.links[t].parentTaskId==n.id?n.links[t].dependenceTaskId:n.links[t].parentTaskId,r.push(yi(u,n.links[t]));jq(".tab1").html(jq.tmpl("projects_taskLinksContainer",{canEdit:n.canEdit,tasks:r})).show();et=jq("#linkedTasksContainer");v.$container=et;o=jq("#editTable");w=jq("#relatedTasks");i=jq("#taskSelector");it=jq("#linkTypeSelector");hi=jq("#addLink");rt=jq("#addNewLink");at=jq("#hintInvalidLink");ot=jq(".linked-tasks-buttons");ASC.Projects.Base.initActionPanel(tu,et);w.on("mouseenter",".invalid-link",function(){nt=!0;var n=this;setTimeout(function(){nt&&jq(n).helper({BlockHelperID:"hintInvalidLink",addLeft:8,addTop:14})},1e3)});w.on("mouseleave",".invalid-link",function(){nt=!1;vi()});at.on("mouseenter",function(){nt=!0});at.on("mouseleave",function(){nt=!1;vi()});rt.on(ei,function(){rt.hasClass("disabled")||(ot.hide(),pi(!1,{}))});hi.on(ei,function(){var r={},t=parseInt(it.data("value"));if(t=="-1"||i.val()=="-1"){st();ot.show();return}r=t==2?{parentTaskId:i.val(),dependenceTaskId:n.id,linkType:t}:{parentTaskId:n.id,dependenceTaskId:i.val(),linkType:t};t==3&&(r.linkType=2);b.displayLoading();a?(ki(a.targetTaskId,!1),bi(r,a.targetTaskId)):bi(r)});i.on("change",function(){var n=i.val();n!="-1"&&yr(n)});v.selected&&v.select()}function wi(t,r){var u,f;n.links?n.links.push(t):(n.links=[],n.links.push(t));u=t.parentTaskId==n.id?t.dependenceTaskId:t.parentTaskId;g[u]=t;f=yi(u,t);r?r.after(jq.tmpl("projects_taskLinks",[f])):jq.tmpl("projects_taskLinks",[f]).prependTo(w);i.find("option[value="+u+"]").addClass(k)}function oi(n){vr(n);ur(n);rr(n)}function kr(){ASC.Projects.Base.showCommonPopup("closedTaskQuestion",gi.bind(this),yu)}function dr(){u.subscribeToPrjTask({},l,{success:function(){n.isSubscribed=!n.isSubscribed}})}function bi(n,t){u.addPrjTaskLink({link:n,removedLinkTaskId:t},n.parentTaskId,n,{success:ru,error:uu})}function ki(n,t){var i=g[n];u.removePrjTaskLink({taskId:n,removeElemFlag:t},i.dependenceTaskId,{dependenceTaskId:i.dependenceTaskId,parentTaskId:i.parentTaskId},{success:iu,error:function(){}})}function gr(){u.notifyPrjTaskResponsible({},l,{success:function(){r.displayInfoPanel(t.MessageSend)}})}function nu(){var i=[],r=ASC.Projects.ActionMenuItem;return n.status!==2&&n.canEdit&&(n.responsibles.length===0&&i.push(new r("ta_accept",t.Accept,fr)),i.push(new r("ta_edit",t.EditTask,sr)),n.responsibles.length&&n.responsibles.some(function(n){return n.id!=ft})&&i.push(new r("ta_mesres",t.MessageResponsible,gr))),n.canCreateTimeSpend&&i.push(new r("ta_startTimer",e.ProjectsCommonResource.AutoTimer,cr)),typeof n.isSubscribed!="undefined"&&i.push(new r("ta_follow",n.isSubscribed?t.UnfollowTask:t.FollowTask,dr)),n.canDelete&&i.push(new r("ta_remove",t.RemoveTask,hr)),{menuItems:i}}function tu(n){var i=n.data("taskid"),r=[new ASC.Projects.ActionMenuItem("lta_edit",t.Edit,lr.bind(null,i),"edit"),new ASC.Projects.ActionMenuItem("lta_remove",e.ProjectsCommonResource.Delete,ar.bind(null,i),"delete")];return{menuItems:r}}function iu(t){t.removeElemFlag&&(w.find("tr[data-taskid="+t.taskId+"]").remove(),b.hideLoading());n.links=n.links.filter(function(n){return n.dependenceTaskId!=t.taskId&&n.parentTaskId!=t.taskId});t.removeElemFlag&&v.select();delete g[t.taskId];a=null;i.find("option[value="+t.taskId+"]").removeClass(k);pt()}function ru(n){if(st(),n.removedLinkTaskId){var t=w.find("tr[data-taskid="+n.removedLinkTaskId+"]");wi(n.link,t);t.remove()}else wi(n.link);ot.show();pt();v.select();b.hideLoading()}function uu(){b.hideLoading();ASC.Projects.Base.showCommonPopup("createNewLinkError");st();kt=!0;ai()}function fu(i,r){var f;n=r;ai();l=r.id;ir();r.comments=li(r.comments);var s={img:"subtasks",header:t.SubtasksEmptyScreen_Header,description:t.SubtasksEmptyScreen_Describe,button:{title:t.AddNewSubtask,onclick:function(){vt.find(".quickAddSubTaskLink .link").trigger("click")},canCreate:function(){return n.status!==2&&n.canCreateSubtask}}},a={img:"relatedtasks",header:t.RelatedTasksEmptyScreen_Header,description:t.RelatedTasksEmptyScreen_Describe,button:{title:t.CreateNewLink,onclick:function(){o.is(":visible")||rt.trigger("click")},canCreate:function(){return n.status===1&&n.canEdit&&d.length}}},y={img:"comments",header:t.CommentsEmptyScreen_Header,description:t.CommentsEmptyScreen_Describe,button:{title:ASC.Resources.Master.TemplateResource.AddNewCommentButton,onclick:function(){jq("#add_comment_btn").trigger("click")},canCreate:function(){return n.canCreateComment}}},u=ASC.Projects.Tab;gt=new u(e.ProjectsJSResource.OverviewModule,function(){return 0},"overViewModule",jq(".tab"),"#");p=new u(t.Subtasks,function(){return n.subtasks.length},"subtasksModule",vt,"#subtasks",function(){return n.canEdit||n.subtasks.length},s);lt=new u(ASC.Projects.Resources.ProjectsCommonResource.DocsModuleTitle,function(){return n.files.length},"documentsModule",ii,"#documents",function(){return n.canReadFiles&&(n.canEditFiles||n.files.length)});v=new u(t.RelatedTask,function(){return n.links.length},"linksModule",et,"#links",function(){return n.canEdit||n.links.length},a);tt=new u(e.MessageResource.Comments,function(){return n.commentsCount},"commentsModule",ri,"#comments",function(){return!0},y,"#comment_");ni=new u(e.ProjectResource.GanttGart,function(){return 0},"ganttchartModule",null,"GanttChart.aspx",function(){return!jq.browser.mobile&&r.projectOwner.status===0});ni.href="GanttChart.aspx?prjID="+r.projectId;ti=new u(e.ProjectsJSResource.TimeTrackingModule,function(){var n=jq.timeFormat(r.timeSpend).split(":"),t={hours:n[0],minutes:n[1]};return jq.format("{0}:{1}",t.hours,t.minutes)},"timetrackingModule",null,"TimeTracking.aspx",function(){return r.canCreateTimeSpend&&r.timeSpend});ti.href="TimeTracking.aspx?prjID="+r.projectOwner.id+"&id="+r.id;f={icon:"tasks",title:r.title};h.InfoContainer.init(f,nu,[gt,p,lt,v,tt,ti,ni]);jq("#descriptionTab").show();b.hideLoading();c=[n];h.SubtasksManager.setTasks(c);oi(r);document.title=jq.format("{0} - {1}",r.title,ASC.Projects.Resources.ProjectsJSResource.ProductName)}function eu(t,i){n=i;!i.canEdit&&f&&f.banOnEditing();h.InfoContainer.updateTitle(i.title);oi(i);jq.unblockUI();r.displayInfoPanel(y.TaskUpdated)}function ou(){jq.unblockUI();var n="Tasks.aspx?prjID="+wt;window.location.replace(n)}function su(n,t){c[0].subtasks=c[0].subtasks.filter(function(n){return n.id!==t.id});p.select()}function hu(n,t){c[0].subtasks.push(t);p.rewrite()}function cu(n,t){for(var i=0,r=c[0].subtasks.length;i<r;i++)if(c[0].subtasks[i].id===t.id){c[0].subtasks[i]=t;break}p.rewrite()}function di(t,i){n=i;c[0].subtasks=n.subtasks;p.rewrite();oi(i);jq("body").css("cursor","default");pt();jq.unblockUI()}function lu(n,t){var r=t.length,i;if(r)for(i=0;i<r;i++)t[i].status==2&&(ct[t[i].id]=t[i]);br();wr();pt()}function au(t,i){var f,r;if(si=[],d=[],f=i.length,f)for(r=0;r<f;r++)i[r].id==n.id&&kt&&(kt=!1),i[r].status==1&&i[r].id!=n.id&&(si.push(i[r]),(i[r].deadline||n.deadline)&&d.push(i[r])),ct[i[r].id]=i[r];u.getPrjTasksById({},{taskid:bt},{success:lu})}function vu(){n.commentsCount--;tt.select();n.commentsCount===0&&tt.select()}function gi(){jq("body").css("cursor","wait");u.updatePrjTask({},l,{status:2,statusId:this.id},{success:di})}function yu(){ASC.Projects.DescriptionTab.resetStatus(n.status);jq.unblockUI()}function nr(n){var t=n.replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\n/ig,"<br/>");return t.replace("&amp;","&")}function pu(n){var t=new Date;return t>n?!0:t<=n?!1:void 0}function wu(){jq(".project-info-container").hide();jq("#descriptionTab").hide();jq(document).off("keydown.taskdescr");jq(document).off("keydown.description");f.unbind();bu()}function ut(n,t){fi.push(u.bind(n,t))}function bu(){while(fi.length){var n=fi.shift();u.unbind(n)}}var n={},c=[],l=undefined,wt=undefined,ft,ht=!1,ct={},si=[],d=[],bt=[],g={},a=null,kt=!1,nt=!1,dt,gt,p,lt,v,tt,ni,ti,o,w,i,it,hi,rt,at,vt,ii,ri,ci,s,et,ot,h=ASC.Projects,e=h.Resources,y=e.ProjectsJSResource,t=e.TaskResource,r=h.Common,ui=h.Master,u,f,b,fi=[],k="display-none",ei="click",tr=function(){var t,i;h.Base.clearTables();jq("#filterContainer").hide();vt=jq("#subtaskContainer");ii=jq("#filesContainer");ri=jq("#commonCommentsContainer");ci=ri.find("#mainCommentsContainer");s=vt.find(".subtasks");jq(".tab1").html(jq.tmpl("projects_taskLinksContainer",{canEdit:!1,tasks:[]}));et=jq("#linkedTasksContainer");u=Teamlab;b=LoadingBanner;b.displayLoading();ft=Teamlab.profile.id;jq("#CommonListContainer").show();t=u.events;ut(t.addSubtask,hu);ut(t.removeSubtask,su);ut(t.updateSubtask,cu);ut(t.updatePrjTask,eu);ut(t.removePrjTask,ou);ut(t.addPrjComment,function(){ht?ht=!1:CommentsManagerObj.editorInstance.getData()&&(n.commentsCount++,tt.rewrite())});h.SubtasksManager.init();ASC.Projects.Base.initActionPanel(h.SubtasksManager.showEntityMenu,s);wt=jq.getURLParam("prjID");i=jq.getURLParam("id");r.initCustomStatuses(function(){i!=null?u.getPrjTask({},i,{success:fu,error:function(n,t){t[0]==="Item not found"&&ASC.Projects.Base.setElementNotFound()}}):b.hideLoading()})};return{init:tr,onDeleteComment:vu,compareDates:pu,unbindListEvents:wu}}(jQuery);
typeof ASC=="undefined"&&(ASC={});typeof ASC.Projects=="undefined"&&(ASC.Projects={});ASC.Projects.Description=function(){function e(){if(t=Teamlab,u=ASC.Projects.AllProject,n){f();return}r=t.bind(t.events.getPrjProject,function(t,i){document.location.pathname.toLowerCase().endsWith("projects.aspx")&&(n=i,f())})}function i(n){var t=n.replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\n/ig,"<br/>");return t.replace("&amp;","&")}function f(){function c(){ASC.Projects.DescriptionTab.resetStatus(n.status);jq.unblockUI()}function o(i){i===1&&u.showQuestionWindow(n,c)||t.updatePrjProjectStatus({},n.id,{id:n.id,status:i},{success:function(){location.reload()}})}var f=ASC.Projects,r=f.Resources,s=r.ProjectResource,e=r.ProjectsJSResource;f.ProjectsAdvansedFilter.hide();f.Base.clearTables();var l=n.tags.length?n.tags.reduce(function(n,t){return n+", "+t}):"",h=[{title:e.StatusOpenProject,id:0,handler:o.bind(null,0)},{title:e.StatusSuspendProject,id:2,handler:o.bind(null,2)},{title:e.StatusClosedProject,id:1,handler:o.bind(null,1)}],a=n.status,v=h.find(function(n){return n.id===a});f.DescriptionTab.init().push(r.ProjectsCommonResource.ProjectName,i(n.title)).push(s.ProjectLeader,n.responsible.displayName).push(r.ProjectsFilterResource.ByCreateDate,n.displayDateCrtdate).push(r.ProjectsCommonResource.Description,jq.linksParser(i(n.description))).push(s.Tags,i(l)).setStatuses(h).setCurrentStatus(v).setStatusRight(n.canEdit).tmpl();jq("#descriptionTab").show()}function o(){t.unbind(r);n=null}var n,t,r,u;return{init:e,unbindListEvents:o}}();ASC.Projects.AllProject=function(){function rt(t){return n.showCommonPopup("projectsRemoveWarning",function(){r.removePrjProjects({projectids:t},{before:function(){y.displayLoading()},success:function(t,r){for(var e=0;e<r.length;e++)ot(r[e]);n.showOrHideData(i,s);y.hideLoading();u.Common.displayInfoPanel(f.ProjectsRemoved)}});jq.unblockUI()}),!1}function l(n){return jq.extend(n,{projLink:jq.format("{0}Tasks.aspx?prjID={1}",c,n.id),linkMilest:jq.format("{0}Milestones.aspx?prjID={1}#sortBy=deadline&sortOrder=ascending&status=open",c,n.id),linkTasks:jq.format("{0}Tasks.aspx?prjID={1}#sortBy=deadline&sortOrder=ascending&status=open",c,n.id),participants:n.participantCount?n.participantCount-1:"",linkParticip:jq.format("{0}ProjectTeam.aspx?prjID={1}",c,n.id),isSimpleView:o||!1})}function k(r,u){i=u;e=t.find("tbody");o||(s=r.__total!=undefined?r.__total:0);n.showOrHideData(i.map(l),s)}function ot(n){var r=n.id,t=e.find("tr[id="+r+"]");t.yellowFade();t.remove();s--;i=i.filter(function(t){return t.id!==n.id})}function st(n,t){var i=a(t.projectOwner.id),r=lt(t.projectOwner.id);i&&r.length&&(i.taskCount++,r.find("td.taskCount a").text(i.taskCount))}function ht(n,t){if(t!==1||!d(n)){var i={id:n,status:t};r.updatePrjProjectStatus({},n,i,{success:function(i,u){at(u);ct(u);t==1||t==2?r.getPrjTeam({},n,function(t,i){r.removeCaldavProjectCalendar(n,jq.map(i,function(n){return n.id}))}):t==0&&r.getCalendarCaldavUrl("Project_"+n)}})}}function ct(n){var i=t.find("tr#"+n.id);i.find("span:first-child").attr("class",ASC.Projects.StatusList.getById(n.status).cssClass);n.isPrivate&&i.find("span:first-child").addClass("private");n.status!==0?(i.addClass("noActiveProj"),i.find(".linkHeaderMedium").addClass("gray-text")):(i.removeClass("noActiveProj"),i.find(".linkHeaderMedium").removeClass("gray-text"));i.removeClass("openList")}function d(t,i){n=typeof n=="undefined"?this:n;var r=typeof t=="number"?l(a(t)):l(t);return r.taskCount?(n.showCommonPopup("projectOpenTaskWarning",function(){location.href=r.linkTasks},i),!0):r.milestoneCount?(n.showCommonPopup("projectOpenMilestoneWarning",function(){location.href=r.linkMilest},i),!0):!1}function a(n){return i.find(function(t){return t.id==n})}function p(n){return a(jq(n).parents("#tableListProjects tr").attr("id"))}function lt(n){return t.find(jq.format("tr#{0}",n))}function at(n){for(var t=0,r=i.length;t<r;t++)if(i[t].id===n.id){i[t]=n;break}}var v=!1,w,t=null,n,u,g,f,e,nt,o,s=0,i,y,h="click",tt="click.projectsInit",b="projects_projectTmpl",r,it=function(s){var c,d,tt,l;if(o=s,v===!1&&(v=!0,c=ASC.Projects.Resources,r=Teamlab,y=LoadingBanner,t=jq("#tableListProjects"),o||(tt=[{id:"gaDelete",title:c.ProjectsCommonResource.Delete,handler:rt,checker:function(n){return n.canDelete}}],l=c.ProjectsFilterResource,d={actions:tt,getItemByCheckbox:p,getLineByCondition:function(n){return i.filter(n).map(function(n){return e.find("tr[id="+n.id+"]")})},multiSelector:[{id:"gasOpen",title:l.StatusOpenProject,condition:function(n){return n.status===0}},{id:"gasPaused",title:l.StatusSuspend,condition:function(n){return n.status===2}},{id:"gasClosed",title:l.StatusClosedProject,condition:function(n){return n.status===1}}]}),n=this,n.showOrHideData=n.showOrHideData.bind(n,{$container:t.find("tbody"),tmplName:b,baseEmptyScreen:{img:"projects",header:c?c.ProjectResource.EmptyListProjHeader:"",description:c?r.profile.isVisitor?c.ProjectResource.EmptyListProjDescribeVisitor:c.ProjectResource.EmptyListProjDescribe:"",button:{title:c?c.ProjectResource.CreateFirstProject:"",onclick:function(){location.href="Projects.aspx?action=add"},canCreate:function(){return ASC.Projects.Master.CanCreateProject}}},filterEmptyScreen:{header:c?c.ProjectsCommonResource.Filter_NoProjects:"",description:c?c.ProjectResource.DescrEmptyListProjFilter:""},groupMenu:d}),n.getData=n.getData.bind(n,r.getPrjProjects,k)),nt=r.profile.id,!o){u=ASC.Projects;g=u.Resources.ProjectsFilterResource;f=u.Resources.ProjectsJSResource;w=u.ProjectsAdvansedFilter;w.createAdvansedFilterForProjects(n);n.baseInit({moduleTitle:f.ProjectsModule,elementNotFoundError:f.ProjectNotFound},{pagination:"projectsKeyForPagination"},{handler:ht,getItem:p,statuses:[{cssClass:"open",text:f.StatusOpenProject,id:0},{cssClass:"paused",text:f.StatusSuspendProject,id:2},{cssClass:"closed",text:f.StatusClosedProject,id:1}]},undefined,[ASC.Projects.Event(r.events.addPrjTask,st)],{getItem:p,selector:".nameProject a",getLink:function(n){return"Projects.aspx?prjID="+n.id+"#"}});t.on(h,".nameProject a",u.Common.goToWithoutReload);t.on(h,".taskCount a",u.Common.goToWithoutReload);t.on(h,".responsible .participants",u.Common.goToWithoutReload);t.on(h,"td.responsible span.userLink",function(){var n=jq(this),t;n.hasClass("not-action")||(t=a(n.parents("#tableListProjects tr").attr("id")),ASC.Projects.ProjectsAdvansedFilter.addUser("project_manager",t.responsible.id,["team_member"]))})}},ut=function(){v&&(t.off(),n.unbindEvents(),jq("body").off(tt))},ft=function(n){k({},n)},et=function(n){e=t.find("tbody");n=l(n);jq.tmpl(b,n).prependTo(e);t.show()},c=StudioManager.getLocationPathToModule("Projects");return jq.extend({addProjectsToSimpleList:et,basePath:"sortBy=create_on&sortOrder=ascending",init:it,renderListProjects:ft,unbindListEvents:ut,showQuestionWindow:d},ASC.Projects.Base)}(jQuery);
ASC.Projects.Templates=function(){var n=function(){var n=jq.getURLParam("id"),t=jq.getURLParam("action");(n==null&&t=="add"||n&&t=="edit")&&ASC.Projects.EditProjectTemplates.init();n==null&&t==null&&ASC.Projects.ListProjectsTemplates.init()};return{init:n}}(jQuery);ASC.Projects.ListProjectsTemplates=function(){function a(n){var u=ASC.Projects.Resources.ProjectTemplatesResource,t=parseInt(n.attr("id")),e=i.find(function(n){return n.id===t}),f=ASC.Projects.ActionMenuItem,r=[];return e.canEdit&&r.push(new f("editTmpl",u.Edit,v.bind(null,t),"edit")),ASC.Projects.Master.CanCreateProject&&r.push(new f("createProj",u.CreateProject,p.bind(null,t),"project")),e.canEdit&&r.push(new f("deleteTmpl",u.Delete,y.bind(null,t),"delete")),{menuItems:r}}function v(n){s();window.location.replace("ProjectTemplates.aspx?id="+n+"&action=edit")}function y(n){s();t=parseInt(n);ASC.Projects.Base.showCommonPopup("projectTemplateRemoveWarning",function(){f.removePrjTemplate({tmplId:t},t,{success:w})},function(){t=0})}function p(n){s(!0);window.location.replace("Projects.aspx?tmplid="+n+"&action=add")}function w(){jq("#"+t).remove();t=0;var i=n.find(u);i.length||(n.hide(),h());jq.unblockUI()}function h(){var n={img:"templates",header:o.ProjectTemplatesResource.EmptyListTemplateHeader,description:o.ProjectTemplatesResource.EmptyListTemplateDescr,button:{title:o.ProjectTemplatesResource.EmptyListTemplateButton,onclick:function(){location.href="ProjectTemplates.aspx?action=add"},canCreate:function(){return!0}}};jq("#emptyScrCtrlPrj").html(jq.tmpl("projects_emptyScreen",n)).show();jq("#emptyScrCtrlPrj .addFirstElement").off("click").on("click",n.button.onclick)}function b(n){var o=0,r=0,u={tasks:[],milestones:[]},t,f,i,e;try{u=JSON.parse(n.description)||{tasks:[],milestones:[]}}catch(s){}if(t=u.milestones,f=u.tasks,f&&(r=f.length),t)for(o=t.length,i=0;i<t.length;i++)e=t[i].tasks,e&&(r+=e.length);return{title:n.title,id:n.id,milestones:o,tasks:r}}function k(t,f){var e,o;if(i=f,i.length)for(e=0;e<i.length;e++)o=b(i[e]),jq.tmpl("projects_templateTmpl",o).appendTo(n);else h();jq.dropdownToggle({dropdownID:"templateActionPanel",switcherSelector:"#listTemplates .entity-menu",addTop:0,addLeft:10,rightPos:!0,showFunction:function(t,i){var f=jq(t).closest(u),e=n.find(u+"."+r);i.attr(c,f.attr("id"));e.removeClass(r);e.is(f)||i.hide();i.is(":hidden")&&f.addClass(r)},hideFunction:function(){n.find(u).removeClass(r)}})}function s(n){jq(".studio-action-panel").hide();jq(u).removeClass(r);n&&(window.onbeforeunload=null)}var t,i,c="target",r="open",u=".template",n,f,e,o=ASC.Projects.Resources,l=function(){f=Teamlab;e=LoadingBanner;n=jq("#listTemplates");jq("#CommonListContainer").show();ASC.Projects.Base.initActionPanel(a,n);f.getPrjTemplates({},{success:k,before:e.displayLoading,after:e.hideLoading})};return{init:l}}(jQuery);ASC.Projects.EditProjectTemplates=function(){function h(){return n.val().length||jq("#listAddedMilestone .milestone").length||jq("#noAssignTaskContainer .task").length}function c(t,r){i=r.id;ASC.Projects.EditMilestoneContainer.showTmplStructure(r);n.val(r.title)}function o(u){var v,w,h,o,s,b,k,y,c,p;if(!jq(this).hasClass("disable")){if(jq("."+f).removeClass(f),n.val().trim()==""){e.addClass(f);jq.scrollTo(e);n.trigger("focus");return}for(jq(this).addClass("disable"),ASC.Projects.MilestoneContainer.hideAddTaskContainer(),ASC.Projects.MilestoneContainer.hideAddMilestoneContainer(),v={tasks:[],milestones:[]},w=jq("#noAssignTaskContainer .task"),o=0;o<w.length;o++)v.tasks.push({title:jq(w[o]).children(".titleContainer").text()});for(h=jq("#listAddedMilestone .milestone"),o=0;o<h.length;o++){for(s=jq(h[o]).children(".mainInfo").children(".daysCount").attr("value"),s=s.replace(",","."),s=parseFloat(s),b={title:jq(h[o]).children(".mainInfo").children(".titleContainerEdit").text(),duration:s,tasks:[]},k=jq(h[o]).children(".milestoneTasksContainer").children(".listTasks").children(".task"),y=0;y<k.length;y++)b.tasks.push({title:jq(k[y]).children(".titleContainer").text()});v.milestones.push(b)}c={title:n.val().trim(),description:JSON.stringify(v)};p=l;u=="saveAndCreateProj"&&(p=a);i?(c.id=i,r.updatePrjTemplate({},c.id,c,{success:p,before:t.displayLoading,after:t.hideLoading})):r.createPrjTemplate({},c,{success:p,before:t.displayLoading,after:t.hideLoading})}}function l(){window.onbeforeunload=null;document.location.replace("ProjectTemplates.aspx")}function a(n,t){t.id&&(window.onbeforeunload=null,document.location.replace("Projects.aspx?tmplid="+t.id+"&action=add"))}var i=null,u="click",f="requiredFieldError",n,e,r,t,s=function(){var s,f;for(r=Teamlab,t=LoadingBanner,n=jq("#templateTitle"),e=jq("#templateTitleContainer"),s=[],f=1;f<=12;f=f+.5)s.push(f);jq("#amContainer").html(jq.tmpl("projects_action_template",{edit:!0,month:s}));ASC.Projects.MilestoneContainer.init();i=jq.getURLParam("id");i&&r.getPrjTemplate({},i,{success:c,before:t.displayLoading,after:t.hideLoading});n.trigger("focus");jq("#saveTemplate").on(u,function(){return o.call(this,"save"),!1});jq("#createProject").on(u,function(){return o.call(this,"saveAndCreateProj"),!1});jq("#cancelCreateProjectTemplate").on(u,function(){window.onbeforeunload=null;window.location.replace("ProjectTemplates.aspx")});jq.confirmBeforeUnload(h)};return{init:s}}(jQuery);
ASC.Projects.ProjectTeam=function(){function k(i){var f=i.attr("data-partisipantid"),s=n.TeamWithBlockedUsers.find(function(n){return n.id===f}),u=ASC.Projects.ActionMenuItem,o=ASC.Projects.Resources,r=[];return s.isVisitor||(e.canCreateTask&&!s.isTerminated&&r.push(new u("team_task",o.TaskResource.AddNewTask,d.bind(null,f),"new-task")),t.profile.isVisitor||(r.push(new u("team_reportOpen",o.ReportResource.ReportOpenTasks,tt.bind(null,f),"open-tasks-report")),r.push(new u("team_reportClosed",o.ReportResource.ReportClosedTasks,it.bind(null,f),"closed-tasks-report"))),r.length&&r.push(new u(null,null,null,null,!0)),r.push(new u("team_view",o.ProjectsJSResource.ViewAllOpenTasks,g.bind(null,f),"preview"))),t.profile.id!==f&&(s.email&&r.push(new u("team_email",o.ProjectResource.ClosedProjectTeamWriteMail,rt.bind(null,s.email),"email")),r.push(new u("team_jabber",o.ProjectResource.ClosedProjectTeamWriteInMessenger,nt.bind(null,s.userName),"chat")),e.security.canEditTeam&&f!==e.responsibleId&&(r.length>=3&&r.push(new u(null,null,null,null,!0)),r.push(new u("team_remove",o.ProjectsCommonResource.RemoveMemberFromTeam,ut.bind(null,f),"user")))),{menuItems:r}}function d(t){var r=n.TeamWithBlockedUsers.find(function(n){return n.id===t});return i.TaskAction.showCreateNewTaskForm({responsibles:[r]}),!1}function g(n){var t="Tasks.aspx#sortBy=deadline&sortOrder=ascending&tasks_responsible="+n;return window.open(t,"displayOpenUserTasks","status=yes,toolbar=yes,menubar=yes,scrollbars=yes,resizable=yes,location=yes,directories=yes,menubar=yes,copyhistory=yes"),!1}function nt(n){return ASC.Controls.JabberClient.open(n),!1}function tt(n){ASC.Projects.ReportGenerator.generate("generatedreport.aspx?reportType=10&ftime=absolute&fu="+n+"&fms=open|closed&fts=open")}function it(n){ASC.Projects.ReportGenerator.generate("generatedreport.aspx?reportType=10&ftime=absolute&fu="+n+"&fms=open|closed&fts=closed")}function rt(n){return a&&!t.profile.isVisitor?window.open("../../addons/mail/#composeto/email="+n,"_blank"):window.location.href="mailto:"+n,!1}function ut(n){return t.removePrjProjectTeamPerson({userId:n},f,{userId:n},{success:ft}),!1}function ft(t){var r,u;for(jq("tr[data-partisipantid='"+t.userId+"']").remove(),jq("#pm-projectTeam-Selector").useradvancedSelector("unselect",[t.userId]),r=0,u=n.Team.length;r<u;r++)if(n.Team[r].id==t.userId){n.Team.splice([r],1);break}for(r=0,u=n.TeamWithBlockedUsers.length;r<u;r++)if(n.TeamWithBlockedUsers[r].id==t.userId){n.TeamWithBlockedUsers.splice([r],1);break}i.TaskAction.onUpdateProjectTeam()}function et(t){n.TeamWithBlockedUsers=t;n.Team=i.Common.removeBlockedUsersFromTeam(n.TeamWithBlockedUsers);i.TaskAction.onUpdateProjectTeam()}function v(n,i){i=t.create("prj-projectpersons",null,i);ot(i);et(i)}function y(){var t=jq(window).width()-48,i=parseInt(jq(".mainPageLayout").css("min-width"),10),n=t<i?i:t,u=jq(".right-settings");u.length&&(n-=u.width());r.find(".user-info-container").each(function(){jq(this).css("max-width",n-72-jq(".mainPageTableSidePanel").width()-jq(".menupoint-container").width()-jq(".pm-projectTeam-userPhotoContainer").outerWidth(!0)+"px")});jq.browser.msie&&(r.find(".user-info-container").each(function(){jq(this).css("width",n+"px")}),r.find(".user-info").each(function(){jq(this).css("width",n+50+"px")}))}function ot(n){r.html(st(n,e))}function st(n,t){return jq.tmpl("memberTemplate",{team:n.map(h),project:t,isRetina:jq.cookies.get("is_retina")})}function h(t){var i=ASC.Projects.Resources;return t=jq.extend({},t,window.UserManager.getUser(t.id)),t.isManager=u===t.id,t.isProjectAdmin=t.groups&&t.groups.indexOf(n.ProjectsProductID)>-1,jq.extend({security:[o(t.canReadMessages,"Messages",i.MessageResource.Messages),o(t.canReadFiles,"Files",i.ProjectsFileResource.Documents),o(t.canReadTasks,"Tasks",i.TaskResource.AllTasks),o(t.canReadMilestones,"Milestone",i.MilestoneResource.Milestones),o(t.canReadContacts,"Contacts",i.ProjectsCommonResource.ModuleContacts,t.isVisitor)]},t)}function o(n,t,i,r){var u={check:n,flag:t,title:i};return typeof r=="boolean"&&(u.defaultDisabled=r),u}function ht(){t.unbind(l);r.off(c)}var f=null,u=null,p=null,i,n,w="pm-projectTeam-modulePermissionOff",r,t,s,c="click",e,l,a,b=function(){t=Teamlab;s=LoadingBanner;i=ASC.Projects;n=i.Master;p=t.profile.id;f=parseInt(jq.getURLParam("prjID"));i.ProjectsAdvansedFilter.hide();i.Base.clearTables();l=t.bind(t.events.getPrjProject,function(o,l){function d(n,i){var r=[],u;jq(i).each(function(n,t){r.push(t.id)});u={participants:r,notify:!0};t.updatePrjTeam({projectId:f},f,u,{before:s.displayLoading,success:v,after:s.hideLoading})}var b,p,a;u=l.responsibleId;b=i.Master.TeamWithBlockedUsers.sort(function(n,t){return n.isTerminated-t.isTerminated}).map(h);p=jq.cookies.get("is_retina");jq(".tab1").html(jq.tmpl("projects_team",{project:l,team:b,manager:l.responsible,isRetina:p})).show();jq("#descriptionTab").show();e=l;jq(window).on("resize",y);r=jq("#team_container");jq("#CommonListContainer").show();ASC.Projects.Base.initActionPanel(k,r);r.on(c,".right-checker",function(){var n=jq(this),i;n.closest("tr").hasClass("disable")||n.hasClass("no-dotted")||(i={userId:jq(this).closest(".pm-projectTeam-participantContainer").attr("data-partisipantId"),security:n.attr("data-flag"),visible:n.hasClass(w)},t.setTeamSecurity({partisipant:i.userId,securityFlag:i.security},f,i,{success:v}))});y();a=n.TeamWithBlockedUsers.map(function(n){return n.id}).filter(function(n){return n!==u});a.indexOf(u)<0&&a.push(u);jq("#pm-projectTeam-Selector").useradvancedSelector({showGroups:!0,itemsSelectedIds:a,itemsDisabledIds:[u]}).on("showList",d);jq("#PrivateProjectHelp").off("click").on("click",function(){jq(this).helper({BlockHelperID:"AnswerForPrivateProjectTeam"})});jq("#RestrictAccessHelp").off("click").on("click",function(){jq(this).helper({BlockHelperID:"AnswerForRestrictAccessTeam"})});p&&t.getUserPhoto({},l.responsible.id,{success:function(n,t){t&&typeof t.max=="string"&&t.max.indexOf("default")===-1&&jq(".managerAvatar").attr("src",t.max)}})});t.getWebItemSecurityInfo({},"2A923037-8B2D-487b-9A22-5AC0918ACF3F",{success:function(n,t){a=t[0].enabled}})};return{init:b,unbindListEvents:ht,mapTeamMember:h}}(jQuery);
ASC.Projects.AllMilestones=function(){function ht(n,t){if(t===1){var i=o(n);if(i&&i.activeTasksCount){ut(n);return}}r.updatePrjMilestone({milestoneId:n},n,{status:t},{error:dt})}function ct(n){var t=o(n),i={id:t.id,project:t.projectId,responsible:t.responsibleId,deadline:t.deadline,title:t.title,description:t.description,isKey:t.isKey,isNotify:t.isNotify};e.onGetMilestoneBeforeUpdate(i)}function lt(n){var t=o(n),i={milestoneId:n,projectId:t.projectId};ASC.Projects.TaskAction.showCreateNewTaskForm(i)}function at(t){var i=o(t);n.showCommonPopup("milestoneRemoveWarning",function(){v.displayLoading();e.updateCaldavMilestone(i.id,i.projectId,2);r.removePrjMilestone(t);jq.unblockUI()})}function vt(t){n.showCommonPopup("milestonesRemoveWarning",function(){v.displayLoading();r.removePrjMilestones({ids:t},{success:function(n,t){for(var i=0;i<t.length;i++)e.updateCaldavMilestone(t[i].id,t[i].projectId,2),r.call(r.events.removePrjMilestone,this,[{disableMessage:!0},t[i]]);v.hideLoading();c.displayInfoPanel(h.MilestonesRemoved)}});jq.unblockUI()})}function yt(t,r){l=u.find("tbody");s=t.__total!=undefined?t.__total:0;i=r.map(k);n.showOrHideData(i,s)}function k(n){var i=n.id,r=n.projectId,t={id:i,isKey:n.isKey,isNotify:n.isNotify,title:n.title,activeTasksCount:n.activeTaskCount||0,activeTasksLink:rt(r,i,"open"),closedTasksCount:n.closedTaskCount||0,closedTasksLink:rt(r,i,"closed"),canEdit:n.canEdit,canDelete:n.canDelete,projectId:r,projectTitle:n.projectTitle,createdById:n.createdBy.id,createdBy:n.createdBy.displayName,description:n.description,created:n.displayDateCrtdate},u;return n.responsible?(t.responsible=n.responsible.displayName,t.responsibleId=n.responsible.id,t.isTerminated=n.responsible.isTerminated):(t.responsible=null,t.responsibleId=null,t.isTerminated=!1),u=new Date,t.overdue=n.status===0&&u>=n.deadline,t.status=n.status,t.deadline=n.displayDateDeadline,t}function ut(t){n.showCommonPopup("closeMilestoneWithOpenTasks",function(){var n=o(t);location.href="Tasks.aspx?prjID="+n.projectId+"#milestone="+t+"&status=open"})}function pt(n){var i=n.attr("id"),f=o(i),r=[],u=ASC.Projects.ActionMenuItem;return f.status!=="closed"&&(r.push(new u("updateMilestoneButton",t.TaskResource.Edit,ct.bind(null,i),"edit")),r.push(new u("addMilestoneTaskButton",t.TaskResource.AddTask,lt.bind(null,i),"new-task"))),f.canDelete&&r.push(new u("removeMilestoneButton",t.ProjectsCommonResource.Delete,at.bind(null,i),"delete")),{menuItems:r}}function bt(t,r){(a=jq.getURLParam("prjId"),a&&a!=r.projectId)||(s++,i.unshift(k(r)),n.showOrHideData(i,s),l.find("tr:first").yellowFade(),e.unlockMilestoneActionPage(),jq.unblockUI())}function ft(n,t){var r,o,f;t.status==0?e.updateCaldavMilestone(t.id,t.projectId,1):t.status==1&&e.updateCaldavMilestone(t.id,t.projectId,2);r=k(t);i=i.filter(function(n){return n.id!==t.id});i.push(r);o=u.find("#"+t.id);f=jq.tmpl(b,r);o.replaceWith(f);f.yellowFade();e.unlockMilestoneActionPage();jq.unblockUI();c.displayInfoPanel(h.MilestoneUpdated)}function kt(n,t){f.GroupActionPanel.deselectAll();c.changeMilestoneCountInProjectsCache(t,1);ft(n,t)}function dt(n,t){t[0]==="Can not close a milestone with open tasks"?ut(n.milestoneId):c.displayInfoPanel(t[0],!0)}function gt(t,r){var e=r.id,f=u.find("#"+e);f.yellowFade();f.remove();s--;i=i.filter(function(n){return n.id!==r.id});g.update(s);l.children("tr").length===0&&(g.hide(),n.showOrHideData([],s));ASC.Projects.Master.Milestones=ASC.Projects.Master.Milestones.filter(function(n){return n.id!==r.id});v.hideLoading();t&&t.disableMessage||c.displayInfoPanel(h.MilestoneRemoved);c.changeMilestoneCountInProjectsCache(r,2)}function ni(n,t){var i,r,u;t.milestone!=null&&(i=o(t.milestone.id),r=l.find("#"+t.milestone.id),i&&r.length)&&(i.activeTasksCount++,u=jq.tmpl(b,i),r.replaceWith(u),u.yellowFade())}function y(n){return o(jq(n).parents("#milestonesList tr").attr("id"))}function o(n){return i.find(function(t){return t.id==n})}var f=ASC.Projects,t=f.Resources,h=t.ProjectsJSResource,d=f.ProjectsAdvansedFilter,g=f.PageNavigator,c=f.Common,e=f.MilestoneAction,nt,u,l,tt,p=!1,a,s=0,it,n,i=[],w="click",et=w+".milestonesInit",b="projects_milestoneTemplate",ot=".entity-menu",r,v,st=function(){var c,i,o;if(r=Teamlab,v=LoadingBanner,it=r.profile.id,u=jq("#milestonesList"),l=u.find("tbody"),tt=jq("#emptyListMilestone"),a=jq.getURLParam("prjID"),p===!1){p=!0;n=this;function s(n){return n.canCreateMilestone}c=[{id:"gaDelete",title:t.ProjectsCommonResource.Delete,handler:vt,checker:function(n){return n.canDelete}}];n.showOrHideData=n.showOrHideData.bind(n,{$container:u.find("tbody"),tmplName:b,baseEmptyScreen:{img:"milestones",header:t.MilestoneResource.MilestoneNotFound_Header,description:r.profile.isVisitor?t.MilestoneResource.MilestonesMarkMajorTimestampsVisitor:t.MilestoneResource.MilestonesMarkMajorTimestamps,button:{title:t.MilestoneResource.PlanFirstMilestone,onclick:e.showNewMilestonePopup,canCreate:function(){return a?s(nt):f.Master.Projects.some(s)}}},filterEmptyScreen:{header:t.MilestoneResource.FilterNoMilestones,description:t.MilestoneResource.DescrEmptyListMilFilter},groupMenu:{actions:c,getItemByCheckbox:y}});n.getData=n.getData.bind(n,r.getPrjMilestones,yt)}i=ASC.Projects.Event;o=r.events;n.baseInit({moduleTitle:h.MilestonesModule},{pagination:"milestonesKeyForPagination"},{handler:ht,getItem:y,statuses:[{cssClass:"open",text:h.StatusOpenMilestone,id:0},{cssClass:"closed",text:h.StatusClosedMilestone,id:1}]},pt,[i(o.addPrjTask,ni),i(o.addPrjMilestone,bt),i(o.updatePrjMilestone,ft),i(o.removePrjMilestone,gt),i(o.updatePrjMilestoneStatus,kt),i(o.getPrjProject,function(n,t){nt=t})],{getItem:y,selector:"tr .title a"});d.createAdvansedFilterForMilestones(n);u.on(w,"td.responsible span",function(){var n=jq(this),t;n.hasClass("not-action")||(t=y(n),d.addUser("responsible_for_milestone",t.responsibleId,["user_tasks"]))});u.on(w,"td.activeTasksCount a, td.closedTasksCount a",f.Common.goToWithoutReload)},rt=function(n,t,i){var r="Tasks.aspx?prjID="+n+"#milestone="+t+"&status="+i;return location.hash.indexOf("user_tasks")>0&&(r+="&tasks_responsible="+jq.getAnchorParam("user_tasks",location.href)),r},wt=function(){for(var t=i,n=0;n<t.length;n++)t[n].responsibleId!=it&&jq("tr#"+t[n].id).find(ot).remove();tt.find(".emptyScrBttnPnl").remove()},ti=function(){p&&(u.off(),n.unbindEvents(),jq("body").off(et))};return jq.extend({init:st,removeMilestonesActionsForManager:wt,unbindListEvents:ti,basePath:"sortBy=deadline&sortOrder=ascending"},ASC.Projects.Base)}(jQuery);
ASC.Projects.Discussions=function(n){function b(n,i){var f,u;if(c=n.__total!=undefined?n.__total:0,t.showOrHideData(i.map(d),c),jq(".content-list p").filter(function(){return jq(this).html()==="&nbsp;"}).remove(),jq.cookies.get("is_retina"))for(f=i.map(function(n){return n.createdBy.id}).filter(function(n,t,i){return i.indexOf(n)===t}),u=0;u<f.length;u++)r.getUserPhoto({},f[u],{success:k(f[u],i)})}function k(t){return function(r,u){!u.max||u.max.indexOf("default")>-1||i.find('.avatar-list img[src*="'+t+'"]').each(function(){n(this).attr("src",u.max)})}}function d(n){var u=n.id,r=n.projectId,t="Messages.aspx?prjID="+r+"&id="+u,i={createdDate:n.displayDateCrtdate,createdTime:n.displayTimeCrtdate,title:n.title,discussionUrl:t,authorAvatar:n.createdBy.avatarBig||n.createdBy.avatar,authorId:n.createdBy.id,authorName:n.createdBy.displayName,authorPost:n.createdBy.title,status:n.status,projectId:r,text:n.text,hasPreview:n.text.search('class="asccut"')>0,commentsCount:n.commentsCount,commentsUrl:t+"#comments",writeCommentUrl:t+"#"+p,canComment:n.canCreateComment};return f||(i.projectTitle=n.projectTitle,i.projectUrl="Projects.aspx?prjID="+n.projectId),i}var h=!1,f,c=0,i,t,r,e=ASC.Projects,l=e.Resources,u=l.MessageResource,a=l.ProjectsJSResource,o=e.ProjectsAdvansedFilter,v,y,p="addcomment",s="click",w=function(){if(f=n.getURLParam("prjID"),i=n("#discussionsList"),r=Teamlab,h===!1){h=!0;t=this;function c(n){return n.canCreateMessage}t.showOrHideData=t.showOrHideData.bind(t,{$container:i,tmplName:"projects_discussionTemplate",baseEmptyScreen:{img:"discussions",header:u.DiscussionNotFound_Header,description:r.profile.isVisitor?u.DiscussionNotFound_DescribeVisitor:u.DiscussionNotFound_Describe,button:{title:u.StartFirstDiscussion,onclick:function(){location.href=jq.format("Messages.aspx?action=add{0}",f!=null?"&prjID="+f:"")},canCreate:function(){return f?c(v):ASC.Projects.Master.Projects.some(c)}}},filterEmptyScreen:{header:u.FilterNoDiscussions,description:u.DescrEmptyListMilFilter}});t.getData=t.getData.bind(t,r.getPrjDiscussions,b)}t.baseInit({elementNotFoundError:a.DiscussionNotFound,moduleTitle:a.DiscussionsModule},{pagination:"discussionsKeyForPagination",small:!0});y=r.bind(r.events.getPrjProject,function(n,t){v=t});o.createAdvansedFilterForDiscussion(t);i.on(s,".title-list a",e.Common.goToWithoutReload);i.on(s,".title-list .status",function(){o.add("status","archived")});i.on(s,".name-list.project",function(){o.add("project",n(this).attr("data-projectId"),["tag"])});i.on(s,".name-list.author",function(){o.addUser("author",n(this).attr("data-authorId"))})},g=function(){h&&(i.off(),r.unbind(y))};return jq.extend({init:w,unbindListEvents:g,basePath:"sortBy=create_on&sortOrder=descending",addCommentHash:p},e.Base)}(jQuery);ASC.Projects.DiscussionDetails=function(n){function wt(n,i){var c,r,y,a;t=i;t.comments=ct(t.comments);bt();kt();dt();var w=location.hash.substring(1),b=w===ASC.Projects.Discussions.addCommentHash,e=u.MessageResource,v=[{title:e.OpenDiscussion,id:0,handler:lt},{title:e.ArchiveDiscussion,id:1,handler:lt}],k=t.status,d=v.find(function(n){return n.id===k});ASC.Projects.DescriptionTab.init().push(u.ProjectResource.Project,t.projectOwner.title,"Tasks.aspx?prjID="+t.projectOwner.id).push(e.AuthorTitle,t.createdBy.displayName).push(u.ProjectsFilterResource.ByCreateDate,t.displayDateTimeCrtdate).push(e.Description,t.text).setStatuses(v).setCurrentStatus(d).setStatusRight(t.canEdit).tmpl();c=function(){return t.status===0||t.commentsCount};r=ASC.Projects.Tab;h=new r(u.MessageResource.Comments,function(){return t.commentsCount},"commentsModule",st,"#comments",c,undefined,"#comment_");p=new r(u.MessageResource.DiscussionParticipants,function(){return f.length},"subscribeModule",ht,"#subscribers");l=new r(u.ProjectsCommonResource.DocsModuleTitle,function(){return t.files.length},"documentsModule",s,"#documents",function(){return t.canReadFiles&&(t.canEditFiles||t.files.length)});it=new r(u.ProjectsJSResource.OverviewModule,function(){return 0},"overViewModule",jq(".tab"),"#");y={icon:"messages",title:t.title};a=[];a=c()?[h,p,l,it]:[it,p,l];ASC.Projects.InfoContainer.init(y,gt,a);jq("#CommonListContainer").show();t.canEdit||o.hide();jq("#descriptionTab").show();b&&c()&&jq("#add_comment_btn").trigger("click");rt()}function ct(n){return n.forEach(function(n){n.commentList.length&&(n.commentList=ct(n.commentList))}),n.filter(function(n){return!(n.inactive&&n.commentList.length===0)})}function bt(){f=t.subscribers;f.forEach(function(n){n.descriptionFlag=!0});jq(".tab1").html(jq.tmpl("projects_discussionTab",vt(f))).show();ht=jq("#discussionParticipantsContainer");o=n("#manageParticipantsSelector");y=n("#discussionParticipantsTable");t.status===1&&o.hide();var r=f.map(function(n){return n.id});o.useradvancedSelector({showGroups:!0,itemsSelectedIds:r,itemsDisabledIds:[i.profile.id]}).on("additionalClickEvent",function(){jq(".project-title .menu-small").removeClass("active")}).on("showList",function(n,t){function s(n){return n.id===i.profile.id}for(var o,r=[],u=0;u<t.length;u++)r.push(t[u].id);f.filter(s).length&&r.push(i.profile.id);o={projectId:v,participants:r.join(),notify:!1};i.updatePrjDiscussion({},e,o,{before:b,success:at,error:w,after:rt})});o.useradvancedSelector("select",r);y.on("mouseenter",ft+"."+et,function(){jq(this).helper({BlockHelperID:"hintSubscribersPrivateProject",addLeft:45,addTop:12})});y.on("mouseleave",ft+"."+et,function(){jq("#hintSubscribersPrivateProject").hide()})}function kt(){function f(n){t.files.push(n);l.rewrite()}if(s.length&&window.Attachments){var n="marginBottom",u="message";r=Attachments;k=parseInt(t.project.projectFolder);t.canEditFiles||r.banOnEditing();ProjectDocumentsPopup.init(k,r.isAddedFile,r.appendToListAttachFiles);r.isLoaded=!1;r.init(u,function(){return t.id});r.setFolderId(k);r.loadFiles(t.files);t.files.length>0&&s.css(n,"18px");r.bind("addFile",function(r,e){e.attachFromPrjDocFlag||e.isNewFile?i.addPrjEntityFiles(null,t.id,u,[e.id],{success:function(){f(e)},error:w}):f(e);s.css(n,"18px")});r.bind("deleteFile",function(f,e){i.removePrjEntityFiles({},t.id,u,e,{success:function(){r.deleteFileFromLayout(e);t.files=t.files.filter(function(n){return n.id!=e});t.files.length===0&&s.css(n,"0");l.rewrite()},error:w})})}}function dt(){var r,n;CommentsManagerObj.isShowAddCommentBtn=t.status===0&&t.canCreateComment;CommentsManagerObj.total=t.comments.length;CommentsManagerObj.isEmpty=t.comments.length===0;CommentsManagerObj.moduleName="projects_Message";CommentsManagerObj.comments=jq.base64.encode(JSON.stringify(t.comments));CommentsManagerObj.objectID="common";CommentsManagerObj.onLoadComplete=function(){window.CKEDITOR_mentionsFeed=ASC.Projects.Master.Team};CommentsManagerObj.Init();CommentsManagerObj.objectID=t.id;jq("#hdnObjectID").val(t.id);t.commentsCount>0?(jq("#hideCommentsButton").show(),c.css(nt,"15px")):c.css(nt,"-6px");c.show();r=location.hash.substring(1);r===ASC.Projects.Discussions.addCommentHash&&CommentsManagerObj&&ckeditorConnector.load(CommentsManagerObj.AddNewComment);si(i.events.addPrjComment,function(){a?a=!1:(jq("#hideCommentsButton").show(),c.css(nt,"15px"),t.commentsCount++,h.rewrite())});n=yt+".comments";jq("#btnCancel").off(n).on(n,function(){a=!1;h.select()});jq("a[id^=edit_]").off(n).on(n,function(){a=!0})}function gt(){var n=[],r=ASC.Projects.ActionMenuItem,e,o;return t.canEdit&&(n.push(new r("da_edit",u.MessageResource.EditMessage,ni)),n.push(new r("da_delete",u.MessageResource.DeleteMessage,ii))),e=ot.getProjectById(t.projectId),e&&e.canCreateTask&&n.push(new r("da_createTask",u.MessageResource.CreateTaskOnDiscussion,ti)),o=f.some(function(n){return n.id===i.profile.id}),n.push(new r("da_follow",o?u.ProjectsCommonResource.UnSubscribeOnNewComment:u.ProjectsCommonResource.SubscribeOnNewComment,ri)),{menuItems:n}}function lt(){i.updatePrjDiscussionStatus({},e,{status:t.status===1?0:1},{before:b,success:ei,after:rt})}function ni(){location.href="Messages.aspx?prjID="+t.projectId+"&id="+t.id+"&action=edit"}function ti(){jq("body").trigger("click");b();i.addPrjTaskByMessage({},v,e,{success:function(n,t){window.onbeforeunload=null;location.href="Tasks.aspx?prjID="+v+"&id="+t.id}})}function ii(){jq(".project-title .menu-small").removeClass("active");ASC.Projects.Base.showCommonPopup("discussionRemoveWarning",function(){i.removePrjDiscussion({},e,{success:fi,error:ASC.Projects.DiscussionDetails.onDeleteDiscussionError})})}function ri(){i.subscribeToPrjDiscussion({},e,{success:at,error:w})}function w(){window.onbeforeunload=null;window.location.reload()}function at(n,t){f=t.subscribers;f.forEach(function(n){n.descriptionFlag=!0});y.html(jq.tmpl("projects_subscribedUsers",vt(f)));var r=f.some(function(n){return n.id===i.profile.id});r?o.useradvancedSelector("select",[g]):o.useradvancedSelector("disable",[g]);p.rewrite()}function vt(n){var f=[],s=[],c=d.length,r,h,i,e,u,o;if(t.projectOwner.isPrivate)for(r=0,h=n.length;r<h;r++){for(i=n[r],e=!1,u=0;u<c;u++)o=d[u],i.id===o.id&&o.canReadMessages&&(f.push(i),e=!0);e||(i.hidden=!0,s.push(i))}else f=n;return{newListParticipants:f,notSeePartisipant:s}}function fi(n,t){i.fckeRemoveCommentComplete(t.id.toString(),"discussion",function(){window.onbeforeunload=null;window.location.replace("Messages.aspx?prjID="+t.projectId)})}function ei(){location.reload()}function b(){tt.displayLoading()}function rt(){tt.hideLoading()}function oi(){jq(".project-info-container").hide();jq("#descriptionTab").hide();r.unbind();hi()}function si(n,t){ut.push(i.bind(n,t))}function hi(){while(ut.length){var n=ut.shift();i.unbind(n)}}var k,s,d,g,a=!1,nt="marginTop",ft=".items-display-list_i",et="gray",e,v,t,yt="click",r,i,tt,ot,f,c,st,o,ht,y,u=ASC.Projects.Resources,it,p,l,h,pt=function(){i=Teamlab;ot=ASC.Projects.Common;tt=LoadingBanner;e=jq.getURLParam("id");v=jq.getURLParam("prjID");g=i.profile.id;c=n("#commonComments");st=n("#commonCommentsContainer");$mainCommentsContainer=n("#mainCommentsContainer");s=n("#filesContainer");d=ASC.Projects.Master.Team;b();ASC.Projects.Base.clearTables();jq("#filterContainer").hide();i.getPrjDiscussion({},e,{success:wt,error:function(n,t){t[0]==="Item not found"&&ASC.Projects.Base.setElementNotFound()}})},ui=function(){t.commentsCount--;h.rewrite();t.commentsCount===0&&h.select()},ut=[];return{init:pt,onDeleteComment:ui,unbindListEvents:oi}}(jQuery);ASC.Projects.DiscussionAction=function(n){function fi(){return u.length&&u.attr("data-id").length||jq("[id$=discussionTitle]").val().length||rt.ckEditor.getData().length||yt.length}function ei(n,i){t=i;wt(null,t.subscribers);g=t.project.projectFolder;gt();bt()}function wt(n,t){t.forEach(function(n){n.descriptionFlag=!1});tt.useradvancedSelector("select",t.map(function(n){return n.id}));dt(t)}function bt(){var s={action:t?ct.ProjectsCommonResource.SaveChanges:ct.MessageResource.AddDiscussion,disable:t?"":"disable"},r;jq.tmpl("discussion_buttons",s).insertBefore(jq(".mainPageContent .layout-bottom-spacer"));b=n("#discussionPreviewButton");w=n("#discussionPreviewContainer");b.on("click",function(){if(!b.hasClass(c)){var t=this,n=i.profile;i.getPrjDiscussionPreview({takeThis:t},rt.ckEditor.getData(),{before:function(){ft(!0)},after:function(){ft(!1)},success:function(t,i){var r={title:v.val(),authorName:n.displayName,authorTitle:n.title,authorPageUrl:n.profileUrl,authorAvatarUrl:n.avatarBig,createOn:pi(new Date),content:i};w.find(".discussionContainer").remove();jq.tmpl("projects_discussionActionTemplate",r).prependTo(w);w.show()}})}});r=n("#discussionCancelButton");r.on("click",function(){r.hasClass(c)||(window.onbeforeunload=null,document.location.replace(location.pathname.substring(0,location.pathname.lastIndexOf("/")+1)))});k=n("#discussionActionButton");k.on("click",function(){var p,n,r;if(!k.hasClass(c)){it.removeClass(o);a.removeClass(o);ht.removeClass(o);var s=h?h:u.attr("data-id"),l=v.val().trim(),y=rt.ckEditor.getData(),i=!1;if(s||(it.addClass(o),i=!0),l===""&&(a.addClass(o),i=!0),y.trim().length||(ht.addClass(o),i=!0),i){p=jq("#pageHeader").offset().top;jq("body, html").animate({scrollTop:p},500);return}n={projectid:s,title:l,content:y};t&&(n.messageid=t.id);r=[];e.find(f).each(function(){r.push(jq(this).attr("guid"))});n.participants=r.join();vi();n.messageid?li(n):hi(n)}})}function oi(n){it.removeClass(o);e.find(f).remove();ot=n.isPrivate;jq("#errorAllParticipantsProject").hide();ti({},n.id);v.trigger("focus")}function si(){var n=ASC.Projects.Master.Projects.filter(function(n){return n.canCreateMessage});u.projectadvancedSelector({itemsChoose:n,onechosen:!0});u.on("showList",function(n,t){u.attr("data-id",t.id).text(t.title).attr("title",t.title);oi(t)})}function hi(n){i.addPrjDiscussion({},n.projectid,n,{success:ci,error:kt})}function ci(n,t){ni(t,!1)}function li(n){i.updatePrjDiscussion({},n.messageid,n,{success:ai,error:kt})}function ai(n,t){ni(t,!0)}function kt(){this.__errors[0]==="Access denied."&&(window.onbeforeunload=null,window.location.replace("Messages.aspx"));yi()}function vi(){k.addClass(c);u.prop(s,!0).addClass(s);v.prop(ut,!0).addClass(s);jq("iframe[id^=ctl00_ctl00]").contents().find("iframe").contents().find("#fckbodycontent").prop(ut,!0).addClass(s);ft(!0)}function yi(){k.removeClass(c);u.prop(s,!1).removeClass(s);v.prop(ut,!1).removeClass(s);jq("iframe[id^=ctl00_ctl00]").contents().find("iframe").contents().find("#fckbodycontent").prop(ut,!1).removeClass(s);ft(!1)}function dt(n){var r,u,t,f,i,e;if(yt=n,r=[],u=[],ot)for(t=0;t<n.length;t++){for(f=!1,i=0;i<y.length;i++)n[t].id===y[i].id&&y[i].canReadMessages&&(r.push(n[t]),f=!0);f||(n[t].hidden=!0,u.push(n[t]))}else r=n;e="projects_subscribedUser";jq.tmpl(e,r).appendTo(p);u.length&&jq.tmpl(e,u).addClass(at).appendTo(p)}function gt(){ProjectDocumentsPopup.init(g,r.isAddedFile,r.appendToListAttachFiles);r.isLoaded=!1;r.init(lt,function(){return t?t.id:0});r.setFolderId(g,!0);r.loadFiles(t?t.files:[]);r.bind("addFile",function(n,i){t&&t.files.find(function(n){return n.id===i.id})||l.push(i)});r.bind("deleteFile",function(n,i){l=l.filter(function(n){return n.id!==i});t&&t.files&&t.files.find(function(n){var t=n.id===i;return t&&nt.push(i),!t});r.deleteFileFromLayout(i)});var n="filesButton",i={id:n,title:ct.ProjectsCommonResource.DocsModuleTitle,state:0};jq.tmpl("projects_tabs",i).insertBefore(st);jq.switcherAction("#switcher"+n,st);jq("#CommonListContainer, #descriptionTab, #filesContainer").show()}function ni(n,t){var f=function(){window.onbeforeunload=null;window.location.replace("Messages.aspx?prjID="+n.projectId+"&id="+n.id)},u,r;nt.length||l.length?(u=function(n){return{success:n,error:n}},r=[],l.length&&r.push(function(t){i.addPrjEntityFiles(null,n.id,lt,l.map(function(n){return n.id}),u(t))}),nt.length&&r.push(function(t){i.removePrjEntityFiles(null,n.id,lt,nt,u(t))}),r.push(function(r){i.fckeEditCommentComplete({},{commentid:n.id.toString(),domain:"discussion",html:n.text,isedit:t},u(r))}),async.parallel(r,f)):i.fckeEditCommentComplete({},{commentid:n.id.toString(),domain:"discussion",html:n.text,isedit:!1},f)}function ti(n,t){vt?ii({},ASC.Projects.Master.Team):i.getPrjTeam(n,t,{before:d.displayLoading,success:ii,after:d.hideLoading})}function ii(n,t){var u,o,s,r,h;if(y=t,u=t?t.length:0,o=[],!(u<=0)){for(s=e.find(f).length?jq("#discussionParticipantsContainer "+f):[],r=0;r<u;r++)h=s.some(function(n){return n.attr("guid")===t[r].id}),h||(t[r].descriptionFlag=t[r].id===i.profile.id,o.push(t[r]));wt(null,o)}}function pi(n){for(var i="0",t=[i+n.getDate(),i+(n.getMonth()+1),i+n.getFullYear(),i+n.getHours(),i+n.getMinutes()],r=0;r<t.length;r++)t[r]=t[r].slice(-2);return t[0]+"."+t[1]+"."+t[2]+" "+t[3]+":"+t[4]}function ft(n){var t="#discussionActionPage";n?d.showLoaderBtn(t):d.hideLoaderBtn(t)}var h,et,vt=!1,g,ri,ot,t,y=[],yt=[],l=[],nt=[],st,e,tt,p,w,a,v,b,u,it,ht,k,rt,r,i,d,ct=ASC.Projects.Resources,pt,lt="message",f=".items-display-list_i",at="gray",o="requiredFieldError",c="disable",s="disabled",ut="readonly",ui=function(){var t,s;i=Teamlab;ri=i.profile.id;h=jq.getURLParam("prjID");et=jq.getURLParam("id");pt=jq.getURLParam("action");rt=ASC.Projects.Common;typeof Attachments!="undefined"&&(r=Attachments);d=LoadingBanner;st=n("#filesContainer");u=n("#discussionProjectSelect");it=n("#discussionProjectContainer");e=n("#discussionParticipantsContainer");tt=n("#manageParticipantsSelector");p=n("#discussionParticipants");a=n("#discussionTitleContainer");ht=n("#discussionTextContainer");v=a.find("input");et?i.getPrjDiscussion({},et,{success:ei,error:function(n,t){t[0]==="Item not found"&&ASC.Projects.Base.setElementNotFound()}}):(bt(),h&&(g=ASC.Projects.Master.projectFolder,gt()));jq("[id$=discussionTitle]").trigger("focus");t=[];e.find(f).each(function(){t.push(jq(this).attr("guid"))});tt.useradvancedSelector({showGroups:!0,itemsSelectedIds:t}).on("showList",function(n,t){e.find(f).remove();var i=t.map(function(n){var t=[];return n.groups.forEach(function(n){t.push(n.name)}),{id:n.id,displayName:n.title,department:t.join(),descriptionFlag:!1,profileUrl:n.profileUrl}});dt(i)});h?(vt=!0,pt!=="edit"?ti({},h):y=ASC.Projects.Master.Team,ot=ASC.Projects.Master.Projects.some(function(n){return n.id==h&&n.isPrivate}),jq(".mainPageContent").children(".loader-page").hide()):si();s=".reset-action";e.on("click",f+" "+s,function(){var n=jq(this).closest("li");n.remove();tt.useradvancedSelector("unselect",[n.attr("guid")])});jq("#hideDiscussionPreviewButton").on("click",function(){w.hide()});a.find("input").on("keyup",function(){jq(this).val().trim()!==""&&a.removeClass(o)});jq.switcherAction("#switcherParticipantsButton",e);p.on("mouseenter",f+"."+at,function(){jq(this).helper({BlockHelperID:"hintSubscribersPrivateProject",addLeft:45,addTop:12})});p.on("mouseleave",f+"."+at,function(){jq("#hintSubscribersPrivateProject").hide()});jq.confirmBeforeUnload(fi)},wi=function(){this.getData()===""?b.addClass(c):b.removeClass(c)};return{init:ui,showHidePreview:wi}}(jQuery);
ASC.Projects.TimeSpendActionPage=function(){function yt(n){var t=ot(n),r=t.task,u=t.note,f=t.date,i=jq.timeFormat(t.hours).split(":"),e=(t.person||t.createdBy).id,o=t.task.projectOwner.id;y.TimeTrakingEdit.showPopup(o,r,n,{hours:parseInt(i[0],10),minutes:parseInt(i[1],10),seconds:parseInt(i[2],10)},f,u,e)}function pt(n){r.removePrjTime({timeid:n},{timeids:[n]},{success:ni,error:ii})}function wt(n){t.showCommonPopup("trackingRemoveWarning",function(){l.displayLoading();r.removePrjTime({},{timeids:n},{success:function(){jq.unblockUI();c.displayInfoPanel(b.TimesRemoved);t.getData()}});jq.unblockUI()})}function d(n,t,i){l.displayLoading();r.changePaymentStatus({textStatus:n},{status:t,timeIds:i},it)}function bt(n,t){l.displayLoading();r.changePaymentStatus({},{status:t,timeIds:[n]},it)}function it(n,t){for(var r,u=ASC.Projects.StatusList.getById(t[0].paymentStatus).cssClass,i=0,f=t.length;i<f;i++)r=t[i],jq(".timeSpendRecord[timeid="+r.id+"] .changeStatusCombobox span:first").attr("class",u),et(r);st();l.hideLoading()}function rt(t){var o=t.length,r,u,i,f,e;if(o){for(r=0,u=0,i=0;i<o;i++)r+=t[i].hours,t[i].paymentStatus==2&&(u+=t[i].hours);f=jq.timeFormat(r).split(":");n.find(".total-count .hours").text(f[0]);n.find(".total-count .minutes").text(f[1]);e=jq.timeFormat(u).split(":");n.find(".billed-count .hours").text(e[0]);n.find(".billed-count .minutes").text(e[1]);n.addClass("float-none");n.css("visibility","visible")}}function g(){t.showOrHideData(i,v);i.length||n.css("visibility","hidden")}function ut(){f.Count=31;f.StartIndex=nt;k.status?(r.getTotalTimeByFilter({},{filter:f,success:ft}),n.find(".billed-count").hide()):(delete f.status,r.getTotalTimeByFilter({},{filter:f,success:ft}),f.status=2,r.getTotalTimeByFilter({},{filter:f,success:dt}))}function kt(r,u){if(f=r.__filter,Object.keys(f).length>4){n=jq.tmpl("projects_totalTimeText",{}).insertBefore(t.$groupeMenu);ut();var h=n.find("span").first(),c=o?s.TimeSpentForTask:s.TotalTimeNote;h.text(c)}i=u;nt+=u.length;r.mode!="next"&&e.find("tbody").html("");v=r.__total!=undefined?r.__total:0;i.length||n.css("visibility","hidden");t.showOrHideData(i,v)}function ft(t,r){if(r!=0&&i.length){var u=jq.timeFormat(r).split(":");n.find(".total-count .hours").text(u[0]);n.find(".total-count .minutes").text(u[1]);n.find(".billed-count .hours").text("0");n.find(".billed-count .minutes").text("00");n.css("visibility","visible")}else n.css("visibility","hidden")}function dt(t,i){var r=n.find(".billed-count"),u;i!=0?(u=jq.timeFormat(i).split(":"),r.find(".hours").text(u[0]),r.find(".minutes").text(u[1])):(r.find(".hours").text("0"),r.find(".minutes").text("00"))}function gt(n,t){c.displayInfoPanel(b.TimeUpdated);e.find(".timeSpendRecord[timeid="+t.id+"]").replaceWith(jq.tmpl("projects_timeTrackingTmpl",t));et(t);st()}function ni(n,t){for(var u,f=0,r=0;r<t.length;r++)u=jq("#timeSpendRecord"+t[r].id),f+=t[r].hours,u.animate({opacity:"hide"},500),v--,u.remove(),i=i.filter(function(n){return n.id!==t[r].id}),g();l.hideLoading();c.displayInfoPanel(b.TimeRemoved)}function ti(n,t){if(!t.length){g();return}rt(t);var r=t[0].task,u={icon:"tasks",title:r.title};ASC.Projects.InfoContainer.init(u);i=t;v=n.__total!=undefined?n.__total:0;g()}function et(n){for(var t=0,r=i.length;t<r;t++)if(i[t].id==n.id){i[t]=n;break}}function ot(n){return i.find(function(t){return t.id==n})}function p(n){return ot(jq(n).parents("tr.timeSpendRecord").attr("timeid"))}function st(){o?rt(i):ut({},f)}function ii(n){jq("div.entity-menu[timeid="+n.timeid+"]").hide()}function ri(){w&&(e.off(),t.unbindEvents(),ASC.Projects.GroupActionPanel.hide())}var o=!1,w=!1,t,a,ht,nt,v=0,n,e,y=ASC.Projects,u=y.Resources,b=u.ProjectsJSResource,h=u.ProjectsFilterResource,s=u.TimeTrackingResource,k=y.ProjectsAdvansedFilter,c=y.Common,r,l,ct,lt,at="click",i=[],f,tt,vt=function(){function ut(n){var t=n.attr("timeid");return{menuItems:[{id:"ta_edit",text:u.TaskResource.Edit,handler:yt.bind(null,t),classname:"edit"},{id:"ta_remove",text:u.ProjectsCommonResource.Delete,handler:pt.bind(null,t),classname:"delete"}]}}var nt,f,v;if(e=jq("#timeSpendsList"),r=Teamlab,a=jq.getURLParam("prjID"),ht=r.profile.id,o=jq.getURLParam("id")!=null,w===!1){w=!0;t=this;function g(n){return n.canCreateTimeSpend&&n.taskCountTotal>0}nt=[{id:"gaBilled",title:s.PaymentStatusBilled,handler:d.bind(null,"billed",2),checker:function(n){return n.canEditPaymentStatus}},{id:"gaNotBilled",title:s.PaymentStatusNotBilled,handler:d.bind(null,"not-billed",1),checker:function(n){return n.canEditPaymentStatus}},{id:"gaNotChargeable",title:s.PaymentStatusNotChargeable,handler:d.bind(null,"not-chargeable",0),checker:function(n){return n.canEditPaymentStatus}},{id:"gaDelete",title:u.ProjectsCommonResource.Delete,handler:wt,checker:function(n){return n.canEdit}}];t.showOrHideData=t.showOrHideData.bind(t,{$container:e.find("tbody"),tmplName:"projects_timeTrackingTmpl",baseEmptyScreen:{img:"time_tracking",header:u.TimeTrackingResource.NoTtimers,description:u.TimeTrackingResource.NoTimersNote,button:{title:u.TimeTrackingResource.StartTimer,onclick:function(){if(o){var n=jq.getURLParam("ID");c.showTimer(a,n)}else a!=null?c.showTimer(a):c.showTimer()},canCreate:function(){return a?g(tt):y.Master.Projects.some(g)}}},filterEmptyScreen:{header:u.TimeTrackingResource.NoTimersFilter,description:u.TimeTrackingResource.DescrEmptyListTimersFilter},groupMenu:{actions:nt,getItemByCheckbox:p,getLineByCondition:function(n){return i.filter(n).map(function(n){return e.find("[timeid="+n.id+"]")})},multiSelector:[{id:"gasBilled",title:h.PaymentStatusBilled,condition:function(n){return n.paymentStatus===2}},{id:"gasNotBilled",title:h.PaymentStatusNotBilled,condition:function(n){return n.paymentStatus===1}},{id:"gasNotChargeable",title:h.PaymentStatusNotChargeable,condition:function(n){return n.paymentStatus===0}}]}});t.$commonListContainer.find("#totalTimeText").length||(n=jq.tmpl("projects_totalTimeText",{}).insertBefore(t.$groupeMenu));t.getData=t.getData.bind(t,r.getPrjTime,kt)}l=LoadingBanner;f=ASC.Projects.Event;v=r.events;t.baseInit({moduleTitle:u.ProjectsCommonResource.TimeTracking},o?undefined:{pagination:"timeKeyForPagination"},{handler:bt,getItem:p,statuses:[{cssClass:"not-chargeable",text:h.PaymentStatusNotChargeable,id:0},{cssClass:"not-billed",text:h.PaymentStatusNotBilled,id:1},{cssClass:"billed",text:h.PaymentStatusBilled,id:2}]},ut,[f(v.updatePrjTime,gt),f(v.getPrjProject,function(n,t){tt=t;o&&r.getPrjTaskTime({},jq.getURLParam("id"),{success:ti})})],{getItem:function(n){return p(n).task},selector:".pm-ts-noteColumn a"});ct=jq("#emptyListTimers");lt=jq(".studio-action-panel");var it=jq.getURLParam("prjid"),rt=n.find("span").first(),b="";o?(r.getPrjProject({},it),b=s.TimeSpentForTask):(k.createAdvansedFilterForTimeTracking(t),e.addClass("forProject"),b=s.TotalTimeNote);rt.text(b);e.on(at,".pm-ts-personColumn span",function(n){var t=p(n.target);k.addUser("tasks_responsible",t.person!=null?t.person.id:t.createdBy.id,["noresponsible"])})};return jq.extend({init:vt,unbindListEvents:ri},ASC.Projects.Base)}(jQuery);
ASC.Projects.TimeTraking=function(n){function pt(n){return typeof n=="number"}function ii(){gt(!0);i.val("").removeClass(o);t.val("").removeClass(o);f.empty();ct=setInterval(ri,1e3)}function ri(){l++;l===60&&(l=0,c++,c===60&&(c=0,tt++));bt({h:tt,m:c,s:l})}function wt(){lt=kt();window.clearTimeout(ct)}function bt(n){w=n.h*3600+n.m*60+n.s;a.text(st(n.h));v.text(st(n.m));y.text(st(n.s))}function st(n){return n<10?"0"+n:n}function kt(){return{h:parseInt(a.text(),10),m:parseInt(v.text(),10),s:parseInt(y.text(),10)}}function ui(n,t){var i={h:n.h+t.h,m:n.m+t.m,s:n.s+t.s};return i.s>=60&&(i.m++,i.s-=60),i.m>=60&&(i.h++,i.m-=60),i}function dt(){wt();var n="00";a.text(n);v.text(n);y.text(n);b=!0;w=0;l=0;c=0;tt=0;s=null;et=!1;r.removeClass(ut).attr("title",r.attr("data-title-start"));ht()}function gt(n){i.prop(u,!0);t.prop(u,!0);n||(e.prop(u,!0),g.prop(u,!0))}function ht(){var n=kt();n.h===0&&n.m===0&&n.s===0&&(i.prop(u,!1),t.prop(u,!1));e.prop(u,!1);g.prop(u,!1)}function ft(){r.add(d).add(h).addClass(nt);gt()}function p(){r.add(d).add(h).removeClass(nt);ht()}function ni(){b?(r.addClass(ut).attr("title",r.attr("data-title-pause")),b=!1,s=new Date,ii()):(r.removeClass(ut).attr("title",r.attr("data-title-start")),b=!0,et=!0,s=null,wt())}function fi(){f.removeClass(o).addClass(rt);f.text(it.SuccessfullyAdded);g.val("");i.val("");t.val("");a.add(v).add(y).val("00");p()}function ei(t,i){var r=n("#teamList");r.find("option").remove();i=ASC.Projects.Common.excludeVisitors(i);i=i.filter(function(n){return!n.isRemovedFromTeam||yt.some(function(t){return t.responsibles.some(function(t){return t.id===n.id})})});i.forEach(function(n){r.append('<option value="'+n.id+'" id="optionUser_'+n.id+'">'+n.displayName+"<\/option>")});r.find("option").length===0?ft():p()}function oi(t,i){n("#selectUserTasks option").remove();yt=i;i.forEach(function(t){var i='<option value="'+t.id+'" id="optionUser_'+t.id+'">'+n.htmlEncodeLight(t.title)+"<\/option>";t.status===1&&at.append(i);t.status===2&&vt.append(i)});n("#selectUserTasks option").length===0?ft():p()}function si(){return w>0||i.val()!==""||t.val()!==""}var ct,w=0,tt=0,c=0,l=0,s=null,lt=null,et=!1,b=!0,t,i,e,f,h,it=ASC.Projects.Resources.ProjectsJSResource,k=Teamlab,a,v,y,r,d,g,at,vt,ot="click",nt="disable",o="error",rt="success",u="disabled",ut="stop",yt,ti=function(){function yt(n){if(n.which!=8&&n.which!=0&&(n.which<48||n.which>57)&&n.which!=13)return n.stopPropagation(),!1;n.which==13&&h.click()}var ct,st;if(t=n("#inputTimeMinutes"),i=n("#inputTimeHours"),e=n("#inputDate"),f=n("#timeTrakingErrorPanel"),ct=n("#timerTime"),r=ct.find(".start"),d=ct.find(".reset"),h=n("#addLog"),st=n("#firstViewStyle"),a=st.find(".h"),v=st.find(".m"),y=st.find(".s"),g=n("#textareaTimeDesc"),at=n("#openTasks"),vt=n("#closedTasks"),window.onfocus=function(){var n={},t;if(s&&w>0&&!b){var i=new Date,o=i.getHours(),r=i.getMinutes(),u=i.getSeconds(),h=s.getHours(),f=s.getMinutes(),e=s.getSeconds();n.h=o>h?o-h:0;r>=f?n.m=r-f:n.h>0?(n.m=r+60-f,n.h--,n.m===60&&(n.m=0,n.h++)):n.m=0;u>=e?n.s=u-e:n.m>0?(n.s=u+60-e,n.m--,n.s===60&&(n.s=0,n.m++)):n.s=0;t=et?ui(lt,n):n;tt=t.h;c=t.m;l=t.s;bt(t)}},h.length){window.onbeforeunload=function(){return r.hasClass(ut)?(ni(),""):si()?"":void 0};ht();i.trigger("focus");(n("#teamList option").length===0||n("#selectUserTasks option").length===0)&&ft();e.hasClass("hasDatepicker")||e.datepicker({selectDefaultDate:!1,onSelect:function(){e.trigger("blur")}});e.mask(ASC.Resources.Master.DatePatternJQ);e.datepicker("setDate",k.getDisplayDate(new Date));n("#timerTime #selectUserProjects").on("change",function(){var i=parseInt(n("#selectUserProjects option:selected").val()),r=function(n){return{success:n,error:n}},t=[];t.push(function(){k.getPrjTasks({},{success:oi,filter:{sortBy:"title",sortOrder:"ascending",projectId:i}})});t.push(function(){k.getProjectTeamExcluded(i,{before:function(){n("#teamList").prop(u,!0);n("#selectUserTasks").prop(u,!0)},success:ei,after:function(){n("#teamList").prop(u,!1);n("#selectUserTasks").prop(u,!1)}})});async.parallel(t)});r.on(ot,function(){r.hasClass(nt)||ni()});d.on(ot,function(){d.hasClass(nt)||dt()});h.on(ot,function(){var s;if(!h.hasClass(nt)){ft();var u,r,c,d=parseInt(n("#selectUserProjects option:selected").attr("value")),tt=n("#teamList option:selected").attr("value"),ut=parseInt(n("#selectUserTasks option:selected").attr("value")),et=g.val().trim(),l=!1,b;if(i.removeClass(o),t.removeClass(o),f.empty(),w>0)u=parseInt(a.text(),10),r=parseInt(v.text(),10),c=parseInt(y.text(),10),u>0||(u=0),r>0||(r=0),c>0||(c=0),b=u+r/60+c/3600,dt();else{if(i.val()===""&&t.val()===""){f.addClass(o).removeClass(rt);f.text(it.TimerNoData);p();return}if(u=parseInt(i.val(),10),r=parseInt(t.val(),10),(u<0||!pt(u))&&(i.addClass(o),l=!0),(r>59||r<0||!pt(r))&&(t.addClass(o),l=!0),l){f.addClass(o).removeClass(rt);f.text(it.InvalidTime).show();p();return}u>0||(u=0);r>0||(r=0);b=u+r/60}if(!n.isDateFormat(e.val().trim())){f.addClass(o).removeClass(rt);f.text(it.IncorrectDate).show();p();return}s={hours:b,note:et,personId:tt,projectId:d};s.date=e.datepicker("getDate");s.date.setHours(0);s.date.setMinutes(0);s.date=k.serializeTimestamp(s.date);k.addPrjTime({},ut,s,{success:fi})}});t.on("blur",function(){var n=t.val();n.length===1&&t.val("0"+n)});t.on("keypress",yt);i.on("keypress",yt)}};return{init:ti}}(jQuery);ASC.Projects.TimeTrakingEdit=function(n){function w(){if(!o){var t=p.clone();t.attr("id","timeTrakingPopup");n("#CommonListContainer").append(t);f=t;f.html(jq.tmpl("common_containerTmpl",{options:{PopupContainerCssClass:"popupContainerClass",OnCancelButtonClick:"PopupKeyUpActionProvider.CloseDialog();",IsPopup:!0},header:{data:{title:ASC.Projects.Resources.ProjectsCommonResource.TimeTracking},title:"projects_common_popup_header"},body:{data:{},title:"projects_editTimerPopup"}}))}}function k(u,f,e){var o=!1;return(parseInt(f,10)>59||parseInt(f,10)<0||!a(f))&&(r.text(h.InvalidTime),t.trigger("focus"),o=!0),(parseInt(u,10)<0||!a(u))&&(r.text(h.InvalidTime),i.trigger("focus"),o=!0),e!=null&&e.trim()!==""&&n.isDateFormat(e)||(r.text(h.IncorrectDate),n("#timeTrakingPopup #timeTrakingDate").trigger("focus"),o=!0),o&&(r.show(),setInterval(function(){n("#timeTrakingErrorPanel").hide()},5e3)),o}function a(n){return typeof n=="number"}function g(t,i){var r=i.reduce(function(n,t){return n+t.hours},0),u=n.timeFormat(r);n(".addLogPanel-infoPanelBody #TotalHoursCount").text(u)}function v(t){var i=n("select#teamList");t.forEach(function(t){c===t.id?i.append(n('<option value="'+t.id+'" selected="selected"><\/option>').html(t.displayName)):i.append(n('<option value="'+t.id+'"><\/option>').html(t.displayName))})}function nt(t){n("div.entity-menu[timeid="+t.timeid+"]").hide()}function tt(n,t){var i=t;i.length&&(i=ASC.Projects.Common.excludeVisitors(i),i=i.filter(function(n){return!n.isRemovedFromTeam||l.responsibles.some(function(t){return t.id===n.id})}),v(i))}var c,o,s={},y=!1,p=n("#commonPopupContainer"),f,e,t,i,r,h=ASC.Projects.Resources.ProjectsJSResource,u=Teamlab,l,b=function(){w();o||(o=!0);t=n("#inputTimeMinutes");i=n("#inputTimeHours");r=n("#timeTrakingErrorPanel");t.on("blur",function(){var n=t.val();n.length===1&&t.val("0"+n)});n("#timeTrakingPopup .middle-button-container a.button.blue.middle").on("click",function(){var r=parseInt(i.val(),10),f=parseInt(t.val(),10),e;k(r,f,n("#timeTrakingPopup #timeTrakingDate").val())||(f=parseInt(f,10),r=parseInt(r,10),r>0||(r=0),f>0||(f=0),e=n("#timeTrakingPopup").attr("timeid"),u.updatePrjTime({oldTime:s,timeid:e},e,{hours:r+f/60+s.seconds/3600,date:u.serializeTimestamp(n("#timeTrakingPopup #timeTrakingDate").datepicker("getDate")),note:n("#timeTrakingPopup #timeDescription").val(),personId:n("#teamList option:selected").attr("value")},{error:nt}),n.unblockUI())})},d=function(r,o,h,a,p,w,b){l=o;var k=o.id,d=o.title;e=n("#timeTrakingDate");c=b;f.attr("timeid",h);n("#timeDescription").val(w);n("#TimeLogTaskTitle").text(d);n("#TimeLogTaskTitle").attr("taskid",k);s=a;i.val(a.hours);a.minutes>9?t.val(a.minutes):t.val("0"+a.minutes);p=u.getDisplayDate(new Date(p));e.mask(ASC.Resources.Master.DatePatternJQ);e.datepicker({popupContainer:"#timeTrakingPopup",selectDefaultDate:!0});e.datepicker("setDate",p);n("select#teamList option").remove();u.getPrjTaskTime({},k,{success:g});y?(n("select#teamList option").remove(),ASC.Projects.Master.Team.length&&v(ASC.Projects.Common.excludeVisitors(ASC.Projects.Master.Team))):u.getProjectTeamExcluded(r,{success:tt});StudioBlockUIManager.blockUI(f,550);i.trigger("focus")};return{init:b,showPopup:d}}(jQuery);
ASC.Projects.GantChart=function(n){"use strict";function lr(n){return ASC.Projects.Master.customStatuses.find(n)}function ot(n){var r,t,i;if(!n)return n;if(r=[Number,String,Boolean],r.forEach(function(i){n instanceof i&&(t=i(n))}),typeof t=="undefined")if(Object.prototype.toString.call(n)==="[object Array]")t=[],n.forEach(function(n,i){t[i]=ot(n)});else if(typeof n=="object")if(n.nodeType&&typeof n.cloneNode=="function")t=n.cloneNode(!0);else if(n.prototype)t=n;else if(n instanceof Date)t=new Date(n);else{t={};for(i in n)t[i]=ot(n[i])}else t=n;return t}function st(n){n.preventDefault?n.preventDefault():n.returnValue&&(n.returnValue=!1);n.stopPropagation&&n.stopPropagation()}function ir(t){var i=null;return t||(t=n.event),t.target?i=t.target:t.srcElement&&(i=t.srcElement),i.nodeType==3&&(i=i.parentNode),i}function t(n){return n>>0}function ht(n){return n<0?~n++:n}function w(n,t,i,r,u,f,e){return i-e<=n&&r-e<=t&&u+e>=n&&f+e>=t}function ei(n,t,i){if(n&&n.length>t){if(i){var r=n.substr(0,t-2),u=Math.max(r.lastIndexOf(" "),r.lastIndexOf("."),r.lastIndexOf("!"),r.lastIndexOf("?"));if(u!==-1&&u>=t-15)return r.substr(0,u)+"..."}return n.substr(0,t-3)+"..."}return n}function hu(){this.root=null;this.nodes=[];this.data=null}function yf(n){this.delegate=n}function ar(n,t){this.ctx=n;this.overlay=t;this.zones=[]}function tc(){var t=null,i=function(t,i){var r=document.createElement("div"),u;return r.className=t,document.body.appendChild(r),u=n.getComputedStyle(r,null).getPropertyValue(i),document.body.removeChild(r),u},r=function(n,r){null==t&&(t=document.createElement("canvas"),t.width=450,t.height=100,document.body.appendChild(t));var u=i(r,"font-family"),f=i(r,"font-weight"),e=i(r,"font-size");return t.getContext("2d").font=f+" "+e+" "+u,t.getContext("2d").measureText(n+"W").width},u=function(){t&&(document.body.removeChild(t),t=null)};return{width:r,clear:u,readStyleValue:i}}function us(){this.textToCopy="";this.execElement=this.clipboardElement("")}function fs(n){this.init(n)}function es(n,t){this.delegate=t;this.ctx=n;this.position=0;this.thumb=0;this.step=0;this.mouse={x:0,y:0};this.offmouse={x:0,y:0};this.isLBMDown=!1;this.store=-1;this.offDown=0;this._value=0;this._focus=!0;this.afterNormalize=!1}function os(n,t){this.delegate=t;this.ctx=n;this.ctxWidth=this.ctx.canvas.width;this.ctxHeight=this.ctx.canvas.height;this.begin=0;this.end=0;this.anchor=0;this.mouse={x:0,y:0};this.offmouse={x:0,y:0};this.isLBMDown=!1}function ss(n){this.delegate=n;this.element=null;this.anchor={p:undefined,m:undefined,t:undefined};this.viewUpdate=!0;this.ref=null;this.baseText="";this.enable=!1}function vr(n){var i,u,t;if(0==n.length)return" (0/0)";for(i=0,u=0,t=n.length-1;t>=0;--t)n[t].filter||(r===n[t]._status&&++i,++u);return" ("+i+"/"+u+")"}function cu(t,i){if(null===t._responsibles)return"";var r=t._responsibles.length;return r?r>1?n.Gantt.Localize_strings.responsibles.format(r):n.Encoder.htmlDecode(t._responsibles[0].displayName):i}function lu(t,i){var r=t._responsibles;return r?n.Encoder.htmlDecode(r.displayName):i}function au(n,t){return r===n._status?ke:n.endFail&&t===-1?ef:n.endTime<=0&&(!n.endFail||t!==-1)?de:ef}function hs(n){return 1===n._status?ke:n.endTime<=0?de:ef}function pt(n,t){return t?Teamlab.getDisplayDate(n):n.toLocaleDateString()}function cs(n,t,i){this.base=t;this.el=undefined;this.elInner=undefined;this.model=i;this.timeline=n;this.controller=undefined;this.header=undefined;this.btnPrj=undefined;this.btnFlds=undefined;this.splitter=undefined;this.splitterLine=undefined;this.fontH1="normal 16px Semibold, sans-serif";this.textMeasurer=new tc}function pf(n,t,i){this.timeline=n;this.model=t;this.baseElement=i}function wf(n){this.init(n)}function bf(n,t){this.init(n,t)}function ls(n,t){this.delegate=n;this.marginY=kh;this.zoom=1;this.textDateLineHeight=15*this.zoom;this.hourInPixels=35*this.zoom;this.fontHeight=9*this.zoom;this.font=this.fontHeight+"pt "+b;this.ctx=n.ctx;this.ctxWidth=this.ctx.canvas.width;this.ctxHeight=this.ctx.canvas.height;this.scaleX=t;this.dayUTC=0;this.weekDay=0;this.monthCur=0;this.yearCur=0;this._fX=0;this.scaleType=0;this.divisionInOneHours=1;this.divisionInDays=7;this.lineSize=this.delegate.itemMargin;this.headTextPosY=this.lineSize*.55+1;this.baseTextPosY=this.lineSize*1.65}function e(n,t,i,r,u,f,e,o,s,h,c,l,a,v,y,p){this._id=parseInt(n);this._owner=parseInt(t)||-1;this._title=i;this.performer=r;this._responsibles=a||[];this._description=u;this._beginDate=f;this._endDate=e;this._status=o||tt;this._customTaskStatus=s;this.milestone=undefined!==h?parseInt(h):-1;this._priority=parseInt(c)||0;this._subtasks=l||0;this.links=v||[];this.beginFail=y||!1;this.endFail=!1;this.oneDay=!1;e&&(this.oneDay=f.getTime()===e.getTime());undefined==e?(this.beginTime=this.calculateTime(this._beginDate),this.endTime=this.beginTime,this.endFail=!0):(this.beginTime=Math.min(this.calculateTime(this._beginDate),this.calculateTime(this._endDate)),this.endTime=Math.max(this.calculateTime(this._beginDate),this.calculateTime(this._endDate)));this.duration=this.endTime-this.beginTime;this.duration=Math.max(this.duration,24);this.endTime=Math.max(this.endTime,this.beginTime+this.duration);this.createdBy=p;this._isMilestone=!1;this.titleWidth=-1;this.isInEditMode=!1;this.dropDownWidget=!1;this.stringsBlocks=null;this.descStrings=null;this.isTask=!0;this._title&&(this._title=this._title.replace(/^\s+/,"").replace(/\s+$/,""));this._description&&(this._description=this._description.replace(/^\s+/,"").replace(/\s+$/,""));this._update(!0)}function kf(n,t,i){return new e(i,n,"","","",new Date,new Date,tt,undefined,t)}function vu(n,t,i,r,u,f,e,o){this._id=parseInt(n);this._owner=parseInt(t);this._title=i;this._description=r;this._responsibles=u||null;this._beginDate=f;this._endDate=f;this._status=e||0;this._isKey=o||!1;this.beginTime=this.calculateTime(f);this.endTime=this.beginTime+0;this.durationMin=go;this.t=[];this.sortedByDates=!0;this.duration=0;this._isMilestone=!0;this.titleWidth=-1;this.titleWithDate="";this.dropDownWidget=!1;this.stringsBlocks=null;this.descStrings=null;this._title&&(this._title=this._title.replace(/^\s+/,"").replace(/\s+$/,""));this._description&&(this._description=this._description.replace(/^\s+/,"").replace(/\s+$/,""));this.updateTimes();this.collapse=!1;this.isInEditMode=!1}function as(n,t){return new vu(t,n,"","","",new Date,tt-1)}function df(n,t,i,r,u,f,e,o){this._id=parseInt(n);this._title=t;this._description=i?i:"";this._responsibles=r||null;this.creationDate=u?u:new Date;this.beginTime=null;this.endTime=null;this.duration=0;this.endFail=!1;this.descStrings=null;this.dropDownWidget=!1;this.m=[];this.t=[];this.titleWidth=-1;this.sort=!0;this._title&&(this._title=this._title.replace(/^\s+/,"").replace(/\s+$/,""));this._description&&(this._description=this._description.replace(/^\s+/,"").replace(/\s+$/,""));this.collapse=!1;this.fullCollapse=!1;this.milestoneSortPush=!1;this._indexer=f;this._isprivate=e;this._status=o||0;this.isLocked()&&(this.collapse=!0,this.fullCollapse=!0)}function vs(){this.p=[];this.m=[];this.t=[];this.pId=-1;this.mId=-1;this.tId=-1;this.sortedByDates=!0;this.minTime=null;this.maxTime=null;this.needBuildIndexer=!0}function gf(n){this.delegate=n;this.top=null;this.statusElement=null}function ne(n){this.delegate=n;this.onchangetimescale=null;this.onshowhint=null;this.disableScaleEvents=!1;this.position=null}function ys(n){this.delegate=n;this.strafeTo=!1;this.strafeOffset=0;this.scaleTo=!1;this.scaleOffset=0;this.scrollTo=!1;this.scrollOffset=0;this.scrollFrom=0;this.strafeForseTo=0;this.afterFunc=null;this.strafeCentering=!0;this.scaleToCenterX=undefined;this.boundView={from:0,to:0}}function ps(n){this.t=n;this.worldToScreen=1;this.tx=0;this.te=0;this.rel=0;this.infinityW=15;this.infinity=new Image;this.infinity.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAOCAYAAADwikbvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAOVJREFUeNpibO7oZSAXMDFQAKii2QCIdwDxdyD+AsTzkdSgy60FYmWQBAsQGwHxISDmRtJwBUpjkwsCYlsgNgfZ3A2V3AnEakCsBcSToK6ahUXuMBCLAnETyGYHqIkJQPwCyYYUIDbGIpcKxDeA2BFk+n+o4G8kjQJA3AaV80cz9BeU/g/SvBfKATlVEIhFgHgB1GmLgHgTlA2T64eq3wVydhEQHwPiKCCOBGJGqORLIK6AsidgkasH2XwViPWgUfARiN8C8VIgNoM6lxWI2bDIPWGBmvQQiENwpAVQWIQOruQJEGAAibMzZdYXHDkAAAAASUVORK5CYII="}function ws(n){this.t=n;this.bound={x:0,y:0,w:0,h:0};this.internalBound={x:0,y:0,w:0,h:0};this.direction=0;this.handler=null;this.link=null;this.linkDays=0;this.titleIndent={x:0,y:0};this.disableBound=!1}function bs(n){this.t=n;this.ref=null;this.bound={x:0,y:0,w:0,h:0};this.detailsLinkBound={x:0,y:0,w:0,h:0};this.href=null}function te(n,t){this.setZoom(1);this.initBase(n,t);this.initUI();this.initStyles();this.initWidgets();this.readMode=!1;this.sticking=!0;this.userEvents=!0;this.fullscreen=!1;this._modeStrafe=!1;this.centerScreen=0;this.visibleLeft=0;this.visibleUp=0;this.offsetX=0;this.needUpdate=!0;this.needUpdateContent=!0;this.needUpdateScrollContent=!1;this.repaint=!1;this.capProject=0;this.capTask=-1;this.capSide=0;this.capMilestone=-1;this.hitProject=-1;this.hitTask=-1;this.hitMilestone=-1;this.hitSide=0;this.clickPosCentreing=null;this.isLBMDown=!1;this.downMouse={x:0,y:0};this.moveMouse={x:0,y:0};this.hitLine={p:-1,m:-1,t:-1};this.anchorMouse={x:0,y:0};this.pressMouse={x:0,y:0,change:!1};this.enableTouch=!1;this.createMode=null;this.currentElementY=0;this.handlers=[];this.editMode=ni;this.hitLink=undefined;this.linkLineEdit=undefined;this.pushLink=undefined;this.dragBound={x:0,y:0,width:0,height:0,dx:0,dy:0,time:0,failEnd:!1};this.itemToDrop={t:-1,m:-1,p:-1};this.dragTo={t:-1,m:-1,p:-1};this.clearPopUp=!1;this.queryMoveLinks=null;this.leftBoxMousePressed=0;this.pressedButtonRight=!1;this.pressedButtonLeft=!1;this.printVersion=!1;this.projectsLines=[];this.projectsLinesY=[];this._needDrawFlashBackground=!1}var ie="1.0.1.205",o=.0001,re=350,tt=1,r=2,p=0,ds=1e3,wt=0,bt=1,it=2,kt=0,s=-10,c=10,y=5,gs=5,rr=15,k={bigClampPct:.75,smallClampPx:45},nh="#A4C7E5",ue="#CC3300",yu="#BDDA7F",th="#82A0B9",ih="#872200",fe="#9EB56C",u={from:"#4980C3",to:"#FFFFFF",dash:[4,2]},ee={color:"#24547E",dash:[4,2]},pu="#567da1",wu="#840701",bu="#729335",ku="#78A8D6",du="#9AC54A",gu="#B00600",rh="#A4C7E5",oe="#1d5381",uh="#621C05",fh="#496410",at="rgba(100,100,100,0.15)",se="#333333",eh="#FFFFFF",nf="#7e7e7e",yr="#bdda7f",tf="#cc3300",oh="#4fa7d1",he="rgba(100,100,100,0.1)",ce="#ffffff",le="#6699ff",ae="#cc3300",ve="#999999",rf="#4980C3",ye="#CC3300",sh="#24547E",hh="#97b8fa",ch="#EFF5FF",lh="#FFF5EB",oi="#CCCCCC",ct="#D9D9D9",ah="#666666",pr="#628BAE",d=8,ti=2,b="arial",rt=8,li=2,ai=50,uf=40,wr=.1,vh=!1,nt={backgroundColor:"#FAFAFA",dash:[1,2],dashColor:"#4FA7D1",fontColor:"#333333",fontSelColor:"#FFFFFF",backgroundSelTextColor:"#3399FF",fontHeight:9,caretColor:"#000000",placeHolderColor:"#999999",marginWidth:10,minBoxW:100},vi=250,pe="rgba(0, 0, 0, 0.25)",we="rgba(0, 0, 0, 0.5)",be="rgba(0, 0, 0, 0.1)",ii=50,ff=51,ke="#83888d",de="#cc3300",ef="#333333",h="#83888d",br="101",kr="102",dr="111",gr="112",ge="121",no="122",nu="123",to="124",io="125",ro="130",yi="140",pi="145",uo="150",fo="160",eo="UndoRedoUI",ur="200",fr="220",wi="240",si="260",sf="270",tu="280",er="300",iu="350",yh="360",oo="500",so="501",vt="502",hf="503",ho="504",ri=100,or=200,ui=300,hi=400,cf=500,ru=600,ci=700,bi=800,dt=900,uu=905,sr=910,fu=920,hr=950,eu=955,ki=960,ou=999,ph="#6699FF",co="#E2E2E2",lo="#CCCCCC",di=20,gi=28,wh=1.5,ao=3,vo=4,yo=8,po=12,cr=28,wo=40,bo=100,gt=270,bh=500,lf=340,nr=0,af=1,vf=2,fi=3,ut="#999999",ko="#FFC78F",kh=8,go=168,su=!0,tr=.15,ns=.2,l={width:63,height:15,offX:13,bkcolor:"#FFFFFF",color:"#999999"},dh=!0,f={backgroundColor:"#888d92",borderColor:"#fafafa",icoSize:16,elementsWidth2X:36,elementsWidth3X:56,elementsWidth4X:76,elementsWidth5X:96,elementsWidth6X:116,borderSz:7},a={w:36,h:24,trx:11,titleFx:18,titleFy:10},v={s:16,xw:14,yh:4},ts=10,ft=5,ni=100,lt=200,et=300,is=!0,gh=18,g=30,nc=8,yt={backgroundColor:"#ffffff",titleColor:"#999999",descriptionColor:"#666666",width:170,maxWidth:300},rs=new Image,i,ks;Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]});Date.prototype.dateFormat||(Date.prototype.dateFormat=function(){var t=this.getUTCDate(),i=this.getMonth()+1,n=this.getFullYear().toString();return i<10&&(i="0"+i.toString()),t<10&&(t="0"+t.toString()),n=n.slice(n.length-2,n.length),t+"."+i+"."+n});Date.prototype.dateFormatFullYear||(Date.prototype.dateFormatFullYear=function(){var n=this.getUTCDate(),t=this.getMonth()+1,i=this.getFullYear().toString();return t<10&&(t="0"+t.toString()),n<10&&(n="0"+n.toString()),n+"."+t+"."+i});hu.prototype={createNode:function(){var n=new hu;return this.nodes.push(n),n},walkElements:function(n,t){t(n,this.root,this.data);n=this.root;for(var i=0;i<this.nodes.length;++i)this.nodes[i].walkElements(n,t,this.nodes[i].data)}};yf.prototype={setFontFamily:function(n){n&&(b=n,this.delegate.updateDefaults())}};ar.prototype={drawDashedLineH:function(n,t,i,r,u,f){var v,s,y,h,c;n.beginPath();var l=r-t,a=0,e=t,o=i;for(n.moveTo(t,i),v=0,s=!0;!((l<0?e<=r:e>=r)&&(a<0?o<=u:o>=u));)y=f[v++%f.length],h=e+y,e=l<0?Math.max(r,h):Math.min(r,h),c=o,o=a<0?Math.max(u,c):Math.min(u,c),s?n.lineTo(e,o):n.moveTo(e,o),s=!s;n.closePath();n.stroke()},drawDashedLineV:function(n,t,i,r,u,f){var v,s,y,h,c;n.beginPath();var l=0,a=u-i,e=t,o=i;for(n.moveTo(t,i),v=0,s=!0;!((l<0?e<=r:e>=r)&&(a<0?o<=u:o>=u));)y=f[v++%f.length],h=e,e=l<0?Math.max(r,h):Math.min(r,h),c=o+y,o=a<0?Math.max(u,c):Math.min(u,c),s?n.lineTo(e,o):n.moveTo(e,o),s=!s;n.closePath();n.stroke()},drawLineH:function(n,t,i,r,u,f){this.ctx.strokeStyle=u;this.ctx.lineWidth=f;this.ctx.beginPath();this.ctx.moveTo(n,t);this.ctx.lineTo(i,r);this.ctx.closePath();this.ctx.stroke()},lineTo:function(n,t,i,r,u,f){t===r&&i!==u&&this.drawDashedLineV(n,t,Math.min(i,u),r,Math.max(i,u),f);t!==r&&i===u&&this.drawDashedLineH(n,Math.min(t,r),i,Math.max(t,r),u,f)},addZone:function(n,t,i,r,u){this.zones.push({x:n,y:t,width:i,height:r,margin:u})},addBoundZone:function(n,t){this.zones.push({x:n.x,y:n.y,width:n.w,height:n.h,margin:t})},clearZones:function(n){if(n)for(var t=this.zones.length-1;t>=0;--t)this.overlay.clearRect(this.zones[t].x-this.zones[t].margin,this.zones[t].y-this.zones[t].margin,this.zones[t].width+this.zones[t].margin*2,this.zones[t].height+this.zones[t].margin*2);this.zones=[]},drawStrokeRectangle:function(n,t,i,r,u,f){n.strokeStyle=f;n.lineWidth=1;n.beginPath();n.moveTo(t,i);n.lineTo(t+r,i);n.moveTo(t+r,i-.5);n.lineTo(t+r,i+u);n.lineTo(t,i+u);n.lineTo(t,i);n.stroke()},drawPencil:function(n,t,i,r){this.ctx.moveTo(n+20/120*i,t+100/120*r);this.ctx.lineTo(n+20/120*i,t+80/120*r);this.ctx.lineTo(n+79/120*i,t+20/120*r);this.ctx.lineTo(n+99/120*i,t+40/120*r);this.ctx.lineTo(n+40/120*i,t+100/120*r)},drawPlay:function(n,t,i,r){this.ctx.moveTo(n+.3*i,t+.17*r);this.ctx.lineTo(n+.71*i,t+.49*r);this.ctx.lineTo(n+.3*i,t+.82*r)},drawDelete:function(n,t,i,r){this.ctx.moveTo(n+.16*i,t+.3*r);this.ctx.lineTo(n+.3*i,t+.15*r);this.ctx.lineTo(n+.5*i,t+.35*r);this.ctx.lineTo(n+.7*i,t+.15*r);this.ctx.lineTo(n+.85*i,t+.3*r);this.ctx.lineTo(n+.65*i,t+.49*r);this.ctx.lineTo(n+.85*i,t+.68*r);this.ctx.lineTo(n+.7*i,t+.82*r);this.ctx.lineTo(n+.5*i,t+.63*r);this.ctx.lineTo(n+.3*i,t+.82*r);this.ctx.lineTo(n+.16*i,t+.68*r);this.ctx.lineTo(n+.36*i,t+.49*r)},drawFitSw:function(n,t,i,r){this.ctx.moveTo(n+20/120*i,t+20/120*r);this.ctx.lineTo(n+59/120*i,t+59/120*r);this.ctx.lineTo(n+20/120*i,t+99/120*r);this.ctx.lineTo(n+20/120*i,t+20/120*r);this.ctx.lineTo(n+61/120*i,t+59/120*r);this.ctx.lineTo(n+99/120*i,t+20/120*r);this.ctx.lineTo(n+99/120*i,t+99/120*r);this.ctx.lineTo(n+61/120*i,t+59/120*r)},drawAdd:function(n,t,i,r){this.ctx.moveTo(n+20/120*i,t+51/120*r);this.ctx.lineTo(n+50/120*i,t+51/120*r);this.ctx.lineTo(n+50/120*i,t+21/120*r);this.ctx.lineTo(n+68/120*i,t+21/120*r);this.ctx.lineTo(n+68/120*i,t+51/120*r);this.ctx.lineTo(n+98/120*i,t+51/120*r);this.ctx.lineTo(n+98/120*i,t+69/120*r);this.ctx.lineTo(n+68/120*i,t+69/120*r);this.ctx.lineTo(n+68/120*i,t+99/120*r);this.ctx.lineTo(n+50/120*i,t+99/120*r);this.ctx.lineTo(n+50/120*i,t+69/120*r);this.ctx.lineTo(n+20/120*i,t+69/120*r)},drawComplete:function(n,t,i,r){this.ctx.moveTo(n+16/120*i,t+54/120*r);this.ctx.lineTo(n+29/120*i,t+40/120*r);this.ctx.lineTo(n+54/120*i,t+65/120*r);this.ctx.lineTo(n+91/120*i,t+28/120*r);this.ctx.lineTo(n+105/120*i,t+42/120*r);this.ctx.lineTo(n+54/120*i,t+93/120*r)},drawIconLink:function(n,i,r,u){this.ctx.fillRect(t(n+r/8),t(i+u/8),t(r*6/16),t(u/4));this.ctx.fillRect(t(n+r/2),t(i+u*10/16),t(r*6/16),t(u/4));this.ctx.lineWidth=1;this.ctx.beginPath();this.ctx.moveTo(t(n+r/4)+.5,t(i+u*3/16)+.5);this.ctx.lineTo(t(n+r*11/16)+.5,t(i+u*3/16)+.5);this.ctx.moveTo(t(n+r*11/16)+.5,t(i+u*3/16));this.ctx.lineTo(t(n+r*11/16)+.5,t(i+u*7/16)+.5);this.ctx.lineTo(t(n+r*11/16)+.5,t(i+u*7/16)+.5);this.ctx.lineTo(t(n+r/4)+.5,t(i+u*7/16)+.5);this.ctx.lineTo(t(n+r/4)+.5,t(i+u*11/16)+.5);this.ctx.lineTo(t(n+r*9/16)+.5,t(i+u*11/16)+.5);this.ctx.stroke()},drawIcoResponsible:function(n,t,i,r){this.ctx.moveTo(n+.19*i,t+.82*r);this.ctx.lineTo(n+.19*i,t+.7*r);this.ctx.lineTo(n+.4*i,t+.6*r);this.ctx.lineTo(n+.4*i,t+.53*r);this.ctx.lineTo(n+.59*i,t+.53*r);this.ctx.lineTo(n+.59*i,t+.6*r);this.ctx.lineTo(n+.8*i,t+.7*r);this.ctx.lineTo(n+.8*i,t+.82*r);this.ctx.fill();this.ctx.closePath();var u=n+.5*i,f=t+.36*r,o=.42*i,e=.37*r;this.ctx.beginPath();this.ctx.moveTo(u,f-e/2);this.ctx.bezierCurveTo(u+o/2,f-e/2,u+o/2,f+e/2,u,f+e/2);this.ctx.bezierCurveTo(u-o/2,f+e/2,u-o/2,f-e/2,u,f-e/2);this.ctx.fill();this.ctx.closePath()},drawArrowRight:function(n,t,i,r){this.ctx.beginPath();this.ctx.moveTo(n+.4*i,t+.47*r);this.ctx.lineTo(n+.85*i,t+.18*r);this.ctx.lineTo(n+.85*i,t+.77*r);this.ctx.closePath();this.ctx.fill()},drawArrowLeft:function(n,t,i,r){this.ctx.beginPath();this.ctx.moveTo(n+.85*i,t+.47*r);this.ctx.lineTo(n+.4*i,t+.18*r);this.ctx.lineTo(n+.4*i,t+.77*r);this.ctx.closePath();this.ctx.fill()},drawArrowBottom:function(n,t,i,r){this.ctx.beginPath();this.ctx.moveTo(n+.77*i,t+.18*r);this.ctx.lineTo(n+.47*i,t+.69*r);this.ctx.lineTo(n+.18*i,t+.18*r);this.ctx.closePath();this.ctx.fill()},drawIcoKey:function(n,t,i,r){n.fillRect(t-8*r,i-14*r,2*r,8*r);n.fillRect(t-8*r,i-14*r,7*r,2*r);n.fillRect(t-3*r,i-14*r,2*r,8*r);n.fillRect(t-8*r,i-8*r,7*r,2*r);n.fillRect(t-17*r,i-14*r,3*r,5*r);n.fillRect(t-17*r,i-11*r,10*r,2*r);n.fillRect(t-13*r,i-14*r,2*r,5*r)},drawIcoArrowUp:function(n,t,i,r,u){n.fillStyle=u;n.beginPath();n.moveTo(t+r/3,i+r*10/18);n.lineTo(t+r/3,i+r*14/18);n.lineTo(t+r*10/18,i+r*14/18);n.lineTo(t+r*10/18,i+r*10/18);n.lineTo(t+r*13/18,i+r*10/18);n.lineTo(t+r*8/18,i+r*3.5/18);n.lineTo(t+r/6,i+r*10/18);n.closePath();n.fill()},drawIcoCross:function(n,t,i,r,u){n.moveTo(t+.16*r,i+.3*u);n.lineTo(t+.3*r,i+.15*u);n.lineTo(t+.5*r,i+.35*u);n.lineTo(t+.7*r,i+.15*u);n.lineTo(t+.85*r,i+.3*u);n.lineTo(t+.65*r,i+.49*u);n.lineTo(t+.85*r,i+.68*u);n.lineTo(t+.7*r,i+.82*u);n.lineTo(t+.5*r,i+.63*u);n.lineTo(t+.3*r,i+.82*u);n.lineTo(t+.16*r,i+.68*u);n.lineTo(t+.36*r,i+.49*u)},roundRect:function(n,t,i,r,u,f){n.beginPath();n.moveTo(t+f,i);n.lineTo(t+r-f,i);n.quadraticCurveTo(t+r,i,t+r,i+f);n.lineTo(t+r,i+u-f);n.quadraticCurveTo(t+r,i+u,t+r-f,i+u);n.lineTo(t+f,i+u);n.quadraticCurveTo(t,i+u,t,i+u-f);n.lineTo(t,i+f);n.quadraticCurveTo(t,i,t+f,i);n.closePath()}};us.prototype={copyText:function(n){this.textToCopy=n;this.textToCopy.length&&this.copyToClipboard()},oncopy:function(n){n.clipboardData&&(n.preventDefault(),n.clipboardData.setData("text/plain",this.textToCopy))},clear:function(){this.textToCopy="";this.execElement&&document.body.removeChild(this.execElement)},clipboardElement:function(){var n=document.createElement("div");return n&&(n.setAttribute("contentEditable",!0),n.style.position="absolute",vh?(n.style.backgroundColor="white",n.style.left="100px",n.style.top="100px",n.style.width="1000px",n.style.height="100px",n.style.overflow="hidden",n.style.zIndex=1e3):(n.style.left="-10000px",n.style.top="-10000px",n.style.width="1000px",n.style.height="100px",n.style.overflow="hidden",n.style.zIndex=-1e3),n.setAttribute("contentEditable",!0),document.body.appendChild(n)),n},selectContent:function(t){var r=document.createRange(),i;r.selectNodeContents(t);i=n.getSelection();i.removeAllRanges();i.addRange(r)},copyToClipboard:function(){n.clipboardData?n.clipboardData.setData("Text",this.textToCopy):(this.execElement||(this.execElement=this.clipboardElement(this.textToCopy)),this.execElement.textContent=this.textToCopy,this.selectContent(this.execElement),document.execCommand("copy",!1,null),n.netscape&&document.body.removeChild(this.execElement))}};fs.prototype={init:function(n){this.parent=n;this.ctx=this.parent.overlayctx;this.font=nt.fontHeight+"pt "+b;this.text="";this.select={from:0,to:0};this._clipboard=new us;this.placeHolder="";this.bound={x:0,y:0,w:0,h:0};this.screenBound={x:0,y:0,w:0,h:0};this.screenAddX=0;this.clampBound={left:0,right:0};this.carriage=0;this.carriageFrame=0;this.carriageWidth=0;this.clickCarriage=0;this.carriageLeft=0;this.carriageLeftBuild=!0;this.doubleMouseClickTime=null;this.mouseSelectDirection=0;this.mouseSelectStartPos=0;this.p=-1;this.m=-1;this.t=-1;this.enable=!1;this.status=!1;this.boundUpdate=!1;this.saveText="";this.taskRef=null;this.milestoneRef=null;this.milestoneRefForUpdate=null;this.checkUp=!1;this.createMode=undefined;this.selectMode=!1;this.undoStrings=[]},updateDefaults:function(){this.font=nt.fontHeight+"pt "+b},setEnable:function(){this.enable=!0;this.carriageFrame=0;this.carriageWidth=0;this.carriage=this.text.length;this.carriageLeft=0;this.carriageLeftBuild=!0;this.mouseSelectDirection=0;this.mouseSelectStartPos=0;this.screenAddX=0},setFont:function(n){this.parent.overlayctx.font=n?this.font:this.parent.titlesFont},setCarriage:function(n){this.carriageFrame=41;this.carriage=n;this.carriage=Math.max(0,this.carriage);this.carriage=Math.min(this.text.length,this.carriage);this.select={from:this.carriage,to:this.carriage};this.carriageLeftBuild=!0},isEnable:function(){return this.enable},draw:function(){if(this.enable){if(this.screenBound.w<=0||this.screenBound.h<=0)return;if(this.clampBound.left>this.clampBound.right)return;this.drawBackground();this.setFont(!0);var n=this.calculateSelectSpace(this.ctx,this.text,this.select.from,this.select.to);this.ctx.save();this.ctx.beginPath();this.ctx.rect(Math.floor(this.clampBound.left),Math.floor(this.bound.y-2),this.clampBound.right-this.clampBound.left-this.screenAddX+2,this.bound.h+4);this.ctx.clip();0===this.text.length?(this.ctx.fillStyle=nt.placeHolderColor,this.ctx.fillText(this.placeHolder,this.bound.x-this.carriageLeft,this.bound.y+this.bound.h*.75)):(this.ctx.fillStyle=nt.fontColor,this.ctx.fillText(this.text,this.bound.x-this.carriageLeft,this.bound.y+this.bound.h*.75));n||this.drawCarriage();this.ctx.restore();this.drawSelectedText(n);this.setFont(!1)}},drawBackground:function(){var n=this.ctx;n.fillStyle=nt.backgroundColor;n.fillRect(this.clampBound.left,this.bound.y,this.clampBound.right-this.clampBound.left+2,this.bound.h);n.fillStyle=nt.dashColor;n.lineWidth=1;this.parent.painter.lineTo(n,Math.floor(this.clampBound.left)+.5,Math.floor(this.bound.y)+.5,Math.floor(this.clampBound.right+2)+.5,Math.floor(this.bound.y)+.5,nt.dash);this.parent.painter.lineTo(n,Math.floor(this.clampBound.left)+.5,Math.floor(this.bound.y+this.bound.h)+.5,Math.floor(this.clampBound.right+2)+.5,Math.floor(this.bound.y+this.bound.h)+.5,nt.dash);this.parent.painter.lineTo(n,Math.floor(this.clampBound.left)+.5,Math.floor(this.bound.y)+.5,Math.floor(this.clampBound.left)+.5,Math.floor(this.bound.y+this.bound.h)+.5,nt.dash);this.parent.painter.lineTo(n,Math.floor(this.clampBound.right+2)+.5,Math.floor(this.bound.y)+.5,Math.floor(this.clampBound.right+2)+.5,Math.floor(this.bound.y+this.bound.h)+.5,nt.dash)},drawCarriage:function(){if(this.carriageFrame++,this.carriageFrame>80&&(this.carriageFrame=0),!(this.carriageFrame<40)){var n=Math.floor(this.bound.x+this.carriageWidth-this.carriageLeft);n<=this.parent.visibleLeft||(this.ctx.fillStyle=nt.caretColor,this.ctx.fillRect(n,Math.floor(this.bound.y+2),2,Math.floor(this.bound.h-3)))}},drawSelectedText:function(n){var t,i,u,r;if(n){if(t=Math.floor(this.bound.x-this.carriageLeft+n.from)-this.screenAddX,i=t+Math.floor(n.to-n.from)+this.screenAddX,t<this.screenBound.x&&(t=this.screenBound.x),i>this.screenBound.x+this.screenBound.w&&(i=this.screenBound.x+this.screenBound.w),u=this.parent.visibleLeft,t<u&&(t=u),r=i-t,this.parent.visibleLeft>=i||t>=this.parent.ctxWidth-rt*3||r<0)return;this.ctx.fillStyle=nt.backgroundSelTextColor;this.ctx.fillRect(t,Math.floor(this.bound.y+2),r,this.bound.h-3);this.ctx.save();this.ctx.beginPath();this.ctx.rect(t,Math.floor(this.bound.y-2),r,this.bound.h+4);this.ctx.clip();this.ctx.fillStyle=nt.fontSelColor;this.ctx.fillText(this.text,this.bound.x-this.carriageLeft,this.bound.y+this.bound.h*.75);this.ctx.restore()}},calcMetrics:function(){if(this.enable){this.setFont(!0);this.textWidth=this.ctx.measureText(this.text).width;this.carriageWidth=this.ctx.measureText(this.text.substring(0,this.carriage)).width;this.bound.w=Math.max(this.textWidth,this.bound.w);this.screenBound.w=this.bound.w;this.milestoneRef&&(this.bound.x-=this.bound.w+2,this.screenBound.x=this.bound.x);var n=this.parent.visibleLeft;this.screenBound.w=Math.min(this.parent.ctxWidth-this.screenBound.x-rt*3,this.screenBound.w);this.screenAddX=0;this.carriageLeftBuild&&(this.screenBound.x+this.screenBound.w>this.bound.x+this.textWidth-this.carriageLeft&&(this.carriageLeft-=this.screenBound.x+this.screenBound.w-(this.bound.x+this.textWidth-this.carriageLeft)),this.calcCarriageLeft(),this.carriageLeftBuild=!1);this.textWidth<=this.screenBound.w&&(this.carriageLeft=0);this.clampBound.left=this.bound.x-this.screenAddX;this.clampBound.right=this.clampBound.left+this.screenBound.w+this.screenAddX;this.clampBound.left<this.screenBound.x&&(this.clampBound.left=this.screenBound.x);this.clampBound.right>this.screenBound.x+this.screenBound.w&&(this.clampBound.right=this.screenBound.x+this.screenBound.w);this.clampBound.left<n&&(this.clampBound.left=n);this.setFont(!1)}},calcCarriageLeft:function(){this.enable&&(this.setFont(!0),this.carriageWidth=this.ctx.measureText(this.text.substring(0,this.carriage)).width,this.screenBound.w+this.carriageLeft<this.carriageWidth?this.carriageLeft=this.carriageWidth-this.screenBound.w:this.carriageLeft>this.carriageWidth&&(this.carriageLeft=this.carriageWidth),this.setFont(!1))},centeringViewPosition:function(){var n=this.parent,i,r;this.taskRef&&(n.animator.moveCenterToX(this.taskRef.beginTime),i=n.getElementPosVertical(this.p,this.m,this.t)-n.ctxHeight*.5,r=n.rightScroll.maxValue(),n.fullscreen||(r=t(n.rightScroll.maxValue()/n.itemMargin)*n.itemMargin,i=t(i/n.itemMargin)*n.itemMargin),i=Math.min(Math.max(0,i),r)+(n.itemMargin*2-o)*n.fullscreen,i=Math.max(i,o),n.animator.moveToY(i))},reset:function(n){this.bound={x:0,y:0,w:0,h:0};this.text="";this.saveText="";this.placeHolder="";this.enable=!1;this.createMode=undefined;this.taskRef&&(this.taskRef.isInEditMode=!1,n||this.parent.leftPanelController().clearFocus(!0));this.milestoneRef&&(this.milestoneRef.isInEditMode=!1,n||this.parent.leftPanelController().clearFocus(!0));this.taskRef=null;this.milestoneRef=null;this.milestoneRefForUpdate=null;this.parent.overlay.style.cursor="";this.parent.menuMileStone.reset();this.parent.menuTask.reset();this.parent.rightScroll.save();this.parent.update();this.parent.hitProject=-1;this.parent.hitTask=-1;this.parent.hitMilestone=-1;this.parent.needUpdateContent=!0;this.parent.needUpdate=!0;this.parent.hitLink=undefined;this.parent.linkLineEdit=undefined;this.parent.editMode=ni;this.parent.capTask=-1;this.select={from:0,to:0};this.selectMode=!1},check:function(n,t){return this.bound.x>n||n>this.bound.x+this.bound.w||this.bound.y>t||t>this.bound.y+this.bound.h},setBound:function(n,t,i,r){if(this.enable){var u=this.bound.w,f=this.bound.x;this.bound={x:n,y:t,w:Math.max(nt.minBoxW,i),h:r};this.screenBound={x:n,y:t,w:Math.max(nt.minBoxW,i),h:r};this.boundUpdate=!0;this.calcMetrics();(this.bound.w!==u||this.bound.x!==f)&&(this.carriageLeftBuild=!0)}},inBound:function(n,t){return this.milestoneRef&&this.createMode&&Math.abs(n-(this.bound.x+this.bound.w))<ft&&t-(this.bound.y+this.bound.h)<this.parent.itemMargin?!0:this.bound.x-ft<=n&&n<=this.bound.x+this.bound.w+ft&&this.bound.y<=t&&t<=this.bound.y+this.bound.h},cancel:function(n,t){(this.taskRef||this.milestoneRef)&&(this.saveText.length?n&&this.parent._undoManager.flushPop(0):(this._removeElement(),this.parent._undoManager.flushPop(0)),this.reset(t))},_removeElement:function(){-1===this.m?this.parent.storage.p[this.p].t.splice(this.t,1):(this.milestoneRef?this.parent.storage.p[this.p].m.splice(this.m,1):this.parent.storage.p[this.p].m[this.m].t.splice(this.t,1),this.milestoneRefForUpdate&&this.milestoneRefForUpdate.updateTimes())},complete:function(){if(this.text=this.text.replace(/^\s+/,"").replace(/\s+$/,""),this.text.length>vi&&(this.text=this.text.substring(0,vi)),0===this.text.length&&this.placeHolder.length>0&&(this.text=this.placeHolder),this.addMode&&!this.text.length)return this._removeElement(),this.reset(),this.parent._undoManager.flushPop(0),!0;this.saveText.length&&!this.text.length&&(this.text=this.saveText);var n=null;return this.taskRef&&(n=this.taskRef,this.taskRef._title=this.text,this.taskRef.isInEditMode=!1,this.taskRef.update(),this.taskRef=null),this.milestoneRef&&(n=this.milestoneRef,this.milestoneRef.isInEditMode=!1,this.milestoneRef._title=this.text,this.milestoneRef.update()),this.text.length?this.saveText!==this.text||this.addMode?this.parent._undoManager.updateOperation(0,n):this.parent._undoManager.flushPop(0):(this._removeElement(),this.parent._undoManager.flushPop(0)),this.reset(),!1},onkeypress:function(t){var i,r;t=n.event||t;i=t.keyCode?t.keyCode:t.which?t.which:t.charCode;this.counter=0;switch(i){case 13:return this.complete();case 46:if(0===t.charCode)return!0;break;case 35:case 36:case 37:case 8:case 27:case 38:case 40:case 33:if(t.shiftKey)break;else return!1;case 34:return!1}return t.ctrlKey||t.metaKey?!0:(this.select.from!==this.select.to&&(this.text=this.text.substring(0,this.select.from)+this.text.substring(this.select.to,this.text.length),this.setCarriage(this.select.from)),r=String.fromCharCode(i),this.carriage!==this.text.length?(this.text=this.text.substring(0,this.carriage)+r+this.text.substring(this.carriage,this.text.length),this.setCarriage(this.carriage+1)):(this.text+=r,this.setCarriage(this.text.length)),!0)},onkeydown:function(t){var u,i,r,o,s,f,e;t=n.event||t;u=!1;o=t.keyCode?t.keyCode:t.which?t.which:t.charCode;this.counter=0;switch(o){case 35:t.shiftKey?(r=this.carriage,i={from:this.select.from,to:this.select.to},this.setCarriage(this.text.length),this.select=i.from!==i.to?1===this.mouseSelectDirection?{from:i.from,to:this.text.length}:{from:i.to,to:this.text.length}:{from:r,to:this.text.length}):(this.setCarriage(this.text.length),this.mouseSelectDirection=0,this.mouseSelectStartPos=this.carriage,this.select={from:this.carriage,to:this.carriage});u=!0;break;case 36:t.shiftKey?(r=this.carriage,i={from:this.select.from,to:this.select.to},this.setCarriage(0),this.select=i.from!==i.to?1===this.mouseSelectDirection?{from:0,to:i.from}:{from:0,to:i.to}:{from:0,to:r}):(this.setCarriage(0),this.mouseSelectDirection=0,this.mouseSelectStartPos=this.carriage,this.select={from:this.carriage,to:this.carriage});u=!0;break;case 37:t.ctrlKey||t.metaKey?this.setCarriage(this.findWord(this.text,this.carriage)):t.shiftKey?(-1===this.mouseSelectDirection?this.select.to>this.mouseSelectStartPos?(this.select.to--,this.select.to=Math.min(this.select.to,this.text.length),r=this.select.to):(this.select.from--,this.select.from=Math.max(this.select.from,0),r=this.select.from):this.select.to<=this.mouseSelectStartPos?(this.select.from--,this.select.from=Math.max(this.select.from,0),r=this.select.from):(this.select.to--,this.select.to=Math.min(this.select.to,this.text.length),r=this.select.to),i={from:this.select.from,to:this.select.to},this.setCarriage(r),this.select={from:i.from,to:i.to}):(this.select.from!==this.select.to?this.setCarriage(this.select.from):this.setCarriage(this.carriage-1),this.mouseSelectDirection=0,this.mouseSelectStartPos=this.carriage,this.select={from:this.carriage,to:this.carriage});u=!0;break;case 39:t.ctrlKey||t.metaKey?this.select.from!==this.select.to?this.setCarriage(this.findWord(this.text,this.select.to,!0)):this.setCarriage(this.findWord(this.text,this.carriage,!0)):t.shiftKey?(-1===this.mouseSelectDirection?this.select.from<this.mouseSelectStartPos?(this.select.from++,this.select.from=Math.min(this.select.from,this.mouseSelectStartPos),r=this.select.from):(this.select.to++,this.select.to=Math.min(this.select.to,this.text.length),r=this.select.to):this.select.from>=this.mouseSelectStartPos?(this.select.to++,this.select.to=Math.min(this.select.to,this.text.length),r=this.select.to):(this.select.from++,this.select.from=Math.max(this.select.from,0),r=this.select.from),i={from:this.select.from,to:this.select.to},this.setCarriage(r),this.select={from:i.from,to:i.to}):(this.select.from!==this.select.to?this.setCarriage(this.select.to):this.setCarriage(this.carriage+1),this.mouseSelectDirection=0,this.mouseSelectStartPos=this.carriage,this.select={from:this.carriage,to:this.carriage});u=!0;break;case 8:this.text.length&&(this.select.from!==this.select.to?(this.text=this.text.substring(0,this.select.from)+this.text.substring(this.select.to,this.text.length),this.setCarriage(this.select.from)):(this.text=this.text.substring(0,this.carriage-1)+this.text.substring(this.carriage,this.text.length),this.setCarriage(this.carriage-1)),this.mouseSelectDirection=0,this.mouseSelectStartPos=this.carriage,this.select={from:this.carriage,to:this.carriage});u=!0;break;case 46:this.text.length&&(this.select.from!==this.select.to?(this.text=this.text.substring(0,this.select.from)+this.text.substring(this.select.to,this.text.length),this.setCarriage(this.select.from)):(this.text=this.text.substring(0,this.carriage)+this.text.substring(this.carriage+1,this.text.length),this.setCarriage(this.carriage)),this.mouseSelectDirection=0,this.mouseSelectStartPos=this.carriage,this.select={from:this.carriage,to:this.carriage});u=!0;break;case 27:this.saveText.length||this._removeElement();this.parent._undoManager.flushPop(0);this.reset();u=!0;break;case 65:(t.ctrlKey||t.metaKey)&&(this.setCarriage(this.text.length),this.select={from:0,to:this.text.length},this.mouseSelectDirection=1,this.mouseSelectStartPos=0,u=!0);break;case 86:if((t.ctrlKey||t.metaKey)&&n.clipboardData&&(f=n.clipboardData.getData("Text"),f&&(f=this.formatBuffer(f),f.length)))return this.select.from!==this.select.to&&(this.text=this.text.substring(0,this.select.from)+this.text.substring(this.select.to,this.text.length),this.carriage=this.select.from),s=this.text.length,this.text=this.text.substring(0,this.carriage)+f+this.text.substring(this.carriage,s),this.setCarriage(this.carriage+f.length),this.parent.needUpdate=!0,!0;break;case 67:if((t.ctrlKey||t.metaKey)&&this.select.from!==this.select.to&&this._clipboard&&(e=this.text.substring(this.select.from,this.select.to),e.length))return this._clipboard.copyText(e),!0;break;case 88:if(t.ctrlKey||t.metaKey)return this.text.length&&this.select.from!==this.select.to&&(this.text=this.text.substring(0,this.select.from)+this.text.substring(this.select.to,this.text.length),this.setCarriage(this.select.from),this.parent.needUpdate=!0),st(t),!1}return u&&st(t),this.parent.needUpdate=!0,!1},onmousedown:function(n){if(null!==this.taskRef||null!==this.milestoneRef)if(this.inBound(n.x,n.y)){if(!this.parent.pressedButtonRight){var t=(new Date).getTime();if(this.doubleMouseClickTime){if(t-=this.doubleMouseClickTime.getTime(),this.doubleMouseClickTime=null,t<re){this.setCarriage(this.text.length);this.select={from:0,to:this.text.length};this.mouseSelectDirection=1;this.mouseSelectStartPos=0;this.clickTime=new Date;return}}else if(this.clickTime&&t-this.clickTime.getTime()<re){this.ondblclick(n);this.clickTime=new Date;return}this.updateSelection(n.x+this.carriageLeft);this.mouseSelectStartPos=this.carriage;this.checkUp=!0;this.selectMode=!0;this.clickCarriage=this.carriage;this.parent.needUpdate=!0}}else{if(this.saveText.length)this.saveText===this.text&&undefined==this.addMode?this.parent._undoManager.flushPop(0):this.addMode&&!this.text.length?(this.parent._undoManager.flushPop(0),this._removeElement(),this.reset()):this.taskRef&&this.parent._undoManager.updateOperation(0,this.taskRef);else{if(0!==this.text.length)return this.complete();this._removeElement();this.parent._undoManager.flushPop(0)}this.reset();this.checkUp=!0}},onmouseup:function(n){var i,t,r;this.selectMode&&(this.setFont(!0),i=this.bound.x,this.textWidth>=this.bound.w&&(i=this.bound.x+this.bound.w-this.textWidth),t=this.symbolIndexAt(this.ctx,this.text,n.x-i+this.carriageLeft),undefined!==t&&(r=this.clickCarriage,this.setCarriage(t),this.select={from:Math.min(r,t),to:Math.max(r,t)},this.mouseSelectDirection=0,this.mouseSelectStartPos>this.carriage&&(this.mouseSelectDirection=-1),this.mouseSelectStartPos<this.carriage&&(this.mouseSelectDirection=1)));this.checkUp=!1;this.selectMode=!1},onmousemove:function(n){var r,u,t,i;return null===this.taskRef&&null===this.milestoneRef?!1:(this.selectMode&&(this.setFont(!0),r=this.bound.x,this.textWidth>=this.bound.w&&(r=this.bound.x+this.bound.w-this.textWidth),u={from:this.select.from,to:this.select.to},t=this.symbolIndexAt(this.ctx,this.text,n.x-r+this.carriageLeft),undefined!==t&&(i=this.clickCarriage,this.setCarriage(Math.max(i,t)),this.select={from:Math.min(i,t),to:Math.max(i,t)},this.select.from<u.from?(this.setCarriage(this.select.from),this.select={from:Math.min(i,t),to:Math.max(i,t)}):this.select.to>u.to?(this.setCarriage(this.select.to),this.select={from:Math.min(i,t),to:Math.max(i,t)}):this.select.to===this.select.from&&(this.select={from:this.carriage,to:this.carriage}),this.parent.needUpdate=!0)),!0)},ondblclick:function(n){var i,r,t;this.inBound(n.x,n.y)&&(this.doubleMouseClickTime=new Date,i=this.bound.x,this.textWidth>=this.bound.w&&(i=this.bound.x+this.bound.w-this.textWidth),this.setFont(!0),r=this.symbolIndexAt(this.ctx,this.text,n.x-i+this.carriageLeft),undefined!==r&&(t=this.separateWord(this.text,r),t&&(this.select.from===t.from&&this.select.to===t.to?(this.setCarriage(this.text.length),this.select={from:0,to:this.text.length},this.mouseSelectDirection=1,this.mouseSelectStartPos=0):(this.setCarriage(t.to),this.select={from:t.from,to:t.to},this.mouseSelectDirection=1,this.mouseSelectStartPos=t.from))))},updateSelection:function(n){var i,t;this.setFont(!0);i=this.bound.x;this.textWidth>=this.bound.w&&(i=this.bound.x+this.bound.w-this.textWidth);t=this.symbolIndexAt(this.parent.overlayctx,this.text,n-i);undefined!==t&&(this.setCarriage(t),this.select={from:t,to:t})},calculateSelectSpace:function(n,t,i,r){return i===r?undefined:{from:n.measureText(t.substring(0,i)).width,to:n.measureText(t.substring(0,r)).width}},symbolIndexAt:function(n,t,i){var e=t.length,r=0,o=0,u=0,s="",f=0;if(0===e)return undefined;if(i<=0)return 0;if(n.measureText(t).width<=i)return e;for(r=0;r<e;++r){if(s+=t[r],f=u,u=n.measureText(s).width,f=(u-f)*.5+f,o<=i&&i<=u)return i>=f?r+1:r;o=u}return undefined},separateWord:function(n,t){var f=" .,<>?;:{}[]~!@#$%^&&*()_+*=-",i,e=n.length,r="",u,o=t,s=t+1;if(e&&(r+=n[t],-1===f.indexOf(r))){for(i=t+1;i<e;++i){if(u=n[i],-1!==f.indexOf(u))break;r+=u;s++}for(i=t-1;i>=0;--i){if(u=n[i],-1!==f.indexOf(u))break;r=u+r;--o}}return{word:r,from:o,to:s}},findWord:function(n,t,i){var u=" .,<>?;:{}[]~!@#$%^&&*()_+*=-",r,f=n.length,e=t;if(f)if(i)if(-1===u.indexOf(n[t])){for(r=t;r<f;++r)if(e=r,-1!==u.indexOf(n[r]))break;for(r=e;r<f;++r)if(-1===u.indexOf(n[r]))return r===f-1?f:r}else{for(r=t;r<f;++r)if(e=r,-1===u.indexOf(n[r]))break;for(r=e;r<f;++r)if(-1===u.indexOf(n[r]))return r===f-1?f:r}else{if(t>0&&-1!==u.indexOf(n[t-1])&&--t,-1===u.indexOf(n[t])){for(r=t;r>=0;--r)if(e=r,-1!==u.indexOf(n[r]))return r+1;for(r=e;r>=0;--r)if(-1===u.indexOf(n[r]))return r}else{for(r=t;r>=0;--r)if(e=r,-1===u.indexOf(n[r]))break;for(r=e;r>=0;--r)if(-1!==u.indexOf(n[r]))return r+1}return 0}return f},onpaste:function(t){var r,i,u,f;if(t.clipboardData)if(t.clipboardData.types)for(u=0;u<t.clipboardData.types.length;)f=t.clipboardData.types[u],"text/plain"===f&&(i=t.clipboardData.getData(f),i&&(i=this.formatBuffer(i),i.length&&(this.select.from!==this.select.to&&(this.text=this.text.substring(0,this.select.from)+this.text.substring(this.select.to,this.text.length),this.carriage=this.select.from),r=this.text.length,this.text=this.text.substring(0,this.carriage)+i+this.text.substring(this.carriage,r),this.setCarriage(this.carriage+i.length)))),++u;else i=t.clipboardData.getData("text/plain"),i&&(i=this.formatBuffer(i),i.length&&(this.select.from!==this.select.to&&(this.text=this.text.substring(0,this.select.from)+this.text.substring(this.select.to,this.text.length),this.carriage=this.select.from),r=this.text.length,this.text=this.text.substring(0,this.carriage)+i+this.text.substring(this.carriage,r),this.setCarriage(this.carriage+i.length)));n.clipboardData&&(i=n.clipboardData.getData("Text"),i&&(i=this.formatBuffer(i),i.length&&(this.select.from!==this.select.to&&(this.text=this.text.substring(0,this.select.from)+this.text.substring(this.select.to,this.text.length),this.carriage=this.select.from),r=this.text.length,this.text=this.text.substring(0,this.carriage)+i+this.text.substring(this.carriage,r),this.setCarriage(this.carriage+i.length))))},oncopy:function(n){if(this._clipboard)this._clipboard.oncopy(n)},formatBuffer:function(n){return n.replace(/(\r\n|\n|\r)/gm," ")}};es.prototype={init:function(n,t,i,r){this.viewWidth=t;this.viewY=n;this._maxValue=i+this.offDown;this.ctxWidth=r;this.ctxHeight=this.ctx.canvas.height;this.needRebuild()},refresh:function(){0===this._maxValue||this._maxValue-this.viewWidth<1||(this._maxValue-this.viewWidth<this.viewWidth-ai?(this.thumb=this.viewWidth-(this._maxValue-this.viewWidth),this.step=1):(this.thumb=ai,this.step=(this._maxValue-this.viewWidth)/(this.viewWidth-ai)),-1!=this.store&&(this.position=this.store/this.step,this.store=-1),this.ctx.fillStyle=be,this.ctx.fillRect(this.ctxWidth-rt-li,this.viewY,rt,this.ctxHeight-rt*1.5-this.viewY),this.ctx.fillStyle=this.isLBMDown&&this._focus?we:pe,this.delegate.painter.roundRect(this.ctx,this.ctxWidth-rt-li,this.viewY+this.position,rt,this.thumb,2),this.ctx.fill())},value:function(){return this._value},maxValue:function(){return this._maxValue-this.viewWidth},save:function(n){this.store=this.position*this.step;this.afterNormalize=n},clamp:function(){this.step>0&&(this.position>(this._maxValue-this.viewWidth)/this.step&&this._normalize(),this.delegate&&this.delegate.update())},onmousemove:function(n){if(0!=this._maxValue&&this.isLBMDown){this.mouse=n;this.mouseChange=!0;this._focus&&(this.position+=(this.mouse.y-this.offmouse.y)/this.delegate.itemMargin*this.delegate.itemMargin,this.offmouse.y=this.mouse.y);this._focus=!0;this._normalize();var i=this.delegate;return this._value=t(this.position*this.step/i.itemMargin)*i.itemMargin-o,this.delegate&&this.delegate.update(),!0}return!1},onmousedown:function(n){if(0!=this._maxValue&&this.isHit(n)){if(this.mouse.y>=this.viewY+this.position&&this.mouse.y<this.viewY+this.position+this.thumb){this.offmouse.y=this.mouse.y;this.isLBMDown=!0;this._focus=!0;this.mouseChange=!1;var i=this.delegate;this._value=t(this.position*this.step/i.itemMargin)*i.itemMargin-o;i.update()}return!0}return!1},onmouseup:function(n){if(this.isLBMDown=!1,this.mouseChange=!1,0!=this._maxValue&&this.isHit(n)){var i=this.delegate;return this._value=t(this.position*this.step/i.itemMargin)*i.itemMargin-o,i.update(),!0}return!1},onmousewheel:function(i){var f,r,e,u;return this._maxValue-this.viewWidth<1?!1:(i=i||n.event,f=i.deltaY||i.detail||i.wheelDelta,i.deltaY&&(f*=-1),i.detail&&(f*=-1),r=this.delegate,0!=this._maxValue&&0!=f)?(e=-f/Math.abs(f),r.fullscreen?this.position+=e*uf/this.step:(u=t((this.position*this.step+e*r.itemMargin)/r.itemMargin+.5)*r.itemMargin,u=Math.max(u,0),u=Math.min(u,this._maxValue-this.viewWidth),u=t(u/r.itemMargin)*r.itemMargin-o,this.setWorldValue(u)),this._normalize(),r.update(),r.offMenus(),r.clearPopUp=!0,!0):!1},pageMove:function(n,t){n!==0&&("home"===t?(this.position=(this._maxValue-this.viewWidth)/this.step,this._value=this.position*this.step):"end"===t?(this.position=0,this._value=0):(this.position=this.calculatePageMove(n),this._value=this.position*this.step,this._normalize()),this.delegate&&this.delegate.update())},calculatePageMove:function(n){var t=this.viewWidth/(this._maxValue-this.viewWidth);return this.position-n/Math.abs(n)*t*(this._maxValue-this.viewWidth)/this.step},forwardMoveY:function(n){if(this.step>0){this.position-=n/this.step;this._normalize();var t=this.delegate;this._value=this.position*this.step;t.update()}else this.position=0,this._value=0},setWorldValue:function(n,t){if(this.step>0){this.position=n/this.step;this._normalize(t);var i=this.delegate;this._value=this.position*this.step}else this.position=0,this._value=0},setTopPos:function(){this.position=0;this._value=0},isHit:function(n){return this.mouse=n,this.mouse.x>=this.ctxWidth-rt-li*2&&this.mouse.x<this.ctxWidth},needRebuild:function(){if(-1!=this.store){if(0==this._maxValue||this._maxValue-this.viewWidth<1){this.position=0;this._value=0;this.store=-1;return}this._maxValue-this.viewWidth<this.viewWidth-ai?(this.thumb=this.viewWidth-(this._maxValue-this.viewWidth),this.step=1):(this.thumb=ai,this.step=(this._maxValue-this.viewWidth)/(this.viewWidth-ai));this.position=this.store/this.step;this._value=this.position*this.step;this._normalize();this.store=-1}},setOffDown:function(n){this.offDown=n},focus:function(n){this._focus=n},_normalize:function(n){if(this.position=Math.max(this.position,0),n&&this.position>(this._maxValue-this.viewWidth)/this.step){var i=t(this.maxValue()/this.delegate.itemMargin)*this.delegate.itemMargin;this.forwardMoveY(i-o)}else this.position=Math.min(this.position,(this._maxValue-this.viewWidth)/this.step),this._value=this.position*this.step,this.afterNormalize&&(this._value=t((this._value+o)/this.delegate.itemMargin)*this.delegate.itemMargin-o,this.position=this._value/this.step,this.afterNormalize=!1);this._maxValue<this.viewWidth&&(this.position=0,this._value=0)}};os.prototype={updateThumb:function(n,t,i){this.begin=n.begin;this.end=n.end;this.ctxWidth=t-rt*2;this.ctxHeight=i;this.leftX=this.delegate.visibleLeft+2},refresh:function(){var t;if(!(this.ctxWidth-this.leftX<ff)&&this.begin<this.end){this.ctx.fillStyle=be;this.ctx.fillRect(0,this.ctxHeight-(rt+li),this.ctxWidth,rt);this.ctx.fillStyle=this.isLBMDown?we:pe;var i=this.regionSize(),n=i*(this.end-this.begin),r=this.leftX+i*this.begin;n<ii&&(n=ii,t=(this.end+this.begin)*.5,t=.5+(t-.5)*(1+(this.end-this.begin)),r=this.leftX+(i-n)*t);this.delegate.painter.roundRect(this.ctx,r,this.ctxHeight-(rt+li),n,rt,2);this.ctx.fill()}},onmousemove:function(n){if(0!=this._maxValue&&this.isLBMDown){this.mouse=n;var t=this.delegate,s,u,l,a,v,h,p,f,i,r,y,e,c,o;if(t)return t.animator.stop(),h=t.zoomBar.duration,p=t.zoomBar.timeCur,f=t.zoomBar.fraction,s=t.timeScale.hourInPixels/t.timeScale.scaleX,v=this.leftX/s,i=this.regionSize(),r=i*(this.end-this.begin),y=this.leftX+i*this.begin,r<ii?(r=ii,e=(this.end+this.begin)*.5,e=.5+(e-.5)*(1+(this.end-this.begin)),y=this.leftX+(i-r)*e,u=(this.mouse.x-this.anchor-this.leftX)/(i-r),c=t.zoomBar.maxPos(),o=t.zoomBar.minPos(),t.offsetX=u*(c-o)+o,t.offsetX=Math.max(t.offsetX,c),t.offsetX=Math.min(t.offsetX,o)):(u=(this.mouse.x-this.anchor-this.leftX)/i,l=f-u,a=Math.max(Math.min(l,f)*h,(t.zoomBar.bandwidth/t.zoomBar.regionSize()-1+f)*h)+v,t.offsetX=a*s/t.timeScale.hourInPixels),t.zoomBar.needRepaint(),t.updateWithStrafe(),!0}return!1},onmousedown:function(n){var t;if(this.ctxWidth-this.leftX<ff)return!1;if(this.begin<this.end&&this.isHit(n)){var i=this.regionSize(),r=i*(this.end-this.begin),u=this.leftX+i*this.begin;return r<ii&&(r=ii,t=(this.end+this.begin)*.5,t=.5+(t-.5)*(1+(this.end-this.begin)),u=this.leftX+(i-r)*t),this.isLBMDown=!0,this.anchor=this.mouse.x-u,this.delegate.offMenus(),this.delegate.updateData(),!0}return!1},onmouseup:function(){this.isLBMDown=!1},onmousewheel:function(n){return this.delegate.onmousewheel(n)},isHit:function(n){var i;if(this.ctxWidth-this.leftX<ff)return!1;if(this.mouse=n,this.mouse.y>=this.ctxHeight-rt-li*2&&this.mouse.y<this.ctxHeight&&this.begin<this.end){var r=this.regionSize(),t=r*(this.end-this.begin),u=this.leftX+r*this.begin;return t<ii&&(t=ii,i=(this.end+this.begin)*.5,i=.5+(i-.5)*(1+(this.end-this.begin)),u=this.leftX+(r-t)*i),this.mouse.x>u&&this.mouse.x<u+t}return!1},regionSize:function(){return this.ctxWidth-this.leftX}};ss.prototype={create:function(t){if(this.element=document.createElement("input"),this.element){this.element.id="editControl";this.element.type="text";this.element.value="";this.element.style.position="absolute";this.element.style.backgroundColor="white";this.element.style.width="100px";this.element.style.height="20px";this.element.style.border="solid";this.element.style.borderColor="#CCCCCC";this.element.style.borderWidth="1px";this.element.style.outline="none";this.show(!1);var i=this;this.element.onkeypress=function(t){var f,r,u;t=n.event||t;f=t.keyCode?t.keyCode:t.which?t.which:t.charCode;this.counter=0;switch(f){case 13:return r=this.value.replace(/^\s+/,"").replace(/\s+$/,""),r.length>vi&&(r=r.substring(0,vi)),i.baseText.length&&!r.length&&(r=i.baseText),u=null,i.ref&&(u=i.ref,i.ref._title=r,i.ref.isInEditMode=!1,i.ref.update(),i.ref=null),r.length?i.baseText===r?i.delegate._undoManager.flushPop(0):i.delegate._undoManager.updateOperation(0,u):i.delegate._undoManager.flushPop(0),i.close(),i.delegate.updateData(),!1}return!0};this.element.onkeydown=function(t){var f,r,u;t=n.event||t;f=t.keyCode?t.keyCode:t.which?t.which:t.charCode;switch(f){case 27:return i.delegate._undoManager.flushPop(0),i.close(),i.delegate.updateData(),!1;case 13:return r=this.value.replace(/^\s+/,"").replace(/\s+$/,""),r.length>vi&&(r=r.substring(0,vi)),i.baseText.length&&!r.length&&(r=i.baseText),u=null,i.ref&&(u=i.ref,i.ref._title=r,i.ref.isInEditMode=!1,i.ref.update(),i.ref=null),r.length?i.baseText===r?i.delegate._undoManager.flushPop(0):i.delegate._undoManager.updateOperation(0,u):i.delegate._undoManager.flushPop(0),i.close(),i.delegate.updateData(),!1}return!0};t?t.appendChild(this.element):document.body.appendChild(this.element)}},updateDefaults:function(){},setValue:function(n){this.element&&(this.baseText=n)},setReference:function(n,t,i,r){this.ref=n;this.anchor={p:t,m:i,t:r};this.enable=this.anchor.p!==undefined||this.anchor.m!==undefined||this.anchor.t!==undefined},setBoldText:function(){},updateInnerValue:function(){this.element&&(this.element.value="",this.element.value=this.baseText,this.element.focus(),this.element.selectionStart=this.element.selectionEnd=this.element.value.length)},show:function(n){n?""!==this.element.style.display&&(this.element.style.overflow="",this.element.style.zIndex=1e3,this.element.style.display="",this.updateInnerValue()):"none"!==this.element.style.display&&(this.element.style.display="none",this.element.style.overflow="hidden",this.element.style.zIndex=-1e3)},close:function(){this.delegate.updateData();this.ref&&(this.delegate._undoManager.flushPop(0),this.ref=null);this.anchor={p:undefined,m:undefined,t:undefined};this.enable=!1;this.show(!1)},isEnable:function(){return this.enable},inBound:function(n){return this.enable&&this.element.style.left<=n.clientX&&this.element.style.left+this.element.style.width>=n.clientX},isValidAnchor:function(n,t,i){return n===this.anchor.p&&t===this.anchor.m&&i===this.anchor.t}};cs.prototype={collection:{elements:[],cache:[],metrics:[],indexer:[]},select:{p:undefined,t:undefined,m:undefined},hit:{p:undefined,t:undefined,m:undefined},width:250,maxWidth:250,elementsCount:50,distanceBetweenCells:10,paddingLeftCellContent:-7,hiddenCellsCtr:52,rows:[{name:"Name",enable:!0,minWidth:265,el:null,posX:0,isHidden:!1,translate:"Name"},{name:"Responsibility",enable:!0,minWidth:140,el:document.createElement("div"),posX:0,isHidden:!1,translate:"Responsible(-s)"},{name:"BeginDate",enable:!1,minWidth:95,el:document.createElement("div"),posX:0,isHidden:!1,translate:"Begin Date"},{name:"EndDate",enable:!1,minWidth:95,el:document.createElement("div"),posX:0,isHidden:!1,translate:"End Date"},{name:"Status",enable:!1,minWidth:60,el:document.createElement("div"),posX:0,isHidden:!1,translate:"Status"},{name:"Priority",enable:!1,minWidth:65,el:document.createElement("div"),posX:0,isHidden:!1,translate:"Priotity"}],visibleRows:[],_cacheHeightPanel:-1,disableMode:!1,init:function(n){function r(n){t.hit=undefined;t.timeline.editBox.isEnable()&&t.highlightElement(t.timeline.editBox.p,-1===t.timeline.editBox.m?undefined:t.timeline.editBox.m,-1===t.timeline.editBox.t?undefined:t.timeline.editBox.t);i.onmousewheel(n);return!0}var t=this,i=this.timeline;this.controller=n;this.base&&(this.el=document.createElement("div"),this.el&&(this.fontH1=this.textMeasurer.readStyleValue("line-project","font"),this.el.className="left-panel",this.base.appendChild(this.el),this.elInner=document.createElement("div"),this.elInner.style.width="100%",this.elInner.style.height="100%",this.elInner.style.position="absolute",this.el.appendChild(this.elInner),this.el.onmouseout=function(){i.leftPanelController().getPanel().clearHighlightElement()},this.el.onmousewheel=function(n){t.hit=undefined;t.timeline.editBox.isEnable()&&t.highlightElement(t.timeline.editBox.p,-1===t.timeline.editBox.m?undefined:t.timeline.editBox.m,-1===t.timeline.editBox.t?undefined:t.timeline.editBox.t);i.onmousewheel(n);return!0},this.el.addEventListener("MozMousePixelScroll",function(n){r(n)},!1),this.elInner.oncontextmenu=function(){return!1},this.buildHeader(this.base),this.buildSplitter(this.el),this.buildCollection(),this.calcRowsWidth(),this.addRowAvailable(undefined),this.editBox=new ss(this.timeline),this.editBox.create(this.elInner)))},calcRowsWidth:function(){this.noResponsible=n.Gantt.Localize_strings.noResponsible;this.rows[1].minWidth=Math.max(140,this.distanceBetweenCells+this.textMeasurer.width(n.Gantt.Localize_strings.responsibles2||"Responsible(-s)","row-tab"));this.rows[2].minWidth=Math.max(95,this.distanceBetweenCells+this.textMeasurer.width(n.Gantt.Localize_strings.beginDate||"Begin Date","row-tab"));this.rows[3].minWidth=Math.max(95,this.distanceBetweenCells+this.textMeasurer.width(n.Gantt.Localize_strings.endDate||"End Date","row-tab"));this.rows[4].minWidth=Math.max(60,this.distanceBetweenCells+this.textMeasurer.width(n.Gantt.Localize_strings.status||"Status","row-tab"));this.rows[5].minWidth=Math.max(65,this.distanceBetweenCells+this.textMeasurer.width(n.Gantt.Localize_strings.priotity||"Priotity","row-tab"));this.textMeasurer.clear()},setHeight:function(n){this.el&&this._cacheHeightPanel!=n&&(this._cacheHeightPanel=n,this.el.style.height=n-g*2-1+"px")},buildHeader:function(n){var t=this,f=document.createElement("div"),s,a,y,r,l,v,u,i,c,o;if(f){f.oncontextmenu=function(){return!1};f.className="header-element";n.appendChild(f);s=document.createElement("div");s.style.cssText="height:100%; width:100%;position:absolute;";f.appendChild(s);f=s;a=document.createElement("div");a.style.cssText="height:100%; width:100%;overflow:hidden;position:relative;background:#D3D3D3;border-right: 1px solid #CCCCCC;";f.appendChild(a);f=a;y=document.createElement("div");y.className="header-element-down";f.appendChild(y);var p=!1,h=this.timeline,e={};for(r=1;r<this.rows.length;++r)this.rows[r].el.className="row-tab",this.rows[r].el.style.top=g-4+"px",f.appendChild(this.rows[r].el),l=document.createElement("div"),l.className="cell-text-button",this.rows[r].el.appendChild(l),v=document.createElement("div"),v.className="cell-close-button",this.rows[r].el.appendChild(v),l.onmousedown=function(){var n=r;return function(n){var u,r,i;for(p=!0,e=undefined,t.closeEditing(),u=n.clientX-h.ctx.canvas.offsetLeft,r=t.rows[0].minWidth,i=0;i<t.visibleRows.length;++i){if(u>=r&&u<=r+t.visibleRows[i].width){e={};e.index=i;e.name=t.visibleRows[i].name;break}r+=t.visibleRows[i].width}return e?(document.onmousemove=function(n){for(var i=0,u=1e3,s=0,c=n.clientX-h.ctx.canvas.offsetLeft,l=t.rows[0].minWidth,r,a,f,v,o,i=0;i<t.visibleRows.length;++i){if(t.getRowWithName(t.visibleRows[i].name).isHidden)break;u=Math.min(u,t.visibleRows[i].width)}for(i=0;i<t.visibleRows.length;++i){if(t.getRowWithName(t.visibleRows[i].name).isHidden)break;if(s=l+t.visibleRows[i].width*.5,c>=s-u*.5&&c<=s+u*.5&&e.name!==t.visibleRows[i].name){for(r=[],a=t.visibleRows[i].name,f=0;f<t.visibleRows.length;++f)r.push(t.visibleRows[f].name);for(r[e.index]=a,r[i]=e.name,e.index=i,v=t.getVisibleRows(),t.visibleRows=[],o=0;o<r.length;++o)t.addRowAvailable(r[o]);if(t.showHiddenRows(v),t.rebuildContent(undefined),t.controller.onfieldsfilter)t.controller.onfieldsfilter(n,!0,0,0,t.getAvailableRows());break}l+=t.visibleRows[i].width}},document.onmouseup=function(n){if(p){if(t.rebuildContent(undefined),t.controller.onfieldsfilter)t.controller.onfieldsfilter(n,!0,0,0,t.getHiddenRows(),t.getVisibleRows());document.onmousemove=function(n){h.onmousemove(n)};document.onmouseup=function(n){h.onmouseup(n)}}},!0):!1}}(r),l.onmouseup=function(){var n=r;return function(n){if(p=!0,t.controller.onfieldsfilter)t.controller.onfieldsfilter(n,!0,0,0,t.getAvailableRows());return document.onmousemove=function(n){h.onmousemove(n)},document.onmouseup=function(n){h.onmouseup(n)},!0}}(r),v.onclick=function(n){var i=r;return function(){var r=t.getVisibleRows(t.rows[i].name);if(t.closeEditing(),t.deleteAvailableRow(t.rows[i].name),t.showHiddenRows(r),t.rebuildContent(undefined),t.controller.onfieldsfilter)t.controller.onfieldsfilter(n,!0,0,0,t.getAvailableRows());return!0}}(r);this.pX=0;this.pY=0;this.pfX=0;this.pfY=0;u=document.createElement("div");u&&(u.id="gantt-filter-projects",u.className="filter-projects",s.appendChild(u),i=document.createElement("div"),i&&(i.id="gantt-filter-fields",i.className="filter-fields",i.style.top=g-4+"px",s.appendChild(i),i.onclick=function(n){if(t.closeEditing(),!t.disableMode){var i=t.btnFlds.getBoundingClientRect();if(t.controller.onfieldsfilter)t.controller.onfieldsfilter(n,!1,i.left+i.width,i.top+i.height,t.getAvailableRows())}return!0},c=document.createElement("div"),c&&(c.className="filter-fields",c.style.top=g-4+"px",f.appendChild(c)),this.pX=u.offsetLeft+u.offsetWidth+this.timeline.ctx.canvas.offsetLeft,this.pY=u.offsetTop+u.offsetHeight+this.timeline.ctx.canvas.offsetTop,this.pfX=i.offsetLeft+i.offsetWidth+this.timeline.ctx.canvas.offsetLeft,this.pfY=i.offsetTop+i.offsetHeight+this.timeline.ctx.canvas.offsetTop),o=document.createElement("div"),o&&(o.id="gantt-filter-hidden-fields",o.className="filter-hidden-fields",o.style.top=g-4+"px",o.style.display="none",s.appendChild(o),o.onclick=function(n){if(t.closeEditing(),t.controller.onhiddenfieldsfilter)t.controller.onhiddenfieldsfilter(n,!1,t.pfHX,t.pfHY,t.getHiddenRows(),t.getVisibleRows());return!0},this.pHX=u.offsetLeft+u.offsetWidth*2+this.timeline.ctx.canvas.offsetLeft,this.pHY=u.offsetTop+u.offsetHeight+this.timeline.ctx.canvas.offsetTop,this.pfHX=i.offsetLeft+i.offsetWidth+this.timeline.ctx.canvas.offsetLeft,this.pfHY=i.offsetTop+i.offsetHeight+this.timeline.ctx.canvas.offsetTop));this.header=f;this.btnPrj=u;this.btnFlds=i;this.btnFldsFake=c;this.btnHiddenFlds=o}},buildCollection:function(){for(var i=this,n=null,t=0;t<this.elementsCount;++t)n=document.createElement("div"),n&&(n.style.top=(g*t|0)+"px",n.style.height=g-1+"px",n.className="line-element",this.appendNameField(t,n),this.appendCounterField(t,n),this.appendResponsiblesField(t,n),this.appendBeginDateField(t,n),this.appendEndDateField(t,n),this.appendStatusField(t,n),this.appendPriorityField(t,n),this.appendCollapseButtons(t,n),this.appendDragElements(t,n),this.elInner.appendChild(n),this.collection.elements.push(n),n.onmouseover=function(){var n=t;return function(t){return i.hitLine(t,i,n)}}(t),n.onmouseout=function(){var n=t;return function(n){if(i.editBox.isEnable())return!0;var t=ir(n);return t.className!=="line-element"&&(t=t.parentNode),t.style.background="#F3F3F3",i.hit=undefined,!0}}(t),n.onclick=function(){return i.editBox.isEnable()?(i.closeEditing(),!0):!1},n.onmouseup=function(){var r=t,u=n;return function(n){2===n.button&&(st(n),i.timeline.editBox.isEnable()&&i.timeline.editBox.cancel(),i.closeEditing(),i.select={p:i.collection.indexer[r].p,m:i.collection.indexer[r].m,t:i.collection.indexer[r].t,line:r},i.controller.showElementMenu(n,i.select,u))}}(t))},buildSplitter:function(n){var o=document.createElement("div"),i;if(o&&(o.className="gantt-splitter-fake",n.appendChild(o),i=document.createElement("div"),i)){i.className="gantt-splitter";n.appendChild(i);var r=this.timeline,t=this,u=!1,s=!1,f=!1,l=0,e=0,a=0,c="584px",h=16;i.onmousemove=function(){t.clearHighlightElement()};i.onmousedown=function(n){0!==t.visibleRows.length&&(e=n.clientX,u=!0,l=e-i.getBoundingClientRect().left,st(n),0!==t.visibleRows.length)&&(document.onmousemove=function(n){var h,u,o;if(e!=n.clientX){if(e=n.clientX,!s){for(t.clearHighlightElement(),h=t.rows[0].minWidth,u=0;u<t.visibleRows.length;++u)t.hideVisibleRow(t.visibleRows[u].name,!0),h+=t.visibleRows[u].width+t.distanceBetweenCells;t.btnFldsFake.style.left=h-4+"px";t.btnHiddenFlds.style.display="none";t.rebuildContent(undefined);s=!0}f=!0;o=Math.min(Math.max(e-l-8,t.rows[0].minWidth),t.maxWidth);i.style.left=o-300+"px";i.style.width=c;t.el.style.width=o+"px";t.header.style.width=o+"px";t.width=o;t.btnFlds.style.display="none";t.clearHighlightElement();r.needUpdate=!0}},document.onmouseup=function(n){var w;if(u){if(f){for(var v=t.rows[0].minWidth,e=Math.min(Math.max(n.clientX,v),t.maxWidth),l=v,y=v,o=0,a=0,p=!0;o<t.visibleRows.length;++o){if(y=l,l+=t.visibleRows[o].width+t.distanceBetweenCells,e>=y&&e<l){e=y;p=!1;break}o+1===t.visibleRows.length&&e>l-t.distanceBetweenCells&&(e=t.maxWidth)}for(;a<t.visibleRows.length;++a)t.hideVisibleRow(t.visibleRows[a].name,a<o);if(p||(e+=t.hiddenCellsCtr,t.btnHiddenFlds.style.display="",t.btnHiddenFlds.style.left=e-t.btnFlds.offsetWidth-59+"px"),i.style.left=e-250+"px",i.style.width=c,t.el.style.width=e+"px",t.header.style.width=e+"px",t.width=e,t.btnFlds.style.left=t.width-t.btnFlds.offsetWidth-34+"px",t.btnFldsFake.style.left=t.btnFlds.style.left,t.pfX=t.btnFlds.offsetLeft+t.btnFlds.offsetWidth+t.timeline.ctx.canvas.offsetLeft,t.pfY=t.btnFlds.offsetTop+t.btnFlds.offsetHeight+t.timeline.ctx.canvas.offsetTop,t.pfHX=t.btnHiddenFlds.offsetLeft+t.btnHiddenFlds.offsetWidth+t.timeline.ctx.canvas.offsetLeft,t.pfHY=t.btnHiddenFlds.offsetTop+t.btnHiddenFlds.offsetHeight+t.timeline.ctx.canvas.offsetTop,r.needUpdate=!0,w=parseInt(i.style.left.replace("px",""))+parseInt(i.style.width.replace("px",""))*.5,i.style.left=e-h+"px",i.style.width=h+"px",t.rebuildContent(undefined),t.controller.onhiddenfieldsfilter)t.controller.onhiddenfieldsfilter(n,!0,0,0,t.getHiddenRows(),t.getVisibleRows());t.btnFlds.style.display="";s=!1;u=!1}f=!1;document.onmousemove=function(n){r.onmousemove(n)};document.onmouseup=function(n){r.onmouseup(n)}}})};i.onmouseup=function(n){var b;if(u){if(f){for(var y=t.rows[0].minWidth,e=Math.min(Math.max(n.clientX-a,y),t.maxWidth),l=y,p=y,o=0,v=0,w=!0;o<t.visibleRows.length;++o){if(p=l,l+=t.visibleRows[o].width+t.distanceBetweenCells,e>=p&&e<l){e=p;w=!1;break}o+1===t.visibleRows.length&&e>l-t.distanceBetweenCells&&(e=t.maxWidth)}for(;v<t.visibleRows.length;++v)t.hideVisibleRow(t.visibleRows[v].name,v<o);if(w||(e+=t.hiddenCellsCtr,t.btnHiddenFlds.style.display="",t.btnHiddenFlds.style.left=e-t.btnFlds.offsetWidth-59+"px"),i.style.left=e-250+"px",i.style.width=c,t.el.style.width=e+"px",t.header.style.width=e+"px",t.width=e,t.btnFlds.style.left=t.width-t.btnFlds.offsetWidth-34+"px",t.btnFldsFake.style.left=t.width-t.btnFlds.offsetWidth-34+"px",t.pfX=t.btnFlds.offsetLeft+t.btnFlds.offsetWidth+t.timeline.ctx.canvas.offsetLeft,t.pfY=t.btnFlds.offsetTop+t.btnFlds.offsetHeight+t.timeline.ctx.canvas.offsetTop,t.pfHX=t.btnHiddenFlds.offsetLeft+t.btnHiddenFlds.offsetWidth+t.timeline.ctx.canvas.offsetLeft,t.pfHY=t.btnHiddenFlds.offsetTop+t.btnHiddenFlds.offsetHeight+t.timeline.ctx.canvas.offsetTop,r.needUpdate=!0,b=parseInt(i.style.left.replace("px",""))+parseInt(i.style.width.replace("px",""))*.5,i.style.left=e-h+"px",i.style.width=h+"px",t.rebuildContent(undefined),t.controller.onhiddenfieldsfilter)t.controller.onhiddenfieldsfilter(n,!0,0,0,t.getHiddenRows(),t.getVisibleRows());t.btnFlds.style.display="";s=!1;u=!1}f=!1;document.onmousemove=function(n){r.onmousemove(n)};document.onmouseup=function(n){r.onmouseup(n)}}};this.splitter=i;this.splitterFake=o}},appendNameField:function(t,i){function e(n){r.closeEditing();r.select={p:r.collection.indexer[n].p,m:r.collection.indexer[n].m,t:r.collection.indexer[n].t,line:n};r.showEditBox(r)}function o(n){(r.closeEditing(),r.collection.indexer[n].freeTasks)||(r.select={p:r.collection.indexer[n].p,m:r.collection.indexer[n].m,t:r.collection.indexer[n].t,line:n},r.controller.elementCentering(r.select))}function s(n,t){return o(t)}function h(n,t){return e(t)}var r=this,f=0,u=document.createElement("span");u&&(u.className="name-column",i.appendChild(u),u.ondblclick=function(){var i=t;return function(t){if(undefined!==r.collection.indexer[i].p&&undefined===r.collection.indexer[i].m&&undefined===r.collection.indexer[i].t){var u=r.timeline.storage.p[r.collection.indexer[i].p].id();return st(t),n.open("tasks.aspx?prjID="+u),!0}return f=2,h.call(this,t,i)}}(t),u.onclick=function(){var n=t;return function(t){var i=this;setTimeout(function(){var r=f;r>0?f=r-1:s.call(i,t,n)},300)}}(t),u.onmousemove=function(){var n=t;return function(t){return r.hitLine(t,r,n)}}(t))},appendCounterField:function(n,t){var r=this,i=document.createElement("span");i&&(i.className="name-column-counter",t.appendChild(i))},appendResponsiblesField:function(n,t){var i=this,r=document.createElement("span");r&&(r.className="name-column-resp",t.appendChild(r),r.onclick=function(){var t=n;return function(n){(st(n),i.timeline.editBox.isEnable())||(i.closeEditing(),i.select={p:i.collection.indexer[t].p,m:i.collection.indexer[t].m,t:i.collection.indexer[t].t,line:t},i.controller.changeResponsibles(n,i.select,ir(n)))}}(n))},appendBeginDateField:function(n,t){var i=this,r=document.createElement("span");r&&(r.className="name-column-begin-date",t.appendChild(r),r.onclick=function(){var t=n;return function(n){(st(n),i.timeline.editBox.isEnable())||(i.closeEditing(),i.select={p:i.collection.indexer[t].p,m:i.collection.indexer[t].m,t:i.collection.indexer[t].t,line:t},i.controller.changeTimes(n,i.select,ir(n),!1))}}(n))},appendEndDateField:function(n,t){var i=this,r=document.createElement("span");r&&(r.className="name-column-end-date",t.appendChild(r),r.onclick=function(){var t=n;return function(n){(st(n),i.timeline.editBox.isEnable())||(i.closeEditing(),i.select={p:i.collection.indexer[t].p,m:i.collection.indexer[t].m,t:i.collection.indexer[t].t,line:t},i.controller.changeTimes(n,i.select,ir(n),!0))}}(n))},appendStatusField:function(n,t){var i=this,r=document.createElement("span");r&&(r.className="name-column-status",t.appendChild(r),r.onclick=function(){var t=n;return function(n){(st(n),i.timeline.editBox.isEnable())||(i.closeEditing(),i.select={p:i.collection.indexer[t].p,m:i.collection.indexer[t].m,t:i.collection.indexer[t].t,line:t},i.controller.changeStatus(n,i.select,ir(n)))}}(n))},appendPriorityField:function(n,t){var r=this,i=document.createElement("span");i&&(i.className="name-column-priority",t.appendChild(i))},appendCollapseButtons:function(n,t){var i=this,r=document.createElement("div");r&&(r.className="button-colapse-open",t.appendChild(r),r.onclick=function(){var t=n;return function(n){st(n);i.closeEditing();i.select={p:i.collection.indexer[t].p,m:i.collection.indexer[t].m,t:i.collection.indexer[t].t,line:t,freeTasks:i.collection.indexer[t].freeTasks};i.controller.collapseElement(n,i.select)}}(n))},appendDragElements:function(n,t){var i=this.timeline,r=this,s=t,e={},u=undefined,f=null,o=document.createElement("div");o&&(o.className="button-drag-drop",t.appendChild(o),o.onmousedown=function(){var o=n,s=t;return function(n){var h,t;if(st(n),h=s.getBoundingClientRect(),e.X=n.clientX-h.left,e.Y=n.clientY-h.top,u=s.cloneNode(!0),u){for(u.className="element-drag-drop",u.style.background="",u.style.zIndex="1000",u.style.width=r.rows[0].minWidth+"px",u.style.left=-e.X+n.clientX+"px",u.style.top=-e.Y+n.clientY+"px",t=1;t<u.childNodes.length-1;++t)u.childNodes[t].style.display="none";document.body.appendChild(u)&&(document.body.style.overflow="hidden",f=document.createElement("div"),f&&(f.style.zIndex="990",f.style.position="absolute",f.style.background="transparent",f.style.left="0",f.style.top="0",f.style.width="100%",f.style.height="100%",f.style.cursor="pointer",document.body.appendChild(f)),"onmousewheel"in document?(f.onmousewheel=function(n){i.onmousewheel(n);return!0},u.onmousewheel=function(n){i.onmousewheel(n);return!0}):(u.addEventListener("MozMousePixelScroll",function(n){i.onmousewheel(n);return!0},!1),f.addEventListener("MozMousePixelScroll",function(n){i.onmousewheel(n);return!0},!1)),undefined!==r.dragIndex&&(r.collection.elements[r.dragIndex].childNodes[8].style.display="none",r.collection.elements[r.hit.line].style.background="#F3F3F3",r.dragIndex=undefined,r.clearHighlightElement()),i.itemToDrop={},i.itemToDrop.p=undefined!==r.collection.indexer[o].p?r.collection.indexer[o].p:-1,i.itemToDrop.m=undefined!==r.collection.indexer[o].m?r.collection.indexer[o].m:-1,i.itemToDrop.t=undefined!==r.collection.indexer[o].t?r.collection.indexer[o].t:-1,r.dragMode=!0,i.editMode=lt,undefined===r.collection.indexer[o].t&&(i.viewController().collapseProjects(!1),i.viewController().collapse(!0),i.updateData(),i.needUpdateContent=!0,i.drawScene()),document.onmousemove=function(n){var t,f;i.mouse=i.windowToCanvas(n.clientX,n.clientY);i.mouse.baseEvent=n;u.style.left=-e.X+n.clientX+"px";u.style.top=-e.Y+n.clientY+"px";i.calculateLineHit(n);r.highlightElement(i.hitLine.p,i.hitLine.m===-1?undefined:i.hitLine.m,i.hitLine.t+1);r.updateTimeLineHitLine();u.style.border=i.itemToDrop.p===i.hitLine.p?"2px solid #bdda7f":"2px solid #ff0000";t=i.storage.getProject(i.hitLine.p);t&&-1!==i.hitLine.t&&(i.hitLine.m===-1?t.collapse&&(t.collapse=!1,i.updateData(),i.needUpdateContent=!0,i.drawScene()):(f=t.getMilestone(i.hitLine.m),f.collapse&&(f.setCollapse(!1),i.updateData(),i.needUpdateContent=!0,i.drawScene())))},document.onmouseup=function(n){r.dragMode=undefined;i.editMode=ni;var t=s.getBoundingClientRect();i.dragBound={x:n.clientX,y:n.clientY-i.itemMargin*2,width:0,height:i.itemHeight,dy:0,dx:0};i.calculateLineHit(n);i.itemToDrop.p===i.hitLine.p&&(i.moveElement(n,i.hitLine),i.updateData());document.body.removeChild(f);document.body.removeChild(u);f=null;document.body.style.overflow="";document.onmousemove=function(n){i.onmousemove(n)};document.onmouseup=function(n){i.onmouseup(n)}})}}}(n))},setDisableMode:function(n){this.disableMode=n;this.splitter&&(this.splitter.style.display=n||this.visibleRows.length===0?"none":"");this.splitterFake&&(this.splitterFake.style.display=n||this.visibleRows.length===0?"none":"");this.btnFlds&&(this.btnFlds.className=n?"filter-fields-disable":"filter-fields");n&&(this.addRowAvailable(undefined),this.showHiddenRows([]))},hitLine:function(n,t,i){var u,f,e;return(undefined!==t.dragIndex&&(t.collection.elements[t.dragIndex].childNodes[8].style.display="none",t.dragIndex=undefined),t.editBox.isEnable())?!0:t.timeline.editBox.isEnable()?(t.highlightElement(t.timeline.editBox.p,-1===t.timeline.editBox.m?undefined:t.timeline.editBox.m,-1===t.timeline.editBox.t?undefined:t.timeline.editBox.t),!0):(u=ir(n),u.className!=="line-element"&&(u=u.parentNode),t.collection.indexer[i].disabled)?(t.updateTimeLineHitLine(),!0):(u.style.background="#E1E1E1",t.hit={p:t.collection.indexer[i].p,m:t.collection.indexer[i].m,t:t.collection.indexer[i].t,line:i},f=t.timeline.storage.getProject(t.hit.p),f&&p===f.status()&&undefined!==t.collection.indexer[i].t&&undefined===t.dragMode&&(e=t.timeline.storage.getTask(t.hit.p,t.hit.m,t.hit.t),undefined!==e&&r!==e._status&&(t.collection.elements[i].childNodes[8].style.display="",t.dragIndex=i)),t.updateTimeLineHitLine(),!0)},rebuildContent:function(i){function d(){yt.timeline.editBox.isEnable()&&yt.highlightElement()}var st,rt,nt,k;if(this.OK){this.elInner.style.top=-this.timeline.rightScroll.value()+"px";return}for(var yt=this,p=this.timeline,ni=n.Gantt.Localize_strings.taskWithoutMilestones||"Task Without Milestones",wt=n.Gantt.Localize_strings.highPriority||"high",ti=n.Gantt.Localize_strings.openStatus||"open",ii=n.Gantt.Localize_strings.closeStatus||"close",ot=n.Gantt.Localize_strings.addDate||"add",e,l,w=0,y,c=0,v,s,u,f=this.elementsCount-1;f>=0;--f)this.collection.elements[f].className="line-element",this.collection.elements[f].style.display="none",this.collection.elements[f].style.background="#F3F3F3",this.collection.elements[f].childNodes[0].style.font="",this.collection.elements[f].childNodes[0].style.color="#333333",this.collection.elements[f].childNodes[1].style.color="#333333",this.collection.elements[f].childNodes[2].style.color="#333333",this.collection.elements[f].childNodes[3].style.color="#333333",this.collection.elements[f].childNodes[4].style.color="#333333",this.collection.elements[f].childNodes[5].style.color="#333333",this.collection.elements[f].childNodes[0].className="name-column",this.collection.elements[f].childNodes[2].className="name-column-resp",this.collection.elements[f].childNodes[3].className="name-column-begin-date",this.collection.elements[f].childNodes[4].className="name-column-end-date",this.collection.elements[f].childNodes[5].className="name-column-status",this.collection.elements[f].childNodes[6].className="name-column-priority",this.collection.elements[f].childNodes[1].textContent="",this.collection.elements[f].childNodes[2].textContent="",this.collection.elements[f].childNodes[3].textContent="",this.collection.elements[f].childNodes[4].textContent="",this.collection.elements[f].childNodes[5].textContent="",this.collection.elements[f].childNodes[6].textContent="",this.collection.elements[f].childNodes[7].style.display="none",this.collection.elements[f].childNodes[8].style.display="none";st=25;rt=34;(undefined!==n.netscape||undefined!==n.clipboardData)&&(--rt,--st);st+="px";rt+="px";nt=undefined!==Teamlab&&undefined!==Teamlab.getDisplayDate;i=p.rightScroll.value();this.collection.indexer=[];this.setDisableMode(0===p.storage.projects().length);var ri=(p.rightScroll.value()+.5)%p.itemMargin,b=-ri+1,fi=p.itemMargin*.5,ht=p.itemMargin,ut=t((i+.5)/ht),ft=Math.min(p.ctxHeight/ht+1,this.elementsCount-1),bt=t(p.rightScroll.value()%ht+.5),ei=p.timeScale.height()-bt+ht*.7,oi=p.timeScale.height()-bt,a=!1,o=p.storage.projects(),ui=o.length,ct=this.rows[1].posX+"px",kt=this.rows[2].posX+"px",lt=this.rows[3].posX+"px",at=this.rows[4].posX+"px",dt=this.rows[5].posX+"px",tt=!this.rows[1].isHidden,vt=!this.rows[2].isHidden,it=!this.rows[3].isHidden,et=!this.rows[4].isHidden,gt=!this.rows[5].isHidden;for(e=0;e<ui;++e){if(a=o[e].isLocked()||o[e].isInReadMode(),w>=ut&&(u=this.collection.elements[c],l=o[e]._title,l=l.substring(0,30),u.style.top=(c*g+b|0)+"px",u.childNodes[0].textContent=l,u.childNodes[0].title=o[e]._title,u.childNodes[0].style.left="16px",u.childNodes[0].style.font=this.fontH1,tt&&(u.childNodes[2].style.left=ct,u.childNodes[2].textContent=lu(o[e],this.noResponsible),u.childNodes[2].className="name-column-resp gantt-cell-disable"),u.childNodes[7].className=o[e].fullCollapse?"button-colapse-close":"button-colapse-open",u.childNodes[7].style.display="",a&&(u.childNodes[0].style.color=h,u.childNodes[1].style.color=h,u.childNodes[2].style.color=h,u.childNodes[0].className="name-column gantt-cell-pointer",u.childNodes[2].className="name-column-resp gantt-cell-disable"),o[e].isLocked()&&(u.childNodes[2].className="name-column-resp gantt-cell-disable",u.childNodes[7].style.display="none"),o[e]._isprivate&&(u.className="line-element icon-private"),u.style.display="",this.collection.indexer.push({p:e,m:undefined,t:undefined,text:l,disabled:!0}),++c,ft<c)){d();this.elInner.style.display="";return}if(++w,!o[e].fullCollapse){for(f=0;f<o[e].m.length;++f)if(!o[e].m[f].filter){if(w>=ut&&(u=this.collection.elements[c],l=o[e].m[f]._title,l=l.substring(0,30),v=hs(o[e].m[f]),u.style.top=(c*g+b|0)+"px",u.childNodes[0].textContent=l,u.childNodes[0].title=o[e].m[f]._title,u.childNodes[0].style.fontWeight="bold",u.childNodes[0].style.left="26px",a||(u.childNodes[0].style.color=v),u.childNodes[1].textContent=vr(o[e].m[f].t),a||(u.childNodes[1].style.color=v),tt&&(u.childNodes[2].style.left=ct,u.childNodes[2].textContent=lu(o[e].m[f],this.noResponsible),a||(u.childNodes[2].style.color=v),r-1===o[e].m[f]._status&&(u.childNodes[2].className="name-column-resp gantt-cell-disable")),it&&(u.childNodes[4].textContent=pt(o[e].m[f]._endDate,nt),u.childNodes[4].style.left=lt,a||(u.childNodes[4].style.color=v),r-1===o[e].m[f]._status&&(u.childNodes[4].className="name-column-end-date gantt-cell-disable")),et&&(u.childNodes[5].style.left=at,u.childNodes[5].textContent=r-1===o[e].m[f]._status?ii:ti),o[e].m[f].t.length&&(u.childNodes[7].className=o[e].m[f].collapse?"button-colapse-close":"button-colapse-open",u.childNodes[7].style.display=""),a&&(u.childNodes[0].style.color=h,u.childNodes[1].style.color=h,u.childNodes[2].style.color=h,u.childNodes[3].style.color=h,u.childNodes[4].style.color=h,u.childNodes[5].style.color=h,u.childNodes[6].style.color=h,u.childNodes[7].style.color=h,u.childNodes[0].className="name-column gantt-cell-pointer",u.childNodes[2].className="name-column-resp gantt-cell-disable",u.childNodes[3].className="name-column-begin-date gantt-cell-disable",u.childNodes[5].className="name-column-status gantt-cell-disable",u.childNodes[6].className="name-column-priority gantt-cell-disable"),u.style.display="",this.collection.indexer.push({p:e,m:f,t:undefined,text:l}),this.editBox.isEnable()&&this.editBox.isValidAnchor(e,f,undefined)?(this.editBox.element.style.left=st,this.editBox.element.style.top=(c*g+b|0)+3+"px",this.editBox.element.className="milestone-edit",this.editBox.element.style.display="",u.style.background="#E1E1E1"):this.hit&&this.hit.p===e&&this.hit.m===f&&this.hit.t===undefined&&(u.style.background="#E1E1E1"),++c,ft<c)){d();this.elInner.style.display="";return}if(++w,p.fullscreen||!o[e].m[f].collapse)for(y=0;y<o[e].m[f].t.length;++y)if(!o[e].m[f].t[y].filter){if(w>=ut&&(u=this.collection.elements[c],s=o[e].m[f].t[y],l=s._title,l=l.substring(0,30),v=au(s,f),u.style.top=(c*g+b|0)+"px",u.childNodes[0].textContent=l,u.childNodes[0].title=s._title,u.childNodes[0].style.left="35px",u.childNodes[0].style.fontWeight="",a||(u.childNodes[0].style.color=v),tt&&(u.childNodes[2].style.left=ct,u.childNodes[2].textContent=cu(s,this.noResponsible),a||(u.childNodes[2].style.color=v),r===s._status&&(u.childNodes[2].className="name-column-resp gantt-cell-disable")),vt&&(u.childNodes[3].textContent=s.beginFail?ot:pt(s.beginDate(),nt),u.childNodes[3].style.left=kt,a||(u.childNodes[3].style.color=v),r===s._status&&(u.childNodes[3].className="name-column-begin-date gantt-cell-disable")),it&&(u.childNodes[4].textContent=s.endFail?ot:pt(s.endDate(),nt),u.childNodes[4].style.left=lt,a||(u.childNodes[4].style.color=v),r===s._status&&(u.childNodes[4].className="name-column-end-date gantt-cell-disable")),et&&(u.childNodes[5].style.left=at,k=ASC.Projects.Master.customStatuses.find(function(n){return s._customTaskStatus==n.id}),k||(k=ASC.Projects.Master.customStatuses.find(function(n){return s._status==n.statusType&&n.isDefault})),u.childNodes[5].textContent=k.title),s._priority&&gt&&(u.childNodes[6].textContent=wt,u.childNodes[6].style.left=dt,a||(u.childNodes[6].style.color=v)),a&&(u.childNodes[0].style.color=h,u.childNodes[1].style.color=h,u.childNodes[2].style.color=h,u.childNodes[3].style.color=h,u.childNodes[4].style.color=h,u.childNodes[5].style.color=h,u.childNodes[6].style.color=h,u.childNodes[7].style.color=h,u.childNodes[0].className="name-column gantt-cell-pointer",tt&&(u.childNodes[2].className="name-column-resp gantt-cell-disable"),it&&(u.childNodes[3].className="name-column-begin-date gantt-cell-disable"),it&&(u.childNodes[4].className="name-column-end-date gantt-cell-disable"),et&&(u.childNodes[5].className="name-column-status gantt-cell-disable"),u.childNodes[6].className="name-column-priority gantt-cell-disable"),u.style.display="",this.collection.indexer.push({p:e,m:f,t:y,text:l}),this.editBox.isEnable()&&this.editBox.isValidAnchor(e,f,y)?(this.editBox.element.style.left=rt,this.editBox.element.style.top=(c*g+b|0)+3+"px",this.editBox.element.className="task-edit",this.editBox.element.style.display="",u.style.background="#E1E1E1"):this.hit&&this.hit.p===e&&this.hit.m===f&&this.hit.t===y&&(u.style.background="#E1E1E1"),++c,ft<c)){d();this.elInner.style.display="";return}++w}}if(w>=ut){if(u=this.collection.elements[c],u.style.top=(c*g+b|0)+"px",u.childNodes[0].textContent=ni,u.childNodes[0].title="",u.childNodes[0].style.fontWeight="bold",u.childNodes[0].style.left="26px",u.childNodes[1].textContent=vr(o[e].t),u.childNodes[7].style.display="",o[e].t.length?(u.childNodes[7].className=o[e].collapse?"button-colapse-close":"button-colapse-open",u.childNodes[7].style.display=""):u.childNodes[7].style.display="none",a?(u.childNodes[0].style.color=h,u.childNodes[1].style.color=h,u.childNodes[0].className="name-column gantt-cell-disable"):u.childNodes[0].className="name-column gantt-cell-disable",u.style.display="",this.collection.indexer.push({p:e,m:undefined,t:undefined,text:l,disabled:!0,freeTasks:!0}),++c,ft<c){d();this.elInner.style.display="";return}++w}if(++w,!o[e].collapse)for(y=0;y<o[e].t.length;++y)if(!o[e].t[y].filter){if(w>=ut&&(u=this.collection.elements[c],s=o[e].t[y],l=s._title,l=l.substring(0,30),v=au(s,-1),u.style.top=(c*g+b|0)+"px",u.childNodes[0].textContent=l,u.childNodes[0].title=s._title,u.childNodes[0].style.left="35px",u.childNodes[0].style.fontWeight="",a||(u.childNodes[0].style.color=v),tt&&(u.childNodes[2].style.left=ct,u.childNodes[2].textContent=cu(s,this.noResponsible),a||(u.childNodes[2].style.color=v),r===s._status&&(u.childNodes[2].className="name-column-resp gantt-cell-disable")),vt&&(u.childNodes[3].textContent=s.beginFail?ot:pt(s.beginDate(),nt),u.childNodes[3].style.left=kt,a||(u.childNodes[3].style.color=v),r===s._status&&(u.childNodes[3].className="name-column-begin-date gantt-cell-disable")),it&&(u.childNodes[4].textContent=s.endFail?ot:pt(s.endDate(),nt),u.childNodes[4].style.left=lt,a||(u.childNodes[4].style.color=v),r===s._status&&(u.childNodes[4].className="name-column-end-date gantt-cell-disable")),et&&(u.childNodes[5].style.left=at,k=lr(function(n){return s._customTaskStatus==n.id}),k||(k=lr(function(n){return s._status==n.statusType&&n.isDefault})),u.childNodes[5].textContent=k.title),s._priority&&gt&&(u.childNodes[6].textContent=wt,u.childNodes[6].style.left=dt,u.childNodes[6].style.color=v),a&&(u.childNodes[0].style.color=h,u.childNodes[1].style.color=h,u.childNodes[2].style.color=h,u.childNodes[3].style.color=h,u.childNodes[4].style.color=h,u.childNodes[5].style.color=h,u.childNodes[0].className="name-column gantt-cell-pointer",tt&&(u.childNodes[2].className="name-column-resp gantt-cell-disable"),vt&&(u.childNodes[3].className="name-column-begin-date gantt-cell-disable"),it&&(u.childNodes[4].className="name-column-end-date gantt-cell-disable"),et&&(u.childNodes[5].className="name-column-status gantt-cell-disable"),u.childNodes[6].className="name-column-priority gantt-cell-disable"),u.style.display="",this.collection.indexer.push({p:e,m:undefined,t:y,text:l}),this.editBox.isEnable()&&this.editBox.isValidAnchor(e,undefined,y)?(this.editBox.element.style.left=rt,this.editBox.element.style.top=(c*g+b|0)+3+"px",this.editBox.element.className="task-edit",this.editBox.element.style.display="",u.style.background="#E1E1E1"):this.hit&&this.hit.p===e&&this.hit.m===undefined&&this.hit.t===y&&(u.style.background="#E1E1E1"),++c,ft<c)){d();this.elInner.style.display="";return}++w}}}d()},getWidth:function(){return this.width},addRowAvailable:function(t){for(var r=0,i=0,i=0;i<this.visibleRows.length;++i)r+=this.visibleRows[i].width+this.distanceBetweenCells;if(undefined===t){for(this.visibleRows=[],i=1;i<this.rows.length;++i)this.rows[i].posX=-1e3,this.rows[i].el.style.left=this.rows[i].posX+"px",this.hideVisibleRow(i,!0);this.btnHiddenFlds.style.display="none"}else t==="Responsibility"?(this.visibleRows.push({width:this.rows[1].minWidth,name:"Responsibility"}),this.rows[1].posX=this.rows[0].minWidth+r,this.rows[1].translate=n.Gantt.Localize_strings.responsibles2||"Responsible(-s)",this.rows[1].el.style.left=this.rows[1].posX+this.paddingLeftCellContent+"px",this.rows[1].el.style.width=this.rows[1].minWidth+"px",this.rows[1].el.childNodes[0].textContent=this.rows[1].translate):t==="BeginDate"?(this.visibleRows.push({width:this.rows[2].minWidth,name:"BeginDate"}),this.rows[2].posX=this.rows[0].minWidth+r,this.rows[2].translate=n.Gantt.Localize_strings.beginDate||"Begin Date",this.rows[2].el.style.left=this.rows[2].posX+this.paddingLeftCellContent+"px",this.rows[2].el.style.width=this.rows[2].minWidth+"px",this.rows[2].el.childNodes[0].textContent=this.rows[2].translate):t==="EndDate"?(this.visibleRows.push({width:this.rows[3].minWidth,name:"EndDate"}),this.rows[3].posX=this.rows[0].minWidth+r,this.rows[3].translate=n.Gantt.Localize_strings.endDate||"End Date",this.rows[3].el.style.left=this.rows[3].posX+this.paddingLeftCellContent+"px",this.rows[3].el.style.width=this.rows[3].minWidth+"px",this.rows[3].el.childNodes[0].textContent=this.rows[3].translate):t==="Status"?(this.visibleRows.push({width:this.rows[4].minWidth,name:"Status"}),this.rows[4].posX=this.rows[0].minWidth+r,this.rows[4].translate=n.Gantt.Localize_strings.status||"Status",this.rows[4].el.style.left=this.rows[4].posX+this.paddingLeftCellContent+"px",this.rows[4].el.style.width=this.rows[4].minWidth+"px",this.rows[4].el.childNodes[0].textContent=this.rows[4].translate):t==="Priority"&&(this.visibleRows.push({width:this.rows[5].minWidth,name:"Priority"}),this.rows[5].posX=this.rows[0].minWidth+r,this.rows[5].translate=n.Gantt.Localize_strings.priotity||"Priotity",this.rows[5].el.style.left=this.rows[5].posX+this.paddingLeftCellContent+"px",this.rows[5].el.style.width=this.rows[5].minWidth+"px",this.rows[5].el.childNodes[0].textContent=this.rows[5].translate);for(r=0,i=0;i<this.visibleRows.length;++i)r+=this.visibleRows[i].width+this.distanceBetweenCells;this.width=this.rows[0].minWidth+r+this.btnFlds.offsetWidth+this.distanceBetweenCells;this.maxWidth=this.width;this.el.style.width=this.width+"px";this.header.style.width=this.width+"px";this.btnFlds.style.left=this.width-this.btnFlds.offsetWidth-14+"px";this.btnFldsFake.style.left=this.btnFlds.style.left;this.pfX=this.btnFlds.offsetLeft+this.btnFlds.offsetWidth+this.timeline.ctx.canvas.offsetLeft;this.pfY=this.btnFlds.offsetTop+this.btnFlds.offsetHeight+this.timeline.ctx.canvas.offsetTop;this.splitter.style.left=this.width-16+"px"},deleteAvailableRow:function(n){var t=[],i=0,r=0;for(t.push(undefined);i<this.visibleRows.length;++i)n!==this.visibleRows[i].name&&t.push(this.visibleRows[i].name);for(;r<t.length;++r)this.addRowAvailable(t[r]);this.rebuildContent(this.timeline.rightScroll.value());this.timeline.needUpdate=!0},getAvailableRows:function(){for(var n=0,t=[];n<this.visibleRows.length;++n)t.push(this.visibleRows[n].name);return t},showHiddenRows:function(n){function e(n){for(var t=u.rows.length-1;t>=0;--t)if(u.rows[t].name===n)return u.rows[t];return null}var t=0,u=this,r,i,f;if(n){if(n.length!==this.visibleRows.length)for(t=0;t<this.visibleRows.length;++t)this.hideVisibleRow(this.visibleRows[t].name,!1);for(t=0;t<n.length;++t)this.hideVisibleRow(n[t],!0);for(r=0,i=0,i=0;i<this.visibleRows.length;++i)f=e(this.visibleRows[i].name),f&&!f.isHidden&&(r+=this.visibleRows[i].width+this.distanceBetweenCells);n.length!==this.visibleRows.length&&(r+=22,this.btnHiddenFlds.style.display="",this.btnHiddenFlds.style.left=this.rows[0].minWidth+r-this.btnFlds.offsetWidth-9+"px");this.width=this.rows[0].minWidth+r+this.btnFlds.offsetWidth+this.distanceBetweenCells;this.el.style.width=this.width+"px";this.header.style.width=this.width+"px";this.btnFlds.style.left=this.width-this.btnFlds.offsetWidth-14+"px";this.btnFldsFake.style.left=this.btnFlds.style.left;this.pfX=this.btnFlds.offsetLeft+this.btnFlds.offsetWidth+this.timeline.ctx.canvas.offsetLeft;this.pfY=this.btnFlds.offsetTop+this.btnFlds.offsetHeight+this.timeline.ctx.canvas.offsetTop;this.pfHX=this.btnHiddenFlds.offsetLeft+this.btnHiddenFlds.offsetWidth+this.timeline.ctx.canvas.offsetLeft;this.pfHY=this.btnHiddenFlds.offsetTop+this.btnHiddenFlds.offsetHeight+this.timeline.ctx.canvas.offsetTop;this.splitter.style.left=this.width-16+"px"}},hideVisibleRow:function(n,t){n==="Responsibility"||1===n?(this.rows[1].el.style.display=t?"":"none",this.rows[1].isHidden=!t):n==="BeginDate"||2===n?(this.rows[2].el.style.display=t?"":"none",this.rows[2].isHidden=!t):n==="EndDate"||3===n?(this.rows[3].el.style.display=t?"":"none",this.rows[3].isHidden=!t):n==="Status"||4===n?(this.rows[4].el.style.display=t?"":"none",this.rows[4].isHidden=!t):(n==="Priority"||5===n)&&(this.rows[5].el.style.display=t?"":"none",this.rows[5].isHidden=!t)},getHiddenRows:function(){function u(n){for(var t=i.rows.length-1;t>=0;--t)if(i.rows[t].name===n)return i.rows[t];return null}for(var t=null,n=0,r=[],i=this;n<this.visibleRows.length;++n)t=u(this.visibleRows[n].name),t&&t.isHidden&&r.push(this.visibleRows[n].name);return r},getVisibleRows:function(n){function f(n){for(var t=i.rows.length-1;t>=0;--t)if(i.rows[t].name===n)return i.rows[t];return null}for(var r,u=[],i=this,t=0;t<this.visibleRows.length;++t)if(r=f(this.visibleRows[t].name),r&&!r.isHidden){if(n===this.visibleRows[t].name)continue;u.push(this.visibleRows[t].name)}return u},getRowWithName:function(n){for(var t=this.rows.length-1;t>=0;--t)if(this.rows[t].name===n)return this.rows[t];return null},showEditBox:function(n){var t=n.timeline,f;if(t.readMode||(f=ot(n.select),t.editBox.cancel(),undefined!==n.select.p&&p!==t.storage.getProject(n.select.p).status()))return!1;n.select=ot(f);var u=null,i=null,e=0;return(undefined!==n.select.t?(i=t.storage.getTask(n.select.p,n.select.m,n.select.t),i&&(r!==i._status?(this.editBox.setBoldText(!1),u=t.storage.taskIds(n.select.p,n.select.m,n.select.t),t._undoManager.add(ci,{p:n.select.p,m:n.select.m,t:i,index:n.select.t,taskId:u.t,milestoneId:u.m,projectId:u.p,silentUpdateMode:!0})):(i=null,this.select=undefined))):(i=t.storage.getMilestone(n.select.p,n.select.m),i&&(r-1!==i._status?(n.editBox.setBoldText(!0),e=2,u=t.storage.milestoneIds(n.select.p,n.select.m),t._undoManager.add(bi,{p:this.select.p,m:n.select.m,t:i,index:n.select.t,taskId:u.t,milestoneId:u.m,projectId:u.p,silentUpdateMode:!0})):(i=null,this.select=undefined))),i)?(n.editBox.element.style.width="175px",n.editBox.element.style.height=t.itemMargin*.6+"px",n.editBox.setReference(i,this.select.p,this.select.m,this.select.t),n.editBox.setValue(i._title),t.hitTask=undefined===n.editBox.anchor.t?-1:n.editBox.anchor.t,t.hitMilestone=undefined===n.editBox.anchor.m?-1:n.editBox.anchor.m,t.hitProject=n.editBox.anchor.p,t.needUpdate=!0,n.editBox.show(!0),n.rebuildContent(undefined),!0):!1},closeEditing:function(n,t){(this.editBox.close(),this.select&&this.select.line&&(this.collection.elements[this.select.line].style.background="#F3F3F3",t))||(this.select=undefined,this.hit=undefined,n&&this.rebuildContent(undefined))},updateTimeLineHitLine:function(){this.hit&&this.hit.line?(this.timeline.editBox.isEnable()||(this.timeline.hitTask=undefined===this.hit.t?-1:this.hit.t,this.timeline.hitMilestone=undefined===this.hit.m?-1:this.hit.m,this.timeline.hitProject=this.hit.p),this.timeline.needUpdate=!0):(this.timeline.hitTask=-1,this.timeline.hitMilestone=-1,this.timeline.hitProject=-1,this.timeline.needUpdate=!0)},highlightElement:function(n,t,i){var u,f;for(this.hit&&this.hit.line&&(this.collection.elements[this.hit.line].style.background="#F3F3F3",this.collection.elements[this.hit.line].childNodes[8].style.display="none",this.hit=undefined,undefined!==this.dragIndex&&(this.collection.elements[this.dragIndex].childNodes[8].style.display="none",this.dragIndex=undefined)),this.timeline.editBox.isEnable()&&(n=this.timeline.editBox.p,t=-1===this.timeline.editBox.m?undefined:this.timeline.editBox.m,i=-1===this.timeline.editBox.t?undefined:this.timeline.editBox.t),u=this.collection.indexer.length-1;u>=0;--u)if(this.collection.indexer[u].p===n&&this.collection.indexer[u].m===t&&this.collection.indexer[u].t===i){this.hit={p:n,m:t,t:i,line:u};this.collection.elements[u].style.background="#E1E1E1";undefined===this.dragMode&&undefined!==this.hit.t&&(f=this.timeline.storage.getTask(this.hit.p,this.hit.m,this.hit.t),r!==f._status&&(this.collection.elements[u].childNodes[8].style.display=""));undefined!==this.dragIndex&&(this.collection.elements[this.dragIndex].childNodes[8].style.display="none",this.dragIndex=undefined);return}},clearHighlightElement:function(){(-1!==this.timeline.hitTask||-1!==this.timeline.hitMilestone||-1!==this.timeline.hitProject)&&(this.timeline.hitTask=-1,this.timeline.hitMilestone=-1,this.timeline.hitProject=-1,this.timeline.needUpdate=!0);undefined!==this.dragIndex&&(this.collection.elements[this.dragIndex].childNodes[8].style.display="none",this.dragIndex=undefined)}};pf.prototype={model:undefined,panel:undefined,onfieldsfilter:null,onhiddenfieldsfilter:null,onchangetimes:null,init:function(){this.panel=new cs(this.timeline,this.baseElement,this.model);this.panel&&this.panel.init(this)},scrollContent:function(n){this.panel&&this.panel.rebuildContent(n)},rebuildContent:function(){this.panel&&this.panel.rebuildContent(undefined)},addRowsAvailable:function(n){if(this.panel.addRowAvailable(undefined),n)for(var t=0;t<n.length;++t)this.panel.addRowAvailable(n[t]);this.panel.rebuildContent(this.timeline.rightScroll.value());this.timeline.needUpdate=!0},showHiddenRows:function(n){this.panel.showHiddenRows(n);this.panel.rebuildContent(this.timeline.rightScroll.value());this.timeline.needUpdate=!0},getPanel:function(){return this.panel},clearFocus:function(n,t){this.panel.closeEditing(n,t)},updateFocus:function(n,t,i){this.panel.highlightElement(n,t,i)},clearHighlight:function(){undefined!==this.panel.dragIndex&&(this.panel.collection.elements[this.panel.dragIndex].childNodes[8].style.display="none",this.panel.dragIndex=undefined)},elementCentering:function(n){var e,o,s,f,u,i,t;if(this.panel.closeEditing(),undefined===n.t&&undefined!==n.m&&undefined!==n.p&&(e=this.timeline.storage.getMilestone(n.p,n.m),this.timeline.animator.moveCenterToX(e.endTime)),undefined!==n.t&&undefined!==n.m&&undefined!==n.p&&(o=this.timeline.storage.getTask(n.p,n.m,n.t),this.timeline.animator.moveCenterToX(o.beginTime)),undefined!==n.t&&undefined===n.m&&undefined!==n.p&&(s=this.timeline.storage.getTask(n.p,undefined,n.t),this.timeline.animator.moveCenterToX(s.beginTime)),undefined===n.t&&undefined===n.m&&undefined!==n.p){for(i=this.timeline,t=this.timeline.storage.getProject(n.p),f=0;f<t.m.length;++f)for(u=0;u<t.m[f].t.length;++u)if(r!=t.m[f].t[u].status()){t.setFullCollapse(!1);t.m[f].setCollapse(!1);i.updateData();i.needUpdateContent=!0;i.drawScene();i.viewController().centeringElement(t.m[f].t[u].id(),!1,function(){i.updateContent()});return}for(u=0;u<t.t.length;++u)if(r!=t.t[u].status()){t.setCollapse(!1);t.setFullCollapse(!1);i.updateData();i.needUpdateContent=!0;i.drawScene();i.viewController().centeringElement(t.t[u].id(),!1,function(){i.updateContent()});return}}},changeResponsibles:function(n,t,i){if(undefined!==t.p&&p!==this.timeline.storage.getProject(t.p).status())return!1;this.panel.closeEditing();var u=null,s=null,e=i.getBoundingClientRect(),o={left:e.left,top:e.top+e.height*1.2},f=this.timeline.handlers[hf];return f?undefined===t.t&&undefined!==t.m&&undefined!==t.p?(s=this.timeline.storage.getMilestone(t.p,t.m),r-1===this.timeline.storage.p[t.p].m[t.m].status())?!1:(this.timeline._modelController.statusElement={p:t.p,m:t.m,t:undefined,status:this.timeline.storage.p[t.p].m[t.m].status(),ref:this.timeline.storage.p[t.p].m[t.m],ids:this.timeline.storage.milestoneIds(t.p,t.m)},st(n),f(s,o,!0),!0):undefined!==t.t&&undefined!==t.m&&undefined!==t.p?(u=this.timeline.storage.getTask(t.p,t.m,t.t),r===u.status())?!1:(this.timeline._modelController.statusElement={p:t.p,m:t.m,t:t.t,status:u.status(),ref:u,isTask:!0,ids:this.timeline.storage.taskIds(t.p,t.m,t.t)},f(u,o,!0),!0):undefined!==t.t&&undefined===t.m&&undefined!==t.p?(u=this.timeline.storage.getTask(t.p,undefined,t.t),r===u.status())?!1:(this.timeline._modelController.statusElement={p:t.p,m:t.m,t:t.t,status:u.status(),ref:u,isTask:!0,ids:this.timeline.storage.taskIds(t.p,t.m,t.t)},f(u,o,!0),!0):!1:!1},changeStatus:function(n,t,i){if(this.panel.closeEditing(),undefined!==t.p&&p!==this.timeline.storage.getProject(t.p).status())return!1;var r=null,o=null,u=this.timeline.handlers[oo],f=i.getBoundingClientRect(),e={left:f.left,top:f.top+f.height*1.2};return u?undefined===t.t&&undefined!==t.m&&undefined!==t.p?(o=this.timeline.storage.getMilestone(t.p,t.m),this.timeline._modelController.statusElement={p:t.p,m:t.m,t:undefined,status:this.timeline.storage.p[t.p].m[t.m].status(),ref:this.timeline.storage.p[t.p].m[t.m],ids:this.timeline.storage.milestoneIds(t.p,t.m)},u(o,e,!0),!0):undefined!==t.t&&undefined!==t.m&&undefined!==t.p?(r=this.timeline.storage.getTask(t.p,t.m,t.t),r.project=this.timeline.storage.getProject(t.p),this.timeline._modelController.statusElement={p:t.p,m:t.m,t:t.t,status:r.status(),ref:r,isTask:!0,ids:this.timeline.storage.taskIds(t.p,t.m,t.t)},u=this.timeline.handlers[so],u(r,e,!0),delete r.project,!0):undefined!==t.t&&undefined===t.m&&undefined!==t.p?(r=this.timeline.storage.getTask(t.p,undefined,t.t),r.project=this.timeline.storage.getProject(t.p),this.timeline._modelController.statusElement={p:t.p,m:t.m,t:t.t,status:r.status(),ref:r,isTask:!0,ids:this.timeline.storage.taskIds(t.p,t.m,t.t)},u=this.timeline.handlers[so],u(r,e,!0),delete r.project,!0):!1:!1},changeTimes:function(n,t,i,u){if(this.onchangetimes){if(this.panel.closeEditing(),undefined!==t.p&&p!==this.timeline.storage.getProject(t.p).status())return!1;var f=null,s=null,h=null,e=i.getBoundingClientRect(),o={left:e.left,top:e.top+e.height*1.2};if(undefined===t.t&&undefined!==t.m&&undefined!==t.p){if(s=this.timeline.storage.getMilestone(t.p,t.m),r-1===this.timeline.storage.p[t.p].m[t.m].status())return!1;this.timeline._modelController.statusElement={p:t.p,m:t.m,t:undefined,status:this.timeline.storage.p[t.p].m[t.m].status(),ref:this.timeline.storage.p[t.p].m[t.m],ids:this.timeline.storage.milestoneIds(t.p,t.m)};this.onchangetimes(o,s,!1);return!0}if(undefined!==t.t&&undefined!==t.m&&undefined!==t.p){if(f=this.timeline.storage.getTask(t.p,t.m,t.t),r===f.status())return!1;if(this.timeline._modelController.statusElement={p:t.p,m:t.m,t:t.t,status:f.status(),ref:f,isTask:!0,ids:this.timeline.storage.taskIds(t.p,t.m,t.t)},h=this.timeline.handlers[oo],h){this.onchangetimes(o,f,u);return!0}}if(undefined!==t.t&&undefined===t.m&&undefined!==t.p){if(f=this.timeline.storage.getTask(t.p,undefined,t.t),r===f.status())return!1;this.timeline._modelController.statusElement={p:t.p,m:t.m,t:t.t,status:f.status(),ref:f,isTask:!0,ids:this.timeline.storage.taskIds(t.p,t.m,t.t)};this.onchangetimes(o,f,u);return!0}}return!1},collapseElement:function(n,t){if(this.timeline.editBox.isEnable())return!1;var r=null,i=null;return undefined===t.t&&undefined!==t.m&&undefined!==t.p?(r=this.timeline.storage.getMilestone(t.p,t.m),n.ctrlKey||n.metaKey?this.timeline.viewController().collapse(!r.collapse):r.setCollapse(!r.collapse),this.timeline.rightScroll.save(!0),this.timeline.needUpdateContent=!0,this.timeline.updateData(),!0):undefined!==t.p&&undefined!==t.freeTasks?(i=this.timeline.storage.getProject(t.p),n.ctrlKey||n.metaKey?this.timeline.viewController().collapse(!i.collapse):i.setCollapse(!i.collapse),this.timeline.rightScroll.save(!0),this.timeline.needUpdateContent=!0,this.timeline.updateData(),!0):undefined!==t.p&&undefined===t.freeTasks&&undefined===t.t&&undefined===t.m?(i=this.timeline.storage.getProject(t.p),n.ctrlKey||n.metaKey?this.timeline.viewController().collapseProjects(!i.fullCollapse):i.setFullCollapse(!i.fullCollapse),this.timeline.rightScroll.save(!0),this.timeline.needUpdateContent=!0,this.timeline.updateData(),!0):!1},showElementMenu:function(n,t,i){if(p!==this.timeline.storage.getProject(t.p).status()&&i)return!1;var r=null,u=null,f=this.timeline.handlers[vt],o=i.getBoundingClientRect(),e={left:n.clientX-this.timeline.ctx.canvas.offsetLeft,top:o.top+o.height*1};return f?(this.panel.closeEditing(),undefined===t.t&&undefined!==t.m&&undefined!==t.p&&(u=this.timeline.storage.getMilestone(t.p,t.m),this.timeline.handlers[vt]&&!this.timeline.readMode))?(this.timeline.modelController().statusElement={p:t.p,m:t.m,t:undefined,ids:this.timeline.storage.milestoneIds(t.p,t.m),isTask:!1,milestone:u,ref:u},f(e,u,!1,this.timeline.storage.getProject(t.p).id()),!0):undefined!==t.t&&undefined!==t.m&&undefined!==t.p&&(r=this.timeline.storage.getTask(t.p,t.m,t.t),this.timeline.handlers[vt]&&!this.timeline.readMode)?(this.timeline.modelController().statusElement={p:t.p,m:t.m,t:t.t,ids:this.timeline.storage.taskIds(t.p,t.m,t.t),isTask:!0,task:r,ref:r},f(e,r,!0,this.timeline.storage.getProject(t.p).id()),!0):undefined!==t.t&&undefined===t.m&&undefined!==t.p&&(r=this.timeline.storage.getTask(t.p,undefined,t.t),this.timeline.handlers[vt]&&!this.timeline.readMode)?(this.timeline.modelController().statusElement={p:t.p,m:undefined,t:t.t,ids:this.timeline.storage.taskIds(t.p,t.m,t.t),isTask:!0,task:r,ref:r},f(e,r,!0,this.timeline.storage.getProject(t.p).id()),!0):!1:!1}};wf.prototype={init:function(n){this.timeline=n;this.op=[];this.ind=-1;this.tempOperation=null},reset:function(){this.front=null;this.op=[];this.ind=-1;this._updateDebug();this._updateUI()},currentOperation:function(){return!this.op||!this.op.length?null:this.op[this.ind]},add:function(n,t){if(ou===n&&this.op.length&&this.op.last().id===ou){this._updateDebug();return}++this.ind;this._sliceTop();this.op.push({id:n,arg:ot(t)});this.op.length<2&&this._updateUI();this._updateDebug()},addTempOperation:function(n,t){this.tempOperation={id:n,arg:ot(t)}},deleteTempOperation:function(){this.tempOperation=null},applyTempOperation:function(){this.tempOperation&&(this.add(this.tempOperation.id,this.tempOperation.arg),this.tempOperation=null)},performTop:function(n){-1!==this.ind&&this.timeline&&this.op.length&&(this.perform(this.ind,undefined,n),this._updateDebug(),this._updateUI())},updateOperation:function(n,t,i){if(-1!==this.ind&&this.timeline&&this.op.length){if(t&&this.ind<this.op.length&&this.ind>=0){var r=this.op[this.ind];switch(r.id){case ui:t._isMilestone||(r.arg.oldTitle=r.arg.t._title,r.arg.curTitle=t._title,r.arg.t.setTimes(t.beginTime,t.endTime),r.arg.t._title=t._title);break;case hi:t._isMilestone&&(r.arg.oldTitle=r.arg.t._title,r.arg.curTitle=t._title,r.arg.t._title=t._title);break;case bi:r.arg.oldTitle=r.arg.t._title;r.arg.curTitle=t._title;break;case ci:r.arg.oldTitle=r.arg.t._title;r.arg.curTitle=t._title}}this.perform(this.ind,undefined,n,t,i);this._updateDebug();this._updateUI()}},perform:function(n,t,i,r,u){if(!(n>this.op.length-1)&&!(n<0)){var l=null,o,s,a,v,h,c,b=!1,y=!1,p=!1,w=!1,e=this.timeline.storage,f=this.op[n];switch(f.id){case ui:t?this.timeline.handlers[dr]&&this.timeline.handlers[dr](f.arg.projectId,f.arg.milestoneId,f.arg.taskId,r?r:f.arg.t,f.arg.linksToRemove):this.timeline.handlers[br]&&this.timeline.handlers[br](f.arg.projectId,f.arg.milestoneId,f.arg.taskId,r?r:f.arg.t,f.arg.linksToRemove);break;case cf:t?this.timeline.handlers[br]&&this.timeline.handlers[br](f.arg.projectId,f.arg.milestoneId,f.arg.taskId,r?r:f.arg.t,f.arg.linksToRemove):this.timeline.handlers[dr]&&this.timeline.handlers[dr](f.arg.projectId,f.arg.milestoneId,f.arg.taskId,r?r:f.arg.t,f.arg.linksToRemove);break;case hi:t?this.timeline.handlers[gr]&&this.timeline.handlers[gr](f.arg.projectId,f.arg.milestoneId,f.arg.t):this.timeline.handlers[kr]&&this.timeline.handlers[kr](f.arg.projectId,f.arg.milestoneId,f.arg.t);break;case ru:t?this.timeline.handlers[kr]&&this.timeline.handlers[kr](f.arg.projectId,f.arg.milestoneId,f.arg.t):this.timeline.handlers[gr]&&this.timeline.handlers[gr](f.arg.projectId,f.arg.milestoneId,f.arg.t);break;case ci:r||(t?(o=f.arg.t._title,f.arg.t._title=f.arg.oldTitle):(o=f.arg.t._title,f.arg.t._title=f.arg.curTitle));this.timeline.handlers[ge]&&this.timeline.handlers[ge](f.arg.projectId,f.arg.milestoneId,f.arg.taskId,r?r:f.arg.t);r||(f.arg.t._title=t?o:o);break;case bi:r||(t?(o=f.arg.t._title,f.arg.t._title=f.arg.oldTitle):(o=f.arg.t._title,f.arg.t._title=f.arg.curTitle));this.timeline.handlers[no]&&this.timeline.handlers[no](f.arg.projectId,f.arg.milestoneId,r?r:f.arg.t);r||(f.arg.t._title=t?o:o);break;case ri:if(u)l=[],u.left&&u.left.walkElements(r?r:f.arg.t,function(n,t){t&&t.change&&!0===t.change&&(l.push(t),b=!0)}),u.right&&u.right.walkElements(r?r:f.arg.t,function(n,t){t&&t.change&&!0===t.change&&(l.push(t),b=!0)});else if(u=f.arg.queryMoveLinks,u&&u.length)for(l=[],n=0;n<u.length;++n)l.push(e.getTask(u[n].p,u[n].m,u[n].t));if(i&&!b&&(a=e.getTask(f.arg.p,f.arg.m,f.arg.index).beginTime,v=e.getTask(f.arg.p,f.arg.m,f.arg.index).endTime,a===f.arg.t.beginTime&&v===f.arg.t.endTime)){this.flushPop(0);return}r||(t?(y=f.arg.t.endFail,p=f.arg.t.oneDay,w=f.arg.t.beginFail,f.arg.t.endFail=e.getTask(f.arg.p,f.arg.m,f.arg.index).endFail,f.arg.t.oneDay=e.getTask(f.arg.p,f.arg.m,f.arg.index).oneDay,f.arg.t.beginFail=e.getTask(f.arg.p,f.arg.m,f.arg.index).beginFail):(y=f.arg.t.endFail,f.arg.t.endFail=e.getTask(f.arg.p,f.arg.m,f.arg.index).endFail,p=f.arg.t.oneDay,w=f.arg.t.beginFail,a=f.arg.t.beginTime,v=f.arg.t.endTime,f.arg.t.setTimes(e.getTask(f.arg.p,f.arg.m,f.arg.index).beginTime,e.getTask(f.arg.p,f.arg.m,f.arg.index).endTime),f.arg.t.oneDay=e.getTask(f.arg.p,f.arg.m,f.arg.index).oneDay,f.arg.t.beginFail=e.getTask(f.arg.p,f.arg.m,f.arg.index).beginFail));this.timeline.handlers[nu]&&this.timeline.handlers[nu](f.arg.projectId,f.arg.milestoneId,f.arg.taskId,r?r:f.arg.t,l);r||(t?(f.arg.t.endFail=y,f.arg.t.oneDay=p,f.arg.t.beginFail=w):(f.arg.t.endFail=y,f.arg.t.setTimes(a,v),f.arg.t.oneDay=p,f.arg.t.beginFail=w));break;case or:if(i&&(a=e.getMilestone(f.arg.p,f.arg.m).beginTime,v=e.getMilestone(f.arg.p,f.arg.m).endTime,a===f.arg.t.beginTime&&v===f.arg.t.endTime)){this.flushPop(0);return}this.timeline.handlers[nu]&&this.timeline.handlers[nu](f.arg.projectId,f.arg.milestoneId,undefined,r?r:f.arg.t);break;case dt:this.timeline.handlers[ro]&&this.timeline.handlers[ro](f.arg.projectId,f.arg.milestoneId,f.arg.taskId,f.arg.projectToId,f.arg.milestoneToId,r?r:f.arg.t,f.arg.linksToRemove,t);break;case uu:this.timeline.handlers[uo]&&this.timeline.handlers[uo](t?f.arg.sourceMilestone:f.arg.destMilestone,f.arg.tasksIds);break;case sr:r||(t?(s=f.arg.t._status,f.arg.t._status=f.arg.oldStatus):(s=f.arg.t._status,f.arg.t._status=f.arg.newStatus));this.timeline.handlers[to]&&this.timeline.handlers[to](f.arg.projectId,f.arg.milestoneId,f.arg.taskId,r?r:f.arg.t);r||(f.arg.t._status=t?s:s);break;case fu:r||(t?(s=f.arg.t._status,f.arg.t._status=f.arg.oldStatus):(s=f.arg.t._status,f.arg.t._status=f.arg.newStatus));this.timeline.handlers[io]&&this.timeline.handlers[io](f.arg.projectId,f.arg.milestoneId,r?r:f.arg.t);r||(f.arg.t._status=t?s:s);break;case hr:t?this.timeline.handlers[pi]&&(r?this.timeline.handlers[pi](r):(c=f.arg.link.parentTaskId||f.arg.link.parentTaskId,h=f.arg.link.dependenceTaskId||f.arg.link.dependenceTaskId,this.timeline.handlers[pi](f.arg.link,e.taskWithId(h).ref,e.taskWithId(c).ref))):this.timeline.handlers[yi]&&(r?this.timeline.handlers[yi](r):(c=f.arg.link.parentTaskId||f.arg.link.parentTaskId,h=f.arg.link.dependenceTaskId||f.arg.link.dependenceTaskId,this.timeline.handlers[yi](f.arg.link,e.taskWithId(h).ref,e.taskWithId(c).ref)));break;case eu:t?this.timeline.handlers[yi]&&(r?this.timeline.handlers[yi](r):(c=f.arg.link.parentTaskId||f.arg.link.parentTaskId,h=f.arg.link.dependenceTaskId||f.arg.link.dependenceTaskId,this.timeline.handlers[yi](f.arg.link,e.taskWithId(h).ref,e.taskWithId(c).ref))):this.timeline.handlers[pi]&&(r?this.timeline.handlers[pi](r):(c=f.arg.link.parentTaskId||f.arg.link.parentTaskId,h=f.arg.link.dependenceTaskId||f.arg.link.dependenceTaskId,this.timeline.handlers[pi](f.arg.link,e.taskWithId(h).ref,e.taskWithId(c).ref)));break;case ki:i||this.timeline.handlers[fo]&&this.timeline.handlers[fo](r)}this._updateDebug();this._updateUI()}},flushPop:function(){-1!==this.ind&&this.timeline&&this.op.length&&(--this.ind,this.op.splice(this.op.length-1,1),this._updateDebug(),this._updateUI())},flushTopDummy:function(){return this.op.length&&this.op[this.op.length-1].id===ou?(this.flushPop(0),this._updateDebug(),!0):!1},undo:function(){var a,k,s,u;if(this.timeline.editBox.enable&&this.timeline.editBox.cancel(!0),this.timeline.leftPanelController().clearFocus(),-1===this.ind||!this.timeline||!this.op.length){this._updateUI();return}var t=this.timeline.storage,n=this.op[this.ind],h,i,r,f,o,e,c=null,l;switch(n.id){case ui:this.timeline.rightScroll.save();t.projects()[n.arg.p].removeTask(n.arg.index,n.arg.m);break;case cf:if(this.timeline.rightScroll.save(),t.addTaskWithIndex(n.arg.t,n.arg.index),o=n.arg.linksToRemove.length,undefined!==n.arg.m)for(r=0;r<o;++r)f=n.arg.linksToRemove[r],f.link.dependenceTaskId!==n.arg.taskId&&(i=t.p[n.arg.p].m[n.arg.m].t[f.ind],i.links.splice(f.index,1,f.link));else for(r=0;r<o;++r)f=n.arg.linksToRemove[r],f.link.dependenceTaskId!==n.arg.taskId&&(i=t.p[n.arg.p].t[f.ind],i.links.splice(f.index,1,f.link));break;case ci:a=t.getTask(n.arg.p,n.arg.m,n.arg.index)._title;t.getTask(n.arg.p,n.arg.m,n.arg.index)._title=n.arg.t._title;n.arg.t._title=a;break;case hi:this.timeline.rightScroll.save();t.p[n.arg.p].removeMilestone(n.arg.index);break;case ru:this.timeline.rightScroll.save();t.p[n.arg.p].t.splice(t.p[n.arg.p].t.length-n.arg.t.t.length,n.arg.t.t.length);t.addMilestoneWithIndex(n.arg.t,n.arg.index);break;case bi:a=t.getMilestone(n.arg.p,n.arg.m)._title;t.getMilestone(n.arg.p,n.arg.m)._title=n.arg.t._title;n.arg.t._title=a;break;case ri:var v=t.getTask(n.arg.p,n.arg.m,n.arg.index).beginTime,y=t.getTask(n.arg.p,n.arg.m,n.arg.index).endTime,p=t.getTask(n.arg.p,n.arg.m,n.arg.index).endFail,w=t.getTask(n.arg.p,n.arg.m,n.arg.index).oneDay,b=t.getTask(n.arg.p,n.arg.m,n.arg.index).beginFail;if(t.getTask(n.arg.p,n.arg.m,n.arg.index).setTimes(n.arg.t.beginTime,n.arg.t.endTime),t.getTask(n.arg.p,n.arg.m,n.arg.index).endFail=n.arg.t.endFail,t.getTask(n.arg.p,n.arg.m,n.arg.index).oneDay=n.arg.t.oneDay,t.getTask(n.arg.p,n.arg.m,n.arg.index).beginFail=n.arg.t.beginFail,n.arg.t.beginTime=v,n.arg.t.endTime=y,n.arg.t.endFail=p,n.arg.t.oneDay=w,n.arg.t.beginFail=b,c=n.arg.queryMoveLinks,c)for(r=0;r<c.length;++r)i=c[r],v=t.getTask(i.p,i.m,i.t).beginTime,y=t.getTask(i.p,i.m,i.t).endTime,p=t.getTask(i.p,i.m,i.t).endFail,w=t.getTask(i.p,i.m,i.t).oneDay,b=t.getTask(i.p,i.m,i.t).beginFail,t.getTask(i.p,i.m,i.t).setTimes(i.ref.beginTime,i.ref.endTime),t.getTask(i.p,i.m,i.t).endFail=i.ref.endFail,t.getTask(i.p,i.m,i.t).oneDay=i.ref.oneDay,t.getTask(i.p,i.m,i.t).beginFail=i.ref.beginFail,i.ref.beginTime=v,i.ref.endTime=y,i.ref.endFail=p,i.ref.oneDay=w,i.ref.beginFail=b;undefined===n.arg.m&&t.p[n.arg.p]._calcTimes();break;case or:k=ot(t.getMilestone(n.arg.p,n.arg.m));t.p[n.arg.p].removeMilestone(n.arg.index);t.addMilestoneWithIndex(n.arg.t,n.arg.index);n.arg.t=k;break;case dt:if(t.projects()[n.arg.toProject].removeTask(n.arg.place,n.arg.toMilestone),s=ot(n.arg.t),undefined==n.arg.fromMilestone?(s.milestone=-1,t.addTaskWithIndex(s,n.arg.index)):(s.milestone=n.arg.milestoneId,t.addTaskWithIndex(s,n.arg.index)),n.arg.linksToRemove)if(o=n.arg.linksToRemove.length,undefined!==n.arg.fromMilestone)for(r=0;r<o;++r)f=n.arg.linksToRemove[r],i=t.p[n.arg.fromProject].m[n.arg.fromMilestone].t[f.ind],i.links.splice(f.index,0,f.link);else for(r=0;r<o;++r)f=n.arg.linksToRemove[r],i=t.p[n.arg.fromProject].t[f.ind],i.links.splice(f.index,0,f.link);break;case uu:if(u=n.arg.group,"MtoF"===n.arg.type){for(e=t.p[n.arg.toProject].m[n.arg.fromMilestone],r=0;r<u.length;++r)u[r].task.milestone=n.arg.sourceMilestone,t.p[n.arg.fromProject].m[n.arg.fromMilestone].addTaskWithIndex(u[r].task,u[r].index);t.p[n.arg.toProject].t.splice(t.p[n.arg.toProject].t.length-u.length,u.length);e.updateTimes();t.p[n.arg.toProject]._calcTimes()}if("MtoM"===n.arg.type){for(e=t.p[n.arg.toProject].m[n.arg.toMilestone],r=0;r<u.length;++r)u[r].task.milestone=n.arg.sourceMilestone,t.p[n.arg.fromProject].m[n.arg.fromMilestone].addTaskWithIndex(u[r].task,u[r].index);t.p[n.arg.toProject].m[n.arg.toMilestone].t.splice(e.t.length-u.length,u.length);e.updateTimes();t.p[n.arg.toProject].m[n.arg.toMilestone].updateTimes();t.p[n.arg.toProject]._calcTimes()}if("FtoM"===n.arg.type){for(e=t.p[n.arg.toProject].m[n.arg.toMilestone],r=0;r<u.length;++r)u[r].task.milestone=-1,t.addTaskWithIndex(u[r].task,u[r].index);t.p[n.arg.toProject].m[n.arg.toMilestone].t.splice(e.t.length-u.length,u.length);e.updateTimes();t.p[n.arg.toProject]._calcTimes()}break;case sr:h=t.getTask(n.arg.p,n.arg.m,n.arg.index)._status;t.getTask(n.arg.p,n.arg.m,n.arg.index)._status=n.arg.t._status;n.arg.t._status=h;break;case fu:h=t.getMilestone(n.arg.p,n.arg.m)._status;t.getMilestone(n.arg.p,n.arg.m)._status=n.arg.t._status;n.arg.t._status=h;break;case hr:i=t.getTask(n.arg.p,n.arg.m,n.arg.t);i.links.splice(n.arg.linkIndex,1);break;case eu:i=t.getTask(n.arg.p,n.arg.m,n.arg.t);i.links.splice(n.arg.linkIndex,0,n.arg.link);break;case ki:l=n.arg.isMilestone?t.getMilestone(n.arg.p,n.arg.m):t.getTask(n.arg.p,n.arg.m,n.arg.index);l&&(l._responsibles=ot(n.arg.oldResponsibles))}this.perform(this.ind,!0,undefined,l);this.timeline.offMenus();this.timeline.offWidgets();this.timeline.clearPopUp=!0;this.timeline.updateWithScroll();--this.ind;this._updateDebug();this._updateUI()},redo:function(){var v,d,a,o,u,g;if(this.timeline.editBox.enable&&this.timeline.editBox.cancel(!0),this.timeline.leftPanelController().clearFocus(),!this.timeline||!this.op.length||this.ind===this.op.length-1){this._updateUI();return}++this.ind;var t=this.timeline.storage,n=this.op[this.ind],s,h,r,i,f,e,c=null,l;switch(n.id){case ui:this.timeline.rightScroll.save();t.addTaskWithIndex(n.arg.t,n.arg.index);break;case cf:if(this.timeline.rightScroll.save(),e=n.arg.linksToRemove.length,undefined!==n.arg.m)for(i=0;i<e;++i)f=n.arg.linksToRemove[i],f.link.dependenceTaskId!==n.arg.taskId&&(r=t.p[n.arg.p].m[n.arg.m].t[f.ind],r.links.splice(f.index,1));else for(i=0;i<e;++i)f=n.arg.linksToRemove[i],f.link.dependenceTaskId!==n.arg.taskId&&(r=t.p[n.arg.p].t[f.ind],r.links.splice(f.index,1));t.projects()[n.arg.p].removeTask(n.arg.index,n.arg.m);break;case hi:this.timeline.rightScroll.save();t.addMilestoneWithIndex(n.arg.t,n.arg.index);break;case ru:for(this.timeline.rightScroll.save(),v=t.p[n.arg.p].t,i=0;i<n.arg.t.t.length;++i)v.push(n.arg.t.t[i]),v.last().milestone=-1;t.p[n.arg.p].removeMilestone(n.arg.index);break;case ci:s=t.getTask(n.arg.p,n.arg.m,n.arg.index)._title;t.getTask(n.arg.p,n.arg.m,n.arg.index)._title=n.arg.t._title;n.arg.t._title=s;break;case bi:s=t.getMilestone(n.arg.p,n.arg.m)._title;t.getMilestone(n.arg.p,n.arg.m)._title=n.arg.t._title;n.arg.t._title=s;break;case ri:var y=t.getTask(n.arg.p,n.arg.m,n.arg.index).beginTime,p=t.getTask(n.arg.p,n.arg.m,n.arg.index).endTime,w=t.getTask(n.arg.p,n.arg.m,n.arg.index).endFail,b=t.getTask(n.arg.p,n.arg.m,n.arg.index).oneDay,k=t.getTask(n.arg.p,n.arg.m,n.arg.index).beginFail;if(t.getTask(n.arg.p,n.arg.m,n.arg.index).setTimes(n.arg.t.beginTime,n.arg.t.endTime),t.getTask(n.arg.p,n.arg.m,n.arg.index).endFail=n.arg.t.endFail,t.getTask(n.arg.p,n.arg.m,n.arg.index).oneDay=n.arg.t.oneDay,t.getTask(n.arg.p,n.arg.m,n.arg.index).beginFail=n.arg.t.beginFail,n.arg.t.beginTime=y,n.arg.t.endTime=p,n.arg.t.endFail=w,n.arg.t.oneDay=b,n.arg.t.beginFail=k,c=n.arg.queryMoveLinks,c)for(i=0;i<c.length;++i)r=c[i],y=t.getTask(r.p,r.m,r.t).beginTime,p=t.getTask(r.p,r.m,r.t).endTime,w=t.getTask(r.p,r.m,r.t).endFail,b=t.getTask(r.p,r.m,r.t).oneDay,k=t.getTask(r.p,r.m,r.t).beginFail,t.getTask(r.p,r.m,r.t).setTimes(r.ref.beginTime,r.ref.endTime),t.getTask(r.p,r.m,r.t).endFail=r.ref.endFail,t.getTask(r.p,r.m,r.t).oneDay=r.ref.oneDay,t.getTask(r.p,r.m,r.t).beginFail=r.ref.beginFail,r.ref.beginTime=y,r.ref.endTime=p,r.ref.endFail=w,r.ref.oneDay=b,r.ref.beginFail=k;undefined===n.arg.m&&t.p[n.arg.p]._calcTimes();break;case or:d=ot(t.getMilestone(n.arg.p,n.arg.m));t.p[n.arg.p].removeMilestone(n.arg.index);t.addMilestoneWithIndex(n.arg.t,n.arg.index);n.arg.t=d;break;case dt:if(n.arg.linksToRemove)if(e=n.arg.linksToRemove.length,undefined!==n.arg.fromMilestone)for(i=0;i<e;++i)f=n.arg.linksToRemove[i],r=t.p[n.arg.fromProject].m[n.arg.fromMilestone].t[f.ind],r.links.splice(f.index,1);else for(i=0;i<e;++i)f=n.arg.linksToRemove[i],r=t.p[n.arg.fromProject].t[f.ind],r.links.splice(f.index,1);a=n.arg.index;undefined===n.arg.fromMilestone&&undefined===n.arg.toMilestone?a=n.arg.place:undefined===n.arg.fromMilestone&&undefined!==n.arg.toMilestone&&(a=n.arg.place);t.projects()[n.arg.toProject].removeTask(n.arg.index,n.arg.fromMilestone);o=ot(n.arg.t);undefined==n.arg.fromMilestone?(o.milestone=undefined===n.arg.milestoneToId?-1:n.arg.milestoneToId,t.addTaskWithIndex(o,a)):(o.milestone=n.arg.milestoneToId?n.arg.milestoneToId:-1,t.addTaskWithIndex(o,n.arg.place));break;case uu:if(u=n.arg.group,"MtoF"===n.arg.type){for(i=0;i<u.length;++i)u[i].task.milestone=-1,t.p[n.arg.fromProject].addTask(u[i].task,!0);for(i=u.length-1;i>=0;--i)t.p[n.arg.fromProject].m[n.arg.fromMilestone].removeTask(u[i].index);t.p[n.arg.fromProject].m[n.arg.fromMilestone].updateTimes();t.p[n.arg.fromProject]._calcTimes()}if("MtoM"===n.arg.type){for(i=0;i<u.length;++i)u[i].task.milestone=n.arg.destMilestone,t.p[n.arg.toProject].m[n.arg.toMilestone].t.push(u[i].task);for(i=u.length-1;i>=0;--i)t.p[n.arg.fromProject].m[n.arg.fromMilestone].removeTask(u[i].index);t.p[n.arg.fromProject].m[n.arg.fromMilestone].updateTimes();t.p[n.arg.toProject].m[n.arg.toMilestone].updateTimes()}if("FtoM"===n.arg.type){for(g=t.p[n.arg.toProject].m[n.arg.toMilestone],i=0;i<u.length;++i)u[i].task.milestone=n.arg.destMilestone,t.p[n.arg.toProject].m[n.arg.toMilestone].t.push(u[i].task);for(i=u.length-1;i>=0;--i)t.p[n.arg.fromProject].removeTask(u[i].index);g.updateTimes();t.p[n.arg.fromProject]._calcTimes()}break;case sr:h=t.getTask(n.arg.p,n.arg.m,n.arg.index)._status;t.getTask(n.arg.p,n.arg.m,n.arg.index)._status=n.arg.t._status;n.arg.t._status=h;break;case fu:h=t.getMilestone(n.arg.p,n.arg.m)._status;t.getMilestone(n.arg.p,n.arg.m)._status=n.arg.t._status;n.arg.t._status=h;break;case hr:r=t.getTask(n.arg.p,n.arg.m,n.arg.t);n.arg.link.dependenceTaskId=t.getTask(n.arg.depIndexer.p,n.arg.depIndexer.m,n.arg.depIndexer.t)._id;n.arg.link.parentTaskId=t.getTask(n.arg.parIndexer.p,n.arg.parIndexer.m,n.arg.parIndexer.t)._id;r.links.push(n.arg.link);break;case eu:r=t.getTask(n.arg.p,n.arg.m,n.arg.t);r.links.splice(n.arg.linkIndex,1);break;case ki:l=n.arg.isMilestone?t.getMilestone(n.arg.p,n.arg.m):t.getTask(n.arg.p,n.arg.m,n.arg.index);l&&(l._responsibles=ot(n.arg.newResponsibles))}this.perform(this.ind,undefined,undefined,l);this.timeline.offMenus();this.timeline.offWidgets();this.timeline.clearPopUp=!0;this.timeline.updateWithScroll();this._updateDebug();this._updateUI()},_sliceTop:function(){this.op.length&&(this.ind<1&&(this.op=[]),this.op.splice(this.ind,this.op.length-this.ind))},_updateUI:function(){if(this.timeline.handlers[eo]){if(this.op.length&&this.op.last().arg.silentUpdateMode){this.op.last().arg.silentUpdateMode=undefined;return}this.timeline.handlers[eo](this.ind>-1&&this.ind<this.op.length&&this.op.length>0,this.op.length-this.ind>1&&this.op.length>0)}},_updateDebug:function(){}};bf.prototype={init:function(n,t){var i=this;this._dom=n;this.delegate=t;n instanceof HTMLCanvasElement||(this._canvas=document.createElement("canvas"),this._canvas.id="ZoomBarId",this._canvas.width=this._dom.clientWidth,this._canvas.height=this._dom.clientHeight,this._dom.style.backgroundColor="#ffffff",this._dom.appendChild(this._canvas));this._canvas&&(this.ctx=this._canvas.getContext("2d"),this.ctxWidth=this.ctx.canvas.width,this.ctxHeight=this.ctx.canvas.height,this.bounding=this.ctx.canvas.getBoundingClientRect(),this._dom.onmousemove=function(n){i.onmousemove(n)},this._dom.onmousedown=function(n){i.onmousedown(n)},this._dom.onmouseup=function(n){i.onmouseup(n)},this._dom.ondblclick=function(n){i.ondblclick(n)},this._dom.oncontextmenu=function(){return!1},"onwheel"in this._dom?this._dom.addEventListener("wheel",function(n){i.onmousewheel(n)},!1):"onmousewheel"in document?this._dom.addEventListener("mousewheel",function(n){i.onmousewheel(n)},!1):this._dom.addEventListener("MozMousePixelScroll",function(n){i.onmousewheel(n)},!1),this.timeScale=t.timeScale,this.needUpdate=!0,this.curDate=new Date,this.curDate.setHours(0),this.curDate.setMilliseconds(0),this.curDate.setMinutes(0),this.curDate.setSeconds(0),this.rightDate=new Date(this.curDate.getTime()+31104e6),this.leftDate=new Date(this.curDate.getTime()-31104e6),this.rightDate.setUTCDate(0),this.rightDate.setHours(0),this.rightDate.setMilliseconds(0),this.rightDate.setMinutes(0),this.rightDate.setSeconds(0),this.leftDate.setUTCDate(0),this.leftDate.setHours(0),this.leftDate.setMilliseconds(0),this.leftDate.setMinutes(0),this.leftDate.setSeconds(1),this.rightTextDate=new Date(this.rightDate.getTime()-1),this.leftTextDate=new Date(this.leftDate.getTime()),this.duration=0,this.timeCur=0,this.isLBMDown=!1,this.mouse={x:0,y:0},this.offmouse={x:0,y:0},this.handler=0,this.anchor=0,this.thumb={begin:0,end:0,band:0},this.indent=4,this.indentX=(this.indent+2)*.5,this.button=0,this.clickHandler=0,this.leftThumbX=0,this.rightThumbX=0,this.thumbW=0,this.thumbX=0,this.thumbC=0)},dom:function(){return this._dom},canvas:function(){return this._canvas},needRepaint:function(){this.repaint=!0},render:function(){this.needUpdate&&this.ctx&&(this.bounding=this.ctx.canvas.getBoundingClientRect(),this.ctxWidth=this.ctx.canvas.width,this.ctxHeight=this.ctx.canvas.height,this.calc(),this.repaint&&(this.repaint=!1,this.ctx.clearRect(0,0,this.ctxWidth,this.ctxHeight),this.ctx.fillStyle=this.thumbW!==di?co:lo,this.ctx.fillRect(this.thumbX+.5,2,this.thumbW,this.ctxHeight-4),this.thumbW!==di&&(this.ctx.fillStyle=lo,this.ctx.fillRect(this.thumbX+.5-1,2,1,this.ctxHeight-4),this.ctx.fillRect(Math.floor(this.thumbX+this.thumbW),2,1,this.ctxHeight-4),this.ctx.beginPath(),this.ctx.moveTo(this.thumbX+.5,this.ctxHeight*.5-this.indent),this.ctx.lineTo(this.thumbX-this.indent-.5,this.ctxHeight*.5),this.ctx.lineTo(this.thumbX+.5,this.ctxHeight*.5+this.indent),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(Math.floor(this.thumbX+this.thumbW),this.ctxHeight*.5-this.indent),this.ctx.lineTo(Math.floor(this.thumbX+this.thumbW+this.indent+1),this.ctxHeight*.5),this.ctx.lineTo(Math.floor(this.thumbX+this.thumbW),this.ctxHeight*.5+this.indent),this.ctx.closePath(),this.ctx.fill()),this.renderMilestoneLines(),this.ctx.fillStyle=ph,this.ctx.fillRect(this.dX,0,1,this.ctxHeight),this.renderDates()))},renderDates:function(){function n(n){var t="",i=n.getDate(),r=n.getMonth()+1;return t+=i<10?"0"+i:i,t+=r<10?".0"+r:"."+r,t+("."+String(n.getUTCFullYear()).substring(2,4))}this.ctx.fillStyle=ut;this.ctx.fillText(n(this.leftTextDate),5,this.ctxHeight*.6);this.ctx.fillText(n(this.rightTextDate),this.ctxWidth-50,this.ctxHeight*.6)},renderMilestoneLines:function(){var n,t,u,i,f=!0,e=!1,o,r=this.delegate.storage.projects(),s=r.length;if(s){var h=this.regionSize(),c=h*this.fraction+this.indentX,l=this.ctxHeight-this.indent,a=h/this.duration;for(this.ctx.lineWidth=1,this.ctx.strokeStyle=co,t=0;t<s;++t)for(o=r[t].m.length,n=0;n<o;++n)u=(a*r[t].m[n].endTime+c>>0)+.5,i=r[t].m[n].endTime<=0?tf:nf,1===r[t].m[n]._status&&(i=yr),i!==this.ctx.strokeStyle&&(e=!0,n>0&&this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle=i),f&&(this.ctx.beginPath(),this.ctx.strokeStyle=i,f=!1),this.ctx.moveTo(u,this.indent),this.ctx.lineTo(u,l);e&&this.ctx.stroke()}},releaseCapture:function(){this.isLBMDown=!1;this.handler=0},setRangeTimes:function(n){if(n){var t=54432e5,i=this.curDate.getTime()+Math.abs(n*36e5)+t,r=this.curDate.getTime()-Math.abs(n*36e5)-t;(i>this.rightDate.getTime()||r<this.leftDate.getTime())&&(this.leftDate=new Date(r),this.rightDate=new Date(i),this.rightDate.setUTCDate(0),this.rightDate.setHours(0),this.rightDate.setMilliseconds(0),this.rightDate.setMinutes(0),this.rightDate.setSeconds(0),this.leftDate.setUTCDate(0),this.leftDate.setHours(0),this.leftDate.setMilliseconds(0),this.leftDate.setMinutes(0),this.leftDate.setSeconds(1),this.rightTextDate=new Date(this.rightDate.getTime()-1),this.leftTextDate=new Date(this.leftDate.getTime()))}this.repaint=!0},calc:function(){var i=this.delegate,t;this.duration=(this.rightDate.getTime()-this.leftDate.getTime())/36e5;this.timeCur=(this.curDate.getTime()-this.leftDate.getTime())/36e5;this.fraction=(this.curDate.getTime()-this.leftDate.getTime())/36e5/this.duration;var n=this.regionSize(),r=this.timeScale.hourInPixels/this.timeScale.scaleX,u=(i.ctxWidth-i.visibleLeft)/r,f=i.visibleLeft/r;this.dX=Math.floor(Math.abs(this.timeCur/this.duration*n)+this.indentX);this.thumb.begin=(this.timeCur-this.timeScale._fX*this.timeScale.scaleX+f)/this.duration;this.thumb.end=(this.timeCur-this.timeScale._fX*this.timeScale.scaleX+u+f)/this.duration;this.thumb.band=u/this.duration;this.leftThumbX=this.thumb.begin*n+this.indentX;this.rightThumbX=this.thumb.end*n+this.indentX;this.leftHandler=Math.floor(this.leftThumbX);this.rightHandler=Math.floor(this.rightThumbX);this.bandwidth=Math.floor(this.thumb.band*n);this.thumbW=this.rightThumbX-this.leftThumbX;this.thumbX=Math.floor(this.leftHandler)+.5;this.thumbC=(this.rightThumbX+this.leftThumbX)*.5;this.thumbW<=di&&(this.thumbW=di,this.thumbX=Math.floor(this.thumbC-this.thumbW*.5)+.5,t=(this.thumb.end+this.thumb.begin)*.5,t=.5+(t-.5)*(1+(this.thumb.end-this.thumb.begin)),this.thumbX=(n-this.thumbW)*t+this.indentX)},worldToContol:function(n,t){return{x:n-this.bounding.left*(this.ctxWidth/this.bounding.width),y:t-this.bounding.top*(this.ctxHeight/this.bounding.height)}},isCapture:function(n){return(this.mouse=this.worldToContol(n.clientX,n.clientY),this.thumbW===di)?this.mouse.x>this.thumbX&&this.mouse.x<this.thumbX+this.thumbW:this.mouse.x>=this.leftHandler&&this.mouse.x<=this.rightHandler},calcMouseHandler:function(n){return this.mouse=this.worldToContol(n.clientX,n.clientY),this.thumbW===di?this.mouse.x>this.thumbX&&this.mouse.x<this.thumbX+this.thumbW&&(this.handler=0):this.handler=Math.abs(this.mouse.x-this.leftHandler)<7?-1:Math.abs(this.mouse.x-this.rightHandler)<7?1:0,this.handler},regionSize:function(){return this.ctxWidth-this.indentX*2},moveToMilestone:function(){var u,n,h,c,e=0,i=this.delegate,r=i.storage.projects(),l=r.length,v,s;if(!l)return!1;var a=this.regionSize(),y=this.duration*this.fraction/this.duration*a+this.indentX,w=this.ctxHeight-this.indent,p=a/this.duration,f=i.itemMargin;for(n=0;n<l;++n)if(!r[n].isEmpty()){for(c=r[n].m.length,u=0;u<c;++u){if(h=(p*r[n].m[u].endTime+y>>0)+.5-this.mouse.x,ht(h)<5)return i.animator.moveCenterToX(r[n].m[u].endTime),u===0&&n===0&&(e=o),v=t(i.rightScroll.maxValue()/f)*f,s=e,i.fullscreen||(s=t(s/f)*f-o),i.animator.moveToY(Math.min(s,v-o)),i.offMenus(),i.offWidgets(),this.repaint=!0,!0;e+=f+r[n].m[u].t.length*f;0===r[n].m[u].t.length&&i.fullscreen&&(e+=i.itemMargin)}r[n].t.length&&(e+=r[n].t.length*f+i.itemHeight)}return!1},maxPos:function(){var n=this.delegate,i=this.regionSize(),t=n.timeScale.hourInPixels/n.timeScale.scaleX,r=n.visibleLeft/t,u=(this.bandwidth/i-1+this.fraction)*this.duration+r;return u*t/this.timeScale.hourInPixels},minPos:function(){var n=this.delegate,t=n.timeScale.hourInPixels/n.timeScale.scaleX,i=n.visibleLeft/t,r=this.fraction*this.duration+i;return r*t/this.timeScale.hourInPixels},onmousedown:function(n){this.handler=0;this.button=n.button;(this.isCapture(n)||0!==this.calcMouseHandler(n))&&(this.isLBMDown=!0,this.offmouse.x=this.mouse.x,this.calc(),this.anchor=this.mouse.x-this.leftHandler);this.clickHandler=this.handler},onmousemove:function(n){if(2!==this.button){var i=this.delegate,g=this.isCapture(n),a=this.regionSize(),u,w,h,f,e,s,v,l,b,k,c,y=this.duration,nt=this.timeCur,r=this.fraction,d=0,p=0;if(0!==i.storage.p.length){i.bottomScroll.onmouseup(n);i.rightScroll.onmouseup(n);if(this.isLBMDown){u=i.timeScale.hourInPixels/i.timeScale.scaleX;c=i.visibleLeft/u;0===this.handler?(i.animator.stop(),l=(this.mouse.x-this.anchor)/a,l=(-r+.5)*(r-l)/r+.5*l/r,b=.5-l,k=Math.max(Math.min(b,r)*y,(this.bandwidth/a-1+r)*y)+c,i.offsetX=k*u/this.timeScale.hourInPixels,i.updateWithStrafe(),this._canvas.style.cursor="pointer",this.repaint=!0):-1===this.handler?(i.animator.stop(),h=this.mouse.x/a,this.thumb.end-h>0&&(e=this.thumb.end-h,f=e/this.thumb.band,s=e+r-this.thumb.end,v=i.timeScale.scaleX,i.timeScale.scaleX*=f,s>=r?(i.scaleX=v,i.update(),i._viewController.changeTimeScaleEvent()):(e=this.thumb.band*f,s=r-(this.thumb.end-e),i.timeScale.scaleX<=gi&&(f=gi/i.timeScale.scaleX*f,i.timeScale.scaleX=gi),i.timeScale.scaleX>=gt&&(f=gt/i.timeScale.scaleX*f,i.timeScale.scaleX=gt),e=this.thumb.band*f,s=r-(this.thumb.end-e),u=i.timeScale.hourInPixels/i.timeScale.scaleX,w=i.timeScale.ctxWidth/u,c=i.visibleLeft/u,i.offsetX=(s*y+c)*u/i.timeScale.hourInPixels,i.updateWithStrafe(),i._viewController.changeTimeScaleEvent())),this._canvas.style.cursor="w-resize"):1===this.handler&&(i.animator.stop(),h=this.mouse.x/a,h-this.thumb.begin>0&&(e=h-this.thumb.begin,f=e/this.thumb.band,s=r-this.thumb.begin,v=i.timeScale.scaleX,i.timeScale.scaleX*=f,i.timeScale.scaleX<gi+1||i.timeScale.scaleX>gt||s>=r?(i.timeScale.scaleX=v,i.update(),i._viewController.changeTimeScaleEvent()):(u=i.timeScale.hourInPixels/i.timeScale.scaleX,w=i.timeScale.ctxWidth/u,c=i.visibleLeft/u,i.offsetX=(s*y+c)*u/i.timeScale.hourInPixels,i.updateWithStrafe(),i._viewController.changeTimeScaleEvent())),this._canvas.style.cursor="w-resize");d=t(i.rightScroll.maxValue()/i.itemMargin)*i.itemMargin;p=i.getTopElementInVisibleRange().height-i.itemMargin*!i.fullscreen;i.fullscreen||(p=t(p/i.itemMargin)*i.itemMargin-o);i.contentHeight>=i.ctxHeight-i.itemMargin*2&&(i.animator.moveToY(Math.min(p,d-o)),i.offMenus(),i.offWidgets());this.repaint=!0;return}if(g){this._canvas.style.cursor="pointer";return}if(this.calcMouseHandler(n)){this._canvas.style.cursor="w-resize";return}this._canvas.style.cursor=""}}},onmouseup:function(){if(0!==this.delegate.storage.p.length){var i=this.delegate,u,r,f,e,o,n,t;this.releaseCapture();2===this.button?(this.moveToMilestone(),this.button=0):i&&(u=this.regionSize(),r=this.duration,n=this.fraction,o=this.bandwidth*.5/u,0===this.clickHandler&&(this.mouse.x-this.leftHandler<-7||this.mouse.x-this.rightHandler>7)&&(t=this.mouse.x/u,t=(.5-n)*(n-t)/n+.5*t/n,f=.5-t,e=f*r,e=Math.max(Math.min(f,n-o)*r,(n-1+o)*r),i.animator.stop(),i.animator.moveCenterToX(-e),i.updateWithStrafe(),this.repaint=!0))}},ondblclick:function(){},onmousewheel:function(t){var r,i;0!==this.delegate.storage.p.length&&(t=t||n.event,r=t.deltaY||t.detail||t.wheelDelta,t.deltaY&&(r*=-1),t.detail&&(r*=-1),i=this.delegate.timeScale.scaleX,r>0?(i-=24,i<cr&&this.delegate.timeScale.scaleX>cr?this.delegate.viewController().scaleTo(cr):this.delegate.viewController().scaleTo(Math.min(Math.max(i,gi),gt))):(i+=24,this.delegate.timeScale.scaleX<cr?this.delegate.viewController().scaleTo(cr):this.delegate.viewController().scaleTo(Math.min(Math.min(i,bh),gt))),this.repaint=!0)}};ls.prototype={updateDefaults:function(){this.font=this.fontHeight+"pt "+b},strafe:function(n){this._fX=n;this.calculateScaleType()},height:function(){return this.delegate.itemMargin*2},linesFromY:function(){return this.delegate.itemMargin},weekend:function(){if(fi===this.scaleType)return null;var n=(new Date).getDay();return--n,-1===n&&(n=6),{x:(5-n)*24*this.hourInPixels/this.scaleX,width:48*this.hourInPixels/this.scaleX,off:168*this.hourInPixels/this.scaleX}},scaleUnitStep:function(){return this.divisionInOneHours},update:function(){},setZoom:function(n){this.zoom=Math.max(.1,n);this.textDateLineHeight=15*this.zoom;this.hourInPixels=35*this.zoom;this.fontHeight=9*this.zoom;this.font=this.fontHeight+"pt "+b;this.lineSize=this.delegate.itemMargin;this.headTextPosY=this.lineSize*.55;this.baseTextPosY=this.lineSize*1.65},refresh:function(){this.ctxWidth=this.ctx.canvas.width;this.ctxHeight=this.ctx.canvas.height;var n=new Date;this.weekDay=n.getDay();--this.weekDay;-1===this.weekDay&&(this.weekDay=6);this.dayUTC=n.getUTCDate();this.monthCur=n.getMonth();this.yearCur=n.getFullYear();this.calculateScaleType()},draw:function(){var n=new Date,t=n.getDay();--t;-1===t&&(t=6);var f=n.getDate(),e=n.getMonth(),o=this.hourInPixels*this.scaleX,r=this.hourInPixels/this.scaleX*this.divisionInOneHours,s=Math.floor(this.ctxWidth/r)+3,h=this.hourInPixels*this._fX,i=this._fX*this.scaleX/this.divisionInOneHours,u=Math.floor(i),c=i-u;this.ctx.strokeStyle=oi;this.ctx.lineWidth=1;this.ctx.fillStyle=ut;this.ctx.font=this.font;this.ctx.beginPath();vf===this.scaleType?this.drawWeekScheme():af===this.scaleType?this.drawDaysScheme():nr===this.scaleType?this.drawHoursScheme():fi===this.scaleType&&this.drawMonthScheme();this.ctx.closePath();this.ctx.stroke()},drawHoursScheme:function(){var u,f,i,r,o,n,s=!1,a=this.ctxWidth,e=this.hourInPixels/this.scaleX*this.divisionInOneHours,v=this.ctxWidth/e+this.divisionInOneHours*2,h=this._fX*this.scaleX/this.divisionInOneHours,y=t(h),b=h-y,c=this.daysInMonth(this.monthCur+1,this.yearCur),l=this.dayUTC,p=this.hourInPixels*this._fX,w=t(p/e);for(r=this.monthCur,o=this.yearCur,f=0,u=this.weekDay,i=0;f<v-w;++f,i+=this.divisionInOneHours){if(n=(f+h)*e,n>a+100)break;(i>=24&&(i=0,++u,u>6&&(u=0),s=!0,l++,l>=c+1&&(r++,r>=12&&(r=0,o++),l-=c,c=this.daysInMonth(r+1,o))),n<-e)||(s&&(this.ctx.moveTo(n+.5,2+this.marginY),this.ctx.lineTo(n+.5,this.textDateLineHeight+2+this.marginY),s=!1),this.ctx.fillText(i,n+.5+2,this.textDateLineHeight*1.7+2+this.marginY))}},drawDaysScheme:function(){var e,u,f,r,s,c,l=!1,a=0,v=this.ctxWidth,o=this.hourInPixels/this.scaleX*this.divisionInOneHours,y=v/o,it=this.hourInPixels*this._fX,p=this._fX*this.scaleX/this.divisionInOneHours,w=t(it/o),h=this.daysInMonth(this.monthCur+1,this.yearCur),i=this.dayUTC,rt=-o*this.divisionInDays,ft=Math.floor(y-w)+this.divisionInDays,k=this.divisionInDays>=9?n.Gantt.Teamlab_shortmonths:n.Gantt.Teamlab_months,nt=this.scaleX>lf,d=(o-this.ctx.measureText("0").width)*.5,tt=(o-this.ctx.measureText("10").width)*.5,g=!0;if(1===this.divisionInDays){for(e=0,u=this.monthCur+1,f=this.yearCur,s=this.weekDay;e<y-w;++e,++i,++s)(r=(e+p)*o,i>h&&(i=1,u++,u>12&&(u=1,++f),h=this.daysInMonth(u,f)),s>6&&(s=0),r<-o*3)||(this.ctx.fillStyle=s==5||s==6?ko:ut,1===i&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(r),0,1,this.delegate.itemMargin),this.ctx.fillStyle=ut,this.ctx.fillText(k[u-1]+" "+f,r+this.lineSize*.25,this.headTextPosY)),this.ctx.fillText(i,r+(i>=10?tt:d),this.baseTextPosY));for(h=this.daysInMonth(this.monthCur+1,this.yearCur),i=this.dayUTC,e=0,u=this.monthCur+1,f=this.yearCur,s=this.weekDay;e>=-w-y;--e,--i,--s)(r=(e+p)*o,i<1&&(--u,u<1&&(u=12,--f),h=this.daysInMonth(u,f),i=this.daysInMonth(u,f)),s<0&&(s=6),r<-o*3||r>v)||(this.ctx.fillStyle=s==5||s==6?ko:ut,1===i&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(r),0,1,this.delegate.itemMargin),this.ctx.fillStyle=ut,this.ctx.fillText(k[u-1]+" "+f,r+this.lineSize*.25,this.headTextPosY)),g&&e===0&&(this.ctx.fillStyle=ah,this.ctx.font="bold "+this.fontHeight+"pt "+b),this.ctx.fillText(i,r+(i>=10?tt:d),this.baseTextPosY),g&&(g=!1,e===0&&(this.ctx.font=this.font)));return}for(h=this.daysInMonth(this.monthCur+1,this.yearCur),i=this.dayUTC,e=0,u=this.monthCur,f=this.yearCur;e<ft;++e,i+=this.divisionInDays){if(r=(e+p)*o,r>v+100)break;(i>=h&&(l=!0,a=r,u++,u>=12&&(u=0,++f),i-=h,h=this.daysInMonth(u+1,f),a=r-o*(1/this.divisionInDays)*i),r<-o)||(l&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(r),0,1,this.delegate.itemMargin),this.ctx.fillStyle=ut,c=nt?f%100:f,1===c.length&&(c="0"+c),this.ctx.fillText(k[u]+" "+c,r+this.lineSize*.25,this.headTextPosY),l=!1),0===i&&++i,this.ctx.fillText(i,r+.5+2-d*(i>10?.75:1),this.baseTextPosY))}for(h=this.daysInMonth(this.monthCur+1,this.yearCur),i=this.dayUTC,e=0,u=this.monthCur+1,f=this.yearCur;e>=-w-y;--e,i-=this.divisionInDays){if(r=(e+p)*o,r<rt)break;(i<1&&(l=!0,a=r,a=r-o*(1/this.divisionInDays)*i,--u,u<0&&(u=11,--f),h=this.daysInMonth(u+1,f),i+=h),r>v)||(l&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(r),0,1,this.delegate.itemMargin),this.ctx.fillStyle=ut,c=nt?f%100:f,1===c.length&&(c="0"+c),this.ctx.fillText(k[u]+" "+c,r+this.lineSize*.25,this.headTextPosY),l=!1),0===i&&++i,this.ctx.fillText(i,r+.5+2-d*(i>10?.75:1),this.baseTextPosY))}},drawWeekScheme:function(){var s,f,e,i,k,d,l=!1,h=0,p=this.ctxWidth,r=this.hourInPixels/this.scaleX*this.divisionInOneHours,g=p/r,et=this.hourInPixels*this._fX,nt=this._fX*this.scaleX/this.divisionInOneHours,tt=et/r>>0,c=this.daysInMonth(this.monthCur+1,this.yearCur),o=this.dayUTC-this.weekDay,y=this.getDayOfYear(new Date),w=this.getDaysInYear(this.yearCur),ot=-r*this.divisionInDays,st=Math.floor(g-tt)+this.divisionInDays,it=n.Gantt.Teamlab_shortmonths,at=this.scaleX>lf,a=n.Gantt.Localize_strings.week||"week",ht=a+" ",lt=a+" 10",rt=(r-this.ctx.measureText(ht).width)*.5,ft=(r-this.ctx.measureText(lt).width)*.5,u=this.getWeekNumber(new Date),v=r/this.divisionInDays,b;for(s=0,f=this.monthCur,e=this.yearCur;s<st;++s,o+=this.divisionInDays,y+=this.divisionInDays){if(i=(s+nt)*r,i>p+r*2)break;if(y-w>=0&&(k=new Date("31 Dec "+e),d=k.getDay(),y=d,w=this.getDaysInYear(e+1),u=1),o>=c&&(l=!0,h=i,f++,f>=12&&(f=0,++e),o-=c,c=this.daysInMonth(f+1,e),h=i+(1-o-this.weekDay)*v),i<-r*2){++u;continue}l&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(h),0,1,this.delegate.itemMargin),this.ctx.fillStyle=ut,this.ctx.fillText(it[f]+" "+e,h+this.lineSize*.5,this.headTextPosY),l=!1);u>=10?this.ctx.fillText(a+" "+u,i+ft+r-this.weekDay*v,this.baseTextPosY):this.ctx.fillText(a+" "+u,i+rt+r-this.weekDay*v,this.baseTextPosY);++u}for(b=!0,u=this.getWeekNumber(new Date)-1,c=this.daysInMonth(this.monthCur+1,this.yearCur),o=this.dayUTC-this.weekDay,y=this.getDayOfYear(new Date)+1,w=this.getDaysInYear(this.yearCur),s=0,f=this.monthCur+1,e=this.yearCur;s>=-tt-g;--s,o-=this.divisionInDays,y+=this.divisionInDays){if(i=(s+nt)*r,i<ot)break;if(u<=0&&(u=this.getIsoWeeks(e-1)),o<0&&(l=!0,h=i,--f,f<0&&(f=11,--e),c=this.daysInMonth(f+1,e),o+=c,h=i+(c-o-this.weekDay+1+f%2)*v),i>p){--u;continue}if(l&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(h),0,1,this.delegate.itemMargin),this.ctx.fillStyle=ut,this.ctx.fillText(it[f]+" "+e,h+this.lineSize*.5,this.headTextPosY),l=!1),b){b=!1;continue}u>=10?this.ctx.fillText(a+" "+u,i+ft+r-this.weekDay*v,this.baseTextPosY):this.ctx.fillText(a+" "+u,i+rt+r-this.weekDay*v,this.baseTextPosY);--u}},drawMonthScheme:function(){var s=0,f=0,e=0,c=0,i="",w=this.delegate.itemMargin,l=!1,a=!1,o=0,k=this.ctxWidth,r=this.hourInPixels/this.scaleX*this.divisionInOneHours,g=k/r,et=this.hourInPixels*this._fX,v=this._fX*this.scaleX/this.divisionInOneHours,nt=t(et/r),y=this.daysInMonth(this.monthCur+1,this.yearCur),h=this.dayUTC,st=-r*this.divisionInDays,ot=Math.floor(g-nt)+32,tt=this.divisionInDays>=9?n.Gantt.Teamlab_shortmonths:n.Gantt.Teamlab_months,it=n.Gantt.Localize_strings.year||"year",rt=this.scaleX>lf,ht=(r-this.ctx.measureText("0").width)*.5,lt=(r-this.ctx.measureText("10").width)*.5,d=r*48,at=r/this.divisionInDays,p=0,u=v*r+-h*r,b=undefined,ft=!0;for(s=0,f=this.monthCur,e=this.yearCur;s<=ot;++s,h+=this.divisionInDays,++p){if(c=(s+v)*r,c>k+d)break;(h>=y&&(l=!0,o=u,f++,f>=12&&(f=0,++e,a=!0),h-=y,y=this.daysInMonth(f+1,e),u=v*r+(p+1)*r,o=u-o),c<-r*2)||l&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(u),w,1,this.ctxHeight),i=rt?e%100:e,1===i.length&&(i="0"+i),i=tt[f]+" "+i,this.ctx.fillStyle=ut,this.ctx.fillText(i,u+o*.5-this.ctx.measureText(i).width*.5,this.baseTextPosY),a&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(u+o),0,1,w),a=!1),6===f&&(i=it+" "+e,this.ctx.fillStyle=ut,this.ctx.fillText(i,u+o*.5-this.ctx.measureText(i).width*.5,this.headTextPosY)),undefined===b&&(b=u),l=!1)}for(y=this.daysInMonth(this.monthCur+1,this.yearCur),h=this.dayUTC,p=this.weekDay-1,u=(this.daysInMonth(this.monthCur,this.yearCur)+v)*r,s=0,f=this.monthCur+1,e=this.yearCur;s>=-nt-g;--s,h-=this.divisionInDays,--p){if(c=(s+v)*r,c<-d)break;(h<0&&(o=u,--f,f<0&&(f=11,--e,a=!0),y=this.daysInMonth(f+1,e),h+=y,l=!0,u=v*r+p*r+(f%2-1)*r,o=o-u),c>k+d)||l&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(u),w,1,this.ctxHeight),i=rt?e%100:e,1===i.length&&(i="0"+i),i=tt[f]+" "+i,this.ctx.fillStyle=ut,ft?(b&&this.ctx.fillText(i,(u+b)*.5-this.ctx.measureText(i).width*.5,this.baseTextPosY),ft=!1):this.ctx.fillText(i,u+o*.5-this.ctx.measureText(i).width*.5,this.baseTextPosY),l=!1,a&&(this.ctx.fillStyle=ct,this.ctx.fillRect(t(u+o),0,1,w),a=!1),6===f&&(i=it+" "+e,this.ctx.fillStyle=ut,this.ctx.fillText(i,u+o*.5-this.ctx.measureText(i).width*.5,this.headTextPosY)))}},drawLines:function(){var t,r,i,n,o;if(fi!==this.scaleType){i=new Date;n=i.getDay();--n;-1===n&&(n=6);var l=i.getDate(),a=i.getMonth(),v=this.hourInPixels*this.scaleX,u=this.hourInPixels/this.scaleX*this.divisionInOneHours,s=this.ctxWidth/u+2,y=this.hourInPixels*this._fX,f=this._fX*this.scaleX/this.divisionInOneHours,h=this.linesFromY()+.5,e=Math.floor(f),c=f-e;if(this._offTL=f-e,this.ctx.strokeStyle=ct,this.ctx.lineWidth=1,this.ctx.beginPath(),vf===this.scaleType)for(o=u/7*n,t=0;t<s;++t)r=Math.floor((t+c)*u-o)+.5,this.ctx.moveTo(r,h),this.ctx.lineTo(r,this.ctxHeight);this.ctx.closePath();this.ctx.stroke()}},calculateScaleType:function(){var n=this;n.scaleType=nr;n.divisionInDays=7;n.divisionInOneHours=1;n.scaleX>=wh&&n.scaleX<ao?(n.scaleType=nr,n.divisionInOneHours=2):n.scaleX>=ao&&n.scaleX<vo?(n.scaleType=nr,n.divisionInOneHours=4):n.scaleX>=vo&&n.scaleX<yo?(n.scaleType=nr,n.divisionInOneHours=8):n.scaleX>=yo&&n.scaleX<po?(n.scaleType=nr,n.divisionInOneHours=12):this.scaleX>=po&&n.scaleX<wo?(n.scaleType=af,n.divisionInOneHours=24,n.divisionInDays=1):this.scaleX>=wo&&n.scaleX<bo?(n.scaleType=vf,n.divisionInOneHours=168,n.divisionInDays=7):n.scaleX>=bo&&n.scaleX<gt+5?(n.scaleType=fi,n.divisionInOneHours=24,n.divisionInDays=1):n.scaleX>=gt+5&&n.scaleX<5e4&&(n.scaleType=fi,n.divisionInOneHours=168,n.divisionInDays=30)},daysInMonth:function(n,t){return n<1||n>12?0:[[31,28,31,30,31,30,31,31,30,31,30,31],[31,29,31,30,31,30,31,31,30,31,30,31]][t%4==0&&(t%100!=0||t%400==0)?1:0][n-1]},getWeekNumber:function(n){n.setHours(0,0,0);n.setDate(n.getDate()+4-(n.getDay()||7));var t=new Date(n.getFullYear(),0,1);return Math.ceil(((n-t)/864e5+1)/7)},getDayOfYear:function(n){n.setHours(0);n.setMinutes(0);n.setMilliseconds(0);var t=(new Date).setFullYear((new Date).getFullYear(),0,1);return n.setHours(0),n.setMinutes(0),n.setMilliseconds(1),Math.ceil((n.getTime()-t)/864e5)},getDaysInYear:function(n){var t=(new Date).setFullYear(n,0,1),i=(new Date).setFullYear(n+1,0,1);return Math.ceil((i-t)/864e5)},getIsoWeeks:function(n){var t=new Date("31 Dec "+n),i=new Date(t.getFullYear(),0,4),r=(t-i)/864e5;return Math.ceil((r+i.getDay()+1)/7)}};e.prototype={_id:-1,_owner:-1,milestone:-1,_title:"",performer:"",_status:tt,_responsibles:[],_subtasks:0,links:[],beginTime:null,endTime:null,_isMilestone:!1,titleWidth:-1,isInEditMode:!1,strafe:function(n){var t=this.endTime-this.beginTime;this.beginTime=n;this.endTime=n+t;this._update()},updateBegin:function(n,t,i){n+24<this.endTime||this.endFail?(this.beginTime=t&&this.endFail?Math.min(n,t-24):n,this.duration=this.endTime-this.beginTime,this.duration<0&&this.beginFail&&(this.beginFail=!1,this.duration=24,this.endTime=this.beginTime+this.duration)):(this.beginTime=this.endTime-24,this.duration=this.endTime-this.beginTime);i&&!this.endFail&&(this.oneDay=i,this.beginTime+=24,this.duration=24,this.endTime=this.beginTime+24);this._update(i)},updateEnd:function(n,t){n-24>this.beginTime?(this.endTime=n,this.duration=this.endTime-this.beginTime):(this.endTime=this.beginTime+24,this.duration=this.endTime-this.beginTime);t&&(this.oneDay=t);this._update(t)},updateBeginWithDate:function(n,t){n.setHours(0);n.setMilliseconds(0);n.setMinutes(0);n.setSeconds(0);this.updateBegin((n.getTime()-e.curTime)/36e5,undefined,t)},updateEndWithDate:function(n,t){n.setHours(0);n.setMilliseconds(0);n.setMinutes(0);n.setSeconds(0);this.updateEnd((n.getTime()-e.curTime)/36e5,t)},setTimes:function(n,t){this.beginTime=n;this.endTime=t;this.duration=this.endTime-this.beginTime;this._update()},calculateTime:function(n){return undefined==e.curDate&&(e.curDate=new Date,e.curDate.setHours(0),e.curDate.setMilliseconds(0),e.curDate.setMinutes(0),e.curDate.setSeconds(0),e.curTime=e.curDate.getTime()),(n.getTime()-e.curDate.getTime())/36e5},update:function(){this.titleWidth=-1;this.stringsBlocks=null;this.descStrings=null},formatBeginDate:function(n){this._beginDate.setHours(12);var t=n?this._beginDate.dateFormatFullYear():this._beginDate.dateFormat();return this._beginDate.setHours(0),t},formatEndDate:function(n){var t,i;return this.endFail?"...":(this._endDate.setHours(12),t=new Date(this._endDate),this.oneDay&&t.setDate(t.getDate()-1),i=n?t.dateFormatFullYear():t.dateFormat(),this._endDate.setHours(0),i)},formatBeginEndDays:function(){var t,i,r;return this._beginDate.setHours(12),t=this._beginDate.getUTCDate(),t<10&&(t="0"+t.toString()),i=this._beginDate.getMonth()+1,i<10&&(i="0"+i.toString()),this._beginDate.setHours(0),r=t+"."+i+". - ",this._endDate.setHours(12),t=this._endDate.getUTCDate(),t<10&&(t="0"+t.toString()),i=this._endDate.getMonth()+1,i<10&&(i="0"+i.toString()),this._endDate.setHours(0),r+=t+"."+i+" ("+(this.endTime-this.beginTime)/24,r+((this.endTime-this.beginTime)/24<2?" "+n.Gantt.Localize_strings.day+")":" "+n.Gantt.Localize_strings.days+")")},daysPastDue:function(){return-Math.floor((this.endTime-24)/24)},getLink:function(n){for(var i,t=this.links.length-1;t>=0;--t)if(i=this.links[t].parentTaskId||this.links[t].parentTaskId,i==n)return this.links[t];return undefined},_update:function(n){undefined==e.curDate&&(e.curDate=new Date,e.curDate.setHours(0),e.curDate.setMilliseconds(0),e.curDate.setMinutes(0),e.curDate.setSeconds(0),e.curTime=e.curDate.getTime());this._beginDate=new Date(e.curTime+(this.beginTime+12)*36e5);this._endDate=new Date(e.curTime+this.endTime*36e5);this._beginDate.setHours(0);this._beginDate.setMilliseconds(0);this._beginDate.setMinutes(0);this._beginDate.setSeconds(0);this._endDate.setHours(0);this._endDate.setMilliseconds(0);this._endDate.setMinutes(0);this._endDate.setSeconds(0);n||(this.oneDay=!1,this.beginFail=!1)},title:function(){return this._title},id:function(){return this._id},owner:function(){return this._owner},beginDate:function(){return this._beginDate},endDate:function(){return this.oneDay?this._beginDate:this._endDate},description:function(){return this._description},isMilestone:function(){return this._isMilestone},status:function(){return this._status},customTaskStatus:function(){return this._customTaskStatus},subtasks:function(){return this._subtasks},responsibles:function(){return this._responsibles},isUndefinedEndTime:function(){return this.endFail},isUndefinedBeginTime:function(){return this.beginFail}};vu.prototype={_id:-1,_owner:-1,_title:"",performer:"",_isMilestone:!0,beginTime:null,endTime:null,t:[],sortedByDates:!1,titleWidth:-1,titleWithDate:"",collapse:!1,add:function(n){this.t.push(n);this.beginTime=Math.min(this.endTime-this.durationMin,Math.min(n.beginTime,this.beginTime));this.duration=this.endTime-this.beginTime;n.endFail&&n.updateEnd(this.endTime);this.titleWidth=-1;this._update()},addTaskWithIndex:function(n,t){n.milestone=this._id;this.t.splice(t,0,n)},removeTask:function(n){this.t.splice(n,1);this.updateTimes()},update:function(){this.titleWidth=-1;this.stringsBlocks=null;this.descStrings=null;this._update()},strafe:function(n){var t=this.endTime-this.beginTime;this.beginTime=n;this.endTime=n+t;this.titleWidth=-1;this._update()},updateBegin:function(){},updateEnd:function(n){var u=!1,f,t,i;if(n<this.endTime)for(f=this.endTime-n,t=0;t<this.t.length;++t)if(r!==this.t[t]._status&&this.endTime>=this.t[t].endTime&&n<=this.t[t].endTime){var e=this.t[t].duration,o=this.t[t].endTime,s=this.t[t].beginTime;this.t[t].endTime=n;this.t[t].beginTime=n-e;this.t[t]._update();(o!==this.t[t].endTime||s!==this.t[t].beginTime)&&(u=!0)}for(i=0;i<this.t.length;++i)this.t[i].endFail&&this.t[i].updateEnd(this.endTime);return this.endTime=n,this.duration=this.endTime-this.beginTime,this.updateTimes(),u},updateEndWithDate:function(n){n.setHours(0);n.setMilliseconds(0);n.setMinutes(0);n.setSeconds(0);this.updateEnd((n.getTime()-e.curTime)/36e5)},calculateTime:function(n){return undefined==e.curDate&&(e.curDate=new Date,e.curDate.setHours(0),e.curDate.setMilliseconds(0),e.curDate.setMinutes(0),e.curDate.setSeconds(0),e.curTime=e.curDate.getTime()),(n.getTime()-e.curDate.getTime())/36e5},updateTimes:function(){var t,i,n;for(this.beginTime=this.endTime,this.beginTime=this.endTime-this.durationMin,t=0;t<this.t.length;++t)this.beginTime=Math.min(this.endTime-this.durationMin,Math.min(this.t[t].beginTime,this.beginTime));for(this.duration=this.endTime-this.beginTime,i=!1,n=0;n<this.t.length;++n)this.t[n].endFail&&this.t[n].updateEnd(this.endTime)&&(i=!0);return this.titleWidth=-1,this._update(),i},formatBeginDate:function(){return this._beginDate.dateFormat()},formatEndDate:function(){this._endDate.setHours(12);var n=this._endDate.dateFormat();return this._endDate.setHours(0),n},daysPastDue:function(){return-Math.floor((this.endTime-24)/24)},completeTasks:function(){for(var n=0,t=0,i=this.t.length,n=0,t=0;n<i;++n)r===this.t[n]._status&&++t;return t},_update:function(){undefined==e.curDate&&(e.curDate=new Date,e.curDate.setHours(0),e.curDate.setMilliseconds(0),e.curDate.setMinutes(0),e.curDate.setSeconds(0),e.curTime=e.curDate.getTime());this._beginDate=new Date(e.curTime+this.beginTime*36e5);this._endDate=new Date(e.curTime+this.endTime*36e5);var n=this._endDate.getMonth()+1;this.titleWithDate=this._title+" "+(this._endDate.getDate()>9?this._endDate.getDate():"0"+this._endDate.getDate())+"."+(n>9?n:"0"+n)+"."+this._endDate.getFullYear()%100},setCollapse:function(n){this.collapse=n;0===this.t.length&&(this.collapse=!1)},title:function(){return this._title},id:function(){return this._id},tasks:function(){return this.t},isKey:function(){return this._isKey},owner:function(){return this._owner},beginDate:function(){return this._beginDate},endDate:function(){return this._endDate},description:function(){return this._description},isMilestone:function(){return this._isMilestone},status:function(){return this._status},responsibles:function(){return this._responsibles}};df.prototype={addTask:function(n){for(var t=0;t<this.m.length;++t)if(this.m[t]._id==n.milestone)return this.m[t].add(n),-1;return this.t.push(n),this._calcTimes(),this.t.length},addTaskWithIndex:function(n,t){this.t.splice(t,0,n)},addMilestone:function(n){this.m.push(n);this._calcTimes()},addMilestoneWithIndex:function(n,t){this.m.splice(t,0,n)},removeMilestone:function(n){n>=0&&n<this.m.length&&this.m.splice(n,1)},removeTask:function(n,t){if(undefined===t){n>=0&&n<this.t.length&&this.t.splice(n,1);this._calcTimes();return}t>=0&&t<this.m.length&&this.m[t].removeTask(n)},endMilestone:function(){return 0===this.m.length?undefined:this.m.last()},getMilestone:function(n){return this.m[n]},isEmpty:function(){return!(this.t.length||this.m.length)},refresh:function(){},formatDate:function(){this.creationDate.setHours(12);var n=this.creationDate.dateFormat();return this.creationDate.setHours(0),n},completeTasks:function(){for(var n=0,t=0,i=this.t.length,n=0,t=0;n<i;++n)r===this.t[n]._status&&++t;return t},_calcTimes:function(){if(this.t.length){this.endFail=!1;this.beginTime=this.t[0].beginTime;this.endTime=this.t[0].endTime;this.t[0].endFail&&(this.endFail=!0);for(var n=this.t.length-1;n>=0;--n)this.beginTime=Math.min(this.t[n].beginTime,this.beginTime),this.endTime=Math.max(this.t[n].endTime,this.endTime),this.t[n].endFail&&(this.endFail=!0)}},setCollapse:function(n){this.collapse=n;this.isLocked()&&(this.collapse=!0)},setFullCollapse:function(n){this.fullCollapse=n;this.isLocked()&&(this.fullCollapse=!0)},isLocked:function(){return 1===this._status||2===this._status},isInReadMode:function(){return ds===this._status},title:function(){return this._title},id:function(){return this._id},description:function(){return this._description},responsibles:function(){return this._responsibles},status:function(){return this._status}};vs.prototype={addProject:function(n){this.pId=Math.max(this.pId,n._id);this.p.push(n);for(var i,t=0;t<this.m.length;++t)this.m[t]._owner==n._id&&(n.addMilestone(this.m[t]),this.m.splice(this.m.indexOf(t),1));for(i=0;i<this.t.length;++i)if(n._id===this.t[i]._owner){for(t=n.m.length-1;t>=0;--t)if(n.m[t]._id===this.t[i].milestone){n.m[t].add(this.t[i]);n.refresh();return}this.p[i].add(this.t[i])}n.refresh()},addMilestone:function(n){for(this.mId=Math.max(this.mId,n._id),this.minTime=this.minTime?Math.min(n.beginTime,this.minTime):n.beginTime,this.maxTime=this.maxTime?Math.max(n.endTime,this.maxTime):n.endTime,t=0;t<this.t.length;++t)this.t[t].milestone==n._id&&(n.add(this.t[t]),this.t.splice(this.t.indexOf(t),1));for(var t=this.p.length-1;t>=0;--t)if(this.p[t]._id==n._owner){this.p[t].addMilestone(n);this.p[t].refresh();return}this.m.push(n)},addMilestoneWithIndex:function(n,t){for(var i=this.p.length-1;i>=0;--i)if(this.p[i]._id==n._owner)return this.p[i].m.splice(t,0,n),!0;return!1},addTask:function(n){var t,i;for(this.tId=Math.max(this.tId,n._id),this.minTime=this.minTime?Math.min(n.beginTime,this.minTime):n.beginTime,this.maxTime=this.maxTime?Math.max(n.endFail?n.beginTime:n.endTime,this.maxTime):n.endFail?n.beginTime:n.endTime,t=this.p.length-1;t>=0;--t)if(this.p[t]._id===n._owner){for(i=this.p[t].m.length-1;i>=0;--i)if(this.p[t].m[i]._id===n.milestone)return this.p[t].m[i].add(n),this.p[t].refresh(),!0;return this.p[t].addTask(n),!0}return this.t.push(n),!1},addTaskFront:function(n){for(var i,t=this.p.length-1;t>=0;--t)if(this.p[t]._id===n._owner)for(i=this.p[t].m.length-1;i>=0;--i)if(this.p[t].m[i]._id===n.milestone)return this.p[t].m[i].t.splice(0,0,n),!0;return!1},addTaskWithIndex:function(n,t){for(var r,i=this.p.length-1;i>=0;--i)if(this.p[i]._id===n._owner){if(-1===n.milestone||undefined===n.milestone)return this.p[i].t.splice(t,0,n),!0;for(r=this.p[i].m.length-1;r>=0;--r)if(this.p[i].m[r]._id===n.milestone)return this.p[i].m[r].t.splice(t,0,n),!0}return!1},clear:function(){this.p=[];this.m=[];this.t=[]},projects:function(){return this.p},endProject:function(){return 0===this.p.length?undefined:this.p.last()},getTask:function(n,t,i){return n>=this.p.length?undefined:undefined===t?i>=this.p[n].t.length?undefined:this.p[n].t[i]:t>=this.p[n].m.length?undefined:i>=this.p[n].m[t].t.length?undefined:this.p[n].m[t].t[i]},getMilestone:function(n,t){return this.p[n].m[t]},getProject:function(n){return n>=this.p.length?undefined:this.p[n]},getTasWithInd:function(n,t,i){return-1===n||-1===i?null:-1===t?this.p[n].t[i]:this.p[n].m[t].t[i]},taskWithId:function(n){for(var i,r,t=this.p.length-1;t>=0;--t){for(i=this.p[t].t.length-1;i>=0;--i)if(this.p[t].t[i]._id===n)return{p:t,m:undefined,t:i,taskId:this.p[t].t[i]._id,milestoneId:undefined,projectId:this.p[t]._id,ref:this.p[t].t[i]};for(i=this.p[t].m.length-1;i>=0;--i)for(r=this.p[t].m[i].t.length-1;r>=0;--r)if(this.p[t].m[i].t[r]._id===n)return{p:t,m:i,t:r,taskId:this.p[t].m[i].t[r]._id,milestoneId:this.p[t].m[i]._id,projectId:this.p[t]._id,ref:this.p[t].m[i].t[r]}}return undefined},milestoneWithId:function(n){for(var i,t=this.p.length-1;t>=0;--t)for(i=this.p[t].m.length-1;i>=0;--i)if(this.p[t].m[i]._id===n)return{p:t,m:i,milestoneId:n,projectId:this.p[t]._id,ref:this.p[t].m[i]};return undefined},milestoneIds:function(n,t){return{p:this.p[n]._id,m:this.p[n].m[t]._id}},taskIds:function(n,t,i){return undefined===t?{p:this.p[n]._id,t:this.p[n].t[i]._id}:{p:this.p[n]._id,m:this.p[n].m[t]._id,t:this.p[n].m[t].t[i]._id}},genRefId:function(){return++this.tId},throughIndexerTasks:function(n){var i,t,u,r=[];if(this.p.length){for(i=0;i<this.p[n].m.length;++i)for(t=0;t<this.p[n].m[i].t.length;++t)r.push(this.p[n].m[i].t[t]._id);for(u=this.p[n].t.length,t=0;t<u;++t)r.push(this.p[n].t[t]._id)}return r},throughIndexerMilestones:function(n){var t,i,r=[];if(this.p.length)for(i=this.p[n].m.length,t=0;t<i;++t)r.push(this.p[n].m[t]._id);return r},throughIdsIndexes:function(n){return{tasks:this.throughIndexerTasks(n),milestones:this.throughIndexerMilestones(n)}},buildWithThroughIndexer:function(){for(var n,r,o,t,e,c,i,l,a=0,y=0,h,u,v,f,s=0;s<this.p.length;++s)if(t=this.p[s],t._indexer){if(v=[],f=[],o=this.p[s]._indexer.milestones,undefined===o)continue;if(o.length){for(i=o.length,n=0;n<i;++n)for(c=o[n],l=t.m.length,r=0;r<l;++r)if(t.m[r].id()===c){v.push(t.m[r]);f.push(r);break}if(this.p[s].m.length>v.length){for(n=0;n<l;++n)-1==f.indexOf(n)&&v.push(t.m[n]);f=[]}this.p[s].m=v}if(o=this.p[s]._indexer.tasks,o.length){for(l=t.m.length,r=0;r<l;++r)if(e=[],f=[],i=t.m[r].t.length,i){for(y=a+i,h=a;h<y;++h)for(c=o[h],u=0;u<i;++u)if(t.m[r].t[u].id()===c){e.push(t.m[r].t[u]);f.push(u);break}if(i>e.length){for(n=0;n<i;++n)-1==f.indexOf(n)&&e.push(t.m[r].t[n]);f=[]}t.m[r].t=e;a+=i}if(e=[],f=[],i=t.t.length,i){for(y=a+i,h=a;h<y;++h)for(c=o[h],u=0;u<i;++u)if(t.t[u].id()===c){e.push(t.t[u]);f.push(u);break}if(i>e.length){for(n=0;n<i;++n)-1==f.indexOf(n)&&e.push(t.t[n]);f=[]}t.t=e}}}}};gf.prototype={addMilestoneOperation:function(n,t,i){var r=this.delegate,u,f;if(r){u=r.storage.milestoneIds(t,i);f=r.storage.getMilestone(t,i);this.top={id:n,p:t,m:i,t:undefined,ids:u};switch(n){case fr:r.handlers[n]?r.handlers[n](u.p,u.m,f):this.deleteElement(this.top);break;case si:r.handlers[n]?r.handlers[n](u.p,u.m,f):this.completeElement(this.top)}}},addTaskOperation:function(n,t,i,r,u){var f=this.delegate,o,e,s,h;if(f){if(tu===n){this.top={id:n,link:t};f.handlers[n]&&(s=f.storage.taskWithId(t.dependenceTaskId),h=f.storage.taskWithId(t.parentTaskId),f.handlers[n](t,s.ref,h.ref));return}if(sf===n){this.top={id:n,link:t};f.handlers[n]&&f.handlers[n](t,t.task,t.parent);return}if(er===n){this.top={id:n,move:t};f.handlers[n]&&f.handlers[n](t);return}if(yh===n){this.top={id:n,element:t};f.handlers[n]&&f.handlers[n](t);return}e=f.storage.taskIds(t,i,r);o=f.storage.getTask(t,i,r);this.top={id:n,p:t,m:i,t:r,ids:e};switch(n){case ur:f.handlers[n]?f.handlers[n](e.p,e.m,e.t,o,this.collectLinks(t,i,o._id)):this.deleteElement(this.top);break;case wi:f.handlers[n]?f.handlers[n](e.p,e.m,e.t,o,u):this.completeElement(this.top)}}},finalize:function(n){if(this.top){switch(this.top.id){case ur:this.deleteElement(this.top);break;case fr:this.deleteElement(this.top);break;case si:this.completeElement(this.top);break;case wi:this.completeElement(this.top,n);break;case sf:this.addLink(this.top.link);break;case tu:this.deleteLink(this.top.link);break;case er:"SaveConnections"===n?this.moveGroupTasks(this.top.move):this.moveTask(this.top.move)}this.top=null}},clear:function(){var n=this.delegate;n&&(n._undoManager.reset(),n.storage.clear(),n.hitLink=undefined,n.zoomBar.needRepaint(),n.offWidgets(),n.offMenus(),n.updateContent(),n.viewController().strafeToDay())},deleteElement:function(n){var t=this.delegate,u;if(t){var i=null,f=null,r=0;if(n.p===undefined&&(n.p=-1),n.m===undefined&&(n.m=-1),n.t===undefined&&(n.t=-1),t.rightScroll.save(),-1!==n.m&&-1===n.t&&-1!==n.p&&(i=t.storage.getMilestone(n.p,n.m),i)){for(i.dropDownWidget=!1,t._undoManager.add(ru,{p:n.p,m:n.m,t:i,index:n.m,taskId:undefined,milestoneId:n.ids.m,projectId:n.ids.m}),t._undoManager.updateOperation(0,i),u=t.storage.p[n.p].t,r=0;r<i.t.length;++r)u.push(i.t[r]),u.last().milestone=-1;t.storage.p[n.p].removeMilestone(n.m)}-1===n.m&&-1!==n.t&&-1!==n.p&&(t.taskDescWidget.check(null),i=t.storage.getTask(n.p,undefined,n.t),i&&(f=this.collectLinks(n.p,undefined,n.ids.t),this.removeLinks(n.p,undefined,n.ids.t),t.storage.p[n.p].removeTask(n.t),t._undoManager.reset()));-1!==n.m&&-1!==n.t&&-1!==n.p&&(t.taskDescWidget.check(null),i=t.storage.getTask(n.p,n.m,n.t),i&&(f=this.collectLinks(n.p,n.m,n.ids.t),this.removeLinks(n.p,n.m,n.ids.t),t.storage.p[n.p].m[n.m].removeTask(n.t),t._undoManager.reset()));t.offMenus();t.offWidgets();t.painter.clearZones(!0);t.needUpdateContent=!0;t.leftPanelController().clearFocus();t.update()}},completeElement:function(n,t){var f=this.delegate,i=null,e,u,o,t;f&&(n.p===undefined&&(n.p=-1),n.m===undefined&&(n.m=-1),n.t===undefined&&(n.t=-1),-1!==n.m&&-1===n.t&&-1!==n.p&&(i=f.storage.getMilestone(n.p,n.m),i&&(u=i._status,e=i._status,u=u!=r-1?r-1:tt-1,f._undoManager.add(fu,{p:n.p,m:n.m,t:i,index:n.m,newStatus:u,oldStatus:e,taskId:undefined,milestoneId:n.ids.m,projectId:n.ids.m}),i._status=u,f._undoManager.updateOperation(0,i))),-1===n.m&&-1!==n.t&&-1!==n.p&&(i=f.storage.getTask(n.p,undefined,n.t),i&&(u=t,e=i._status,f._undoManager.add(sr,{p:n.p,m:undefined,t:i,index:n.t,newStatus:u,oldStatus:e,taskId:n.ids.t,milestoneId:n.ids.m,projectId:n.ids.m}),o=lr(function(n){return n.id===u}),i._status=o.statusType,i._customTaskStatus=u,f._undoManager.updateOperation(0,i))),-1!==n.m&&-1!==n.t&&-1!==n.p&&(i=f.storage.getTask(n.p,n.m,n.t),i&&(u=t,e=i._status,f._undoManager.add(sr,{p:n.p,m:n.m,t:i,index:n.t,newStatus:u,oldStatus:e,taskId:n.ids.t,milestoneId:n.ids.m,projectId:n.ids.m}),t=ASC.Projects.Master.customStatuses.find(function(n){return n.id===u}),i._status=t.statusType,i._customTaskStatus=u,f._undoManager.updateOperation(0,i))),f.leftPanelController().clearFocus(),f.updateData())},checkStatus:function(n){var i=this.delegate,t=null;return i&&(n.p===undefined&&(n.p=-1),n.m===undefined&&(n.m=-1),n.t===undefined&&(n.t=-1),-1!==n.m&&-1!==n.t&&-1!==n.p&&(t=i.storage.getMilestone(n.p,n.m),t&&1===t._status))?!1:!0},changeTime:function(n,t,i,r){var f=this.delegate,u=null,e,o;f&&(n.p===undefined&&(n.p=-1),n.m===undefined&&(n.m=-1),n.t===undefined&&(n.t=-1),-1!==n.m&&-1===n.t&&-1!==n.p&&(u=f.storage.getMilestone(n.p,n.m),u&&(f._undoManager.add(or,{p:n.p,m:n.m,t:u,index:n.m,newStatus:o,oldStatus:e,taskId:undefined,milestoneId:n.ids.m,projectId:n.ids.m}),u.updateEndWithDate(t),f._undoManager.updateOperation(0,u))),-1===n.m&&-1!==n.t&&-1!==n.p&&(u=f.storage.getTask(n.p,undefined,n.t),u&&(f._undoManager.add(ri,{p:n.p,m:undefined,t:u,index:n.t,newStatus:o,oldStatus:e,taskId:n.ids.t,milestoneId:n.ids.m,projectId:n.ids.m}),i?(u.updateEndWithDate(t,r),u.endFail=!1):u.updateBeginWithDate(t,r),f._undoManager.updateOperation(0,u))),-1!==n.m&&-1!==n.t&&-1!==n.p&&(u=f.storage.getTask(n.p,n.m,n.t),u&&(f._undoManager.add(ri,{p:n.p,m:n.m,t:u,index:n.t,newStatus:o,oldStatus:e,taskId:n.ids.t,milestoneId:n.ids.m,projectId:n.ids.m}),i?(u.updateEndWithDate(t,r),u.endFail=!1):u.updateBeginWithDate(t,r),f._undoManager.updateOperation(0,u))),f.updateData())},changeResponsible:function(n,t){function u(n,t){if(n.length!=t.length)return!1;for(var r=n.length,u=[],i=0,i=0;i<r;++i)u.push(n[i].id);for(i=0;i<r;++i)if(-1===u.indexOf(t[i].id))return!1;return!0}var r=this.delegate,i=null;if(r){if(n.p===undefined&&(n.p=-1),n.m===undefined&&(n.m=-1),n.t===undefined&&(n.t=-1),-1!==n.m&&-1===n.t&&-1!==n.p&&(i=r.storage.getMilestone(n.p,n.m),i)){if(n.ref._responsibles&&t&&n.ref._responsibles.id===t.id)return;r._undoManager.add(ki,{p:n.p,m:n.m,isMilestone:!0,index:n.m,newResponsibles:t,oldResponsibles:n.ref._responsibles,taskId:undefined,milestoneId:n.ids.m,projectId:n.ids.m});i._responsibles=t;r._undoManager.updateOperation(!0,i)}if(-1===n.m&&-1!==n.t&&-1!==n.p&&(i=r.storage.getTask(n.p,undefined,n.t),i)){if(u(n.ref._responsibles,t))return;r._undoManager.add(ki,{p:n.p,m:undefined,index:n.t,newResponsibles:t,oldResponsibles:n.ref._responsibles,taskId:n.ids.t,milestoneId:n.ids.m,projectId:n.ids.m});i._responsibles=t;r._undoManager.updateOperation(!0,i)}if(-1!==n.m&&-1!==n.t&&-1!==n.p&&(i=r.storage.getTask(n.p,n.m,n.t),i)){if(u(n.ref._responsibles,t))return;r._undoManager.add(ki,{p:n.p,m:n.m,index:n.t,newResponsibles:t,oldResponsibles:n.ref._responsibles,taskId:n.ids.t,milestoneId:n.ids.m,projectId:n.ids.m});i._responsibles=t;r._undoManager.updateOperation(!0,i)}r.updateData()}},applyNewAddTaskId:function(n){var i=this.delegate,t=null,r=null;i&&(n=parseInt(n),t=i._undoManager.currentOperation(),t&&!isNaN(n)&&(t.arg.taskId=n,t.arg.t._id=n,r=i.storage.getTask(t.arg.p,t.arg.m,t.arg.index),r&&(r._id=n)))},applyNewAddMilestoneId:function(n,t){var r=this.delegate,i,u;r&&(n=parseInt(n),i=r._undoManager.currentOperation(),i&&!isNaN(n)&&(i.arg.milestoneId=n,i.arg.t._id=n,t&&(i._responsibles=t),u=r.storage.getMilestone(i.arg.p,i.arg.index),u&&(u._id=n,t&&(u._responsibles=t)),r.updateData()))},addTask:function(n,t,i,r,u,f,o,s,h,c,l,a,v,y,p,w,b){var d=this.delegate,g=null,k=null;d&&(g=new e(n,t,i,r,u,f,o,s,h,c,l,a,v,y,w,b),d.storage.addTask(g),p&&(k=d.storage.taskWithId(n),k&&d._undoManager.add(ui,{p:k.p,m:k.m,t:k.ref,index:k.t,taskId:k.taskId,milestoneId:k.milestoneId,projectId:k.projectId})))},addMilestone:function(n,t,i,r,u,f,e,o,s){var c=this.delegate,l=null,h=null;c&&(l=new vu(n,t,i,r,u,f,e,o),c.storage.addMilestone(l),s&&(h=c.storage.milestoneWithId(n),h&&c._undoManager.add(hi,{p:h.p,m:h.m,t:h.ref,index:h.m,milestoneId:h.milestoneId,projectId:h.projectId})))},addProject:function(n,t,i,r,u,f,e,o){var s=this.delegate,h=null;s&&(h=new df(n,t,i,r,u,f,e,o),s.storage.addProject(h))},moveTask:function(n){var t=this.delegate,r=0,u=0,i=null;if(t){if("MtoF"===n.type&&(this.removeLinks(n.fromProject,n.fromMilestone,n.taskId),n.t.milestone=-1,r=t.storage.p[0].addTask(n.t),t.storage.p[0].m[n.m].removeTask(n.index),u=t.getElementPosVertical(0,-1,r),t.animator.moveToY(Math.min(Math.max(0,u-t.ctxHeight*.5),t.rightScroll._maxValue-t.rightScroll.viewWidth)),n.place=r-1),"MtoM"===n.type&&(this.removeLinks(n.fromProject,n.fromMilestone,n.taskId),t.storage.p[n.toProject].m[n.toMilestone].addTaskWithIndex(n.t,n.place),t.storage.p[n.fromProject].m[n.fromMilestone].removeTask(n.index),t.storage.p[n.fromProject].m[n.fromMilestone].updateTimes(),t.storage.p[n.toProject].m[n.toMilestone].updateTimes()),"FtoM"===n.type){this.removeLinks(n.fromProject,n.fromMilestone,n.taskId);i=t.storage.p[n.toProject].m[n.toMilestone];i&&n.t.endFail&&n.t.beginTime>=i.endTime&&n.t.updateBegin(i.endTime-24);t.storage.p[n.toProject].m[n.toMilestone].addTaskWithIndex(n.t,n.place);t.storage.p[n.fromProject].removeTask(n.index);i.updateTimes();t._undoManager.add(dt,n);n.t.endFail&&n.t.beginTime>=i.endTime&&n.t.updateBegin(i.endTime-24);t._undoManager.performTop();t.updateData();return}t._undoManager.add(dt,n);t._undoManager.performTop();t.updateData()}},moveGroupTasks:function(n){var i=this.delegate,t=0,e,o,f,r,s,u;if(i){if(f=this.collectRelatedItems(n.fromProject,n.fromMilestone,n.taskId),r=this.collectTasksWithIds(n.fromProject,n.fromMilestone,f),n.group=r,n.tasksIds=f,"MtoF"===n.type){for(n.sourceMilestone=i.storage.p[n.fromProject].m[n.fromMilestone]._id,n.destMilestone=undefined,t=0;t<r.length;++t)r[t].task.milestone=-1,o=i.storage.p[n.fromProject].addTask(r[t].task,!0),n.taskId===r[t].id&&(e=o);for(t=r.length-1;t>=0;--t)i.storage.p[n.fromProject].m[n.fromMilestone].removeTask(r[t].index);i.storage.p[n.fromProject].m[n.fromMilestone].updateTimes();i.storage.p[n.fromProject]._calcTimes();s=i.getElementPosVertical(0,-1,e);i.animator.moveToY(Math.min(Math.max(0,s-i.ctxHeight*.5),i.rightScroll._maxValue-i.rightScroll.viewWidth))}if("MtoM"===n.type){for(n.sourceMilestone=i.storage.p[n.fromProject].m[n.fromMilestone]._id,n.destMilestone=i.storage.p[n.toProject].m[n.toMilestone]._id,t=0;t<r.length;++t)r[t].task.milestone=n.destMilestone,i.storage.p[n.toProject].m[n.toMilestone].t.push(r[t].task);for(t=r.length-1;t>=0;--t)i.storage.p[n.fromProject].m[n.fromMilestone].removeTask(r[t].index);i.storage.p[n.fromProject].m[n.fromMilestone].updateTimes();i.storage.p[n.toProject].m[n.toMilestone].updateTimes()}if("FtoM"===n.type){for(n.sourceMilestone=undefined,n.destMilestone=i.storage.p[n.toProject].m[n.toMilestone]._id,u=i.storage.p[n.toProject].m[n.toMilestone],t=0;t<r.length;++t)r[t].task.endFail&&r[t].task.beginTime>=u.endTime&&r[t].task.updateBegin(u.endTime-24),r[t].task.milestone=n.destMilestone,i.storage.p[n.toProject].m[n.toMilestone].t.push(r[t].task);for(t=r.length-1;t>=0;--t)i.storage.p[n.fromProject].removeTask(r[t].index);u.updateTimes();i.storage.p[n.fromProject]._calcTimes()}i._undoManager.add(uu,n);i._undoManager.performTop()}},addLink:function(n){var r=this.delegate,f=it,e=0,u=0,o=null,i={},t=null,h=null,l=null;if(r){if(s===n.parentSide&&c===n.side?(o=n.parent,e=n.task._id,u=n.parent._id):(s===n.parentSide&&s===n.side?f=wt:c===n.parentSide&&c===n.side&&(f=bt),o=n.task,e=n.parent._id,u=n.task._id),is&&it!==f)return;i={};i.dependenceTaskId=u;i.linkType=f;i.parentTaskId=e;i.type="link";o.links.push(i);t=r.storage.taskWithId(u);t&&(h=r.storage.taskWithId(u),l=r.storage.taskWithId(e),r._undoManager.add(hr,{p:t.p,m:t.m,t:t.t,link:t.ref.links[t.ref.links.length-1],linkIndex:t.ref.links.length-1,taskId:t.taskId,milestoneId:t.milestoneId,projectId:t.projectId,depIndexer:h,parIndexer:l}))}},deleteLink:function(n){var u=this.delegate,i=0,f,e,o,s,h,t=null,r=-1;if(u&&n&&(h=n.dependenceTaskId||n.dependenceTaskId,t=u.storage.taskWithId(h),t)){for(i=t.ref.links.length-1;i>=0;--i)if(f=n.dependenceTaskId||n.dependenceTaskId,e=n.parentTaskId||n.parentTaskId,o=t.ref.links[i].dependenceTaskId||t.ref.links[i].dependenceTaskId,s=t.ref.links[i].parentTaskId||t.ref.links[i].parentTaskId,o===f&&s===e){r=i;break}-1!==r&&(u._undoManager.add(eu,{p:t.p,m:t.m,t:t.t,link:t.ref.links[r],linkIndex:r,taskId:t.taskId,milestoneId:t.milestoneId,projectId:t.projectId}),t.ref.links.splice(r,1),u.updateData())}},collectLinks:function(n,t,i){var c=this.delegate,l=[],r=0,u=null,f=0,e=0,h=0,o=null,s=null;if(c)if(undefined!==t)for(o=c.storage.getMilestone(n,t),r=o.t.length-1;r>=0;--r)for(f=o.t[r].links.length-1;f>=0;--f)u=o.t[r].links[f],h=u.parentTaskId||u.parentTaskId,e=u.dependenceTaskId||u.dependenceTaskId,(i===e||i===h)&&o.t[r].id()===e&&l.push({link:u,index:f,ind:r});else for(s=c.storage.p[n],r=s.t.length-1;r>=0;--r)for(f=s.t[r].links.length-1;f>=0;--f)u=s.t[r].links[f],h=u.parentTaskId||u.parentTaskId,e=u.dependenceTaskId||u.dependenceTaskId,(i===e||i===h)&&s.t[r].id()===e&&l.push({link:u,index:f,ind:r});return l},removeLinks:function(n,t,i){var c=this.delegate,r=0,u=null,f=0,s=0,h=0,e=null,o=null;if(c)if(undefined!==t)for(e=c.storage.getMilestone(n,t),r=e.t.length-1;r>=0;--r)for(f=e.t[r].links.length-1;f>=0;--f)u=e.t[r].links[f],h=u.parentTaskId||u.parentTaskId,s=u.dependenceTaskId||u.dependenceTaskId,(i===s||i===h)&&e.t[r].links.splice(f,1);else for(o=c.storage.p[n],r=o.t.length-1;r>=0;--r)for(f=o.t[r].links.length-1;f>=0;--f)u=o.t[r].links[f],h=u.parentTaskId||u.parentTaskId,s=u.dependenceTaskId||u.dependenceTaskId,(i===s||i===h)&&(u=o.t[r].links.splice(f,1))},collectRelatedItems:function(n,t,i){var k=this.delegate,r,h,e,c,y,b,p,l=[],o={},u,a,v,f=null,s=[],w=[];if(k){if(p=this.getTasks(n,t),0===p.length)return l;for(r=p.length-1;r>=0;--r)for(b=p[r].links.length-1;b>=0;--b){if(y=p[r].links[b],a=y.parentTaskId||y.parentTaskId,v=y.dependenceTaskId||y.dependenceTaskId,o[v]||(o[v]={links:[]}),u=o[v].links,u){for(c=!0,e=u.length-1;e>=0;--e)if(u[e]===a){c=!1;break}c&&u.push(a)}if(o[a]||(o[a]={links:[]}),u=o[a].links,u){for(c=!0,e=u.length-1;e>=0;--e)if(u[e]===v){c=!1;break}c&&u.push(v)}}if(f=o[i],!f)return[];for(s=[],w=[],l.push(i),s.push(i),r=f.links.length-1;r>=0;--r)s.push(f.links[r]),l.push(f.links[r]);for(;;){for(w=[],r=s.length-1;r>=0;--r)if(i!==s[r])for(f=o[s[r]],h=f.links.length-1;h>=0;--h)-1===l.indexOf(f.links[h])&&(w.push(f.links[h]),l.push(f.links[h]));if(0===w.length)break;s=w}return l}return[]},getTasks:function(n,t){return undefined!==t?this.delegate.storage.getMilestone(n,t).t:this.delegate.storage.p[n].t},collectTasksWithIds:function(n,t,i){for(var r=0,f=[],u=this.getTasks(n,t),e=u.length,r=0;r<e;++r)-1!==i.indexOf(u[r]._id)&&f.push({task:u[r],index:r,id:u[r]._id});return f},collectBeginEndItems:function(n,t,i){function k(n){for(var i=0,t=n.length-1;t>=0;--t)n[t].links.length&&++i;return i}function d(i,f){var o,p,s;for(++c,o=0,o=0;o<u.length;++o)if(u[o].links.length&&u[o]._id!==i.data.id&&f!==u[o]._id&&(a=y.indexOf(u[o]._id),-1!==a&&(e=u[o].getLink(i.data.id),e&&(p=e.linkType||e.linkType,p==it&&u[o]._status!==r)))){if(h={p:n,m:t,t:o,ref:u[o],id:u[o]._id},s=i.createNode(),s.root=u[o],s.data=h,v<c){l=!0;return}if(d(s,u[o]._id),l)return}--c}function nt(i){var o,a,y;for(++c,o=0,o=0;o<i.data.ref.links.length;++o)if(e=i.data.ref.links[o],e&&(a=e.linkType||e.linkType,a==it))for(f=0;f<u.length;++f)if(y=e.parentTaskId||e.parentTaskId,u[f]._id===y&&u[f]._status!==r){if(h={p:n,m:t,t:f,ref:u[f],id:u[f]._id},s=i.createNode(),s.root=u[f],s.data=h,v<c){l=!0;return}if(u[f].links.length&&nt(s,u[f]._id),l)return;break}--c}var f=0,o=0,e=null,a=-1,h=[],s=null,l=!1,v=0,c=0,y=null,p=this.delegate.storage.taskWithId(i).ref,u=this.getTasks(n,t),w=new hu,b=new hu,g,tt,rt;if(y=this.collectBeginEndLinksRight(n,t,i),y.length)for(w.root=p,v=k(u),c=0,o=0;o<u.length;++o)u[o].links.length&&u[o]._id!==i&&(a=y.indexOf(u[o]._id),-1!==a&&(e=u[o].getLink(i),e&&(g=e.linkType||e.linkType,g==it&&u[o]._status!==r&&(h={p:n,m:t,t:o,ref:u[o],id:u[o]._id},s=w.createNode(),s.root=u[o],s.data=h,d(s,u[o]._id)))));if(l)return null;for(b.root=p,v=k(u),c=0,o=0;o<p.links.length;++o)if(e=p.links[o],e&&(tt=e.linkType||e.linkType,tt==it))for(f=0;f<u.length;++f)if(rt=e.parentTaskId||e.parentTaskId,u[f]._id===rt&&u[f]._status!==r){h={p:n,m:t,t:f,ref:u[f],id:u[f]._id};s=b.createNode();s.root=u[f];s.data=h;u[f].links.length&&nt(s,u[f]._id);break}return l?null:{right:w,left:b}},collectBeginEndLinksRight:function(n,t,i){var g=this.delegate,r,a,o,v,c,e,w,y=[],s={},f,nt,p,h,u=null,b=-1,d=null,l=[],k=[];if(g){if(w=this.getTasks(n,t),0===w.length)return y;for(r=w.length-1;r>=0;--r)for(e=w[r].links.length-1;e>=0;--e)if(c=w[r].links[e],nt=c.linkType||c.linkType,nt===it){if(p=c.dependenceTaskId||c.dependenceTaskId,h=c.parentTaskId||c.parentTaskId,s[p]||(s[p]={links:[]}),f=s[p].links,f){for(v=!0,o=f.length-1;o>=0;--o)if(f[o]===h){v=!1;break}v&&f.push(h)}if(s[h]||(s[h]={links:[]}),f=s[h].links,f){for(v=!0,o=f.length-1;o>=0;--o)if(f[o]===p){v=!1;break}v&&f.push(p)}}if(u=s[i],!u)return[];for(b=-1,d=g.storage.taskWithId(i),e=d.ref.links.length-1;e>=0;--e)h=d.ref.links[e].parentTaskId||d.ref.links[e].parentTaskId,b=u.links.indexOf(h),-1!==b&&u.links.splice(b,b);for(l=[],k=[],y.push(i),l.push(i),r=u.links.length-1;r>=0;--r)l.push(u.links[r]),y.push(u.links[r]);for(;;){for(k=[],r=l.length-1;r>=0;--r)if(i!==l[r])for(u=s[l[r]],a=u.links.length-1;a>=0;--a)-1===y.indexOf(u.links[a])&&(k.push(u.links[a]),y.push(u.links[a]));if(0===k.length)break;l=k}return y}return[]},setFilter:function(n){var t=this.delegate;t&&(t._undoManager.reset(),t.hitLink=undefined,this.clearFilter(!1),this.updateFilter(n),t.updateContent(!0),t.viewController().toVisibleElementMove(),t.offWidgets())},updateFilter:function(n){var t,u,i,f,r=this.delegate.storage.p,o,e;if(r.length){for(i=r.length-1;i>=0;--i){for(t=r[i].m.length-1;t>=0;--t)for(n(r[i].m[t]),u=r[i].m[t].t.length-1;u>=0;--u)n(r[i].m[t].t[u]);for(t=r[i].t.length-1;t>=0;--t)n(r[i].t[t])}for(i=r.length-1;i>=0;--i){for(t=r[i].m.length-1;t>=0;--t)for(u=r[i].m[t].t.length-1;u>=0;--u)if(r[i].m[t].t[u].filter)for(o=this.collectRelatedItems(i,t,r[i].m[t].t[u].id()),e=this.collectTasksWithIds(i,t,o),f=e.length-1;f>=0;--f)if(!e[f].task.filter){r[i].m[t].t[u].filter=undefined;r[i].m[t].t[u].linkFilter=!0;break}for(t=r[i].t.length-1;t>=0;--t)if(r[i].t[t].filter)for(o=this.collectRelatedItems(i,undefined,r[i].t[t].id()),e=this.collectTasksWithIds(i,undefined,o),f=e.length-1;f>=0;--f)if(!e[f].task.filter){r[i].t[t].filter=undefined;r[i].t[t].linkFilter=!0;break}}}},clearFilter:function(n){var t,u,i,r=this.delegate.storage.p;if(r.length)for(i=r.length-1;i>=0;--i){for(t=r[i].m.length-1;t>=0;--t)for(r[i].m[t].filter=undefined,u=r[i].m[t].t.length-1;u>=0;--u)r[i].m[t].t[u].filter=undefined,r[i].m[t].t[u].linkFilter=undefined;for(t=r[i].t.length-1;t>=0;--t)r[i].t[t].filter=undefined,r[i].t[t].linkFilter=undefined}n&&(this.delegate.updateContent(!0),this.delegate.viewController().toVisibleElementMove())},addLinkWithIds:function(n){var r=this.delegate,t=null,i={};r&&(t=r.storage.taskWithId(n.dependenceTaskId),t&&(i.dependenceTaskId=n.dependenceTaskId,i.linkType=n.linkType,i.parentTaskId=n.parentTaskId,i.type="link",t.ref.links.push(i),r._undoManager.add(hr,{p:t.p,m:t.m,t:t.t,link:t.ref.links[t.ref.links.length-1],linkIndex:t.ref.links.length-1,taskId:t.taskId,milestoneId:t.milestoneId,projectId:t.projectId})))},finalizeStatus:function(n){this.statusElement&&(undefined!==this.statusElement.t?n!==this.statusElement.status&&this.addTaskOperation(wi,this.statusElement.p,this.statusElement.m,this.statusElement.t,n):(n=n?r-1:tt-1,n!==this.statusElement.status&&this.addMilestoneOperation(si,this.statusElement.p,this.statusElement.m)),this.statusElement=null)},finalizeOperation:function(n,t){var e=this.delegate,s,u,f,o,i;if(e&&this.statusElement){if(this.statusElement.isTask){if("edit"===n)e.editElementTitle(this.statusElement.p,this.statusElement.m===undefined?-1:this.statusElement.m,this.statusElement.t);else if("delete"===n)this.addTaskOperation(ur,this.statusElement.p,this.statusElement.m,this.statusElement.t);else if(typeof n=="number")this.statusElement.ref&&n!==this.statusElement.ref.customTaskStatus()&&this.addTaskOperation(wi,this.statusElement.p,this.statusElement.m,this.statusElement.t,n);else if("addlink"===n)r!==this.statusElement.task._status&&e.handlers[iu]&&(s=e.storage.getTask(this.statusElement.p,this.statusElement.m,this.statusElement.t),e.handlers[iu](s));else if("responsible"===n)this.changeResponsible(this.statusElement,t);else if("timechanage"===n){if(o=!1,i=t.time,t.direction){if(f=this.statusElement.ref.endDate(),f.getUTCDate()===i.getUTCDate()&&f.getMonth()===i.getMonth()&&f.getFullYear()===i.getFullYear())return;u=this.statusElement.ref.beginDate();o=u.getUTCDate()===i.getUTCDate()&&u.getMonth()===i.getMonth()&&u.getFullYear()===i.getFullYear();this.statusElement.ref.beginDate().getTime()>=t.time.getTime()&&(o=!0)}else{if(f=this.statusElement.ref.beginDate(),f.getUTCDate()===i.getUTCDate()&&f.getMonth()===i.getMonth()&&f.getFullYear()===i.getFullYear())return;u=this.statusElement.ref.endDate();o=u.getUTCDate()===i.getUTCDate()&&u.getMonth()===i.getMonth()&&u.getFullYear()===i.getFullYear();this.statusElement.ref.endDate().getTime()<=t.time.getTime()&&(o=!0)}this.changeTime({p:this.statusElement.p,m:this.statusElement.m,t:this.statusElement.t,ids:this.statusElement.ids},t.time,t.direction,o)}}else"edit"===n?e.editElementTitle(this.statusElement.p,this.statusElement.m,-1):"delete"===n?this.addMilestoneOperation(fr,this.statusElement.p,this.statusElement.m):"open"===n?this.statusElement.ref&&r-1===this.statusElement.ref.status()&&this.addMilestoneOperation(si,this.statusElement.p,this.statusElement.m):"closed"===n?this.statusElement.ref&&r-1!==this.statusElement.ref.status()&&this.addMilestoneOperation(si,this.statusElement.p,this.statusElement.m):"addMilestoneTask"===n?e.addTaskToMilestone(this.statusElement.p,this.statusElement.m):"fitToScreen"===n?this.delegate.viewController().zoomToFitMilestone(this.statusElement.p,this.statusElement.m):"responsible"===n?this.changeResponsible(this.statusElement,t):"timechanage"===n&&this.statusElement.ref.endDate().getTime()!==t.time.getTime()&&this.changeTime({p:this.statusElement.p,m:this.statusElement.m,t:undefined,ids:this.statusElement.ids},t.time);this.statusElement=null}},throughIdsIndexes:function(n){if(undefined===n)n=0;else for(var t=this.delegate.storage.p.length-1;t>=0;--t)if(n===this.delegate.storage.p[t]._id){n=t;break}return this.delegate.storage.throughIdsIndexes(n)},buildWithThroughIndexer:function(){return this.delegate.storage.buildWithThroughIndexer()}};ne.prototype={scaleTo:function(n,t,i){var r=this.delegate;r&&(this.disableScaleEvents=undefined!==i,t?r.animator.scale(n,undefined,undefined,!0):r.animator.scale(n))},strafeToDay:function(){var n=this.delegate;n&&this.strafe(n.centerScreen/n.timeScale.hourInPixels)},strafe:function(n){var t=this.delegate;t&&(t.offsetX=n,t.timeScale&&t.timeScale.strafe(n),t.needUpdate=!0)},toVisibleElementMove:function(){var n=this.delegate,i=null,u=0,r=null,f=0;n&&n.zoomBar&&(n.zoomBar.calc(),i=n.getTopElementInVisibleRange(),n.fullscreen||(i.height=Math.max(o,i.height-n.itemMargin)),i.empty?(r=n.getLeftMostElement(),r.x&&r.height&&(n.offsetX=(-r.x+24)/n.timeScale.scaleX+n.visibleLeft/n.timeScale.hourInPixels,n.timeScale.strafe(n.offsetX))):(n.fullscreen||(i.height=t(i.height/n.itemMargin)*n.itemMargin-o),u=t(n.rightScroll.maxValue()/n.itemMargin)*n.itemMargin-o,n.rightScroll.setWorldValue(Math.min(i.height,u),!0)),f=-Math.max(Math.abs(n.storage.minTime?n.storage.minTime:0),Math.abs(n.storage.maxTime?n.storage.maxTime:0)),n.zoomBar.setRangeTimes(f))},centeringElement:function(n,i,r,u){var f=this.delegate,e,s,h;f&&n&&(e=null,e=i?f.storage.milestoneWithId(n):f.storage.taskWithId(n),e&&(s=f.getElementPosVertical(e.p,e.m>-1?e.m:-1,e.t>-1?e.t:-1)-f.ctxHeight*.5,h=t(f.rightScroll.maxValue()/f.itemMargin)*f.itemMargin,s=t(s/f.itemMargin)*f.itemMargin,f.animator.moveToY(Math.min(Math.max(o,s),h),r),undefined===u&&f.animator.moveCenterToX(e.ref.beginTime)))},buildZoomBar:function(n){var t=this.delegate;return t&&n?(t.zoomBar||(t.zoomBar=new bf(n,t),t.needUpdateContent=!0),t.zoomBar):null},enableSlipAnimation:function(n){var t=this.delegate;t&&(t.animator.strafeTo=n,t.animator.scaleTo=n,t.animator.scrollTo=n)},zoomToFitMilestone:function(n,t){var i=this.delegate,r=0,u=0,e=0,o=0,s=0,f;i&&i.zoomBar&&(r=i.storage.getMilestone(n,t).beginTime,u=i.storage.getMilestone(n,t).endTime,e=(i.zoomBar.rightDate.getTime()-i.zoomBar.leftDate.getTime())/36e5,o=(i.zoomBar.thumb.begin-.5)*e,s=(i.zoomBar.thumb.end-.5)*e,s-o<u-r?(this.disableScaleEvents=!1,f=i.timeScale.scaleX*(u-r)/(s-o)*1.05,f=Math.min(Math.max(f,gi),gt),i.animator.moveScale(f,(u+r)*.5)):i.animator.moveCenterToX((u+r)*.5))},fullscreen:function(){var n=this.delegate;n&&(n.offMenus(),n.offWidgets(),n.painter.clearZones(!0),n.needUpdateContent=!0,n.needUpdate=!0)},disableUserEvents:function(n){if(undefined!==n){var t=this.delegate;t&&(t.userEvents=!(n||!1),t.offMenus(),t.isLBMDown=!1,t.needUpdate=!0)}},collapse:function(n){var t=this.delegate,u,i,r;if(t&&!t.fullscreen)for(u=n||!1,i=t.storage.p.length-1;i>=0;--i){for(r=t.storage.p[i].m.length-1;r>=0;--r)t.storage.p[i].m[r].setCollapse(u);t.storage.p[i].setCollapse(u)}},collapseProjects:function(n){var t=this.delegate,r,i;if(t&&!t.fullscreen)for(r=n||!1,i=t.storage.p.length-1;i>=0;--i)t.storage.p[i].setFullCollapse(r)},collapseFreeTasks:function(n){var t=this.delegate,r,i;if(t&&!t.fullscreen)for(r=n||!1,i=t.storage.p.length-1;i>=0;--i)t.storage.p[i].collapse=r},scaleValue:function(){return this.delegate.timeScale.scaleX},saveViewState:function(){var n=this.delegate,i,t;if(n&&(this.position={posX:n.offsetX,posY:n.rightScroll.value(),collapse:[],freecollapse:!1},n.storage.p.length)){for(i=n.storage.p[0].m.length,t=0;t<i;++t)this.position.collapse.push({id:n.storage.p[0].m[t].id(),status:n.storage.p[0].m[t].collapse});this.position.freecollapse=n.storage.p[0].collapse}},loadViewState:function(n){var t=this.delegate,i,r;if(t&&this.position&&undefined===n&&(t.offsetX=this.position.posX,t.rightScroll.setWorldValue(this.position.posY),t.storage.p.length)){var u=this.position.collapse,f=t.storage.p[0].m,e=u.length,o=t.storage.p[0].m.length;if(o>0&&e>0)for(i=0;i<e;++i)for(r=0;r<o;++r)u[i].id===f[r].id()&&(f[r].collapse=u[i].status);t.storage.p[0].collapse=this.position.freecollapse}this.position=null},changeTimeScaleEvent:function(){if(!this.disableScaleEvents&&this.onchangetimescale)this.onchangetimescale(this.delegate.timeScale.scaleX)},changeHintEvent:function(n,t,i){if(this.onshowhint)this.onshowhint(n,t,i)}};ys.prototype={update:function(){var n=this.delegate,t,i,f,r,e,u,o;n&&(0!=this.strafeOffset&&(t=this.strafeOffset-n.offsetX,t>0?t<.01?(n.offsetX=this.strafeOffset,this.strafeOffset=0):n.offsetX+=t*tr:t>-.01?(n.offsetX=this.strafeOffset,this.strafeOffset=0):n.offsetX+=t*tr,n.timeScale.strafe(n.offsetX),n.needUpdate=!0,n.zoomBar&&(n.zoomBar.repaint=!0)),0!=this.scrollOffset&&(i=this.scrollOffset-this.scrollFrom,i>0?i<.5?(this.scrollFrom=Math.max(this.scrollOffset,0),this.scrollOffset=0,this.afterFunc&&(this.afterFunc(),this.afterFunc=null)):this.scrollFrom+=i*ns:i>-.5?(this.scrollFrom=Math.max(this.scrollOffset,0),this.scrollOffset=0,this.afterFunc&&(this.afterFunc(),this.afterFunc=null)):this.scrollFrom+=i*ns,n.rightScroll.setWorldValue(this.scrollFrom),n.needUpdate=!0,n.zoomBar&&(n.zoomBar.repaint=!0),n._leftPanelController&&n._leftPanelController.scrollContent(n.rightScroll.value())),0!=this.scaleOffset&&(f=n.timeScale.scaleX,r=this.scaleOffset-n.timeScale.scaleX,r>0?r<tr?(n.timeScale.scaleX=this.scaleOffset,this.scaleOffset=0,this.strafeCentering=!0,this.scaleToCenterX=undefined):n.timeScale.scaleX+=r*tr:r>-tr?(n.timeScale.scaleX=this.scaleOffset,this.scaleOffset=0,this.strafeCentering=!0,this.scaleToCenterX=undefined):n.timeScale.scaleX+=r*tr,this.strafeCentering?(f/=n.timeScale.scaleX,e=-n.offsetX*n.timeScale.hourInPixels+n.centerScreen,n.offsetX=(n.centerScreen-e*f)/n.timeScale.hourInPixels,this.boundView.from!==this.boundView.to&&(this.boundView.from=n.zoomBar.minPos(),this.boundView.to=n.zoomBar.maxPos(),n.offsetX=Math.max(n.offsetX,this.boundView.to),n.offsetX=Math.min(n.offsetX,this.boundView.from)),n.timeScale.strafe(n.offsetX)):undefined!=this.scaleToCenterX&&(f/=n.timeScale.scaleX,u=n.timeScale.scaleX*n.offsetX,o=Math.abs(this.scaleToCenterX-u),u<this.scaleToCenterX?(n.offsetX+=(u-o*(1-f))/n.timeScale.scaleX,u=n.timeScale.scaleX*n.offsetX,u>this.scaleToCenterX&&(n.offsetX=this.scaleToCenterX/n.timeScale.scaleX)):n.offsetX=this.scaleToCenterX/n.timeScale.scaleX,n.timeScale.strafe(n.offsetX)),this.strafeForseTo&&(this.strafeOffset=n.centerScreen/n.timeScale.hourInPixels-this.strafeForseTo/n.timeScale.scaleX),n._viewController.changeTimeScaleEvent(),n.needUpdate=!0,n.zoomBar&&(n.zoomBar.repaint=!0)))},stop:function(){this.strafeOffset=0;this.afterFunc=null;this.strafeForseTo=0},moveCenterToX:function(n){var t=this.delegate,i;t&&(i=t.centerScreen/t.timeScale.hourInPixels-n/t.timeScale.scaleX,this.strafeForseTo=0,this.strafeTo?this.strafeOffset=i:(t.offsetX=i,t.timeScale.strafe(i),t.update()))},addMovementX:function(n){var t=this.delegate,i;t&&(i=t.offsetX-n,this.strafeForseTo=0,this.strafeTo?this.strafeOffset=i:(t.offsetX=i,t.timeScale.strafe(i),t.update()))},moveToY:function(n,t,i){if(t){if(this.afterFunc)return;this.afterFunc=t}var r=this.delegate;r&&(this.scrollTo&&!i?(this.scrollFrom=r.rightScroll.value(),this.scrollOffset=n):(this.scrollOffset=n,this.scrollFrom=n,r.rightScroll.forwardMoveY(n)))},scale:function(n,t,i,r){var u=this.delegate,f,e;if(u&&n){if(t&&(this.strafeCentering=!1),i&&(this.scaleToCenterX=i),this.strafeForseTo=0,f=u.timeScale.scaleX/n,this.scaleTo&&!r){this.scaleOffset=n;this.needUpdate=!0;u.zoomBar&&(this.boundView.from=u.zoomBar.minPos(),this.boundView.to=u.zoomBar.maxPos());return}this._status=1;u.timeScale.scaleX=Math.max(1,n);i&&(u.offsetX=i/u.timeScale.scaleX);this.strafeCentering&&(e=-u.offsetX*u.timeScale.hourInPixels+u.centerScreen,u.offsetX=(u.centerScreen-e*f)/u.timeScale.hourInPixels,u.timeScale&&u.timeScale.strafe(u.offsetX));u._viewController.changeTimeScaleEvent();u.needUpdate=!0}},moveScale:function(n,t){var i=this.delegate;i&&(this.strafeTo&&this.scaleTo?(this.strafeForseTo=t,this.strafeOffset=i.centerScreen/i.timeScale.hourInPixels-this.strafeForseTo/i.timeScale.scaleX,this.scaleOffset=n):(i.timeScale.scaleX=n,i.offsetX=i.centerScreen/i.timeScale.hourInPixels-t/i.timeScale.scaleX,i.timeScale.strafe(i.offsetX),i._viewController.changeTimeScaleEvent()),i.needUpdate=!0)},status:function(){return 0!==this.scaleOffset},isScroll:function(){return 0!==this.scrollOffset}};ps.prototype={prepare:function(){this.offX=this.t.timeScale.hourInPixels*this.t.offsetX;this.scrollY=t(this.t.rightScroll.value());this.worldToScreen=this.t.timeScale.hourInPixels/this.t.timeScale.scaleX},drawTask:function(n,i,f,e,o,h,a){var y,v,st,nt,it,tt,lt,ct,rt,ut;if(this.tx=this.offX+n.beginTime*this.worldToScreen,this.te=n.duration*this.worldToScreen,this.rel=i-this.scrollY,y=this.t.itemHeight,!(this.rel+this.t.itemHeight<=this.t.visibleUp)){n.endFail&&o===-1&&(this.te=-this.tx+this.t.ctxWidth-k.smallClampPx,this.te=Math.max(this.te,k.smallClampPx),this.tx<=this.t.visibleLeft-1&&(this.te=Math.min(-this.tx+this.t.ctxWidth*k.bigClampPct,this.te)));var ft=!1,ot=!1,g=!1,w=yu,ht=oe,b=fe;if(r===n._status?(w=yu,ht=fh,b=fe,this.t.editBox.enable||this.t._leftPanelController.getPanel().editBox.isEnable()||(this.t.hitTask===h&&this.t.hitMilestone===o&&this.t.hitProject===e&&(w=du,b=bu,g=!0),f&&this.t.hitTask===h&&this.t.hitMilestone===-1&&this.t.hitProject===e&&(w=du,b=bu,g=!0),this.t.capTask===h&&this.t.capMilestone===o&&this.t.capProject===e&&(w=du,b=bu,ft=!0,g=!0))):n.endTime<=0&&(!n.endFail||o!==-1)?(w=ue,ht=uh,b=ih,this.t.editBox.enable||this.t._leftPanelController.getPanel().editBox.isEnable()||(this.t.hitTask===h&&this.t.hitMilestone===o&&this.t.hitProject===e&&(w=gu,b=wu,g=!0),f&&this.t.hitTask===h&&this.t.hitMilestone===-1&&this.t.hitProject===e&&(w=gu,b=wu,g=!0),this.t.capTask===h&&this.t.capMilestone===o&&this.t.capProject===e&&(w=gu,b=wu,ft=!0,g=!0))):(w=nh,ht=oe,b=th,this.t.editBox.enable||this.t._leftPanelController.getPanel().editBox.isEnable()||(f&&(w=rh),this.t.hitTask===h&&this.t.hitMilestone===o&&this.t.hitProject===e&&(w=ku,b=pu,g=!0),f&&this.t.hitTask===h&&this.t.hitMilestone===-1&&this.t.hitProject===e&&(w=ku,b=pu,g=!0),this.t.capTask===h&&this.t.capMilestone===o&&this.t.capProject===e&&(w=ku,b=pu,ft=!0,g=!0))),this.tx>this.t.ctxWidth-24&&this.t.visibleUp<this.rel&&(this.t.ctx.fillStyle=w,this.t.painter.drawArrowLeft(this.t.ctxWidth-30,this.rel+2,16,16)),this.tx+this.te<this.t.visibleLeft+2&&this.t.visibleUp<this.rel&&(this.t.ctx.fillStyle=w,this.t.painter.drawArrowRight(this.t.visibleLeft-2,this.rel+2,16,16)),this.tx>this.t.ctxWidth||this.tx+this.te<0||this.rel>this.t.ctxHeight){n.dropDownWidget&&this.t.taskDescWidget.set(this.tx,this.rel+this.t.itemHeight,n,null);return}if(this.t.editBox.enable&&e==this.t.editBox.p&&o==this.t.editBox.m&&h===this.t.editBox.t){this.t.editBox.setBound(this.tx,this.rel,this.te,this.t.itemHeight);this.t.ctx.font=this.t.titlesFont;this.t.ctx.fillStyle=ve;this.t.ctx.strokeStyle=ve;this.t.ctx.fillText(n.formatBeginEndDays(),this.tx,this.rel+this.t.itemHeight+this.t.fontPx);return}if(!(this.rel<=0)){if(this.t.visibleUp>0){if(y=this.rel+y-this.t.visibleUp-1,y<=0)return;y<this.t.itemHeight?this.rel+=this.t.itemHeight-y:y=this.t.itemHeight}if(et===this.t.editMode&&this.t.linkLineEdit&&(this.t.linkLineEdit.pp===e&&this.t.linkLineEdit.pm===o&&this.t.linkLineEdit.pt===h&&(ot=!0),this.t.linkLineEdit.p===e&&this.t.linkLineEdit.m===o&&this.t.linkLineEdit.t===h&&(ot=!0)),v={x:t(this.tx)+.5,y:t(this.rel)+.5,w:t(this.te),h:t(y)},this.t.animator.status()&&(v={x:this.tx+.5,y:this.rel+.5,w:this.te+.5,h:y+.5}),this.t.ctx.fillStyle=n.linkFilter?"rgba(0, 0, 0, 0)":w,this.t.ctx.fillRect(v.x,v.y,v.w,v.h),st=n.links.length>0,!st)for(nt=a.length-1;nt>=0;--nt)for(it=a[nt].links.length-1;it>=0;--it)if(n._id===(a[nt].links[it].parentTaskId||a[nt].links[it].parentTaskId)){st=!0;break}st||ot?(tt=u.dash,lt=0,ot?(this.t.ctx.strokeStyle=ee.color,tt=ee.dash,this.t.ctx.lineWidth=2,lt=.5,v={x:t(this.tx),y:t(this.rel),w:t(this.te),h:t(y)}):(this.t.painter.drawStrokeRectangle(this.t.ctx,v.x,v.y,t(this.te),t(y),u.to),this.t.ctx.strokeStyle=u.from,this.t.ctx.lineWidth=1),this.t.animator.status()&&(v={x:t(this.tx)+.5,y:t(this.rel)+.5,w:t(this.te)+.5,h:t(y)}),this.t.painter.drawDashedLineH(this.t.ctx,v.x,v.y,v.x+v.w,v.y,tt),this.t.painter.drawDashedLineH(this.t.ctx,v.x,v.y+v.h,v.x+v.w,v.y+v.h,tt),this.t.painter.drawDashedLineV(this.t.ctx,v.x,v.y,v.x,v.y+v.h,tt),this.t.painter.drawDashedLineV(this.t.ctx,v.x+v.w,v.y,v.x+v.w,v.y+v.h,tt)):this.t.painter.drawStrokeRectangle(this.t.ctx,v.x,t(this.rel)+.5,t(this.te),t(y),b);ct=p!==this.t.storage.getProject(e).status();rt=!1;!g||this.t.readMode||ct||(ut=t(v.y)+.5,r!==n._status&&(this.t.ctx.fillStyle=pr,this.t.ctx.fillRect(t(v.x-d-2),t(ut+y*.5-d*.5+1),d,d),this.t.ctx.fillStyle="#FFFFFF",this.t.ctx.fillRect(t(v.x-d*.5-3),t(ut+y*.5-.5),ti,ti),rt=!0,n.endFail||(this.t.ctx.fillStyle=pr,this.t.ctx.fillRect(t(v.x+3+v.w),t(ut+y*.5-d*.5+1),d,d),this.t.ctx.fillStyle="#FFFFFF",this.t.ctx.fillRect(t(v.x+3+v.w+3),t(ut+y*.5-.5),ti,ti),rt=!0)));this.t.readMode||!this.t._mouseInLinkZone||rt||this.t._mouseInLinkZone.linkToTaskId&&this.t._mouseInLinkZone.linkToTaskId===n._id&&(this.t.ctx.fillStyle=pr,this.t.ctx.fillRect(t(v.x-d-2),t(v.y+y*.5-d*.5+1),d,d),this.t.ctx.fillStyle="#FFFFFF",this.t.ctx.fillRect(t(v.x-d*.5-3),t(v.y+y*.5),ti,ti),this.t._mouseInLinkZone.task.endFail||(this.t.ctx.fillStyle=pr,this.t.ctx.fillRect(t(v.x+3+v.w),t(v.y+y*.5-d*.5+1),d,d),this.t.ctx.fillStyle="#FFFFFF",this.t.ctx.fillRect(t(v.x+3+v.w+3),t(v.y+y*.5-.5),ti,ti)));n._priority&&!rt&&this.te>this.t.itemHeight*.8&&this.t.painter.drawIcoArrowUp(this.t.ctx,this.tx,this.rel,this.t.itemHeight,eh);n.dropDownWidget?(this.t.taskDescWidget.set(this.tx,this.rel+this.t.itemHeight,n,b),this.t.widgetY=i,this.t.widgetX=this.tx):(this.t.fullscreen&&this.tx+this.te>0&&(this.t.ctx.fillStyle=se,this.t.ctx.strokeStyle=se,this.t.ctx.lineWidth=1,this.t.ctx.fillText(n._title,Math.max(this.tx+this.t.taskTextIndent*this.t.zoom,0),this.rel+this.t.itemHeight+this.t.fontPx)),-1===n.titleWidth&&(n.titleWidth=this.t.ctx.measureText(n._title).width/this.t.zoom));this.t.readMode||!ft||this.t.pressedButtonRight||r===n._status||this.t.editMode===et||ct||(n.endFail||(c===this.t.capSide||kt==this.t.capSide)&&(this.t.ctx.fillStyle=l.bkcolor,this.t.painter.roundRect(this.t.ctx,v.x+v.w+l.offX,this.rel+(this.t.itemHeight-l.height)*.5,l.width,l.height,4),this.t.ctx.fill(),this.t.ctx.strokeStyle=l.color,this.t.painter.roundRect(this.t.ctx,v.x+v.w+l.offX,this.rel+(this.t.itemHeight-l.height)*.5,l.width,l.height,4),this.t.ctx.stroke(),this.t.ctx.fillStyle=l.color,this.t.ctx.fillText(n.formatEndDate(!0),v.x+v.w+l.offX+4,this.rel+(this.t.itemHeight-l.height)*.5+l.height-4)),(s===this.t.capSide||kt==this.t.capSide)&&(this.t.ctx.fillStyle=l.bkcolor,this.t.painter.roundRect(this.t.ctx,v.x-l.width-l.offX,this.rel+(this.t.itemHeight-l.height)*.5,l.width,l.height,4),this.t.ctx.fill(),this.t.ctx.strokeStyle=l.color,this.t.painter.roundRect(this.t.ctx,v.x-l.width-l.offX,this.rel+(this.t.itemHeight-l.height)*.5,l.width,l.height,4),this.t.ctx.stroke(),this.t.ctx.fillStyle=l.color,this.t.ctx.fillText(n.formatBeginDate(!0),v.x-l.width-l.offX+4,this.rel+(this.t.itemHeight-l.height)*.5+l.height-4)));n.endFail&&this.t.ctx.drawImage(this.infinity,this.tx+this.te+5,this.rel+2);this.tx<this.t.visibleLeft+2&&this.tx+this.te>this.t.visibleLeft+2&&(this.t.ctx.fillStyle="#FFFFFF",this.t.painter.drawArrowRight(this.t.visibleLeft-2,this.rel+2,16,16))}}},drawMilestone:function(n,i,r,u,f){var e=i-this.scrollY,o=this.offX+n.beginTime*this.worldToScreen,s=n.duration*this.worldToScreen,c=e+this.t.itemHeight,h,y,l,a,v;if(o>this.t.ctxWidth||o+s<0||e>this.t.ctxHeight){n.dropDownWidget&&this.t.milestoneDescWidget.set(o+s,0,n,null);return}if((h=f===0&&this.t.fullscreen?this.t.itemMargin*1.5:(f+.5)*this.t.itemMargin,h+=this.t.visibleUp,!(e+h<=0))&&(this.t.fullscreen||!(e+h-this.t.itemMargin<=2))){if(this.t.backLightMilestone.enable||this.t.backLightMilestone.p==r&&this.t.backLightMilestone.m==u){if(!this.t.fullscreen&&(e=t(i-this.scrollY-this.t.itemHeight*.5),c=e+this.t.itemHeight,h=f===0&&this.t.fullscreen?this.t.itemMargin*1.5:(f+.5)*this.t.itemMargin,c<this.t.visibleUp&&(y=this.t.itemMargin*2-c,c=this.t.itemMargin*2,h=h-y,h<0)))return;!this.t.fullscreen&&n.collapse||(this.t.ctx.fillStyle=he,this.t.ctx.fillRect(o,c,s,h))}if(l=e+this.t.itemHeight-this.t.milestoneLinewidth*this.t.zoom,!(l<this.t.visibleUp)){if(this.t.ctx.fillStyle=n.endTime<=0?tf:nf,1===n._status&&(this.t.ctx.fillStyle=yr),this.t.ctx.fillRect(o,l,s,this.t.milestoneLinewidth*this.t.zoom),this.t.ctx.beginPath(),this.t.ctx.moveTo(o+s,l),this.t.ctx.lineTo(o+s,e+this.t.itemHeight+this.t.milestoneLinewidth*this.t.zoom*2),this.t.ctx.lineTo(o+s-this.t.milestoneLinewidth*this.t.zoom*2,e+this.t.itemHeight),this.t.ctx.closePath(),this.t.ctx.fill(),-1===n.titleWidth&&(n.titleWidth=this.t.ctx.measureText(n.titleWithDate).width),this.t.editBox.enable&&r==this.t.editBox.p&&u==this.t.editBox.m&&-1===this.t.editBox.t){this.t.editBox.setBound(o+s,e-this.t.milestoneLinewidth*this.t.zoom,-1,this.t.itemHeight);return}a=n.titleWidth+(n._isKey?this.t.milestoneKeyLeftIndent*this.t.zoom:0);v=o+s-a;o+s>this.t.ctxWidth&&(v=this.t.ctxWidth-a);n._isKey&&this.t.painter.drawIcoKey(this.t.ctx,t(v+a),t(e+this.t.itemHeight+2*!this.t.fullscreen),this.t.zoom);n._status&&(this.t.ctx.fillStyle=nf);n.dropDownWidget&&(this.t.milestoneDescWidget.set(o+s,e+this.t.itemMargin*.5+this.t.milestoneLinewidth*this.t.zoom-1,n,n._status?yr:this.t.ctx.fillStyle),this.t.widgetY=i,this.t.widgetX=this.tx);this.t.fullscreen&&this.t.ctx.fillText(n.titleWithDate,v,e+this.t.fontPx-this.t.milestoneLinewidth*this.t.zoom)}}},drawLinks:function(n,i,r,f){var e,rt,nt,o;if(n.length){this.t.visibleUp>0&&(this.t.ctx.save(),this.t.ctx.rect(this.t.visibleLeft,this.t.visibleUp,this.t.ctxWidth,this.t.ctxHeight),this.t.ctx.clip());var c,l,a,v,w,p,s,et=-1,ot=-1,h=undefined;this.t.capLink&&(et=this.t.capLink.dependenceTaskId||this.t.capLink.dependenceTaskId,ot=this.t.capLink.parentTaskId||this.t.capLink.parentTaskId);var ut=-1,ft=-1,st=undefined;dh&&this.t.linkWidget.link&&(ut=this.t.linkWidget.link.dependenceTaskId||this.t.linkWidget.link.dependenceTaskId,ft=this.t.linkWidget.link.parentTaskId||this.t.linkWidget.link.parentTaskId);var y=null,b=this.t.itemMargin,k=t(this.t.itemHeight*.5),tt=0,g=0,d=r-f;for(this.t.ctx.strokeStyle=rf,this.t.ctx.lineWidth=1,e=0;e<n.length;++e)for(w=n[e],w.filter&&tt++,rt=0;rt<w.links.length;++rt)if(nt=w.links[rt],p=nt.parentTaskId||nt.parentTaskId,n[e]._id!==p)for(s=nt.linkType||nt.linkType,g=0,o=0;o<n.length;++o)if((n[o].filter&&g++,!n[o].filter||!n[e].filter)&&n[o]._id===p){if(it===s){if(a=t(i+(n[o].beginTime+n[o].duration)*this.worldToScreen+5)-.5,v=t(i+n[e].beginTime*this.worldToScreen-5)-.5,c=t(d+b*(o-g)+k)+.5,l=t(d+b*(e-tt)+k)+.5,this.t.pushLink&&s===this.t.pushLink.linkObj.linkType&&p==this.t.pushLink.linkObj.parentTaskId&&n[e]._id==this.t.pushLink.linkObj.dependenceTaskId){y={linkType:s,xFrom:a+.5,yFrom:c+.5,xTo:v+.5,yTo:l+.5};continue}if(n[o].beginTime+n[o].duration>n[e].beginTime){if(p===ft&&w.id()===ut){h={linkType:s,xFrom:a+.5,yFrom:c+.5,xTo:v+.5,yTo:l+.5,linkColor:ye};continue}this.t.ctx.strokeStyle=u.to;this.t._renderer.drawLink(s,a,c,v,l);this.t.ctx.strokeStyle=ye;this.t._renderer.drawLink(s,a,c,v,l,!0);continue}}else wt===s?(a=t(i+n[o].beginTime*this.worldToScreen)+.5,v=t(i+n[e].beginTime*this.worldToScreen)+.5,c=t(d+b*(o-g)+k)+.5,l=t(d+b*(e-tt)+k)+.5):bt===s&&(a=t(i+(n[o].beginTime+n[o].duration)*this.worldToScreen)+.5,v=t(i+(n[e].beginTime+n[e].duration)*this.worldToScreen)+.5,c=t(d+b*(o-g)+k)+.5,l=t(d+b*(e-tt)+k)+.5);if(this.t.pushLink&&s===this.t.pushLink.linkObj.linkType&&p==this.t.pushLink.linkObj.parentTaskId&&n[e]._id==this.t.pushLink.linkObj.dependenceTaskId){y={linkType:s,xFrom:a+.5,yFrom:c+.5,xTo:v+.5,yTo:l+.5};continue}if(p===ft&&w.id()===ut){h={linkType:s,xFrom:a+.5,yFrom:c+.5,xTo:v+.5,yTo:l+.5,linkColor:rf};continue}this.t.ctx.strokeStyle=u.to;this.t._renderer.drawLink(s,a,c,v,l);this.t.ctx.strokeStyle=rf;this.t._renderer.drawLink(s,a,c,v,l,!0)}y&&(this.t.ctx.beginPath(),this.t.ctx.lineWidth=2,this.t.ctx.strokeStyle=sh,u.dash=[6,2],this.t._renderer.drawLink(y.linkType,y.xFrom,y.yFrom,y.xTo,y.yTo,!0),u.dash=[4,2],this.t.ctx.stroke());h&&(this.t.ctx.beginPath(),this.t.ctx.lineWidth=2,this.t.ctx.strokeStyle=u.to,this.t._renderer.drawLink(h.linkType,t(h.xFrom),t(h.yFrom),t(h.xTo),t(h.yTo),!0),this.t.ctx.strokeStyle=h.linkColor,this.t._renderer.drawLink(h.linkType,t(h.xFrom),t(h.yFrom),t(h.xTo),t(h.yTo),!0),this.t.ctx.stroke());this.t.visibleUp>0&&this.t.ctx.restore()}},drawLink:function(n,t,i,r,f,e){it===n?i<f?t<r?e?(this.t.painter.lineTo(this.t.ctx,t-5,i,t,i,u.dash),this.t.painter.lineTo(this.t.ctx,t,i,t,f,u.dash),this.t.painter.lineTo(this.t.ctx,t,f,r+5+1,f,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(t-5,i),this.t.ctx.lineTo(t,i),this.t.ctx.lineTo(t,f),this.t.ctx.lineTo(r+5+1,f),this.t.ctx.stroke()):e?(this.t.painter.lineTo(this.t.ctx,t-5,i,t,i,u.dash),this.t.painter.lineTo(this.t.ctx,t,i,t,f-this.t.itemHeight,u.dash),this.t.painter.lineTo(this.t.ctx,r,f-this.t.itemHeight,t,f-this.t.itemHeight,u.dash),this.t.painter.lineTo(this.t.ctx,r,f-this.t.itemHeight,r,f,u.dash),this.t.painter.lineTo(this.t.ctx,r,f,r+5+1,f,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(t-5,i),this.t.ctx.lineTo(t,i),this.t.ctx.lineTo(t,f-this.t.itemHeight),this.t.ctx.lineTo(r,f-this.t.itemHeight),this.t.ctx.lineTo(r,f),this.t.ctx.lineTo(r+5+1,f),this.t.ctx.stroke()):t<r?e?(this.t.painter.lineTo(this.t.ctx,t-5,i,t,i,u.dash),this.t.painter.lineTo(this.t.ctx,t,f,t,i,u.dash),this.t.painter.lineTo(this.t.ctx,t,f,r+5,f,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(t-5,i),this.t.ctx.lineTo(t,i),this.t.ctx.lineTo(t,f),this.t.ctx.lineTo(r+5,f),this.t.ctx.stroke()):e?(this.t.painter.lineTo(this.t.ctx,r,f,r+5+1,f,u.dash),this.t.painter.lineTo(this.t.ctx,r,f,r,i-this.t.itemHeight,u.dash),this.t.painter.lineTo(this.t.ctx,r,i-this.t.itemHeight,t,i-this.t.itemHeight,u.dash),this.t.painter.lineTo(this.t.ctx,t,i-this.t.itemHeight,t,i,u.dash),this.t.painter.lineTo(this.t.ctx,t-5,i,t,i,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(r+5+1,f),this.t.ctx.lineTo(r,f),this.t.ctx.lineTo(r,i-this.t.itemHeight),this.t.ctx.lineTo(t,i-this.t.itemHeight),this.t.ctx.lineTo(t,i),this.t.ctx.lineTo(t-5,i),this.t.ctx.stroke()):wt===n?i<f?t<r?e?(this.t.painter.lineTo(this.t.ctx,t-5,i,t+1,i,u.dash),this.t.painter.lineTo(this.t.ctx,t-5,i,t-5,f,u.dash),this.t.painter.lineTo(this.t.ctx,t-5,f,r+5,f,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(t+1,i),this.t.ctx.lineTo(t-5,i),this.t.ctx.lineTo(t-5,f),this.t.ctx.lineTo(r+5,f),this.t.ctx.stroke()):e?(this.t.painter.lineTo(this.t.ctx,r-5,i,t+1,i,u.dash),this.t.painter.lineTo(this.t.ctx,r-5,i,r-5,f,u.dash),this.t.painter.lineTo(this.t.ctx,r-5,f,r+1,f,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(t+1,i),this.t.ctx.lineTo(r-5,i),this.t.ctx.lineTo(r-5,f),this.t.ctx.lineTo(r+1,f),this.t.ctx.stroke()):t<r?e?(this.t.painter.lineTo(this.t.ctx,t-5,i,t+1,i,u.dash),this.t.painter.lineTo(this.t.ctx,t-5,f,t-5,i,u.dash),this.t.painter.lineTo(this.t.ctx,t-5,f,r+5,f,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(t+1,i),this.t.ctx.lineTo(t-5,i),this.t.ctx.lineTo(t-5,f),this.t.ctx.lineTo(r+5,f),this.t.ctx.stroke()):e?(this.t.painter.lineTo(this.t.ctx,r-5,f,r+1,f,u.dash),this.t.painter.lineTo(this.t.ctx,r-5,f,r-5,i,u.dash),this.t.painter.lineTo(this.t.ctx,r-5,i,t+1,i,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(r+1,f),this.t.ctx.lineTo(r-5,f),this.t.ctx.lineTo(r-5,i),this.t.ctx.lineTo(t+1,i),this.t.ctx.stroke()):bt===n&&(i<f?t<r?e?(this.t.painter.lineTo(this.t.ctx,r,f,r+5,f,u.dash),this.t.painter.lineTo(this.t.ctx,r+5,i,r+5,f,u.dash),this.t.painter.lineTo(this.t.ctx,t,i,r+5,i,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(r,f),this.t.ctx.lineTo(r+5,f),this.t.ctx.lineTo(r+5,i),this.t.ctx.lineTo(t,i),this.t.ctx.stroke()):e?(this.t.painter.lineTo(this.t.ctx,r,f,t+5,f,u.dash),this.t.painter.lineTo(this.t.ctx,t+5,i,t+5,f,u.dash),this.t.painter.lineTo(this.t.ctx,t,i,t+5,i,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(r,f),this.t.ctx.lineTo(t+5,f),this.t.ctx.lineTo(t+5,i),this.t.ctx.lineTo(t,i),this.t.ctx.stroke()):t<r?e?(this.t.painter.lineTo(this.t.ctx,t,i,r+5,i,u.dash),this.t.painter.lineTo(this.t.ctx,r+5,f,r+5,i,u.dash),this.t.painter.lineTo(this.t.ctx,r,f,r+5,f,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(t,i),this.t.ctx.lineTo(r+5,i),this.t.ctx.lineTo(r+5,f),this.t.ctx.lineTo(r,f),this.t.ctx.stroke()):e?(this.t.painter.lineTo(this.t.ctx,t,i,t+5,i,u.dash),this.t.painter.lineTo(this.t.ctx,t+5,f,t+5,i,u.dash),this.t.painter.lineTo(this.t.ctx,r,f,t+5,f,u.dash)):(this.t.ctx.beginPath(),this.t.ctx.moveTo(t,i),this.t.ctx.lineTo(t+5,i),this.t.ctx.lineTo(t+5,f),this.t.ctx.lineTo(r,f),this.t.ctx.stroke()))},drawBackLightFreeTask:function(n,i,r,u){if(this.t.editBox.enable&&n===this.t.editBox.p&&-1===this.t.editBox.m&&this.t.editBox.t===r&&(this.t.itemMargin*2<u&&(this.t.ctx.fillStyle=at,this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,u-this.t.itemHeight*.5,this.t.ctxWidth,this.t.itemMargin)),this.t.currentElementY=u+this.t.itemHeight),this.t._leftPanelController.getPanel().editBox.isEnable()&&this.t._leftPanelController.getPanel().editBox.anchor.p===n&&this.t._leftPanelController.getPanel().editBox.anchor.m===undefined&&i===-1&&this.t._leftPanelController.getPanel().editBox.anchor.t===r){this.t.itemMargin*2<u&&(this.t.ctx.fillStyle=at,this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,t(u-this.t.itemHeight*.5)-.5,this.t.ctxWidth,this.t.itemMargin+.5));this.t.currentElementY=u+this.t.itemHeight;return}(this.t.hitTask===r&&this.t.hitMilestone===-1&&this.t.hitProject===n||this.t.capTask===r&&this.t.capMilestone===-1&&this.t.capProject===n)&&(this.t.editBox.enable||(this.t.itemMargin*2<u&&(this.t.ctx.fillStyle=at,this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,u-this.t.itemHeight*.5,this.t.ctxWidth,this.t.itemMargin)),this.t.currentElementY=u+this.t.itemHeight))},drawBackLightTask:function(n,i,r,u){if(this.t.editBox.enable&&n==this.t.editBox.p&&i==this.t.editBox.m&&this.t.editBox.t===r&&(this.t.itemMargin*2<u&&(this.t.ctx.fillStyle=at,this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,t(u-this.t.itemHeight*.5)-.5,this.t.ctxWidth,this.t.itemMargin+.5)),this.t.currentElementY=u+this.t.itemHeight),this.t._leftPanelController.getPanel().editBox.isEnable()&&this.t._leftPanelController.getPanel().editBox.anchor.p===n&&this.t._leftPanelController.getPanel().editBox.anchor.m===i&&this.t._leftPanelController.getPanel().editBox.anchor.t===r){this.t.itemMargin*2<u&&(this.t.ctx.fillStyle=at,this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,t(u-this.t.itemHeight*.5)-.5,this.t.ctxWidth,this.t.itemMargin+.5));this.t.currentElementY=u+this.t.itemHeight;return}(this.t.hitTask===r&&this.t.hitMilestone===i&&this.t.hitProject===n||this.t.capTask===r&&this.t.capMilestone===i&&this.t.capProject===n)&&(this.t.editBox.enable||(this.t.itemMargin*2<u&&(this.t.ctx.fillStyle=at,this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,t(u-this.t.itemHeight*.5)-.5,this.t.ctxWidth,this.t.itemMargin+.5)),this.t.currentElementY=u+this.t.itemHeight))},drawBackLightMilestone:function(n,i,r,u){if(this.t.editBox.enable&&n==this.t.editBox.p&&i==this.t.editBox.m&&this.t.editBox.t===r&&this.t.itemMargin*2<u){this.t.ctx.fillStyle=at;this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,t(u-this.t.itemHeight*.5)-.5,this.t.ctxWidth,this.t.itemMargin+.5);return}if(this.t._leftPanelController.getPanel().editBox.isEnable()&&this.t._leftPanelController.getPanel().editBox.anchor.p===n&&this.t._leftPanelController.getPanel().editBox.anchor.m===i&&this.t._leftPanelController.getPanel().editBox.anchor.t===undefined&&r===-1&&this.t.itemMargin*2<u){this.t.ctx.fillStyle=at;this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,t(u-this.t.itemHeight*.5)-.5,this.t.ctxWidth,this.t.itemMargin+.5);return}this.t.menuMileStone.ref&&(this.t.menuMileStone.p!==n||this.t.menuMileStone.m!==i||this.t.menuMileStone.hide||this.t.itemMargin*2<u&&!this.t.editBox.enable&&(this.t.ctx.fillStyle=at,this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,t(u-this.t.itemHeight*.5)-.5,this.t.ctxWidth,this.t.itemMargin+.5)));this.t.hitTask===r&&this.t.hitMilestone===i&&this.t.hitProject===n&&(this.t.editBox.enable||this.t.milestoneChange||this.t.itemMargin*2<u&&!this.t.editBox.enable&&(this.t.ctx.fillStyle=at,this.t.fullscreen?this.t.ctx.fillRect(0,u,this.t.ctxWidth,this.t.itemHeight):this.t.ctx.fillRect(0,t(u-this.t.itemHeight*.5)-.5,this.t.ctxWidth,this.t.itemMargin+.5)))}};ws.prototype={setBound:function(t,i,r,u){this.disableBound||(this.bound=t,this.direction=i,this.linkDays=r,this.days="",this.titleIndent={x:0,y:0},this.linkDays>0?(u&&(this.days="+"),this.days+=this.linkDays+" "+n.Gantt.Localize_strings.dayShort,this.titleIndent.x=a.titleFx*(this.days.length>0),this.titleIndent.y=a.titleFy*(this.days.length>0)):this.linkDays<0&&(u?this.days="-":this.linkDays=Math.abs(this.linkDays),this.days=this.linkDays+" "+n.Gantt.Localize_strings.dayShort,this.titleIndent.x=a.titleFx*(this.days.length>0),this.titleIndent.y=a.titleFy*(this.days.length>0)),this.internalBound=i?{x:this.bound.x-a.h*.5,y:this.bound.y-a.trx-this.titleIndent.y,w:a.h,h:a.w-a.trx+this.titleIndent.y}:{x:this.bound.x+a.trx,y:this.bound.y-a.h*.5,w:a.w-a.trx+this.titleIndent.x,h:a.h})},setLink:function(n){this.link=n;this.t.needUpdate=!0},render:function(){this.t.painter.clearZones(!0);this.direction?(this.t.painter.addZone(this.internalBound.x-a.h,this.internalBound.y-a.h,this.internalBound.w+a.h,this.internalBound.h+a.h,5),this.t.overlayctx.fillStyle="#83888D",this.t.overlayctx.lineWidth=1,this.t.overlayctx.beginPath(),this.t.overlayctx.moveTo(t(this.internalBound.x),t(this.internalBound.y+a.h*.5+this.titleIndent.y)),this.t.overlayctx.lineTo(t(this.internalBound.x+this.internalBound.w*.5),t(this.internalBound.y+this.internalBound.h)),this.t.overlayctx.lineTo(t(this.internalBound.x+this.internalBound.w+2),t(this.internalBound.y+a.h*.5+this.titleIndent.y)),this.t.overlayctx.lineTo(t(this.internalBound.x+this.internalBound.w+2),t(this.internalBound.y-a.h*.5)),this.t.overlayctx.lineTo(t(this.internalBound.x),t(this.internalBound.y-a.h*.5)),this.t.overlayctx.closePath(),this.t.overlayctx.fill(),this.t.overlayctx.fillStyle="#FFFFFF",this.t.overlayctx.fillRect(t(this.bound.x-v.s*.5+1),t(this.internalBound.y+a.h*.5)-v.yh-v.s,v.s,v.s),this.t.overlayctx.fillStyle="#83888D",this.t.overlayctx.beginPath(),this.t.painter.drawIcoCross(this.t.overlayctx,t(this.bound.x-v.s*.5+1),t(this.internalBound.y+a.h*.5)-v.yh-v.s,v.s,v.s),this.t.overlayctx.closePath(),this.t.overlayctx.fill(),this.days.length&&this.linkDays<=9999&&this.linkDays>=-9999&&(this.t.overlayctx.fillStyle="#FFFFFF",this.t.overlayctx.font=ht(this.linkDays)<100?"7pt "+b:ht(this.linkDays)>=100&&ht(this.linkDays)<1e3?"6pt "+b:"5pt "+b,this.t.overlayctx.fillText(this.days,this.internalBound.x+(this.internalBound.w-this.t.overlayctx.measureText(this.days).width)*.5,this.internalBound.y+v.s*1.3))):(this.t.painter.addZone(this.internalBound.x-a.h,this.internalBound.y,this.internalBound.w+a.h,this.internalBound.h,5),this.t.overlayctx.fillStyle="#83888D",this.t.overlayctx.lineWidth=1,this.t.overlayctx.beginPath(),this.t.overlayctx.moveTo(t(this.internalBound.x),t(this.internalBound.y)),this.t.overlayctx.lineTo(t(this.internalBound.x-a.h*.5),t(this.internalBound.y+this.internalBound.h*.5)),this.t.overlayctx.lineTo(t(this.internalBound.x),t(this.internalBound.y+this.internalBound.h)),this.t.overlayctx.lineTo(t(this.internalBound.x+a.w-a.trx+this.titleIndent.x),t(this.internalBound.y+this.internalBound.h)),this.t.overlayctx.lineTo(t(this.internalBound.x+a.w-a.trx+this.titleIndent.x),t(this.internalBound.y)),this.t.overlayctx.closePath(),this.t.overlayctx.fill(),this.t.overlayctx.fillStyle="#FFFFFF",this.t.overlayctx.fillRect(t(this.bound.x+v.xw+this.titleIndent.x),t(this.internalBound.y+v.yh),v.s,v.s),this.t.overlayctx.fillStyle="#83888D",this.t.overlayctx.beginPath(),this.t.painter.drawIcoCross(this.t.overlayctx,this.bound.x+v.xw-.5+this.titleIndent.x,this.internalBound.y+v.yh,v.s,v.s),this.t.overlayctx.closePath(),this.t.overlayctx.fill(),this.days.length&&this.linkDays<=9999&&this.linkDays>=-9999&&(this.t.overlayctx.fillStyle="#FFFFFF",this.t.overlayctx.font=ht(this.linkDays)<100?"7pt "+b:ht(this.linkDays)>=100&&ht(this.linkDays)<1e3?"6pt "+b:"5pt "+b,this.t.overlayctx.fillText(this.days,this.internalBound.x+(this.internalBound.h-this.t.overlayctx.measureText(this.days).width)*.5-5,this.internalBound.y+v.s*.95)))},reset:function(){this.bound={x:0,y:0,w:0,h:0};this.link=null},isValid:function(){return this.bound.w+this.bound.h>0},hide:function(){this.bound={x:0,y:0,w:0,h:0};this.internalBound={x:0,y:0,w:0,h:0};this.link=null;this.t.needUpdate=!0},checkZone:function(n,t){if(this.direction){if(this.internalBound.x>=n||n>=this.internalBound.x+this.internalBound.w||this.internalBound.y-10>=t||t>=this.internalBound.y+this.internalBound.h)return!1}else if(this.internalBound.x-20>n||n>this.internalBound.x+this.internalBound.w+7||this.internalBound.y-2>t||t>this.internalBound.y+this.internalBound.h)return!1;return!0},onmousedown:function(n,t){if(this.handler&&this.isValid())if(this.direction){if(n>=this.bound.x-v.s&&n<=this.bound.x+v.s&&t<=this.internalBound.y+v.s&&t>=this.internalBound.y-v.s)return this.handler(),!0}else if(n>=this.bound.x+v.xw+this.titleIndent.x&&n<=this.bound.x+v.xw+v.s+this.titleIndent.x&&t>=this.internalBound.y+v.yh&&t<=this.internalBound.y+v.yh+v.s)return this.handler(),!0;return!1},onmousemove:function(n,t){if(this.isValid())if(this.direction){if(n>=this.internalBound.x&&n<=this.internalBound.x+this.internalBound.w&&t>=this.internalBound.y-15&&t<=this.internalBound.y+this.internalBound.h+7)return this.t.overlay.style.cursor="pointer",!0;this.hide()}else{if(n>=this.internalBound.x-20&&n<=this.internalBound.x+this.internalBound.w&&t>=this.internalBound.y&&t<=this.internalBound.y+this.internalBound.h)return this.t.overlay.style.cursor="pointer",!0;this.hide()}return!1}};bs.prototype={set:function(n,t,i,r){if(this.ref){if(this.ref.t._id==i._id){this.ref.x=n;this.ref.y=t;this.ref.fill=r;return}this.ref.t.dropDownWidget=!1}this.ref={x:n,y:t,t:i,fill:r}},check:function(n){if(this.ref){if(n&&this.ref.t._id==n._id)return this.ref.t.dropDownWidget=!1,this.ref=null,!1;this.ref.t.dropDownWidget=!1;n||(this.ref=null)}return!0},checkBound:function(n,t){return this.bound.x>n||n>this.bound.x+this.bound.w||this.bound.y>t||t>this.bound.y+this.bound.h},checkInBoundDetailsLink:function(n,t){return this.detailsLinkBound.x<n&&n<this.detailsLinkBound.x+this.detailsLinkBound.w&&this.detailsLinkBound.y<t&&t<this.detailsLinkBound.y+this.detailsLinkBound.h},checkAndOff:function(n){this.ref&&n&&this.ref.t._id==n._id&&(this.ref.t.dropDownWidget=!1,this.ref=null)},setLinkRef:function(n){this.href=n},isValid:function(){return null!==this.ref}};te.prototype={initBase:function(n,t){var i=this;n&&(this.canvas=n,this.ctx=n.getContext("2d"),this.ctxWidth=this.ctx.canvas.width,this.ctxHeight=this.ctx.canvas.height,this.bounding=this.ctx.canvas.getBoundingClientRect(),t&&(this.overlay=t,this.overlayctx=this.overlay.getContext("2d"),this.updateDragDrop=!1,this.overlay.onmouseout=function(){i.leftPanelController().updateFocus();i.leftPanelController().clearHighlight();i.rightScroll.focus(!1);i.hitProject=-1;i.hitMilestone=-1;i.hitTask=-1;i.offMenus();i.painter.clearZones(!0);i.needUpdate=!0}),rs.src="/Products/Projects/App_Themes/default/images/small-icons.png",this._userDefaults=new yf(this),this.storage=new vs(this),this._undoManager=new wf(this),this._viewController=new ne(this),this._modelController=new gf(this),this.painter=new ar(this.ctx,this.overlayctx),this.animator=new ys(this),this._renderer=new ps(this),this._leftPanelController=new pf(this,this.storage,document.getElementById("ganttCanvasContainer")),this._leftPanelController&&this._leftPanelController.init(),this._mouseInLinkZone=null,this.repaint=!0)},initStyles:function(){this.taskTextIndent=11;this.milestoneMenuOffY=3;this.menuArrowSize=4;this.menuHeight=24;this.menuLeftIndent=1;this.menuTopIndent=4;this.menuIndentMiddle=20;this.milestoneLinewidth=3;this.milestoneKeyLeftIndent=26},initWidgets:function(){var n=this;this.menuTask={offx:0,offy:0,p:-1,m:-1,t:-1,ref:null,_status:tt,bound:{x:0,y:0,w:0,h:0},futureBound:{x:0,y:0,w:0,h:0},handlers:[],painter:new ar(n.overlayctx,null),disableSetter:!1,set:function(n,t,i,r){if(this.ref&&r&&this.ref._id===r._id){this.bound=this.futureBound;return}-1!==n&&-1!==i&&t===-1?(this.p=n,this.m=t,this.t=i):(-1!==n&&(this.p=n),-1!==t&&(this.m=t),-1!==i&&(this.t=i));r&&(this.ref=r,this._status=this.ref._status,this.bound=this.futureBound)},setBound:function(n,t,i,r){this.futureBound={x:n,y:t,w:i,h:r}},check:function(t,i){return this.bound.x>t||t>this.bound.x+this.bound.w||this.bound.y>i||i>this.bound.y+this.bound.h+n.itemHeight?(this.bound.w=0,this.bound.h=0,!1):!0},checkZone:function(n,t){var i,r=this.bound.x+this.bound.w*.5;return(i=tt==this._status?f.elementsWidth5X*.5:f.elementsWidth2X*.5,r-i>n||n>r+i||this.bound.y>t||t>this.bound.y+this.bound.h)?!1:!0},reset:function(){this.bound.w=0;this.bound.h=0;this.futureBound.w=0;this.futureBound.h=0;this.p=-1;this.m=-1;this.t=-1;this.ref=null},addHandler:function(n){this.handlers.push(n)},value:function(n,i,r,u){return r-this.bound.y<=(n.menuTopIndent+f.icoSize)*n.zoom&&this.bound.w>0?t((i-this.bound.x)/t(this.bound.w/u)):-1},draw:function(){var o,s,h,i,u;if(0<this.bound.w&&0<this.bound.h){o=f.elementsWidth5X*n.zoom;this._status==r&&(o=f.elementsWidth2X*n.zoom);s=this.bound.x+this.bound.w*.5-o*.5;h=f.icoSize+f.borderSz*2;n.overlayctx.fillStyle=f.backgroundColor;n.overlayctx.fillRect(s-f.borderSz,this.bound.y+1,o+f.borderSz*2,h);n.overlayctx.beginPath();n.overlayctx.moveTo(s+o*.5,this.bound.y+h+n.menuArrowSize*n.zoom+1);n.overlayctx.lineTo(s+o*.5-n.menuArrowSize*n.zoom,this.bound.y+h+1);n.overlayctx.lineTo(s+o*.5+n.menuArrowSize*n.zoom,this.bound.y+h+1);n.overlayctx.closePath();n.overlayctx.fill();var t=f.icoSize*n.zoom,e=this.bound.y+f.borderSz*n.zoom+1,c=this._status==r?2:5;for(i=0;i<c;++i){if(u=s-1+(n.menuLeftIndent+i*n.menuIndentMiddle)*n.zoom,n.overlayctx.fillStyle=f.borderColor,n.overlayctx.fillRect(u,e,t,t),4===i){n.overlayctx.fillStyle=f.backgroundColor;n.overlayctx.strokeStyle=f.backgroundColor;this.painter.drawIconLink(u,e,t,t);continue}n.overlayctx.fillStyle=f.backgroundColor;n.overlayctx.beginPath();0===i?this._status==r?this.painter.drawPlay(u,e,t,t):this.painter.drawPencil(u,e,t,t):1===i&&(this._status==r?this.painter.drawDelete(u,e,t,t):this.painter.drawIcoResponsible(u,e,t,t));2===i&&this.painter.drawDelete(u,e,t,t);3===i&&this.painter.drawComplete(u,e,t,t);n.overlayctx.closePath();n.overlayctx.fill()}return!0}return!1},onmousemove:function(t,i){return 0===this.bound.w&&0===this.bound.h?!1:this.check(t,i)?(n.overlay.style.cursor="pointer",n.needUpdate=!0,!0):!1},onmousedown:function(i,u){if((n.menuTopIndent+f.icoSize)*n.zoom>=u-this.bound.y&&n.menuTopIndent*n.zoom<=u-this.bound.y&&this.bound.w>0){var o=this._status==r?2:5,e=t((i-this.bound.x)/t(this.bound.w/o));return e<this.handlers.length&&e>=0&&this.handlers[e](this.p,this.m,-1),!0}return!1}};this.menuTask.addHandler(function(){var i,t;r===n.menuTask.ref._status?(i=lr(function(n){return n.statusType===1&&n.isDefault}),n._modelController.addTaskOperation(wi,n.menuTask.p,n.menuTask.m==-1?undefined:n.menuTask.m,n.menuTask.t,i.id),n.menuTask.reset()):(t=n.storage.getTask(n.menuTask.p,n.menuTask.m==-1?undefined:n.menuTask.m,n.menuTask.t),t&&n.taskDescWidget.checkAndOff(t),n.showPopUpEditElement(n.menuTask.p,n.menuTask.m===-1?undefined:n.menuTask.m,n.menuTask.t)||n.editElementTitle(n.menuTask.p,n.menuTask.m,n.menuTask.t),n.offWidgets(),n.needUpdate=!0)});this.menuTask.addHandler(function(){if(r===n.menuTask.ref._status)n._modelController.addTaskOperation(ur,n.menuTask.p,n.menuTask.m===-1?undefined:n.menuTask.m,n.menuTask.t);else{var t=n.menuTask.bound.x+n.menuTask.bound.w*.5;n.showPopUpResp(n.menuTask.p,n.menuTask.m===-1?undefined:n.menuTask.m,n.menuTask.t,t)}n.menuTask.reset();n.isLBMDown=!1});this.menuTask.addHandler(function(){n._modelController.addTaskOperation(ur,n.menuTask.p,n.menuTask.m===-1?undefined:n.menuTask.m,n.menuTask.t);n.menuTask.reset();n.isLBMDown=!1});this.menuTask.addHandler(function(){var t=lr(function(n){return n.statusType===2&&n.isDefault});n._modelController.addTaskOperation(wi,n.menuTask.p,n.menuTask.m==-1?undefined:n.menuTask.m,n.menuTask.t,t.id);n.menuTask.reset()});this.menuTask.addHandler(function(){if(r!==n.menuTask.ref._status&&n.handlers[iu]){var t=n.storage.getTask(n.menuTask.p,n.menuTask.m==-1?undefined:n.menuTask.m,n.menuTask.t);n.handlers[iu](t);n.offWidgets();n.needUpdate=!0}});this.menuMileStone={offx:0,offy:0,p:-1,m:-1,ref:null,_status:tt,bound:{x:0,y:0,w:0,h:0},hide:!0,handlers:[],painter:new ar(n.overlayctx,null),disable:!1,set:function(n,t,i){-1!==n&&(this.p=n);-1!==t&&(this.m=t);i&&(this.ref=i,this._status=this.ref._status)},check:function(n,t){return this.bound.x>n||n>this.bound.x+this.bound.w||this.bound.y>t||t>this.bound.y+this.bound.h+10?(this.bound.w=0,this.bound.h=0,this.hide=!0,!1):!0},reset:function(){this.bound.w=0;this.bound.h=0;this.p=-1;this.m=-1;this.t=-1;this.hide=!0;this.ref=null;this._status=tt-1;this.disable=!1},addHandler:function(n){this.handlers.push(n)},setBound:function(n,t,i,r){this.bound={x:n,y:t,w:i,h:r}},checkZone:function(n,t){if(this.disable)return!1;var i,r=this.bound.x+this.bound.w*.5;return(i=tt-1==this._status?f.elementsWidth6X*.5:f.elementsWidth3X*.5,r-i>n||n>r+i||this.bound.y>t||t>this.bound.y+this.bound.h)?!1:!0},draw:function(){var o,s,h,e,i;if(0<this.bound.w&&0<this.bound.h&&!this.hide&&!this.disable){o=f.elementsWidth6X*n.zoom;this._status==r-1&&(o=f.elementsWidth3X*n.zoom);s=this.bound.x+this.bound.w*.5-o*.5;h=f.icoSize+f.borderSz*2;n.overlayctx.fillStyle=f.backgroundColor;n.overlayctx.fillRect(s-f.borderSz,this.bound.y+1,o+f.borderSz*2,h);h+=f.borderSz;n.overlayctx.beginPath();n.overlayctx.moveTo(s+o*.5,this.bound.y+h+1-n.menuArrowSize*n.zoom);n.overlayctx.lineTo(s+o*.5-n.menuArrowSize*n.zoom,this.bound.y+h+1-n.menuArrowSize*n.zoom*2);n.overlayctx.lineTo(s+o*.5+n.menuArrowSize*n.zoom,this.bound.y+h+1-n.menuArrowSize*n.zoom*2);n.overlayctx.closePath();n.overlayctx.fill();var t=f.icoSize*n.zoom,u=this.bound.y+f.borderSz*n.zoom+1,c=this._status==r-1?3:6;for(e=0;e<c;++e)i=s-1+(n.menuLeftIndent+e*n.menuIndentMiddle)*n.zoom,n.overlayctx.fillStyle=f.borderColor,n.overlayctx.fillRect(i,u,t,t),n.overlayctx.fillStyle=f.backgroundColor,n.overlayctx.beginPath(),0===e?this._status==r-1?this.painter.drawPlay(i,u,t,t):this.painter.drawPencil(i,u,t,t):1===e&&(this._status==r-1?this.painter.drawDelete(i,u,t,t):this.painter.drawIcoResponsible(i,u,t,t)),2===e&&(this._status==r-1?this.painter.drawFitSw(i,u,t,t):this.painter.drawDelete(i,u,t,t)),3===e&&(this._status==r-1?this.painter.drawFitSw(i,u,t,t):this.painter.drawAdd(i,u,t,t)),4===e&&this.painter.drawFitSw(i,u,t,t),5==e&&this.painter.drawComplete(i,u,t,t),n.overlayctx.closePath(),n.overlayctx.fill();return!0}return!1},onmousemove:function(t,i){return this.disable?(n.overlay.style.cursor="pointer",!1):0===this.bound.w&&0===this.bound.h?!1:this.check(t,i)?(n.overlay.style.cursor="pointer",n.needUpdate=!0,!0):!1},onmousedown:function(i,u){if(this.disable)return!1;if((n.menuTopIndent+f.icoSize)*n.zoom>=u-this.bound.y&&n.menuTopIndent*n.zoom<=u-this.bound.y&&this.bound.w>0){if(u<this.bound.y+6*n.zoom)return n.menuMileStone.reset(),!1;var o=this._status==r-1?3:6,s=this._status==r-1?f.elementsWidth3X:f.elementsWidth6X,e=t((i-this.bound.x)/t(s/o));return e<this.handlers.length&&e>=0&&this.handlers[e](this.p,this.m,-1),!0}return!1}};this.menuMileStone.addHandler(function(){n.menuMileStone.ref.status()==tt-1?(n.showPopUpEditElement(n.menuMileStone.p,n.menuMileStone.m===-1?undefined:n.menuMileStone.m,-1)||n.editElementTitle(n.menuMileStone.p,n.menuMileStone.m,-1),n.offWidgets()):n._modelController.addMilestoneOperation(si,n.menuMileStone.p,n.menuMileStone.m);n.isLBMDown=!1;n.menuMileStone.reset()});this.menuMileStone.addHandler(function(){if(n.menuMileStone.ref.status()==tt-1){var t=n.menuMileStone.bound.x+n.menuMileStone.bound.w*.5;n.showPopUpResp(n.menuMileStone.p,n.menuMileStone.m,n.menuMileStone.t,t)}else n._modelController.addMilestoneOperation(fr,n.menuMileStone.p,n.menuMileStone.m,n.menuMileStone.t);n.isLBMDown=!1;n.menuMileStone.reset()});this.menuMileStone.addHandler(function(){n.menuMileStone.ref.status()==tt-1?n._modelController.addMilestoneOperation(fr,n.menuMileStone.p,n.menuMileStone.m,n.menuMileStone.t):n._viewController.zoomToFitMilestone(n.menuMileStone.p,n.menuMileStone.m);n.isLBMDown=!1;n.menuMileStone.reset()});this.menuMileStone.addHandler(function(){n.menuMileStone.ref.status()==r-1?n._viewController.zoomToFitMilestone(n.menuMileStone.p,n.menuMileStone.m):(n.addTaskToMilestone(n.menuMileStone.p,n.menuMileStone.m),n.offWidgets());n.isLBMDown=!1;n.menuMileStone.reset()});this.menuMileStone.addHandler(function(){n.menuMileStone.ref.status()!=r-1&&(n._viewController.zoomToFitMilestone(n.menuMileStone.p,n.menuMileStone.m),n.menuMileStone.reset())});this.menuMileStone.addHandler(function(){n._modelController.addMilestoneOperation(si,n.menuMileStone.p,n.menuMileStone.m);n.isLBMDown=!1;n.menuMileStone.reset()});this.editBox=new fs(this);this.taskDescWidget=new bs(this);this.milestoneDescWidget={ref:null,bound:{x:0,y:0,w:0,h:0},set:function(n,t,i,r){if(this.ref){if(this.ref.t._id==i._id){this.ref.x=n;this.ref.y=t;this.ref.fill=r;return}this.ref.t.dropDownWidget=!1}this.ref={x:n,y:t,t:i,fill:r}},check:function(n){if(this.ref){if(n&&this.ref.t._id==n._id)return this.ref.t.dropDownWidget=!1,this.ref=null,!1;this.ref.t.dropDownWidget=!1;n||(this.ref=null)}return!0},checkBound:function(n,t){return this.bound.x>n||n>this.bound.x+this.bound.w||this.bound.y>t||t>this.bound.y+this.bound.h},checkAndOff:function(n){this.ref&&n&&this.ref.t._id==n._id&&(this.ref.t.dropDownWidget=!1,this.ref=null)},isValid:function(){return null!==this.ref}};this.backLightMilestone={enable:!0,p:-1,m:-1,up:function(n,t){(n!=this.p||t!=this.m)&&(this.p=n,this.m=t,this.update=!0)},update:!1};this.linkWidget=new ws(this);this.linkWidget.handler=function(){n._modelController.addTaskOperation(tu,this.link);this.hide()};this.oldRef=null},initUI:function(){this.rightScroll=new es(this.ctx,this);this.bottomScroll=new os(this.ctx,this);this.timeScale=new ls(this,1);this.zoomBar=null},focus:function(n,t){if(!n){this.bottomScroll.onmouseup(t);this.rightScroll.onmouseup(t);this.zoomBar.releaseCapture();this.onmouseup(t,!0);this.needUpdate=!0}},viewController:function(){return this._viewController},modelController:function(){return this._modelController},undoManager:function(){return this._undoManager},userDefaults:function(){return this._userDefaults},leftPanelController:function(){return this._leftPanelController},setZoom:function(n){if(this.zoom=Math.max(.1,n),this.zoom=Math.min(8,this.zoom),this.itemHeight=gh*this.zoom,this.itemMargin=g*this.zoom,this.itemProjectMargin=0,this.fontHeight=nc*this.zoom,this.titlesFont=this.fontHeight+"pt "+b,this.fontPx=this.fontHeight*1.5,this.timeScale&&this.timeScale.setZoom(this.zoom),this.storage){for(var u,r,f,i=this.storage.projects(),e=i.length,t=0;t<e;++t){for(i[t].titleWidth=-1,r=i[t].m.length-1;r>=0;--r)for(i[t].m[r].update(),f=i[t].m[r].t.length-1;f>=0;--f)i[t].m[r].t[f].update();for(u=i[t].t.length-1;u>=0;--u)i[t].t[u].update()}this.updateContent()}},setReadMode:function(n){this.readMode=n},update:function(){this.ctx&&(this.ctxWidth=this.ctx.canvas.width,this.ctxHeight=this.ctx.canvas.height,this.bounding=this.ctx.canvas.getBoundingClientRect(),this._leftPanelController&&this._leftPanelController.getPanel().setHeight(this.ctxHeight),this.fullscreen?(this.centerScreen=this.ctxWidth*.5,this.visibleLeft=0):(this.visibleLeft=this._leftPanelController.getPanel().getWidth(),this.centerScreen=(this.ctxWidth+this.visibleLeft)*.5));this.needUpdateContent=!0;this.needUpdate=!0;this.timeScale.update()},updateWithStrafe:function(){this.timeScale&&this.timeScale.strafe(this.offsetX);this.update()},updateContent:function(n){if(this.rightScroll.position=0,this.rightScroll._value=0,this.projectsLines=[],this.projectsLinesY=[],n){this.contentHeight=this.getContentHeight();this.fullscreen||(this.contentHeight+=this.itemMargin);var t=this.ctxHeight-this.timeScale.height();this.rightScroll.init(this.timeScale.height(),t,this.contentHeight+!this.fullscreen*this.itemMargin,this.ctxWidth);this.rightScroll.clamp();this.zoomBar&&this.bottomScroll.updateThumb(this.zoomBar.thumb);this.visibleUp=!this.fullscreen*this.timeScale.height();this.needUpdateContent=!1}this.needUpdateContent=!0;this.update()},updateWithScroll:function(){if(this.storage)for(var t,i=this.storage.projects(),r=i.length,n=0;n<r;++n)for(i[n].titleWidth=-1,t=0;t<i[n].m.length;++t)i[n].m[t].updateTimes();this.needUpdateContent=!0;this.update()},updateData:function(){this.needUpdate=!0;this._leftPanelController&&this._leftPanelController.rebuildContent()},reset:function(){this.storage.reset();this._undoManager.reset()},offMenus:function(){this.menuTask.reset();this.menuMileStone.reset();this.linkWidget.setBound({x:0,y:0,w:0,h:0})},offWidgets:function(){this.milestoneDescWidget.check(null);this.taskDescWidget.check(null)},backLightTask:function(){return this.editBox.enable?{p:this.editBox.p,m:this.editBox.m,t:this.editBox.t==-1?undefined:this.editBox.t}:this.isLBMDown?{p:this.capProject,m:this.capMilestone,t:this.capTask}:this.milestoneChange?{p:undefined,m:undefined,t:undefined}:this.menuMileStone.ref&&!this.menuTask.ref?{p:this.menuMileStone.hide?undefined:this.menuMileStone.p,m:this.menuMileStone.hide?undefined:this.menuMileStone.m,t:undefined}:{p:this.hitProject,m:this.hitMilestone,t:this.hitTask}},render:function(){var n,i,r;this.zoomBar&&this.zoomBar.render();this.animator.update();this.drawScene();this.drawEditLayer();this.mouse&&lt===this.editMode&&(this.mouse.y<=this.visibleUp&&this.rightScroll.value()>0&&(this.rightScroll.value()<=.0001?this.rightScroll.setTopPos():(n=Math.max(t(this.rightScroll.value()/this.itemMargin)*this.itemMargin-this.itemMargin,o),this.animator.moveToY(n)),this.painter.clearZones(!0)),this.ctxHeight-this.itemMargin<this.mouse.y&&(i=t(this.rightScroll.maxValue()/this.itemMargin)*this.itemMargin,r=Math.min(t((this.rightScroll.value()+this.itemMargin)/this.itemMargin)*this.itemMargin+this.itemMargin,i),this.animator.moveToY(r),this.painter.clearZones(!0)))},onmousemove:function(n,i){var a,u,yt,nt,f,g,l,v,y,ot,w,h,b,tt,rt,st,ht,ut;if(this.userEvents){if(a=!1,u=this.windowToCanvas(n.clientX,n.clientY),u.altKey=n.altKey,this.leftPanelController().getPanel().width>=u.x){this.offMenus();this.mouse=u;this.mouse.baseEvent=n;return}if(!this.leftPanelController().getPanel().editBox.isEnable()&&(this.mouse||(this.mouse=u),this.mouse.x!=u.x||this.mouse.y!=u.y||i)){if(this.mouse=u,this.mouse.baseEvent=n,this.mouse.y<=this.visibleUp){this.linkWidget.onmousemove(u.x,u.y);this.menuTask.onmousemove(u.x,u.y);this.menuMileStone.onmousemove(u.x,u.y);this.menuTask.checkZone(u.x,u.y)||this.linkWidget.checkZone(u.x,u.y)||(this.overlay.style.cursor="",-1!==this.hitTask&&(this.hitTask=-1,this.hitMilestone=-1,this.needUpdate=!0));return}if(this.isLBMDown&&(this.pressMouse.change=!(u.x==this.pressMouse.x&&u.y==this.pressMouse.y)),!this.isLBMDown){if(this.bottomScroll.onmousemove(u))return;if(this.rightScroll.onmousemove(u))return;if(this.rightScroll.isHit(u)){this.hitMilestone=-1;this.hitTask=-1;this.offMenus();return}}if(et===this.editMode){if(!this.readMode&&!this.editBox.enable&&this.linkLineEdit){this.overlay.style.cursor="pointer";this.linkLineEdit.update=!0;this.moveMouse=this.mouse;this.pushLink&&(this.pushLink.task.links.pop(),this.pushLink=undefined);var ct=this.hitProject,at=this.hitMilestone,vt=this.hitTask,e=null,d;this.calculateHit(n,!0,n.ctrlKey||n.metaKey);"w-resize"===this.overlay.style.cursor&&(this.overlay.style.cursor="pointer");this.linkLineEdit.parent=null;-1!=this.hitProject&&-1!=this.hitTask&&-1===this.hitMilestone?(e=this.storage.getTask(this.hitProject,undefined,this.hitTask),e._status!==r&&this.hitMilestone===this.linkLineEdit.m?(this.linkLineEdit.parent=e,this.linkLineEdit.parentSide=this.timeToSceneX(this.linkLineEdit.parent.beginTime)+Math.abs(this.timeToSceneX(this.linkLineEdit.parent.endTime)-this.timeToSceneX(this.linkLineEdit.parent.beginTime))*.5>this.mouse.x?s:c,e.endFail&&(this.linkLineEdit.parentSide=s),d=this.linkLineEdit.parentSide===c&&this.linkLineEdit.side===c?bt:this.linkLineEdit.parentSide===s&&this.linkLineEdit.side===s?wt:it,this.pushLink={task:e},this.pushLink.linkObj={},this.pushLink.linkObj.dependenceTaskId=e.id(),this.pushLink.linkObj.linkType=d,this.pushLink.linkObj.parentTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.type="link",this.linkLineEdit.parentSide===c&&this.linkLineEdit.side===s?(this.pushLink.linkObj.dependenceTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.parentTaskId=e.id(),this.pushLink.task=this.linkLineEdit.task,this.linkLineEdit.task.links.push(this.pushLink.linkObj)):this.linkLineEdit.parentSide===s&&this.linkLineEdit.side===c?e.links.push(this.pushLink.linkObj):(this.pushLink.linkObj.dependenceTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.parentTaskId=e.id(),this.pushLink.task=this.linkLineEdit.task,this.linkLineEdit.task.links.push(this.pushLink.linkObj)),this._mouseInLinkZone&&(this._mouseInLinkZone.task=e,this._mouseInLinkZone.linkToTaskId=e.id(),this._mouseInLinkZone.linkToTaskSide=this.linkLineEdit.parentSide),this.linkLineEdit.pp=this.hitProject,this.linkLineEdit.pm=this.hitMilestone,this.linkLineEdit.pt=this.hitTask,this.isValidEditLink()?(d=this.linkLineEdit.parentSide===c&&this.linkLineEdit.side===c?bt:this.linkLineEdit.parentSide===s&&this.linkLineEdit.side===s?wt:it,this.pushLink={task:e},this.pushLink.linkObj={},this.pushLink.linkObj.dependenceTaskId=e.id(),this.pushLink.linkObj.linkType=d,this.pushLink.linkObj.parentTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.type="link",this.linkLineEdit.parentSide===c&&this.linkLineEdit.side===s?(this.pushLink.linkObj.dependenceTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.parentTaskId=e.id(),this.pushLink.task=this.linkLineEdit.task,this.linkLineEdit.task.links.push(this.pushLink.linkObj)):this.linkLineEdit.parentSide===s&&this.linkLineEdit.side===c?e.links.push(this.pushLink.linkObj):(this.pushLink.linkObj.dependenceTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.parentTaskId=e.id(),this.pushLink.task=this.linkLineEdit.task,this.linkLineEdit.task.links.push(this.pushLink.linkObj))):(this.linkLineEdit.pp=-1,this.linkLineEdit.pm=-1,this.linkLineEdit.pt=-1,this._mouseInLinkZone&&(this._mouseInLinkZone.task=undefined,this._mouseInLinkZone.linkToTaskId=undefined,this._mouseInLinkZone.linkToTaskSide=undefined),this.overlay.style.cursor="")):this.overlay.style.cursor=""):-1!=this.hitProject&&-1!=this.hitTask&&-1!=this.hitMilestone?(e=this.storage.getTask(this.hitProject,this.hitMilestone,this.hitTask),e._status!==r&&this.hitMilestone===this.linkLineEdit.m?(this.linkLineEdit.parent=e,this.linkLineEdit.parentSide=this.timeToSceneX(this.linkLineEdit.parent.beginTime)+Math.abs(this.timeToSceneX(this.linkLineEdit.parent.endTime)-this.timeToSceneX(this.linkLineEdit.parent.beginTime))*.5>this.mouse.x?s:c,this.linkLineEdit.pp=this.hitProject,this.linkLineEdit.pm=this.hitMilestone,this.linkLineEdit.pt=this.hitTask,e.endFail&&(this.linkLineEdit.parentSide=s),d=this.linkLineEdit.parentSide===c&&this.linkLineEdit.side===c?bt:this.linkLineEdit.parentSide===s&&this.linkLineEdit.side===s?wt:it,this.pushLink={task:e},this.pushLink.linkObj={},this.pushLink.linkObj.dependenceTaskId=e.id(),this.pushLink.linkObj.linkType=d,this.pushLink.linkObj.parentTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.type="link",this.linkLineEdit.parentSide===c&&this.linkLineEdit.side===s?(this.pushLink.linkObj.dependenceTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.parentTaskId=e.id(),this.pushLink.task=this.linkLineEdit.task,this.linkLineEdit.task.links.push(this.pushLink.linkObj)):this.linkLineEdit.parentSide===s&&this.linkLineEdit.side===c?e.links.push(this.pushLink.linkObj):(this.pushLink.linkObj.dependenceTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.parentTaskId=e.id(),this.pushLink.task=this.linkLineEdit.task,this.linkLineEdit.task.links.push(this.pushLink.linkObj)),this._mouseInLinkZone&&(this._mouseInLinkZone.task=e,this._mouseInLinkZone.linkToTaskId=e.id(),this._mouseInLinkZone.linkToTaskSide=this.linkLineEdit.parentSide),this.isValidEditLink()?(this.pushLink={task:e},this.pushLink.linkObj={},this.pushLink.linkObj.dependenceTaskId=e.id(),this.pushLink.linkObj.linkType=d,this.pushLink.linkObj.parentTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.type="link",this.linkLineEdit.parentSide===c&&this.linkLineEdit.side===s?(this.pushLink.linkObj.dependenceTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.parentTaskId=e.id(),this.pushLink.task=this.linkLineEdit.task,this.linkLineEdit.task.links.push(this.pushLink.linkObj)):this.linkLineEdit.parentSide===s&&this.linkLineEdit.side===c?e.links.push(this.pushLink.linkObj):(this.pushLink.linkObj.dependenceTaskId=this.linkLineEdit.task.id(),this.pushLink.linkObj.parentTaskId=e.id(),this.pushLink.task=this.linkLineEdit.task,this.linkLineEdit.task.links.push(this.pushLink.linkObj))):(this.linkLineEdit.pp=-1,this.linkLineEdit.pm=-1,this.linkLineEdit.pt=-1,this._mouseInLinkZone&&(this._mouseInLinkZone.task=undefined,this._mouseInLinkZone.linkToTaskId=undefined,this._mouseInLinkZone.linkToTaskSide=undefined),this.overlay.style.cursor="")):this.overlay.style.cursor=""):(this.linkLineEdit.pp=-1,this.linkLineEdit.pm=-1,this.linkLineEdit.pt=-1,this._mouseInLinkZone&&(this._mouseInLinkZone.task=undefined,this._mouseInLinkZone.linkToTaskId=undefined,this._mouseInLinkZone.linkToTaskSide=undefined),this.overlay.style.cursor="");this.hitProject=ct;this.hitMilestone=at;this.hitTask=vt;this.needUpdate=!0;return}}else if(lt===this.editMode&&!this.readMode){this.moveMouse=u;this.dragBound.y=t(u.y/this.itemMargin)*this.itemMargin+(this.itemMargin-this.itemHeight)*.5;this.getTheMilestoneTaskToDrag(n);this.updateDragDrop=!0;this.leftPanelController().clearFocus();return}if(this.taskDescWidget.ref){if(this.taskDescWidget.checkInBoundDetailsLink(u.x,u.y)){this.overlay.style.cursor="pointer";return}if(this.overlay.style.cursor="",!this.readMode&&!this.taskDescWidget.checkBound(u.x,u.y)){this.offMenus();this.overlay.style.cursor="";return}}if(this.milestoneDescWidget.ref&&!this.readMode&&!this.milestoneDescWidget.checkBound(u.x,u.y)){this.offMenus();this.overlay.style.cursor="";return}if(this.menuTask.checkZone(u.x,u.y)){this.moveMouse=this.mouse;this.needUpdate=!0;this.menuTask.disableSetter=!0;this.hitProject=this.menuTask.p;this.hitMilestone=this.menuTask.m;this.hitTask=this.menuTask.t;this.menuTask.disableSetter=!1;this.menuMileStone.reset();this.linkWidget.reset();this.menuTask.onmousemove(u.x,u.y);return}if(this.menuMileStone.checkZone(u.x,u.y)){this.moveMouse=this.mouse;this.needUpdate=!0;this.calculateHit(n,!0,n.ctrlKey||n.metaKey);this.hitProject=this.menuTask.p;this.hitMilestone=this.menuTask.m;this.hitTask=this.menuTask.t;this.menuTask.reset();this.linkWidget.reset();this.menuMileStone.onmousemove(u.x,u.y);return}if(this.linkWidget.checkZone(u.x,u.y)){this.moveMouse=this.mouse;this.needUpdate=!0;this.menuMileStone.reset();this.menuTask.reset();this.linkWidget.onmousemove(u.x,u.y);return}if(this.editBox.enable&&!this.pressedButtonRight){this.editBox.onmousemove(u);if(this.editBox.milestoneRef&&this.editBox.createMode&&Math.abs(u.x-(this.editBox.bound.x+this.editBox.bound.w))<ft&&u.y>this.editBox.bound.y+this.editBox.bound.h&&u.y<this.editBox.bound.y+this.editBox.bound.h+this.itemMargin){this.overlay.style.cursor="w-resize";return}if((Math.abs(this.editBox.bound.x-u.x)<ft||Math.abs(this.editBox.bound.x+this.editBox.bound.w-u.x)<ft)&&this.editBox.bound.y<=u.y&&u.y<=this.editBox.bound.y+this.editBox.bound.h){this.overlay.style.cursor="w-resize";return}this.overlay.style.cursor=this.editBox.inBound(u.x,u.y)&&u.x>this.visibleLeft||this.editBox.checkUp?"text":"";return}if(yt=this.timeScale.hourInPixels/this.timeScale.scaleX,nt=this.timeScale.scaleUnitStep(),this.isLBMDown){if(nt=24,v=(u.x-this.timeScale.hourInPixels*this.offsetX)/(this.timeScale.hourInPixels*nt)*nt*this.timeScale.scaleX+this.anchorMouse.x,l=this.sticking?t(v/nt)*nt:v,this.createMode)this.capProject=this.createMode.p,this.capMilestone=this.createMode.m,this.capTask=this.createMode.t,this.capSide=c;else if(n.which===1&&!this.editBox.enable&&this.editBox.checkUp)return;if(ot=this.ctxWidth*k.bigClampPct,a=!1,-1!==this.capProject&&(a=p!==this.storage.getProject(this.capProject).status()),-1===this.capProject||-1===this.capTask||-1!==this.capMilestone||this.readMode||a){if(-1==this.capProject||-1==this.capTask||-1===this.capMilestone||this.readMode||a)-1==this.capProject||-1!==this.capTask||-1===this.capMilestone||this.readMode||a?(this.pressedButtonRight=!1,this.pressedButtonRight=n.buttons?n.buttons==2:n.button===2,this.offsetX+=(u.x-this.moveMouse.x)/this.timeScale.hourInPixels,this.offsetX=Math.max(this.offsetX,this.zoomBar.maxPos()),this.offsetX=Math.min(this.offsetX,this.zoomBar.minPos()),this.timeScale&&this.timeScale.strafe(this.offsetX),this.enableTouch&&(ht=t((u.y-this.moveMouse.y)/this.itemMargin)*this.itemMargin,this.rightScroll.forwardMoveY(ht-o)),this.zoomBar&&this.bottomScroll.updateThumb(this.zoomBar.thumb)):(g=this.storage.getMilestone(this.capProject,this.capMilestone),g&&!g.isInEditMode&&(v>=0&&(l+=24),g.updateEnd(l)));else if(f=this.storage.getTask(this.capProject,this.capMilestone,this.capTask),undefined!==f&&r!=f._status&&(!this.editBox.enable||this.editBox.createMode)){if(this.moveMouse.y-u.y!=0&&!this._modeStrafe&&!this.editBox.enable&&0===this.capSide){w=this.timeScale.hourInPixels/this.timeScale.scaleX;h=f.duration*w;b=this.anchorMouse.x*w;tt=f.duration;rt=this.moveMouse.x;f.endFail&&(h=-b,tt=h/w,y=this.timeToSceneX(f.beginTime),h=this.ctxWidth-k.smallClampPx,y>this.visibleLeft-1?h=this.ctxWidth-k.smallClampPx-y:(h=this.ctxWidth*k.bigClampPct-this.visibleLeft,b=0,rt=this.visibleLeft));this.dragBound={x:rt,y:this.moveMouse.y,width:h,height:this.itemHeight,dy:0,dx:b,time:tt,failEnd:f.endFail};this.itemToDrop={t:this.capTask,m:this.capMilestone,p:this.capProject};this.capTask=-1;this.capMilestone=-1;this.capProject=-1;this.capSide=-1;this.hitTask=-1;this.hitMilestone=-1;this.hitProject=-1;this.hitSide=-1;this.isLBMDown=!1;this.needUpdate=!0;this.editMode=lt;return}this._modeStrafe=!0;g=this.storage.getMilestone(this.capProject,this.capMilestone);s===this.capSide?(v<=0&&(l-=24),f.updateBegin(l,g.endTime)):c===this.capSide?(v>=0&&(l+=24),f.updateEnd(l),f.endFail=!1):(f.endFail&&f.updateEnd(g.endTime),f.strafe(l),f.endFail=!1,su&&this.queryMoveLinks&&this.queryMoveLinks&&(this.queryMoveLinks.right&&this.queryMoveLinks.right.walkElements(f,function(n,t){n&&t&&n._id!==t._id&&n.endTime>t.beginTime&&(t.strafe(n.endTime),t.change=!0)}),this.queryMoveLinks.left&&this.queryMoveLinks.left.walkElements(f,function(n,t){n&&t&&n._id!==t._id&&n.beginTime<t.endTime&&(t.strafe(n.beginTime-(t.endTime-t.beginTime)),t.change=!0)})));this.storage.getMilestone(this.capProject,this.capMilestone).updateTimes();this.pressMouse.change&&this.taskDescWidget.checkAndOff(f)}}else if(f=this.storage.p[this.capProject].t[this.capTask],undefined!==f&&r!=f._status&&(!this.editBox.enable||this.editBox.createMode)){if(this.moveMouse.y-u.y!=0&&!this._modeStrafe&&!this.editBox.enable&&0===this.capSide){w=this.timeScale.hourInPixels/this.timeScale.scaleX;h=f.duration*w;b=this.anchorMouse.x*w;tt=f.duration;rt=this.moveMouse.x;f.endFail&&(h=-b,tt=h/w,y=this.timeToSceneX(f.beginTime),h=this.ctxWidth-k.smallClampPx,y>this.visibleLeft-1?h=this.ctxWidth-k.smallClampPx-y:(h=this.ctxWidth*k.bigClampPct-this.visibleLeft,b=0,rt=this.visibleLeft));this.dragBound={x:rt,y:this.moveMouse.y,width:h,height:this.itemHeight,dy:0,dx:b,time:tt,failEnd:f.endFail};this.itemToDrop={t:this.capTask,m:this.capMilestone,p:this.capProject};this.capTask=-1;this.capMilestone=-1;this.capProject=-1;this.capSide=-1;this.hitTask=-1;this.hitMilestone=-1;this.hitProject=-1;this.hitSide=-1;this.isLBMDown=!1;this.needUpdate=!0;this.editMode=lt;return}this._modeStrafe=!0;s===this.capSide?(v<=0&&(l-=24),f.updateBegin(l)):c===this.capSide?(v>=0&&(l+=24),f.updateEnd(l),f.endFail=!1):(f.endFail&&(y=this.timeToSceneX(f.beginTime),ot=this.ctxWidth-k.smallClampPx,y<=this.visibleLeft-1&&(ot=this.ctxWidth*k.bigClampPct),st=Math.floor(this.worldToSceneX(ot)/24)*24,f.updateEnd(st)),f.strafe(l),f.endFail=!1);su&&this.queryMoveLinks&&this.queryMoveLinks&&(this.queryMoveLinks.right&&1&&this.queryMoveLinks.right.walkElements(f,function(n,t){n&&t&&n._id!==t._id&&n.endTime>t.beginTime&&(t.strafe(n.endTime),t.change=!0)}),this.queryMoveLinks.left&&1&&this.queryMoveLinks.left.walkElements(f,function(n,t){n&&t&&n._id!==t._id&&n.beginTime<t.endTime&&(t.strafe(n.beginTime-(t.endTime-t.beginTime)),t.change=!0)}));this.storage.p[this.capProject]._calcTimes();this.pressMouse.change&&this.taskDescWidget.checkAndOff(f)}this.moveMouse=u;this.needUpdate=!0;this.hitTask=-1;this.hitMilestone=-1;this.milestoneDescWidget.check(null);this.taskDescWidget.check(null);this.offMenus();this.zoomBar&&(this.zoomBar.repaint=!0);return}if(ut={t:this.hitTask,p:this.hitProject},this.calculateHit(n,!0,n.ctrlKey||n.metaKey),this.moveMouse=this.mouse,a=!1,-1!==this.hitProject&&(a=p!==this.storage.getProject(this.hitProject).status()),this.readMode){(ut.t!=this.hitTask||ut.p!=this.hitProject||this.backLightMilestone.update)&&(this.needUpdate=!0,this.backLightMilestone.update=!1);return}if(this.hitSide===kt?(this.menuTask.set(this.hitProject,this.hitMilestone,this.hitTask,this.storage.getTasWithInd(this.hitProject,this.hitMilestone,this.hitTask),u.x,u.y),-1==this.hitProject&&this.menuTask.reset(),-1!==this.backLightMilestone.m&&this.menuMileStone.set(this.backLightMilestone.p,this.backLightMilestone.m,this.storage.getMilestone(this.backLightMilestone.p,this.backLightMilestone.m)),-1===this.backLightMilestone.p&&this.menuMileStone.reset()):(this.hitSide===s||this.hitSide===c)&&(this.menuTask.reset(),this.menuMileStone.reset(),r===this.menuTask._status||a||(this.overlay.style.cursor="w-resize")),-1===ut.t&&-1===this.hitTask)this.linkWidget.onmousemove(u.x,u.y);this.menuTask.onmousemove(u.x,u.y)&&this.linkWidget.reset();this.menuMileStone.onmousemove(u.x,u.y)&&this.linkWidget.reset();ut.t!=this.hitTask||ut.p!=this.hitProject||this.backLightMilestone.update?(this.backLightMilestone.update?this.milestoneChange||(this._leftPanelController.updateFocus(this.backLightMilestone.p,this.backLightMilestone.m,undefined),-1!==this.backLightMilestone.m&&this.menuMileStone.set(this.backLightMilestone.p,this.backLightMilestone.m,this.storage.getMilestone(this.backLightMilestone.p,this.backLightMilestone.m))):this.editBox.isEnable()?this._leftPanelController.updateFocus(this.editBox.p,this.editBox.m==-1?undefined:this.editBox.m,this.editBox.t==-1?undefined:this.editBox.t):this._leftPanelController.updateFocus(this.hitProject,this.hitMilestone==-1?undefined:this.hitMilestone,this.hitTask==-1?undefined:this.hitTask),this.needUpdate=!0,this.backLightMilestone.update=!1):this.leftPanelController().clearHighlight()}}},onmousedown:function(n){var t,s,h,a,y,g;if(this.userEvents){if(this._modeStrafe=!1,this.animator.stop(),this.zoomBar&&this.zoomBar.releaseCapture(),t=null,this.capTask=-1,this.capSide=0,this.downMouse=this.windowToCanvas(n.clientX,n.clientY),this.pressMouse={x:this.downMouse.x,y:this.downMouse.y,change:!1},this._leftPanelController.getPanel().editBox.isEnable()){this._leftPanelController.getPanel().editBox.inBound(n)||this._leftPanelController.clearFocus();return}if(!this.bottomScroll.onmousedown(this.downMouse)&&!this.rightScroll.onmousedown(this.downMouse)){if(this.leftBoxMousePressed=0,this.moveMouse={x:this.downMouse.x,y:this.downMouse.y},this.taskDescWidget.ref){if(!this.taskDescWidget.checkBound(this.pressMouse.x,this.pressMouse.y)){this.taskDescWidget.checkInBoundDetailsLink(this.pressMouse.x,this.pressMouse.y)&&this.taskDescWidget.setLinkRef("tasks.aspx?prjID="+this.taskDescWidget.ref.t._owner+"&id="+this.taskDescWidget.ref.t._id);this.offMenus();this.overlay.style.cursor="";return}this.needUpdate=!0}if(this.milestoneDescWidget.ref&&!this.milestoneDescWidget.checkBound(this.pressMouse.x,this.pressMouse.y)){this.offMenus();this.overlay.style.cursor="";return}if((this.isLBMDown=!0,n.buttons?this.pressedButtonRight=n.buttons==2:(this.pressedButtonRight=n.button===2,this.pressedButtonRight||(this.pressedButtonLeft=n.button===1)),!this.linkWidget.onmousedown(this.moveMouse.x,this.moveMouse.y))&&!this.menuTask.onmousedown(this.moveMouse.x,this.moveMouse.y)&&!this.menuMileStone.onmousedown(this.moveMouse.x,this.moveMouse.y)&&!(this.mouse.y<=this.visibleUp)){if(this.calculateHit(n,!this.editBox.enable,n.ctrlKey||n.metaKey),this.editBox.enable){if(this.editBox.p===this.hitProject&&this.editBox.m===this.hitMilestone&&this.editBox.t===this.hitTask){this.capTask=this.hitTask;this.capMilestone=this.hitMilestone;this.capProject=this.hitProject;this.capSide=this.hitSide;this.editBox.onmousedown(this.moveMouse);return}if(-1!==this.editBox.p&&-1!==this.editBox.m&&this.editBox.t===-1){this.editBox.onmousedown(this.moveMouse);if(this.editBox.inBound(this.moveMouse.x,this.moveMouse.y))return}this.editBox.onmousedown(this.moveMouse);if(this.editBox.checkUp){this.hitProject=-1;this.hitMilestone=-1;this.hitTask=-1;this.capTask=-1;this.capMilestone=-1;this.capProject=-1;return}}if(this.capTask=this.hitTask,this.capMilestone=this.hitMilestone,this.capProject=this.hitProject,this.capSide=this.hitSide,this.hitLink&&(this.capLink=this.hitLink),this._mouseInLinkZone){this.addEditLink()&&(this.editMode=et);this.needUpdate=!0;return}if(-1===this.menuMileStone.p&&-1===this.menuMileStone.m&&this.pressedButtonRight&&-1===this.capProject&&-1===this.capTask&&-1===this.capMilestone){this.anchorMouse={x:0,y:0};this.exist&&this.capLink||this.hitLink?this._modelController.addTaskOperation(tu,this.hitLink?this.hitLink:this.capLink):this.editBox.enable||(this.calculateLineHit(n)?-1!==this.hitLine.p&&p===this.storage.getProject(this.hitLine.p).status()&&(s=this.hitLine.t+1,-1!==this.hitLine.m&&this.storage.getMilestone(this.hitLine.p,this.hitLine.m).setCollapse(!1),this.storage.p[this.hitLine.p].fullCollapse&&this.storage.p[this.hitLine.p].setFullCollapse(!1),n.ctrlKey||n.metaKey?(this.updateData(),this.needUpdateContent=!0,this.drawScene(),this.createMilestone(this.hitLine.p,this.hitLine.bottomMilestoneInd?this.hitLine.bottomMilestoneInd:this.hitLine.m)):(this.storage.p[this.hitLine.p].collapse&&-1===this.hitLine.m&&(this.storage.p[this.hitLine.p].setCollapse(!1),this.updateData(),this.needUpdateContent=!0,this.drawScene()),this.createTask(this.hitLine.p,this.hitLine.m,s),this.createMode={p:this.hitLine.p,m:this.hitLine.m,t:s})):this.downMouse.y>this.visibleUp&&this.storage.p.length&&p===this.storage.getProject(0).status()&&(this.storage.p[0].setCollapse(!1),h=this.storage.p[0].t.length,this.createTask(0,-1,h),this.createMode={p:0,m:-1,t:h}));this.offMenus();this.offWidgets();return}if(n.ctrlKey||n.metaKey){if(-1!=this.capProject&&-1!=this.capTask&&-1===this.capMilestone&&(t=this.storage.getTask(this.capProject,undefined,this.capTask)),-1!=this.capProject&&-1!=this.capTask&&-1!=this.capMilestone&&(t=this.storage.getTask(this.capProject,this.capMilestone,this.capTask)),t){if(r==t._status||!(n.ctrlKey||n.metaKey))return;var c=this.timeScale.hourInPixels/this.timeScale.scaleX,u=t.duration*c,l=this.anchorMouse.x*c,w=t.duration,b=this.moveMouse.x;t.endFail&&(u=-l,w=u/c,a=this.timeToSceneX(t.beginTime),u=this.ctxWidth-k.smallClampPx,a>this.visibleLeft-1?u=this.ctxWidth-k.smallClampPx-a:(u=this.ctxWidth*k.bigClampPct-this.visibleLeft,l=0,b=this.visibleLeft));this.dragBound={x:b,y:this.moveMouse.y,width:u,height:this.itemHeight,dy:0,dx:l,time:w,failEnd:t.endFail};this.itemToDrop={t:this.capTask,m:this.capMilestone,p:this.capProject};this.capTask=-1;this.capMilestone=-1;this.capProject=-1;this.capSide=-1;this.hitTask=-1;this.hitMilestone=-1;this.hitProject=-1;this.hitSide=-1;this.isLBMDown=!1;this.needUpdate=!0;this.editMode=lt}return}if(!this.editBox.enable){this.needUpdate=!0;var i=null,o=-1,d=-1,f=-1,e=[],v=!0;if(-1===this.capProject||-1===this.capTask||-1!==this.capMilestone||this.readMode)if(-1==this.capProject||-1==this.capTask||-1===this.capMilestone||this.readMode)-1==this.capProject||-1!==this.capTask||-1===this.capMilestone||this.readMode?this.capLink&&(this.needUpdate=!0):(y=this.storage.milestoneIds(this.capProject,this.capMilestone),g=this.storage.getMilestone(this.capProject,this.capMilestone),this._undoManager.add(or,{p:this.capProject,m:this.capMilestone,t:g,index:this.capMilestone,taskId:undefined,milestoneId:y.m,projectId:y.p,silentUpdateMode:v}),this._undoManager.add(ou,null));else{if(i=this.storage.getTask(this.capProject,this.capMilestone,this.capTask),r===i._status)return;o=this.storage.p[this.capProject]._id;d=this.storage.p[this.capProject].m[this.capMilestone]._id;f=this.storage.p[this.capProject].m[this.capMilestone].t[this.capTask]._id;su&&(this.queryMoveLinks=this._modelController.collectBeginEndItems(this.capProject,this.capMilestone,f),this.queryMoveLinks&&(this.queryMoveLinks.right&&this.queryMoveLinks.right.walkElements(i,function(n,t,i){i&&e.push(i)}),this.queryMoveLinks.left&&this.queryMoveLinks.left.walkElements(i,function(n,t,i){i&&e.push(i)})));this._undoManager.addTempOperation(ri,{p:this.capProject,m:this.capMilestone,t:i,index:this.capTask,taskId:f,milestoneId:d,projectId:o,silentUpdateMode:v,queryMoveLinks:e})}else{if(i=this.storage.p[this.capProject].t[this.capTask],r===i._status)return;o=this.storage.p[this.capProject]._id;f=this.storage.p[this.capProject].t[this.capTask]._id;su&&(this.queryMoveLinks=this._modelController.collectBeginEndItems(this.capProject,undefined,f),this.queryMoveLinks&&(this.queryMoveLinks.right&&this.queryMoveLinks.right.walkElements(i,function(n,t,i){i&&e.push(i)}),this.queryMoveLinks.left&&this.queryMoveLinks.left.walkElements(i,function(n,t,i){i&&e.push(i)})));this._undoManager.addTempOperation(ri,{p:this.capProject,m:undefined,t:i,index:this.capTask,taskId:f,milestoneId:undefined,projectId:o,silentUpdateMode:v,queryMoveLinks:e})}}}}}},onmouseup:function(t,i){var y,a;if(this.userEvents){this._modeStrafe=!1;var f,e=!1,c=-1,l=-1,v=-1,r,u,o=!1,s=this,h=this.pressMouse.change;if(this.createMode=null,this.needUpdateScrollContent=!0,this.isLBMDown=!1,this.downMouse=this.windowToCanvas(t.clientX,t.clientY),this.leftBoxMousePressed){this.leftBoxMousePressed--;this.offMenus();this.needUpdate=!0;return}if(!i&&(this.taskDescWidget.ref&&this.taskDescWidget.href&&(this.taskDescWidget.checkBound(this.downMouse.x,this.downMouse.y)||this.taskDescWidget.checkInBoundDetailsLink(this.downMouse.x,this.downMouse.y)&&(n.open(this.taskDescWidget.href),this.taskDescWidget.setLinkRef(null))),this.taskDescWidget.setLinkRef(null),!(this.pressMouse.y<=this.visibleUp))){if(et===this.editMode){this.applyEditLink();this.menuMileStone.p=-1;this.menuMileStone.m=-1;this.capProject=-1;this.queryMoveLinks=null;this.capTask=-1;this.capMilestone=-1;this.capProject=-1;this.capSide=-1;return}if(lt===this.editMode){this.painter.clearZones(!0);this.moveElement(t);this.updateData();return}if(this.editBox.enable){this.editBox.onmouseup(this.windowToCanvas(t.clientX,t.clientY));return}if(this.menuMileStone.reset(),this.menuTask.reset(),this.editBox.checkUp&&t.which!==3){this.editBox.onmouseup(this.downMouse);return}if(this.pressMouse={x:this.downMouse.x,y:this.downMouse.y,change:this.pressMouse.change},y={t:this.hitTask,m:this.hitMilestone,p:this.hitProject},this.calculateHit(t,!0),-1!==this.backLightMilestone.p&&-1!==this.backLightMilestone.m&&-1===this.hitTask&&(this.hitProject=this.backLightMilestone.p,this.hitMilestone=this.backLightMilestone.m),this.clickPosCentreing&&(this.animator.moveCenterToX(this.storage.getTask(this.clickPosCentreing.p,this.clickPosCentreing.m,this.clickPosCentreing.t).beginTime),this.clickPosCentreing=null,this.offMenus(),this.overlay.style.cursor=""),-1!==this.capProject&&-1!==this.capTask&&-1!==this.capMilestone){if(e=p!==this.storage.getProject(this.capProject).status(),r=this.storage.getTask(this.capProject,this.capMilestone,this.capTask),this.pressedButtonRight&&!i&&!e){-1!==this.hitTask&&this.handlers[vt]&&!this.readMode&&(this._modelController.statusElement={p:this.capProject,m:this.capMilestone,t:this.capTask,ids:this.storage.taskIds(this.capProject,this.capMilestone,this.capTask),isTask:!0,task:r,ref:r},f={left:t.clientX-this.ctx.canvas.offsetLeft,top:this.currentElementY+this.ctx.canvas.offsetTop},this.offWidgets(),this.handlers[vt](f,r,!0,this.storage.getProject(this.capProject).id()));this.menuMileStone.p=-1;this.menuMileStone.m=-1;this.queryMoveLinks=null;this.capTask=-1;this.capMilestone=-1;this.capProject=-1;this.capSide=-1;this.offMenus();this.leftPanelController().clearFocus();return}h?(l=this.storage.getProject(this.capProject)._id,v=this.storage.getMilestone(this.capProject,this.capMilestone)._id,c=r._id,this._undoManager.applyTempOperation(),this._undoManager.updateOperation(!0,r,this.queryMoveLinks)):(this.taskDescWidget.check(r)&&(r.dropDownWidget=!r.dropDownWidget,r.dropDownWidget&&this.milestoneDescWidget.check(null),o=!0),this._undoManager.deleteTempOperation());this.menuMileStone.p=-1;this.menuMileStone.m=-1;this.queryMoveLinks=null;this.leftPanelController().scrollContent(this.rightScroll.value())}if(-1!==this.capProject&&-1!==this.capTask&&-1===this.capMilestone){if(e=p!==this.storage.getProject(this.capProject).status(),r=this.storage.getTask(this.capProject,undefined,this.capTask),this.pressedButtonRight&&!i&&!e){-1!==this.hitTask&&this.handlers[vt]&&!this.readMode&&(this._modelController.statusElement={p:this.capProject,m:undefined,t:this.capTask,ids:this.storage.taskIds(this.capProject,undefined,this.capTask),isTask:!0,task:r,ref:r},f={left:t.clientX-this.ctx.canvas.offsetLeft,top:this.currentElementY+this.ctx.canvas.offsetTop},this.offWidgets(),this.handlers[vt](f,r,!0,this.storage.getProject(this.capProject).id()));this.menuMileStone.p=-1;this.menuMileStone.m=-1;this.queryMoveLinks=null;this.capTask=-1;this.capMilestone=-1;this.capProject=-1;this.capSide=-1;this.offMenus();this.leftPanelController().clearFocus();return}h?(l=this.storage.getProject(this.capProject)._id,c=r._id,this._undoManager.applyTempOperation(),this._undoManager.updateOperation(!0,r,this.queryMoveLinks)):(this.taskDescWidget.check(r)&&(r.dropDownWidget=!r.dropDownWidget,r.dropDownWidget&&this.milestoneDescWidget.check(null),o=!0),this._undoManager.deleteTempOperation());this.menuMileStone.p=-1;this.menuMileStone.m=-1;this.capProject=-1;this.queryMoveLinks=null;this.leftPanelController().scrollContent(this.rightScroll.value())}if(-1!==this.menuMileStone.p&&-1!==this.menuMileStone.m){if(e=p!==this.storage.getProject(this.menuMileStone.p).status(),u=this.storage.getMilestone(this.menuMileStone.p,this.menuMileStone.m),this.pressedButtonRight&&!i&&!e){this.handlers[vt]&&!this.readMode&&(this._modelController.statusElement={p:this.menuMileStone.p,m:this.menuMileStone.m,t:undefined,ids:this.storage.milestoneIds(this.menuMileStone.p,this.menuMileStone.m),isTask:!1,milestone:u,ref:u},f={left:t.clientX-this.ctx.canvas.offsetLeft,top:this.getElementPosVertical(this.menuMileStone.p,this.menuMileStone.m,-1)+this.ctx.canvas.offsetTop-this.rightScroll.value()},this.offWidgets(),this.handlers[vt](f,u,!1,this.storage.getProject(this.menuMileStone.p).id()));this.menuMileStone.p=-1;this.menuMileStone.m=-1;this.queryMoveLinks=null;this.capTask=-1;this.capMilestone=-1;this.capProject=-1;this.capSide=-1;this.offMenus();this.leftPanelController().clearFocus();return}h||(u.dropDownWidget=!u.dropDownWidget,u.dropDownWidget?this.taskDescWidget.check(null):this.milestoneDescWidget.check(null),o=!0);this.menuMileStone.p=-1;this.menuMileStone.m=-1;this.leftPanelController().scrollContent(this.rightScroll.value())}(-1!==this.capProject&&-1===this.capTask&&-1!==this.capMilestone&&(h?this._undoManager.flushTopDummy()&&(a=this.storage.getMilestone(this.capProject,this.capMilestone),this._undoManager.updateOperation(!0,a)):this._undoManager.flushTopDummy()&&this._undoManager.flushPop(0),this.menuMileStone.p=-1,this.menuMileStone.m=-1,this.leftPanelController().scrollContent(this.rightScroll.value())),this.pressMouse.change&&(o=!0),this.capTask=-1,this.capSide=0,this.capMilestone=-1,this.pressMouse.change=!0,this.queryMoveLinks=null,this.bottomScroll.onmouseup(t))||this.rightScroll.onmouseup(t)||(o||(this.milestoneDescWidget.check(null),this.taskDescWidget.check(null)),this.needUpdate=!0,this.needUpdateScrollContent=!0)}}},ondblclick:function(n){if(this.userEvents&&(this.isLBMDown=!1,!n.ctrlKey&&!n.metaKey)){if(this.editBox.enable){this.editBox.ondblclick(this.windowToCanvas(n.clientX,n.clientY));return}(this.calculateHit(n),this.downMouse=this.windowToCanvas(n.clientX,n.clientY),this.bottomScroll.onmousedown(this.downMouse))||this.rightScroll.onmousedown(this.downMouse)||(-1===this.hitMilestone||-1===this.hitTask)&&(this.menuTask.check(this.downMouse.x,this.downMouse.y)||this.menuMileStone.check(this.downMouse.x,this.downMouse.y)||-1!==this.menuMileStone.p&&-1!==this.menuMileStone.m)}},onmousewheel:function(t){var e,r,f,u;if(this.userEvents){if(e=0,this.editMode==et&&(e=this.rightScroll.value()),this.offWidgets(),t.altKey){if(lt===this.editMode)return;t=t||n.event;r=t.deltaY||t.detail||t.wheelDelta;t.deltaY&&(r*=-1);t.detail&&(r*=-1);this.setZoomUI(this.zoom-(r/Math.abs(r)>>0));this.calculateHit(t,!0);this.zoomBar&&(this.zoomBar.repaint=!0);return}if(f=!0,undefined!==t.wheelDeltaX){var i=0,o=this.zoomBar.maxPos(),s=this.zoomBar.minPos();t.wheelDeltaX>0&&(i=s-this.offsetX,i>0&&(this.offWidgets(),this.offMenus(),this.painter.clearZones(!0),this.overlay.style.cursor="",i=Math.min(Math.abs(i),this.ctxWidth/this.timeScale.hourInPixels*wr),this.animator.addMovementX(-i)),f=!1);t.wheelDeltaX<0&&(i=o-this.offsetX,i<0&&(this.offWidgets(),this.offMenus(),this.painter.clearZones(!0),this.overlay.style.cursor="",i=Math.min(Math.abs(i),this.ctxWidth/this.timeScale.hourInPixels*wr),this.animator.addMovementX(i)),f=!1)}if(f)this.rightScroll.onmousewheel(t);this.editMode==et&&(this.linkLineEdit.posY+=e-this.rightScroll.value());this.calculateHit(t,!0);this.linkWidget.setLink(this.hitLink);u=this.windowToCanvas(t.clientX,t.clientY);this.menuTask.set(this.hitProject,this.hitMilestone,this.hitTask);0<this.menuTask.bound.w&&0<this.menuTask.bound.h&&this.menuTask.check(u.x,u.y);0<this.menuMileStone.bound.w&&0<this.menuMileStone.bound.h&&this.menuMileStone.check(u.x,u.y)}},onkeypress:function(t){if(this.userEvents){if(this.editBox.enable){this.editBox.onkeypress(t);return}if(!this._leftPanelController.getPanel().editBox.isEnable()){t=n.event||t;var i=t.keyCode?t.keyCode:t.which?t.which:t.charCode;(t.ctrlKey||t.metaKey)&&26==i&&this._undoManager.undo();(t.ctrlKey||t.metaKey)&&25==i&&this._undoManager.redo()}}},onkeydown:function(i){var s;if(this.userEvents){if(this.editBox.enable){this.editBox.onkeydown(i);return}if(!this._leftPanelController.getPanel().editBox.isEnable()){i=n.event||i;s=i.keyCode?i.keyCode:i.which?i.which:i.charCode;this.counter=0;var f=!1,u=0,e=t(this.rightScroll.maxValue()/this.itemMargin)*this.itemMargin,r=0,h=this.zoomBar.maxPos(),c=this.zoomBar.minPos();switch(s){case 191:(i.ctrlKey||i.metaKey)&&i.shiftKey&&(this.printVersion=!this.printVersion,this.needUpdate=!0);break;case 40:f=!0;u=this.fullscreen?this.rightScroll.value()+uf:t((this.rightScroll.value()+this.itemMargin)/this.itemMargin+.5)*this.itemMargin-o;this.animator.moveToY(Math.min(u,e-o),undefined,!this.fullscreen);break;case 38:f=!0;u=this.fullscreen?this.rightScroll.value()-uf:t((this.rightScroll.value()-this.itemMargin)/this.itemMargin+.5)*this.itemMargin-o;this.animator.moveToY(Math.max(u,o),undefined,!this.fullscreen);break;case 33:f=!0;this.fullscreen?this.animator.moveToY(Math.max(this.rightScroll.calculatePageMove(1)*this.rightScroll.step,o)):(u=t((this.rightScroll.value()-t((this.ctxHeight-this.timeScale.height())/this.itemMargin+.5)*this.itemMargin)/this.itemMargin)*this.itemMargin-o,this.animator.moveToY(Math.max(u,o)));break;case 34:f=!0;this.fullscreen?this.animator.moveToY(Math.min(this.rightScroll.calculatePageMove(-1)*this.rightScroll.step,this.rightScroll.maxValue()-o)):(u=t((this.rightScroll.value()+t((this.ctxHeight-this.timeScale.height())/this.itemMargin+.5)*this.itemMargin)/this.itemMargin)*this.itemMargin-o,this.animator.moveToY(Math.min(u,e-o)));break;case 36:f=!0;this.rightScroll.pageMove(1,"end");break;case 35:f=!0;this.fullscreen?this.rightScroll.pageMove(-1,"home"):this.animator.moveToY(e-o,undefined,!0);break;case 37:if(r=c-this.offsetX,r>0){if(lt===this.editMode)return;this.offWidgets();this.offMenus();this.painter.clearZones(!0);this.overlay.style.cursor="";r=Math.min(Math.abs(r),this.ctxWidth/this.timeScale.hourInPixels*wr);this.animator.addMovementX(-r)}break;case 39:if(r=h-this.offsetX,r<0){if(lt===this.editMode)return;this.offWidgets();this.offMenus();this.painter.clearZones(!0);this.overlay.style.cursor="";r=Math.min(Math.abs(r),this.ctxWidth/this.timeScale.hourInPixels*wr);this.animator.addMovementX(r)}}f&&(this.offMenus(),this.offWidgets(),this.clearPopUp=!0)}}},onkeyup:function(n){this.userEvents&&(this.readMode||n.ctrlKey||n.metaKey||this.applyEditLink())},onpaste:function(n){if(this.userEvents&&this.editBox.enable)this.editBox.onpaste(n)},oncopy:function(n){if(this.userEvents&&this.editBox.enable)this.editBox.oncopy(n)},drawScene:function(n){if(this.needUpdate&&(this.needUpdate=!1,this.ctx)){if(this.ctxWidth=this.ctx.canvas.width,this.ctxHeight=this.ctx.canvas.height,this.bounding=this.ctx.canvas.getBoundingClientRect(),this.fullscreen?(this.centerScreen=this.ctxWidth*.5,this.visibleLeft=0):(this.visibleLeft=this._leftPanelController.getPanel().getWidth(),this.centerScreen=(this.ctxWidth+this.visibleLeft)*.5),this.worldToScreen=this.timeScale.hourInPixels/this.timeScale.scaleX,this.offX=this.timeScale.hourInPixels*this.offsetX,this.needUpdateContent){this.contentHeight=this.getContentHeight();this.fullscreen||(this.contentHeight+=this.itemMargin);var t=this.ctxHeight-this.timeScale.height();this.rightScroll.init(this.timeScale.height(),t,this.contentHeight+!this.fullscreen*this.itemMargin,this.ctxWidth);this.rightScroll.clamp();this.visibleUp=!this.fullscreen*this.timeScale.height();this.needUpdateContent=!1;this._leftPanelController&&this._leftPanelController.scrollContent(this.rightScroll.value())}this.zoomBar&&this.bottomScroll.updateThumb(this.zoomBar.thumb,this.ctxWidth,this.ctxHeight);this.timeScale.refresh();this.ctx.clearRect(0,0,this.ctxWidth,this.ctxHeight);this.worldToScreen=this.timeScale.hourInPixels/this.timeScale.scaleX;this.offX=this.timeScale.hourInPixels*this.offsetX;this.scrollY=this.rightScroll.value()>>0;this.drawWeekend();this.timeScale.drawLines();this.timeScale.draw();this.drawElementHorLines();this.drawDayLine();this.drawWeekendLines();this.fullscreen&&(this.ctx.save(),this.ctx.rect(0,this.timeScale.height()+this.itemProjectMargin*2,this.ctxWidth,this.ctxHeight),this.ctx.clip());this.drawProjects();this.fullscreen&&this.ctx.restore();this.drawPopWidgets();undefined===n&&(this.rightScroll.refresh(),this.bottomScroll.refresh());this.ctx.canvas.width-this.ctxWidth>1&&(this.ctx.fillStyle="#ffffff",this.ctx.fillRect(this.ctxWidth,0,this.ctx.canvas.width-this.ctxWidth,this.ctxHeight));this.updateScrollContent();this._needDrawFlashBackground&&(this.ctx.fillStyle="rgba(255,255,255,0.7)",this.ctx.fillRect(0,0,this.ctxWidth,this.ctxHeight));this.printVersion&&(this.ctx.font="Bold 10pt "+b,this.ctx.fillStyle="#000000",this.ctx.fillText("v"+ie,this.ctxWidth-70,this.ctxHeight-15))}},drawProjects:function(){var n,s,h,i=t(this.timeScale.height()),u=t(this.rightScroll.value()),r,f,e,o;for(this.ctx.font=this.titlesFont,this._renderer.prepare(),this.editBox.boundUpdate=!1,this.projectsLines=[],r=this.storage.projects(),f=r.length,n=0;n<f;++n)if(e=r[n].t,o=e.length,this.projectsLines.push(i-u+this.itemMargin*.5),i+=this.itemMargin,!r[n].fullCollapse){if(s=this.offX+r[n].beginTime*this.worldToScreen,h=r[n].duration*this.worldToScreen,this.ctx.strokeStyle=oi,this.ctx.lineWidth=1,i+=(this.itemMargin-this.itemHeight)*.5,i=n===this.capProject?this.drawProject(r[n],i,this.capTask,u,n):this.drawProject(r[n],i,-1,u,n),i-u>this.ctxHeight)break;i-=(this.itemMargin-this.itemHeight)*.5;0===o&&(i+=this.itemMargin)}this.editBox.boundUpdate||this.editBox.setBound(0,0,0,0,!0)},drawProject:function(n,t,i,r,u){for(var e,h,s,c,l=!1,v=!1,o=n.m,a,y=o.length,f=0;f<y;++f)if(s=o[f].t.length,!o[f].filter){for(a=s,h=s-1;h>=0;--h)o[f].t[h].filter&&--a;if(this._renderer.drawBackLightMilestone(u,f,-1,t-r+3),this._renderer.drawMilestone(o[f],t,u,f,a),t-r>this.ctxHeight){v=!0;break}if(t+=this.itemMargin,t-r+s*this.itemMargin>0&&t-r<this.ctxHeight&&((this.fullscreen||o[f].collapse)&&!this.fullscreen||this._renderer.drawLinks(o[f].t,this.offX,t,r)),0===s&&this.fullscreen&&(t+=this.itemMargin),this.fullscreen||!o[f].collapse)for(e=0;e<s;++e)o[f].t[e].filter||(this._renderer.drawBackLightTask(u,f,e,t-r+3),this._renderer.drawTask(o[f].t[e],t,l,u,f,e,o[f].t),t+=this.itemMargin)}if(v)return t;if(c=n.t.length,c){if(f=-1,this.fullscreen&&(t+=this.itemHeight),l=!0,!this.fullscreen&&(t+=this.itemMargin,n.collapse))return t;for(t-r<this.ctxHeight&&((this.fullscreen||n.collapse)&&!this.fullscreen||this._renderer.drawLinks(n.t,this.offX,t,r)),e=0;e<c;++e)n.t[e].filter||(this._renderer.drawBackLightFreeTask(u,f,e,t-r+3),this._renderer.drawTask(n.t[e],t,l,u,f,e,n.t),t+=this.itemMargin)}return t},drawPopWidgets:function(){function f(n,i,r){var a,p;if(!n||0===n.length)return{lines:[],width:0};i||(i=n);var f=[],o=0,v=Math.max(t.ctx.measureText(n).width,t.ctx.measureText(i).width)/t.zoom;if(v>yt.width){for(var h,y=v>yt.maxWidth*2?yt.maxWidth:yt.width,s=[],u="",l=n.length,c=0,e=0;e<l;++e)"\n"===n[e]&&(s.push(n.slice(c,e)),s.push("\n"),++e,c=e)," "===n[e]&&c!==e&&(s.push(n.slice(c,e)),c=e),e==l-1&&c!==e&&s.push(n.slice(c,e+1));for(l=s.length,h=0;h<l;++h){if(a=u+s[h],p=t.ctx.measureText(a).width/t.zoom,t.ctx.measureText(s[h]).width/t.zoom>y){u=s[h].slice(0,25).replace(/^\s+/,"")+"...";f.push(u);o=Math.max(t.ctx.measureText(u).width/t.zoom,o);break}if(s[h]==="\n"){u=u.replace(/^\s+/,"");f.push(u);o=Math.max(t.ctx.measureText(u).width/t.zoom,o);u="";continue}if(p>y?(u=u.replace(/^\s+/,""),f.push(u),o=Math.max(t.ctx.measureText(u).width/t.zoom,o),u=s[h]):u=a,h==l-1&&(u=u.replace(/^\s+/,""),f.push(u),o=Math.max(t.ctx.measureText(u).width/t.zoom,o)),f.length>r-1&&-1!==r){f[f.length-1].length>2&&" "==f[f.length-1][f[f.length-1].length-2]&&(f[f.length-1]=f[f.length-1].slice(0,-2));f.push("...");break}}}else f.push(n),o=yt.width;return o+=t.taskTextIndent*2,{lines:f,width:o*t.zoom}}function e(){var c=ue==i.fill,w=yu==i.fill,k=t.visibleLeft+(t.visibleLeft>0?5:0),s,h,l,r,b,a,y,v,p;i.x=Math.max(k,i.x);var e=i.x+t.taskTextIndent*t.zoom,o=Math.max(i.t.stringsBlocks.width,i.t.descStrings.width),f=i.t.stringsBlocks.lines.length*t.fontPx;for(f+=i.t.descStrings.lines.length*t.fontPx,f+=t.fontPx*.5,s=i.t.subtasks(),c&&(f+=t.fontPx),i.t.performer&&i.t.performer.length&&(f+=t.fontPx*1.5),s&&(f+=t.fontPx*1.5),f+=t.fontPx*1.5,f+=t.fontPx*1.5,f+=t.fontPx*2.2,f/=t.zoom,h=i.t.formatBeginDate()+" - "+i.t.formatEndDate(),i.t.endTime>0&&!w&&(h+=" ("+n.Gantt.Localize_strings.statusOpenTask+")"),w&&(h+=" ("+n.Gantt.Localize_strings.statusClosedTask+")"),o=Math.max((t.ctx.measureText(h).width+t.taskTextIndent*2)*t.zoom,o),l="",c&&(l=n.Gantt.Localize_strings.taskOverdueText.format(i.t.daysPastDue()),o=Math.max((t.ctx.measureText(l).width+t.taskTextIndent*2)*t.zoom,o)),t.taskDescWidget.bound.x=Math.max(1,i.x),t.taskDescWidget.bound.y=i.y,t.taskDescWidget.bound.w=o,t.taskDescWidget.bound.h=f,t.ctx.fillStyle=yt.backgroundColor,t.ctx.fillRect(i.x,i.y,o,f*t.zoom),t.ctx.strokeStyle=i.fill,t.ctx.lineWidth=1,t.ctx.strokeRect(Math.floor(i.x)+.5,Math.floor(i.y)+.5,Math.floor(o),Math.floor(f*t.zoom+1)),t.ctx.fillStyle="#000000",t.ctx.strokeStyle="#000000",r=i.y+t.fontPx+1,u=0;u<i.t.stringsBlocks.lines.length;++u)t.ctx.fillText(i.t.stringsBlocks.lines[u],i.x+t.taskTextIndent*t.zoom,r),r+=t.fontPx;for(r+=t.fontPx*.5,t.ctx.fillStyle=c?i.fill:"#000000",t.ctx.fillText(h,e,r),c&&(r+=t.fontPx,t.ctx.fillText(l,e,r)),t.ctx.fillStyle=yt.titleColor,s&&(r+=t.fontPx*1.5,b=s==1?n.Gantt.Localize_strings.taskDescSubtask:n.Gantt.Localize_strings.taskDescSubtasks,t.ctx.fillText(s+" "+b,e,r)),r+=t.fontPx*1.5,a=i.t._responsibles.length,a>0?(y=i.t.performer,y=a>1?n.Gantt.Localize_strings.responsibles.format(a):n.Encoder.htmlDecode(i.t._responsibles[0].displayName),t.ctx.fillText(y,e,r)):t.ctx.fillText(n.Gantt.Localize_strings.noResponsible,e,r),r+=t.fontPx*1.5,u=0;u<i.t.descStrings.lines.length;++u)t.ctx.fillText(i.t.descStrings.lines[u],e,r),r+=t.fontPx;r+=t.fontPx*.5;v=n.Gantt.Localize_strings.details;t.ctx.fillText(v,e,r);t.ctx.beginPath();t.ctx.strokeStyle=yt.descriptionColor;t.ctx.lineWidth=Math.floor(t.zoom);t.ctx.moveTo(Math.floor(e)+.5,Math.floor(r+t.fontPx*.15)+.5);t.ctx.lineTo(Math.floor(e+t.ctx.measureText(v).width)+.5,Math.floor(r+t.fontPx*.15)+.5);t.ctx.stroke();p=14;t.taskDescWidget.detailsLinkBound.x=e;t.taskDescWidget.detailsLinkBound.y=r-p;t.taskDescWidget.detailsLinkBound.w=t.ctx.measureText(v).width;t.taskDescWidget.detailsLinkBound.h=p}function o(){var h=tf===r.fill,c=yr===r.fill,e=Math.max(r.t.descStrings.width,yt.width*t.zoom),o,f,i,s;for(r.x=Math.min(r.x,t.ctxWidth-5),o=r.x+t.taskTextIndent*t.zoom-e,f=r.t.descStrings.lines.length*t.fontPx,f+=t.fontPx*.5,r.t.t.length&&(f+=t.fontPx*1.25),r.t._responsibles&&(f+=t.fontPx*1.5),f+=t.fontPx*2,t.milestoneDescWidget.bound.x=r.x-e,t.milestoneDescWidget.bound.y=r.y,t.milestoneDescWidget.bound.w=e,t.milestoneDescWidget.bound.h=f,t.ctx.fillStyle=yt.backgroundColor,t.ctx.fillRect(r.x,r.y,-e,f),t.ctx.strokeStyle=r.fill,t.ctx.lineWidth=1,t.ctx.strokeRect(Math.floor(r.x)+.5,Math.floor(r.y)+.5,-Math.floor(e),Math.floor(f+1)),i=r.y+t.fontPx*1.25,s=r.t.formatEndDate(),r.t.endTime>0&&!c&&(s+=" ("+n.Gantt.Localize_strings.statusOpenMilestone+")"),c&&(s+=" ("+n.Gantt.Localize_strings.statusClosedMilestone+")"),t.ctx.fillStyle=h?r.fill:"#000000",h&&(s+=" ("+n.Gantt.Localize_strings.overdue+")"),t.ctx.fillText(s,o,i),r.t.t.length&&(i+=t.fontPx*1.25,t.ctx.fillStyle=t.windowsWidgetColorText,t.ctx.fillText(r.t.t.length+" "+n.Gantt.Localize_strings.tasks,o,i)),t.ctx.fillStyle=t.windowsWidgetColorText,r.t._responsibles&&(i+=t.fontPx*1.5,t.ctx.fillText(n.Encoder.htmlDecode(r.t._responsibles.displayName),o,i)),i+=t.fontPx*1.5,u=0;u<r.t.descStrings.lines.length;++u)t.ctx.fillText(r.t.descStrings.lines[u],o,i),i+=t.fontPx;i+=t.fontPx*.5}var t=this,u=0,i=this.taskDescWidget.ref,r;i&&(null==i.t.stringsBlocks&&(i.t.stringsBlocks=f(i.t._title,i.t._description,ts)),null==i.t.descStrings&&(i.t.descStrings=f(i.t._description,i.t._title,ts)),e());r=this.milestoneDescWidget.ref;r&&(null==r.t.descStrings&&(r.t.descStrings=f(r.t._description,-1)),o())},drawDayLine:function(){if(fi===this.timeScale.scaleType){var n=t(this.timeToSceneX(0))+.5;this.painter.drawLineH(n,0,n,this.ctxHeight,hh,1)}},drawElementHorLines:function(){var n,f,e,h,i,r;if(!this.fullscreen){var s=this.rightScroll.value()%this.itemMargin,u=this.timeScale.height()-s,o=this.contentHeight-this.rightScroll.value();if(o<u){this.ctx.beginPath();this.ctx.strokeStyle=oi;this.ctx.lineWidth=1;this.ctx.moveTo(0,this.itemMargin+.5);this.ctx.lineTo(this.ctxWidth,this.itemMargin+.5);this.ctx.moveTo(0,this.itemMargin*2+.5);this.ctx.lineTo(this.ctxWidth,this.itemMargin*2+.5);this.ctx.stroke();return}for(this.projectsLines.length!==this.storage.p.length&&(this.needUpdate=!0),n=0,f=0,this.projectsLinesY=[],this.ctx.beginPath(),this.ctx.strokeStyle=oi,this.ctx.lineWidth=1;u<=this.ctxHeight;u+=this.itemMargin){if(n=t(u)+.5,n<this.visibleUp){f=n;continue}for(this.ctx.moveTo(.5,n),this.ctx.lineTo(this.ctxWidth+.5,n),e=this.projectsLines.length-1;e>=0;--e)if(this.projectsLines[e]>f&&this.projectsLines[e]<n){this.projectsLinesY.push(f);break}if(f=n,o<u)break}if(this.ctx.stroke(),this.ctx.beginPath(),this.ctx.strokeStyle=oi,this.ctx.lineWidth=1,this.ctx.moveTo(0,this.itemMargin+.5),this.ctx.lineTo(this.ctxWidth,this.itemMargin+.5),this.ctx.moveTo(0,this.itemMargin*2+.5),this.ctx.lineTo(this.ctxWidth,this.itemMargin*2+.5),this.ctx.stroke(),af!==this.timeScale.scaleType)for(h=this.itemMargin,this.ctx.fillStyle="#ffffff",i=this.itemMargin,r=this.projectsLinesY.length-1;r>=0;--r)n=this.projectsLinesY[r]+1,this.projectsLinesY[r]>i*2?this.ctx.fillRect(0,n,this.ctxWidth,i-2):this.projectsLinesY[r]>=i&&this.ctx.fillRect(0,i*2+1,this.ctxWidth,n-i-2)}},drawWeekend:function(){var n=this.timeScale.weekend(),i,r;if(n){if(i=-1,r=this.timeScale.hourInPixels*this.offsetX,1===this.timeScale.divisionInDays&&fi!==this.timeScale.scaleType){var u=this.itemMargin,f=this.ctxHeight-u,e=this.ctxWidth/n.off+2,o=(r/n.off-(r/n.off>>0))*n.off+n.x;for(this.ctx.fillStyle=lh,i=-1;i<e;++i)this.ctx.fillRect(o+i*n.off,u,n.width,f)}r=t(this.timeToSceneX(0))+.5;this.ctx.fillStyle=ch;this.ctx.fillRect(r,this.itemMargin,n.width/2,this.ctxHeight-this.itemMargin)}},drawWeekendLines:function(){var n=this.timeScale.weekend(),i,h,u,f,s,e;if(n&&(i=-1,h=this.timeScale.hourInPixels*this.offsetX,1===this.timeScale.divisionInDays&&fi!==this.timeScale.scaleType)){var l=this.itemMargin,o=this.ctxHeight,c=this.ctxWidth/n.off+2,r=(h/n.off-(h/n.off>>0))*n.off+n.x;for(this.ctx.lineWidth=1,this.ctx.strokeStyle=oi,this.ctx.beginPath(),i=-1;i<c;++i)this.ctx.moveTo(t(r+i*n.off)+.5,t(this.itemMargin)),this.ctx.lineTo(t(r+i*n.off)+.5,t(o)),this.ctx.moveTo(t(r+i*n.off+n.width)+.5,t(this.itemMargin)+.5),this.ctx.lineTo(t(r+i*n.off+n.width)+.5,t(o)+.5);for(this.ctx.stroke(),this.ctx.lineWidth=1,this.ctx.strokeStyle=oi,this.ctx.beginPath(),i=-1;i<c;++i)for(u=3;u<7;++u)u!==5&&(this.ctx.moveTo(t(r+i*n.off+n.width*.5*u)+.5,t(this.itemMargin)),this.ctx.lineTo(t(r+i*n.off+n.width*.5*u)+.5,t(o)),this.ctx.moveTo(t(r+i*n.off+n.width+n.width*.5*u)+.5,t(this.itemMargin)+.5),this.ctx.lineTo(t(r+i*n.off+n.width+n.width*.5*u)+.5,t(o)+.5));for(this.ctx.stroke(),this.ctx.fillStyle="#ffffff",f=this.itemMargin,s=0,e=this.projectsLinesY.length-1;e>=0;--e)s=this.projectsLinesY[e]+1,this.projectsLinesY[e]>f*2?this.ctx.fillRect(0,s,this.ctxWidth,f-2):this.projectsLinesY[e]>=f&&this.ctx.fillRect(0,f*2+1,this.ctxWidth,s-f-2)}},drawEditLayer:function(){if(this.clearPopUp){if(this.mouse)this.onmousemove(this.mouse.baseEvent,!0);this.clearPopUp=!1}if(this.editBox.enable){this.painter.clearZones(!0);this.editBox.draw();this.painter.addBoundZone(this.editBox.bound,10*this.zoom);return}et===this.editMode?this.drawLinkEditLines():lt===this.editMode?this.drawDragElement():this.drawPopUpMenu()},drawDragElement:function(){function i(){if(n.dragBound.failEnd){n.overlayctx.fillStyle=ce;n.overlayctx.strokeStyle=n.dragTo.p===n.itemToDrop.p?le:ae;n.overlayctx.lineWidth=1;n.dragBound.x+n.dragBound.dx<=n.visibleLeft&&(n.dragBound.width=n.dragBound.width+n.dragBound.x+n.dragBound.dx-n.visibleLeft,n.dragBound.x=n.visibleLeft,n.dragBound.dx=0);var i=t(n.dragBound.x+n.dragBound.dx)+.5,r=t(n.dragBound.y+n.dragBound.dy)+.5;n.overlayctx.beginPath();n.overlayctx.moveTo(i,r);n.overlayctx.lineTo(i+n.dragBound.width,r);n.overlayctx.lineTo(i+n.dragBound.width,r+n.dragBound.height*.5);n.overlayctx.lineTo(i+n.dragBound.width,r+n.dragBound.height);n.overlayctx.lineTo(i,r+n.dragBound.height);n.overlayctx.closePath();n.overlayctx.fill();n.overlayctx.stroke();n.overlayctx.drawImage(n._renderer.infinity,i+n.dragBound.width+4,r+2)}else n.dragBound.x+n.dragBound.dx<=n.visibleLeft&&(n.dragBound.width=n.dragBound.width+n.dragBound.x+n.dragBound.dx-n.visibleLeft,n.dragBound.x=n.visibleLeft,n.dragBound.dx=0),n.overlayctx.fillStyle=ce,n.overlayctx.fillRect(n.dragBound.x+n.dragBound.dx,n.dragBound.y+n.dragBound.dy,n.dragBound.width,n.dragBound.height),n.overlayctx.strokeStyle=n.dragTo.p===n.itemToDrop.p?le:ae,n.overlayctx.lineWidth=1,n.overlayctx.strokeRect(t(n.dragBound.x+n.dragBound.dx)+.5,t(n.dragBound.y+n.dragBound.dy)+.5,t(n.dragBound.width),t(n.dragBound.height));n.painter.addZone(n.dragBound.x+n.dragBound.dx,n.dragBound.y+n.dragBound.dy,n.dragBound.width,n.dragBound.height,20)}function r(){var t,u;if(!n.animator.isScroll()){var y,v,o,l,i=n.itemMargin,f=Math.floor(n.timeScale.height()),a=Math.floor(n.visibleLeft),p=Math.floor(n.timeScale.height()+n.itemProjectMargin*2),r=n.storage.projects(),w=r.length;for(t=0;t<w;++t){if(r[t].fullCollapse){f+=i;continue}if(r[t].isEmpty())f+=i*2;else{for(f+=i,y=r[t].m.length,u=0;u<y;++u)if(!r[t].m[u].filter){for(v=r[t].m[u].t.length,o=v,l=v-1;l>=0;--l)r[t].m[u].t[l].filter&&--o;if(t===n.dragTo.p&&u===n.dragTo.m){if(1===r[t].m[u]._status)return;if(n.dragTo.p!==n.itemToDrop.p)return;var e=n.offX+r[t].m[u].beginTime*n.worldToScreen,h=r[t].m[u].duration*n.worldToScreen,c=Math.floor(f-n.scrollY+n.itemHeight-n.milestoneLinewidth*n.zoom),s=r[t].m[u].t.length!==0?(o+.5)*i:.5*i;r[t].m[u].collapse?s=i*.5:(s=o!==0?(o+.5)*i:.5*i,s=o!==0?(o+.5)*i:.5*i);n.backLightMilestone.enable||(n.overlayctx.fillStyle=he,n.overlayctx.fillRect(e,c+n.itemHeight,h,s));e<a&&(h-=a-e,e=a);e+h>a&&(n.overlayctx.strokeStyle=oh,n.overlayctx.lineWidth=1,n.overlayctx.beginPath(),n.overlayctx.moveTo(Math.floor(e)+.5,Math.max(p,c-n.milestoneLinewidth*n.zoom+.5)),n.overlayctx.lineTo(Math.floor(e)+.5,c+Math.floor(s)+.5),n.overlayctx.lineTo(Math.floor(e+h)+.5,c+Math.floor(s)+.5),n.overlayctx.lineTo(Math.floor(e+h)+.5,Math.max(p,c-n.milestoneLinewidth*n.zoom+.5)),n.overlayctx.stroke(),n.painter.addZone(e,c,h,s,i));return}f+=i;r[t].m[u].collapse||(f+=i*o)}if(r[t].collapse){f+=i;continue}if(r[t].t.length)for(f+=i,u=r[t].t.length-1;u>=0;--u)r[t].t[u].filter||(f+=i);else f+=i;if(f-n.scrollY>n.ctxHeight)return}}}}var n=this;this.updateDragDrop&&(this.painter.clearZones(!0),r(),i(),this.updateDragDrop=!1)},drawPopUpMenu:function(){if(this.painter.clearZones(!0),!this.readMode){if(-1!==this.hitTask&&0===this.hitSide&&this.menuTask.setBound(Math.floor(this.menuTask.offx-f.elementsWidth5X*.5*this.zoom),Math.floor(this.menuTask.offy)-(f.icoSize+f.borderSz*2+5)*this.zoom,f.elementsWidth5X*this.zoom,(f.icoSize+f.borderSz*2+5)*this.zoom),-1!==this.menuMileStone.m&&-1!==this.menuMileStone.p){var n=this.menuMileStone.ref._status==r-1?f.elementsWidth3X:f.elementsWidth6X;this.menuMileStone.setBound(t(this.menuMileStone.offx-n*.5*this.zoom),t(this.menuMileStone.offy)-(f.icoSize+f.borderSz*3+this.milestoneMenuOffY*2)*this.zoom,n*this.zoom,(f.icoSize+f.borderSz*2+this.milestoneMenuOffY*2)*this.zoom)}if(this.linkWidget.isValid()){this.linkWidget.render();return}this.painter.clearZones(!0);this.menuTask.draw()&&this.painter.addZone(this.menuTask.bound.x,this.menuTask.bound.y,this.menuTask.bound.w,this.menuTask.bound.h,10*this.zoom);this.menuMileStone.draw()&&this.painter.addZone(this.menuMileStone.bound.x,this.menuMileStone.bound.y,this.menuMileStone.bound.w,this.menuMileStone.bound.h,10*this.zoom)}},drawLinkEditLines:function(){if(this.linkLineEdit&&this.linkLineEdit.update){if(this.painter.clearZones(!0),!this.pushLink){var i,u,l,a,h=this.itemHeight*.5,r=this.itemHeight,f=this.moveMouse.x,e=this.moveMouse.y,o=this.linkLineEdit.posX,n=this.linkLineEdit.posY+1;this.overlayctx.lineWidth=2;this.overlayctx.strokeStyle="#24547E";s===this.linkLineEdit.side&&(f<o?(this.painter.drawDashedLineH(this.overlayctx,t(f-.5),t(n),t(o+.5),t(n),[6,2]),this.painter.drawDashedLineV(this.overlayctx,t(f),t(Math.min(n,e)-.5),t(f),t(Math.max(n,e)+.5),[6,2])):e<this.linkLineEdit.posY?(i=t(o-h-.5),u=t(f+.5),i<u&&(this.painter.drawDashedLineH(this.overlayctx,i,t(n-r),u,t(n-r),[6,2]),this.painter.drawDashedLineH(this.overlayctx,i,t(n),t(i+h),t(n),[6,2]),this.painter.drawDashedLineV(this.overlayctx,i,t(n-r),i,t(n),[6,2])),l=t(Math.min(n,e)),a=t(Math.max(n-r,e-r)),l<a&&this.painter.drawDashedLineV(this.overlayctx,t(f),l,t(f),a,[6,2])):(i=t(o-h),u=t(f),i<u&&(this.painter.drawDashedLineH(this.overlayctx,i,t(n+r),u,t(n+r),[6,2]),this.painter.drawDashedLineH(this.overlayctx,i,t(n),t(i+h),t(n),[6,2]),this.painter.drawDashedLineV(this.overlayctx,i,t(n),i,t(n+r),[6,2])),l=t(Math.min(n+r,e+r)),a=t(Math.max(n+r,e+r)),l<a&&this.painter.drawDashedLineV(this.overlayctx,t(f),l,t(f),a,[6,2])));c===this.linkLineEdit.side&&(f>o?(this.painter.drawDashedLineH(this.overlayctx,t(o-.5),t(n),t(f+.5),t(n),[6,2]),this.painter.drawDashedLineV(this.overlayctx,t(f),t(Math.min(n,e)-.5),t(f),t(Math.max(n,e)+.5),[6,2])):e<this.linkLineEdit.posY?(i=t(f-.5),u=t(o+h+.5),i<u&&(this.painter.drawDashedLineV(this.overlayctx,i,Math.min(t(e),t(n-r)),i,Math.max(t(e),t(n-r)),[6,2]),this.painter.drawDashedLineH(this.overlayctx,i,t(n-r),u,t(n-r),[6,2]),this.painter.drawDashedLineH(this.overlayctx,t(u-h),t(n),u,t(n),[6,2]),this.painter.drawDashedLineV(this.overlayctx,u,t(n-r),u,t(n),[6,2]))):(i=t(f-.5),u=t(o+h+.5),i<u&&(this.painter.drawDashedLineV(this.overlayctx,i,Math.min(t(e),t(n+r)),i,Math.max(t(e),t(n+r)),[6,2]),this.painter.drawDashedLineH(this.overlayctx,i,t(n+r),u,t(n+r),[6,2]),this.painter.drawDashedLineH(this.overlayctx,t(u-h),t(n),u,t(n),[6,2]),this.painter.drawDashedLineV(this.overlayctx,u,t(n),u,t(n+r),[6,2]))));this.painter.addZone(Math.min(o,f),Math.min(n,e),Math.max(o,f)-Math.min(o,f),Math.max(n,e)-Math.min(n,e),30)}this.linkLineEdit.update=!1}},calculateHit:function(n,i,u){var at,e,ct,rt;this.clickPosCentreing=null;this.downMouse=this.windowToCanvas(n.clientX,n.clientY);this.moveMouse={x:this.downMouse.x,y:this.downMouse.y};at=this.timeScale.hourInPixels/this.timeScale.scaleX;this.downMouse.x-=this.timeScale.hourInPixels*this.offsetX;var h=this.timeScale.height()-this.rightScroll.value()+this.itemHeight*.5,b=this.timeScale.scaleUnitStep(),ti=this.timeScale.hourInPixels*this.offsetX,vt=t(this.rightScroll.value());this.hitProject=-1;this.hitMilestone=-1;this.hitTask=-1;this.hitSide=0;this.hitLink=undefined;this.capLink=undefined;this.milestoneChange=undefined;for(var y=0,nt=0,o=this.itemMargin,ut=this.worldToSceneX(this.moveMouse.x),oi=this.downMouse.y-this.itemHeight,ii=this.itemMargin*.5,wt=0,bt=0,v=0,d=0,pt=this.ctxWidth*k.bigClampPct,si=this.sceneXToTime(gs),ri=this.sceneXToTime(rr),g,a,tt,it,yt,lt,ot,st=0,w=!1,l=this.storage.projects(),fi=l.length,f=0;f<fi;++f){if(e=l[f].t,w=l[f]._status,l[f].fullCollapse){h+=o;continue}if(l[f].isEmpty())h+=o*2;else{for(h+=o,a=0;a<l[f].m.length;++a)if(!l[f].m[a].filter){if(ct=l[f].m[a],it=l[f].m[a].t.length,!this.fullscreen&&ct.collapse){h+=o;continue}for(lt=it,ot=it-1;ot>=0;--ot)ct.t[ot].filter&&--lt;wt=h+vt;bt=this.downMouse.y+vt-this.timeScale.height()+ii;var dt=h,ei=h+o*.25,gt=h+lt*o+this.itemHeight*1.5,ui=dt-this.itemHeight*.3-2+o*.5-o*.3;for(this.fullscreen&&(gt+=this.itemHeight,0===it&&(gt+=o)),yt=h+(o-this.itemHeight)*.5+this.itemHeight*.5,h+=o,h+=o*lt,y=yt+o-this.itemHeight,nt=yt+o,tt=0;tt<it;++tt)if(e=ct.t[tt],!e.filter){if(this.downMouse.y>=y&&this.downMouse.y<=nt&&(this.moveMouse.x>this.visibleLeft&&this.moveMouse.x<this.visibleLeft+16||this.moveMouse.x>this.ctxWidth-32&&this.moveMouse.x<this.ctxWidth-16)){if(v=this.timeToSceneX(e.beginTime),d=this.timeToSceneX(e.endTime),v<this.visibleLeft||v<this.visibleLeft&&d>this.visibleLeft){i&&(this.overlay.style.cursor="pointer");this.clickPosCentreing={p:f,m:a,t:tt};this.offMenus();return}if(v>this.ctxWidth&&this.moveMouse.x>this.ctxWidth-32&&this.moveMouse.x<this.ctxWidth-16){i&&(this.overlay.style.cursor="pointer");this.clickPosCentreing={p:f,m:a,t:tt};this.offMenus();return}}if(st=ri,e._status===r&&(st=0),ut>=e.beginTime-st&&ut<=e.endTime+st&&this.downMouse.y>=y&&this.downMouse.y<=nt){this.hitTask=tt;this.hitMilestone=a;this.hitProject=f;this.hitSide=0;this.backLightMilestone.up(-1,-1);this.anchorMouse.x=e.beginTime-this.downMouse.x/(this.timeScale.hourInPixels*b)*b*this.timeScale.scaleX;this.anchorMouse.y=y-this.downMouse.y;i&&(this.overlay.style.cursor="pointer");this.menuTask.offx=this.moveMouse.x;this.menuTask.offy=y;(this.readMode||p!==w)&&this.menuTask.reset();e._status!==r&&(ft>ht(this.downMouse.x-e.beginTime*at)&&(i&&!this.readMode&&p===w&&(this.storage.getTask(f,a,tt)._status==r||u||(this.overlay.style.cursor="w-resize")),this.hitSide=s),ft>ht(this.downMouse.x-e.endTime*at)&&(i&&!this.readMode&&p===w&&(this.storage.getTask(f,a,tt)._status==r||u||(this.overlay.style.cursor="w-resize")),this.hitSide=c,this.anchorMouse.x=e.endTime-this.downMouse.x/(this.timeScale.hourInPixels*b)*b*this.timeScale.scaleX),this.editMode!==et&&(v=this.timeToSceneX(e.beginTime),d=this.timeToSceneX(e.endTime),v-this.moveMouse.x>2&&v-this.moveMouse.x<rr?(this._mouseInLinkZone||(this._mouseInLinkZone={side:s},this.needUpdate=!0),this.hitSide=kt,i&&(this.overlay.style.cursor="pointer"),this.offMenus()):this.moveMouse.x-d>2&&this.moveMouse.x-d<rr&&!e.endFail?(this._mouseInLinkZone||(this._mouseInLinkZone={side:c},this.needUpdate=!0),this.hitSide=kt,i&&(this.overlay.style.cursor="pointer"),this.offMenus()):this._mouseInLinkZone&&(this._mouseInLinkZone=null,this.needUpdate=!0)));return}y+=o;nt+=o}if(Math.abs(this.downMouse.x-ct.endTime*at)<ft&&this.downMouse.y>=ei&&gt>=this.downMouse.y){if(l[f].m[a]._status==r-1)return;if(this.editBox.enable&&this.editBox.taskRef)return;i&&!this.readMode&&p===w&&(this.overlay.style.cursor="w-resize");this.milestoneChange=!0;this.hitMilestone=a;this.hitProject=f;this.anchorMouse.x=ct.endTime-this.downMouse.x/(this.timeScale.hourInPixels*b)*b*this.timeScale.scaleX;this.menuTask.offx=this.moveMouse.x;this.menuTask.offy=dt;this.menuMileStone.hide=!0;this.menuMileStone.reset();this.backLightMilestone.up(f,a);(this.readMode||p!==w)&&this.menuTask.reset();return}if(ni===this.editMode&&ut>=ct.beginTime&&ut<=ct.endTime&&this.downMouse.y>=ui&&this.downMouse.y<=ui+o*.5){this.backLightMilestone.up(f,a);this.menuMileStone.set(f,a,this.storage.getMilestone(f,a));this.menuMileStone.offx=this.moveMouse.x;this.menuMileStone.offy=dt+this.itemHeight-(this.milestoneLinewidth+this.menuArrowSize)*this.zoom;this.menuMileStone.hide=!1;this.menuMileStone.disable=w;return}if(!w&&this.calculateLinksHit(l[f].m[a].t,ti,wt,vt,1,ut,bt,0)){i&&(this.overlay.style.cursor="pointer");return}0===it&&this.fullscreen&&(h+=o)}if(l[f].collapse){h+=o;continue}if(l[f].t.length){if(this.fullscreen&&(h+=this.itemHeight),this.fullscreen||(h+=o),!this.fullscreen&&l[f].collapse)continue;for(wt=h+vt,bt=this.downMouse.y+vt-this.timeScale.height()+o+ii,it=l[f].t.length,lt=it,ot=it-1;ot>=0;--ot)l[f].t[ot].filter&&--lt;for(yt=h+o*.5-this.itemHeight,y=yt,nt=yt+this.itemHeight,g=0;g<l[f].t.length;++g)if(e=l[f].t[g],!e.filter){if(rt=e.endTime,e.endFail&&(rt+=1e7),e.endFail){if(v=this.timeToSceneX(e.beginTime),pt=this.ctxWidth-k.smallClampPx,v<=this.visibleLeft-1&&(pt=this.ctxWidth*k.bigClampPct),this.moveMouse.x-pt>ft+32){i&&(this.overlay.style.cursor="");y+=o;nt+=o;continue}rt=this.worldToSceneX(pt)}if(this.downMouse.y>=y&&this.downMouse.y<=nt&&(this.moveMouse.x>this.visibleLeft&&this.moveMouse.x<this.visibleLeft+16||this.moveMouse.x>this.ctxWidth-32&&this.moveMouse.x<this.ctxWidth-16)){if(v=this.timeToSceneX(e.beginTime),d=this.timeToSceneX(rt),v<this.visibleLeft||v<this.visibleLeft&&d>this.visibleLeft){i&&(this.overlay.style.cursor="pointer");this.clickPosCentreing={p:f,m:undefined,t:g};this.offMenus();return}if(v>this.ctxWidth&&this.moveMouse.x>this.ctxWidth-32&&this.moveMouse.x<this.ctxWidth-16){i&&(this.overlay.style.cursor="pointer");this.clickPosCentreing={p:f,m:undefined,t:g};this.offMenus();return}}if(st=ri,e._status===r&&(st=0),ut>=e.beginTime-st&&ut<=rt+st&&this.downMouse.y>=y&&this.downMouse.y<=nt){this.hitTask=g;this.hitMilestone=-1;this.hitProject=f;this.hitSide=0;this.backLightMilestone.up(-1,-1);this.anchorMouse.x=e.beginTime-this.downMouse.x/(this.timeScale.hourInPixels*b)*b*this.timeScale.scaleX;this.anchorMouse.y=y-this.downMouse.y;this.overlay.style.cursor="pointer";this.menuTask.offx=this.moveMouse.x;this.menuTask.offy=y;(this.readMode||p!==w)&&this.menuTask.reset();e._status!==r&&(ht(this.downMouse.x-e.beginTime*at)<ft&&(i&&!this.readMode&&p===w&&(this.storage.getTask(f,undefined,g)._status==r||u||(this.overlay.style.cursor="w-resize")),this.hitSide=s),e.endFail?ht(this.moveMouse.x-pt)<ft&&(i&&!this.readMode&&p===w&&(this.storage.getTask(f,undefined,g)._status==r||u||(this.overlay.style.cursor="w-resize")),this.hitSide=c,this.anchorMouse.x=rt-this.downMouse.x/(this.timeScale.hourInPixels*b)*b*this.timeScale.scaleX):ht(this.downMouse.x-rt*at)<ft&&(i&&!this.readMode&&p===w&&(this.storage.getTask(f,undefined,g)._status==r||u||(this.overlay.style.cursor="w-resize")),this.hitSide=c,this.anchorMouse.x=rt-this.downMouse.x/(this.timeScale.hourInPixels*b)*b*this.timeScale.scaleX),this.editMode!==et&&(v=this.timeToSceneX(e.beginTime),d=this.timeToSceneX(rt),v-this.moveMouse.x>2&&v-this.moveMouse.x<rr?(this._mouseInLinkZone||(this._mouseInLinkZone={side:s},this.needUpdate=!0),this.hitSide=kt,i&&(this.overlay.style.cursor="pointer"),this.offMenus()):this.moveMouse.x-d>2&&this.moveMouse.x-d<rr&&!e.endFail?(this._mouseInLinkZone||(this._mouseInLinkZone={side:c},this.needUpdate=!0),this.hitSide=kt,i&&(this.overlay.style.cursor="pointer"),this.offMenus()):this._mouseInLinkZone&&(this._mouseInLinkZone=null,this.needUpdate=!0)));return}y+=o;nt+=o}if(!w&&this.calculateLinksHit(l[f].t,ti,wt,vt,1,ut,bt,o)){i&&(this.overlay.style.cursor="pointer");return}h+=o*lt}else h+=o}}this.backLightMilestone.up(-1,-1);this.editMode!==et&&(this._mouseInLinkZone=null);i&&(this.overlay.style.cursor="");this.readMode&&(this.menuTask.reset(),this.menuMileStone.reset())},calculateLineHit:function(n,t,i){var s,r,h;this.downMouse=undefined!=n?this.windowToCanvas(n.clientX,n.clientY):{x:t,y:i};this.moveMouse={x:this.downMouse.x,y:this.downMouse.y};this.downMouse.x-=this.timeScale.hourInPixels*this.offsetX;var o=this.itemMargin,u=-this.rightScroll.value(),f=this.downMouse.y-o*2,e=this.storage.projects(),c=e.length;for(r=0;r<c;++r){if(u<=f&&f<=u+o)return this.hitLine={p:r,m:e[r].m.length?0:-1,t:-1},!0;if(e[r].fullCollapse){u+=o;continue}if(e[r].isEmpty()){if(u<=f&&f<=u+o*2)return this.hitLine={p:r,m:-1,t:-1},!0;u+=this.itemMargin*2}else{for(u+=this.itemMargin,h=0;h<e[r].m.length;++h)if(!e[r].m[h].filter){if(u<=f&&f<=u+o)return this.hitLine={p:r,m:h,t:-1},!0;if(u+=this.itemMargin,!e[r].m[h].collapse)for(s=0;s<e[r].m[h].t.length;++s)if(!e[r].m[h].t[s].filter){if(u<=f&&f<=u+o)return this.hitLine={p:r,m:h,t:s-1},!0;u+=o}}if(e[r].collapse){if(u<=f&&f<=u+o)return this.hitLine={p:r,m:-1,t:-1},!0;u+=o;continue}if(e[r].t.length){if(u<=f&&f<=u+o)return this.hitLine={p:r,m:-1,t:-1},!0;for(u+=this.itemMargin,s=0;s<e[r].t.length;++s)if(!e[r].t[s].filter){if(u<=f&&f<=u+o)return this.hitLine={p:r,m:-1,t:s-1},!0;u+=o}}else{if(u<=f&&f<=u+o)return this.hitLine={p:r,m:-1,t:-1},!0;u+=this.itemMargin}}}return u<f&&c>0?(this.hitLine=e.last().t.length?{p:r-1,m:-1,t:e.last().t.length-1,bottomMilestoneInd:e[r-1].m.length?-1:0}:{p:r-1,m:-1,t:-1},!0):!1},calculateHitMilestone:function(n,t){this.downMouse={x:n,y:t};this.moveMouse={x:this.downMouse.x,y:this.downMouse.y};this.downMouse.x-=this.timeScale.hourInPixels*this.offsetX;for(var r=this.timeScale.height()-this.rightScroll.value()+this.itemHeight*.5,h=this.downMouse.y-this.itemMargin,o,e,u=this.itemMargin,f=this.storage.projects(),s=f.length,i=0;i<s;++i){if(f[i].fullCollapse){r+=u;continue}if(f[i].isEmpty())r+=u*2;else{for(r+=u,e=0;e<f[i].m.length;++e)if(0===f[i].m[e].t.length&&(r+=u),this.fullscreen?r+=u+f[i].m[e].t.length*u:f[i].m[e].collapse||(r+=u+f[i].m[e].t.length*u),r>=t)return{p:i,m:e+1};if(f[i].collapse){r+=u;continue}if(f[i].t.length){for(r+=u,o=f[i].t.length-1;o>=0;--o)f[i].t[o].filter||(r+=u);if(r>=t)return{p:i,m:undefined}}else r+=u}}return{p:undefined,m:undefined}},calculateTaskHit:function(){return-1!==this.hitProject&&-1===this.hitMilestone&&this.hitTask!==-1?this.storage.getTask(this.hitProject,undefined,this.hitTask):-1!==this.hitProject&&-1!==this.hitMilestone&&this.hitTask!==-1?this.storage.getTask(this.hitProject,this.hitMilestone,this.hitTask):null},calculateLinksHit:function(n,t,i,r,u,f,e,o){var g,et,s,a;if(this.exist=!1,this.linkDir=0,this.readMode)return this.exist;if(!n.length)return!1;var p,l,c,v,b,k,ut,d,ft=0,rt=0,nt=this.itemMargin,tt=this.itemHeight*.5,h=this.sceneXToTime(y),ot=this.sceneXToTime(this.itemHeight);for(i-=this.timeScale.marginY,g=0;g<n.length;++g)for(b=n[g],b.filter&&ft++,et=0;et<b.links.length;++et)if(s=b.links[et],k=s.parentTaskId||s.parentTaskId,n[g]._id!==k)for(ut=s.linkType||s.linkType,d=s.dependenceTaskId||s.dependenceTaskId,rt=0,a=0;a<n.length;++a)if((n[a].filter&&rt++,!n[a].filter||!n[g].filter)&&n[a]._id===k)if(it===ut)if(c=n[a].beginTime+n[a].duration,v=n[g].beginTime,p=i+nt*(a-rt),l=i+nt*(g-ft),p<l)if(c<v){if(w(f,e,c+h,p,c+h,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(c+h*2),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.beginTime-n[a].endTime)/24),!0),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,c+h,l,v,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:l-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.beginTime-n[a].endTime)/24),!0),this.linkWidget.setLink(s),this.hitLink=s,!0}}else{if(w(f,e,c+h,p,c+h,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(c+h),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.beginTime-n[a].endTime)/24),!0),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,v,l-tt*2,c,l-tt*2,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:l-tt*2-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.beginTime-n[a].endTime)/24),!0),this.linkWidget.setLink(s),this.hitLink=s,!0}}else if(c<v){if(w(f,e,c+h,l,c+h,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(c+h/2),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.beginTime-n[a].endTime)/24),!0),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,c+h,l,v,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:l-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.beginTime-n[a].endTime)/24),!0),this.linkWidget.setLink(s),this.hitLink=s,!0}}else{if(w(f,e,v-h,l,v-h,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(v),y:this.moveMouse.y,w:100,h:100},0,Math.floor((b.beginTime-n[a].endTime)/24),!0),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,v-h,p-tt*2,c+h,p-tt*2,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:p-tt*2-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.beginTime-n[a].endTime)/24),!0),this.linkWidget.setLink(s),this.hitLink=s,!0}}else if(wt===ut)if(c=n[a].beginTime,v=n[g].beginTime,p=i+nt*(a-rt),l=i+nt*(g-ft),p<l)if(c<v){if(w(f,e,c-h,p,c-h,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(c),y:this.moveMouse.y,w:100,h:100},0,Math.floor((b.beginTime-n[a].beginTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,c-h,l,v,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:l-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.beginTime-n[a].beginTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}}else{if(w(f,e,v-h,p,c,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:p-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.beginTime-n[a].beginTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,v-h,p,v-h,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(v),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.beginTime-n[a].beginTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}}else if(c<v){if(w(f,e,c-h,l,c-h,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(c-h),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.beginTime-n[a].beginTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,c-h,l,v,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:l-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.beginTime-n[a].beginTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}}else{if(w(f,e,v-h,l,v-h,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(v),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.beginTime-n[a].beginTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,v+h,p,c,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:p-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.beginTime-n[a].beginTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}}else if(bt===ut)if(c=n[a].beginTime+n[a].duration,v=n[g].beginTime+n[g].duration,p=i+nt*(a-rt),l=i+nt*(g-ft),p<l)if(c<v){if(w(f,e,c+h,p,v+h,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:p-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.endTime-n[a].endTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,v+h,p,v+h,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(v+h*2),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.endTime-n[a].endTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}}else{if(w(f,e,c+h,p,c+h,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(c+h*2),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.endTime-n[a].endTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,v,l,c+h,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:l-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.endTime-n[a].endTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}}else if(c<v){if(w(f,e,c,p,v+h,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:p-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.endTime-n[a].endTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,v+h,l,v+h,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(v+h*2),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.endTime-n[a].endTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}}else{if(w(f,e,c+h,l,c+h,p,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.timeToSceneX(c+h*2),y:this.downMouse.y,w:100,h:100},0,Math.floor((b.endTime-n[a].endTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}if(w(f,e,v,l,c+h,l,y)){if(this.capLink&&this.capLink.dependenceTaskId===d&&this.capLink.parentTaskId==k){this.exist=!0;continue}return this.linkWidget.setBound({x:this.moveMouse.x,y:l-r+this.itemMargin-o,w:100,h:100},1,Math.floor((b.endTime-n[a].endTime)/24)),this.linkWidget.setLink(s),this.hitLink=s,!0}}return this.exist},getTheMilestoneTaskToDrag:function(){var n,r,s,h,v,y;this.dragTo={t:-1,m:-1,p:-1};n=this.timeScale.height()-this.rightScroll.value();r={x:0,y:0,width:0,height:0,dx:0,dy:0};this.dragTo.m=-1;this.dragTo.p=-1;r.x=this.worldToSceneX(this.dragBound.x+this.dragBound.dx);r.dx=r.x+this.dragBound.time;r.y=this.dragBound.y+this.dragBound.dy;r.dy=this.dragBound.y+this.dragBound.height;for(var e=(r.y+r.dy)*.5,u,c,o,l,i=this.itemMargin,f=this.storage.projects(),a=f.length,t=0;t<a;++t){if(n<e&&e<n+i)return this.dragTo.p=t,!0;if(f[t].fullCollapse){n+=i;continue}if(f[t].isEmpty()){if(n<e&&e<n+i*2)return this.dragTo.p=t,!0;n+=i*2}else{for(n+=i,u=0;u<f[t].m.length;++u)if(!f[t].m[u].filter){for(o=f[t].m[u].t.length,l=o,c=o-1;c>=0;--c)f[t].m[u].t[c].filter&&--l;if(s=n+this.itemHeight,h=s+i*(l+.5),o=l,this.fullscreen?h=s+i*(o+.5):f[t].m[u].collapse?(h=s+i*.5,o=0):h=s+i*(o+.5),0===o&&this.fullscreen&&(n+=i,h+=i),s<=r.y&&r.y<=h||s<=r.dy&&r.dy<=h||s<=r.y&&r.dy<=h)return v=f[t].m[u].beginTime,y=f[t].m[u].endTime,this.dragTo.m=u,this.dragTo.p=t,!0;n+=f[t].m[u].collapse?i:i*(o+1)}if(f[t].collapse){if(n<e&&e<n+i)return this.dragTo.p=t,!0;n+=i;continue}if(f[t].t.length){if(n<e&&e<n+i)return this.dragTo.p=t,!0;for(n+=i,u=f[t].t.length-1;u>=0;--u)if(!f[t].t[u].filter){if(n<e&&e<n+i)return this.dragTo.p=t,!0;n+=i}}else{if(n<e&&e<n+i)return this.dragTo.p=t,!0;n+=i}}}return n<r.y&&a>0?(this.dragTo.p=a===1?0:a-1,!0):!1},getContentHeight:function(){for(var r=0,i,f,u=this.itemMargin,t=this.storage.projects(),e=t.length,n=0;n<e;++n){if(t[n].fullCollapse){r+=u;continue}if(t[n].isEmpty())r+=u*2;else{for(r+=u,i=0;i<t[n].m.length;++i)if(!t[n].m[i].filter&&(r+=u,!t[n].m[i].collapse))for(f=t[n].m[i].t.length-1;f>=0;--f)t[n].m[i].t[f].filter||(r+=u);if(t[n].collapse){r+=u;continue}if(t[n].t.length)for(i=t[n].t.length-1;i>=0;--i)t[n].t[i].filter||(r+=u);r+=u}}return r},getElementPosVertical:function(n,t,i){for(var o=this.itemMargin,r,s,h,c,l,e=o*2,f=this.storage.projects(),a=f.length,u=0;u<a;++u){if(f[u].fullCollapse){e+=o;continue}if(f[u].isEmpty())e+=o*2;else{for(e+=o,r=0;r<f[u].m.length;++r)if(!f[u].m[r].filter){for(c=f[u].m[r].t.length,l=c,h=c-1;h>=0;--h)f[u].m[r].t[h].filter&&--l;if(n===u&&r===t&&-1===i)return e+o*.5+2;if(f[u].m[r].collapse){e+=o;continue}for(e+=o,s=0;s<f[u].m[r].t.length;++s)if(!f[u].m[r].t[s].filter){if(s===i&&n===u&&r===t)return e;e+=o}}if(f[u].collapse){e+=o;continue}if(e+=o,-1===t){for(r=0;r<f[u].t.length;++r)if(!f[u].t[r].filter){if(r===i&&u===n)return e;e+=o}}else for(r=0;r<f[u].t.length;++r)f[u].t[r].filter||(e+=o)}}return e},getLeftMostElement:function(){for(var r,i,u={height:null,x:null},f=0,t=this.storage.projects(),e=t.length,n=0;n<e;++n)if(f+=this.itemMargin,!t[n].isEmpty()){for(n!==0||this.fullscreen||(f+=this.itemMargin),f+=this.itemMargin,r=0;r<t[n].m.length;++r)if(!t[n].m[r].filter){for(f+=this.itemMargin,i=0;i<t[n].m[r].t.length;++i)t[n].m[r].t[i].filter||((!u.x||t[n].m[r].t[i].beginTime<u.x)&&(u.x=t[n].m[r].t[i].beginTime),f+=this.itemMargin);0===t[n].m[r].t.length&&((!u.x||t[n].m[r].beginTime<u.x)&&(u.x=t[n].m[r].beginTime),f+=this.itemMargin)}for(i=0;i<t[n].t.length;++i)t[n].t[i].filter||((!u.x||t[n].t[i].beginTime<u.x)&&(u.x=t[n].t[i].beginTime),f+=this.itemMargin);f+=this.itemHeight}return u.height=f+o,u},getTopElementInVisibleRange:function(){for(var c=(this.zoomBar.rightDate.getTime()-this.zoomBar.leftDate.getTime())/36e5,u=(this.zoomBar.thumb.begin-this.zoomBar.fraction)*c,s=(this.zoomBar.thumb.end-this.zoomBar.fraction)*c,r,f,t,e=0,h=this.itemMargin,i=this.storage.projects(),l=i.length,n=0;n<l;++n){if(i[n].fullCollapse){e+=h;continue}if(i[n].isEmpty())e+=h*2;else{for(e+=h,r=0;r<i[n].m.length;++r)if(!i[n].m[r].filter){for(e+=h,f=0;f<i[n].m[r].t.length;++f)if(t=i[n].m[r].t[f],!t.filter){if(t.beginTime>=u&&t.beginTime<=s||t.endTime>=u&&t.endTime<=s||t.beginTime>=u&&t.endTime<=s||t.beginTime<=u&&t.endTime>=s)return f===0&&r===0&&n===0?{height:o,empty:!1}:f===0?{height:e-h,empty:!1}:{height:e,empty:!1};e+=h}if(0===i[n].m[r].t.length){if(i[n].m[r].beginTime>=u&&i[n].m[r].beginTime<=s||i[n].m[r].endTime>=u&&i[n].m[r].endTime<=s||i[n].m[r].beginTime>=u&&i[n].m[r].endTime<=s||i[n].m[r].beginTime<=u&&i[n].m[r].endTime>=s)return f===0&&r===0&&n===0?{height:o,empty:!1}:f===0?{height:e-h,empty:!1}:{height:e,empty:!1};e+=h}}for(f=0;f<i[n].t.length;++f)if(t=i[n].t[f],!t.filter){if(t.endFail&&(t.beginTime<=u||t.beginTime>=u&&t.beginTime<=s))return f===0&&i[n].m.length===0&&n===0?{height:o,empty:!1}:{height:e,empty:!1};if(t.beginTime>=u&&t.beginTime<=s||t.endTime>=u&&t.endTime<=s||t.beginTime>=u&&t.endTime<=s||t.beginTime<=u&&t.endTime>=s)return f===0&&i[n].m.length===0&&n===0?{height:o,empty:!1}:{height:e,empty:!1};e+=h}e+=this.itemHeight}}return{height:o,empty:!0}},moveElement:function(n,t){if(!this.readMode){this.getTheMilestoneTaskToDrag(n);t&&(this.dragTo=t);var i=null,o=null,u,f,a,s,l=!1,e=-1,c=-1,v=-1,h=null;if(this.itemToDrop.p!==this.dragTo.p){this.dragTo={t:-1,m:-1,p:-1};this.needUpdate=!0;this.editMode=ni;return}if(-1!==this.dragTo.m&&-1!==this.dragTo.p){if(-1!==this.itemToDrop.t&&-1!==this.itemToDrop.p&&(this.calculateLineHit(n),-1===this.itemToDrop.m&&(u=this.storage.getTask(this.itemToDrop.p,undefined,this.itemToDrop.t),f=this.storage.getMilestone(this.dragTo.p,this.dragTo.m),i=this.storage.taskIds(this.itemToDrop.p,undefined,this.itemToDrop.t),o=this.storage.milestoneIds(this.dragTo.p,this.dragTo.m),h=this.modelController().collectLinks(this.itemToDrop.p,undefined,i.t),r-1!==f.status()&&(h.length?this.modelController().addTaskOperation(er,{p:this.itemToDrop.p,m:undefined,t:u,index:this.itemToDrop.t,place:this.hitLine.t+1,fromProject:this.itemToDrop.p,toProject:this.dragTo.p,fromMilestone:undefined,toMilestone:this.dragTo.m,taskId:i.t,milestoneId:undefined,projectId:i.p,projectToId:o.p,milestoneToId:o.m,linksToRemove:h,type:"FtoM"}):(u.endFail&&u.beginTime>=f.endTime&&u.updateBegin(f.endTime-24),this.storage.p[this.dragTo.p].m[this.dragTo.m].addTaskWithIndex(u,this.hitLine.t+1),this.storage.p[this.itemToDrop.p].removeTask(this.itemToDrop.t),f.updateTimes(),this.offMenus(),this._undoManager.add(dt,{p:this.itemToDrop.p,m:undefined,t:u,index:this.itemToDrop.t,place:this.hitLine.t+1,fromProject:this.itemToDrop.p,toProject:this.dragTo.p,fromMilestone:undefined,toMilestone:this.dragTo.m,taskId:i.t,milestoneId:undefined,projectId:i.p,projectToId:o.p,milestoneToId:o.m}),u.endFail&&u.beginTime>=f.endTime&&u.updateBegin(f.endTime-24),this._undoManager.performTop(),f.collapse&&f.setCollapse(!1)))),-1!==this.itemToDrop.m&&-1!==this.dragTo.m&&r-1!==this.storage.getMilestone(this.dragTo.p,this.dragTo.m).status())){if(s=this.itemToDrop.t,e=this.hitLine.t+1,c=e,this.hitLine.t+1===s&&this.dragTo.m===this.itemToDrop.m){this.dragTo={t:-1,m:-1,p:-1};this.needUpdate=!0;this.editMode=ni;return}this.dragTo.m===this.itemToDrop.m&&(l=!0,e<s?++s:c++);u=this.storage.getTask(this.itemToDrop.p,this.itemToDrop.m,this.itemToDrop.t);f=this.storage.getMilestone(this.dragTo.p,this.dragTo.m);i=this.storage.taskIds(this.itemToDrop.p,this.itemToDrop.m,this.itemToDrop.t);o=this.storage.milestoneIds(this.dragTo.p,this.dragTo.m);h=this.modelController().collectLinks(this.itemToDrop.p,this.itemToDrop.m,i.t);h.length&&!l?(this.offMenus(),this.modelController().addTaskOperation(er,{p:this.itemToDrop.p,m:undefined,t:u,index:this.itemToDrop.t,place:this.hitLine+1,fromProject:this.itemToDrop.p,toProject:this.dragTo.p,fromMilestone:this.itemToDrop.m,toMilestone:this.dragTo.m,taskId:i.t,milestoneId:i.m,projectId:i.p,projectToId:o.p,milestoneToId:o.m,linksToRemove:h,type:"MtoM"})):(f.addTaskWithIndex(u,c),this.storage.p[this.itemToDrop.p].m[this.itemToDrop.m].removeTask(s),this.storage.p[this.itemToDrop.p].m[this.itemToDrop.m].updateTimes(),f.updateTimes(),this.offMenus(),this._undoManager.add(dt,{p:this.itemToDrop.p,m:undefined,t:u,index:this.itemToDrop.t,place:e,fromProject:this.itemToDrop.p,toProject:this.dragTo.p,fromMilestone:this.itemToDrop.m,toMilestone:this.dragTo.m,taskId:i.t,milestoneId:i.m,projectId:i.p,projectToId:o.p,milestoneToId:o.m}),this._undoManager.performTop(),f.collapse&&f.setCollapse(!1))}}else{if(this.calculateLineHit(n),u=this.storage.getTask(this.itemToDrop.p,-1===this.itemToDrop.m?undefined:this.itemToDrop.m,this.itemToDrop.t),i=this.storage.taskIds(this.itemToDrop.p,-1===this.itemToDrop.m?undefined:this.itemToDrop.m,this.itemToDrop.t),a=this.storage.projects()[this.itemToDrop.p],h=this.modelController().collectLinks(this.itemToDrop.p,-1===this.itemToDrop.m?undefined:this.itemToDrop.m,i.t),s=this.itemToDrop.t,e=this.hitLine.t+1,c=e,this.dragTo.m===this.itemToDrop.m){if(this.hitLine.t+1===s&&this.dragTo.m===this.itemToDrop.m){this.dragTo={t:-1,m:-1,p:-1};this.needUpdate=!0;this.editMode=ni;return}e=this.hitLine.t+1;c=e;v=s;l=!0;e<s?++v:++e}h.length&&!l?(this.offMenus(),this.modelController().addTaskOperation(er,{p:this.itemToDrop.p,m:this.itemToDrop.m,t:u,index:this.itemToDrop.t,fromProject:this.itemToDrop.p,toProject:this.itemToDrop.p,fromMilestone:this.itemToDrop.m,toMilestone:undefined,taskId:i.t,milestoneId:i.m,projectId:i.p,projectToId:a._id,milestoneToId:undefined,linksToRemove:h,type:"MtoF"})):l?(this.storage.p[this.itemToDrop.p].addTaskWithIndex(u,e),this.storage.p[this.itemToDrop.p].removeTask(v),this.offMenus(),this._undoManager.add(dt,{p:this.itemToDrop.p,m:this.itemToDrop.m,t:u,index:s,place:c,fromProject:this.itemToDrop.p,toProject:this.itemToDrop.p,fromMilestone:undefined,toMilestone:undefined,taskId:i.t,milestoneId:i.m,projectId:i.p,projectToId:a._id,milestoneToId:undefined}),this._undoManager.performTop()):(u=this.storage.getTask(this.itemToDrop.p,this.itemToDrop.m,this.itemToDrop.t),this.storage.p[this.itemToDrop.p].addTaskWithIndex(u,c),this.storage.p[this.itemToDrop.p].m[this.itemToDrop.m].removeTask(this.itemToDrop.t),this.offMenus(),this._undoManager.add(dt,{p:this.itemToDrop.p,m:this.itemToDrop.m,t:u,index:this.itemToDrop.t,place:c,fromProject:this.itemToDrop.p,toProject:this.itemToDrop.p,fromMilestone:this.itemToDrop.m,toMilestone:undefined,taskId:i.t,milestoneId:i.m,projectId:i.p,projectToId:a._id,milestoneToId:undefined}),this._undoManager.performTop())}this.dragTo={t:-1,m:-1,p:-1};this.needUpdate=!0;this.editMode=ni}},editElementTitle:function(n,t,i){var f;if(!this.readMode){var e=-1,o=-1,s=-1,u=null;if(-1!==n&&-1===t&&i!==-1&&(e=this.storage.p[n]._id,s=this.storage.p[n].t[i]._id,u=this.storage.getTask(n,undefined,i),u)){if(r==u._status)return;u.isInEditMode=!0;this.editBox.reset();this.editBox.taskRef=u;this.editBox.p=n;this.editBox.m=-1;this.editBox.t=i;this.editBox.text=u._title;this.editBox.saveText=u._title;this.editBox.setEnable();this.offsetX*this.timeScale.scaleX+u.beginTime<this.sceneXToTime(this.visibleLeft)?this.animator.moveCenterToX(u.beginTime):this.sceneToWorldX(u.beginTime)+u.titleWidth>this.ctxWidth&&this.animator.moveCenterToX(u.beginTime);this._undoManager.add(ci,{p:n,m:undefined,t:u,index:i,taskId:s,milestoneId:undefined,projectId:e,silentUpdateMode:!0})}if(-1!==n&&-1!==t&&i!==-1&&(e=this.storage.p[n]._id,o=this.storage.p[n].m[t]._id,s=this.storage.p[n].m[t].t[i]._id,u=this.storage.getTask(n,t,i),u)){if(r==u._status)return;u.isInEditMode=!0;this.editBox.reset();this.editBox.taskRef=u;this.editBox.p=n;this.editBox.m=t;this.editBox.t=i;this.editBox.text=u._title;this.editBox.saveText=u._title;this.editBox.setEnable();this.offsetX*this.timeScale.scaleX+u.beginTime<this.sceneXToTime(this.visibleLeft)?this.animator.moveCenterToX(u.beginTime):this.sceneToWorldX(u.beginTime)+u.titleWidth>this.ctxWidth&&this.animator.moveCenterToX(u.beginTime);this._undoManager.add(ci,{p:n,m:t,t:u,index:i,taskId:s,milestoneId:o,projectId:e,silentUpdateMode:!0})}-1!==n&&-1!==t&&i===-1&&(e=this.storage.p[n]._id,o=this.storage.p[n].m[t]._id,f=this.storage.getMilestone(n,t),f&&(f.isInEditMode=!0,this.editBox.reset(),this.editBox.milestoneRef=f,this.editBox.p=n,this.editBox.m=t,this.editBox.t=-1,this.editBox.text=f._title,this.editBox.saveText=f._title,this.editBox.setEnable(),this._undoManager.add(bi,{p:n,m:t,t:f,index:undefined,taskId:undefined,milestoneId:o,projectId:e,silentUpdateMode:!0}),(this.sceneToWorldX(f.endTime)-f.titleWidth<this.sceneXToTime(this.visibleLeft)||this.sceneToWorldX(f.endTime)>this.ctxWidth)&&this.animator.moveCenterToX(f.endTime)))}},updateScrollContent:function(){var n,f,s;if(this.needUpdateScrollContent){n=this;n.needUpdateScrollContent=!1;var r=0,i=n.ctxHeight-n.timeScale.height()+2,u=Math.max(n.contentHeight-i,o),e=Math.min(n.contentHeight,n.rightScroll.value()+i);if(n.taskDescWidget.isValid()&&(r=n.widgetY+n.taskDescWidget.bound.h),n.milestoneDescWidget.isValid()&&(r=n.widgetY+n.milestoneDescWidget.bound.h),i>n.contentHeight&&i>r&&n.rightScroll.offDown===0){n.taskDescWidget.isValid()&&n.widgetX+n.taskDescWidget.bound.w>n.ctxWidth&&n.animator.addMovementX(-(n.ctxWidth-(n.widgetX+n.taskDescWidget.bound.w)-35)/n.timeScale.hourInPixels);return}if(n.offMenus(),r>e){if(f=r-e,s=e+f,u=Math.max(s-i,o),n.rightScroll.offDown===f&&f===0){n.needUpdateScrollContent=!1;return}r>n.contentHeight?(n.rightScroll.setOffDown(f),n.rightScroll.init(n.timeScale.height()+2,i,s,n.ctxWidth),n.offMenus()):u=t(u/n.itemMargin)*n.itemMargin-o;n.animator.moveToY(u,function(){})}else n.rightScroll.offDown&&(n.rightScroll.value()<u?(n.rightScroll.save(),n.rightScroll.setOffDown(0),n.rightScroll.init(n.timeScale.height()+2,i,n.contentHeight,n.ctxWidth)):n.animator.moveToY(u,function(){n.rightScroll.save();n.rightScroll.setOffDown(0);n.rightScroll.init(n.timeScale.height()+2,i,n.contentHeight,n.ctxWidth)}));n.taskDescWidget.isValid()&&n.widgetX+n.taskDescWidget.bound.w>n.ctxWidth&&n.animator.addMovementX(-(n.ctxWidth-(n.widgetX+n.taskDescWidget.bound.w)-35)/n.timeScale.hourInPixels)}},createTask:function(n,t,i,u){var l;if(!this.editBox.enable&&!this.readMode){var s=-1,v=-1,h=-1,e,a,o,f,c;if(-1===t&&(this.queryMoveLinks=null,s=this.storage.p[n]._id,h=this.storage.genRefId(),this.storage.addTaskWithIndex(kf(s,undefined,h),i),e=this.storage.getTask(n,undefined,i),a=this.moveMouse.x,o=this.timeScale.scaleUnitStep(),f=(a-this.timeScale.hourInPixels*this.offsetX)/(this.timeScale.hourInPixels*o)*o*this.timeScale.scaleX,f<0&&(f-=o),this.sticking&&(f=(f/o>>0)*o),e.setTimes(f,f+120),e&&(e.isInEditMode=!0,this.editBox.reset(),this.editBox.taskRef=e,this.editBox.p=n,this.editBox.m=t,this.editBox.t=i,this.editBox.createMode=!0,u&&(this.editBox.placeHolder=u),this.editBox.setEnable(),this._undoManager.add(ui,{p:n,m:undefined,t:e,index:i,taskId:h,milestoneId:undefined,projectId:s,silentUpdateMode:!0}),c=this.getElementPosVertical(n,-1,1===this.storage.getProject(n).t.length?i:i+1),this.rightScroll.value()+this.rightScroll.viewWidth<c&&this.animator.moveToY(Math.min(Math.max(0,c-this.ctxHeight*.5),this.rightScroll._maxValue-this.rightScroll.viewWidth)+this.itemMargin*2))),-1!==t){if(this.queryMoveLinks=null,this.storage.p[n].m[t]._status==r-1)return;s=this.storage.p[n]._id;v=this.storage.p[n].m[t]._id;h=this.storage.genRefId();this.storage.addTaskWithIndex(kf(s,v,h),i);e=this.storage.getTask(n,t,i);l=this.storage.getMilestone(n,t);a=this.moveMouse.x;o=this.timeScale.scaleUnitStep();f=(a-this.timeScale.hourInPixels*this.offsetX)/(this.timeScale.hourInPixels*o)*o*this.timeScale.scaleX;f<0&&(f-=o);this.sticking&&(f=(f/o>>0)*o);e.setTimes(f,f+120);f<l.endTime&&e.setTimes(f,l.endTime);e&&(e.isInEditMode=!0,this.editBox.reset(),this.editBox.taskRef=e,this.editBox.p=n,this.editBox.m=t,this.editBox.t=i,this.editBox.createMode=!0,this.editBox.milestoneRefForUpdate=l,u&&(this.editBox.placeHolder=u,this.editBox.addMode=!0),this.editBox.setEnable(),l.updateTimes(),this._undoManager.add(ui,{p:n,m:t,t:e,index:i,taskId:h,milestoneId:v,projectId:s,silentUpdateMode:!0}),c=this.getElementPosVertical(n,t,i),this.rightScroll.value()+this.rightScroll.viewWidth<c&&this.animator.moveToY(Math.max(0,c+this.itemMargin*2-this.rightScroll.viewWidth)))}}},createMilestone:function(t,i){var r,e,l;if(!this.editBox.enable&&0!==this.storage.projects().length&&!this.readMode&&(r={p:t,m:i},r.p>=0)){var o=this.storage.p[r.p]._id,s=this.storage.genRefId(),u=null;if((undefined===r.m||-1===i)&&(r.m=this.storage.p[r.p].m.length),this.storage.p[r.p].addMilestoneWithIndex(as(o,s),r.m),u=this.storage.getMilestone(r.p,r.m),u){var h=n.Gantt.Localize_strings.newMilestone,c=this.moveMouse.x,f=this.timeScale.scaleUnitStep();c=this.moveMouse.x;f=this.timeScale.scaleUnitStep();e=(c-this.timeScale.hourInPixels*this.offsetX)/(this.timeScale.hourInPixels*f)*f*this.timeScale.scaleX;e<0&&(e-=f);this.sticking&&(e=(e/f>>0)*f);u.updateEnd(e);this.editBox.reset();this.editBox.milestoneRef=u;this.editBox.p=r.p;this.editBox.m=r.m;this.editBox.t=-1;this.editBox.addMode=!0;this.editBox.createMode=!0;h&&(this.editBox.placeHolder=h);this.editBox.setEnable();this._undoManager.add(hi,{p:r.p,m:r.m,t:u,index:r.m,taskId:undefined,milestoneId:s,projectId:o,silentUpdateMode:!0});l=this;this.viewController().centeringElement(u.id(),!0,function(){l.updateContent()},!0)}}},addNewMilestone:function(){var i,u,h;if(!this.editBox.enable&&0!==this.storage.projects().length&&!this.readMode&&(i=this.calculateHitMilestone(this.centerScreen,this.ctxHeight*.5),undefined===i.p&&(i.p=this.storage.projects().length-1),i.p>=0)){var f=this.storage.p[i.p]._id,e=this.storage.genRefId(),r=null;if(undefined===i.m&&(i.m=this.storage.p[i.p].m.length),this.storage.p[i.p].addMilestoneWithIndex(as(f,e),i.m),r=this.storage.getMilestone(i.p,i.m),r){var s=n.Gantt.Localize_strings.newMilestone,c=this.moveMouse.x,l=this.timeScale.scaleUnitStep();r.updateEnd(go);this.editBox.reset();this.editBox.milestoneRef=r;this.editBox.p=i.p;this.editBox.m=i.m;this.editBox.t=-1;this.editBox.addMode=!0;this.editBox.createMode=!0;s&&(this.editBox.placeHolder=s);this.editBox.setEnable();this._undoManager.add(hi,{p:i.p,m:i.m,t:r,index:i.m,taskId:undefined,milestoneId:e,projectId:f,silentUpdateMode:!0});this.updateContent();(this.sceneToWorldX(r.endTime)-r.titleWidth<this.sceneXToTime(this.visibleLeft)||this.sceneToWorldX(r.endTime)>this.ctxWidth)&&this.animator.moveCenterToX(0);u=this.getElementPosVertical(i.p,i.m,-1)-this.ctxHeight*.5;h=t(this.rightScroll.maxValue()/this.itemMargin)*this.itemMargin;u=t(u/this.itemMargin)*this.itemMargin;this.animator.moveToY(Math.min(Math.max(0,u),h)+(this.itemMargin*2-o)*this.fullscreen)}}},addNewTask:function(i){var r,e,u,f;this.editBox.enable||0===this.storage.projects().length||this.readMode||(r=null,this.hitLine={p:-1,m:-1,t:-1},this.calculateLineHit(undefined,this.centerScreen,this.ctxHeight*.5),this.hitLine.m=-1,-1===this.hitLine.p?(r=this.storage.endProject(),r&&(this.hitLine.t=r.t.length-1,e=null,e?r.t.length?(this.createTask(this.storage.projects().length-1,-1,r.t.length,n.Gantt.Localize_strings.newTask),r._calcTimes()):this.createTask(this.storage.projects().length-1,r.m.length-1,r.m[r.m.length-1].t.length,i?i:n.Gantt.Localize_strings.newTask):(this.createTask(this.storage.projects().length-1,-1,r.t.length,i?i:n.Gantt.Localize_strings.newTask),r._calcTimes()))):(this.hitLine.t=this.storage.p[this.hitLine.p].t.length-1,r=this.storage.endProject(),r.collapse&&(r.setCollapse(!1),this.updateContent(!0)),this.createTask(this.hitLine.p,this.hitLine.m,this.hitLine.t+1,n.Gantt.Localize_strings.newTask)),u=this.getElementPosVertical(0,-1,this.hitLine.t+1)-this.ctxHeight*.5,f=this.rightScroll.maxValue(),this.fullscreen||(f=t(this.rightScroll.maxValue()/this.itemMargin)*this.itemMargin,u=t(u/this.itemMargin)*this.itemMargin),this.animator.moveToY(Math.min(Math.max(0,u),f)+(this.itemMargin*2-o)*this.fullscreen))},addTaskToMilestone:function(t,i){if(!this.readMode){var e=-1,o=-1,s=-1;if(-1!==i){e=this.storage.p[t]._id;o=this.storage.p[t].m[i]._id;s=this.storage.genRefId();this.storage.addTaskWithIndex(kf(e,o,s),0);var r=this.storage.getTask(t,i,0),c=this.storage.getMilestone(t,i),h=n.Gantt.Localize_strings.newTask,l=this.menuMileStone.bound.x+this.menuMileStone.bound.w*.5,u=this.timeScale.scaleUnitStep(),f=(l-this.timeScale.hourInPixels*this.offsetX)/(this.timeScale.hourInPixels*u)*u*this.timeScale.scaleX;f<0&&(f-=Math.max(24,u));this.sticking&&(f=(f/u>>0)*u);r.setTimes(f,c.endTime);r&&(r.isInEditMode=!0,this.editBox.reset(),this.editBox.taskRef=r,this.editBox.p=t,this.editBox.m=i,this.editBox.t=0,this.editBox.createMode=!0,h&&(this.editBox.placeHolder=h),this.editBox.setEnable(),this._undoManager.add(ui,{p:t,m:i,t:r,index:0,taskId:s,milestoneId:o,projectId:e,silentUpdateMode:!0}))}}},showPopUpResp:function(n,t,i,r){var u,f;this.handlers[hf]&&(undefined===i||-1===i?(u=this.storage.getMilestone(n,t),this._modelController.statusElement={p:n,m:t,t:undefined,ref:u,ids:this.storage.milestoneIds(n,t),isTask:!1,milestone:u},f={left:r,top:this.getElementPosVertical(n,t,-1)+this.ctx.canvas.offsetTop-this.rightScroll.value()}):(u=this.storage.getTask(n,t,i),this._modelController.statusElement={p:n,m:t,t:i,ref:u,ids:this.storage.taskIds(n,t,i),isTask:!0,task:u},f={left:r,top:this.currentElementY+this.ctx.canvas.offsetTop}),this.handlers[hf](u,f),this.menuMileStone.p=-1,this.menuMileStone.m=-1,this.queryMoveLinks=null,this.capTask=-1,this.capMilestone=-1,this.capProject=-1,this.capSide=-1,this.offMenus())},showPopUpEditElement:function(n,t,i){var r;this.handlers[ho]&&(undefined===i||-1===i?(r=this.storage.getMilestone(n,t),this._modelController.statusElement={p:n,m:t,t:undefined,ref:r,ids:this.storage.milestoneIds(n,t),isTask:!1,milestone:r}):(r=this.storage.getTask(n,t,i),this._modelController.statusElement={p:n,m:t,t:i,ref:r,ids:this.storage.taskIds(n,t,i),isTask:!0,task:r}),this.handlers[ho](r),this.menuMileStone.p=-1,this.menuMileStone.m=-1,this.queryMoveLinks=null,this.capTask=-1,this.capMilestone=-1,this.capProject=-1,this.capSide=-1,this.offMenus())},addEditLink:function(){var n=null,i=this.hitProject,f=this.hitMilestone,u=this.hitTask;if(-1===f&&-1===u||-1!=i&&p!==this.storage.getProject(i).status())return!1;var e=this.hitSide,h=this.timeScale.height(),o=0,l=t(this.rightScroll.value())+this.itemMargin*.5+!this.fullscreen*this.itemMargin;return(-1!=i&&-1!=u&&-1===f&&(n=this.storage.getTask(i,undefined,u),h+=this.getElementPosVertical(i,f,u)-l,this.timeToSceneX(n.beginTime)+Math.abs(this.timeToSceneX(n.endTime)-this.timeToSceneX(n.beginTime))*.5>this.moveMouse.x?(e=s,o=this.timeToSceneX(n.beginTime)):(e=c,o=this.timeToSceneX(n.endTime))),-1!=this.hitProject&&-1!=u&&-1!=f&&(n=this.storage.getTask(i,f,u),h+=this.getElementPosVertical(i,f,u)-l,this.timeToSceneX(n.beginTime)+Math.abs(this.timeToSceneX(n.endTime)-this.timeToSceneX(n.beginTime))*.5>this.moveMouse.x?(e=s,o=this.timeToSceneX(n.beginTime)):(e=c,o=this.timeToSceneX(n.endTime))),n&&r!==n._status)?(n.endFail&&(e=s),this.linkLineEdit={side:e,task:n,posX:o,posY:h},this.editMode=et,this.linkLineEdit.p=i,this.linkLineEdit.m=f,this.linkLineEdit.t=u,!0):!1},applyEditLink:function(){var f,u;if(et===this.editMode&&this.linkLineEdit){if(this.linkLineEdit.parent&&this.linkLineEdit.parent._id!==this.linkLineEdit.task._id&&kt!==this.linkLineEdit.side&&kt!==this.linkLineEdit.parentSide&&this.linkLineEdit.pp===this.linkLineEdit.p&&this.linkLineEdit.pm===this.linkLineEdit.m&&r!==this.linkLineEdit.parent._status){var n,t,i,e=!1,o=this.linkLineEdit.parent.id(),h=this.linkLineEdit.task.id();if(this.pushLink){for(t=this.pushLink.task.links,i=t.last(),n=0;n<t.length-1;++n)i.dependenceTaskId===t[n].dependenceTaskId&&i.linkType===t[n].linkType&&i.parentTaskId===t[n].parentTaskId&&i.type===t[n].type&&(e=!0);if(this.pushLink.task.links.pop(),!e&&(i.linkType===bt||i.linkType===wt))for(t=this.linkLineEdit.parent.links,n=0;n<t.length;++n)i.parentTaskId===t[n].dependenceTaskId&&i.linkType===t[n].linkType&&i.dependenceTaskId===t[n].parentTaskId&&i.type===t[n].type&&(e=!0);this.pushLink=undefined}if(!e){for(f=!1,t=this.linkLineEdit.parent.links,n=0;n<t.length;++n)if(h==t[n].parentTaskId){f=!0;break}if(!f)for(t=this.linkLineEdit.task.links,n=0;n<t.length;++n)if(o==t[n].parentTaskId){f=!0;break}f||(u={},s===this.linkLineEdit.side&&c===this.linkLineEdit.parentSide?(u.parentSide=this.linkLineEdit.side,u.parent=this.linkLineEdit.task,u.task=this.linkLineEdit.parent,u.side=this.linkLineEdit.parentSide):(u.side=this.linkLineEdit.side,u.task=this.linkLineEdit.task,u.parent=this.linkLineEdit.parent,u.parentSide=this.linkLineEdit.parentSide),this._modelController.addTaskOperation(sf,u),this.offMenus(),this.needUpdate=!0)}}this.pushLink&&(this.pushLink.task.links.pop(),this.pushLink=undefined);this.linkLineEdit=undefined;this.editMode=ni;this._mouseInLinkZone=null}},isValidEditLink:function(){var n,t,i,u=!1,f=this.linkLineEdit.parent.id(),e=this.linkLineEdit.task.id(),r;if(this.linkLineEdit.parent.endFail&&this.linkLineEdit.task.endFail?(this.linkLineEdit.side=s,this.linkLineEdit.parentSide=s):this.linkLineEdit.parent.endFail?this.linkLineEdit.parentSide=s:this.linkLineEdit.task.endFail&&(this.linkLineEdit.side=s),this.pushLink){if(is&&it!==this.pushLink.task.links.last().linkType)return this.pushLink.task.links.pop(),this.pushLink=undefined,!1;for(t=this.pushLink.task.links,i=t.last(),n=0;n<t.length-1;++n)i.dependenceTaskId===t[n].dependenceTaskId&&i.linkType===t[n].linkType&&i.parentTaskId===t[n].parentTaskId&&i.type===t[n].type&&(u=!0);if(this.pushLink.task.links.pop(),!u&&(i.linkType===bt||i.linkType===wt))for(t=this.linkLineEdit.parent.links,n=0;n<t.length;++n)i.parentTaskId===t[n].dependenceTaskId&&i.linkType===t[n].linkType&&i.dependenceTaskId===t[n].parentTaskId&&i.type===t[n].type&&(u=!0);this.pushLink=undefined}if(!u){for(r=!1,t=this.linkLineEdit.parent.links,n=0;n<t.length;++n)if(e==t[n].parentTaskId){r=!0;break}if(!r)for(t=this.linkLineEdit.task.links,n=0;n<t.length;++n)if(f==t[n].parentTaskId){r=!0;break}if(!r)return!0}return this.pushLink&&(this.pushLink.task.links.pop(),this.pushLink=undefined),!1},sceneToWorldX:function(n){return this.timeScale.hourInPixels*this.offsetX+n*this.timeScale.hourInPixels/this.timeScale.scaleX},sceneToWorldY:function(){},worldToSceneX:function(n){return(n-this.offsetX*this.timeScale.hourInPixels)/this.timeScale.hourInPixels*this.timeScale.scaleX},worldToSceneY:function(n){return n-this.timeScale.height()+this.rightScroll.value()},sceneXToTime:function(n){return n*this.timeScale.scaleX/this.timeScale.hourInPixels},timeToSceneX:function(n){var t=this.timeScale.hourInPixels/this.timeScale.scaleX,i=this.timeScale.hourInPixels*this.offsetX;return i+n*t},windowToCanvas:function(n,t){return{x:n-this.bounding.left*(this.ctxWidth/this.bounding.width),y:t-this.bounding.top*(this.ctxHeight/this.bounding.height)}},addHandler:function(n,t){this.handlers[n]=t},internalVersion:function(){return ie},isEditTitleMode:function(){return this._leftPanelController.getPanel().editBox.isEnable()||this.editBox.isEnable()},setEnableTouch:function(n){this.enableTouch=n},updateDefaults:function(){this.titlesFont=this.fontHeight+"pt "+b;this.timeScale.updateDefaults();this.editBox.updateDefaults()},needDrawFlashBackground:function(n){this._needDrawFlashBackground=n;this.needUpdate=!0},print:function(){function g(n,i,r){r>=u*2&&(n?(t.fillStyle="#818181",et.drawArrowLeft(i,r,13,13)):(t.fillStyle="#818181",et.drawArrowBottom(i,r,13,13)))}var u=this.itemMargin,lt=n.Gantt.Localize_strings.taskWithoutMilestones||"Task Without Milestones",at=n.Gantt.Localize_strings.highPriority||"high",ut=n.Gantt.Localize_strings.openStatus||"open",ft=n.Gantt.Localize_strings.closeStatus||"close",nt=n.Gantt.Localize_strings.addDate||"add",tt=n.Gantt.Localize_strings.noResponsible,d=undefined!==Teamlab&&undefined!==Teamlab.getDisplayDate,t=this.ctx,l=null,s=null,et=new ar(t),a=this.leftPanelController().getPanel(),vt=a.el,f=u*2,w="12px"+b,ot="bold 12px "+b,dt="bold 16px "+b;if(vt){l=vt.getBoundingClientRect();this.drawScene(!0);t.fillStyle="#F3F3F3";t.fillRect(0,0,l.width,this.ctxHeight);t.fillStyle="#CCCCCC";t.fillRect(l.width,0,1,this.ctxWidth);t.fillStyle="#CCCCCC";t.fillRect(l.width,0,1,this.ctxWidth);for(var c,v,p,y=!1,i=-this.rightScroll.value(),o=this.storage.projects(),gt=o.length,it=a.rows[1].posX,yt=a.rows[2].posX,st=a.rows[3].posX,k=a.rows[4].posX,wt=a.rows[5].posX,rt=!a.rows[1].isHidden,bt=!a.rows[2].isHidden,ht=!a.rows[3].isHidden,ct=!a.rows[4].isHidden,kt=!a.rows[5].isHidden,e=0;e<gt;++e){if(y=o[e].isLocked()||o[e].isInReadMode(),i>=0&&(p=ei(o[e]._title,19),t.fillStyle=y?h:"#000000",t.font=dt,t.fillText(p,18,i+u*.75+f),rt&&(t.font=w,t.fillText(ei(lu(o[e],tt),20),it,i+u*.7+f)),t.fillStyle="#D3D3D3",t.fillRect(0,i+f,l.width-15,1),t.fillRect(0,i+u+f,l.width-15,1),o[e]._isprivate&&t.drawImage(rs,0,36,16,16,0,i+f+u*.35,16,16),g(o[e].fullCollapse,230,i+u*.35+f)),o[e].fullCollapse){if(i+=u,i>this.ctxHeight)break;continue}if(o[e].isEmpty())i+=this.itemMargin,i>=0&&(t.fillStyle=y?h:"#000000",t.font=ot,t.fillText(lt,27,i+u*.75+f),t.font=w,t.fillText(vr(o[e].t),195,i+u*.7+f),t.fillStyle="#D3D3D3",t.fillRect(0,i+f,l.width-15,1),t.fillRect(0,i+u+f,l.width-15,1)),i+=this.itemMargin;else{if(i+=this.itemMargin,i>this.ctxHeight)break;for(v=0;v<o[e].m.length;++v)if(!o[e].m[v].filter){if(i>=0&&(p=ei(o[e].m[v]._title,24),t.fillStyle=y?h:hs(o[e].m[v]),t.font=ot,t.fillText(p,27,i+u*.7+f),t.font=w,t.fillText(vr(o[e].m[v].t),195,i+u*.7+f),rt&&t.fillText(ei(lu(o[e].m[v],tt),20),it,i+u*.7+f),ht&&t.fillText(pt(o[e].m[v]._endDate,d),st,i+u*.7+f),ct&&(t.fillStyle=y?h:"#000000",r-1===o[e].m[v]._status?t.fillText(ft,k,i+u*.7+f):t.fillText(ut,k,i+u*.7+f)),t.fillStyle="#D3D3D3",t.fillRect(0,i+f,l.width-15,1),t.fillRect(0,i+u+f,l.width-15,1),o[e].m[v].t.length&&g(o[e].m[v].collapse,230,i+u*.35+f)),i+=this.itemMargin,i>this.ctxHeight)break;if(!o[e].m[v].collapse)for(c=0;c<o[e].m[v].t.length;++c)if(!o[e].m[v].t[c].filter&&(i>=0&&(s=o[e].m[v].t[c],p=ei(s._title,28),t.fillStyle=y?h:au(s),t.font=w,t.fillText(p,36,i+u*.65+f),rt&&t.fillText(ei(cu(s,tt),20),it,i+u*.7+f),bt&&t.fillText(s.beginFail?nt:pt(s.beginDate(),d),yt,i+u*.7+f),ht&&t.fillText(s.endFail?nt:pt(s.endDate(),d),st,i+u*.7+f),s._priority&&kt&&t.fillText(at,wt,i+u*.7+f),ct&&(t.fillStyle=y?h:"#000000",r===s._status?t.fillText(ft,k,i+u*.7+f):t.fillText(ut,k,i+u*.7+f)),t.fillStyle="#D3D3D3",t.fillRect(0,i+f,l.width-15,1),t.fillRect(0,i+u+f,l.width-15,1)),i+=u,i>this.ctxHeight))break}if(i>=0&&(t.fillStyle=y?h:"#000000",t.font=ot,t.fillText(lt,27,i+u*.75+f),t.font=w,t.fillText(vr(o[e].t),195,i+u*.7+f),t.fillStyle="#D3D3D3",t.fillRect(0,i+f,l.width-15,1),t.fillRect(0,i+u+f,l.width-15,1)),o[e].collapse){if(g(o[e].collapse,230,i+u*.35+f),i+=u,i>this.ctxHeight)break;continue}if(o[e].t.length){for(g(o[e].collapse,230,i+u*.35+f),i+=this.itemMargin,c=0;c<o[e].t.length;++c)if(!o[e].t[c].filter&&(i>=0&&(s=o[e].t[c],p=ei(s._title,28),t.fillStyle=y?h:au(s),t.font=w,t.fillText(p,36,i+u*.65+f),rt&&t.fillText(ei(cu(s,tt),20),it,i+u*.7+f),bt&&t.fillText(s.beginFail?nt:pt(s.beginDate(),d),yt,i+u*.7+f),ht&&t.fillText(s.endFail?nt:pt(s.endDate(),d),st,i+u*.7+f),s._priority&&kt&&t.fillText(at,wt,i+u*.7+f),ct&&(t.fillStyle=y?h:"#000000",r===s._status?t.fillText(ft,k,i+u*.7+f):t.fillText(ut,k,i+u*.7+f)),t.fillStyle="#D3D3D3",t.fillRect(0,i+f,l.width-15,1),t.fillRect(0,i+u+f,l.width-15,1)),i+=u,i>this.ctxHeight))break}else i+=this.itemMargin}if(i>this.ctxHeight)break}for(t.fillStyle="#D3D3D3",t.fillRect(0,0,l.width,u*1.5),c=1;c<a.rows.length;++c)a.rows[c].isHidden||(t.fillStyle="#F3F3F3",et.roundRect(t,a.rows[c].posX-5,26,a.rows[c].minWidth,u,4),t.fill(),t.fillStyle="#666666",t.font=w,t.fillText(a.rows[c].translate,a.rows[c].posX+1,u*1.3))}}};ks=n.Gantt?n.Gantt:n.Gantt={};ks.TimeLine=te;i=te.prototype;i.render=i.render;i.addHandler=i.addHandler;i.update=i.update;i.viewController=i.viewController;i.modelController=i.modelController;i.undoManager=i.undoManager;i.userDefaults=i.userDefaults;i.leftPanelController=i.leftPanelController;i.addNewTask=i.addNewTask;i.addNewMilestone=i.addNewMilestone;i.setReadMode=i.setReadMode;i.print=i.print;i.onkeypress=i.onkeypress;i.onkeydown=i.onkeydown;i.onkeyup=i.onkeyup;i.ondblclick=i.ondblclick;i.onmousewheel=i.onmousewheel;i.onpaste=i.onpaste;i.oncopy=i.oncopy;i.focus=i.focus;i.internalVersion=i.internalVersion;i.isEditTitleMode=i.isEditTitleMode;i.setEnableTouch=i.setEnableTouch;i.needDrawFlashBackground=i.needDrawFlashBackground;i=gf.prototype;i.addTask=i.addTask;i.addMilestone=i.addMilestone;i.addProject=i.addProject;i.finalize=i.finalize;i.clear=i.clear;i.applyNewAddTaskId=i.applyNewAddTaskId;i.applyNewAddMilestoneId=i.applyNewAddMilestoneId;i.addLinkWithIds=i.addLinkWithIds;i.finalizeStatus=i.finalizeStatus;i.finalizeOperation=i.finalizeOperation;i.collectBeginEndItems=i.collectBeginEndItems;i.throughIdsIndexes=i.throughIdsIndexes;i.buildWithThroughIndexer=i.buildWithThroughIndexer;i.setFilter=i.setFilter;i.clearFilter=i.clearFilter;i=ne.prototype;i.scaleTo=i.scaleTo;i.strafeToDay=i.strafeToDay;i.strafe=i.strafe;i.toVisibleElementMove=i.toVisibleElementMove;i.buildZoomBar=i.buildZoomBar;i.enableSlipAnimation=i.enableSlipAnimation;i.fullscreen=i.fullscreen;i.disableUserEvents=i.disableUserEvents;i.scaleValue=i.scaleValue;i.saveViewState=i.saveViewState;i.loadViewState=i.loadViewState;i.centeringElement=i.centeringElement;i=bf.prototype;i.canvas=i.canvas;i.dom=i.dom;i.needRepaint=i.needRepaint;i=pf.prototype;i.addRowsAvailable=i.addRowsAvailable;i.showHiddenRows=i.showHiddenRows;i=wf.prototype;i.undo=i.undo;i.redo=i.redo;i=e.prototype;i.id=i.id;i.title=i.title;i.description=i.description;i.owner=i.owner;i.beginDate=i.beginDate;i.endDate=i.endDate;i.isMilestone=i.isMilestone;i.status=i.status;i.subtasks=i.subtasks;i.responsibles=i.responsibles;i.isUndefinedEndTime=i.isUndefinedEndTime;i.isUndefinedBeginTime=i.isUndefinedBeginTime;i=vu.prototype;i.id=i.id;i.title=i.title;i.description=i.description;i.owner=i.owner;i.tasks=i.tasks;i.beginDate=i.beginDate;i.endDate=i.endDate;i.isMilestone=i.isMilestone;i.status=i.status;i.responsibles=i.responsibles;i=df.prototype;i.id=i.id;i.title=i.title;i.description=i.description;i=yf.prototype;i.setFontFamily=i.setFontFamily};
ASC.Projects.GantChartPage=function(){var dt=null,lf=null,af=!1,tt=!1,oi=!1,si=0,hr=!1,hi=!0,vt=!0,eu=!0,gt=!1,cr=null,r={},lr=!1,ar=!1,vr=!1,yr=!1,ci=[],li=[],pr=[],e=[],a=[],vf={},ou={},t={},yf=0,pf={open:0,closed:1},it=!0,ai={},su=-1,vi=!1,ot=!1,yt="ASC.Projects.GantChartPage.enableChartEvents();",ut=0,o=1,n=null,c=null,u=[],yi=[],wf=28,bf=49,kf=200,pi,wi,st,bi,f,ht,pt,ki,wr,ft,ct,ni,w,lt,v,b,s,rt,ti,wt,di,et,gi,nr,br,h=null,hu=ASC.Projects.Resources,i=hu.ProjectsJSResource,bt=hu.ProjectsFilterResource,k=ASC.Projects.Common,df=function(){r.statusOpenTask=bt.StatusOpenTask;r.statusOpenMilestone=bt.StatusOpenMilestone;r.statusClosedMilestone=bt.StatusClosedMilestone;r.statusClosedTask=bt.StatusClosedTask;r.newTask=i.GanttNewTask;r.newMilestone=i.GanttNewMilestone;r.taskWithoutMilestones=i.GanttTaskWithoutMilestones;r.responsibles=i.GanttResponsibles;r.responsibles.format=jq.format;r.noResponsible=bt.NoResponsible;r.taskOverdueText=i.GanttTaskOverdue;r.overdue=bt.Overdue;r.taskDescSubtask=i.GanttSubtaskTaskDesc;r.taskDescSubtasks=i.GanttSubtasksTaskDesc;r.details=i.GanttTaskDetails;r.milestones=i.GanttMilestonesPrjDesc;r.activeTasks=i.GanttActiveTasksPrjDesc;r.tasks=i.GanttTasksMilDesc;r.week=i.GanttWeekShort;r.year=i.GanttYear;r.toTasksList=i.ToTaskList;r.day=i.DelayDay;r.days=i.DelayDays;r.dayShort=i.GanttDayShort;r.expand=i.GanttExpand;r.collapse=i.GanttCollapse;r.responsibles2=i.GanttLeftPanelResponsibles;r.beginDate=i.GanttLeftPanelBeginDate;r.endDate=i.GanttLeftPanelEndDate;r.status=i.GanttLeftPanelStatus;r.priotity=i.GanttLeftPanelPriority;r.highPriority=i.GanttLeftPanelHighPriority;r.openStatus=i.GanttLeftPanelOpenStatus;r.closeStatus=i.GanttLeftPanelCloseStatus;r.addDate=i.GanttLeftPanelAddDate},gf=function(){var n={menuItems:[{id:"Responsibility",title:i.GanttLeftPanelResponsibles},{id:"BeginDate",title:i.GanttLeftPanelBeginDate},{id:"EndDate",title:i.GanttLeftPanelEndDate},{id:"Status",title:i.GanttLeftPanelStatus},{id:"Priority",title:i.GanttLeftPanelPriority}]};jq("#ganttCanvasContainer").append(jq.tmpl("projects_panelFrame",{panelId:"ganttCellChecker"}));f=jq("#ganttCellChecker");f.addClass("gantt-context-menu");f.find(".panel-content").empty().append(jq.tmpl("projects_linedListWithCheckbox",n));f.append("<span id='showChoosedFields' class='button small'>"+i.ApplyBtn+"<\/span>");f.css("padding","4px 4px 0");f.find(".dropdown-item").each(function(){jq(this).css("border","none")});f.find(".dropdown-content").each(function(){jq(this).css("margin-top","0px")});f.on("click",".dropdown-item",function(n){n.stopPropagation()})},ne=function(){if(ie(),null===cr){if(cr=jq("#gantt-filter-projects"),cr){jq("#gantt-filter-projects").projectadvancedSelector({itemsChoose:pr,inPopup:!0,itemsSelectedIds:e});jq("#gantt-filter-projects").on("showList",re)}}else jq("#gantt-filter-projects").projectadvancedSelector("reset")},te=function(){localStorageManager.setItem("ganttProjects",e.join(","))},ie=function(){var u=dt,f=0,r,n,i,o;for(localStorageManager.getItem("ganttProjects")&&null===dt&&(e=localStorageManager.getItem("ganttProjects").split(","),a=localStorageManager.getItem("ganttProjects").split(",")),u&&jq.inArray(u,e)==-1&&(e.push(u),a.push(u)),localStorageManager.setItem("ganttProjects",e.join(",")),r=e.length-1;r>=0;--r)e[r]=parseInt(e[r]);for(n=e.length-1;n>=0;--n)i=t[e[n]],undefined===i&&e.splice(n,1);for(n=a.length-1;n>=0;--n)i=t[a[n]],undefined===i&&a.splice(n,1);if(eu){for(o=k.currentUserIsModuleAdmin(),n=e.length-1;n>=0;--n)i=t[e[n]],undefined!==i&&(o||(1===i.status||2===i.status)&&e.splice(n,1));for(n=a.length-1;n>=0;--n)i=t[a[n]],undefined!==i&&(o||(1===i.status||2===i.status)&&a.splice(n,1))}f=e.length;wu(0===f);0===f&&h&&h.css({display:"none"});f>0?(bu(a.shift()),gt&&ir(!1)):yu()},re=function(t,i){for(var r=0,o=i.length,f=[],u;r<o;++r)u=i[r].id,f.push(u),a.push(u);gt=!1;vt=!0;h.css({display:""});ir(!0);e=f.slice(0);te();n.modelController().clear();wu(0===a.length);ii();cu();0===a.length&&h.css({display:"none"})},cu=function(){for(var i=a.length,n=0;n<i;++n)if(prjId=a.shift(),t[prjId].dataLoaded&&!ot)gu(prjId),n==i-1&&(dr(),h.css({display:"none"}));else{bu(prjId);break}tr()},lu=function(n,t){var r=0,u=k.removeBlockedUsersFromTeam(k.excludeVisitors(n)),e=u?u.length:0,f=s.find(".dropdown-content"),i;for(f.empty(),r=0;r<e;++r)i=u[r],f.append(jq("<li class='check-value'><input type='"+t+"' id='"+i.id+"' name='responsibles'/><label for='"+i.id+"' title='"+i.displayName+"'>"+i.displayName+" <\/label><\/li>"))},ue=function(){pi=jq(".full-screen");wi=jq(".left-panel");st=jq("#zoomScale");bi=jq("#teamMemberFilter");ht=jq("#openTaskOnly");ht.prop("checked",!1);pt=jq(".fake-background");ni=jq("#parentTaskName");w=jq("#dependentTaskSelect");lt=jq("#linkTypeSelector");ki=jq("#addNewLinkPopup .save");wr=jq("#addNewLinkPopup .task-select");ft=jq("#statusListContainer");ct=jq("#statusListTaskContainer");v=jq("#taskContextMenu");b=jq("#milestoneContextMenu");rt=jq("#taskStatus");ti=jq("#milestoneStatus");wt=jq("#emptyScreenForGanttLayout");s=jq("#responsiblesContainer");di=jq("#ganttHelpPanel");et=jq("#ganttActions");gi=jq("#undoButton");nr=jq("#reduButton");br=jq("#createNewButton");et.append('<div id="btnCloseHelpActionsPanel" class="cancelButton" style="top:-1px" onclick=""><\/div>');document.onselectstart=function(){return n.isEditTitleMode()};var r=jq("#createNewButton");jq("#showGanttHelp").on("click",function(n){var t=jq(n.target?n.target:n.srcElement);di.is(":visible")?di.hide():(it=!0,n.stopPropagation(),di.show())});window.onbeforeunload=function(n){if(jq("#mainActionButtons").hasClass("disable")){var t=i.GanttOnBeforeUnloadMessage;if(typeof n=="undefined"&&(n=window.event),gt)return n&&(n.returnValue=t),t}};jq("#createNewMilestone").on("click",function(){e.length&&(p(),ASC.Projects.MilestoneAction.showNewMilestonePopup(),ASC.Projects.MilestoneAction.filterProjectsByIdInCombobox(e),r.hide())});jq("#createNewTask").on("click",function(){e.length&&(p(),ASC.Projects.TaskAction.showCreateNewTaskForm(),ASC.Projects.TaskAction.filterProjectsByIdInCombobox(e),r.hide())});gi.on("click",function(){jq(this).hasClass("disable")||jq("#mainActionButtons").hasClass("disable")||n.undoManager().undo()});nr.on("click",function(){jq(this).hasClass("disable")||jq("#mainActionButtons").hasClass("disable")||n.undoManager().redo()});jq(".print").on("click",function(){if(!jq(this).parent().hasClass("disable")){var t=rs(),n=window.open();n.document.open();n.document.write(t);n.document.close();n.focus()}});jq(".refresh").on("click",function(){kr()});jq(".scale-conteiner").on("click",".tl-combobox-container",function(){oi=!1});st.on("change",function(){if(oi)return oi=!1,!1;pu();localStorageManager.setItem("ganttZoomScale",jq(this).val())});jq("#todayPreset").on("click",function(){n&&(n.viewController().strafeToDay(),ii())});jq(".popupContainerClass .cancel").on("click",function(){return y(),jq.unblockUI(),!1});jq("#questionWindowDeleteMilestone .remove, #questionWindowTaskWithSubtasks .end").on("click",function(){return y(),n.modelController().finalize(),jq.unblockUI(),!1});jq("#questionWindowTaskRemove .remove").on("click",function(){y();tt=!0;hf({},jq(this).data("taskid"));n.modelController().finalize();jq.unblockUI()});jq("#moveTaskOutMilestone .move-all").on("click",function(){return y(),n.modelController().finalize("SaveConnections"),jq.unblockUI(),!1});jq("#moveTaskOutMilestone .one-move").on("click",function(){return y(),n.modelController().finalize(),jq.unblockUI(),!1});jq("#addFirstTask").on("click",function(){return n.addNewTask(),wt.addClass("display-none"),!1});jq("#addFirstMilestone").on("click",function(){return n.addNewMilestone(),wt.addClass("display-none"),!1});jq("#hideEmptyScreen").on("click",function(){return wt.addClass("display-none"),!1});pi.on("click",function(){jq(this).hasClass("active")||fe()});wi.on("click",function(){jq(this).hasClass("active")||ee()});jq("#hideActionsButton").on("click",function(){et.addClass("display-none");localStorageManager.setItem("hideActionHelpPlag",!0)});jq("#btnCloseHelpActionsPanel").on("click",function(){et.addClass("display-none");localStorageManager.setItem("hideActionHelpPlag",!0)});jq(document).on("keydown",function(t){var i=t.keyCode?t.keyCode:t.which?t.which:t.charCode;if(80===i&&(t.ctrlKey||t.metaKey)){t.preventDefault();jq(".print").trigger("click");return}if(!n.isEditTitleMode()&&!jq("#milestoneActionPanel").is(":visible")&&!jq("#addTaskPanel").is(":visible")){if(i==27)return wt.addClass("display-none"),!0;i!=72||vt||(et.hasClass("display-none")?(localStorageManager.setItem("hideActionHelpPlag",!1),et.removeClass("display-none").addClass("display-block")):(localStorageManager.setItem("hideActionHelpPlag",!0),et.removeClass("display-block").addClass("display-none")))}return!0});jq(".addition").on("click",".filter-container .combobox-title",function(){p()});bi.on("change",function(){});ht.on("change",function(){dr();ht.is(":checked")?localStorageManager.setItem("openTaskOnlyFilter",!0):localStorageManager.setItem("openTaskOnlyFilter",!1)});ft.on("click",".status",function(){y();ft.hide();jq(this).hasClass("underline")||n.modelController().finalizeStatus(pf.open)});jq(".gantt-context-menu").on("mouseenter",function(){p()});jq(".gantt-context-menu").on("mouseleave",function(){y()});jq(".gantt-context-menu .dropdown-item").on("click",function(t){var u=jq(this).closest(".gantt-context-menu").attr("id"),r,i;if(u=="statusList")return!0;r=jq(this).attr("class").split(" ")[0];r=="responsible"?(s.data("prjid",jq("#"+u).data("prjid")),u=="milestoneContextMenu"?er("milestone",b.data("id"),su):er("task",v.data("id")),t.stopPropagation()):(i=Number(r),n.modelController().finalizeOperation(typeof i=="number"&&i===i?i:r),jq(".gantt-context-menu").hide())});jq("body").on("click",function(n){var i=jq(n.target?n.target:n.srcElement),t=!0;return jq(".blockPage").length?!0:i.closest(".check-value").length?!0:(i.closest(".addition").length&&!i.hasClass("HelpCenterSwitcher")&&(i.closest(".tl-combobox").length?p():y(),t=!0),t&&i.parents().each(function(){jq(this).hasClass("gantt-context-menu")&&(t=!0)}),it&&!jq(".gantt-context-menu:visible").length?(it=!1,t=!1):(it=!0,t=!0),t&&(y(),vi||jq(".gantt-context-menu").hide(),vi=!1,it=!0),!0)});jq(document).on("change","#dependentTaskSelect",function(){if(jq(this).val()=="-1")return lt.text(""),!1;uf();nu()});lt.on("change",function(){nu()});ki.on("click",function(){if(!jq(this).hasClass("disable")){var t={};t.linkType=parseInt(lt.data("value"));t.linkType==2?(t.parentTaskId=parseInt(w.val(),10),t.dependenceTaskId=parseInt(ni.data("taskid"),10)):(t.parentTaskId=parseInt(ni.data("taskid"),10),t.dependenceTaskId=parseInt(w.val(),10));t.linkType==3&&(t.linkType=2);d();Teamlab.addPrjTaskLink({link:t,prjId:w.data("prjid")},t.parentTaskId,t,{success:function(t){g();jq.unblockUI();t.link.projectId=t.prjId;ff(t.link);n.modelController().addLinkWithIds(t.link)},error:uu})}});s.on("change","input",function(){s.data("changed","true")});jq("#setResponsible").on("click",function(n){if(s.data("changed")!="true")return s.data("id",""),s.hide(),!0;s.data("changed","");var i={},f,r=s.data("prjid"),e=s.data("type"),u=s.data("id");e=="task"?(i=t[r].allTaskHash[u],f=i.status,delete i.status,i.responsibles=au(),i.updRespFlag=!0,ui(i)):(i=t[r].milestonesHash[u],i.responsible=au()[0],delete i.status,i.updRespFlag=!0,fi(i));jq(".gantt-context-menu").hide();n.stopPropagation()})},tr=function(){var t,i,r;if(localStorageManager.getItem("checkedCells")){for(t=localStorageManager.getItem("checkedCells").split(","),i=0;i<t.length;i++)f.find("input[id="+t[i]+"]").prop("checked",!0);n.leftPanelController().addRowsAvailable(t);localStorageManager.getItem("visibleCells")?(r=localStorageManager.getItem("visibleCells").split(","),n.leftPanelController().showHiddenRows(r)):n.leftPanelController().showHiddenRows([])}},kr=function(){ot||(n.modelController().clear(),ot=!0,vu(!0))},y=function(){n.viewController().disableUserEvents(!1)},p=function(){n.viewController().disableUserEvents(!0)},d=function(){hr=!0;setTimeout(function(){hr&&LoadingBanner.displayLoading()},2e3);jq(".mode-button-container").addClass("disable");jq("#mainActionButtons").addClass("disable");br.css({visibility:"hidden"});n.viewController().disableUserEvents(!0)},g=function(){jq(".mode-button-container").removeClass("disable");jq("#mainActionButtons").removeClass("disable");br.css({visibility:"visible"});n.viewController().disableUserEvents(!1);hr=!1;LoadingBanner.hideLoading()},ir=function(n){n?(jq("#mainActionButtons").addClass("disable"),jq("#menuCreateNewButton").addClass("disable"),jq("#createNewButton").css({visibility:"hidden"})):(jq("#mainActionButtons").removeClass("disable"),jq("#menuCreateNewButton").removeClass("disable"),jq("#createNewButton").css({visibility:"visible"}))},fe=function(){pi.addClass("active");wi.removeClass("active");localStorageManager.setItem("ganttFullScreen",!0);n.viewController().fullscreen(!0);pt.removeClass("gray")},ee=function(){wi.addClass("active");pi.removeClass("active");localStorageManager.setItem("ganttFullScreen",!1);n.viewController().fullscreen(!1);pt.addClass("gray")},au=function(){var t=s.find("input:checked"),n=[];return t.each(function(){n.push(jq(this).attr("id"))}),n},vu=function(n){if(ASC.Projects.GantChart(window),ot=!0,ci=[],li=[],pr=[],e=[],a=[],vf={},ou={},t={},dt=jq.getURLParam("PrjID"),!n&&(ue(),se(),gf(),jq(document).find(".mainPageContent").append('<div id="block-panel" class="blocked-panel"/>'),h=jq("#block-panel"),h)){h.on("mousemove",function(n){n.preventDefault();n.stopImmediatePropagation()});h.on("mousedown",function(n){n.preventDefault();n.stopImmediatePropagation()});h.on("mouseup",function(n){n.preventDefault();n.stopImmediatePropagation()});h.on("contextmenu",function(){return!1})}h.css({display:""});ir(!0);Teamlab.bind(Teamlab.events.addPrjMilestone,function(n,t){tf(t,!0,!0)});Teamlab.getPrjProjects({reload:n},{filter:{sortBy:"",sortOrder:"",status:"",fields:"id,title,security,isPrivate,status,responsibleId"},success:function(n,t){ASC.Projects.Master.Projects=t;oe(n.reload)}})},oe=function(i){for(var u=ASC.Projects.Master.Projects,o=u.length,f=[],e=[],r=0;r<o;r++)if(t[u[r].id]=u[r],eu){if(1===u[r].status||2===u[r].status)continue;0===u[r].status&&(u[r].isInTeam?f.push(u[r]):e.push(u[r]))}if(f.length>0&&(f[f.length-1].classname="separator"),pr=f.concat(e),ne(),tr(),!i){jq(document).on("loadTasks",function(n,t){lr=!0;jq(document).trigger("loadData",{prjId:t.prjId})});jq(document).on("loadMilestones",function(n,t){ar=!0;jq(document).trigger("loadData",{prjId:t.prjId})});jq(document).on("loadGanttIndex",function(n,t){vr=!0;jq(document).trigger("loadData",{prjId:t.prjId})});jq(document).on("loadStatuses",function(n,t){yr=!0;jq(document).trigger("loadData",{prjId:t.prjId})});jq(document).on("loadData",function(i,r){if(ar&&lr&&vr&&yr){if(!r)return;t[r.prjId].dataLoaded=!0;gu(r.prjId);hi&&yu();a.length==0?(dr(),n.viewController().loadViewState(!0),ot=!1,tr(),h.css({display:"none"})):cu()}})}},se=function(){(df(),window.Gantt.Teamlab_shortmonths=Teamlab.constants.nameCollections.shortmonths,window.Gantt.Teamlab_months=Teamlab.constants.nameCollections.months,window.Gantt.Localize_strings=r,u.push(document.getElementById("layer0")),u.push(document.getElementById("layer1")),u[ut]&&u[o])&&(yi.push(u[ut].getContext("2d")),yi.push(u[o].getContext("2d")),yi[ut]&&yi[o])&&(u[o].onselectstart=function(){return!1},u[o].onmousedown=function(){return!1},u[o].oncontextmenu=function(){return!1},n=new Gantt.TimeLine(u[ut],u[o]),localStorageManager.getItem("ganttZoomScale")&&st.val(localStorageManager.getItem("ganttZoomScale")),st.tlcombobox(),pu(),rr(),n.viewController().strafeToDay(),gr())},yu=function(){localStorageManager.getItem("hideActionHelpPlag")||vt||et.removeClass("display-none").addClass("display-block");he();n.userDefaults().setFontFamily(jq("body").css("fontFamily"));n.update();n.viewController().enableSlipAnimation(!0);le();po();localStorageManager.getItem("openTaskOnlyFilter")?ht.prop("checked",!0):ht.prop("checked",!1);tr();hi=!1},pu=function(){var t=parseInt(st.val());t===1?n.viewController().scaleTo(wf,undefined,!0):t===7?n.viewController().scaleTo(bf,undefined,!0):t===4&&n.viewController().scaleTo(kf,undefined,!0)},he=function(){gt&&(jq("#menuCreateNewButton").removeClass("disable"),vt=!1)},wu=function(t){wt.css({display:t?"block":"none"});n.needDrawFlashBackground(t)},fs=function(){if(hi)return!1;var n="Projects.aspx",t=jq.getURLParam("prjID");t&&Teamlab.getPrjTeam({},t,{success:function(t,i){ASC.Projects.Master.TeamWithBlockedUsers=i;ASC.Projects.Master.Team=k.removeBlockedUsersFromTeam(ASC.Projects.Master.TeamWithBlockedUsers);var r=k.userInProjectTeam(Teamlab.profile.id);lf.isPrivate&&!r&&(document.location=n);!r||r.canReadTasks&&r.canReadMilestones||(document.location=n)}})},bu=function(n){LoadingBanner.displayLoading();lr=!1;ar=!1;vr=!1;var i=k.filterParamsForListTasks;delete i.status;i.projectId=n;Teamlab.getPrjTasksSimpleFilter({prjId:n},{filter:i,success:function(n,i){t[n.prjId].tasks=i;jq(document).trigger("loadTasks",[{prjId:n.prjId}])}});Teamlab.getPrjMilestones({prjId:n},{filter:i,success:function(n,i){t[n.prjId].milestones=i;jq(document).trigger("loadMilestones",[{prjId:n.prjId}])}});Teamlab.getPrjGanttIndex({prjId:n},n,{success:function(n,i){t[n.prjId].ganttIndex=typeof i=="string"?JSON.parse(i):{};jq(document).trigger("loadGanttIndex",[{prjId:n.prjId}])},error:function(n){t[n.prjId].ganttIndex={};jq(document).trigger("loadGanttIndex",[{prjId:n.prjId}])}});yr||ASC.Projects.Common.initCustomStatuses(function(){jq(document).trigger("loadStatuses",[{prjId:n}])});dt&&dt==n?t[n].team=ASC.Projects.Master.Team:Teamlab.getPrjTeam({prjId:n},n,{success:function(n,i){t[n.prjId].team=i}})},dr=function(){y();var i={};i.status=ht.prop("checked")?!0:undefined;i.participant=bi.val()!="-1"?bi.val():undefined;af=!0;n.modelController().setFilter(function(n){var r=n.owner();n.isMilestone()?n.filter=i.status&&n.status()==1?!0:!1:ce(i,n)?(n.filter=!1,t[r].allTaskHash[n.id()].visible=!0):(n.filter=!0,t[r].allTaskHash[n.id()].visible=!1)})},ce=function(n,i){var e=!1,r=!1,u,f;if((!n.status||n.status&&i.status()==1)&&(e=!0),!n.participant)return r=!0,e&&r;if(u=t[i.owner()].allTaskHash[i.id()].responsibles,n.participant&&u.length)for(f=0;f<u.length;f++)if(n.participant==u[f].id){r=!0;break}return n.participant=="00000000-0000-0000-0000-000000000000"&&u.length==0&&(r=!0),e&&r},le=function(){document.onmousemove=function(t){n.onmousemove(t)};document.onkeypress=function(t){if(h&&"none"===h.css("display"))n.onkeypress(t)};document.onkeydown=function(t){if(h&&"none"===h.css("display"))n.onkeydown(t)};document.onkeyup=function(t){return h&&"none"===h.css("display")?n.onkeyup(t):!1};document.onmouseup=function(t){n.focus(!1,t)};document.onpaste=function(t){n.onpaste(t)};document.oncopy=function(t){n.oncopy(t)};window.onresize=function(){rr();ii();n.render()};u[o].onmousemove=function(t){n.onmousemove(t)};u[o].onmousedown=function(t){n.onmousedown(t)};u[o].onmouseup=function(t){n.onmouseup(t)};u[o].ondblclick=function(t){n.ondblclick(t)};is();u[o].addEventListener?"onwheel"in u[o]?(u[o].addEventListener("wheel",or,!1),u[o].addEventListener("wheel",function(n){return n.preventDefault(),!1},!1)):"onmousewheel"in u[o]?(u[o].addEventListener("mousewheel",or,!1),u[o].addEventListener("mousewheel",function(n){return n.preventDefault(),!1},!1)):u[o].addEventListener("MozMousePixelScroll",or,!1):(u[o].attachEvent("onmousewheel",or),u[o].addEventListener("onmousewheel",function(){return!1},!1));jq(".left-panel").on("mousewheel DOMMouseScroll",function(){jq(".advanced-selector-container ").first().css({display:"none"});v.is(":visible")&&v.hide()});c=n.viewController().buildZoomBar(document.getElementById("ganttChartZoom"));rr();gr();n.update();n.viewController().toVisibleElementMove();ii();rr();window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/15)}}();ku()},ku=function(){requestAnimFrame(ku);gr()},gr=function(){n.render()},du=!0,rr=function(){var t=window.innerWidth-48,f=pt.position().top,i=window.innerHeight-f,r=parseInt(jq(".mainPageLayout").first().css("min-width"),10);t=t>r?t:r;(u[ut].width!=t||u[ut].height!=i)&&(u[ut].width=t,u[ut].height=i,u[o].width=t,u[o].height=i,n.update());c&&c.canvas()&&(c.canvas().width!=c.dom().clientWidth||c.canvas().height!=c.dom().clientHeight)&&(c.canvas().width=c.dom().clientWidth,c.canvas().height=c.dom().clientHeight,c.needRepaint());du&&(ii(),du=!1)},ii=function(){var n=window.innerWidth-48,u=pt.position().top,f=window.innerHeight-u,r=parseInt(jq(".mainPageLayout").first().css("min-width"),10),i,t;n=n>r?n:r;pt.height(f);i=169;t=n-jq("#mainActionButtons").width()-jq(".zoom-presets").outerWidth()-i;jq("#ganttChartZoom").width(t);hi&&(jq("#ganttChartZoom").css("border","1px solid #ccc"),jq("#ganttChartZoom").css("backgroundColor","#fff"));i=192;t=jq(".filter-container").width()-jq(".mode-button-container").width()-jq(".task-filter-container:first").outerWidth()-jq(".task-filter-container:last").outerWidth();jq(".task-filter-container .tl-combobox").css({maxWidth:t});jq("#ZoomBarId").is("canvas")&&(jq("#ZoomBarId").width(jq("#ganttChartZoom").width()),c&&(c.canvas().width=c.dom().clientWidth,c.canvas().height=c.dom().clientHeight,c.needRepaint()))},gu=function(i){var r=t[i];ae(r);pe(r);ye(r);n.modelController().buildWithThroughIndexer();LoadingBanner.hideLoading()},ae=function(t){var c=t.title,o=t.id,r="",l=t.created?new Date(t.created):new Date,a=t.ganttIndex,s=window.UserManager.getUser(t.responsibleId)||window.UserManager.getRemovedProfile(t.responsibleId),i,h,u,f;s?(t.responsible=s,r=t.responsible):undefined!==t.responsible&&undefined!==t.responsible.displayName&&(r=t.responsible);i=!1;(k.currentUserIsModuleAdmin()||t.responsible.id==Teamlab.profile.id)&&(i=!0);Teamlab.profile.isVisitor&&(i=!1);h=1e3;u=t.status;i||(u=h);i?(gt=!0,vt=!1,ir(!1)):(f=e.indexOf(o),-1!==f&&e.splice(f,1));n.modelController().addProject(o,c,"",r,l,a,t.isPrivate,u)},kt=function(n){return n.setHours(0),n.setMilliseconds(0),n.setMinutes(0),n.setSeconds(0),n},nf=function(n){for(var r=n.length,i=[],t=0;t<r;++t)i.push(window.UserManager.getUser(n[t])||window.UserManager.getRemovedProfile(n[t]));return i},ve=function(i,r,u){var c=[],it=i.title,rt=i.description,p=i.deadline,s=kt(i.crtdate),w=i.startDate,ut=i.priority,ft=i.customTaskStatus,et=i.createdBy,b=i.status,l=i.projectOwner,ot=i.subtasksCount?i.subtasksCount:0,k,e,f,a=[],d=-1,g=!1,v=i.id,y,h,tt,o;if(i.responsibles.length){if("string"==typeof i.responsibles[0])a=nf(i.responsibles);else{for(y=[],h=0;h<i.responsibles.length;++h)y.push(i.responsibles[h].id);a=nf(y)}k=Encoder.htmlDecode(i.responsibles[0].displayName)}if(i.milestoneId&&(d=i.milestoneId),f=undefined,p?f=new Date(p):b==2&&i.uptdate&&(f=new Date(i.uptdate)),f&&(f=kt(f)),e=undefined,w?e=kt(w):(f&&s<=f&&(e=kt(s)),f&&s>f&&(e=f),g=!0),e||(e=kt(s)),tt=2,c=[],i.links)for(o=0;o<i.links.length;++o)i.links[o].parentTaskId!==v&&tt===i.links[o].linkType&&c.push(i.links[o]);"number"==typeof i.projectOwner?l=i.projectOwner:"object"!=typeof i.projectOwner||isNaN(i.projectOwner.id)||(l=i.projectOwner.id);n.modelController().addTask(v,l,it,k,rt,e,f,b,ft,d,ut,ot,a,c,u,g,et);r&&(t[i.projectId].allTaskHash[i.id]=i,t[i.projectId].allTaskHash[i.id].visible=!0,t[i.projectId].taskCount++,nt(i.projectId),n.update(),n.viewController().disableUserEvents(!1),n.viewController().centeringElement(v))},tf=function(i,r,u){if(i){var f=i.id,e=i.title,o=i.description,s=kt(i.deadline),h="";i.responsible&&(h=Encoder.htmlDecode(i.responsible.displayName));var c=i.projectId,l=i.isKey,a=i.status;n.modelController().addMilestone(f,c,e,o,i.responsible,new Date(s),a,l,u)}r&&(t[i.projectId].milestonesHash[i.id]=i,t[i.projectId].milestoneCount++,nt(i.projectId),n.update(),n.viewController().disableUserEvents(!1),n.viewController().centeringElement(f,!0))},ye=function(n){var t,i;if(0===n.status)for(ci=n.tasks.slice(0),n.taskCount=ci.length,n.allTaskHash||(n.allTaskHash={}),i=0;i<n.taskCount;i++)t=ci[i],n.allTaskHash[t.id]?t=n.allTaskHash[t.id]:(n.allTaskHash[t.id]=t,n.allTaskHash[t.id].visible=!0),ve(t)},pe=function(n){var t,i;if(0===n.status)for(n.milestonesHash||(n.milestonesHash={}),li=n.milestones.slice(0),n.milestoneCount=li.length,i=0;i<n.milestoneCount;i++)t=li[i],n.milestonesHash[t.id]?t=n.milestonesHash[t.id]:n.milestonesHash[t.id]=t,tf(t)},at=function(n,i){var r={title:n.title()?n.title():""},f,u;if(r.description=n.description()?n.description():"",i){for(r.id=n.id(),r.responsibles=[],f=n.responsibles(),u=0;u<f.length;u++)r.responsibles.push(f[u].id);r.priority=t[n.owner()].allTaskHash[r.id].priority}return n.beginDate()&&(r.startDate=Teamlab.serializeTimestamp(n.beginDate())),n.isUndefinedBeginTime()&&(r.startDate=undefined),n.isUndefinedEndTime()?r.deadline=undefined:n.endDate()&&(r.deadline=Teamlab.serializeTimestamp(n.endDate())),n.owner()&&(r.projectId=n.owner()),r.milestoneId=n.milestone,r},ur=function(n,i){var r={title:n.title()?n.title():""};return r.description=n.description()?n.description():"",i?(r.id=n.id(),r.isKey=t[n.owner()].milestonesHash[r.id].isKey,r.responsible=n.responsibles()):r.responsible=t[n.owner()].responsibleId,r.deadline=Teamlab.serializeTimestamp(n.endDate()),n.owner&&(r.projectId=n.owner()),r},we=function(n){p();n.links.length?jq("#noteAboutLinks").removeClass("display-none"):jq("#noteAboutLinks").addClass("display-none");PopupKeyUpActionProvider.CloseDialogAction=yt;StudioBlockUIManager.blockUI(jq("#questionWindowTaskRemove"),400);PopupKeyUpActionProvider.EnterAction="jq('#questionWindowTaskRemove .remove').trigger('click');";jq("#questionWindowTaskRemove .remove").data("taskid",n.id())},be=function(n){p();PopupKeyUpActionProvider.CloseDialogAction=yt;StudioBlockUIManager.blockUI(jq("#questionWindowDeleteMilestone"),400);PopupKeyUpActionProvider.EnterAction="jq('#questionWindowDeleteMilestone .remove').trigger('click');";jq("#questionWindowDeleteMilestone").attr("milestoneId",n)},ke=function(n){p();PopupKeyUpActionProvider.CloseDialogAction=yt;StudioBlockUIManager.blockUI(jq("#questionWindowTaskWithSubtasks"),"auto");PopupKeyUpActionProvider.EnterAction="jq('#questionWindowTaskWithSubtasks .end').trigger('click');";jq("#questionWindowTaskWithSubtasks .end").data("taskid",n)},rf=function(){p();PopupKeyUpActionProvider.CloseDialogAction=yt;StudioBlockUIManager.blockUI(jq("#questionWindowMilestoneTasks"),400);PopupKeyUpActionProvider.EnterAction="jq('#questionWindowMilestoneTasks .cancel').trigger('click');"},de=function(){p();PopupKeyUpActionProvider.CloseDialogAction=yt;StudioBlockUIManager.blockUI(jq("#moveTaskOutMilestone"),"auto");PopupKeyUpActionProvider.EnterAction="jq('#moveTaskOutMilestone .cancel').trigger('click');"},ge=function(n){no(n)?(p(),PopupKeyUpActionProvider.CloseDialogAction=yt,StudioBlockUIManager.blockUI(jq("#addNewLinkPopup"),400)):k.displayInfoPanel(i.GanttNotAvailableTaskLink,!0)},no=function(n){var o,s=!1,u=-1,f=t[n.owner()],e=f.allTaskHash[n.id()],i,r;ni.text(e.title).data("taskid",e.id);r=w.find("option:first");w.remove();wr.find(".tl-combobox-container").remove();wr.append("<select id='dependentTaskSelect'><\/select>");w=jq("#dependentTaskSelect");for(o in f.allTaskHash)i=f.allTaskHash[o],i.visible&&to(e,i)&&(r=document.createElement("option"),r.setAttribute("value",i.id),r.appendChild(document.createTextNode(i.title)),w.append(r),-1===u&&(u=i.id,s=!0));return-1!==u&&(w.data("prjid",f.id),w.val(u+"").tlcombobox(),lt.text(""),uf(),nu()),s},to=function(n,t){var r=0,i;if(t.id==n.id||t.status==2||t.milestoneId!=n.milestoneId||!t.deadline&&!n.deadline)return!1;if(n.links&&(r=n.links.length),r>0)for(i=0;i<r;i++)if(n.links[i].parentTaskId==t.id||n.links[i].dependenceTaskId==t.id)return!1;return!0},uf=function(){var u=w.data("prjid"),n=t[u].allTaskHash[ni.data("taskid")],r=t[u].allTaskHash[w.val()],f=n.startDate?n.startDate:n.crtdate,e=r.startDate?r.startDate:r.crtdate,o=n.deadline?n.deadline:undefined,s=r.deadline?r.deadline:undefined,h=k.getPossibleTypeLink(f,o,e,s,{});h[2]==k.linkTypeEnum.start_end?lt.text(i.RelatedLinkTypeSE).data("value",k.linkTypeEnum.start_end):lt.text(i.RelatedLinkTypeES).data("value",k.linkTypeEnum.end_start)},nu=function(){w.val()!="-1"?ki.removeClass("disable"):ki.addClass("disable")},ff=function(n){var i=t[n.projectId];i.allTaskHash[n.parentTaskId].links?i.allTaskHash[n.parentTaskId].links.push(n):i.allTaskHash[n.parentTaskId].links=[n];i.allTaskHash[n.dependenceTaskId].links?i.allTaskHash[n.dependenceTaskId].links.push(n):i.allTaskHash[n.dependenceTaskId].links=[n]},ef=function(n,t){return n.parentTaskId==t.parentTaskId&&n.dependenceTaskId==t.dependenceTaskId?!0:n.parentTaskId==t.dependenceTaskId&&n.dependenceTaskId==t.parentTaskId},io=function(n){d();Teamlab.addPrjTask({},n.projectId,n,{success:ro,error:fr})},ro=function(i,r){t[r.projectId].allTaskHash[r.id]=r;t[r.projectId].allTaskHash[r.id].visible=!0;n.modelController().applyNewAddTaskId(r.id);t[r.projectId].taskCount++;nt(r.projectId)},ri=function(n,i,r){var u,e,f;for(d(),u=0,e=i.length;u<e;u++)f={},f.newMilestoneID=n,Teamlab.updatePrjTask({links:r},i[u],f,{success:function(n,i){if(t[i.projectId].allTaskHash[i.id]=i,nt(i.projectId),n.links)for(var r=0;r<n.links.length;++r)iu(n.links[r].link)},error:fr})},fr=function(){g()},ui=function(n,t){d();t=t||{};n.updRespFlag&&(t.updRespFlag=!0);Teamlab.updatePrjTask(t,n.id,n,{success:uo,error:fr})},sf=function(n){var t,i=n.length;if(i)for(d(),si=i,t=0;t<i;t++)Teamlab.updatePrjTask({},n[t].id,n[t],{success:fo,error:fr})},uo=function(i,r){i.status&&(y(),ct.hide(),ct.data("id",""),jq(this).hasClass("underline")||n.modelController().finalizeStatus(r.status));var u=t[r.projectId].allTaskHash[r.id].visible;t[r.projectId].allTaskHash[r.id]=r;t[r.projectId].allTaskHash[r.id].visible=u;i.updRespFlag&&n.modelController().finalizeOperation("responsible",r.responsibles);nt(r.projectId)},fo=function(n,i){si=si-1;t[i.projectId].allTaskHash[i.id]=i;si==0&&nt(i.projectId)},hf=function(n,t){d();Teamlab.removePrjTask(n,t,{success:eo,error:oo})},eo=function(n,i){delete t[i.projectId].allTaskHash[i.id];t[i.projectId].taskCount--;nt(i.projectId)},oo=function(){},so=function(n,t){d();var i=n.projectId;Teamlab.addPrjMilestone({tasksIds:t},i,n,{success:co,error:tu})},fi=function(n,t){d();var i={},r={tasks:t,milestoneId:n.id};t||typeof n.status=="undefined"?(i=n,n.updRespFlag&&(r.updRespFlag=!0)):i.status=n.status;Teamlab.updatePrjMilestone(r,n.id,i,{success:ho,error:tu})},ho=function(i,r){var f,s,e=t[r.projectId],h=e.milestonesHash[r.id],u=i.tasks,o=[];if(h.deadline>r.deadline&&u){for(s=u.length,f=0;f<s;++f)e.allTaskHash[u[f].id()].deadline>r.deadline&&e.allTaskHash[u[f].id()].status==1&&(u[f].milestone=i.milestoneId,o.push(at(u[f],!0)));sf(o)}u&&u.length&&o.length||g();e.milestonesHash[r.id]=r;i.updRespFlag&&n.modelController().finalizeOperation("responsible",r.responsible)},co=function(i,r){t[r.projectId].milestonesHash[r.id]=r;i.tasksIds&&ri(r.id,i.tasksIds);n.modelController().applyNewAddMilestoneId(r.id,r.responsible);t[r.projectId].milestoneCount++;nt(r.projectId)},tu=function(){ot=!0;kr();rf();g()},lo=function(n){d();Teamlab.removePrjMilestone(n,{success:ao,error:tu})},ao=function(n,t){delete ou[t.id];yf--;nt(t.projectId)},iu=function(n){d();Teamlab.addPrjTaskLink({link:n},n.parentTaskId,n,{success:vo,error:uu})},ru=function(n){d();var t={dependenceTaskId:n.dependenceTaskId,parentTaskId:n.parentTaskId};Teamlab.removePrjTaskLink({link:n},n.dependenceTaskId,t,{success:yo,error:uu})},vo=function(n){ff(n.link);g()},uu=function(n,t){t[0]!="link already exist"&&(ot=!0,kr(),ASC.Projects.Base.showCommonPopup("createNewLinkError",y,y),g())},yo=function(n){var i,u,r=n.link,f,e=t[r.projectId].allTaskHash[r.parentTaskId],o=t[r.projectId].allTaskHash[r.dependenceTaskId];if(e.links&&o.links){for(f=e.links.length,i=0,u=f;i<u;++i)if(ef(e.links[i],r)){e.links.splice(i,1);break}for(f=o.links.length,i=0,u=f;i<u;++i)if(ef(o.links[i],r)){o.links.splice(i,1);break}g()}},nt=function(i){if(!tt){g();return}t[i].ganttIndex=n.modelController().throughIdsIndexes(i);var r={};r.id=i;r.order=JSON.stringify(t[i].ganttIndex);Teamlab.setPrjGanttIndex({},i,r,{success:function(){g()},error:function(){g()}});tt=!1},po=function(){var e=-10,o=10,v=0,y=1,c=2,w=40,l=100,h=-1,b=10,k=20;n.addHandler("101",function(n,t,i,r){tt=!0;r.milestone=t;var u=at(r);u.projectId||(u.projectId=n);io(u)});n.addHandler("111",function(n,t,i){tt=!0;hf({},i)});n.addHandler("270",function(t){var i={};i.parentTaskId=t.task.id();i.dependenceTaskId=t.parent.id();i.linkType=c;i.projectId=t.task.owner();e===t.parentSide&&o===t.side?i.linkType=c:e===t.parentSide&&e===t.side?i.linkType=v:o===t.parentSide&&o===t.side&&(i.linkType=y);iu(i);n.modelController().finalize()});n.addHandler("280",function(t,i){t.projectId=i.owner();ru(t);n.modelController().finalize()});n.addHandler("140",function(t,i){t.projectId=i.owner();iu(t);n.modelController().finalize()});n.addHandler("145",function(t,i){t.projectId=i.owner();ru(t);n.modelController().finalize()});n.addHandler("350",function(n){ge(n)});n.addHandler("112",function(n,t,i){tt=!0;lo(i.id())});n.addHandler("102",function(n,t,i){var f,e,r,u;for(tt=!0,f=i.tasks(),e=[],r=0;r<f.length;++r)e.push(f[r].id());u=ur(i);u.projectId||(u.projectId=n);so(u,e)});n.addHandler("121",function(n,t,i,r){r.milestone=t;ui(at(r,!0))});n.addHandler("122",function(n,t,i){fi(ur(i,!0))});n.addHandler("123",function(n,t,i,r,u){var e,f;if(r.isMilestone())fi(ur(r,!0),r.tasks());else if(e=[],r.milestone=t,u){for(e.push(at(r,!0)),f=0;f<u.length;++f)u[f].change&&(u[f].milestone=t,e.push(at(u[f],!0)));sf(e)}else ui(at(r,!0))});n.addHandler("124",function(n,t,i,r){r.milestone=t;var u=at(r,!0);u.status=r.status();u.statusId=r.customTaskStatus();ui(u,{status:!0})});n.addHandler("125",function(n,t,i){var r={};r.id=t;r.status=i.status();fi(r)});n.addHandler("130",function(n,t,i,r,u,f,e,o){if(tt=!0,!t&&!u){nt(n);return}if(o)ri(t,[i],e);else{if(e)for(var s=0;s<e.length;++s)ru(e[s].link);ri(u,[i])}});n.addHandler("150",function(n,t){tt=!0;n?ri(n,t):ri(0,t)});n.addHandler("300",function(){de()});n.addHandler("UndoRedoUI",function(n,t){n?gi.removeClass("disable"):gi.addClass("disable");t?nr.removeClass("disable"):nr.addClass("disable")});n.addHandler("200",function(n,t,i,r){we(r)});n.addHandler("220",function(n,t){be(t)});n.addHandler("240",function(t,i,r,u,f){if(u.subtasks().length&&u.status()!=2)for(var e=0;e<u.subtasks().length;e++)if(u.subtasks()[e].status==1){ke(u);return}n.modelController().finalize(f)});n.addHandler("260",function(t,i,r){var f=r.tasks(),u;if(f.length&&r.status()!=1)for(u=0;u<f.length;u++)if(f[u].status()==1){rf();return}n.modelController().finalize()});n.addHandler("500",function(n,t){var n=n||{};bo(n,t)});n.addHandler("501",function(n,t){var n=n||{};ko(n,t)});n.addHandler("502",function(n,t,i,r){vt||(ai=n,su=r,i?go(t,n):ns(t,n))});n.addHandler("503",function(n,t,i){ai=t;i||s.data("id","");s.data("prjid",n.owner());n.isMilestone()?er("milestone",n.id()):er("task",n.id());vi=undefined===i?!0:!1});n.addHandler("160",function(n){var i,u,r;if(n.isMilestone())fi(ur(n,!0));else{for(i=t[n.owner()].allTaskHash[n.id()],u=n.responsibles(),r=0;r<u.length;r++)i.responsibles.push(u[r].id);delete i.status;ui(i)}});n.viewController().onchangetimescale=function(n){var t=-1;t=w<n&&n<=l?7:n>l?4:1;t!==h&&(h=t,wo(h))};n.viewController().onshowhint=function(n,t,i){t?b===n?cf("collapse",i):k===n&&cf("expand",i):jq(".gantt-hint").hide()};var g=f.height(),r=!1,u=function(t){var e,o,i,u,h,s;if(r){for(e=t.toElement,t.currentTarget&&(e=t.currentTarget),o=e.id,i=localStorageManager.getItem("checkedCells").split(","),i.splice(i.indexOf(o),1),e.checked?i.splice(0,0,o):i.push(o),localStorageManager.setItem("checkedCells",i.join(",")),u=[],h=f.find("input:checked"),s=0;s<h.length;s++)u.push(jq(h[s]).attr("id"));localStorageManager.getItem("visibleCells")&&0!==localStorageManager.getItem("visibleCells").length&&u.push.apply(u,localStorageManager.getItem("visibleCells").split(","));n.leftPanelController().addRowsAvailable(i);n.leftPanelController().showHiddenRows(u);localStorageManager.setItem("visibleCells",u.join(",")+","+localStorageManager.getItem("visibleCells"));f.hide()}},d=function(){var o;if(!r){var t=0,e=[],i=[],u=[];for(localStorageManager.getItem("checkedCells")&&0!==localStorageManager.getItem("visibleCells").length&&(i=localStorageManager.getItem("checkedCells").split(",")),localStorageManager.getItem("visibleCells")&&0!==localStorageManager.getItem("visibleCells").length&&(u=localStorageManager.getItem("visibleCells").split(",")),o=f.find("input:checked"),t=0;t<o.length;t++)e.push(jq(o[t]).attr("id"));for(t=i.length-1;t>=0;--t)-1==e.indexOf(i[t])&&i.splice(t,1);for(t=u.length-1;t>=0;--t)-1==i.indexOf(u[t])&&u.splice(t,1);if(0===o.length)u=[],i=[];else{for(t=e.length-1;t>=0;--t)-1!==i.indexOf(e[t])&&e.splice(t,1);i=e.concat(i);u=e.concat(u)}n.leftPanelController().addRowsAvailable(i);n.leftPanelController().showHiddenRows(u);localStorageManager.setItem("checkedCells",i.join(","));localStorageManager.setItem("visibleCells",u.join(","));f.hide()}},a=function(n){var r={menuItems:[{id:"Responsibility",title:i.GanttLeftPanelResponsibles},{id:"BeginDate",title:i.GanttLeftPanelBeginDate},{id:"EndDate",title:i.GanttLeftPanelEndDate},{id:"Status",title:i.GanttLeftPanelStatus},{id:"Priority",title:i.GanttLeftPanelPriority}]},e,t,o;if(f=jq("#ganttCellChecker"),n)for(e=!1,t=0;t<r.menuItems.length;++t){for(e=!1,o=0;o<n.length;++o)if(n[o]===r.menuItems[t].id){e=!0;break}e||(r.menuItems.splice(t,1),--t)}f.find(".panel-content").empty().append(jq.tmpl("projects_linedListWithCheckbox",r));f.find("input").css("display",n?"none":"");f.find(".dropdown-item").each(function(){jq(this).css("border","none")});f.find(".dropdown-content").each(function(){jq(this).css("margin-top","0px")});f.addClass("gantt-context-menu").css("width","auto");jq("#Responsibility").on("click",function(n){u(n)});jq("#BeginDate").on("click",function(n){u(n)});jq("#EndDate").on("click",function(n){u(n)});jq("#Status").on("click",function(n){u(n)});jq("#Priority").on("click",function(n){u(n)})};jq("#showChoosedFields").on("click",function(n){d(n)});n.leftPanelController().onfieldsfilter=function(n,t,i,u,e){var o,s,h;if(localStorageManager.setItem("checkedCells",e.join(",")),t){if(o=[],localStorageManager.getItem("visibleCells")&&0!==localStorageManager.getItem("visibleCells").length&&(o=localStorageManager.getItem("visibleCells").split(",")),o.length){for(s=o.length-1;s>=0;--s)-1===e.indexOf(o[s])&&o.splice(s,1);localStorageManager.setItem("visibleCells",o.join(","))}return}if(f.is(":visible")&&!r){f.hide();return}for(it=!0,p(),n.preventDefault?n.preventDefault():n.returnValue&&(n.returnValue=!1),n.stopPropagation&&n.stopPropagation(),a(undefined),jq(".gantt-context-menu").hide(),f.css({overflow:"hidden",left:i-20,top:u,height:"auto"}),f.find("input").prop("checked",!1),h=0;h<e.length;h++)f.find("input[id="+e[h]+"]").prop("checked",!0);jq("#showChoosedFields").css({display:""});r=!1;f.show()};n.leftPanelController().onhiddenfieldsfilter=function(n,t,i,u,e,o){if(localStorageManager.setItem("visibleCells",o.join(",")),!t){if(f.is(":visible")&&r){f.hide();return}it=!0;p();n.preventDefault?n.preventDefault():n.returnValue&&(n.returnValue=!1);n.stopPropagation&&n.stopPropagation();a(e);jq(".gantt-context-menu").hide();f.css({overflow:"hidden",left:i-20,top:u,height:"auto"});jq("#showChoosedFields").css({display:"none"});f.find("input").prop("checked",!1);for(var s=0;s<e.length;s++)f.find("input[id="+e[s]+"]").prop("checked",!1);r=!0;f.show()}};n.leftPanelController().onchangetimes=function(n,t,i){us(!0,n,t,i)}},wo=function(n){var i=jq(".zoom-presets .combobox-title-inner-text"),t=st.val();t!=n&&(oi=!0,st.val(n).trigger("change"),localStorageManager.setItem("ganttZoomScale",n))},cf=function(n,t){var i=jq(".gantt-hint");i.length||(jq("body").append("<div class='gantt-hint'><\/div>"),i=jq(".gantt-hint"));n=="expand"?i.text(r.expand):i.text(r.collapse);i.css({left:t.left-10,top:t.top+10});i.show()},bo=function(n,t){if(ft.data("id")==n.id())return ft.data("id",""),!0;ft.data("id",n.id());ei(ft,t.left-10,t.top-1)},ko=function(n,t){var i,o,r;if(ct.data("id")==n.id())return ct.data("id",""),!0;if(n.isTask){var u=ASC.Projects.Master,f=u.customStatuses.filter(function(n){return typeof n.available!="undefined"&&n.available===!1}),e=Teamlab.profile.id;for(i=0;i<f.length;i++)o=f[i].id,r=ft.find("li[dataid="+o+"]"),n.createdBy===e||n.project.responsibles().id===e||u.isModuleAdmin?r.show():r.hide()}ct.data("id",n.id());ei(ct,t.left-10,t.top-1)},go=function(n,i){if(v.is(":visible")&&v.data("id")==n.id())return v.hide(),!0;var r=t[n.owner()].allTaskHash[n.id()];v.data("id",r.id);v.data("prjid",n.owner());r.status==2?(v.find(".edit").hide(),v.find(".addlink").hide(),jq("#taskResponsible").hide(),rt.removeAttr("class").addClass("-1 open dropdown-item"),rt.text(rt.data("opentext"))):(v.find(".edit").show(),v.find(".addlink").show(),jq("#taskResponsible").show(),rt.removeAttr("class").addClass("-2 closed dropdown-item"),rt.text(rt.data("closetext")));ei(v,i.left,i.top)},ns=function(n,i){if(b.is(":visible")&&b.data("id")==n.id())return b.hide(),!0;var r=t[n.owner()].milestonesHash[n.id()];b.data("id",r.id);b.data("prjid",n.owner());r.status==1?(b.find(".edit").hide(),b.find(".addMilestoneTask").hide(),jq("#milestoneResponsible").hide(),ti.removeAttr("class").addClass("open dropdown-item"),ti.text(rt.data("opentext"))):(b.find(".edit").show(),b.find(".addMilestoneTask").show(),jq("#milestoneResponsible").show(),ti.removeAttr("class").addClass("closed dropdown-item"),ti.text(rt.data("closetext")));ei(b,i.left,i.top)},er=function(n,i){var r,f,u;if(s.data("id")==i)return s.data("id",""),!0;for(r={},f=s.data("prjid"),s.data("id",i),s.data("type",n),n=="task"?(lu(t[f].team,"checkbox"),r=t[f].allTaskHash[i].responsibles):(lu(t[f].team,"radio"),r=[t[f].milestonesHash[i].responsible]),u=0;u<r.length;u++)r[u].id?jq("#"+r[u].id).prop("checked",!0):jq("#"+r[u]).prop("checked",!0);ei(s,ai.left,ai.top)},ei=function(n,t,i){jq(".gantt-context-menu").hide();ts(n,t,i);it=!0;document.getElementById(n.attr("id")).oncontextmenu=function(){return!1};n.show()},ts=function(n,t,i){var r=window.innerWidth,e=window.innerHeight,u=n.outerWidth(),f=n.outerHeight();r-t<u&&(t=r-u-14);e-i<f&&(i=i-f-16);n.css({left:t,top:i})},or=function(t){jq(".gantt-context-menu").hide();it=!0;n.onmousewheel(t);n.update();jq(".advanced-selector-container ").first().css({display:"none"})},sr=function(t){var f=t.changedTouches,i=f[0],r="",u;switch(t.type){case"touchstart":r="mousedown";break;case"touchmove":r="mousemove";break;case"touchend":r="mouseup";break;default:return}n.setEnableTouch(!0);u=document.createEvent("MouseEvent");u&&(u.initMouseEvent(r,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(u));t.preventDefault()},is=function(){document.addEventListener("touchstart",sr,!0);document.addEventListener("touchmove",sr,!0);document.addEventListener("touchend",sr,!0);document.addEventListener("touchcancel",sr,!0)},rs=function(){var r,i,t;return n.print(),r=u[0].toDataURL(),i="javascript:window.print();",jq.browser.opera||(i+=" window.close();"),t="<!DOCTYPE html>",t+="<html>",t+="<head>",t+="<title>"+document.title+"<\/title>",t+="<style>@media print{img{height:90%;} @page { size: landscape; }}<\/style>",t+="<\/head>",t+='<body style="margin:0;padding:0;" onload="'+i+'">',t+='<img src="'+r+'">',t+="<\/body>",t+"<\/html>"},l=null,fu,us=function(t,i,r,u){fu=u;null===l&&(l=document.createElement("input"),l&&(l.id="datepicker-chart",l.style.color="transparent",l.style.border="none",l.style.position="absolute",l.style.zIndex=100,l.style.width="0px",l.style.height="30px",l.style.background="transparent",l.onfocus='this.trigger("blur")',document.body.appendChild(l),jq("#datepicker-chart").mask(ASC.Resources.Master.DatePatternJQ),jq("#datepicker-chart").datepicker({onSelect:function(){n.modelController().finalizeOperation("timechanage",{time:jq("#datepicker-chart").datepicker("getDate"),direction:fu})}})));l&&(l.style.left=i.left+10+"px",l.style.top=i.top-26+"px",l.style.display=t?"":"none",r.isMilestone()?jq("#datepicker-chart").datepicker("setDate",r.endDate()):jq("#datepicker-chart").datepicker("setDate",!fu||r.isUndefinedEndTime()?r.beginDate():r.endDate()),jq("#datepicker-chart").datepicker(t?"show":"hide"),jq("#ui-datepicker-div").trigger("focus"))};return{init:vu,enableChartEvents:y,disableChartEvents:p}}(jQuery);

