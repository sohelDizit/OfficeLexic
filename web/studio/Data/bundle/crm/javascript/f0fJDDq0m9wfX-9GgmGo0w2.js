/*
    Copyright (c) Ascensio System SIA 2022. All rights reserved.
    https://www.onlyoffice.com
*/
jQuery.template("casesListFilterTmpl",'<div id="caseFilterContainer"><div id="casesAdvansedFilter"><\/div><\/div><ul id="casesHeaderMenu" class="clearFix contentMenu contentMenuDisplayAll"><li class="menuAction menuActionSelectAll menuActionSelectLonely"><div class="menuActionSelect"><input type="checkbox" id="mainSelectAllCases" title="${ASC.CRM.Resources.CRMCommonResource.SelectAll}" onclick="ASC.CRM.ListCasesView.selectAll(this);" /><\/div><\/li><li class="menuAction menuActionAddTag" title="${ASC.CRM.Resources.CRMCommonResource.AddNewTag}"><span>${ASC.CRM.Resources.CRMCommonResource.AddNewTag}<\/span><div class="down_arrow"><\/div><\/li><li class="menuAction menuActionPermissions" title="${ASC.CRM.Resources.CRMCommonResource.SetPermissions}"><span>${ASC.CRM.Resources.CRMCommonResource.SetPermissions}<\/span><\/li><li class="menuAction menuActionDelete" title="${ASC.CRM.Resources.CRMCommonResource.Delete}"><span>${ASC.CRM.Resources.CRMCommonResource.Delete}<\/span><\/li><li class="menu-action-simple-pagenav"><\/li><li class="menu-action-checked-count"><span><\/span><a class="linkDescribe baseLinkAction" style="margin-left:10px;" onclick="ASC.CRM.ListCasesView.deselectAll();">${ASC.CRM.Resources.CRMCommonResource.DeselectAll}<\/a><\/li><li class="menu-action-on-top"><a class="on-top-link" onclick="javascript:window.scrollTo(0, 0);">${ASC.CRM.Resources.CRMCommonResource.OnTop}<\/a><\/li><\/ul><div class="header-menu-spacer">&nbsp;<\/div>');jQuery.template("casesListPagingTmpl",'<table id="tableForCasesNavigation" class="crm-navigationPanel" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td><div id="divForCasesPager"><\/div><\/td><td style="text-align:right;"><span class="gray-text">${ASC.CRM.Resources.CRMCasesResource.TotalCases}:&nbsp;<\/span><span class="gray-text" id="totalCasesOnPage"><\/span><span class="gray-text">${ASC.CRM.Resources.CRMCommonResource.ShowOnPage}:&nbsp;<\/span><select class="top-align"><option value="25">25<\/option><option value="50">50<\/option><option value="75">75<\/option><option value="100">100<\/option><\/select><\/td><\/tr><\/tbody><\/table>');jQuery.template("casesListBaseTmpl",'<div id="caseList" style="display:none;"><table id="caseTable" class="table-list padding4" cellpadding="0" cellspacing="0"><colgroup><col style="width: 30px;"/><col/><col style="width: 40px;"/><\/colgroup><tbody><\/tbody><\/table><\/div><div id="addTagCasesDialog" class="studio-action-panel group-actions addTagDialog"><ul class="dropdown-content mobile-overflow"><\/ul><div class="h_line">&nbsp;<\/div><div style="margin-bottom:5px;">${ASC.CRM.Resources.CRMCommonResource.CreateNewTag}:<\/div><input type="text" maxlength="50" class="textEdit" /><a onclick="ASC.CRM.ListCasesView.addNewTag();" class="button blue" id="addThisTag">${ASC.CRM.Resources.CRMCommonResource.OK}<\/a><\/div><div id="permissionsCasesPanelInnerHtml" class="display-none">{{if IsCRMAdmin !== true}}<div style="margin-top:10px"><b>${ASC.CRM.Resources.CRMCasesResource.CasesAccessRightsLimit}<\/b><\/div>{{/if}}<\/div><div id="caseActionMenu" class="studio-action-panel"><ul class="dropdown-content"><li><a class="showProfileLink dropdown-item with-icon user">${ASC.CRM.Resources.CRMCasesResource.ShowCaseProfile}<\/a><\/li><li><a class="showProfileLinkNewTab dropdown-item with-icon new-tab">${ASC.CRM.Resources.CRMCasesResource.ShowCaseProfileNewTab}<\/a><\/li><li class="dropdown-item-seporator"><\/li><li><a class="setPermissionsLink dropdown-item with-icon permissions">${ASC.CRM.Resources.CRMCommonResource.SetPermissions}<\/a><\/li><li class="dropdown-item-seporator"><\/li><li><a class="editCaseLink dropdown-item with-icon edit">${ASC.CRM.Resources.CRMCasesResource.EditCase}<\/a><\/li><li><a class="deleteCaseLink dropdown-item with-icon delete">${ASC.CRM.Resources.CRMCasesResource.DeleteThisCase}<\/a><\/li><\/ul><\/div>');jQuery.template("caseListTmpl",'<tbody>{{tmpl(cases) "caseTmpl"}}<\/tbody>');jQuery.template("caseTmpl",'<tr id="caseItem_${id}" class="with-entity-menu"><td style="padding: 0 0 0 6px;"><input type="checkbox" id="checkCase_${id}" onclick="ASC.CRM.ListCasesView.selectItem(this);"                 {{if isChecked == true}}checked="checked"{{/if}} /><div id="loaderImg_${id}" class="loader-middle baseList_loaderImg"><\/div><\/td><td>{{if isPrivate == true}}<label class="crm-private-lock"><\/label>{{/if}}<a class="linkHeaderMedium{{if isClosed == true}} gray-text{{/if}}" href="?id=${id}">${title}<\/a><\/td><td style="padding:5px;"><div id="caseMenu_${id}" class="entity-menu" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><\/td><\/tr>');
jQuery.template("customFieldListTmpl",'{{if label==""}}<table border="0" cellpadding="0" cellspacing="0" class="crm-detailsTable"><colgroup><col style="width: 50px;"/><col style="width: 22px;"/><col/><\/colgroup><tbody><tr class="headerToggleBlock" data-toggleId="0"><td colspan="3" style="white-space:nowrap;"><span class="headerToggle header-base">${ASC.CRM.Resources.CRMCommonResource.AdditionalInformation}<\/span><span class="openBlockLink">${ASC.CRM.Resources.CRMCommonResource.Show}<\/span><span class="closeBlockLink">${ASC.CRM.Resources.CRMCommonResource.Hide}<\/span><\/td><\/tr>{{tmpl(list) "fieldTmpl"}}<\/tbody><\/table>{{else}}<table border="0" cellpadding="0" cellspacing="0" class="crm-detailsTable"><colgroup><col style="width: 50px;"/><col style="width: 22px;"/><col/><\/colgroup><tbody><tr class="headerToggleBlock" data-toggleId="${labelid}"><td colspan="3" style="white-space:nowrap;"><span class="headerToggle header-base">${label}<\/span><span class="openBlockLink">${ASC.CRM.Resources.CRMCommonResource.Show}<\/span><span class="closeBlockLink">${ASC.CRM.Resources.CRMCommonResource.Hide}<\/span><\/td><\/tr>{{tmpl(list) "fieldTmpl"}}<\/tbody><\/table>{{/if}}');jQuery.template("fieldTmpl",'{{if fieldType ==  0 || fieldType ==  2 || fieldType ==  5}}<tr><td class="describe-text" style="white-space:nowrap;" title="${label}">${label}:<\/td><td><\/td><td id="custom_field_${id}">${value.replace(/  /g, " &nbsp;")}<\/td><\/tr>{{else fieldType ==  1}}<tr><td class="describe-text" style="white-space:nowrap;" title="${label}">${label}:<\/td><td><\/td><td id="custom_field_${id}">{{html jq.htmlEncodeLight(value).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}<\/td><\/tr>{{else fieldType ==  3}}<tr><td class="describe-text" style="white-space:nowrap" title="${label}">${label}:<\/td><td><\/td><td>{{if value == "true"}}<input id="custom_field_${id}" type="checkbox" style="vertical-align:middle;" checked="checked" disabled="disabled"/>{{else}}<input id="custom_field_${id}" type="checkbox" style="vertical-align:middle;" disabled="disabled"/>{{/if}}<\/td><\/tr>{{/if}}');jQuery.template("customFieldListWithoutLabelTmpl",'<table border="0" cellpadding="0" cellspacing="0" class="crm-detailsTable"><colgroup><col style="width: 50px;"/><col style="width: 22px;"/><col/><\/colgroup><tbody><tr class="headerToggleBlock" data-toggleId="0"><td colspan="3" style="white-space:nowrap;"><span class="headerToggle header-base">${ASC.CRM.Resources.CRMCommonResource.AdditionalInformation}<\/span><span class="openBlockLink">${ASC.CRM.Resources.CRMCommonResource.Show}<\/span><span class="closeBlockLink">${ASC.CRM.Resources.CRMCommonResource.Hide}<\/span><\/td><\/tr>{{tmpl(list) "fieldTmpl"}}<\/tbody><\/table>');jQuery.template("customFieldListWithoutLabelWithGroupTmpl",'{{tmpl(list) "fieldTmpl"}}');jQuery.template("customFieldRowTmpl",'{{if fieldType ==  3}}<dt class="header-base-small"><label>{{tmpl "fieldForActionsTmpl"}}                ${label}<\/label><\/dt><dd><input type="hidden" name="customField_${id}" /><\/dd>{{else fieldType ==  4}}<dt class="headerToggleBlock clearFix">{{tmpl "fieldForActionsTmpl"}}<span class="openBlockLink">${ASC.CRM.Resources.CRMCommonResource.Show}<\/span><span class="closeBlockLink">${ASC.CRM.Resources.CRMCommonResource.Hide}<\/span><\/dt><dd class="underHeaderBase clearFix"><\/dd>{{else}}<dt class="header-base-small">${label}<\/dt><dd>{{tmpl "fieldForActionsTmpl"}}<\/dd>{{/if}}');jQuery.template("fieldForActionsTmpl",'{{if fieldType ==  0}}<input id="custom_field_${id}" name="customField_${id}" size="${(mask.size >150 ? 150 : mask.size)}"                type="text" class="textEdit" maxlength="255" value="${value}"/>    {{else fieldType ==  1}}<textarea rows="${(mask.rows >25 ? 25 : mask.rows)}" cols="${(mask.cols > 150 ? 150 : mask.cols)}" name="customField_${id}"                id="custom_field_${id}">${value}<\/textarea>{{else fieldType ==  2}}<select class="comboBox" name="customField_${id}" id="custom_field_${id}"><option value="">&nbsp;<\/option>{{if mask}}            {{each mask}}<option value="${$value}">${$value}<\/option>{{/each}}          {{/if}}<\/select>{{else fieldType ==  3}}        {{if value == "true"}}<input id="custom_field_${id}" type="checkbox" checked="checked"/>{{else}}<input id="custom_field_${id}" type="checkbox"/>{{/if}}    {{else fieldType ==  4}}<span class="headerToggle header-base">${label}<\/span>{{else fieldType ==  5}}<input type="text" id="custom_field_${id}" name="customField_${id}" class="textEdit textEditCalendar" value="${value}" autocomplete="off"/>{{/if}}');
jQuery.template("tagViewTmpl",'<div id="tagContainer" class="${$data.containerClass || \'\'}">${( $data.readonly = $data.readonly || false ),\'\'}        {{if !readonly }}<span><span id="addNewTag" class="baseLinkAction crm-withArrowDown" title="${ASC.CRM.Resources.CRMCommonResource.AddNewTag}">${ASC.CRM.Resources.CRMCommonResource.AddNewTag}<\/span><div id="addTagDialog" class="studio-action-panel addTagDialog"><ul class="dropdown-content mobile-overflow">{{each availableTags}}                        {{tmpl({"tagLabel": $value}) \'tagInAllTagsTmpl\'}}                    {{/each}}<\/ul><div class="h_line">&nbsp;<\/div><div style="margin-bottom:5px;">${ASC.CRM.Resources.CRMCommonResource.CreateNewTag}:<\/div><input type="text" class="textEdit" maxlength="50"/><a id="addThisTag" class="button blue" title="${ASC.CRM.Resources.CRMCommonResource.OK}">${ASC.CRM.Resources.CRMCommonResource.OK}<\/a><\/div><\/span>{{/if}}<div style="display:inline;">{{each tags}}                {{tmpl({"tagLabel": $value, "readonly": $data.readonly}) \'taqTmpl\'}}            {{/each}}<\/div><img class="adding_tag_loading" alt="${ASC.CRM.Resources.CRMSettingResource.AddTagInProgressing}"                title="${ASC.CRM.Resources.CRMSettingResource.AddTagInProgressing}"                src="${StudioManager.GetImage(\'loader_16.gif\')}" /><\/div>');jQuery.template("taqTmpl",'<span class="tag_item"><span class="tag_title" data-value="${jQuery.base64.encode(tagLabel)}">${ASC.CRM.Common.convertText(tagLabel, true)}<\/span>${( $data.readonly = $data.readonly || false ),\'\'}        {{if !readonly }}<a class="delete_tag" alt="${ASC.CRM.Resources.CRMCommonResource.DeleteTag}" title="${ASC.CRM.Resources.CRMCommonResource.DeleteTag}"            onclick="ASC.CRM.TagView.deleteTag(jq(this).parent())">&times;<\/a>{{/if}}<\/span>');jQuery.template("tagInAllTagsTmpl",'<li><a class="dropdown-item" onclick="ASC.CRM.TagView.addExistingTag(this);" data-value="${jQuery.base64.encode(tagLabel)}">${ASC.CRM.Common.convertText(tagLabel, true)}<\/a><\/li>');jQuery.template("historyRowTmpl",'<tr id="event_${id}"><td class="entityPlace"><a name="${id}"><\/a>{{if typeof(category) != "undefined"}}<label title="${category.title}" alt="${category.title}" class="event_category hover ${category.cssClass}"><\/label>{{/if}}<\/td><td class="title">{{if contact != null && contact.id != ASC.CRM.HistoryView.ContactID}}<a class="link underline gray" href="Default.aspx?id=${contact.id}">${contact.displayName}<\/a>{{if entity != null && entity.entityId != ASC.CRM.HistoryView.EntityID}}                    &nbsp;/&nbsp;                {{/if}}            {{/if}}            {{if entity != null && entity.entityId != ASC.CRM.HistoryView.EntityID}}                ${entityType}:<a class="link underline gray" href="${entityURL}">${entity.entityTitle}<\/a>{{/if}}            {{if typeof message != "undefined" && message != null}}<div>${ASC.CRM.Resources.CRMCommonResource.TheEmail}                "<a class="link historyEventMailSubj" href="MailViewer.aspx?id=${id}" target="_blank">${content}<\/a>"                {{if message.is_sended === true}}                ${ASC.CRM.Resources.CRMCommonResource.HistoryEventOutboxMail}                {{else}}                ${ASC.CRM.Resources.CRMCommonResource.HistoryEventInboxMail}                {{/if}}<\/div>{{else}}<div>{{html htmlUtility.getFull(Encoder.htmlDecode(ASC.CRM.Common.convertText(content, true)))}}<\/div>{{/if}}<span class="text-medium-describe">${displayDateCrtdate} ${displayTimeCrtdate} ${ASC.CRM.Resources.CRMCommonResource.Author}: ${createdBy.displayName}<\/span><\/td><td class="activityData describe-text">{{if files != null}}<label class="event_attached_file" align="absmiddle"><\/label><a id="eventAttachSwither_${id}" class="baseLinkAction linkMedium">${ASC.CRM.Resources.CRMCommonResource.ViewFiles}<\/a><div id="eventAttach_${id}" class="studio-action-panel eventAttachPanel"><ul class="dropdown-content">{{each(i, file) files}}<li id="fileContent_${file.id}"><a target="_blank" href="${file.webUrl}" class="dropdown-item">${file.title}<\/a>{{if $data.canEdit == true}}<img class="deleteFileBtn" align="absmiddle" title="${ASC.CRM.Resources.CRMCommonResource.Delete}"                                    onclick="ASC.CRM.HistoryView.deleteFile(${file.id}, ${$data.id})"                                    src="${StudioManager.GetCRMImage(\'remove_12.png\')}" />{{/if}}<\/li>{{/each}}<\/ul><\/div>{{/if}}<\/td><td style="width: 20px;">{{if canEdit == true}}<a id="eventTrashImg_${id}" class="crm-deleteLink" title="${ASC.CRM.Resources.CRMCommonResource.DeleteHistoryEvent}"               onclick="ASC.CRM.HistoryView.deleteEvent(${id})"><\/a><div id="eventLoaderImg_${id}" class="loader-middle baseList_loaderImg"><\/div>{{/if}}<\/td><\/tr>');jQuery.template("previewImportDataTemplate",'<tr><td><input type="checkbox" checked="checked" /><\/td><td><img src="${default_image}" /><\/td><td style="width:100%">${contact_title}<\/td><\/tr>');jQuery.template("columnSelectorTemplate",'{{if isHeader}}<option name="is_header">${title}<\/option>{{else !isHeader}}<option name="${name}" >${title}<\/option>{{/if}}');jQuery.template("columnMappingTemplate","{{each firstContactFields}}<tr><td>${headerColumns[$index]}<\/td><td>{{html $item.renderSelector($index)}}<\/td><td>${$value}<\/td><\/tr>{{/each}}");jQuery.template("makePublicPanelTemplate",'<div class="makePublicPanel"><div class="bold" style="margin: 16px 0 10px;">${Title}<\/div><p>${Description}<\/p><div><table class="border-panel" cellpadding="5" cellspacing="0"><tr><td><input style="margin: 0" type="checkbox" id="isPublic" {{if IsPublicItem == true}}checked="checked"{{/if}} /><\/td><td style="padding-left:0;"><label class="makePublicPanelLabel" for="isPublic">${CheckBoxLabel}<\/label><\/td><td style="padding-left:0;"><span class="makePublicPanelOptions"><select class="makePublicPanelSelector"><\/select><\/span><\/td><\/tr><\/table><\/div><\/div>');jQuery.template("privatePanelTmpl",'<div><span class="header-base">${ASC.CRM.Resources.CRMCommonResource.PrivatePanelHeader}<\/span><p>${description}<\/p><div><table class="border-panel" cellpadding="5" cellspacing="0"><tr><td><input style="margin: 0" type="checkbox" id="isPrivate" {{if isPrivate==true}}checked="checked"{{/if}}                            onclick="ASC.CRM.PrivatePanel.changeIsPrivateCheckBox();" /><\/td><td style="padding-left:0"><label for="isPrivate">${checkBoxLabel}<\/label><\/td><\/tr><\/table><\/div><div id="privateSettingsBlock" {{if isPrivate==false}}style="display:none;"{{/if}}><br /><b>${accessListLable}:<\/b><\/div><\/div>');jQuery.template("categorySelectorTemplate",'<div id="${jsObjName}">{{if typeof helpInfoText != "undefined" && helpInfoText != ""}}<div style="float: left;position: relative;">{{/if}}        {{if jq.browser.mobile === true}}            {{tmpl "categorySelectorMobileTemplate"}}        {{else}}            {{tmpl "categorySelectorDesktopTemplate"}}        {{/if}}        {{if typeof helpInfoText != "undefined" && helpInfoText != ""}}<\/div><div><div style="height: 20px;margin: 0 0 0 4px;" class="HelpCenterSwitcher" onclick="jq(this).helper({ BlockHelperID: \'${jsObjName}_helpInfo\'});"><\/div><div class="popup_helper" id="${jsObjName}_helpInfo">{{html helpInfoText}}<\/div><\/div>{{/if}}<\/div>');jQuery.template("categorySelectorMobileTemplate",'<select id="${jsObjName}_select" style="width:${maxWidth}px;" onchange="javascript:${jsObjName}.changeContact(jq(this).find(\'option:selected\'));">{{each categories}}<option id="${jsObjName}_category_${$value.id}" value="${$value.id}">${$value.title}<\/option>{{/each}}<\/select>');jQuery.template("categorySelectorDesktopTemplate",'<div style="width:${maxWidth}px;" class="categorySelector-selector-container clearFix" id="${jsObjName}_selectorContainer"><input type="text" id="${jsObjName}_categoryTitle" value="${selectedCategory.title}" style="width:${maxWidth - 25}px; height:16px; border:none; padding:2px; float: left;" class="textEdit" readonly="readonly" /><div class="categorySelector-selector"><\/div><input type="hidden" id="${jsObjName}_categoryID" value="${selectedCategory.id}" /><\/div><div class="categorySelector-categoriesContainer" id="${jsObjName}_categoriesContainer"><div class="categorySelector-categories">{{each categories}}<div id="${jsObjName}_category_${$value.id}" class="categorySelector-category" onclick="javascript:${jsObjName}.changeContact(this);" >{{if typeof($value.cssClass) != "undefined"}}<label class="${$value.cssClass}"><\/label>{{/if}}<div style="padding: 9px 0 0 35px;">${$value.title}<\/div><\/div>{{/each}}<\/div><\/div>');jQuery.template("historyMailTemplate",'<div class="headTitle clearFix"><div class="importance float-left"><i class="{{if important === true}}icon-important{{else}}icon-unimportant{{/if}}"><\/i><\/div><span class="header-base">${subject}<\/span><\/div><div class="head"><div class="row"><label>${ASC.CRM.Resources.CRMCommonResource.MailFrom}:<\/label><div class="value"><a href="${fromHref}" target="_blank" class="from">${from}<\/a><\/div><\/div><div class="row"><label>${ASC.CRM.Resources.CRMCommonResource.MailTo}:<\/label><div class="value to-addresses"><a href="${toHref}" target="_blank" class="to">${to}<\/a><\/div><\/div>{{if typeof cc_text != "undefined" && cc_text != ""}}<div class="row"><label>${ASC.CRM.Resources.CRMCommonResource.MailCopyTo}:<\/label><div class="value cc-addresses">${cc_text}<\/div><\/div>{{/if}}<div class="row"><label>${ASC.CRM.Resources.CRMCommonResource.Date}:<\/label><div class="value"><span>${date_created}<\/span><\/div><\/div><\/div>');jQuery.template("userSelectorListViewTemplate",'<div><div id="selectedUsers${objId}" class="clearFix" style="margin-top: 10px;">{{if typeof usersWhoHasAccess != "undefined" && usersWhoHasAccess != null && usersWhoHasAccess.length > 0}}                {{each(i, item) usersWhoHasAccess}}<div class="selectedUser">${item}<\/div>{{/each}}            {{/if}}            {{if typeof selectedUsers != "undefined" && selectedUsers != null && selectedUsers.length > 0}}                {{each(i, obj) selectedUsers}}<div class="selectedUser" id="selectedUser_${obj.id}${objId}"                        onmouseover="${objName}.SelectedItem_mouseOver(this);"                        onmouseout="${objName}.SelectedItem_mouseOut(this);">${obj.displayName}<img src="${deleteImgSrc}" id="deleteSelectedUserImg_${obj.id}${objId}"                            onclick="${objName}.SelectedUser_deleteItem(this);"                            title="${ASC.CRM.Resources.CRMCommonResource.DeleteUser}" style="display: none;" alt="" /><\/div>{{/each}}            {{/if}}<\/div><div class="clearFix"><div id="usrSrListViewAdvUsrSrContainer${objId}"><span class="addUserLink"><a class="link dotline">${addEmployeeLabel}<\/a><span class="sort-down-black"><\/span><\/span><\/div>{{if showNotifyPanel === true}}<div id="notifyPanel${objId}"><input type="checkbox" id="cbxNotify${objId}"><label for="cbxNotify${objId}">${notifyLabel}<\/label><\/div>{{/if}}<\/div><\/div>');jQuery.template("eventLinkToPanelTmpl",'<div id="eventLinkToPanel" class="empty-select">{{if contactID != 0}}<span>${ASC.CRM.Resources.CRMCommonResource.LinkTo}:<\/span><select id="typeSwitcherSelect" class="none-helper"><option class="default-field" value="-2" disabled="disabled">${ASC.CRM.Resources.CRMJSResource.Choose}<\/option><option class="hidden" value="-1">${ASC.CRM.Resources.CRMCommonResource.ClearFilter}<\/option><option value="${entityTypeOpportunity}">${ASC.CRM.Resources.CRMDealResource.Deal}<\/option><option value="${entityTypeCase}">${ASC.CRM.Resources.CRMCasesResource.Case}<\/option><\/select><select id="dealsSwitcherSelect" style="display:none;" class="none-helper"><option class="default-field" value="-2" disabled="disabled">${ASC.CRM.Resources.CRMJSResource.Choose}<\/option>{{each deals}}<option value="${this.id}">${this.title}<\/option>{{/each}}<\/select><select id="casesSwitcherSelect" style="display:none;" class="none-helper"><option class="default-field" value="-2" disabled="disabled">${ASC.CRM.Resources.CRMJSResource.Choose}<\/option>{{each cases}}<option value="${this.id}">${this.title}<\/option>{{/each}}<\/select><input type="hidden" id="typeID" value=""/><input type="hidden" id="itemID" value="0"/>{{else}}<span>${ASC.CRM.Resources.CRMCommonResource.AttachThisNoteToContact}:<\/span><select id="contactSwitcherSelect" class="none-helper"><option class="default-field" value="-2" disabled="disabled">${ASC.CRM.Resources.CRMJSResource.Choose}<\/option><option class="hidden" value="-1">${ASC.CRM.Resources.CRMCommonResource.ClearFilter}<\/option>{{each contacts}}<option value="${this.id}">${this.displayName}<\/option>{{/each}}<\/select><input type="hidden" id="contactID" value="0"/>{{/if}}<\/div>');
jQuery.template("contactsListFilterTmpl",'<div id="contactsFilterContainer"><div id="contactsAdvansedFilter"><\/div><\/div><ul id="contactsHeaderMenu" class="clearFix contentMenu contentMenuDisplayAll"><li class="menuAction menuActionSelectAll menuActionSelectLonely"><div class="menuActionSelect"><input type="checkbox" id="mainSelectAll" title="${ASC.CRM.Resources.CRMCommonResource.SelectAll}" onclick="ASC.CRM.ListContactView.selectAll(this);" /><\/div><\/li>{{if IsCRMAdmin === true}}<li class="menuAction menuActionSendEmail" title="${ASC.CRM.Resources.CRMCommonResource.SendEmail}"><span>${ASC.CRM.Resources.CRMCommonResource.SendEmail}<\/span><div class="down_arrow"><\/div><\/li>{{/if}}<li class="menuAction menuActionAddTag" title="${ASC.CRM.Resources.CRMCommonResource.AddNewTag}"><span>${ASC.CRM.Resources.CRMCommonResource.AddNewTag}<\/span><div class="down_arrow"><\/div><\/li><li class="menuAction menuActionAddTask" title="${ASC.CRM.Resources.CRMTaskResource.AddNewTaskButtonText}"><span>${ASC.CRM.Resources.CRMTaskResource.AddNewTaskButtonText}<\/span><\/li><li class="menuAction menuActionDelete" title="${ASC.CRM.Resources.CRMCommonResource.Delete}"><span>${ASC.CRM.Resources.CRMCommonResource.Delete}<\/span><\/li><li class="menu-action-simple-pagenav"><\/li><li class="menu-action-checked-count"><span><\/span><a class="linkDescribe baseLinkAction" style="margin-left:10px;" onclick="ASC.CRM.ListContactView.deselectAll();">${ASC.CRM.Resources.CRMCommonResource.DeselectAll}<\/a><\/li><li class="menu-action-on-top"><a class="on-top-link" onclick="javascript:window.scrollTo(0, 0);">${ASC.CRM.Resources.CRMCommonResource.OnTop}<\/a><\/li><\/ul><div class="header-menu-spacer">&nbsp;<\/div>');jQuery.template("contactsListBaseTmpl",'<div id="mainContactList"><div class="clearFix"><div id="companyListBox" style="display: none"><table id="companyTable" class="table-list padding4" cellpadding="0" cellspacing="0"><colgroup><col style="width: 26px;"/><col style="width: 40px;"/><col/><col style="width: 200px;"/><col style="width: 200px;"/><col style="width: 200px;"/><col style="width: 40px;"/><\/colgroup><tbody><\/tbody><\/table><\/div><\/div><\/div><div id="permissionsContactsPanelInnerHtml" class="display-none">{{if IsCRMAdmin !== true}}<div style="margin-top:10px"><b>${ASC.CRM.Resources.CRMCommonResource.AccessRightsLimit}<\/b><\/div>{{/if}}<\/div>{{if IsCRMAdmin === true}}<div id="sendEmailDialog" class="studio-action-panel group-actions"><ul class="dropdown-content"><li><a class="dropdown-item" onclick="ASC.CRM.ListContactView.showCreateLinkPanel()">${ASC.CRM.Resources.CRMSettingResource.ExternalClient}<\/a><\/li><li><a class="dropdown-item" onclick="ASC.CRM.ListContactView.showSenderPage()">${ASC.CRM.Resources.smtpQuotas}<\/a><\/li><\/ul><\/div>{{/if}}<div id="addTagDialog" class="studio-action-panel group-actions addTagDialog"><ul class="dropdown-content mobile-overflow"><\/ul><div class="h_line">&nbsp;<\/div><div style="padding: 0 12px;"><div style="margin-bottom: 5px;" >${ASC.CRM.Resources.CRMCommonResource.CreateNewTag}:<\/div><input type="text" maxlength="50" class="textEdit" /><a onclick="ASC.CRM.ListContactView.addNewTag();" class="button blue" id="addThisTag">${ASC.CRM.Resources.CRMCommonResource.OK}<\/a><\/div><\/div><div id="contactActionMenu" class="studio-action-panel"><ul class="dropdown-content"><li><a class="showProfileLink dropdown-item with-icon user">${ASC.CRM.Resources.CRMContactResource.ShowContactProfile}<\/a><\/li><li><a class="showProfileLinkNewTab dropdown-item with-icon new-tab">${ASC.CRM.Resources.CRMContactResource.ShowContactProfileNewTab}<\/a><\/li><li class="dropdown-item-seporator"><\/li><li><a class="addPhoneLink dropdown-item with-icon phone">${ASC.CRM.Resources.CRMJSResource.AddNewPhone}<\/a><\/li><li><a class="addEmailLink dropdown-item with-icon add-email">${ASC.CRM.Resources.CRMJSResource.AddNewEmail}<\/a><\/li><li class="dropdown-item-seporator"><\/li><li><a class="makeVoIPCallLink dropdown-item with-icon call">${ASC.CRM.Resources.CRMJSResource.MakeVoIPCall}<\/a><\/li><li><a class="sendEmailLink dropdown-item with-icon email" target="_blank">${ASC.CRM.Resources.CRMContactResource.WriteEmail}<\/a><\/li><li><a class="addTaskLink dropdown-item with-icon new-task">${ASC.CRM.Resources.CRMTaskResource.AddNewTask}<\/a><\/li><li><a class="addDealLink dropdown-item with-icon new-opportunity">${ASC.CRM.Resources.CRMDealResource.CreateNewDeal}<\/a><\/li><li><a class="addCaseLink dropdown-item with-icon case">${ASC.CRM.Resources.CRMCasesResource.CreateNewCase}<\/a><\/li><li class="dropdown-item-seporator"><\/li><li><a class="editContactLink dropdown-item with-icon edit">${ASC.CRM.Resources.CRMContactResource.EditContact}<\/a><\/li><li><a class="deleteContactLink dropdown-item with-icon delete">${ASC.CRM.Resources.CRMContactResource.DeleteContact}<\/a><\/li><\/ul><\/div>');jQuery.template("contactsListPagingTmpl",'<table id="tableForContactNavigation" class="crm-navigationPanel" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td><div id="divForContactPager"><\/div><\/td><td style="text-align:right;"><span class="gray-text">${ASC.CRM.Resources.CRMContactResource.TotalContacts}:&nbsp;<\/span><span class="gray-text" id="totalContactsOnPage"><\/span><span class="page-nav-info"><span class="gray-text">${ASC.CRM.Resources.CRMCommonResource.ShowOnPage}:&nbsp;<\/span><select class="top-align"><option value="25">25<\/option><option value="50">50<\/option><option value="75">75<\/option><option value="100">100<\/option><\/select><\/span><\/td><\/tr><\/tbody><\/table>');jQuery.template("contactListTmpl",'<tbody>{{tmpl(contacts) "contactTmpl"}}<\/tbody>');jQuery.template("contactTmpl",'<tr id="contactItem_${id}" class="with-entity-menu"><td style="padding-left: 6px;"><input type="checkbox" id="check_contact_${id}" onclick="ASC.CRM.ListContactView.selectItem(this);" style="margin-left: 2px;" {{if isChecked == true}}checked="checked"{{/if}} /><div id="loaderImg_${id}" class="loader-middle baseList_loaderImg"><\/div><\/td><td><div class="contactItemPhotoImgContainer{{if isShared === true}} sharedContact{{/if}}">{{if isCompany == true}}<img class="contactItemPhotoImg" src="${ASC.CRM.Data.SmallSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${smallFotoUrl}\');" />{{else}}<img class="contactItemPhotoImg" src="${ASC.CRM.Data.SmallSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${smallFotoUrl}\');" />{{/if}}<img class="contactItemPhotoImg" style="display:none;" alt="${displayName}" title="${displayName}"/><\/div><\/td><td><div class="contactTitle"><a class="linkHeaderMedium" href="Default.aspx?id=${id}">${displayName}<\/a><\/div>{{if isCompany == false && company != null}}<div class="contactTitle">${ASC.CRM.Resources.CRMContactResource.Company}:&nbsp;<a href="Default.aspx?id=${company.id}" data-id="${company.id}" id="contact_${id}_company_${company.id}" class="linkMedium crm-companyInfoCardLink">${company.displayName}<\/a><\/div>{{/if}}<\/td><td><div class="primaryDataContainer"><input type="text" id="addPrimaryPhone_${id}" class="textEdit addPrimaryDataInput" autocomplete="off" maxlength="100"/>{{if primaryPhone != null}}<span class="primaryPhone {{if ASC.VoipNavigationItem && ASC.VoipNavigationItem.isInit}}link{{/if}}" title="${primaryPhone.data}">${primaryPhone.data}<\/span>{{/if}}<\/div><\/td><td><div class="primaryDataContainer"><input type="text" id="addPrimaryEmail_${id}" class="textEdit addPrimaryDataInput" autocomplete="off" maxlength="100"/>{{if primaryEmail != null}}<a class="primaryEmail linkMedium" title="${primaryEmail.data}" href="${primaryEmail.emailHref}" target="_blank">${primaryEmail.data}<\/a>{{/if}}<\/div><\/td><td>{{if nearTask != null}}<span id="taskTitle_${nearTask.id}" class="header-base-small nearestTask"                    ttl_label="${ASC.CRM.Resources.CRMCommonResource.Title}" ttl_value="${nearTask.title}"                    dscr_label="${ASC.CRM.Resources.CRMCommonResource.Description}" dscr_value="${nearTask.description}"                    resp_label="${ASC.CRM.Resources.CRMCommonResource.Responsible}" resp_value="${nearTask.responsible.displayName}">${nearTask.category.title} ${nearTask.deadLineString}<\/span>{{/if}}<\/td><td><div id="contactMenu_${id}" class="entity-menu" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><\/td><\/tr>');jQuery.template("TwitterProfileTmpl",'<tr><td class="sm_tbl_UserList_clmnBtRelate"><a class="button gray plus"                onclick="ASC.CRM.SocialMedia.AddTwitterProfileToContact(\'${screenName}\'); return false;">${ASC.CRM.Resources.CRMCommonResource.Add}<\/a><\/td><td class="sm_tbl_UserList_clmnAvatar"><div style="min-height: 40px;"><img src="${smallImageUrl}" alt="${userName}" width="40"/><\/div><\/td><td class="sm_tbl_UserList_clmnUserName" style="padding:5px;"><span class="header-base-small sn_userName" style="color: Black !important;">${userName}<\/span><br />${description}<\/td><\/tr>');jQuery.template("TwitterProfileTabTmpl",'<tr><td class="sm_tbl_UserList_clmnBtRelate"><a class="button gray plus"                onclick="ASC.CRM.SocialMedia.AddAndSaveTwitterProfileToContact(\'${screenName}\', jq.getURLParam(\'id\')); return false;">${ASC.CRM.Resources.CRMCommonResource.Choose}<\/a><\/td><td class="sm_tbl_UserList_clmnAvatar"><div style="min-height: 40px;"><img src="${smallImageUrl}" width="40" alt=""/><\/div><\/td><td class="sm_tbl_UserList_clmnUserName" style="padding:5px;"><span class="header-base-small sn_userName" style="color: Black !important;">${userName}<\/span><br />${description}<\/td><\/tr>');jQuery.template("socialMediaAvatarTmpl",'<div class="ImageHolderOuter" onclick="ASC.CRM.SocialMedia.UploadUserAvatar(event,\'${socialNetwork}\',\'${identity}\');"><img src="${imageUrl}" alt="Avatar" class="AvatarImage" /><\/div>');jQuery.template("collectionContainerTmpl",'<tr><td class="describe-text" style="white-space:nowrap;">${Type}:<\/td><td><\/td><td class="collectionItemsTD"><\/td><\/tr>');jQuery.template("collectionTmpl",'{{if infoType == 0}}<div class="collectionItem">{{if isPrimary == true}}<a href="tel:${data}" class="linkMedium">${data}<\/a>{{else}}<span>${data}<\/span>{{/if}}            &nbsp;<span class="text-medium-describe">(${categoryName})<\/span><\/div>{{else infoType == 1}}<div class="collectionItem"><a href="mailto:${data}" class="linkMedium">${data}<\/a>&nbsp;<span class="text-medium-describe">(${categoryName})<\/span>{{if isPrimary == true}}<a class="linkDescribe baseLinkAction writeEmail" data-email="${data}">${ASC.CRM.Resources.CRMContactResource.WriteEmail}<\/a>{{/if}}<\/div>{{else infoType == 3 || infoType == 15 || infoType == 16}}<div class="collectionItem"><span>${data}<\/span>&nbsp;<span class="text-medium-describe">(${categoryName})<\/span><\/div>{{else infoType == 10  || infoType == 12 || infoType == 13}}<div class="collectionItem"><a href="mailto:${data}" class="linkMedium">${data}<\/a>&nbsp;<span class="text-medium-describe">(${categoryName})<\/span><\/div>{{else infoType == 2 || infoType == 4 || infoType == 5 || infoType == 6 ||infoType == 8 ||infoType == 9 || infoType == 11 || infoType == 14 || infoType == 17}}<div class="collectionItem"><a href="${href}" target="_blank" class="linkMedium">${data}<\/a>&nbsp;<span class="text-medium-describe">(${categoryName})<\/span><\/div>{{else infoType == 7}}<div class="collectionItem">{{html data}}            &nbsp;<span class="text-medium-describe">(${categoryName})<\/span><br/><a style="text-decoration: underline;" href="${href}" target="_blank" class="linkMedium">${ASC.CRM.Resources.CRMContactResource.ShowOnMap}<\/a><\/div>{{/if}}');jQuery.template("projectSelectorOptionTmpl",'<option value="${id}">${title}<\/option>');jQuery.template("projectSelectorItemTmpl",'<li data-id="${id}"><div class="dropdown-item">${title}<\/div><\/li>');jQuery.template("listContactsToMergeTmpl",'{{each contacts}}<li><input type="radio" name="contactToMerge" value="${id}" /><span>${displayName}<\/span><\/li>{{/each}}<li><input type="radio" name="contactToMerge" value="0"{{if count == 0}} style="display: none;"{{/if}} /><div class="contactToMergeSelectorContainer"{{if count >0}} style="margin-left: 0;"{{/if}}><\/div><input type="hidden" name="selectedContactToMergeID" value="0" /><\/li>');jQuery.template("twitterMessageListTmpl",'<div class="sm_message_line clearFix"><div class="sn_user_icon"><a href="https://twitter.com/#!/${userId}" target="_blank"><img alt="" src="${userImageUrl}" width="32" /><\/a>&nbsp;<\/div><div class="sn_message_block longWordsBreak"><span class="header-base-small sn_userName"><img style="border-width:0px;" src="${StudioManager.GetCRMImage(\'twitter.png\')}"" class="sn_small_img">${userName}<\/span><br /><div class="sn_message_text">{{html htmlUtility.getFull(Encoder.htmlDecode(ASC.CRM.Common.convertText(text, true)))}}<\/div><span class="describe-text">${postedOnDisplay}<\/span><\/div><\/div>');jQuery.template("twitterMessageListPanelTmpl",'<div style="display:none;" class="infoPanel sm_messagesList_ErrorDescription" id="smErrorDescriptionContainer"><div id="smErrorDescription"><\/div><\/div><div class="clearFix"><\/div>');
jQuery.template("dealsListFilterTmpl",'<div id="dealFilterContainer"><div id="dealsAdvansedFilter"><\/div><\/div><ul id="dealHeaderMenu" class="clearFix contentMenu contentMenuDisplayAll"><li class="menuAction menuActionSelectAll menuActionSelectLonely"><div class="menuActionSelect"><input type="checkbox" id="mainSelectAllDeals" title="${ASC.CRM.Resources.CRMCommonResource.SelectAll}" onclick="ASC.CRM.ListDealView.selectAll(this);" /><\/div><\/li><li class="menuAction menuActionAddTag" title="${ASC.CRM.Resources.CRMCommonResource.AddNewTag}"><span>${ASC.CRM.Resources.CRMCommonResource.AddNewTag}<\/span><div class="down_arrow"><\/div><\/li><li class="menuAction menuActionPermissions" title="${ASC.CRM.Resources.CRMCommonResource.SetPermissions}"><span>${ASC.CRM.Resources.CRMCommonResource.SetPermissions}<\/span><\/li><li class="menuAction menuActionDelete" title="${ASC.CRM.Resources.CRMCommonResource.Delete}"><span>${ASC.CRM.Resources.CRMCommonResource.Delete}<\/span><\/li><li class="menu-action-simple-pagenav"><\/li><li class="menu-action-checked-count"><span><\/span><a class="linkDescribe baseLinkAction" style="margin-left:10px;" onclick="ASC.CRM.ListDealView.deselectAll();">${ASC.CRM.Resources.CRMCommonResource.DeselectAll}<\/a><\/li><li class="menu-action-on-top"><a class="on-top-link" onclick="javascript:window.scrollTo(0, 0);">${ASC.CRM.Resources.CRMCommonResource.OnTop}<\/a><\/li><\/ul><div class="header-menu-spacer" style="display: none;">&nbsp;<\/div>');jQuery.template("dealsListPagingTmpl",'<table id="tableForDealNavigation" class="crm-navigationPanel" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td><div id="divForDealPager"><\/div><\/td><td style="text-align:right;"><a style="margin-right: 25px;" class="baseLinkAction showTotalAmount"                        onclick="ASC.CRM.ListDealView.showExchangeRatePopUp();" href="javascript:void(0)">${ASC.CRM.Resources.CRMDealResource.ShowTotalAmount}<\/a><span class="gray-text">${ASC.CRM.Resources.CRMDealResource.TotalDeals}:&nbsp;<\/span><span class="gray-text" id="totalDealsOnPage"><\/span><span class="gray-text">${ASC.CRM.Resources.CRMCommonResource.ShowOnPage}:&nbsp;<\/span><select class="top-align"><option value="25">25<\/option><option value="50">50<\/option><option value="75">75<\/option><option value="100">100<\/option><\/select><\/td><\/tr><\/tbody><\/table>');jQuery.template("dealsListBaseTmpl",'<div id="dealList" class="clearFix" style="display:none;"><\/div><div id="files_hintStagesPanel" class="hintDescriptionPanel">${ASC.CRM.Resources.CRMDealResource.TooltipStages}        {{if ASC.Resources.Master.HelpLink}}<a href="${ASC.Resources.Master.HelpLink}/tipstricks/opportunity-stages.aspx" target="_blank">${ASC.CRM.Resources.CRMCommonResource.ButtonLearnMore}<\/a>{{/if}}<\/div><div id="hiddenBlockForContactSelector" style="display:none;"><span id="contactSelectorForFilter" class="custom-value"><span class="inner-text"><span class="value">${ASC.CRM.Resources.CRMCommonResource.Select}<\/span><\/span><\/span><\/div><div id="addTagDealsDialog" class="studio-action-panel group-actions addTagDialog"><ul class="dropdown-content mobile-overflow"><\/ul><div class="h_line">&nbsp;<\/div><div style="padding: 0 12px;"><div style="margin-bottom: 5px;">${ASC.CRM.Resources.CRMCommonResource.CreateNewTag}:<\/div><input type="text" maxlength="50" class="textEdit" /><a onclick="ASC.CRM.ListDealView.addNewTag();" class="button blue" id="addThisTag">${ASC.CRM.Resources.CRMCommonResource.OK}<\/a><\/div><\/div><div id="permissionsDealsPanelInnerHtml" class="display-none">{{if IsCRMAdmin !== true}}<div style="margin-top:10px"><b>${ASC.CRM.Resources.CRMDealResource.DealAccessRightsLimit}<\/b><\/div>{{/if}}<\/div><div id="dealActionMenu" class="studio-action-panel"><ul class="dropdown-content"><li><a class="showProfileLink dropdown-item with-icon user">${ASC.CRM.Resources.CRMDealResource.ShowDealProfile}<\/a><\/li><li><a class="showProfileLinkNewTab dropdown-item with-icon new-tab">${ASC.CRM.Resources.CRMDealResource.ShowDealProfileNewTab}<\/a><\/li><li class="dropdown-item-seporator"><\/li><li><a class="setPermissionsLink dropdown-item with-icon permissions">${ASC.CRM.Resources.CRMCommonResource.SetPermissions}<\/a><\/li>{{if CanCreateProjects}}<li><a class="createProject dropdown-item with-icon project" target="_blank">${ASC.CRM.Resources.CRMCommonResource.CreateNewProject}<\/a><\/li>{{/if}}<li class="dropdown-item-seporator"><\/li><li><a class="editDealLink dropdown-item with-icon edit">${ASC.CRM.Resources.CRMDealResource.EditThisDealButton}<\/a><\/li><li><a class="deleteDealLink dropdown-item with-icon delete">${ASC.CRM.Resources.CRMDealResource.DeleteDeal}<\/a><\/li><\/ul><\/div>');jQuery.template("dealExtendedListTmpl",'<table id="dealTable" class="table-list padding4" cellpadding="0" cellspacing="0"><colgroup>{{if contactID == 0}}<col style="width: 26px;"/>{{/if}}<col/><col style="width: 150px;"/>{{if contactID == 0}}<col style="width: 180px;"/>{{/if}}<col style="width: 180px;"/>{{if contactID == 0}}<col style="width: 40px;"/>{{/if}}<\/colgroup><tbody><\/tbody><\/table>{{if contactID != 0}}<div id="showMoreDealsButtons"><a class="crm-showMoreLink" style="display:none;">${ASC.CRM.Resources.CRMJSResource.ShowMoreButtonText}<\/a><a class="loading-link" style="display:none;">${ASC.CRM.Resources.CRMJSResource.LoadingProcessing}<\/a><\/div><a style="float: right;margin-top: 20px;margin-right: 8px;" class="baseLinkAction showTotalAmount"        onclick="ASC.CRM.ListDealView.showExchangeRatePopUp();" href="javascript:void(0)">${ASC.CRM.Resources.CRMDealResource.ShowTotalAmount}<\/a>{{/if}}');jQuery.template("dealListTmpl",'<tbody>{{tmpl(opportunities) "dealTmpl"}}<\/tbody>');jQuery.template("dealTmpl",'<tr id="dealItem_${id}" {{if ASC.CRM.ListDealView.contactID == 0}}class="with-entity-menu"{{/if}}>{{if ASC.CRM.DealTabView.contactID == 0}}<td style="padding: 0 0 0 6px;"><input type="checkbox" id="checkDeal_${id}" style="margin-left:2px;"                 onclick="ASC.CRM.ListDealView.selectItem(this);"                 {{if isChecked == true}}checked="checked"{{/if}} /><div id="loaderImg_${id}" class="loader-middle baseList_loaderImg"><\/div><\/td>{{/if}}<td class="dealTitle"><div>{{if isPrivate == true}}<label class="crm-private-lock"><\/label>{{/if}}<a id="dealTitle_${id}" href="Deals.aspx?id=${id}"                    class="${classForTitle}"                    dscr_label="${ASC.CRM.Resources.CRMCommonResource.Description}" dscr_value="${description}"                    resp_label="${ASC.CRM.Resources.CRMCommonResource.Responsible}" resp_value="${responsible.displayName}">${title}<\/a><div style="height:4px;">&nbsp;<\/div>{{if isOverdue == true}}<span class=\'red-text\'>${ASC.CRM.Resources.CRMJSResource.ExpectedCloseDate}: ${expectedCloseDateString}<\/span>{{else closedStatusString != ""}}<span class=\'gray-text\'>${closedStatusString}<\/span>{{else expectedCloseDateString != ""}}<span>${ASC.CRM.Resources.CRMJSResource.ExpectedCloseDate}: ${expectedCloseDateString}<\/span>{{/if}}<\/div><\/td><td class="dealCategory"><div>${stage.title}<\/div><\/td>{{if ASC.CRM.DealTabView.contactID == 0}}<td class="dealContact">{{if contact != null}}<div>{{if contact.isCompany == true}}<a href="Default.aspx?id=${contact.id}" data-id="${contact.id}"                            id="deal_${id}_company_${contact.id}" class="linkMedium crm-companyInfoCardLink">${contact.displayName}<\/a>{{else}}<a href="Default.aspx?id=${contact.id}&type=people" data-id="${contact.id}"                            id="deal_${id}_person_${contact.id}" class="linkMedium crm-peopleInfoCardLink">${contact.displayName}<\/a>{{/if}}<\/div>{{/if}}<\/td>{{/if}}<td class="dealBidValue"><div>{{if typeof bidValue != "undefined" && bidValue != 0}}<span {{if closedStatusString != ""}} class="gray-text" {{/if}}>{{html bidNumberFormat}}<\/span><span class=\'describe-text\'>&nbsp;${bidCurrency.abbreviation}<\/span>{{if typeof bidType != "undefined" && bidType != 0}}<div style="height:4px;">&nbsp;<\/div><span class=\'text-medium-describe\'>${ASC.CRM.ListDealView.expectedValue(bidType, perPeriodValue)}<\/span>{{/if}}            {{/if}}<\/div><\/td>{{if ASC.CRM.DealTabView.contactID == 0}}<td><div id="dealMenu_${id}" class="entity-menu" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><\/td>{{/if}}<\/tr>');jQuery.template("bidFormat","{{html number}}<span class='describe-text'>&nbsp;${abbreviation}<\/span><br/>");jQuery.template("ratesTableTmpl",'<colgroup><col style="width:30px;" /><col style="width:22px;" /><col /><col style="width:30px;" /><col style="width:22px;" /><col /><\/colgroup><tbody>{{each currencyRates}}        {{if $index%2 == 0}}<tr>{{/if}}<td><i class="b-fg b-fg_${this.cultureName}"><img src="${StudioManager.GetCRMImage(\'fg.png\')}"                        alt="${this.abbreviation}" title="${this.title}"/><\/i><\/td><td class="header-base-small" title="${this.title}">${this.abbreviation}<\/td><td class="rateValue" id="${this.abbreviation}" style="{{if $index%2 == 1}}padding-right:20px;{{else}}padding-right:35px;{{/if}}">${this.rate}<\/td>{{if $index%2 == 1}}<\/tr>{{/if}}    {{/each}}<\/tbody>');jQuery.template("exchangeRateViewTmpl",'<div id="ExchangeRateTabs"><\/div><div id="totalAmountTab"><div id="totalAmountContent"><table cellpadding="0" cellspacing="0" id="totalOnPage"><tr><td class="header-base-medium" style="width: 100%;">${ASC.CRM.Resources.CRMDealResource.TotalOnPage}:<\/td><td style="white-space: nowrap;padding-left: 22px"><div class="diferrentBids"><\/div><div class="totalBidAndExchangeRateLink" style="display:none;"><div class="h_line" style="margin-top: 5px; margin-bottom: 5px;">&nbsp;<\/div><div class="totalBid"><\/div><\/div><\/td><\/tr><\/table><\/div><\/div><div id="converterTab"><div id="convertRateContent"><dl><dt class="header-base-small">${ASC.CRM.Resources.CRMCommonResource.EnterAmount}:<\/dt><dd><input class="textEdit" type="text" id="amount"/><\/dd><dt class="header-base-small">${ASC.CRM.Resources.CRMCommonResource.From}:<\/dt><dd><select id="fromCurrency" onchange="ASC.CRM.ExchangeRateView.changeCurrency();" class="comboBox"><\/select><\/dd><dt class="header-base-small">${ASC.CRM.Resources.CRMCommonResource.To}:<\/dt><dd><select id="toCurrency" onchange="ASC.CRM.ExchangeRateView.changeCurrency();" class="comboBox"><\/select><div class="h_line">&nbsp;<\/div><\/dd><\/dl><table cellpadding="2" cellspacing="0" border="0"><tr><td class="header-base-small" style="text-align: right;" id="introducedFromCurrency"><\/td><td class="header-base-medium" id="introducedAmount"><\/td><\/tr><tr><td class="header-base-small" style="text-align: right;">${ASC.CRM.Resources.CRMCommonResource.ConversionRate}:<\/td><td class="header-base-medium" id="conversionRate"><\/td><\/tr><tr><td class="header-base-small" id="introducedToCurrency" style="text-align: right;"><\/td><td class="header-base-medium" id="conversionResult"><\/td><\/tr><\/table><\/div><\/div><div id="exchangeTab"><div id="exchangeRateContent"><select onchange="ASC.CRM.ExchangeRateView.updateSummaryTable(this.value);" style="width: 100%;" class="comboBox"><\/select><div class="ratesTableContainer"><table class="table-list padding4" cellpadding="0" cellspacing="0" id="ratesTable"><\/table><\/div><\/div><\/div><div class="action_block clearFix" style="margin-top: 15px;"><div style="display:inline-block;"><span class="header-base-small">${ASC.CRM.Resources.CRMCommonResource.ConversionDate}<\/span>:&nbsp;${ratesPublisherDisplayDate}<\/div><div style="float: right;"><span class="text-medium-describe">${ASC.CRM.Resources.CRMCommonResource.InformationProvidedBy}<\/span>&nbsp;<a class="link blue bold" href="https://themoneyconverter.com/" target="_blank">The Money Converter.com<\/a><\/div><div class="middle-button-container"><a class="button gray" href="javascript:void(0)" onclick="PopupKeyUpActionProvider.EnableEsc = true; jq.unblockUI();">${ASC.CRM.Resources.CRMCommonResource.CloseThisWindow}<\/a><\/div><\/div>');
jQuery.template("dealSelectorContainerTmpl",'<div id="selector_${ObjName}"><table class="contactSelector-inputContainer" width="100%" style="height: 18px;" cellspacing="0" cellpadding="1" ><tbody><tr><td class="borderBase" style="border-right: 0 none; width: 16px"><label class="searchButton"><\/label><img class="loaderImg" src="${StudioManager.GetImage(\'loader_16.gif\')}" style="display:none;"/><\/td><td class="borderBase" style="border-left: 0 none; border-right: 0 none;"><input class="textEdit" type="text" value="" placeholder="${Description}" autocomplete="off"/><\/td><td class="borderBase" style="border-left: 0 none; width: 16px"><label class="crossButton" style="display:none;"><\/label><\/td><\/tr><\/tbody><\/table><div class="borderBase noMatches"><div>${ASC.CRM.Resources.CRMCommonResource.NoMatches}<\/div><div><a class="link blue dotline small plus">${ASC.CRM.Resources.CRMDealResource.AddNewDeal}<\/a><\/div><\/div><\/div>');
jQuery.template("simpleContactTmpl",'<tr id="contactItem_${id}" {{if typeof showActionMenu !== "undefined" && showActionMenu === true}}class="with-entity-menu"{{/if}}><td style="width:40px;"><div class="contactItemPhotoImgContainer{{if isShared === true}} sharedContact{{/if}}">{{if isCompany == true}}<img class="contactItemPhotoImg" src="${ASC.CRM.Data.SmallSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${smallFotoUrl}\');" />{{else}}<img class="contactItemPhotoImg" src="${ASC.CRM.Data.SmallSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${smallFotoUrl}\');" />{{/if}}<img class="contactItemPhotoImg" style="display:none;" alt="${displayName}" title="${displayName}"/><\/div><\/td><td class="main-info-contact" style="width:50%;"><div class="contactTitle">{{if typeof(id)=="number"}}<a class="linkHeaderMedium" href="${contactLink}">${displayName}<\/a>{{else}}<span class="header-base-small">${displayName}<\/span>{{/if}}<\/div>{{if isCompany == false && typeof (company) != "undefined" && company != null && showCompanyLink}}<div class="contactTitle">${ASC.CRM.Resources.CRMContactResource.Company}:<a href="${company.contactLink}" data-id="${company.id}" id="contact_${id}_company_${company.id}" class="linkMedium crm-companyInfoCardLink">${company.displayName}<\/a><\/div>{{/if}}<\/td><td class="contact-info-contact"><div class="primaryDataContainer">{{each(i, item) commonData}}                    {{if item.infoType == 0 && item.isPrimary}}<span title="${item.data}">${item.data}<\/span>{{/if}}                {{/each}}<\/div><div class="primaryDataContainer">{{each(i, item) commonData}}                    {{if item.infoType == 1 && item.isPrimary}}<a title="${item.data}" href="mailto:${item.data}" class="linkMedium">${item.data}<\/a>{{/if}}                {{/each}}<\/div><\/td><td style="width:25px;">{{if typeof showActionMenu !== "undefined" && showActionMenu === true}}<div title="${ASC.CRM.Resources.CRMCommonResource.Actions}" class="entity-menu" id="simpleContactMenu_${id}"                    data-displayName="${displayName}"                     data-email="{{if primaryEmail !== null}}${primaryEmail.data}{{/if}}"                ><\/div>{{else typeof showUnlinkBtn !== "undefined" && showUnlinkBtn === true}}<img src="${StudioManager.GetImage(\'unlink_16.png\')}"               class="contact-info-link-img"               title="${ASC.CRM.Resources.CRMCommonResource.UnlinkContact}"               onclick=\'ASC.CRM.ListContactView.removeMember({{if typeof(id)=="number"}}${id}{{else}}"${id}"{{/if}});\'               id="trashImg_${id}" /><div id="loaderImg_${id}" class="loader-middle baseList_loaderImg"><\/div>{{/if}}<\/td><\/tr>');jQuery.template("simpleContactActionMenuTmpl",'<div id="simpleContactActionMenu" class="studio-action-panel"><ul class="dropdown-content"><li><a class="unlinkContact dropdown-item with-icon unlink">${ASC.CRM.Resources.CRMCommonResource.UnlinkContact}<\/a><\/li><li><a class="writeEmail dropdown-item with-icon email">${ASC.CRM.Resources.CRMContactResource.WriteEmail}<\/a><\/li><li><a class="viewMailingHistory dropdown-item with-icon history">${ASC.CRM.Resources.CRMCommonResource.ViewMailingHistoryWithParticipant}<\/a><\/li><\/ul><\/div>');
jQuery.template("tasksListFilterTmpl",'<div id="taskFilterContainer"><div id="tasksAdvansedFilter"><\/div><\/div><div id="hiddenBlockForTaskContactSelector" style="display:none;"><span id="taskContactSelectorForFilter" class="custom-value"><span class="inner-text"><span class="value">${ASC.CRM.Resources.CRMCommonResource.Select}<\/span><\/span><\/span><\/div>');jQuery.template("taskExtendedListTmpl",'<div id="taskList"  style="display:none;{{if IsTab === false}}min-height: 400px;{{else}}min-height: 200px;{{/if}}"><table id="taskTable" class="table-list padding4" cellpadding="0" cellspacing="0"><colgroup><col style="width: 55px;" /><col style="width: 30px;" /><col /><col style="width: 150px;" /><col style="width: 120px;" /><col style="width: 40px;" /><\/colgroup><tbody><\/tbody><\/table><\/div><div id="taskStatusListContainer" class="studio-action-panel" taskid=""><ul class="dropdown-content"><li class="open"><a class="dropdown-item">${ASC.CRM.Resources.CRMTaskResource.TaskStatus_Open}<\/a><\/li><li class="closed"><a class="dropdown-item">${ASC.CRM.Resources.CRMTaskResource.TaskStatus_Closed}<\/a><\/li><\/ul><\/div><div id="taskActionMenu" class="studio-action-panel"><ul class="dropdown-content"><li><a class="dropdown-item with-icon email display-none" id="sendEmailLink" target="_blank">${ASC.CRM.Resources.CRMCommonResource.SendEmail}<\/a><\/li><li><a class="dropdown-item with-icon edit" id="editTaskLink">${ASC.CRM.Resources.CRMTaskResource.EditTask}<\/a><\/li><li><a class="dropdown-item with-icon delete" id="deleteTaskLink">${ASC.CRM.Resources.CRMTaskResource.DeleteTask}<\/a><\/li><\/ul><\/div><div id="confirmationDeleteOneTaskPanel" style="display: none;"><div class="popupContainerClass"><div class="containerHeaderBlock"><table cellspacing="0" cellpadding="0" border="0" style="width:100%; height:0px;"><tbody><tr valign="top"><td>${ASC.CRM.Resources.CRMCommonResource.Confirmation}<\/td><td class="popupCancel"><div class="cancelButton" onclick="PopupKeyUpActionProvider.CloseDialog();">&times;<\/div><\/td><\/tr><\/tbody><\/table><\/div><div class="containerBodyBlock"><div class="confirmationAction"><b>${ASC.CRM.Resources.CRMJSResource.ConfirmDeleteTask}<\/b><\/div><div class="confirmationNote">${ASC.CRM.Resources.CRMJSResource.DeleteConfirmNote}<\/div><div class="middle-button-container"><a class="button blue middle">${ASC.CRM.Resources.CRMCommonResource.OK}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle" onclick="PopupKeyUpActionProvider.EnableEsc = true; jq.unblockUI();" >${ASC.CRM.Resources.CRMCommonResource.Cancel}<\/a><\/div><\/div><\/div><\/div><div id="files_hintCategoriesPanel" class="hintDescriptionPanel">${ASC.CRM.Resources.CRMTaskResource.TooltipCategories}    {{if ASC.Resources.Master.HelpLink}}<a href="${ASC.Resources.Master.HelpLink}/tipstricks/tasks-categories.aspx" target="_blank">${ASC.CRM.Resources.CRMCommonResource.ButtonLearnMore}<\/a>{{/if}}<\/div>');jQuery.template("tasksListPagingTmpl",'<table id="tableForTaskNavigation" class="crm-navigationPanel" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td><div id="divForTaskPager"><\/div><\/td><td style="text-align:right;"><span class="gray-text">${ASC.CRM.Resources.CRMTaskResource.TotalTasks}:&nbsp;<\/span><span class="gray-text" id="totalTasksOnPage"><\/span><span class="gray-text">${ASC.CRM.Resources.CRMCommonResource.ShowOnPage}:&nbsp;<\/span><select class="top-align"><option value="25">25<\/option><option value="50">50<\/option><option value="75">75<\/option><option value="100">100<\/option><\/select><\/td><\/tr><\/tbody><\/table>');jQuery.template("taskListTmpl",'<tbody>{{tmpl(tasks) "taskTmpl"}}<\/tbody>');jQuery.template("taskTmpl",'<tr id="task_${id}" class="with-entity-menu"><td><div class="check"><div class="changeStatusCombobox{{if canEdit == true}} canEdit{{/if}}" taskid="${id}">{{if isClosed == true}}<span class="closed" title="${ASC.CRM.Resources.CRMTaskResource.TaskStatus_Closed}"><\/span>{{else}}<span class="open" title="${ASC.CRM.Resources.CRMTaskResource.TaskStatus_Open}"><\/span>{{/if}}<\/div><\/div><div class="ajax_edit_task loader-big" title=""><\/div><\/td><td><label class="task_category ${category.cssClass}" title="${category.title}" alt="${category.title}"><\/label><\/td><td><div class="divForTaskTitle"><span id="taskTitle_${id}" class="${classForTitle}"                    dscr_label="${ASC.CRM.Resources.CRMCommonResource.Description}" dscr_value="${description}">${title}<\/span><\/div><div style="padding-top: 5px; display: inline-block;"><span class="${classForTaskDeadline}">${deadLineString}<\/span><\/div><\/td><td style="white-space:nowrap; padding-right:15px;">{{if entity != null && ASC.CRM.ListTaskView.EntityID == 0}}<div class="divForEntity">${entityType}:<a class="linkMedium" href="${entityURL}">${entity.entityTitle}<\/a><\/div>{{/if}}            {{if contact != null && ASC.CRM.ListTaskView.ContactID != contact.id}}<div class="divForEntity" {{if entity != null}} style="padding-top: 5px;" {{/if}}>{{if contact.isCompany == true}}<a href="Default.aspx?id=${contact.id}" data-id="${contact.id}" id="task_${id}_company_${contact.id}" class="linkMedium crm-companyInfoCardLink">${contact.displayName}<\/a>{{else}}<a href="Default.aspx?id=${contact.id}&type=people" data-id="${contact.id}" id="task_${id}_person_${contact.id}" class="linkMedium crm-peopleInfoCardLink">${contact.displayName}<\/a>{{/if}}<\/div>{{/if}}<\/td><td><div class="divForUser{{if responsible.activationStatus == 2}} removedUser{{/if}}"><span title="${responsible.displayName}" resp_id="${responsible.id}">${responsible.displayName}<\/span><\/div><\/td><td>{{if canEdit == true}}<div id="taskMenu_${id}" class="entity-menu" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"                 onclick="ASC.CRM.ListTaskView.showActionMenu(${id});" ><\/div>{{/if}}<\/td><\/tr>');jQuery.template("taskActionViewTmpl",'<div class="headerPanelSmall-splitter requiredField"><span class="requiredErrorText"><\/span><div class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMTaskResource.TaskTitle}:<\/div><input class="textEdit" id="tbxTitle" style="width:100%" type="text" maxlength="255"/><\/div><div id="taskCategorySelectorContainer" class="headerPanelSmall-splitter"><div class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMTaskResource.TaskCategory}:<\/div><\/div><div class="headerPanelSmall-splitter"><div class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMTaskResource.ConnectWithAContact}:<\/div><div class="connectWithContactContainer"><\/div><\/div><div class="headerPanelSmall-splitter requiredField" id="taskDeadlineContainer"><span class="requiredErrorText"><\/span><div class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMTaskResource.DueDate}:<\/div><a id="deadline_0" class="baseLinkAction linkMedium" onclick="ASC.CRM.TaskActionView.changeDeadline(this);">${ASC.CRM.Resources.CRMTaskResource.Today}<\/a><span class="splitter"><\/span><a id="deadline_3" class="baseLinkAction linkMedium" onclick="ASC.CRM.TaskActionView.changeDeadline(this);">${ASC.CRM.Resources.CRMTaskResource.ThreeDays}<\/a><span class="splitter"><\/span><a id="deadline_7" class="baseLinkAction linkMedium" onclick="ASC.CRM.TaskActionView.changeDeadline(this);">${ASC.CRM.Resources.CRMTaskResource.Week}<\/a><span class="splitter"><\/span><input id="taskDeadline" type="text" onkeypress="ASC.CRM.TaskActionView.keyPress(event);" class="pm-ntextbox textEditCalendar" autocomplete="off"/><span class="splitter"><\/span><span class="bold">${ASC.CRM.Resources.CRMTaskResource.Time}:<\/span><span class="splitter"><\/span><select class="comboBox" id="taskDeadlineHours" style="width:45px;" onchange="ASC.CRM.TaskActionView.changeTime(this);"><\/select><b style="padding: 0 3px;">:<\/b><select class="comboBox" id="taskDeadlineMinutes" style="width:45px;" onchange="ASC.CRM.TaskActionView.changeTime(this);"><\/select><\/div><div class="headerPanelSmall-splitter"><div class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMCommonResource.Alert}:<\/div><div><select class="comboBox" id="taskAlertInterval"><option value="0" id="optAlert_0">${ASC.CRM.Resources.CRMTaskResource.Never}<\/option><option value="5" id="optAlert_5">${ASC.CRM.Resources.CRMTaskResource.PerFiveMinutes}<\/option><option value="15" id="optAlert_15">${ASC.CRM.Resources.CRMTaskResource.PerFifteenMinutes}<\/option><option value="30" id="optAlert_30">${ASC.CRM.Resources.CRMTaskResource.PerHalfHour}<\/option><option value="60" id="optAlert_60">${ASC.CRM.Resources.CRMTaskResource.PerHour}<\/option><option value="120" id="optAlert_120">${ASC.CRM.Resources.CRMTaskResource.PerTwoHours}<\/option><option value="1440" id="optAlert_1440" selected="selected">${ASC.CRM.Resources.CRMTaskResource.PerNight}<\/option><\/select><\/div><\/div><div class="headerPanelSmall-splitter requiredField"><span class="requiredErrorText"><\/span><div class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMTaskResource.TaskResponsible}:<\/div><div><div id="taskActionViewAdvUsrSrContainer" data-responsible-id=""><span><a class="link dotline taskResponsibleLabel"><\/a><span class="sort-down-black"><\/span><\/span><\/div><div class="taskActionViewNotifyResponsibleContainer"><input type="checkbox" id="notifyResponsible" /><label for="notifyResponsible">${ASC.CRM.Resources.CRMCommonResource.Notify}<\/label><\/div><\/div><\/div><div><div class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMTaskResource.TaskDescription}:<\/div><textarea id="tbxDescribe" style="width:100%;resize:none;" rows="3" cols="70"><\/textarea><\/div><div class="error-popup display-none"><\/div><div class="big-button-container"><a id="taskActionPopupOK" class="button blue middle">${ASC.CRM.Resources.CRMJSResource.AddThisTask}<\/a><span class="splitter-buttons"><\/span><a id="taskActionPopupCancel" class="button gray middle" onclick="PopupKeyUpActionProvider.EnableEsc = true; jq.unblockUI();">${ASC.CRM.Resources.CRMTaskResource.Cancel}<\/a><\/div>');
jQuery.template("contactSelectorContainerTmpl",'<div id="selector_${ObjName}"><div class="contactSelector-itemList"><\/div><\/div>');jQuery.template("contactSelectorRowTmpl",'<div id="item_${ObjID}" class="contactSelector-item">{{tmpl "contactSelectorContentTmpl"}}    {{if ShowOnlySelectorContent === false}}        {{tmpl "contactSelectorContactInfoContentTmpl"}}    {{/if}}    {{if ShowNewCompanyContent === true||ShowNewContactContent === true}}        {{tmpl "contactSelectorNewContactContentTmpl"}}    {{/if}}<\/div>');jQuery.template("contactSelectorContentTmpl",'<div id="selectorContent_${ObjID}" class="contactSelector-selectorContent" style="{{if ShowOnlySelectorContent===false&&selectedContact != null}}display:none;{{/if}}"><table cellspacing="0" cellpadding="1" class="contactSelector-inputContainer" width="100%" style="height: 18px;"><tbody><tr><td width="16px" class="borderBase" style="border-right: 0 none;"><label class="searchButton" id="searchImg_${ObjID}" onclick="window.${ObjName}.quickSearch(\'${ObjID}\');"><\/label><img align="absmiddle" id="loaderImg_${ObjID}" src="${StudioManager.GetImage(\'loader_16.gif\')}" style="display:none;"/><\/td><td class="borderBase" style="border-left: 0 none; border-right: 0 none;"><input type="text" id="contactTitle_${ObjID}" value="" class="textEdit" placeholder="${WatermarkText}" autocomplete="off"/><input type="hidden" id="contactID_${ObjID}" value="{{if selectedContact != null}}${selectedContact.id}{{/if}}"/><\/td><td width="16px" class="borderBase" style="border-left: 0 none;"><label class="crossButton" style="display:none;" onclick="window.${ObjName}.crossButtonEventClick(\'${ObjID}\');"                     title="${ASC.CRM.Resources.CRMCommonResource.Cancel}"><\/label><\/td>{{if ShowDeleteButton === true}}<td width="16px;"><a class="crm-deleteLink" title="${DeleteContactText}" onclick="window.${ObjName}.deleteContact(\'${ObjID}\');">&nbsp;<\/a><\/td>{{/if}}                {{if ShowAddButton === true}}<td width="16px;"><a title="${AddButtonText}" class="crm-addNewLink" onclick="window.${ObjName}.AddNewSelector(jq(this));">&nbsp;<\/a><\/td>{{/if}}<\/tr><\/tbody><\/table>{{tmpl "contactSelectorNoMatchesTmpl"}}<\/div>');jQuery.template("contactSelectorNoMatchesTmpl",'<div id="noMatches_${ObjID}" class="borderBase noMatches"><div>${ASC.CRM.Resources.CRMCommonResource.NoMatches}<\/div>{{if ShowNewCompanyContent === true}}<div><a class="link blue dotline small plus" onclick="window.${ObjName}.showNewCompany(\'${ObjID}\');">${ASC.CRM.Resources.CRMContactResource.AddNewCompany}<\/a><\/div>{{/if}}    {{if ShowNewContactContent === true}}<div><a class="link blue dotline small plus" onclick="window.${ObjName}.showNewContact(\'${ObjID}\');">${ASC.CRM.Resources.CRMContactResource.AddNewContact}<\/a><\/div>{{/if}}<\/div>');jQuery.template("contactSelectorContactInfoContentTmpl",'<div id="infoContent_${ObjID}" {{if selectedContact==null}}style="display: none;"{{/if}}><table width="100%" cellspacing="0" cellpadding="3"><tbody><tr>{{if ShowContactImg === true}}<td width="40px"><img src="{{if selectedContact != null}}${selectedContact.smallFotoUrl}{{/if}}" /><\/td>{{/if}}<td><span class="splitter"><b>{{if selectedContact != null}}${selectedContact.displayName}{{/if}}<\/b><\/span>{{if ShowChangeButton === true}}<a class="crm-removeLink" title="${ASC.CRM.Resources.CRMCommonResource.UnlinkContact}" onclick="window.${ObjName}.changeContact(\'${ObjID}\');">&nbsp;<\/a>{{/if}}                                        {{if ShowDeleteButton === true}}<a class="crm-deleteLink" title="${DeleteContactText}" onclick="window.${ObjName}.deleteContact(\'${ObjID}\');">&nbsp;<\/a>{{/if}}                    {{if ShowAddButton === true}}<a title="${AddButtonText}" class="crm-addNewLink" onclick="window.${ObjName}.AddNewSelector(jq(this));">&nbsp;<\/a>{{/if}}<\/td><\/tr><\/tbody><\/table><\/div>');jQuery.template("contactSelectorNewContactContentTmpl",'<div id="newContactContent_${ObjID}" style="display: none;"><table width="100%" cellspacing="0" cellpadding="3"><tbody><tr><td width="40px">{{if ShowNewCompanyContent === true}}<img id="newCompanyImg_${ObjID}" src="${ASC.CRM.Data.SmallSizePhotoCompany}" />{{/if}}                    {{if ShowNewContactContent === true}}<img id="newContactImg_${ObjID}" src="${ASC.CRM.Data.SmallSizePhoto}" style="display:none;"/>{{/if}}<input type="hidden" id="hiddenIsCompany_${ObjID}" /><\/td><td class="name-container-block"><span class="splitter">{{if ShowNewCompanyContent === true}}<input type="text" id="newCompanyTitle_${ObjID}" class="textEdit" placeholder="${ASC.CRM.Resources.CRMContactResource.CompanyName}" autocomplete="off"/>{{/if}}                    {{if ShowNewContactContent === true}}<input type="text" id="newContactFirstName_${ObjID}" class="textEdit" placeholder="${ASC.CRM.Resources.CRMContactResource.FirstName}" autocomplete="off" style="display:none;"/><span class="splitter"><\/span><input type="text" id="newContactLastName_${ObjID}" class="textEdit" placeholder="${ASC.CRM.Resources.CRMContactResource.LastName}" autocomplete="off" style="display:none;"/>{{/if}}<\/span><a class="crm-acceptLink" title="${ASC.CRM.Resources.CRMCommonResource.Add}" onclick="window.${ObjName}.acceptNewContact(\'${ObjID}\');">&nbsp;<\/a><a class="crm-rejectLink" title="${ASC.CRM.Resources.CRMCommonResource.Cancel}" onclick="window.${ObjName}.rejectNewContact(\'${ObjID}\');">&nbsp;<\/a>{{if ShowAddButton === true}}<a title="${AddButtonText}" class="crm-addNewLink" onclick="window.${ObjName}.AddNewSelector(jq(this));">&nbsp;<\/a>{{/if}}<\/td><\/tr><\/tbody><\/table><\/div>');
jQuery.template("contactInfoCardResourcesTmpl",'<div id="contactInfoCardResources" class="display-none"        data-one="${ASC.CRM.Resources.CRMJSResource.OneContact}"        data-no="${ASC.CRM.Resources.CRMJSResource.NoContacts}"        data-many="${ASC.CRM.Resources.CRMJSResource.ManyContacts}"><\/div>');jQuery.template("contactInfoCardTmpl",'<div class="crm-contactInfoCard" id="contactInfoCard_${id}">{{if isPrivateForMe == false}}<a href="${contactLink}">{{if isCompany == true}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto;" src="${ASC.CRM.Data.MediumSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{else}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto;" src="${ASC.CRM.Data.MediumSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{/if}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto;display:none;" alt="${displayName}" title="${displayName}"/><\/a>{{else}}        {{if isCompany == true}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto 10px; float: left;" src="${ASC.CRM.Data.MediumSizePhotoCompany}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{else}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto 10px; float: left;" src="${ASC.CRM.Data.MediumSizePhoto}" alt="${displayName}" title="${displayName}" onload="ASC.CRM.Common.loadContactFoto(jq(this), jq(this).next(), \'${mediumFotoUrl}\');" />{{/if}}<img class="crm-contactInfoCardImg" border="0" style="margin: 0 auto 10px; float: left;display:none;" alt="${displayName}" title="${displayName}"/>{{/if}}<div class="infoCardContent">{{if isPrivateForMe == true}}<label class="crm-private-lock"><\/label><span class="crm-task-title header-base-medium">${displayName}<\/span>{{else}}<a title="${displayName}" class="linkHeader" style="display: inline-block;                margin-bottom: 6px;text-decoration: underline;" href="${contactLink}">${displayName}<\/a>{{if isCompany == true && typeof(personsCount) != "undefined"}}<div class="personsCountString" style="margin-bottom: 6px;" data-one="${ASC.CRM.Resources.CRMJSResource.OneContact}" data-no="${ASC.CRM.Resources.CRMJSResource.NoContacts}" data-many="${ASC.CRM.Resources.CRMJSResource.ManyContacts}">{{if personsCount == 0}}                    ${jq("#contactInfoCardResources").attr("data-no")}                {{else personsCount == 1}}                    1 ${jq("#contactInfoCardResources").attr("data-one")}                {{else}}                    ${personsCount} ${jq("#contactInfoCardResources").attr("data-many")}                {{/if}}<\/div>{{else}}<div style="margin-bottom: 6px;">${title}<\/div>{{/if}}<ul>{{each(i, item) commonData}}                    {{if item.infoType == 1 && item.isPrimary}}<li><div class="crm-email"><a class="linkMedium" href="mailto:${item.data}">${item.data}<\/a>&nbsp;<span class="text-medium-describe">(${item.categoryName})<\/span><\/div><\/li>{{/if}}                    {{if item.infoType == 0 && item.isPrimary}}<li><div class="crm-phone">${item.data}&nbsp;<span class="text-medium-describe">(${item.categoryName})<\/span><\/div><\/li>{{/if}}                {{/each}}                {{if typeof (primaryAddress) != "undefined" && primaryAddress != null}}<li><div class="crm-address">{{html primaryAddress.Data}}&nbsp;<span class="text-medium-describe">(${primaryAddress.categoryName})<\/span><br/><a class="linkMedium" style="text-decoration: underline;" href="${primaryAddress.Href}" target="_blank">${ASC.CRM.Resources.CRMContactResource.ShowOnMap}<\/a><\/div><\/li>{{/if}}<\/ul>{{/if}}<\/div><\/div>');
jQuery.template("customFieldSettingsRowTmpl",'{{if fieldType ==  3}}<li class="with-entity-menu"><table class="field_row" cellspacing="0" cellpadding="0"><tbody><tr><td class="" style="width:6px; background: #FFFFFF"><div class="sort_drag_handle borderBase">&nbsp;<\/div><\/td><td class="borderBase" style="width:200px;"><\/td><td class="borderBase"><label>{{tmpl "customFieldSettingsTmpl"}}<span class="customFieldTitle">${label}<\/span><\/label><\/td><td class="borderBase count_link_contacts gray-text" style="width:100px;">${relativeItemsString}<\/td><td class="borderBase" style="width:30px;"><div id="fieldMenu_${id}" fieldid="${id}" class="entity-menu" data-relativeitemscount="${relativeItemsCount}" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><div class="ajax_loader loader-middle" title="">&nbsp;<\/div><\/td><\/tr><\/tbody><\/table><\/li>{{else fieldType ==  4}}<li class="expand_collapce_element with-entity-menu"><table class="field_row" cellspacing="0" cellpadding="0" border="0" width="100%"><tbody><tr><td class="" style="width:6px; background: #FFFFFF"><div class="sort_drag_handle borderBase">&nbsp;<\/div><\/td><td class="borderBase" style="padding-left: 10px">{{tmpl "customFieldSettingsTmpl"}}<\/td><td class="borderBase count_link_contacts" style="width:100px;"><\/td><td class="borderBase" style="width:30px;"><div id="fieldMenu_${id}" fieldid="${id}" class="entity-menu" data-relativeitemscount="${relativeItemsCount}" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><div class="ajax_loader loader-middle" title="">&nbsp;<\/div><\/td><\/tr><\/tbody><\/table><\/li>{{else}}<li class="with-entity-menu"><table class="field_row" cellspacing="0" cellpadding="0" border="0" width="100%"><tbody><tr><td class="" style="width:6px; background: #FFFFFF"><div class="sort_drag_handle borderBase">&nbsp;<\/div><\/td><td class="header-base-small borderBase customFieldTitle" style="width:200px; padding-left:10px;"><div class="text-overflow" style="width:200px;overflow:hidden;" title="${label}">${label}<\/div><\/td><td class="borderBase">{{tmpl "customFieldSettingsTmpl"}}<\/td><td class="borderBase count_link_contacts gray-text" style="width:100px;">${relativeItemsString}<\/td><td class="borderBase" style="width:30px;"><div id="fieldMenu_${id}" fieldid="${id}" class="entity-menu" data-relativeitemscount="${relativeItemsCount}" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><div class="ajax_loader loader-middle" title="">&nbsp;<\/div><\/td><\/tr><\/tbody><\/table><\/li>{{/if}}');jQuery.template("customFieldSettingsTmpl",'{{if fieldType ==  0}}<input id="custom_field_${id}" name="custom_field_${id}" size="${(maskObj.size >120 ? 120 : maskObj.size)}" type="text" class="textEdit">    {{else fieldType ==  1}}<textarea rows="${(maskObj.rows >25 ? 25 : maskObj.rows)}" cols="${(maskObj.cols > 120 ? 120 : maskObj.cols)}" name="custom_field_${id}" id="custom_field_${id}"><\/textarea>{{else fieldType ==  2}}<select class="comboBox" name="custom_field_${id}" id="custom_field_${id}" disabled="disabled">{{if maskObj}}            {{each maskObj}}<option value="${$value}">${$value}<\/option>{{/each}}          {{/if}}<\/select>{{else fieldType ==  3}}<input name="custom_field_${id}" id="custom_field_${id}" type="checkbox" style="vertical-align: middle;" disabled="disabled"/>{{else fieldType ==  4}}<span id="custom_field_${id}" class="header-base headerExpand customFieldTitle" onclick="ASC.CRM.SettingsPage.toggleCollapceExpand(this)">${label}<\/span>{{else fieldType ==  5}}<input type="text" id="custom_field_${id}"  name="custom_field_${id}" class="textEdit textEditCalendar" autocomplete="off"/>{{/if}}');jQuery.template("customFieldActionPanelBodyTmpl",'<div><dl><dt><\/dt><dd><div class="requiredField"><span class="requiredErrorText">${ASC.CRM.Resources.CRMSettingResource.EmptyLabelError}<\/span><div class="headerPanelSmall header-base-small" style="margin-bottom:5px;">${ASC.CRM.Resources.CRMSettingResource.Label}:<\/div><input type="text" class="textEdit" maxlength="255"/><\/div><\/dd><dt>${ASC.CRM.Resources.CRMSettingResource.Type}:<\/dt><dd><select onchange="ASC.CRM.SettingsPage.selectTypeEvent(this);" class="comboBox"><option value="0">${ASC.CRM.Resources.CRMSettingResource.TextField}<\/option><option value="1">${ASC.CRM.Resources.CRMSettingResource.TextArea}<\/option><option value="2">${ASC.CRM.Resources.CRMSettingResource.SelectBox}<\/option><option value="3">${ASC.CRM.Resources.CRMSettingResource.CheckBox}<\/option><option value="4">${ASC.CRM.Resources.CRMSettingResource.Heading}<\/option><option value="5">${ASC.CRM.Resources.CRMSettingResource.Date}<\/option><\/select><\/dd><dt class="field_mask text_field" style="display: block;">${ASC.CRM.Resources.CRMSettingResource.Size}:<\/dt><dd class="field_mask text_field" style="display: block;"><input id="text_field_size" class="textEdit" value="" /><\/dd><dt class="field_mask textarea_field">${ASC.CRM.Resources.CRMSettingResource.Rows}:<\/dt><dd class="field_mask textarea_field"><input id="textarea_field_rows" class="textEdit" value="" /><\/dd><dt class="field_mask textarea_field">${ASC.CRM.Resources.CRMSettingResource.Cols}:<\/dt><dd class="field_mask textarea_field"><input id="textarea_field_cols" class="textEdit" value="" /><\/dd><dt class="field_mask select_options">${ASC.CRM.Resources.CRMSettingResource.SelectOptions}:<\/dt><dd class="field_mask select_options"><ul><li style="display: none"><input type="text" class="textEdit" maxlength="255"/><label class="deleteBtn"                        alt="${ASC.CRM.Resources.CRMSettingResource.RemoveOption}" title="${ASC.CRM.Resources.CRMSettingResource.RemoveOption}"                        onclick="jq(this).parent().remove()"><\/label><\/li><\/ul><span onclick="ASC.CRM.SettingsPage.toSelectBox(this)" title="${ASC.CRM.Resources.CRMSettingResource.AddOption}"                id="addOptionButton" class="baseLinkAction">${ASC.CRM.Resources.CRMSettingResource.AddOption}<\/span><\/dd><\/dl><\/div>');jQuery.template("dealMilestoneTmpl",'<li id="deal_milestone_id_${id}" class="with-entity-menu"><table class="deal_milestone_row" cellspacing="0" cellpadding="0"><tbody><tr><td class="" style="width:6px; background: #FFFFFF"><div class="sort_drag_handle borderBase">&nbsp;<\/div><\/td><td class="borderBase" style="width:25px;"><div class="currentColor" style="background:${color}" onclick="ASC.CRM.DealMilestoneView.showColorsPanel(this);"><\/div><\/td><td class="header-base-small borderBase deal_milestone_title" style="width:200px;">${title}<\/td><td class="borderBase">{{if stageType == 1}}                        ${ASC.CRM.Resources.CRMSettingResource.DealMilestoneStatusDescription_ClosedAndWon}                        {{else stageType == 2}}                        ${ASC.CRM.Resources.CRMSettingResource.DealMilestoneStatusDescription_ClosedAndLost}                        {{/if}}                        {{html jq.htmlEncodeLight(description).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}<td class="borderBase" style="width:60px; text-align: center;">${successProbability}%<\/td><td class="borderBase count_link_items" style="width:100px;"><a class="gray-text" href="${relativeItemsUrl}">${relativeItemsString}<\/a><\/td><td class="borderBase" style="width:30px;">{{if relativeItemsCount == 0}}<div id="deal_milestone_menu_${id}" dealmilestoneid="${id}" class="entity-menu" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><div class="ajax_loader loader-middle" title="">&nbsp;<\/div>{{/if}}<\/td><\/tr><\/tbody><\/table><\/li>');jQuery.template("dealMilestoneActionPanelBodyTmpl",'<div><dl><dt class="selectedColor">&nbsp;<\/dt><dd><span class="baseLinkAction crm-withArrowDown change_color" onclick="ASC.CRM.DealMilestoneView.showColorsPanelToSelect();">${ASC.CRM.Resources.CRMSettingResource.ChangeColor}<\/span><div id="popup_colorsPanel" class="studio-action-panel colorsPanelSettings"><span class="style1" colorstyle="1"><\/span><span class="style2" colorstyle="2"><\/span><span class="style3" colorstyle="3"><\/span><span class="style4" colorstyle="4"><\/span><span class="style5" colorstyle="5"><\/span><span class="style6" colorstyle="6"><\/span><span class="style7" colorstyle="7"><\/span><span class="style8" colorstyle="8"><\/span><span class="style9" colorstyle="9"><\/span><span class="style10" colorstyle="10"><\/span><span class="style11" colorstyle="11"><\/span><span class="style12" colorstyle="12"><\/span><span class="style13" colorstyle="13"><\/span><span class="style14" colorstyle="14"><\/span><span class="style15" colorstyle="15"><\/span><span class="style16" colorstyle="16"><\/span><\/div><\/dd><dt><\/dt><dd><div class="requiredField"><span class="requiredErrorText">${ASC.CRM.Resources.CRMSettingResource.EmptyTitleError}<\/span><div class="headerPanelSmall header-base-small" style="margin-bottom:5px;">${ASC.CRM.Resources.CRMSettingResource.TitleItem}:<\/div><input type="text" class="textEdit title" maxlength="255"/><\/div><\/dd><dt>${ASC.CRM.Resources.CRMSettingResource.Description}:<\/dt><dd><textarea rows="4" style="resize: none;"><\/textarea><\/dd><dt>${ASC.CRM.Resources.CRMSettingResource.Likelihood}:<\/dt><dd><input type="text" class="textEdit probability" style="width: 30px;"  />%<\/dd><dt>${ASC.CRM.Resources.CRMDealResource.DealMilestoneType}:<\/dt><dd><ul><li><input type="radio" id="dealMilestoneStatusOpen" name="deal_milestone_status" value="${ASC.CRM.Resources.DealMilestoneStatus.Open.num}" /><label for="dealMilestoneStatusOpen">${ASC.CRM.Resources.DealMilestoneStatus.Open.str}<\/label><\/li><li><input type="radio" id="dealMilestoneStatusClosedAndWon" name="deal_milestone_status" value="${ASC.CRM.Resources.DealMilestoneStatus.ClosedAndWon.num}"                        onclick="javascript:jq(\'#manageDealMilestone .probability\').val(\'100\');"/><label for="dealMilestoneStatusClosedAndWon">${ASC.CRM.Resources.DealMilestoneStatus.ClosedAndWon.str}<\/label><\/li><li><input type="radio" id="dealMilestoneStatusClosedAndLost" name="deal_milestone_status" value="${ASC.CRM.Resources.DealMilestoneStatus.ClosedAndLost.num}"                        onclick="javascript:jq(\'#manageDealMilestone .probability\').val(\'0\');"/><label for="dealMilestoneStatusClosedAndLost">${ASC.CRM.Resources.DealMilestoneStatus.ClosedAndLost.str}<\/label><\/li><\/ul><\/dd><\/dl><\/div>');jQuery.template("listItemsTmpl",'<li id="list_item_id_${id}" class="with-entity-menu"><table cellspacing="0" cellpadding="0"><tbody><tr><td class="" style="width:6px; background: #FFFFFF"><div class="sort_drag_handle borderBase">&nbsp;<\/div><\/td>{{if ASC.CRM.ListItemView.CurrentType === 2 || ASC.CRM.ListItemView.CurrentType === 3}}<td class="borderBase" style="width:36px;"><label data-imgName="${imageName}" title="${imageTitle}"                                class="currentIcon {{if ASC.CRM.ListItemView.CurrentType == 2}}task_category{{else}}event_category{{/if}} ${cssClass}"                                onclick="ASC.CRM.ListItemView.showIconsPanel(this);"><\/label><div class="ajax_change_icon loader-big" title="">&nbsp;<\/div><\/td>{{else ASC.CRM.ListItemView.CurrentType === 1}}<td class="borderBase" style="width:25px;"><div class="currentColor" style="background:${color}" onclick="ASC.CRM.ListItemView.showColorsPanel(this);"                                title="${ASC.CRM.Resources.CRMSettingResource.ChangeColor}"><\/div><\/td>{{/if}}<td class="header-base-small borderBase item_title" style="width:230px;">${title}<\/td><td class="borderBase item_description">{{if ASC.CRM.ListItemView.CurrentType !== 4}}                            {{html jq.htmlEncodeLight(description).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}                        {{/if}}<\/td>{{if ASC.CRM.ListItemView.CurrentType === 3}}<td class="borderBase count_link_items gray-text" style="width:100px;">${relativeItemsString}<\/td>{{else}}<td class="borderBase count_link_items" style="width:100px;"><a class="gray-text" href="${relativeItemsUrl}">${relativeItemsString}<\/a><\/td>{{/if}}<td class="borderBase" style="width:30px;">{{if relativeItemsCount === 0 || ASC.CRM.ListItemView.CurrentType === 2}}<div id="list_item_menu_${id}" class="entity-menu"                            data-listitemid="${id}"                            data-relativecount="${relativeItemsCount}"                            title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><div class="ajax_loader loader-middle" title="">&nbsp;<\/div>{{/if}}<\/td><\/tr><\/tbody><\/table><\/li>');jQuery.template("listViewActionPanelBodyTmpl",'<div><div class="clearFix" style="margin-bottom:10px;">{{if (currentType == 2 || currentType == 3)}}<div style="float: left;"><label class="selectedIcon {{if currentType == 2}}task_category{{else}}event_category{{/if}}" title="" data-imgName=""><\/label><\/div><div style="padding-top: 6px"><span class="baseLinkAction crm-withArrowDown change_icon" onclick="ASC.CRM.ListItemView.showIconsPanelToSelect();">${ASC.CRM.Resources.CRMSettingResource.ChangeIcon}<\/span><\/div>{{if currentType == 2}}<div id="popup_iconsPanel_2" class="iconsPanelSettings studio-action-panel" style="width: 148px;height: 112px;"><label class="task_category task_category_call" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_Call}" data-imgName="task_category_call.png"><\/label><label class="task_category task_category_deal" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_Deal}" data-imgName="task_category_deal.png"><\/label><label class="task_category task_category_demo" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_Demo}" data-imgName="task_category_demo.png"><\/label><label class="task_category task_category_email" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_Email}" data-imgName="task_category_email.png"><\/label><label class="task_category task_category_fax" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_Fax}" data-imgName="task_category_fax.png"><\/label><label class="task_category task_category_follow_up" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_FollowUP}" data-imgName="task_category_follow_up.png"><\/label><label class="task_category task_category_lunch" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_Lunch}" data-imgName="task_category_lunch.png"><\/label><label class="task_category task_category_meeting" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_Meeting}" data-imgName="task_category_meeting.png"><\/label><label class="task_category task_category_note" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_Note}" data-imgName="task_category_note.png"><\/label><label class="task_category task_category_ship" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_Ship}" data-imgName="task_category_ship.png"><\/label><label class="task_category task_category_social_networks" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_SocialNetworks}" data-imgName="task_category_social_networks.png"><\/label><label class="task_category task_category_thank_you" title="${ASC.CRM.Resources.CRMTaskResource.TaskCategory_ThankYou}" data-imgName="task_category_thank_you.png"><\/label><\/div>{{else}}<div id="popup_iconsPanel_3" class="iconsPanelSettings studio-action-panel" style="width: 74px; height: 74px;"><label class="event_category event_category_note" title="${ASC.CRM.Resources.CRMCommonResource.HistoryCategory_Note}" data-imgName="event_category_note.png"><\/label><label class="event_category event_category_email" title="${ASC.CRM.Resources.CRMCommonResource.HistoryCategory_Email}" data-imgName="event_category_email.png"><\/label><label class="event_category event_category_call" title="${ASC.CRM.Resources.CRMCommonResource.HistoryCategory_Call}" data-imgName="event_category_call.png"><\/label><label class="event_category event_category_meeting" title="${ASC.CRM.Resources.CRMCommonResource.HistoryCategory_Meeting}" data-imgName="event_category_meeting.png"><\/label><\/div>{{/if}}        {{else currentType == 1}}<div class="selectedColor">&nbsp;<\/div><span class="baseLinkAction crm-withArrowDown change_color" onclick="ASC.CRM.ListItemView.showColorsPanelToSelect();">${ASC.CRM.Resources.CRMSettingResource.ChangeColor}<\/span><div id="popup_colorsPanel" class="studio-action-panel colorsPanelSettings"><span class="style1" colorstyle="1"><\/span><span class="style2" colorstyle="2"><\/span><span class="style3" colorstyle="3"><\/span><span class="style4" colorstyle="4"><\/span><span class="style5" colorstyle="5"><\/span><span class="style6" colorstyle="6"><\/span><span class="style7" colorstyle="7"><\/span><span class="style8" colorstyle="8"><\/span><span class="style9" colorstyle="9"><\/span><span class="style10" colorstyle="10"><\/span><span class="style11" colorstyle="11"><\/span><span class="style12" colorstyle="12"><\/span><span class="style13" colorstyle="13"><\/span><span class="style14" colorstyle="14"><\/span><span class="style15" colorstyle="15"><\/span><span class="style16" colorstyle="16"><\/span><\/div>{{/if}}<\/div><div class="requiredField" style="margin-bottom:10px;"><span class="requiredErrorText">${ASC.CRM.Resources.CRMSettingResource.EmptyTitleError}<\/span><div style="margin-bottom:5px;" class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMSettingResource.TitleItem}:<\/div><input type="text" class="textEdit" maxlength="255" /><\/div>{{if currentType != 4}}<div><div style="margin-bottom:5px;"><b>${ASC.CRM.Resources.CRMSettingResource.Description}:<\/b><\/div><textarea rows="4" style="resize: none;"><\/textarea><\/div>{{/if}}<\/div>');jQuery.template("deleteUnusedTagsButtonTmpl",'<li><a id="deleteUnusedTagsButton" class="dropdown-item" title="${ASC.CRM.Resources.CRMSettingResource.DeleteUnusedTags}">${ASC.CRM.Resources.CRMSettingResource.DeleteUnusedTags}<\/a><\/li>');jQuery.template("tagRowTemplate",'<li><table class="table-list" cellspacing="0" cellpadding="0"><tbody><tr><td class="header-base-small"><div class="title">${ASC.CRM.Common.convertText(title,true)}<\/div><\/td><td class="count_link_items" style="width:150px;"><a class="gray-text" href="${relativeItemsUrl}">${relativeItemsString}<\/a><\/td><td style="width:40px;"><a class="crm-deleteLink" title="${ASC.CRM.Resources.CRMSettingResource.DeleteTag}" alt="${ASC.CRM.Resources.CRMSettingResource.DeleteTag}"                            onclick=\'ASC.CRM.TagSettingsView.deleteTag(this);\'><\/a><div class="ajax_loader loader-middle" title="">&nbsp;<\/div><\/td><\/tr><\/tbody><\/table><\/li>');jQuery.template("tagSettingsActionPanelBodyTmpl",'<div><div class="requiredField"><span class="requiredErrorText"><\/span><div class="headerPanelSmall header-base-small" style="margin-bottom:5px;">${ASC.CRM.Resources.CRMSettingResource.Label}:<\/div><input id="tagTitle" type="text" class="textEdit" style="width:100%" maxlength="50"/><\/div><\/div>');jQuery.template("templateContainerRow",'<li id="templateContainerHeader_${id}"><table class="templateContainer_row" cellspacing="0" cellpadding="0"><tbody><tr><td class="borderBase"><span onclick="ASC.CRM.TaskTemplateView.toggleCollapceExpand(this)" class="header-base headerExpand">${title}<\/span><\/td><td class="borderBase" style="width:70px;text-align: right;padding-right: 10px;"><a class="crm-addNewLink" align="absmiddle"                            title="${ASC.CRM.Resources.CRMSettingResource.AddNewTaskTemplate}"                            onclick="ASC.CRM.TaskTemplateView.showTemplatePanel(${id})"><\/a><a class="crm-editLink" align="absmiddle"                            title="${ASC.CRM.Resources.CRMSettingResource.EditTaskTemplateContainer}"                            onclick="ASC.CRM.TaskTemplateView.showTemplateConatainerPanel(${id})"><\/a><a class="crm-deleteLink" align="absmiddle"                            title="${ASC.CRM.Resources.CRMSettingResource.DeleteTaskTemplateContainer}"                            onclick="ASC.CRM.TaskTemplateView.deleteTemplateConatainer(${id})"><\/a><img class="loaderImg" align="absmiddle" style="display: none;"                            src="${StudioManager.GetImage(\'loader_16.gif\')}"/><\/td><\/tr><\/tbody><\/table><\/li><li id="templateContainerBody_${id}" style="{{if typeof(items)=="undefined"}}display:none;{{/if}}">{{if typeof(items)!="undefined"}}        {{tmpl(items) "templateRow"}}        {{/if}}<\/li>');jQuery.template("templateRow",'<table cellspacing="0" cellpadding="0"  id="templateRow_${id}" class="templateContainer_row" style="margin-bottom: -1px;"><tbody><tr><td class="borderBase" style="width:30px;"><img title="${category.title}" alt="${category.title}" src="${category.imagePath}" /><\/td><td class="borderBase"><div class="divForTemplateTitle"><span id="templateTitle_${id}" class="templateTitle" title="${description}">${title}<\/span><\/div><div style="padding-top: 5px; display: inline-block;">${ASC.CRM.TaskTemplateView.getDeadlineDisplacement(offsetTicks, deadLineIsFixed)}<\/div><\/td><td class="borderBase" style="width:200px;"><span class="userLink">${responsible.displayName}<\/span><\/td><td class="borderBase" style="width:70px;text-align: right;padding-right: 10px;"><a class="crm-editLink" align="absmiddle"                            title="${ASC.CRM.Resources.CRMSettingResource.EditTaskTemplate}"                            onclick="ASC.CRM.TaskTemplateView.showTemplatePanel(${containerID}, ${id})"><\/a><a class="crm-deleteLink" align="absmiddle"                         title="${ASC.CRM.Resources.CRMSettingResource.DeleteTaskTemplate}"                         onclick="ASC.CRM.TaskTemplateView.deleteTemplate(${id})"><\/a><img class="loaderImg" align="absmiddle" style="display: none;"                         src="${StudioManager.GetImage(\'loader_16.gif\')}"/><\/td><\/tr><\/tbody><\/table>');jQuery.template("sampleFormTmpl",'<form name=\'sampleForm\' method=\'POST\' action=\'${webtoleadfromhandlerPath}\' accept-charset=\'UTF-8\'><meta content=\'text/html;charset=UTF-8\' http-equiv=\'content-type\'><style type="text/css">#sampleFormPanel {           padding: 10px;       }        #sampleFormPanel dt {           float: left;           text-align: right;           width: 40%;       }        #sampleFormPanel dd:not(:first-child) {             margin-bottom: 5px;             margin-left: 40%;             padding-left: 10px;       }        #sampleFormPanel input[type=text] {             border: solid 1px #C7C7C7;       }        #sampleFormPanel input[type=checkbox] {             margin-left: 0;       }         #sampleFormPanel .requiredField:after {            color: #c00;            content: " *";            font-size: 12px;            vertical-align: text-top;       }<\/style><dl id="sampleFormPanel"><dt><input type="hidden" name="is_company" value="${isCompany}"/><\/dt><dd>{{each fieldListInfo}}<dt>{{if type == 3}}<label for="cb_${name}">${title}:<\/label>{{else type == -1 && (isCompany == true && title == ASC.CRM.Resources.CRMContactResource.CompanyName || isCompany == false && title == ASC.CRM.Resources.CRMContactResource.FirstName)}}<div class="requiredField">${title}:<\/div>{{else}}               ${title}:               {{/if}}<\/dt><dd>{{if type == -1 || type == 0}}<input name="${name}" type="text" {{if mask != null && mask != ""}}size="${mask.size}"{{/if}}/>{{else type == 1}}<textarea name="${name}" {{if mask != null && mask != ""}}cols="${mask.cols}" rows="${mask.rows}"{{/if}}><\/textarea>{{else type == 2}}<select name="${name}">{{if mask != null && mask != ""}}<option value=""><\/option>{{each mask}}<option value="${$value}">${$value}<\/option>{{/each}}                    {{/if}}<\/select>{{else type == 3}}<input id="cb_${name}" name="${name}" type="checkbox" />{{/if}}<\/dd>{{/each}}<dt><\/dt><dd><input name="${name}" value="${ASC.CRM.Resources.CRMSettingResource.SubmitFormData}" type="submit"                onclick="javascript:                            var isValid = true,                                form = document.getElementById(\'sampleFormPanel\'),                                childs = form.getElementsByTagName(\'input\'),                                isCompany = null,                                firstName = \'\',                                lastName = \'\',                                companyName = \'\',                                fieldName = \'\';                            for (var i = 0, n = childs.length; i < n; i++) {                               fieldName = childs[i].getAttribute(\'name\');                                switch (fieldName) {                                    case \'is_company\':                                        isCompany = childs[i].value.trim();                                        break;                                    case \'firstName\':                                        firstName = childs[i].value.trim();                                        break;                                    case \'lastName\':                                        lastName = childs[i].value.trim();                                        break;                                    case \'companyName\':                                        companyName = childs[i].value.trim();                                        break;                               }                           }                            if (isCompany == \'false\') {                                if (firstName == \'\'){                                    if(typeof (toastr) === \'object\' && typeof (toastr.error) === \'function\') toastr.error(\'${ASC.CRM.Resources.CRMContactResource.ErrorEmptyContactFirstName}\');                                    else alert(\'${ASC.CRM.Resources.CRMContactResource.ErrorEmptyContactFirstName}\');                                    isValid = false;                               }                           }                            else if (isCompany == \'true\') {                                if(companyName == \'\') {                                    if(typeof (toastr) === \'object\' && typeof (toastr.error) === \'function\') toastr.error(\'${ASC.CRM.Resources.CRMContactResource.ErrorEmptyCompanyName}\');                                    else alert(\'${ASC.CRM.Resources.CRMContactResource.ErrorEmptyCompanyName}\');                                    isValid = false;                               }                           } else {                                isValid = false;                           }                            return isValid;"/><\/dd><\/dl>{{each tagListInfo}}<input type="hidden" name="tag" value="${title}" />{{/each}}<input type="hidden" name="return_url" value="${returnURL}" /><input type="hidden" name="web_form_key"  value="${webFormKey}"/><input type="hidden" name="notify_list" value="${notifyList}"/><input type="hidden" name="managers_list" value="${managersList}"/><input type="hidden" name="share_type" value="${shareType}"/><\/form>');jQuery.template("SMTPSettingsFormTemplate",'<table cellpadding="5" cellspacing="0"><tr><td class="requiredField"><div class="header-base-small headerPanelSmall">${ASC.CRM.Resources.CRMSettingResource.SenderEmailAddress}:<\/div><input type="text" class="textEdit" id="tbxSenderEmailAddress"/><\/td><td class="requiredField"><div class="header-base-small headerPanelSmall">${ASC.CRM.Resources.CRMSettingResource.SenderDisplayName}:<\/div><input type="text" class="textEdit" id="tbxSenderDisplayName"/><\/td><\/tr><tr><td class="requiredField"><div class="header-base-small headerPanelSmall">${ASC.CRM.Resources.CRMSettingResource.Host}:<\/div><input type="text" class="textEdit" id="tbxHost"/><\/td><td class="requiredField"><div class="header-base-small headerPanelSmall">${ASC.CRM.Resources.CRMSettingResource.Port}:<\/div><div><input type="text" class="textEdit" id="tbxPort" maxlength="5"/><input id="cbxAuthentication" type="checkbox" /><label for="cbxAuthentication" class="header-base-small" style="line-height: 21px;">${ASC.CRM.Resources.CRMSettingResource.Authentication}<\/label><\/div><\/td><\/tr><tr><td class="requiredField"><div class="header-base-small headerPanelSmall">${ASC.CRM.Resources.CRMSettingResource.HostLogin}:<\/div><input type="text" class="textEdit" id="tbxHostLogin"/><\/td><td class="requiredField"><div class="header-base-small headerPanelSmall">${ASC.CRM.Resources.CRMSettingResource.HostPassword}:<\/div><input type="password" class="textEdit" id="tbxHostPassword"/><\/td><\/tr><tr><td><input id="cbxEnableSSL" type="checkbox" /><label for="cbxEnableSSL" class="header-base-small" style="float: left; line-height: 20px;">${ASC.CRM.Resources.CRMSettingResource.EnableSSL}<\/label><\/td><td style="text-align: right;"><a id="getDefaultSettings" class="link dotline">${ASC.CRM.Resources.CRMSettingResource.GetDefaultSettings}<\/a><\/td><\/tr><\/table>');jQuery.template("invoiceItemsListTmpl",'<tbody>{{tmpl(invoiceItems) "invoiceItemTmpl"}}<\/tbody>');jQuery.template("invoiceItemTmpl",'<tr id="invoiceItem_${id}" class="with-entity-menu"><td><div class="invoiceItemSKU">${stockKeepingUnit}<\/div><\/td><td><div id="invoiceItemTitle_${id}" class="invoiceItemTitle" dscr_label="${ASC.CRM.Resources.CRMCommonResource.Description}" dscr_value="${description}">${title}<\/div><\/td><td class="invoiceTaxes invoiceTax1">{{if typeof(invoiceTax1) != \'undefined\' && invoiceTax1 != null}}<div id="invoiceItemTax1_${id}" dscr_label="${invoiceTax1.name}" dscr_value="${invoiceTax1.rate} %">${invoiceTax1.name}<\/div>{{/if}}<\/td><td class="invoiceTaxes invoiceTax2">{{if typeof(invoiceTax2) != \'undefined\' && invoiceTax2 != null}}<div id="invoiceItemTax2_${id}" dscr_label ="${invoiceTax2.name}" dscr_value="${invoiceTax2.rate} %">${invoiceTax2.name}<\/div>{{/if}}<\/td><td class="invoiceItemPrice"><div>{{html priceFormat}}<\/div><\/td><td class="invoiceItemQuantity"><div>{{if trackInvenory === true}}                    ${stockQuantity.toFixed(2).replace(\'.\', ASC.CRM.Data.CurrencyDecimalSeparator)}                {{/if}}<\/div><\/td><td style="padding:5px;"><div id="invoiceItemMenu_${id}" class="entity-menu" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><\/td><\/tr>');jQuery.template("invoiceTaxesListTmpl",'<tbody>{{tmpl(invoiceTaxes) "invoiceTaxTmpl"}}<\/tbody>');jQuery.template("invoiceTaxTmpl",'<tr id="invoiceTax_${id}" class="with-entity-menu"><td><div class="invoiceTaxName" title="${name}">${name}<\/div><\/td><td><div class="invoiceTaxRate">${rate.toFixed(2).replace(\'.\', ASC.CRM.Data.CurrencyDecimalSeparator)}<\/div><\/td><td><div class="invoiceTaxDscr">{{html jq.htmlEncodeLight(description).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}<\/div><\/td><td style="padding:5px;">{{if canEdit == true}}<div id="invoiceTaxMenu_${id}" class="entity-menu" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div>{{/if}}<\/td><\/tr>');jQuery.template("taxSettingsActionPanelBodyTmpl",'<div><div class="requiredField"><span class="requiredErrorText">${ASC.CRM.Resources.CRMInvoiceResource.EmptyTaxNameError}<\/span><div class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMInvoiceResource.InvoiceTaxName}:<\/div><input type="text" class="textEdit taxName" maxlength="255"/><\/div><div class="requiredField"><span class="requiredErrorText">${ASC.CRM.Resources.CRMInvoiceResource.EmptyTaxRateError}<\/span><div class="headerPanelSmall header-base-small">${ASC.CRM.Resources.CRMInvoiceResource.InvoiceTaxRate}:<\/div><input type="text" class="textEdit taxRate" maxlength="7"/>%<\/div><div><div class="header-base-small">${ASC.CRM.Resources.CRMSettingResource.Description}:<\/div><textarea cols="4" rows="4"><\/textarea><\/div><\/div>');jQuery.template("currencyRateItemTmpl",'<div class="currency-rate-item">1&nbsp;<span>${fromCurrency}<\/span>&nbsp;=&nbsp;<input id="currencyRate_${fromCurrency}" type="text" class="textEdit" value="${rate}"/>&nbsp;<span>${toCurrency}<\/span>&nbsp;<a class="crm-deleteLink" title="${ASC.CRM.Resources.CRMCommonResource.Delete}"><\/a><\/div>');
jQuery.template("invoicesListFilterTmpl",'<div id="invoiceFilterContainer"><div id="invoiceAdvansedFilter"><\/div><\/div><ul id="invoiceHeaderMenu" class="clearFix contentMenu contentMenuDisplayAll"><li class="menuAction menuActionSelectAll menuActionSelectLonely"><div class="menuActionSelect"><input type="checkbox" id="mainSelectAllInvoices" title="${ASC.CRM.Resources.CRMCommonResource.SelectAll}" onclick="ASC.CRM.ListInvoiceView.selectAll(this);" /><\/div><\/li><li class="menuAction menuActionChangeStatus" title="${ASC.CRM.Resources.CRMInvoiceResource.ChangeInvoiceStatus}"><span>${ASC.CRM.Resources.CRMInvoiceResource.ChangeInvoiceStatus}<\/span><div class="down_arrow"><\/div><\/li><li class="menuAction menuActionDelete" title="${ASC.CRM.Resources.CRMCommonResource.Delete}"><span>${ASC.CRM.Resources.CRMCommonResource.Delete}<\/span><\/li><li class="menu-action-simple-pagenav"><\/li><li class="menu-action-checked-count"><span><\/span><a class="linkDescribe baseLinkAction" style="margin-left:10px;" onclick="ASC.CRM.ListInvoiceView.deselectAll();">${ASC.CRM.Resources.CRMCommonResource.DeselectAll}<\/a><\/li><li class="menu-action-on-top"><a class="on-top-link" onclick="javascript:window.scrollTo(0, 0);">${ASC.CRM.Resources.CRMCommonResource.OnTop}<\/a><\/li><\/ul><div class="header-menu-spacer">&nbsp;<\/div>');jQuery.template("invoicesListPagingTmpl",'<table id="tableForInvoiceNavigation" class="crm-navigationPanel" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td><div id="divForInvoicePager"><\/div><\/td><td style="text-align:right;"><span class="gray-text">${ASC.CRM.Resources.CRMInvoiceResource.TotalInvoices}:&nbsp;<\/span><span class="gray-text" id="totalInvoicesOnPage"><\/span><span class="gray-text">${ASC.CRM.Resources.CRMCommonResource.ShowOnPage}:&nbsp;<\/span><select class="top-align"><option value="25">25<\/option><option value="50">50<\/option><option value="75">75<\/option><option value="100">100<\/option><\/select><\/td><\/tr><\/tbody><\/table>');jQuery.template("invoicesListBaseTmpl",'<div id="invoiceList" style="display:none;"><table id="invoiceTable" class="table-list padding4" cellpadding="0" cellspacing="0"><colgroup><col style="width: 22px;"/><col style="width: 1%;"/><col/><col style="width: 1%;"/><col style="width: 1%;"/><col style="width: 1%;"/><col style="width: 40px;"/><\/colgroup><tbody><\/tbody><\/table><\/div><div id="changeStatusDialog" class="studio-action-panel group-actions changeStatusDialog"><ul class="dropdown-content mobile-overflow"><\/ul><\/div><div id="invoiceActionMenu" class="studio-action-panel"><ul class="dropdown-content"><li><a class="showProfileLink dropdown-item with-icon user">${ASC.CRM.Resources.CRMInvoiceResource.ShowInvoiceProfile}<\/a><\/li><li><a class="showProfileLinkNewTab dropdown-item with-icon new-tab">${ASC.CRM.Resources.CRMInvoiceResource.ShowInvoiceProfileNewTab}<\/a><\/li><li class="dropdown-item-seporator"><\/li>{{if ASC.CRM.Data.CanDownloadInvoices == true}}<li><a class="downloadLink dropdown-item with-icon download">${ASC.CRM.Resources.CRMInvoiceResource.Download}<\/a><\/li>{{/if}}<li><a class="printLink dropdown-item with-icon print">${ASC.CRM.Resources.CRMInvoiceResource.Print}<\/a><\/li>{{if ASC.CRM.Data.CanDownloadInvoices == true}}<li><a class="sendLink dropdown-item with-icon email">${ASC.CRM.Resources.CRMInvoiceResource.SendByEmail}<\/a><\/li>{{/if}}<li><a class="duplicateInvoiceLink dropdown-item with-icon move-or-copy">${ASC.CRM.Resources.CRMInvoiceResource.DuplicateInvoice}<\/a><\/li><li class="dropdown-item-seporator"><\/li><li><a class="editInvoiceLink dropdown-item with-icon edit">${ASC.CRM.Resources.CRMInvoiceResource.EditInvoice}<\/a><\/li><li><a class="deleteInvoiceLink dropdown-item with-icon delete">${ASC.CRM.Resources.CRMInvoiceResource.DeleteThisInvoice}<\/a><\/li><\/ul><\/div><div id="hiddenBlockForInvoiceContactSelector" style="display:none;"><span id="invoiceContactSelectorForFilter" class="custom-value"><span class="inner-text"><span class="value">${ASC.CRM.Resources.CRMCommonResource.Select}<\/span><\/span><\/span><\/div>');jQuery.template("invoiceListTmpl",'<tbody>{{tmpl(invoices) "invoiceTmpl"}}<\/tbody>');jQuery.template("invoiceTmpl",'<tr id="invoice_${id}" class="with-entity-menu {{if isChecked == true}}selected{{/if}}">{{if isSimpleView != true}}<td style="padding: 0 0 0 6px;"><input type="checkbox" id="checkInvoice_${id}" onclick="ASC.CRM.ListInvoiceView.selectItem(this);" {{if isChecked == true}}checked="checked"{{/if}} /><div id="loaderImg_${id}" class="loader-middle baseList_loaderImg"><\/div><\/td>{{/if}}<td><a class="linkHeaderMedium invoiceNumber {{if status.id == 3}}gray-text{{/if}}{{if debtor == true}}red-text{{/if}}" href="Invoices.aspx?id=${id}" title="${number}">${number}<\/a><div class="{{if status.id == 3}}gray-text{{/if}}">${issueDateString}<\/div><\/td>{{if isSimpleView != true}}<td class="invoiceContact">{{if contact != null}}<div>{{if contact.isCompany == true}}<a href="Default.aspx?id=${contact.id}" data-id="${contact.id}"                            id="invoice_${id}_company_${contact.id}" class="linkMedium crm-companyInfoCardLink {{if status.id == 3}}gray-text{{/if}}">${contact.displayName}<\/a>{{else}}<a href="Default.aspx?id=${contact.id}&type=people" data-id="${contact.id}"                            id="invoice_${id}_person_${contact.id}" class="linkMedium crm-peopleInfoCardLink {{if status.id == 3}}gray-text{{/if}}">${contact.displayName}<\/a>{{/if}}<\/div>{{/if}}<\/td>{{/if}}<td class="invoiceDueDate"><div class="{{if status.id == 3}}gray-text{{/if}}">${dueDateString}<\/div><\/td><td class="invoiceStatus"><div class="{{if status.id == 3}}gray-text{{/if}}{{if debtor == true}}red-text{{/if}}" data-status-id="${status.id}">${status.title.toLowerCase()}<\/div><\/td><td class="invoiceSum"><div {{if status.id == 3}}class="gray-text"{{/if}}>{{html displaySum}}<\/div><\/td><td style="padding:5px;"><div id="invoiceMenu_${id}" class="entity-menu" title="${ASC.CRM.Resources.CRMCommonResource.Actions}"><\/div><\/td><\/tr>');jQuery.template("invoiceLineTableTmpl",'<div class="tbl"><div class="tbl-row tbl-header-row clearFix"><div class="tbl-cell sorter">&nbsp;<\/div><div class="tbl-cell item">${ASC.CRM.Resources.CRMInvoiceResource.ItemCol}:<\/div><div class="tbl-cell quantity">${ASC.CRM.Resources.CRMInvoiceResource.QuantityCol}:<\/div><div class="tbl-cell price">${ASC.CRM.Resources.CRMInvoiceResource.PriceCol}:<\/div><div class="tbl-cell discount">${ASC.CRM.Resources.CRMInvoiceResource.DiscountCol}:<\/div><div class="tbl-cell tax1">${ASC.CRM.Resources.CRMInvoiceResource.TaxCol}:<\/div><div class="tbl-cell tax2">${ASC.CRM.Resources.CRMInvoiceResource.TaxCol}:<\/div><div class="tbl-cell amount">${ASC.CRM.Resources.CRMInvoiceResource.AmountCol}:<\/div><div class="tbl-cell action">&nbsp;<\/div><\/div><div class="tbl-body">{{tmpl(invoiceLines) "invoiceLineTmpl"}}<\/div><div class="tbl-row tbl-add-row clearFix"><a class="link plus dotline add-line">${ASC.CRM.Resources.CRMInvoiceResource.AddLineButton}<\/a><\/div><div class="tbl-row tbl-subtotal-row clearFix"><div class="tbl-cell total-label">${ASC.CRM.Resources.CRMInvoiceResource.Subtotal}:<\/div><div class="tbl-cell total-value subtotal" title="${(subtotal - discountValue).toFixed(2)}">${(subtotal - discountValue).toFixed(2)}<\/div><\/div><div class="tbl-taxes">{{tmpl(taxLines) "invoiceTaxLineTmpl"}}<\/div><div class="tbl-row tbl-total-row clearFix"><div class="tbl-cell total-label">${ASC.CRM.Resources.CRMInvoiceResource.Total}&nbsp;(<span class="currency">${currency}<\/span>):<\/div><div class="tbl-cell total-value total" title="${total.toFixed(2)}">${total.toFixed(2)}<\/div><\/div><\/div><div id="selectItemDialog" class="studio-action-panel selector">{{if isAdmin == true}}<div class="left-side"><div class="headerPanelSmall-splitter"><div class="header-base-small">${ASC.CRM.Resources.CRMInvoiceResource.FormInvoiceItemName}<\/div><input type="text" class="textEdit" id="newItemName"><\/div><div class="headerPanelSmall-splitter"><div class="header-base-small">${ASC.CRM.Resources.CRMInvoiceResource.FormInvoiceItemPrice}<\/div><input type="text" class="textEdit" id="newItemPrice" maxlength="11"><\/div><div id="priceTip" class="gray-text">${ASC.CRM.Resources.CRMInvoiceResource.PriceTip}<\/div><div class="button-container"><a class="button gray disable create-btn">${ASC.CRM.Resources.CRMCommonResource.Create}<\/a><span class="splitter-buttons"><\/span><a class="button gray cancel-btn">${ASC.CRM.Resources.CRMCommonResource.Cancel}<\/a><\/div><\/div>{{/if}}<div class="right-side"><div class="headerPanelSmall-splitter custom-input"><input type="text"/><div class="icon serch"><\/div><\/div>{{if isAdmin == true}}<div class="headerPanelSmall-splitter"><a class="link plus dotline add-new-btn">${ASC.CRM.Resources.CRMInvoiceResource.CreateNewInvoiceItem}<\/a><\/div>{{/if}}<ul class="custom-list {{if isAdmin == false}}large{{/if}}"><\/ul><\/div><\/div><div id="selectTaxDialog" class="studio-action-panel selector">{{if isAdmin == true}}<div class="left-side"><div class="headerPanelSmall-splitter"><div class="header-base-small">${ASC.CRM.Resources.CRMInvoiceResource.InvoiceTaxName}<\/div><input type="text" class="textEdit" id="newTaxName"><\/div><div class="headerPanelSmall-splitter"><div class="header-base-small">${ASC.CRM.Resources.CRMInvoiceResource.InvoiceTaxRate}<\/div><input type="text" class="textEdit small" id="newTaxRate" maxlength="7">%<\/div><div class="button-container"><a class="button gray disable create-btn">${ASC.CRM.Resources.CRMCommonResource.Create}<\/a><a class="button gray cancel-btn">${ASC.CRM.Resources.CRMCommonResource.Cancel}<\/a><div class="createTaxError" title="${ASC.CRM.Resources.CRMInvoiceResource.InvoiceTaxAlreadyRegisteredError}">${ASC.CRM.Resources.CRMInvoiceResource.InvoiceTaxAlreadyRegisteredError}<\/div><\/div><\/div>{{/if}}<div class="right-side"><div class="headerPanelSmall-splitter"><a class="link dotline set-default-btn {{if isAdmin == true}}right{{/if}}">${ASC.CRM.Resources.CRMInvoiceResource.SetEmpty}<\/a>{{if isAdmin == true}}<a class="link plus dotline add-new-btn">${ASC.CRM.Resources.CRMInvoiceResource.CreateNewInvoiceTax}<\/a>{{/if}}<\/div><ul class="custom-list"><\/ul><\/div><\/div>');jQuery.template("invoiceLineTmpl",'<div id="invoiceLine_${id}" class="tbl-row tbl-body-row"><div class="clearFix"><div class="tbl-cell item"><div class="custom-input"><input type="text" readonly="readonly" value="${invoiceItem ? invoiceItem.title : \'\'}" placeholder="${ASC.CRM.Resources.CRMInvoiceResource.EmptyProductText}"/><div class="icon drop-down"><\/div><input type="hidden" value="${invoiceItem ? invoiceItem.id : 0}" name="iLineItem_${id}_"/><\/div><\/div><div class="tbl-cell quantity"><input type="text" value="${quantity.toFixed(2)}" class="textEdit" name="iLineQuantity_${id}_"/><\/div><div class="tbl-cell price"><input type="text" value="${price.toFixed(2)}" class="textEdit" name="iLinePrice_${id}_"/><\/div><div class="tbl-cell discount"><input type="text" value="${discount.toFixed(2)}" class="textEdit" name="iLineDiscount_${id}_"/>(%)<\/div><div class="tbl-cell tax1"><div class="custom-input"><input type="text" readonly="readonly" value="${invoiceTax1 ? invoiceTax1.name : \'\'}" placeholder="${ASC.CRM.Resources.CRMInvoiceResource.EmptyTaxText}"/><div class="icon drop-down"><\/div><input type="hidden" value="${invoiceTax1 ? invoiceTax1.id : 0}" name="iLineTax1_${id}_"/><\/div><\/div><div class="tbl-cell tax2"><div class="custom-input"><input type="text" readonly="readonly" value="${invoiceTax2 ? invoiceTax2.name : \'\'}" placeholder="${ASC.CRM.Resources.CRMInvoiceResource.EmptyTaxText}"/><div class="icon drop-down"><\/div><input type="hidden" value="${invoiceTax2 ? invoiceTax2.id : 0}" name="iLineTax2_${id}_"/><\/div><\/div><div class="tbl-cell amount" title="${(subtotal - discountValue).toFixed(2)}">${(subtotal - discountValue).toFixed(2)}<\/div><\/div><div class="description"><textarea name="iLineDescription_${id}_" placeholder="${ASC.CRM.Resources.CRMInvoiceResource.DescriptionCol}">${description}<\/textarea><\/div><div class="sorter"><a class="crm-moveLink"><\/a><\/div><div class="action"><a class="crm-removeLink"><\/a><\/div><div class="price-error-text">${ASC.CRM.Resources.CRMInvoiceResource.ErrorIncorrectPrice} (max ${ASC.CRM.Data.MaxInvoiceItemPrice})<\/div><\/div>');jQuery.template("invoiceTaxLineTmpl",'<div class="tbl-row tbl-subtotal-row clearFix"><div class="tbl-cell total-label"><span class="taxLineName" title="${name}">${name}<\/span>&nbsp;<span class="taxLineRate">(${rate}%):<\/span><\/div><div class="tbl-cell total-value tax-value" title="${value.toFixed(2)}">${value.toFixed(2)}<\/div><\/div>');jQuery.template("invoiceDetailsTmpl",'<div class="invoice-container"><div class="invoice-data"><table cellpadding="0" cellspacing="0" class="tbl-seller"><tbody><tr><td class="width-50">{{if Seller != null}}                            {{html jq.htmlEncodeLight(Seller.Item2).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}                            {{/if}}<\/td><td class="width-50 text-right">{{if LogoBase64}}<img class="logo" src="${LogoSrcFormat.format(LogoBase64)}"/>{{/if}}<\/td><\/tr><\/tbody><\/table><br /><br /><table cellpadding="0" cellspacing="0" class="tbl-invoice"><tbody><tr><td class="width-50">{{if Number != null}}<div class="background-gray invoice-number"><span class="font-22 font-gray">${Number.Item1}<\/span><span class="font-16 font-gray">&nbsp;&nbsp;<\/span><span class="font-16">${Number.Item2}<\/span><\/div>{{/if}}<\/td><td class="width-50"><table cellpadding="0" cellspacing="0"><tbody>{{each(i, info) Invoice}}<tr><td class="width-25 font-bold text-right">${info.Item1}:<\/td><td class="width-5">&nbsp;<\/td><td class="width-20">${info.Item2}<\/td><\/tr>{{/each}}<\/tbody><\/table><\/td><\/tr><\/tbody><\/table><br /><br /><table cellpadding="0" cellspacing="0" class="tbl-customer"><tbody><tr><td class="width-50">{{if Customer != null}}<div class="font-bold">${Customer.Item1}:<\/div>{{html jq.htmlEncodeLight(Customer.Item2).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}                            {{/if}}<\/td><td class="width-50"><\/td><\/tr><\/tbody><\/table><br /><br /><table class="tbl-items" cellpadding="0" cellspacing="0"><tbody><tr class="background-gray">{{each(i, info) TableHeaderRow}}                            {{if i == 0}}<td class="font-gray width-40">${info}:<\/td>{{else}}<td class="font-gray width-10 {{if i == TableHeaderRow.length - 1}} text-right{{/if}}">${info}:<\/td>{{/if}}                        {{/each}}<\/tr>{{each(i, row) TableBodyRows}}<tr>{{each(j, info) row}}                            {{if j == 0}}<td class="border-bottom-gray width-40 {{if j == row.length - 1}} text-right{{/if}}">{{html jq.htmlEncodeLight(info).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}<\/td>{{else}}<td class="border-bottom-gray width-10 {{if j == row.length - 1}} text-right{{/if}}">{{html jq.htmlEncodeLight(info).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}<\/td>{{/if}}                        {{/each}}<\/tr>{{/each}}                    {{each(i, info) TableFooterRows}}<tr><td colspan="2" class="width-50"><\/td><td colspan="3" class="width-30">${info.Item1}:<\/td><td colspan="2" class="width-20 text-right">${info.Item2}<\/td><\/tr>{{/each}}                    {{if TableTotalRow != null}}<tr><td colspan="2" class="width-50"><\/td><td colspan="3" class="background-gray width-30 font-bold">${TableTotalRow.Item1}:<\/td><td colspan="2" class="background-gray width-20 font-bold text-right">${TableTotalRow.Item2}<\/td><\/tr>{{/if}}<\/tbody><\/table><br /><br /><table cellpadding="0" cellspacing="0" class="tbl-terms"><tbody><tr><td><span class="font-bold">${Terms.Item1}:<\/span>&nbsp;{{html jq.htmlEncodeLight(Terms.Item2).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}<\/td><\/tr><\/tbody><\/table><br />{{if Notes != null}}<table cellpadding="0" cellspacing="0" class="tbl-notes"><tbody><tr><td><span class="font-bold">${Notes.Item1}:<\/span>&nbsp;{{html jq.htmlEncodeLight(Notes.Item2).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}<\/td><\/tr><\/tbody><\/table><br />{{/if}}<table cellpadding="0" cellspacing="0" class="tbl-consignee"><tbody><tr><td class="width-50">{{if Consignee != null}}<div class="font-bold">${Consignee.Item1}:<\/div>{{html jq.htmlEncodeLight(Consignee.Item2).replace(/&#10;/g, "<br/>").replace(/  /g, " &nbsp;")}}                            {{/if}}<\/td><td class="width-50"><\/td><\/tr><\/tbody><\/table><\/div><\/div>');jQuery.template("invoiceDetailsStylesTmpl","<style>@font-face {          font-family: 'Open Sans';          font-style: normal;          font-weight: normal;          src: local('Open Sans'), local('OpenSans'), url(https://themes.googleusercontent.com/static/fonts/opensans/v7/uYKcPVoh6c5R0NpdEY5A-Q.woff) format('woff');       }        @media screen {            body {padding: 0; margin: 2.645833mm;}            .invoice-container {                width: 168mm;                min-height: 259mm;                padding: 19mm 14mm 19mm 28mm;                border: 1px solid #D1D1D1;                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);                -moz-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);                -webkit-box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);           }       }        @media print {            body {padding: 0; margin: 0;}       }        @page          {             size: auto;            margin: 19mm 14mm 19mm 28mm;       }        .invoice-data {            background-color: #FFFFFF;            color: #333333;            font-family: 'Open Sans',sans-serif;            font-size: 10pt;       }        .invoice-data table {            border-collapse: collapse;            color: #333333;            font-family: 'Open Sans',sans-serif;            font-size: 10pt;            width: 100%;       }        .invoice-data table td {            vertical-align: top;            word-wrap: break-word;       }        .invoice-data table .width-50 {            max-width: 84mm;            width: 84mm;       }        .invoice-data table .width-40 {            max-width: 65.0833mm;            width: 65.0833mm;       }        .invoice-data table .width-30 {            max-width: 48.2833mm;            width: 48.2833mm;       }        .invoice-data table .width-25 {            max-width: 39.8833mm;            width: 39.8833mm;       }        .invoice-data table .width-20 {            max-width: 31.4833mm;            width: 31.4833mm;       }        .invoice-data table .width-10 {            max-width: 14.6833mm;            width: 14.6833mm;       }        .invoice-data table .width-5 {            max-width: 6.2833mm;            width: 6.2833mm;       }        .invoice-data table .text-right {            text-align: right;       }        .invoice-data table .border-bottom-gray {            border-bottom: 0.264583mm solid #EEEEEE;       }        .invoice-data table .background-gray {            background-color: #EEEEEE;       }        .invoice-data table .font-gray {            color: #999999;       }        .invoice-data table .font-22 {            font-size: 22pt;       }        .invoice-data table .font-16 {            font-size: 16pt;       }        .invoice-data table .font-bold {            font-weight: bold;       }        .invoice-data table .logo {            max-height: 39.6875mm;            max-width: 52.9167mm;       }        .invoice-data table .invoice-number {            padding: 0 1.05833mm;       }        .invoice-data table.tbl-items {            font-size: 8pt;       }        .invoice-data table.tbl-items td {            padding: 1.9mm 1.05833mm;       }<\/style>");jQuery.template("numberFormatDialogTmpl",'<div class="headerPanelSmall-splitter">${ASC.CRM.Resources.CRMInvoiceResource.ChangeFormatInfo}<\/div><div class="headerPanelSmall-splitter"><input type="checkbox" id="autogenCbx"><label for="autogenCbx">${ASC.CRM.Resources.CRMInvoiceResource.AutomaticallyGenerated}<\/label><\/div><div class="clearFix"><div class="number-prefix"><div class="header-base-small headerPanelSmall">${ASC.CRM.Resources.CRMInvoiceResource.Prefix}:<\/div><input type="text" id="prefixInpt" class="textEdit"><\/div><div class="number-number requiredField"><div class="header-base-small headerPanelSmall">${ASC.CRM.Resources.CRMInvoiceResource.StartNumber}:<\/div><input type="text" id="numberInpt" class="textEdit"><\/div><\/div><div class="error-popup"><\/div><div class="big-button-container"><a class="button blue middle">${ASC.CRM.Resources.CRMCommonResource.Save}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle" onclick="PopupKeyUpActionProvider.EnableEsc = true; jq.unblockUI();">${ASC.CRM.Resources.CRMCommonResource.Cancel}<\/a><\/div>');jQuery.template("defaultTermsDialogTmpl",'<div class="headerPanelSmall-splitter">${ASC.CRM.Resources.CRMInvoiceResource.DefaultTermsInfo}<\/div><div class="header-base-small headerPanelSmall">${ASC.CRM.Resources.CRMInvoiceResource.Terms}:<\/div><textarea id="defaultTerms"><\/textarea><div class="error-popup"><\/div><div class="big-button-container"><a class="button blue middle">${ASC.CRM.Resources.CRMCommonResource.Save}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle" onclick="PopupKeyUpActionProvider.EnableEsc = true; jq.unblockUI();">${ASC.CRM.Resources.CRMCommonResource.Cancel}<\/a><\/div>');jQuery.template("deleteDialogTmpl",'<div class="header-base-small headerPanelSmall"><\/div><div>${ASC.CRM.Resources.CRMJSResource.DeleteConfirmNote}<\/div><div class="error-popup"><\/div><div class="big-button-container"><a class="button blue middle">${ASC.CRM.Resources.CRMCommonResource.OK}<\/a><span class="splitter-buttons"><\/span><a class="button gray middle" onclick="PopupKeyUpActionProvider.EnableEsc = true; jq.unblockUI();">${ASC.CRM.Resources.CRMCommonResource.Cancel}<\/a><\/div>');
jQuery.template("voip-view-call-tmpl",'<tr class="call-row"><td class="call-type"><span class="call-type-icon ${typeClass}"><\/span>{{if supportsPlaying && recordUrl}}<span class="call-type-icon play" data-recordUrl="${recordUrl}"><\/span>{{/if}}<\/td><td class="call-date"><span>${datetime}<\/span><\/td><td class="call-agent">${answeredBy.displayName}<\/td><td class="call-client">${contactTitle}<\/td><td class="call-duration">${durationString}<\/td>{{if ASC.CRM.Data.IsCRMAdmin}}<td class="call-cost">${cost}<\/td>{{/if}}<\/tr>');jQuery.template("voip-call-view-tmpl",'<div class="header-with-menu"><a href="Settings.aspx?type=voip.calls" class="header-back-link"><\/a><span>${ASC.CRM.Resources.CRMVoipResource.Call} ${\'#\' + id}<\/span><\/div><div id="call-info-box"><div class="call-info-row"><span class="call-info-title">${ASC.CRM.Resources.CRMVoipResource.CallType}:<\/span><span class="call-info-value">${typeString}<\/span><\/div><div class="call-info-row"><span class="call-info-title">${ASC.CRM.Resources.CRMVoipResource.CallDatetime}:<\/span><span class="call-info-value">${datetime}<\/span><\/div><div class="call-info-row"><span class="call-info-title">${ASC.CRM.Resources.CRMVoipResource.CallClient}:<\/span><span class="call-info-value">${contact.displayName}<\/span><\/div><div class="call-info-row"><span class="call-info-title">${ASC.CRM.Resources.CRMVoipResource.CallDuration}:<\/span><span class="call-info-value">${durationString}<\/span><\/div>{{if ASC.CRM.Data.IsCRMAdmin}}<div class="call-info-row"><span class="call-info-title">${ASC.CRM.Resources.CRMVoipResource.CallCost}:<\/span><span class="call-info-value">${cost}$<\/span><\/div>{{/if}}<\/div><table id="call-redirections-list" class="table-list height32"><thead><tr><th class="call-redirection-agent">${ASC.CRM.Resources.CRMVoipResource.CallAgent}<\/th><th class="call-redirection-waiting-time">${ASC.CRM.Resources.CRMVoipResource.CallWaitingTime}<\/th><th class="call-redirection-duration">${ASC.CRM.Resources.CRMVoipResource.CallDuration}<\/th><\/tr><\/thead><\/table>');jQuery.template("voip-header-tmpl",'{{if $data > 0}}<div>${ASC.CRM.Resources.CRMVoipResource.NumbersCountMsg}:<strong>${$data}<\/strong>.        {{html jq.format(ASC.CRM.Resources.CRMVoipResource.NumbersCountDscrMsg, \'<a href="Settings.aspx?type=voip.numbers" class="link underline blue" target="_blank">\', \'<\/a>\')}}<\/div>{{else}}<div>{{html jq.format(ASC.CRM.Resources.CRMVoipResource.NoNumbersMsg, \'<a href="Settings.aspx?type=voip.numbers" class="link underline blue" target="_blank">\', \'<\/a>\')}}<\/div>{{/if}}');jQuery.template("voip-common-settings-tmpl",'<div class="common-setting-item"><div class="header-base-small">${ASC.CRM.Resources.CRMVoipResource.IncomingCallsQueueSize}<\/div><select id="queue-size-selector" class="comboBox"><option value="5" {{if queue.size == 5}} selected="selected" {{/if}}>5<\/option><option value="10" {{if queue.size == 10}} selected="selected" {{/if}}>10<\/option><option value="15" {{if queue.size == 15}} selected="selected" {{/if}}>15<\/option><\/select><\/div><div class="common-setting-item"><div class="header-base-small">${ASC.CRM.Resources.CRMVoipResource.WaitingTimeout}<\/div><select id="queue-wait-time-selector" class="comboBox"><option value="5" {{if queue.waitTime == 300}} selected="selected" {{/if}}>${ASC.CRM.Resources.CRMVoipResource.WaitingTimeout5Minutes}<\/option><option value="10" {{if queue.waitTime == 600}} selected="selected" {{/if}}>${ASC.CRM.Resources.CRMVoipResource.WaitingTimeout10Minutes}<\/option><option value="15" {{if queue.waitTime == 900}} selected="selected" {{/if}}>${ASC.CRM.Resources.CRMVoipResource.WaitingTimeout15Minutes}<\/option><\/select><\/div><div class="common-setting-item"><div class="header-base-small">${ASC.CRM.Resources.CRMVoipResource.OperatorPause}<\/div><select id="operator-pause-selector" class="comboBox"><option value="0" {{if !pause}} selected="selected" {{/if}}>${ASC.CRM.Resources.CRMVoipResource.OperatorPauseDisabled}<\/option><option value="1" {{if pause}} selected="selected" {{/if}}>${ASC.CRM.Resources.CRMVoipResource.OperatorPauseEnabled}<\/option><\/select><\/div>');jQuery.template("voip-ringtones-tmpl",'<div id="ringtone-group-${audioType}" class="ringtone-group" data-audiotype="${audioType}"><div class="ringtone-group-box with-entity-menu clearFix"><div class="cell switcher"><div class="expander-icon {{if ringtones.length == 0}} display-none {{/if}}"><\/div><\/div><div class="cell title">${name}<\/div><div class="cell actions entity-menu"><div class="studio-action-panel"><ul class="dropdown-content"><li id="add-ringtone-${audioType}-btn" class="dropdown-item with-icon ringtone">${ASC.CRM.Resources.CRMVoipResource.AddRingtoneBtn}<\/li><\/ul><\/div><\/div><\/div><div class="ringtones-box">{{tmpl(ringtones) "voip-ringtone-tmpl"}}<\/div><\/div>');jQuery.template("voip-ringtone-tmpl",'<div class="ringtone with-entity-menu clearFix" data-filename="${name}"><div class="cell title"><div class="loader16"><\/div><button class="button gray btn-icon ringtone-play-btn __play" data-path="${path}"><\/button>${name}<\/div>{{if !isDefault }}<div class="cell actions entity-menu"><div class="studio-action-panel"><ul class="dropdown-content"><li class="dropdown-item delete-ringtone-btn">${ASC.CRM.Resources.CRMVoipResource.DeleteRingtoneBtn}<\/li><\/ul><\/div><\/div>{{/if}}<\/div>');jQuery.template("voip-number-selector-option-tmpl",'<option value="${id}">${number}<\/option>');jQuery.template("voip-settings-tmpl",'<div id="alias-setting-box" class="clearFix"><div class="settings-block"><div class="header-base">${ASC.CRM.Resources.CRMVoipResource.Alias}<\/div><input type="text" value="${alias}" id="number-alias-input" class="textEdit" placeholder="${ASC.CRM.Resources.CRMVoipResource.AliasPlaceholder}" maxlength="30"/><\/div><div class="settings-help-block"><p>{{html jq.format(ASC.CRM.Resources.CRMVoipResource.AliasDscrMsg, "<strong>", "<\/strong>")}}<\/p><\/div><\/div><div class="clearFix"><div id="quick-setting" class="settings-block"><div class="header-base">${ASC.CRM.Resources.CRMVoipResource.QuickTuning}<\/div><div class="quick-setting-item"><a id="outgoing-calls-setting-btn" class="on_off_button ${settings.allowOutgoingCalls ? \' on\' : \'off\' }"><\/a>${ASC.CRM.Resources.CRMVoipResource.OutgoingCalls}<\/div><div class="quick-setting-item"><a id="record-incoming-setting-btn" class="on_off_button ${settings.record ? \' on\' : \'off\' }"><\/a>${ASC.CRM.Resources.CRMVoipResource.RecordingCalls}<\/div><div class="quick-setting-item"><a id="working-hours-setting-btn" class="on_off_button ${settings.workingHours && settings.workingHours.enabled ? \' on\' : \'off\' }"><\/a>${ASC.CRM.Resources.CRMVoipResource.WorkingHours}<div class="working-hours-inputs-box"><div><input type="text" class="textEdit" ${settings.workingHours && settings.workingHours.enabled ? "" : "disabled" } id="working-hours-from-input" value="${settings.workingHours && settings.workingHours.from ? settings.workingHours.from.slice(0, 5) : " "}" />-<input type="text" class="textEdit" ${settings.workingHours && settings.workingHours.enabled ? "" : "disabled" } id="working-hours-to-input" value="${settings.workingHours && settings.workingHours.to ? settings.workingHours.to.slice(0, 5) : " "}" /><\/div><span id="working-hours-invalid-format-error" class="working-hours-error">${ASC.CRM.Resources.CRMVoipResource.WorkingHoursFormatTip}<\/span><span id="working-hours-invalid-interval-error" class="working-hours-error">${ASC.CRM.Resources.CRMVoipResource.WorkingHoursFormatErrorMsg}<\/span><\/div><\/div><\/div><div class="settings-help-block"><p>{{html jq.format(ASC.CRM.Resources.CRMVoipResource.QuickTuningDscrMsg, "<strong>", "<\/strong>")}}<\/p><\/div><\/div><div id="ringtones-setting-box" class="clearFix"><div class="settings-block"><div class="header-base">${ASC.CRM.Resources.CRMVoipResource.RingtonesTuning}<\/div><div class="ringtone-setting-item"><div class="header-base-small">${ASC.CRM.Resources.CRMVoipResource.GreetingRingtones}<\/div><select id="greeting-ringtone-selector" class="comboBox ringtone-selector"><option value="" {{if settings.greetingAudio === ""}} selected="selected" {{/if}}>${ASC.CRM.Resources.CRMVoipResource.UnspecifiedOption}<\/option>{{each settings.ringtones.greeting}}<option value="${path}" {{if settings.greetingAudio === path}} selected="selected" {{/if}}>${name}<\/option>{{/each}}<\/select><button class="button gray btn-icon ringtone-play-btn __play {{if !settings.greetingAudio}} disable {{/if}}" id="greeting-ringtone-play-btn" data-src="${settings.greetingAudio}" data-type="greeting"><\/button><button class="button gray btn-icon __upload" id="greeting-ringtone-load-btn" onclick=" return false; "><\/button><\/div><div class="ringtone-setting-item"><div class="header-base-small">${ASC.CRM.Resources.CRMVoipResource.QueueRingtones}<\/div><select id="queue-wait-ringtone-selector" class="comboBox ringtone-selector"><option value="" {{if settings.queue === ""}} selected="selected" {{/if}}>${ASC.CRM.Resources.CRMVoipResource.UnspecifiedOption}<\/option>{{each settings.ringtones.queue}}<option value="${path}" {{if settings.queue.waitUrl === path}} selected="selected" {{/if}}>${name}<\/option>{{/each}}<\/select><button class="button gray btn-icon ringtone-play-btn __play {{if !settings.queue || !settings.queue.waitUrl}} disable {{/if}}" id="queue-wait-ringtone-play-btn" data-src="${settings.queue.waitUrl}" data-type="queue"><\/button><button class="button gray btn-icon __upload" id="queue-wait-ringtone-load-btn" onclick=" return false; "><\/button><\/div><div class="ringtone-setting-item"><div class="header-base-small">${ASC.CRM.Resources.CRMVoipResource.VoicemailRingtones}<\/div><select id="voicemail-ringtone-selector" class="comboBox ringtone-selector"><option value="" {{if settings.voiceMail === ""}} selected="selected" {{/if}}>${ASC.CRM.Resources.CRMVoipResource.UnspecifiedOption}<\/option>{{each settings.ringtones.voicemail}}<option value="${path}" {{if settings.voiceMail === path}} selected="selected" {{/if}}>${name}<\/option>{{/each}}<\/select><button class="button gray btn-icon ringtone-play-btn __play {{if !settings.voiceMail}} disable {{/if}}" id="voicemail-ringtone-play-btn" data-src="${settings.voiceMail}" data-type="voice"><\/button><button class="button gray btn-icon __upload" id="voicemail-ringtone-load-btn" onclick=" return false; "><\/button><\/div><\/div><div class="settings-help-block"><p>{{html jq.format(ASC.CRM.Resources.CRMVoipResource.RingtonesTuningDscrMsg, "<strong>", "<\/strong>")}}<\/p><\/div><\/div>');jQuery.template("voip-operator-tmpl",'{{each settings.operators}}<div class="operator with-entity-menu" data-operatorid="${id}"><div class="cell code"><\/div><div class="cell title"><img src="${userInfo.avatarSmall}" alt="${userInfo.displayName}" />${userInfo.displayName}<\/div><div class="cell outgoing-calls"><a class="on_off_button ${allowOutgoingCalls ? " on" : "off" } ${$data.settings.allowOutgoingCalls ? "" : "disable" }"><\/a><\/div><div class="cell incoming-recording"><a class="on_off_button ${record ? " on" : "off" } ${$data.settings.record ? "" : "disable" }"><\/a><\/div><div class="cell actions entity-menu"><div class="studio-action-panel"><ul class="dropdown-content"><li class="dropdown-item delete-operator-btn">${ASC.CRM.Resources.CRMVoipResource.DeleteBtn}<\/li><\/ul><\/div><\/div><\/div>{{/each}}');jQuery.template("voip-ringtone-selector-option-tmpl",'<option value="${path}">${name}<\/option>');jQuery.template("voip-existing-number-tmpl",'<div id="enumber${id}" class="number" data-numberid="${id}"><div class="number-box with-entity-menu clearFix"><div class="cell switcher"><div class="expander-icon"><\/div><\/div><div class="cell title">${number}<span class="support-level">${alias}<\/span><\/div><div class="cell outgoing-calls"><a class="on_off_button ${settings.allowOutgoingCalls ? " on" : "off" }" data-operator-btn-selector=".outgoing-calls"><\/a><\/div><div class="cell recording-calls"><a class="on_off_button ${settings.record ? " on" : "off" }" data-operator-btn-selector=".recording-calls"><\/a><\/div><div class="cell actions entity-menu"><div class="studio-action-panel"><ul class="dropdown-content"><li class="dropdown-item with-icon edit edit-number-btn">${ASC.CRM.Resources.CRMVoipResource.EditBtn}<\/li><li class="dropdown-item with-icon delete show-remove-number-btn">${ASC.CRM.Resources.CRMVoipResource.DeleteBtn}<\/li><\/ul><\/div><\/div><\/div><div class="operators-box"><div class="add-operators-box"><span class="add-operators-btn link dotline plus">${ASC.CRM.Resources.CRMVoipResource.AddOperatorsBtn}<\/span><\/div>{{tmpl "voip-operators-tmpl"}}<\/div><\/div>');jQuery.template("voip-operators-tmpl",'{{each settings.operators}}<div class="operator with-entity-menu" data-operatorid="${id}"><div class="cell code"><\/div><div class="cell title"><img src="${userInfo.avatarSmall}" alt="${userInfo.displayName}" />${userInfo.displayName}<\/div><div class="cell outgoing-calls"><a class="on_off_button ${allowOutgoingCalls ? " on" : "off" } ${$data.settings.allowOutgoingCalls ? "" : "disable" }"><\/a><\/div><!--<div class="cell voicemail"><\/div>--><div class="cell recording-calls"><a class="on_off_button ${record ? " on" : "off" } ${$data.settings.record ? "" : "disable" }"><\/a><\/div><div class="cell actions entity-menu"><div class="studio-action-panel"><ul class="dropdown-content"><li class="dropdown-item delete-operator-btn">${ASC.CRM.Resources.CRMVoipResource.DeleteBtn}<\/li><\/ul><\/div><\/div><\/div>{{/each}}');jQuery.template("voip-countries-list-tmpl",'<div class="studio-action-panel"><ul class="dropdown-content">{{each countries}}<li class="dropdown-item"><span class="voip-flag ${iso}" data-iso="${iso}" data-code="${code}"><\/span>${title}<\/li>{{/each}}<\/ul><\/div>');jQuery.template("voip-available-number-tmpl",'<div id="anumber${number}" class="number"><input type="radio" name="buy-number-radio" data-number="${number}" {{if id}} data-numberId="${id}" {{/if}}/><div class="number-value">${number}<\/div><\/div>');
jQuery.template("projects_projectTmpl",'<tr {{if status !== 0}} class="noActiveProj" {{/if}} id="${id}">{{if !isSimpleView}}<td class="checkbox"><input type="checkbox"/><\/td><td class="status">{{tmpl({canEdit: $item.data.canEdit, status: ASC.Projects.StatusList.getById($item.data.status)}) \'projects_statusChangeContainer\'}}<\/td>{{/if}}<td class="nameProject stretch">{{if isPrivate}}<span title="${ASC.Projects.Resources.ProjectResource.HiddenProject}" class="private"><\/span>{{/if}}<a href="${projLink}" class="linkHeaderMedium {{if status !== 0}} gray-text{{/if}}">${title}<\/a><\/td><td class="taskCount">{{if taskCount != 0}}<a href="${linkTasks}" title="${ASC.Projects.Resources.ProjectResource.TitleProjectOpenTasks}">${taskCount}<\/a>{{/if}}<\/td><td class="responsible"><span class=\'userLink{{if responsible.id==\'4a515a15-d4d6-4b8e-828e-e0586f18f3a3\' || (responsible.isTerminated && !Teamlab.profile.isAdmin)}} not-action{{/if}}\' title="{{if !isSimpleView}}${ASC.Projects.Resources.ProjectResource.TitleProjectManager}{{/if}}">${responsible.displayName}<\/span>{{if participants != 0}}<a class="participants" title="${ASC.Projects.Resources.ProjectResource.TitleProjectTeam}" href="${linkParticip}">+${participants}<\/a>{{/if}}<\/td>{{if isSimpleView}}<td class="trash">{{if canEdit || canLinkContact}}<img src="${StudioManager.GetImage(\'unlink_16.png\')}"                    title="${ASC.Projects.Resources.ProjectsCommonResource.UnlinkProjects}" class="trash_delete" /><div class="trash_progress loader-middle" title=""><\/div>{{/if}}<\/td>{{/if}}<\/tr>');jQuery.template("memberTemplate",'<table class="listContainer"><tbody>{{each team}}<tr class="with-entity-menu pm-projectTeam-participantContainer {{if isProjectAdmin || isAdmin || isManager}} disable{{/if}}" data-partisipantId="${id}"><td style="" class="user-info"><div class="pm-projectTeam-userPhotoContainer {{if $data.isRetina}}retina{{/if}}"><img src="{{if $data.isRetina}}${avatar}{{else}}${avatarSmall}{{/if}}"/>{{if status == 2}}<span class="status-blocked"><\/span>{{/if}}                    {{if project.canEditTeam}}                    {{if isVisitor}}<span class="role collaborator"><\/span>{{/if}}                    {{if isAdmin && status!=2}}<span class="role admin"><\/span>{{/if}}                    {{/if}}<\/div><div class="user-info-container"><a class="user-name {{if typeof title === \'undefined\' }} without-title{{/if}}" href="${profileUrl}" title="${displayName}">${displayName}<\/a>{{if typeof title !== \'undefined\'}}<span title="${title}">${title}<\/span>{{/if}}<\/div><\/td>{{if project.canEditTeam && project.isPrivate}}<td class="right-settings">{{if status!=2}}<div>{{each security}}                    {{tmpl(security[$index], {showSplitter: $index !== security.length - 1}) \'projects_securityItem\'}}                    {{/each}}<\/div>{{/if}}<\/td>{{/if}}<td class="menupoint-container">{{if !(isVisitor && isMe)}}<div class="entity-menu" title="${ASC.Projects.Resources.ProjectsCommonResource.Actions}"><\/div>{{/if}}<\/td><\/tr>{{/each}}<\/tbody><\/table>');jQuery.template("member_template_without_photo",'<table class="listContainer"><tbody>{{each team}}<tr class="with-entity-menu pm-projectTeam-participantContainer {{if isAdmin || isManager}} disable{{/if}}" data-partisipantId="${id}"><td style="" class="user-info"><div class="user-info-container"><a class="user-name {{if typeof title === \'undefined\' }} without-title{{/if}}" href="${profileUrl}" title="${displayName}">${displayName}<\/a><\/div><\/td>{{if project.canEditTeam && project.isPrivate}}<td class="right-settings">{{if status!=2}}<div>{{each security}}                    {{tmpl(security[$index], {showSplitter: $index !== security.length - 1}) \'projects_securityItem\'}}                    {{/each}}<\/div>{{/if}}<\/td>{{/if}}<td class="menupoint-container"><div class="reset-action"><\/div><\/td><\/tr>{{/each}}<\/tbody><\/table>');jQuery.template("projects_securityItem",'<span class="right-checker pm-projectTeam-modulePermission{{if check}}On{{else}}Off{{/if}} {{if defaultDisabled}}no-dotted{{/if}}" data-flag="${flag}"><span>${title}<\/span><\/span>{{if $item.showSplitter}}<span class="splitter"><\/span>{{/if}}');jQuery.template("projectParticipant",'<li class="items-display-list_i" participantid="${id}"><span class="item-name"><a class="link" href="${profileUrl}" target="_blank">${title}<\/a><\/span><div class="reset-action" data-userid="${id}" title="$ASC.Projects.Resources.ProjectsCommonResource.Delete"><\/div><\/li>');jQuery.template("projects_team",'<div class="header-base block-cnt-splitter">${ASC.Projects.Resources.ProjectResource.ProjectLeader}<\/div><div class="block-cnt-splitter clearFix"><div class="pm-projectTeam-projectLeaderCard" style="float: left;"><img class="managerAvatar" src="${manager.avatar}"/><div class="manager-info" data-manager-guid="${manager.id}"><div><a class="link header-base middle bold" href="${manager.profileUrl}">${manager.displayName}<\/a><\/div>{{if manager.groups && manager.groups.length}}<div>${manager.groups[0].name}<\/div>{{/if}}<div>${Encoder.htmlEncode(manager.title)}<\/div><\/div><\/div><div style="margin-left: 380px; padding: 0 20px;"><div>${ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermission}:<\/div><div class="simple-marker-list">${ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleA}<\/div><!--<% if (!ProjectSecurity.IsPrivateDisabled) { %>--><div class="simple-marker-list">{{html jq.format(ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleB, "<span id=\'PrivateProjectHelp\' class=\'baseLinkAction\'>", "<\/span>")}}<\/div><div class="simple-marker-list">{{html jq.format(ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleC, "<span id=\'RestrictAccessHelp\' class=\'baseLinkAction\'>", "<\/span>", "<br/>")}}<\/div><div class="popup_helper" id="AnswerForPrivateProjectTeam"><p>{{html jq.format(Encoder.htmlEncode(ASC.Projects.Resources.ProjectsCommonResource.HelpAnswerPrivateProjectTeam), "<br/>", "<b>", "<\/b>")}}                    {{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.ProjectsCommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><div class="popup_helper" id="AnswerForRestrictAccessTeam"><p>{{html Encoder.htmlEncode(ASC.Projects.Resources.ProjectsCommonResource.HelpAnswerRestrictAccessTeam)}}                    {{if ASC.Resources.Master.HelpLink}}<a target="_blank" href="${ASC.Resources.Master.HelpLink + \'/gettingstarted/projects.aspx#ManagingYourTeam_block\'}">${ASC.Projects.Resources.ProjectsCommonResource.LearnMoreLink}<\/a>{{/if}}<\/p><\/div><!--<% } else { %><div class="simple-marker-list">${ASC.Projects.Resources.ProjectResource.ClosedProjectTeamManagerPermissionArticleForOpen}<\/div><% } %>--><\/div><\/div><div class="block-cnt-splitter">{{if project.canEditTeam}}<div id="pm-projectTeam-Selector" class="link dotline plus">${ASC.Projects.Resources.ProjectResource.ManagmentTeam}<\/div>{{/if}}<\/div><div id="team_container" class="block-cnt-splitter {{if !project.canEditTeam}} no-access{{/if}}">{{tmpl \'memberTemplate\'}}<\/div>');
jq.browser.safari=(jq.browser.safari&&!/chrome/.test(navigator.userAgent.toLowerCase()))==!0;typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}}());jQuery.extend({forceNumber:function(n){function i(n,t){var r=n.value,i=jq(n);return setTimeout(function(){var n=i.val();if(!t.regex.test(n)){i.val(r);return}typeof t.onPasteCallback=="function"&&t.onPasteCallback()},0),!0}var t=jQuery.extend({parent:"body",input:"",integerOnly:!0,positiveOnly:!0,onPasteCallback:null,separator:".",lengthAfterSeparator:null},n);if(t.input!=""){t.regex=new RegExp(["^",t.positiveOnly?"":"-?","\\d*$"].join(""));t.integerOnly===!1&&(t.regex=t.lengthAfterSeparator!=null?new RegExp(["^",t.positiveOnly?"":"-?","\\d*(",t.separator,"\\d{1,",t.lengthAfterSeparator,"})?$"].join("")):new RegExp(["^",t.positiveOnly?"":"-?","\\d*(",t.separator,"\\d*)?$"].join("")));jq(t.parent).on("keypress",t.input,function(n){var h=this,r=n.which,e=h.selectionStart,u=jq(h).val(),o,s;if(r!=8&&r!=9&&r!=0&&(!n.hasOwnProperty("ctrlKey")||n.ctrlKey!==!0||r!==99&&r!==97)){if(n.hasOwnProperty("ctrlKey")&&n.ctrlKey===!0&&r===118)return i(h,t);r=String.fromCharCode(r);var c=r=="-",f=/\d/.test(r),v=u.indexOf("-")!=-1,l=r==t.separator&&u.length,a=u.indexOf(t.separator)!=-1;if(t.integerOnly){if(t.positiveOnly){if(f)return}else if(f||c&&!v&&e==0)return}else if(o=0,s=!0,t.lengthAfterSeparator!=null&&isFinite(t.lengthAfterSeparator)&&(l&&(o=u.length-e),(f||!t.positiveOnly&&c)&&a&&(o=u.length-u.indexOf(t.separator)-1+(e>u.indexOf(t.separator)?1:0)),s=o<=t.lengthAfterSeparator),t.positiveOnly){if((f||l&&!a)&&s)return}else if((f||l&&!a||c&&!v&&e==0)&&s)return;n.returnValue=!1;n.preventDefault&&n.preventDefault()}});jq(t.parent).on("paste",t.input,function(){i(this,t)})}},getURLParam:function(n){var o,r,t,s;n=n.toLowerCase();var i="",u=window.location.href.toLowerCase(),f=!1,e=n+"=",h=e.length;if(u.indexOf("?")>-1)for(o=u.substr(u.indexOf("?")+1),r=o.split("&"),t=0;t<r.length;t++)if(r[t].substr(0,h)==e){s=r[t].split("=");i=s[1];f=!0;break}return f==!1?null:i.indexOf("#")>-1?i.split("#")[0]:i}});jQuery.extend(StudioManager,{GetCRMImage:function(n){return ASC.CRM.Data.ImageWebPath+"/"+n}});jq.fn.datepickerWithButton=function(n){return this.datepicker(jQuery.extend({showOn:"both",buttonText:"",buttonImageOnly:!1},n))};ASC.CRM.Common=function(){return{tooltip:function(n,t,i){var r=function(n){setTimeout(function(){n.data("overTaskDescrPanel")||n.hide()},150)};jq(n).each(function(){var u=jq(this).attr("id").trim().split("_")[1],f=(jq(this).attr("title")||"").trim(),e=ASC.CRM.Common.getTooltipParams(jq(this)),n=null;if(f!=""||e!=""){jq("#"+t+u).length>0&&jq("#"+t+u).remove();jq("body").append(["<div class='studio-action-panel tooltip' id='",t,u,"'>",jq.htmlEncodeLight(f).replace(/&#10;/g,"<br/>").replace(/  /g," &nbsp;"),e,"<\/div>"].join(""));n=jq("#"+t+u);jq(this).removeAttr("title").off("mouseenter").on("mouseenter",function(){var r=jq(this),o=r.offset().top+r.height()+5,f=r.offset().left+5,e;jq(n).data("overTaskDescrPanel",!0);jq(n).css("top",o);typeof i!="undefined"&&i===!0?(e=jq(window).width()-f-35,jq(n).css("right",e)):jq(n).css("left",f);jq("div[id^='"+t+"']:not(div[id='"+t+u+"'])").hide();n.fadeIn(300)}).off("mouseleave").on("mouseleave",function(){jq(n).data("overTaskDescrPanel",!1);r(n)});jq(n).on("mouseenter",function(){jq(n).data("overTaskDescrPanel",!0)}).on("mouseleave",function(){jq(n).data("overTaskDescrPanel",!1);r(n)});jq(document).on("keypress",function(t){t.hasOwnProperty("ctrlKey")&&t.ctrlKey===!0&&(t.which===99||t.which===97)||(jq(n).data("overTaskDescrPanel",!1),r(n))})}})},getTooltipParams:function(n){var t=jq(n),r=(t.attr("ttl_label")||"").trim(),u=(t.attr("ttl_value")||"").trim(),f=(t.attr("dscr_label")||"").trim(),e=(t.attr("dscr_value")||"").trim(),o=(t.attr("resp_label")||"").trim(),s=(t.attr("resp_value")||"").trim(),i;return(t.removeAttr("ttl_label"),t.removeAttr("ttl_value"),t.removeAttr("dscr_label"),t.removeAttr("dscr_value"),t.removeAttr("resp_label"),t.removeAttr("resp_value"),(r==""||u=="")&&(f==""||e=="")&&(o==""||s==""))?"":(i=["<table class='tooltipTable' cellspacing='0' cellpadding='0'>","<colgroup>","<col style='width: 1%;' />","<col style='width: 15px;' />","<col />","<\/colgroup>","<tbody>",].join(""),r!=""&&u!=""&&(i+=["<tr><td><div class='param'>",jq.htmlEncodeLight(r).replace(/&#10;/g,"<br/>").replace(/  /g," &nbsp;"),":<\/div><\/td>","<td><\/td>","<td><div class='value'>",jq.htmlEncodeLight(u).replace(/&#10;/g,"<br/>").replace(/  /g," &nbsp;"),"<\/div><\/td><\/tr>"].join("")),f!=""&&e!=""&&(i+=["<tr><td><div class='param'>",jq.htmlEncodeLight(f).replace(/&#10;/g,"<br/>").replace(/  /g," &nbsp;"),":<\/div><\/td>","<td><\/td>","<td><div class='value'>",jq.linksParser(jq.htmlEncodeLight(e).replace(/&#10;/g,"<br/>").replace(/  /g," &nbsp;")),"<\/div><\/td><\/tr>"].join("")),o!=""&&s!=""&&(i+=["<tr><td><div class='param'>",jq.htmlEncodeLight(o).replace(/&#10;/g,"<br/>").replace(/  /g," &nbsp;"),":<\/div><\/td>","<td><\/td>","<td><div class='value'>",jq.htmlEncodeLight(s).replace(/&#10;/g,"<br/>").replace(/  /g," &nbsp;"),"<\/div><\/td><\/tr>"].join("")),i+"<\/tbody><\/table>")},registerChangeHoverStateByParent:function(n,t){var i=!0;(typeof t=="undefined"||t==null||t=="")&&(i=!1,t=n);jq(document).on("mouseover",t,function(){var t={};(t=i?jq(this).find(n):jq(this),t.length!=0)&&t.addClass("hover")});jq(document).on("mouseout",t,function(){var t;(t=i?jq(this).find(n):jq(this),t.length!=0)&&t.removeClass("hover")})},RegisterContactInfoCard:function(){jq("#contactInfoCardResources").length==0&&jq.tmpl("contactInfoCardResourcesTmpl",null).appendTo("body");var n=new PopupBox("popup_ContactInfoCard",320,140,"tintLight","popupbox-border","",{apiMethodName:"Teamlab.getCrmContact",tmplName:"contactInfoCardTmpl",customFactory:ASC.CRM.Common.contactItemFactory});jq(window).on("registerContactInfoCard",function(t,i){var r=i.attr("id");r!=null&&r!=""&&n.RegistryElement(r,i.attr("data-id"))});jq(".crm-companyInfoCardLink, .crm-peopleInfoCardLink").each(function(){jq(window).trigger("registerContactInfoCard",[jq(this)])})},contactItemFactory:function(n,t){var u,f,i,o,e,r;if(n.showCompanyLink=typeof t!="undefined"&&t!=null&&t.hasOwnProperty("showCompanyLink")&&t.showCompanyLink,n.showUnlinkBtn=typeof t!="undefined"&&t!=null&&t.hasOwnProperty("showUnlinkBtn")&&t.showUnlinkBtn,n.showActionMenu=typeof t!="undefined"&&t!=null&&t.hasOwnProperty("showActionMenu")&&t.showActionMenu,u=StudioManager.getLocationPathToModule("CRM")+"Default.aspx?id=",n.contactLink=u+n.id,n.showCompanyLink&&typeof n.company&&n.company!=null&&(n.company.contactLink=u+n.company.id),n.primaryAddress=null,n.primaryEmail=null,typeof n.addresses!="undefined"&&n.addresses.length!=0)for(f in n.addresses)if(n.addresses.hasOwnProperty(f)&&(i=n.addresses[f],i.isPrimary)){o=ASC.CRM.Common.getAddressQueryForMap(i);n.primaryAddress={Data:ASC.CRM.Common.getAddressTextForDisplay(i),Href:"http://maps.google.com/maps?q="+o,categoryName:i.categoryName};break}if(typeof n.commonData!="undefined"&&n.commonData.length!=0)for(e in n.commonData)if(n.commonData.hasOwnProperty(e)&&(r=n.commonData[e],r.infoType==1&&r.isPrimary)){n.primaryEmail=r;break}},getAddressTextForDisplay:function(n){if(typeof n!="object")return"";var i=[],t=[];return n.street&&i.push(jq.htmlEncodeLight(n.street)),n.city&&t.push(n.city),n.state&&t.push(n.state),n.zip&&t.push(n.zip),t.length&&i.push(jq.htmlEncodeLight(t.join(", "))),n.country&&i.push(jq.htmlEncodeLight(n.country)),i.join(",<br/>")},getAddressQueryForMap:function(n){if(typeof n!="object")return"";var t=[];return n.street&&t.push(n.street),n.city&&t.push(n.city),n.state&&t.push(n.state),n.zip&&t.push(n.zip),n.country&&t.push(n.country),t.join(", ").trim().replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/\n/ig," ")},isHiddenForScroll:function(n){var t=n.position(),i=jq(window).scrollTop(),r=jq(window).scrollLeft();return t.top>i&&t.left>r&&t.top+n.height()<i+jq(window).height()&&t.left+n.width()<r+jq(window).width()?!1:!0},renderCustomFields:function(n,t,i,r){for(var f,s,e=[],o={},u=0,h=n.length;u<h;u++)(o=n[u],o.mask.trim()!="")&&(o.mask=jq.evalJSON(o.mask),n[u].fieldType==2&&e.push(n[u]));for(jq.tmpl(i,n).appendTo(r),f=0,s=e.length;f<s;f++)jq("#"+t+e[f].id).val(e[f].value)},sortCustomFieldList:function(n){for(var t,r=[],f={label:"",labelid:0,list:[]},i=0,u=n.length;i<u;i++)t=n[i],t.mask.trim()!=""&&(t.mask=jq.evalJSON(t.mask)),t.fieldType==4||i==u-1?(t.fieldType!=4&&f.list.push(t),r.push(f),t.fieldType==4&&(f={label:t.label,labelid:t.id,list:[]})):f.list.push(t);for(i=0,u=r.length;i<u;i++)r[i].list.length==0&&(r.splice(i,1),i--,u--);return r},initTextEditCalendars:function(){for(var i=jq("input.textEditCalendar"),n=null,r="",t=0,u=i.length;t<u;t++)n=jq(i[t]),r=n.val().trim(),n.mask(ASC.Resources.Master.DatePatternJQ),r==""&&n.val(""),n.datepickerWithButton()},changeCountInTab:function(n,t){var r,i,u,f;if(typeof t!="undefined"&&t!=""){if(jq("li.viewSwitcherTab_"+t).length==0)return!1;r=jq("li.viewSwitcherTab_"+t)}else{if(jq("li[id$=_ViewSwitcherTab].viewSwitcherTabSelected").length==0)return!1;r=jq("li[id$=_ViewSwitcherTab].viewSwitcherTabSelected")[0]}i=jq(r).text().split(" ");typeof n=="string"?n=="add"?i.length>1?(u=parseInt(i[i.length-1].replace("(","").replace(")",""))+1,i[i.length-1]=jq.format("({0})",u),jq(r).text(i.join(" "))):jq(r).text(jq.format("{0} (1)",i[0])):n=="delete"&&(u=parseInt(i[i.length-1].replace("(","").replace(")",""))-1,u>0?(i[i.length-1]=jq.format("({0})",u),jq(r).text(i.join(" "))):jq(r).text(i[0])):typeof n=="number"&&(f=parseInt(n),f>0?jq(r).text(jq.format("{0} ({1})",i[0],f)):jq(r).text(i[0]))},getHexRGBColor:function(n){var i,t;if(n=n.replace(/\s/g,""),i=n.match(/^rgb\((\d{1,3}[%]?),(\d{1,3}[%]?),(\d{1,3}[%]?)\)$/i),i)for(n="#",t=1;t<=3;t++)n+=Math.round((i[t][i[t].length-1]=="%"?2.55:1)*parseInt(i[t])).toString(16).replace(/^(.)$/,"0$1");else n=n.replace(/^#?([\da-f])([\da-f])([\da-f])$/i,"$1$1$2$2$3$3");return n},animateElement:function(n){if(typeof n=="object"){var t=n.element;ASC.CRM.Common.isHiddenForScroll(t)&&(jq.scrollTo(t),typeof n.whenScrollFunc=="function"&&n.whenScrollFunc());typeof n.afterScrollFunc=="function"&&n.afterScrollFunc();t.css({"background-color":"#ffffcc"});t.animate({backgroundColor:"#ffffff"},2e3,function(){t.css({"background-color":""})})}},removeExportButtons:function(){jq("#exportListToCSV").length==1&&jq("#exportListToCSV").parent().remove()},hideExportButtons:function(){jq("#exportListToCSV").length==1&&jq("#exportListToCSV").parent().addClass("display-none");jq("#otherActions li:not(.display-none)").length||jq("#menuOtherActionsButton").hide()},showExportButtons:function(){jq("#exportListToCSV").length==1&&jq("#exportListToCSV").parent().removeClass("display-none");!jq("#otherActions li:not(.display-none)").length||jq("#menuOtherActionsButton").show()},exportCurrentListToCsv:function(){jq("#otherActions").hide();ASC.CRM.PartialExport.startExport()},getMailModuleBasePath:function(){var n=location.href.toLowerCase().split("products");return n[0]+"addons/mail/"},getAccessListHtml:function(n){var i,t,u,r;if(typeof n=="undefined"||n.length==0)return"";for(i="",t=0,u=n.length;t<u;t++)r=window.UserManager.getUser(n[t]),i+=[t==0?"":",<span class='splitter'><\/span>",r!=null?r.displayName:ASC.CRM.Data.ProfileRemoved].join("");return i},convertText:function(n,t){var i,r,u;if(n=typeof n=="string"?n:"",!n)return"";if(t===!0){for(i=[["&lt;","<"],["&gt;",">"],["&amp;","&"]],r=i.length;r--;)n=n.replace(new RegExp(i[r][1],"g"),i[r][0]);return n}return u=document.createElement("textarea"),u.innerHTML=n,u.value},loadContactFoto:function(n,t,i,r){i.indexOf("filehandler.ashx")!=-1?jq.ajax({type:"GET",url:i,success:function(i){try{if(n.attr("src").indexOf(i)===-1){t.one("load",function(){if(typeof r!="undefined"&&r===!0){var i=(t.parent().width()-t.width())/2,u=(t.parent().height()-t.height())/2;t.css("left",i).css("top",u);n.fadeOut(500);t.fadeIn(500)}else n.hide(),t.show()});t.attr("src",[i,"?",(new Date).getTime()].join(""))}}catch(u){}}}):(t.attr("src",i),n.hide(),t.show())},getPagingParamsFromCookie:function(n){var t=jq.cookies.get(n);return t!=null&&t.hasOwnProperty("page")&&t.hasOwnProperty("countOnPage")?{countOnPage:t.countOnPage,page:t.page}:null},arrayUnique:function(n){for(var i,t=n.concat(),r=0;r<t.length;++r)for(i=r+1;i<t.length;++i)t[r]===t[i]&&t.splice(i--,1);return t},numberFormat:function(n,t){function u(n,t){var r,f;if(n.length<=3)return n;var e=n.length,i="",u=0;for(r=e-1;r>=0;r--)f=n.substr(r,1),u%3!=0||u==0||isNaN(parseFloat(f))||(i=t+i),i=f+i,u++;return i}var r={before:"",after:"",decimals:2,dec_point:".",thousands_sep:","},i,n;return typeof n!="number"&&(n=parseFloat(n),isNaN(n))?!1:(t=t&&typeof t=="object"?jq.extend(r,t):r,n=n.toFixed(t.decimals),n.indexOf(".")!=-1?(i=n.split("."),n=u(i[0],t.thousands_sep)+t.dec_point+i[1]):n=u(n,t.thousands_sep),[t.before,n,t.after].join(""))},historyEventMsgObjFactory:function(n){var t=JSON.parse(n.content),i,r;if(n.content=t.subject!=null&&t.subject!=""?t.subject:ASC.CRM.Resources.CRMJSResource.NoSubject,n.message={id:n.id,subject:n.content,is_sended:t.is_sended,important:t.important,from:t.from,to:t.to,cc:t.cc,bcc:t.bcc,message_url:t.message_url},t.hasOwnProperty("date_created"))try{n.message.date_created=Teamlab.getDisplayDatetime(Teamlab.serializeDate(t.date_created))}catch(u){n.message.date_created=t.date_created}else n.message.date_created=n.displayCrtdate;(t.cc!=""||t.bcc!="")&&(i=t.cc!=""?t.cc:"",i+=t.bcc!=""?(i!=""?", ":"")+t.bcc:"",n.message.cc_text=i);r=ASC.CRM.Common.getMailModuleBasePath();n.message.fromHref=[r,"#composeto/email=",n.message.from].join("");n.message.toHref=[r,"#composeto/email=",n.message.to].join("")},setDocumentTitle:function(n){document.title=jq.format("{0} - {1}",n,ASC.CRM.Resources.CRMCommonResource.ProductName)},bindOnbeforeUnloadEvent:function(){window.onbeforeunload==null&&(window.onbeforeunload=function(){return ASC.Resources.Master.ResourceJS.WarningMessageBeforeUnload})},unbindOnbeforeUnloadEvent:function(){window.onbeforeunload=null},getRelativeItemsLinkString:function(n,t,i){var r="",u="",f="";t==null&&(t="");i==null&&(i="");switch(t.trim()){case"deal_milestone":r=ASC.CRM.Resources.CRMJSResource.OneDeal;u=ASC.CRM.Resources.CRMJSResource.ManyDeals;f=ASC.CRM.Resources.CRMJSResource.NoDeals;break;case"contact_stage":case"contact_type":r=ASC.CRM.Resources.CRMJSResource.OneContact;u=ASC.CRM.Resources.CRMJSResource.ManyContacts;f=ASC.CRM.Resources.CRMJSResource.NoContacts;break;case"task_category":r=ASC.CRM.Resources.CRMJSResource.OneTask;u=ASC.CRM.Resources.CRMJSResource.ManyTasks;f=ASC.CRM.Resources.CRMJSResource.NoTasks;break;case"history_category":r=ASC.CRM.Resources.CRMJSResource.OneEvent;u=ASC.CRM.Resources.CRMJSResource.ManyEvents;f=ASC.CRM.Resources.CRMJSResource.NoEvents;break;case"custom_field":case"tag":switch(i.trim()){case"opportunity":r=ASC.CRM.Resources.CRMJSResource.OneDeal;u=ASC.CRM.Resources.CRMJSResource.ManyDeals;f=ASC.CRM.Resources.CRMJSResource.NoDeals;break;case"case":r=ASC.CRM.Resources.CRMJSResource.OneCase;u=ASC.CRM.Resources.CRMJSResource.ManyCases;f=ASC.CRM.Resources.CRMJSResource.NoCases;break;case"company":r=ASC.CRM.Resources.CRMJSResource.OneCompany;u=ASC.CRM.Resources.CRMJSResource.ManyCompanies;f=ASC.CRM.Resources.CRMJSResource.NoCompanies;break;case"people":case"person":r=ASC.CRM.Resources.CRMJSResource.OnePerson;u=ASC.CRM.Resources.CRMJSResource.ManyPersons;f=ASC.CRM.Resources.CRMJSResource.NoPersons;break;default:r=ASC.CRM.Resources.CRMJSResource.OneContact;u=ASC.CRM.Resources.CRMJSResource.ManyContacts;f=ASC.CRM.Resources.CRMJSResource.NoContacts}}return n==0?f:n==1?"1 "+r:n+" "+u},createInvoiceMail:function(n,t){Teamlab.getCrmContactInfo({},n.contact.id,{success:function(i,r){for(var u,e="",f=0,o=r.length;f<o;f++)if(r[f].infoType==1&&(e=r[f].data,r[f].isPrimary))break;n.contact.email=e;u=new ASC.Mail.Message;u.to=[n.contact.email||""];u.subject="";u.body=n.description.replace(/\r\n|\n|\r/g,"<br>");u.AddDocumentsForSave([n.fileId]);ASC.Mail.Utility.SaveMessageInDrafts(u).done(function(n,i){LoadingBanner.hideLoading();t&&t.location?t.location.href=i.messageUrl:window.location.href=i.messageUrl}).fail(function(n,i){if(console.log(n,i),i==="No accounts."){if(t&&t.close(),jq("#noMailAccountsError").length==0){jq.tmpl("template-blockUIPanel",{id:"noMailAccountsError",headerTest:ASC.CRM.Resources.CRMCommonResource.Alert,questionText:"",innerHtmlText:["<div>",ASC.CRM.Resources.CRMCommonResource.NoMailAccountsAvailableError,"<\/div>"].join(""),CancelBtn:ASC.CRM.Resources.CRMCommonResource.Close,OKBtn:ASC.CRM.Resources.CRMCommonResource.AddMailAccount,OKBtnClass:"OKAddMailAccount"}).appendTo(".mainContainerClass .containerBodyBlock");jq("#noMailAccountsError").on("click",".OKAddMailAccount",function(){window.open(ASC.CRM.Common.getMailModuleBasePath(),"_blank");jq.unblockUI()})}PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#noMailAccountsError",500)}LoadingBanner.hideLoading()})},error:function(n,t){console.log(t)}})},setPostionPageLoader:function(){jq(".mainPageContent").children(".loader-page").css({top:jq(window).height()/2+"px"})}}}();ASC.CRM.PrivatePanel=function(){return{changeIsPrivateCheckBox:function(){jq("#isPrivate").is(":checked")?jq("#privateSettingsBlock").show():jq("#privateSettingsBlock").hide()},init:function(n,t,i,r,u){ASC.CRM.UserSelectorListView.Init("","UserSelectorListView",n,t,i,r,u,"#privateSettingsBlock",!0);jq("#privateSettingsBlock").is(":visible")?jq("#isPrivate").prop("checked",!0):jq("#isPrivate").prop("checked",!1)}}}();ASC.CRM.HistoryView=function(){var n=!1,i=function(n){jq("#itemID").val(n.id)},t=function(){if(ASC.CRM.HistoryView.isFirstTime==!0){ASC.CRM.HistoryView.isFirstTime=!1;return}LoadingBanner.displayLoading();ASC.CRM.HistoryView.ShowMore=!0;r(0)},f=function(){if(!ASC.CRM.HistoryView.ShowMore)return!1;jq("#showMoreEventsButtons .crm-showMoreLink").hide();jq("#showMoreEventsButtons .loading-link").show();r(jq("#eventsTable tr").length)},r=function(n){var t={};t=ASC.CRM.HistoryView.getFilterSettings();t.entityid=ASC.CRM.HistoryView.ContactID!=0?ASC.CRM.HistoryView.ContactID:ASC.CRM.HistoryView.EntityID;t.entitytype=ASC.CRM.ListTaskView.EntityType;t.Count=ASC.CRM.HistoryView.CountOfRows;t.startIndex=n;Teamlab.getCrmHistoryEvents({startIndex:n||0},{filter:t,success:ASC.CRM.HistoryView.CallbackMethods.get_events_by_filter})},u=function(){var i=jq("#historyBlock textarea").val(),n,t;return ASC.CRM.HistoryView.historyCKEditor&&(i=ASC.CRM.HistoryView.historyCKEditor.getData()),n={content:i.trim(),categoryId:eventCategorySelector.CategoryID},ASC.CRM.HistoryView.ContactID!=0?(n.contactID=ASC.CRM.HistoryView.ContactID,jq("#itemID").val()!=""&&parseInt(jq("#itemID").val())>0&&jq("#typeID").val()!=""&&(n.entityId=jq("#itemID").val(),n.entityType=jq("#typeID").val())):(jq("#contactID").val()!=0&&(n.contactID=jq("#contactID").val()),n.entityId=ASC.CRM.HistoryView.EntityID,n.entityType=ASC.CRM.HistoryView.EntityType),jq("#historyBlock .textEditCalendar").val().trim()!=""?(n.created=jq("#historyBlock .textEditCalendar").datepicker("getDate"),t=new Date,n.created.setHours(t.getHours(),t.getMinutes(),t.getSeconds())):(n.created=new Date,jq("#historyBlock .textEditCalendar").datepicker("setDate",n.created)),window.SelectedUsers_HistoryUserSelector.IDs.length!=0&&(n.notifyUserList=window.SelectedUsers_HistoryUserSelector.IDs),n},e=function(){var n=1,t=7,r={contactID:ASC.CRM.HistoryView.ContactID,contactAlsoIsParticipant:!0},u={contactID:ASC.CRM.HistoryView.ContactID};Teamlab.joint().getCrmOpportunities({},{filter:r}).getCrmCases({},{filter:u}).start({},{success:function(r,u,f){jq("#eventLinkToPanel").replaceWith(jq.tmpl("eventLinkToPanelTmpl",{contactID:ASC.CRM.HistoryView.ContactID,entityTypeOpportunity:n,entityTypeCase:t,deals:u,cases:f}));jq("#typeSwitcherSelect").val(-2).on("change",function(){switch(this.value){case"-2":ASC.CRM.HistoryView.changeType(-2,"");break;case"-1":jq(this).val(-2).trigger("change");break;default:for(var n=0,t=ASC.CRM.Data.historyEntityTypes.length;n<t;n++)if(this.value==ASC.CRM.Data.historyEntityTypes[n].value){ASC.CRM.HistoryView.changeType(ASC.CRM.Data.historyEntityTypes[n].value,ASC.CRM.Data.historyEntityTypes[n].apiname);break}}}).tlCombobox();jq("#dealsSwitcherSelect").show().val(-2).on("change",function(){i({id:this.value})}).tlCombobox().tlCombobox("hide");jq("#casesSwitcherSelect").show().val(-2).on("change",function(){i({id:this.value})}).tlCombobox().tlCombobox("hide");r[0].__count>0||(jq("#typeSwitcherSelect>option[value='"+n+"']:not(.hidden)").addClass("hidden"),jq("#typeSwitcherSelect").tlCombobox());r[1].__count>0||(jq("#typeSwitcherSelect>option[value='"+t+"']:not(.hidden)").addClass("hidden"),jq("#typeSwitcherSelect").tlCombobox());r[0].__count>0||r[1].__count>0?jq("#eventLinkToPanel").removeClass("empty-select"):jq("#eventLinkToPanel").addClass("empty-select")}})},o=function(){Teamlab.getCrmEntityMembers({showCompanyLink:!0,showUnlinkBtn:!1,showActionMenu:!0},ASC.CRM.HistoryView.EntityType,ASC.CRM.HistoryView.EntityID,{success:function(n,t){jq("#eventLinkToPanel").replaceWith(jq.tmpl("eventLinkToPanelTmpl",{contactID:0,contacts:t}));jq("#typeSwitcherSelect").val(-2).on("change",function(){switch(this.value){case"-2":ASC.CRM.HistoryView.changeType(-2,"");break;case"-1":jq(this).val(-2).trigger("change");break;default:for(var n=0,t=ASC.CRM.Data.historyEntityTypes.length;n<t;n++)if(this.value==ASC.CRM.Data.historyEntityTypes[n].value){ASC.CRM.HistoryView.changeType(ASC.CRM.Data.historyEntityTypes[n].value,ASC.CRM.Data.historyEntityTypes[n].apiname);break}}}).tlCombobox();jq("#contactSwitcherSelect").val(-2).on("change",function(){switch(this.value){case"-2":ASC.CRM.HistoryView.changeContact(-1);break;case"-1":ASC.CRM.HistoryView.changeContact(-1);jq(this).val(-2).trigger("change");break;default:ASC.CRM.HistoryView.changeContact(this.value)}}).tlCombobox();n.__count>0?jq("#eventLinkToPanel").removeClass("empty-select"):jq("#eventLinkToPanel").addClass("empty-select")}})},s=function(){jq.tmpl("template-emptyScreen",{ID:"emptyContentForEventsFilter",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_filter,Header:ASC.CRM.Resources.CRMCommonResource.EmptyHistoryHeader,Describe:ASC.CRM.Resources.CRMCommonResource.EmptyHistoryDescription,ButtonHTML:["<a class='clearFilterButton link dotline' href='javascript:void(0);' ","onclick='ASC.CRM.HistoryView.advansedFilter.advansedFilter(null);'>",ASC.CRM.Resources.CRMCommonResource.ClearFilter,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#eventsList")},h=function(){ASC.CRM.FileUploader.OnBeginCallback_function=function(){n=!0;LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.AddThisNoteProggress;LoadingBanner.showLoaderBtn("#historyBlock");jq("#historyBlock textarea, #historyBlock input, #historyBlock select").prop("disabled",!0);jq(".attachLink").addClass("disabledLink")};ASC.CRM.FileUploader.OnAllUploadCompleteCallback_function=function(){var t=u();t.fileId=ASC.CRM.FileUploader.fileIDs;Teamlab.addCrmHistoryEvent({},t,{success:ASC.CRM.HistoryView.CallbackMethods.add_event,after:function(){n=!1;LoadingBanner.hideLoaderBtn("#historyBlock");jq("#historyBlock .middle-button-container a.button.blue.middle").addClass("disable");jq("#historyBlock textarea, #historyBlock input, #historyBlock select").prop("disabled",!1);jq(".attachLink").removeClass("disabledLink")}})};ASC.CRM.FileUploader.activateUploader();ASC.CRM.FileUploader.fileIDs.clear()},c=function(){var t=ASC.CRM.Data.IsCRMAdmin?jq.format(ASC.CRM.Resources.CRMCommonResource.HistoryCategoriesHelpInfo,"<a class='linkAction' href='Settings.aspx?type=history_category' target='blank'>","<\/a>"):"",n={};n=ASC.CRM.Data.eventsCategories.length>0?ASC.CRM.Data.eventsCategories[0]:{id:0,title:"",imgSrc:""};window.eventCategorySelector=new ASC.CRM.CategorySelector("eventCategorySelector",n);eventCategorySelector.renderControl(ASC.CRM.Data.eventsCategories,n,"#categorySelectorContainer",160,t)},p=function(n){for(var t=0,i=ASC.CRM.HistoryView.EventsList.length;t<i;t++)if(ASC.CRM.HistoryView.EventsList[t].id==n)return ASC.CRM.HistoryView.EventsList[t];return null},l=function(n){for(var t=0,i=ASC.CRM.HistoryView.EventsList.length;t<i;t++)if(ASC.CRM.HistoryView.EventsList[t].id==n){ASC.CRM.HistoryView.EventsList.splice(t,1);return}},a=function(){if(jq("#eventsAdvansedFilter").advansedFilter){var n=new Date,r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),u=new Date(new Date(r).setDate(n.getDate()-1)),t=Teamlab.serializeTimestamp(r),i=Teamlab.serializeTimestamp(u);ASC.CRM.HistoryView.advansedFilter=jq("#eventsAdvansedFilter").advansedFilter({anykey:!1,hintDefaultDisable:!1,maxfilters:-1,maxlength:"100",store:!1,filters:[{type:"flag",id:"my",apiparamname:"createBy",title:ASC.CRM.Resources.CRMCommonResource.MyEventsFilter,group:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible,groupby:"responsible",defaultparams:{value:Teamlab.profile.id}},{type:"person",id:"responsibleID",apiparamname:"createBy",title:ASC.CRM.Resources.CRMCommonResource.CustomResponsibleFilter,group:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible,groupby:"responsible",filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible},{type:"combobox",id:"today",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.Today,filtertitle:ASC.CRM.Resources.CRMCommonResource.Date,group:ASC.CRM.Resources.CRMCommonResource.Date,groupby:"date",options:[{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today,def:!0},{value:jq.toJSON([i,i]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday}]},{type:"combobox",id:"yesterday",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.Yesterday,filtertitle:ASC.CRM.Resources.CRMCommonResource.Date,group:ASC.CRM.Resources.CRMCommonResource.Date,groupby:"date",options:[{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([i,i]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday,def:!0}]},{type:"daterange",id:"fromToDate",title:ASC.CRM.Resources.CRMCommonResource.CustomDateFilter,group:ASC.CRM.Resources.CRMCommonResource.Date,groupby:"date",filtertitle:ASC.CRM.Resources.CRMCommonResource.Date},{type:"combobox",id:"categoryID",apiparamname:"categoryID",title:ASC.CRM.Resources.CRMCommonResource.ByCategory,group:ASC.CRM.Resources.CRMCommonResource.Other,options:jq.merge(jq.merge([],ASC.CRM.Data.eventsCategories),ASC.CRM.Data.systemCategories),defaulttitle:ASC.CRM.Resources.CRMCommonResource.Choose,defaultvalue:"0"}],sorters:[{id:"created",title:ASC.CRM.Resources.CRMCommonResource.Date,dsc:!0,def:!0},{id:"createby",title:ASC.CRM.Resources.CRMCommonResource.Author,dsc:!1,def:!1},{id:"content",title:ASC.CRM.Resources.CRMCommonResource.Content,dsc:!1,def:!1},{id:"category",title:ASC.CRM.Resources.CRMCommonResource.Category,dsc:!1,def:!1}]}).on("setfilter",ASC.CRM.HistoryView.setFilter).on("resetfilter",ASC.CRM.HistoryView.resetFilter)}},v=function(){var i,n,t;if(typeof UserList_HistoryUserSelector!="undefined"&&window.UserList_HistoryUserSelector!=null){for(i=[],n=0,t=ASC.CRM.Data.crmAdminList.length;n<t;n++)i.push(ASC.CRM.Data.crmAdminList[n].id);for(window.UserList_HistoryUserSelector=ASC.CRM.Common.arrayUnique(window.UserList_HistoryUserSelector.concat(i)),n=0,t=window.UserList_HistoryUserSelector.length;n<t;n++)if(window.UserList_HistoryUserSelector[n]===Teamlab.profile.id){window.UserList_HistoryUserSelector.splice(n,1);break}}else window.UserList_HistoryUserSelector=null;ASC.CRM.UserSelectorListView.Init("_HistoryUserSelector","HistoryUserSelector",!1,"",[],window.UserList_HistoryUserSelector,new Array(Teamlab.profile.id),"#historyViewUserSelector",!1);jq("#selectedUsers_HistoryUserSelector").appendTo("#selectedUsers_HistoryUserSelector_Container");window.UserList_HistoryUserSelector!=null&&window.UserList_HistoryUserSelector.length==0&&jq(".historyViewUserSelectorCont").hide()};return{historyCKEditor:null,CallbackMethods:{get_events_by_filter:function(n,t){var i,r;for(typeof n.__nextIndex=="undefined"&&(ASC.CRM.HistoryView.ShowMore=!1),n.startIndex===0&&(ASC.CRM.HistoryView.EventsList=[]),i=0,r=t.length;i<r;i++)ASC.CRM.HistoryView.eventItemFactory(t[i]),ASC.CRM.HistoryView.EventsList.push(t[i]);if(n.startIndex===0){if(jq("#eventsTable tbody tr").remove(),t.length==0)return typeof ASC.CRM.HistoryView.advansedFilter=="undefined"||ASC.CRM.HistoryView.advansedFilter.advansedFilter().length==1?(jq("#eventsList").hide(),jq("#eventsFilterContainer").hide(),jq("#emptyContentForEventsFilter:not(.display-none)").addClass("display-none"),ASC.CRM.HistoryView.ShowMore=!1,LoadingBanner.hideLoading(),!1):(jq("#eventsList").hide(),jq("#eventsFilterContainer").show(),jq("#emptyContentForEventsFilter.display-none").removeClass("display-none"),LoadingBanner.hideLoading(),!1);jq.tmpl("historyRowTmpl",t).appendTo("#eventsTable tbody");jq("#emptyContentForEventsFilter:not(.display-none)").addClass("display-none");jq("#eventsFilterContainer").show();jq("#eventsList").show();ASC.CRM.HistoryView.resizeFilter();LoadingBanner.hideLoading()}else{if(t.length==0&&jq("#eventsTable tbody tr").length==0)return jq("#eventsList").hide(),jq("#eventsFilterContainer").show(),jq("#emptyContentForEventsFilter.display-none)").removeClass("display-none"),LoadingBanner.hideLoading(),!1;jq.tmpl("historyRowTmpl",t).appendTo("#eventsTable tbody")}for(i=0,r=t.length;i<r;i++)t[i].files!=null&&jq.dropdownToggle({dropdownID:"eventAttach_"+t[i].id,switcherSelector:"#eventAttachSwither_"+t[i].id,addTop:5,rightPos:!0});jq("#showMoreEventsButtons .loading-link").hide();ASC.CRM.HistoryView.ShowMore?jq("#showMoreEventsButtons .crm-showMoreLink").show():jq("#showMoreEventsButtons .crm-showMoreLink").hide()},add_event:function(n,t){ASC.CRM.HistoryView.eventItemFactory(t);ASC.CRM.HistoryView.historyCKEditor?(ASC.CRM.HistoryView.historyCKEditor.setData(""),ASC.CRM.HistoryView.historyCKEditor.focus()):(jq("#historyBlock textarea").val(""),jq("#historyBlock textarea").trigger("focus"));jq("#contactSwitcherSelect").val(-2).trigger("change");jq("#typeSwitcherSelect").val(-2).trigger("change");ASC.CRM.HistoryView.changeType(-1,"");ASC.CRM.HistoryView.changeContact(-1);jq("#usrSrListViewAdvUsrSrContainer_HistoryUserSelector .addUserLink").useradvancedSelector("undisable",window.SelectedUsers_HistoryUserSelector.IDs);window.SelectedUsers_HistoryUserSelector.IDs.clear();window.SelectedUsers_HistoryUserSelector.Names.clear();jq("#selectedUsers_HistoryUserSelector div").remove();n.fromAttachmentsControl||(ASC.CRM.FileUploader.reinit(),ASC.CRM.HistoryView.showAttachmentPanel(!1));jq("#eventsTable tbody tr").length==0&&(jq("#emptyContentForEventsFilter:not(.display-none)").addClass("display-none"),jq("#eventsFilterContainer").show(),jq("#eventsList").show(),ASC.CRM.HistoryView.resizeFilter());jq.tmpl("historyRowTmpl",t).prependTo("#eventsTable tbody");t.files!=null&&jq.dropdownToggle({dropdownID:"eventAttach_"+t.id,switcherSelector:"#eventAttachSwither_"+t.id,addTop:5,rightPos:!0});ASC.CRM.HistoryView.EventsList.unshift(t);t.files!=null&&typeof Attachments!="undefined"&&window.Attachments.appendFilesToLayout(t.files)},delete_event:function(n,i){jq("#eventAttach_"+i.id).find("[id^=fileContent_]").each(function(){var n=jq(this).attr("id").split("_")[1];typeof Attachments!="undefined"&&window.Attachments.deleteFileFromLayout(n)});l(i.id);jq("#event_"+i.id).animate({opacity:"hide"},500);setTimeout(function(){jq("#event_"+i.id).remove();jq("#eventsTable tr").length==0&&(typeof ASC.CRM.HistoryView.advansedFilter!="undefined"&&ASC.CRM.HistoryView.advansedFilter.advansedFilter().length==1?(jq("#eventsFilterContainer").hide(),jq("#eventsList").hide()):t())},500)},delete_file_from_event:function(n,t){typeof Attachments!="undefined"&&window.Attachments.deleteFileFromLayout(t.id);ASC.CRM.HistoryView.deleteFileFromEventLayout(t.id,n.messageID)}},init:function(n,t,i){ASC.CRM.HistoryView.ContactID=n;ASC.CRM.HistoryView.EntityID=i;ASC.CRM.HistoryView.EntityType=t;ASC.CRM.HistoryView.CountOfRows=ASC.CRM.Data.DefaultEntryCountOnPage;ASC.CRM.HistoryView.EventsList=[];ASC.CRM.HistoryView.ShowMore=!0;ASC.CRM.HistoryView.isFilterVisible=!1;ASC.CRM.HistoryView.isTabActive=!1;ASC.CRM.HistoryView.isFirstTime=!0;s();v();jq("#showMoreEventsButtons .crm-showMoreLink").on("click",function(){f()});jq("#DepsAndUsersContainer").css("z-index",999);jq("#historyBlock input.textEditCalendar").mask(ASC.Resources.Master.DatePatternJQ);jq("#historyBlock input.textEditCalendar").datepickerWithButton().datepicker("setDate",window.historyView_dateTimeNowShortDateString);jq("#historyBlock table #selectedUsers").remove();h();c();setInterval(function(){jq("#historyBlock").is(":visible")&&ASC.CRM.HistoryView.activate()},100);setInterval(function(){var u=jq("#historyBlock .middle-button-container a.button.blue.middle"),t=jq("#historyBlock input.textEditCalendar"),i=jq("#historyBlock .lond-data-text"),n=!0,r=(ASC.CRM.HistoryView.historyCKEditor?ASC.CRM.HistoryView.historyCKEditor.getData():jq("#historyCKEditor").val()).trim();r.length?r.length>ASC.CRM.Data.MaxHistoryEventCharacters?(i.text(ASC.CRM.Resources.CRMCommonResource.HistoryLongDataMsg.format(r.length-ASC.CRM.Data.MaxHistoryEventCharacters)).removeClass("display-none"),n=!1):i.text("").addClass("display-none"):(i.text("").addClass("display-none"),n=!1);jq.isDateFormat(t.val().trim())?t.css("borderColor",""):(t.css("borderColor","#CC0000"),n=!1);n?u.removeClass("disable"):u.addClass("disable")},500);a()},bindCKEditorEvents:function(){if(ASC.CRM.HistoryView.historyCKEditor)CKEDITOR.instances.historyCKEditor.on("focus",function(){jq("#historyCKEditor").trigger("click");jq(".hasDatepicker").datepicker("hide")})},setFilter:function(){t()},resetFilter:function(){t()},activate:function(){ASC.CRM.HistoryView.isTabActive==!1&&(ASC.CRM.HistoryView.isTabActive=!0,ASC.CRM.HistoryView.refreshToEntitySelectors(),t())},refreshToEntitySelectors:function(){LoadingBanner.displayLoading();ASC.CRM.HistoryView.ContactID>0?e():o()},resizeFilter:function(){if(typeof ASC.CRM.HistoryView.advansedFilter!="undefined"){var n=jq("#eventsFilterContainer").is(":hidden")==!1;ASC.CRM.HistoryView.isFilterVisible==!1&&n&&(ASC.CRM.HistoryView.isFilterVisible=!0,ASC.CRM.HistoryView.advansedFilter&&jq("#eventsAdvansedFilter").advansedFilter("resize"))}},getFilterSettings:function(){var n={},t;return ASC.CRM.HistoryView.advansedFilter.advansedFilter==null?n:(t=ASC.CRM.HistoryView.advansedFilter.advansedFilter(),jq(t).each(function(t,i){var r,u,t,f;switch(i.id){case"sorter":n.sortBy=i.params.id;n.sortOrder=i.params.dsc==!0?"descending":"ascending";break;case"text":n.filterValue=i.params.value;break;case"fromToDate":n.fromDate=new Date(i.params.from);n.toDate=new Date(i.params.to);break;default:if(i.hasOwnProperty("apiparamname")&&i.params.hasOwnProperty("value")&&i.params.value!=null)try{for(r=JSON.parse(i.apiparamname),u=JSON.parse(i.params.value),r.length!=u.length&&(n[i.apiparamname]=i.params.value),t=0,f=r.length;t<f;t++)u[t].trim().length!=0&&(n[r[t]]=u[t])}catch(e){n[i.apiparamname]=i.params.value}}}),n)},eventItemFactory:function(n){if(n.entity!=null)switch(n.entity.entityType){case"opportunity":n.entityURL="Deals.aspx?id="+n.entity.entityId;n.entityType=ASC.CRM.Resources.CRMJSResource.Deal;break;case"case":n.entityURL="Cases.aspx?id="+n.entity.entityId;n.entityType=ASC.CRM.Resources.CRMJSResource.Case;break;default:n.entityURL="";n.entityType=""}if(n.category.cssClass=n.category.imagePath.split("/")[n.category.imagePath.split("/").length-1].split(".")[0],n.category.cssClass=="32-attach"&&(n.category.cssClass="event_category_attach_file"),n.category.id==-3)try{ASC.CRM.Common.historyEventMsgObjFactory(n);n.createdDate=n.message.date_created;n.createdBy.displayName=n.message.from;n.category.cssClass=n.message.is_sended?"event_category_system_email_out":"event_category_system_email_in"}catch(t){}},deleteFile:function(n,t){Teamlab.removeCrmFile({messageID:t},n,{success:ASC.CRM.HistoryView.CallbackMethods.delete_file_from_event})},deleteFileFromEventLayout:function(n,t){jq("#fileContent_"+n).remove();jq("#eventAttach_"+t+">ul.dropdown-content>li").length==0&&jq(jq("#eventAttach_"+t).parent()).html("")},showAttachmentPanel:function(n){if(n){if(jq("#attachShowButton").hasClass("disabledLink"))return!1;jq("#attachOptions").show();jq("#attachShowButton").hide();jq("#attachHideButton").show()}else{if(jq("#attachHideButton").hasClass("disabledLink"))return!1;jq("#attachOptions").hide();jq("#attachHideButton").hide();jq("#attachShowButton").show()}},addEvent:function(t){var i,r;n||jq(t).hasClass("disable")||(i=jq("#historyBlock textarea").val(),ASC.CRM.HistoryView.historyCKEditor&&(i=ASC.CRM.HistoryView.historyCKEditor.getData()),i=i.trim(),!i.length||i.length>ASC.CRM.Data.MaxHistoryEventCharacters)||(ASC.CRM.FileUploader.getUploadFileCount()>0?ASC.CRM.FileUploader.start():(r=u(),Teamlab.addCrmHistoryEvent({},r,{success:ASC.CRM.HistoryView.CallbackMethods.add_event,before:function(){n=!0;LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.AddThisNoteProggress;LoadingBanner.showLoaderBtn("#historyBlock");jq("#historyBlock textarea, #historyBlock input, #historyBlock select").prop("disabled",!0)},after:function(){n=!1;LoadingBanner.hideLoaderBtn("#historyBlock");jq("#historyBlock .middle-button-container a.button.blue.middle").addClass("disable");jq("#historyBlock textarea, #historyBlock input, #historyBlock select").prop("disabled",!1)}})))},deleteEvent:function(n){Teamlab.removeCrmHistoryEvent({},n,{success:ASC.CRM.HistoryView.CallbackMethods.delete_event,before:function(){jq("#eventTrashImg_"+n).hide();jq("#eventLoaderImg_"+n).show()},after:function(){jq("#eventLoaderImg_"+n).hide();jq("#eventTrashImg_"+n).show()}})},changeType:function(n,t){jq("#typeID").val(t);jq("#itemID").val(-1);switch(n){case 1:jq("#casesSwitcherSelect").tlcombobox("hide");jq("#casesSwitcherSelect").val(-2).trigger("change");jq("#dealsSwitcherSelect").tlcombobox("show");jq("#typeSwitcherSelect>option[value='-1'].hidden").removeClass("hidden");jq("#typeSwitcherSelect").tlCombobox();break;case 7:jq("#dealsSwitcherSelect").tlcombobox("hide");jq("#dealsSwitcherSelect").val(-2).trigger("change");jq("#casesSwitcherSelect").tlcombobox("show");jq("#typeSwitcherSelect>option[value='-1'].hidden").removeClass("hidden");jq("#typeSwitcherSelect").tlCombobox();break;default:jq("#dealsSwitcherSelect").tlcombobox("hide");jq("#casesSwitcherSelect").tlcombobox("hide");jq("#dealsSwitcherSelect").val(-2).trigger("change");jq("#casesSwitcherSelect").val(-2).trigger("change");jq("#typeSwitcherSelect>option[value='-1']:not(.hidden)").addClass("hidden");jq("#typeSwitcherSelect").tlCombobox()}},changeContact:function(n){jq("#contactID").val(n);n>0?(jq("#contactSwitcherSelect>option[value='-1'].hidden").removeClass("hidden"),jq("#contactSwitcherSelect").tlCombobox()):(jq("#contactSwitcherSelect>option[value='-1']:not(.hidden)").addClass("hidden"),jq("#contactSwitcherSelect").tlCombobox())},appendOption:function(n,t){var f,i,u,r;if(n=="contact"||n=="case"||n=="opportunity")return f=1,i=jq("#contactSwitcherSelect"),n=="case"?i=jq("#casesSwitcherSelect"):n=="opportunity"&&(i=jq("#dealsSwitcherSelect"),u=jq("#typeSwitcherSelect>option[value='"+f+"'].hidden"),u.length==1&&(u.removeClass("hidden"),jq("#typeSwitcherSelect").tlCombobox())),r=i.parents("span.tl-combobox:first"),r=r.length>0?r:i,r.parent().removeClass("empty-select"),jq(document.createElement("option")).attr("value",t.value).text(t.title).appendTo(i),i.tlCombobox(),i},removeOption:function(n,t){var i,r;if(n=="contact"||n=="case"||n=="opportunity"){i=jq("#contactSwitcherSelect");n=="case"?i=jq("#casesSwitcherSelect"):n=="opportunity"&&(i=jq("#dealsSwitcherSelect"));i.find('option[value="'+t+'"]').remove();i.tlCombobox();for(var t=-1,f=i.find("option"),u=f.length;u--;)if(t=jq(f[u]).attr("value"),t=isFinite(+t)?+t:-1,t>0)break;return u===-1&&(r=i.parents("span.tl-combobox:first"),r=r.length>0?r:i,r.parent().addClass("empty-select")),i}}}}();ASC.CRM.HistoryMailView=function(){var i=function(t){var i=jq('<iframe id="message_body_frame_'+t.id+'" scrolling="auto" frameborder="0" width="100%" style="height:100%;">An iframe capable browser is required to view this web site.<\/iframe>');i.on("load",function(){var r,f,u,e,o,s;if(i.off("load"),r=jq(this).contents().find("body"),r.css("cssText","height: 0;"),t.html_body='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">'+t.html_body,r.html(t.html_body),r.find("a").attr("target","_blank"),f=jq(r.find("div.gmail_quote:first")[0]||r.find("blockquote:first")[0]),f&&(f.wrap('<div class="tmmail_quote"/>'),u=r.find("div.tmmail_quote:first"),u&&(u.before('<style>#controll-blockquote {width: 12px; display: inline-block; background-color: #F2F2F2; border: 1px solid #D7D8DC; cursor: pointer; padding: 0 5px; margin: 10px 0;}#controll-blockquote:hover {background-color: #D7D8DC; border: 1px solid #666;}#controll-blockquote div {margin-top: -8px; font-weight: bold; color: #D7D8DC; -moz-user-select: none; -webkit-user-select: none; -ms-user-select: none;}#controll-blockquote:hover div {color: #666;}<\/style><div id="controll-blockquote"><div>...<\/div><\/div>'),u.hide(),e=r.find("#controll-blockquote"),e)))e.on("click",function(){u.toggle();var i=jq("#message_body_frame_"+t.id);i.attr("scrolling","no");setTimeout(function(){i.attr("scrolling","auto");n(t.id,!0)},1)});o=r.find("img").length;o>0?(s=setTimeout(function(){n(t.id)},50),r.find("img").each(function(){jq(this).on("load",function(){--o==0&&(clearTimeout(s),n(t.id,!0))})})):n(t.id,!0)});return i},r=function(n){var r=null,t,i;return document.createRange&&(t=document.createRange(),t.selectNodeContents(n),t.getBoundingClientRect&&(i=t.getBoundingClientRect(),i&&(r=i))),r},n=function(n,t){var l={element:1,text:3},e=jq("#message_body_frame_"+n),o=e.contents().find("body"),h,i,c,s,a,f,u;if(o.css("cssText","height: 0; max-width: "+e.width()+"px !important;"),h=o.contents(),i=0,window.ActiveXObject||window.sidebar){for(s=0,a=h.length;s<a;s++)f=0,u=h[s],u.nodeType==l.element?f=jq(u).offset().top+Math.max(u.scrollHeight,u.clientHeight,jq(u).outerHeight(!0)):u.nodeType==l.text&&(c=r(u),f=c==null?0:c.bottom+1),i<f&&(i=f);i+=o.offset().top}else i=e.contents().outerHeight(!0),!0==t&&(i+=o.offset().top);!0==t&&(i+=20);e.css("height",i+"px")},t=function(n){jq("#mailHistoryEventContainer .messageHeader").html(jq.tmpl("historyMailTemplate",n.message));var t=i(n.message);jq("#mailHistoryEventContainer .messageContent").html("").append(t)};return{init:function(n){if(n!=""&&n!=null){try{n=JSON.parse(jq.base64.decode(n));ASC.CRM.Common.historyEventMsgObjFactory(n)}catch(i){console.log(i);return}try{n.message.hasOwnProperty("html_body")?t(n):jq.ajax({type:"GET",url:n.message.message_url,success:function(i){try{n.message.html_body=i;t(n)}catch(r){}}})}catch(i){}}}}}();ASC.CRM.ContactSelector=new function(){var t=function(){jq("body>ul.ui-autocomplete").hide()},n=function(n,t,i,r){var f=[],u,o,e,s;if(r!=null&&r.length!=0)for(u=0,o=r.length;u<o;u++)jq.inArray(r[u].id,i.SelectedContacts)===-1&&(typeof i.ExcludedArrayIDs=="undefined"||jq.inArray(r[u].id,i.ExcludedArrayIDs)===-1)&&f.push(r[u]);return(f==[]||f==null||f==0)&&(e=jq(n).children("tbody").children("tr"),s=e.width()-(e.children("td").length-3)*18-2,jq("#noMatches_"+t).css("width",s+"px"),jq("#noMatches_"+t).show()),f},i=function(t,i,r,u){t.length!=0&&(t.autocomplete({minLength:0,delay:300,focus:function(n){n.preventDefault?n.preventDefault():n.returnValue=!1;var f=jq(this).data("ui-autocomplete"),t=f.menu,r=t.element.scrollTop(),i=t.active.offset().top-t.element.offset().top,u=t.element.height();i<0?t.element.scrollTop(r+i):i+t.active.height()>u&&t.element.scrollTop(r+i-u+t.active.height())},select:function(n,t){return typeof u.SelectItemEvent=="undefined"?(u.setContact(this,t.item.id,t.item.displayName,t.item.smallFotoUrl),u.showInfoContent(this),!1):(u.SelectItemEvent(t.item,{input:this,newContact:!1}),jq(this).val(""),!1)},selectFirst:!1,search:function(){return jq(i).is(":visible")?!0:!1},source:function(t,f){var s,h,e,c,o,l;if(u.IsInPopup&&(s=this.menu.element,h=jq(i).parents(".blockUI.blockPage:first"),h.length!=0&&(h.css("position")=="fixed"?(s.css("position","fixed"),jq("#noMatches_"+r).css("position","fixed")):(s.css("position","absolute"),jq("#noMatches_"+r).css("position","absolute")))),e=t.term,e in u.Cache){o=u.Cache[e];f(n(i,r,u,o));return}for(c in u.Cache)if(u.Cache[c].length==0&&e.indexOf(c)==0){o=[];f(n(i,r,u,o));return}l={prefix:e,searchType:u.SelectorType,entityType:u.EntityType,entityID:u.EntityID};Teamlab.getCrmContactsByPrefix({},{filter:l,success:function(t,o){jq("#loaderImg_"+r).hide();jq("#searchImg_"+r).show();u.Cache[e]=o;f(n(i,r,u,o))},before:function(){jq("#searchImg_"+r).hide();jq("#loaderImg_"+r).show()}})}}),t.data("ui-autocomplete")._renderMenu=function(n,t){var f=this,r;jq.each(t,function(t,i){f._renderItemData(n,i)});u.IsInPopup&&jq.browser.mobile&&n.parents(".blockUI.blockPage:first").length==0&&(r=jq(i).parents(".blockUI.blockPage:first"),r.length!=0&&n.appendTo(r.children()))},t.data("ui-autocomplete")._renderItem=function(n,t){if((jq("#noMatches_"+r).hide(),jq.inArray(t.id,u.SelectedContacts)==-1)&&(typeof u.ExcludedArrayIDs=="undefined"||jq.inArray(t.id,u.ExcludedArrayIDs)==-1)){var i=t.company!=null?jq.format("<br/><span class='text-medium-describe'>{0}: {1}<\/span>",ASC.CRM.Resources.CRMJSResource.Company,t.company.displayName):"";return jq("<li><\/li>").data("item.autocomplete",t).append(jq("<a href='javascript:void(0)'><\/a>").html(jq.htmlEncodeLight(t.displayName)+i)).appendTo(n)}},t.data("ui-autocomplete")._resizeMenu=function(){var t=this.menu.element,n=jq(i).children("tbody").children("tr"),r=n.width()-(n.children("td").length-3)*18;t.outerWidth(Math.max(r,this.element.outerWidth()))},t.data("ui-autocomplete")._suggest=function(n){var t=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(t,n);this.menu.refresh();t.show();this._resizeMenu();t.position(jq.extend({"of":jq(this.element).parents("table:first")},this.options.position))})},r=function(n,t){var r=jq("div[id^='noMatches_"+t+"']"),i={};jq(n).on("click",function(){r.hide();jq(this).autocomplete("search",jq(n).val().trim())});jq(document).on("click",function(n){for(var f,t=0,u=r.length;t<u;t++)i=jq(r[t]),i.is(":visible")&&(f=jq(n.target?n.target:n.srcElement),f.parents().addBack().is("#"+i.attr("id").replace("noMatches_","contactTitle_")+", #"+i.attr("id"))||i.hide())})},u=function(n){jq(n).on("keyup",function(){jq(this).val().trim()==""?jq(this).parents("table:first").find("label.crossButton").hide():jq(this).parents("table:first").find("label.crossButton").show()})};this.ContactSelector=function(n,f){var e,o,s;if(typeof f=="object"){if(typeof window[n]!="undefined")return window[n];if(this.ObjName=n,this.SelectorType=-1,this.ShowOnlySelectorContent=!1,this.SelectedContacts=[],this.ExcludedArrayIDs=[],this.EntityType=-1,this.EntityID=0,this.DescriptionText="",this.DeleteContactText="",this.AddContactText="",this.CrossButtonEventClick,this.SelectItemEvent,this.IsInPopup=!1,this.AcceptNewContactShowOnly=!1,this.ShowChangeButton=!0,this.ShowAddButton=!0,this.ShowDeleteButton=!0,this.ShowContactImg=!0,this.ShowNewCompanyContent=!0,this.ShowNewContactContent=!0,this.HTMLParent="",e=this,f.hasOwnProperty("SelectorType")&&(this.SelectorType=f.SelectorType),f.hasOwnProperty("EntityType")&&(this.EntityType=f.EntityType),this.EntityID=f.EntityID||0,f.hasOwnProperty("ShowOnlySelectorContent")&&(this.ShowOnlySelectorContent=f.ShowOnlySelectorContent),this.DescriptionText=f.DescriptionText||"",this.DeleteContactText=f.DeleteContactText||"",this.AddContactText=f.AddContactText||"",f.hasOwnProperty("IsInPopup")&&(this.IsInPopup=f.IsInPopup),f.hasOwnProperty("AcceptNewContactShowOnly")&&(this.AcceptNewContactShowOnly=f.AcceptNewContactShowOnly),f.hasOwnProperty("ShowChangeButton")&&(this.ShowChangeButton=f.ShowChangeButton),f.hasOwnProperty("ShowAddButton")&&(this.ShowAddButton=f.ShowAddButton),f.hasOwnProperty("ShowDeleteButton")&&(this.ShowDeleteButton=f.ShowDeleteButton),f.hasOwnProperty("ShowContactImg")&&(this.ShowContactImg=f.ShowContactImg),f.hasOwnProperty("ShowNewCompanyContent")&&(this.ShowNewCompanyContent=f.ShowNewCompanyContent),f.hasOwnProperty("ShowNewContactContent")&&(this.ShowNewContactContent=f.ShowNewContactContent),f.hasOwnProperty("presetSelectedContactsJson")&&f.presetSelectedContactsJson!=""&&(this.presetSelectedContacts=typeof f.presetSelectedContactsJson=="object"?f.presetSelectedContactsJson:JSON.parse(f.presetSelectedContactsJson),this.presetSelectedContacts!=null))for(o=0,s=this.presetSelectedContacts.length;o<s;o++)this.SelectedContacts.push(this.presetSelectedContacts[o].id);this.ExcludedArrayIDs=f.ExcludedArrayIDs||[];this.HTMLParent=f.HTMLParent||"";this.drawContactSelector=function(){var t,r,i;if(e.HTMLParent!=""&&jq(e.HTMLParent).length==1&&jq("#selector_"+e.ObjName).length==0&&jq.tmpl("contactSelectorContainerTmpl",e).appendTo(e.HTMLParent),e.Cache={},e.SelectedContacts.length>0&&e.ShowOnlySelectorContent===!1){if(e.presetSelectedContacts!=null)for(t=0,r=e.presetSelectedContacts.length;t<r;t++)e.AddNewSelectorWithSelectedContact(e.presetSelectedContacts[t])}else e.AddNewSelectorWithSelectedContact(null);delete e.presetSelectedContacts;i=jq("#selector_"+n).children("div:first").children("div.contactSelector-item");jq(i[i.length-1]).addClass("withPlus")};this.changeContact=function(n){var i=parseInt(jq("#contactID_"+n).val()),t=jq.inArray(i,e.SelectedContacts);t!=-1&&e.SelectedContacts.splice(t,1);jq(window).trigger("editContactInSelector",[jq("#item_"+n),this.ObjName]);jq("#contactID_"+n).val(0);e.showSelectorContent(jq("#contactTitle_"+n))};this.deleteContact=function(n){var r=parseInt(jq("#contactID_"+n).val()),i=jq.inArray(r,e.SelectedContacts),t;i!=-1&&e.SelectedContacts.splice(i,1);jq(window).trigger("deleteContactFromSelector",[jq("#item_"+n),this.ObjName]);jq("#item_"+n).remove();t=jq("#selector_"+e.ObjName).children("div:first").children("div.contactSelector-item");t.filter(".withPlus").removeClass("withPlus");jq(t[t.length-1]).addClass("withPlus")};this.clearSelector=function(){e.SelectedContacts=[];var n=jq("#selector_"+e.ObjName).children("div:first").children("div.contactSelector-item");n.length>1&&(e.ShowAddButton===!0&&jq(n[0]).addClass("withPlus"),n.filter(":not(:first)").remove())};this.crossButtonEventClick=function(n){if(jq("#selectorContent_"+n).children(".contactSelector-inputContainer").find(".crossButton").hide(),typeof e.CrossButtonEventClick=="undefined"){var i=parseInt(jq("#contactID_"+n).val()),t=jq.inArray(i,e.SelectedContacts);t!=-1&&e.SelectedContacts.splice(t,1);jq("#contactTitle_"+n).val("").trigger("blur");jq("#contactID_"+n).val(0);jq("#noMatches_"+n).hide()}else e.CrossButtonEventClick()};this.setContact=function(n,t,i,r){if(jq(n).length!=0){var u=jq(n).attr("id").replace("contactTitle_",""),f=jq("#infoContent_"+u).find("img:first");jq(n).val(i);r!=""&&f.length==1&&(r.indexOf("filehandler.ashx")!=-1?jq.ajax({type:"GET",url:r,success:function(n){try{f.attr("src",n)}catch(t){}}}):f.attr("src",r));jq("#infoContent_"+u).find("b:first").html(jq.htmlEncodeLight(i));jq("#contactID_"+u).val(t);jq.inArray(t,e.SelectedContacts)==-1&&t!=0&&e.SelectedContacts.push(t);jq(n).val("");jq(window).trigger("setContactInSelector",[t,this.ObjName])}};this.showInfoContent=function(n){var t=jq(n).attr("id").replace("contactTitle_","");jq("#selectorContent_"+t).hide();jq("#newContactContent_"+t).hide();jq("#infoContent_"+t).show()};this.showSelectorContent=function(n){var t=jq(n).attr("id").replace("contactTitle_","");jq(n).val().trim()==""?jq(n).parents("table:first").find("label.crossButton").hide():jq(n).parents("table:first").find("label.crossButton").show();jq("#infoContent_"+t).hide();jq("#newContactContent_"+t).hide();jq("#selectorContent_"+t).show();jq(window).trigger("afterResetSelectedContact",[jq("#item_"+t),this.ObjName])};this.AddNewSelector=function(n){n.hasClass("disabledLink")||(n.addClass("disabledLink"),e.AddNewSelectorWithSelectedContact(null),n.removeClass("disabledLink"))};this.AddNewSelectorWithSelectedContact=function(n){var t=0,s=jq("#selector_"+e.ObjName+" input[id^=contactTitle_]:last"),h,o,f;jq(s).length>0&&(t=parseInt(jq(s).attr("id").replace("contactTitle_"+e.ObjName+"_",""))+1);h=jq.tmpl("contactSelectorRowTmpl",{ObjID:e.ObjName+"_"+t,ObjName:e.ObjName,ShowOnlySelectorContent:e.ShowOnlySelectorContent,ShowNewCompanyContent:e.ShowNewCompanyContent,ShowNewContactContent:e.ShowNewContactContent,ShowContactImg:e.ShowContactImg,ShowDeleteButton:e.ShowDeleteButton,ShowAddButton:e.ShowAddButton,ShowChangeButton:e.ShowChangeButton,DeleteContactText:e.DeleteContactText,AddButtonText:e.AddContactText,WatermarkText:e.DescriptionText,selectedContact:n});jq("#selector_"+e.ObjName+" div:first").append(h);o=jq("#selector_"+e.ObjName).children("div:first").children("div.contactSelector-item");o.filter(".withPlus").removeClass("withPlus");jq(o[o.length-1]).addClass("withPlus");f=jq("#contactTitle_"+e.ObjName+"_"+t);i(f,jq(f).parents("table:first"),e.ObjName+"_"+t,e);r(f,e.ObjName);u(f);n!=null&&n.smallFotoUrl.indexOf("filehandler.ashx")!=-1&&jq.ajax({type:"GET",url:n.smallFotoUrl,success:function(n){try{jq("#infoContent_"+e.ObjName+"_"+t).find("img:first").attr("src",n)}catch(i){}}})};this.quickSearch=function(n){t();var i=jq("#contactTitle_"+n);i.autocomplete("search",i.val().trim())};this.showNewCompany=function(n){var t=this,i;jq("#newContactContent_"+n+" input").val("");jq("#hiddenIsCompany_"+n).val("true");jq("#noMatches_"+n).hide();jq("#infoContent_"+n).hide();jq("#selectorContent_"+n).hide();jq("#newContactImg_"+n).hide();jq("#newContactFirstName_"+n).hide();jq("#newContactLastName_"+n).hide();jq("#newContactContent_"+n).show();jq("#newCompanyImg_"+n).show();jq("#newCompanyTitle_"+n).off("keyup").on("keyup",function(i){var r;i.keyCode?r=i.keyCode:i.which&&(r=i.which);r==13&&t.acceptNewContact(n);r==27&&t.rejectNewContact(n)});i=jq("#contactTitle_"+n);jq("#newCompanyTitle_"+n).val(i.val()).show().trigger("focus")};this.showNewContact=function(n){var t=this,i;jq("#newContactContent_"+n+" input").val("");jq("#hiddenIsCompany_"+n).val("false");jq("#noMatches_"+n).hide();jq("#infoContent_"+n).hide();jq("#selectorContent_"+n).hide();jq("#newCompanyImg_"+n).hide();jq("#newCompanyTitle_"+n).hide();jq("#newContactContent_"+n).show();jq("#newContactImg_"+n).show();jq("#newContactFirstName_"+n+", #newContactLastName_"+n).off("keyup").on("keyup",function(i){var r;i.keyCode?r=i.keyCode:i.which&&(r=i.which);r==13&&t.acceptNewContact(n);r==27&&t.rejectNewContact(n)});i=jq("#contactTitle_"+n);jq("#newContactLastName_"+n).show();jq("#newContactFirstName_"+n).val(i.val()).show().trigger("focus")};this.acceptNewContact=function(n){var r={},u=jq("#hiddenIsCompany_"+n).val()=="true",o=jq("#newCompanyTitle_"+n),s=jq("#newContactFirstName_"+n),h=jq("#newContactLastName_"+n),c=o.length==1?o.val().trim():"",l=s.length==1?s.val().trim():"",p=h.length==1?h.val().trim():"",t=this,i=jq("#contactTitle_"+n),f,y;if(u?r.companyName=c:(r.firstName=l,r.lastName=p),r.managerList=new Array(Teamlab.profile.id),r.shareType=0,f=!0,u&&c==""?(jq("#newCompanyTitle_"+n).addClass("requiredInputError"),f=!1):jq("#newCompanyTitle_"+n).removeClass("requiredInputError"),u||l!=""?jq("#newContactFirstName_"+n).removeClass("requiredInputError"):(jq("#newContactFirstName_"+n).addClass("requiredInputError"),f=!1),!f)return!1;if(t.AcceptNewContactShowOnly){var e=u?jq("#newCompanyImg_"+n).attr("src"):jq("#newContactImg_"+n).attr("src"),a=[r.firstName," ",r.lastName].join(""),v=0;typeof t.SelectItemEvent=="undefined"?(jq("#infoContent_"+n).show(),jq("#selectorContent_"+n).hide(),t.setContact(i,v,a,e),t.showInfoContent(i),jq("#infoContent_"+n+" img:first").attr("src",e)):(y={id:v,displayName:a,smallFotoUrl:e},t.showSelectorContent(i),i.val(""),t.SelectItemEvent(y,{input:i,newContact:!0,data:r}))}else Teamlab.addCrmContact({},u,r,{before:function(){jq("#newContactContent_"+n).hide()},success:function(r,f){var e,o;typeof t.SelectItemEvent=="undefined"?(jq("#infoContent_"+n).show(),jq("#selectorContent_"+n).hide(),t.setContact(i,f.id,f.displayName,f.smallFotoUrl),t.showInfoContent(i),e=u?jq("#newCompanyImg_"+n).attr("src"):jq("#newContactImg_"+n).attr("src"),jq("#infoContent_"+n+" img:first").attr("src",e)):(o={id:f.id,displayName:f.displayName,smallFotoUrl:f.smallFotoUrl},i.val(""),t.showSelectorContent(i),t.SelectItemEvent(o,{input:i,newContact:!0}))}})};this.rejectNewContact=function(n){jq("#infoContent_"+n).hide();jq("#selectorContent_"+n).show();jq("#newContactContent_"+n).hide();jq("#noMatches_"+n).show();jq("#newContactContent_"+n+" input").removeClass("requiredInputError")};jq(document).ready(function(){e.drawContactSelector();jq(window).trigger("contactSelectorIsReady",[n])})}}};ASC.CRM.UpdateCRMCaldavCalendar=function(n,t,i){var r={calendarId:"crm_calendar",uid:"crm_"+n.type+"_"+n.id,responsibles:[n.responsible.id]},u=ASC.Resources.Master.ApiPath+"calendar/caldavevent.json";switch(t){case 0:case 1:r.alert=n.alertValue||0;jq.ajax({type:"put",url:u,data:r,complete:function(){}});n.responsible.id!==i&&i!==undefined&&jq.ajax({type:"delete",url:u,data:{calendarId:"crm_calendar",uid:"crm_"+n.type+"_"+n.id,responsibles:[i]},complete:function(){}});break;case 2:jq.ajax({type:"delete",url:u,data:r,complete:function(){}})}};ASC.CRM.CategorySelector=function(n,t){this.ObjName=n;this.Me=function(){return jq("#"+this.ObjName)};this.CategoryTitle=t.title;this.CategoryID=t.id;jq.browser.mobile===!1&&(jq.dropdownToggle({dropdownID:this.ObjName+"_categoriesContainer",switcherSelector:["#",this.ObjName,"_selectorContainer"].join(""),simpleToggle:!0}),ASC.CRM.Common.registerChangeHoverStateByParent("label.event_category",["#",this.ObjName,"_categoriesContainer .categorySelector-category"].join("")));this.changeContact=function(n){var t,i;jq.browser.mobile?(t=parseInt(jq(n).val()),i=jq(n).text(),this.setContact(t,i)):(t=parseInt(jq(n).attr("id").split("_")[2]),i=jq("div",jq(n)).text(),this.setContact(t,i),this.hideSelectorContent())};this.setContact=function(n,t){this.CategoryID=n;this.CategoryTitle=t;jq.browser.mobile?jq("option[id="+this.ObjName+"_category_"+n+"]",this.Me()).prop("selected",!0):(jq("input[id="+this.ObjName+"_categoryID]",this.Me()).val(n),jq("input[id="+this.ObjName+"_categoryTitle]",this.Me()).val(t))};this.hideSelectorContent=function(){jq("div[id="+this.ObjName+"_categoriesContainer]",this.Me()).hide()};this.showSelectorContent=function(){jq("div[id="+this.ObjName+"_categoriesContainer]",this.Me()).toggle()};this.getRowByContactID=function(n){return n>0?jq.browser.mobile===!0?jq("option[id="+this.ObjName+"_category_"+n+"]",this.Me()):jq("div[id="+this.ObjName+"_category_"+n+"]",this.Me()):jq.browser.mobile===!0?jq("option[id^="+this.ObjName+"_category_]:first",this.Me()):jq("div[id^="+this.ObjName+"_category_]:first",this.Me())};this.renderControl=function(n,t,i,r,u){(typeof r=="undefined"||r==0)&&(r=230);typeof u!="undefined"&&u!=""&&(r-=20);jq.tmpl("categorySelectorTemplate",{jsObjName:this.ObjName,helpInfoText:u,maxWidth:r,categories:n,selectedCategory:t}).appendTo(i)}};ASC.CRM.TagView=function(){var n=function(n,t){Teamlab.addCrmTag(n,ASC.CRM.TagView.EntityType,ASC.CRM.TagView.EntityID,t,{success:ASC.CRM.TagView.callback_add_tag,before:function(){jq("#tagContainer .adding_tag_loading").show();jq("#addTagDialog").hide()},after:function(){jq("#tagContainer .adding_tag_loading").hide()}})},t=function(t,i){i!=null&&i!=""&&(ASC.CRM.TagView.EntityID==0||ASC.CRM.TagView.OnlyInterface?t.hasOwnProperty("element")||ASC.CRM.TagView.OnlyInterface?(ASC.CRM.TagView.callback_add_tag(t,Teamlab.create("crm-tag",null,i)),jq("#addTagDialog").hide()):Teamlab.addCrmEntityTag(t,ASC.CRM.TagView.EntityType,i,{success:ASC.CRM.TagView.callback_add_tag,before:function(){jq("#tagContainer .adding_tag_loading").show();jq("#addTagDialog").hide()},after:function(){jq("#tagContainer .adding_tag_loading").hide()}}):n(t,i))},i=function(n){var t=jQuery.base64.decode(n.children(".tag_title:first").attr("data-value"));ASC.CRM.TagView.EntityID==0||ASC.CRM.TagView.OnlyInterface?ASC.CRM.TagView.callback_delete_tag({element:n},Teamlab.create("crm-tag",null,t)):Teamlab.removeCrmTag({element:n},ASC.CRM.TagView.EntityType,ASC.CRM.TagView.EntityID,t,{success:ASC.CRM.TagView.callback_delete_tag})};return{init:function(n,t,i){ASC.CRM.TagView.EntityType=n;ASC.CRM.TagView.OnlyInterface=t;typeof i!="undefined"&&i.hasOwnProperty("addTag")&&typeof i.addTag=="function"&&(ASC.CRM.TagView.addTagExtension=i.addTag);typeof i!="undefined"&&i.hasOwnProperty("deleteTag")&&typeof i.deleteTag=="function"&&(ASC.CRM.TagView.deleteTag=i.deleteTag);var r=jq.getURLParam("id");if(!isNaN(r)){ASC.CRM.TagView.EntityID=r*1;jq("#addTagDialog a.dropdown-item").length==0&&jq("#addTagDialog .h_line").hide();jq.dropdownToggle({dropdownID:"addTagDialog",switcherSelector:"#addNewTag",addTop:1,addLeft:0,simpleToggle:typeof i!="undefined"&&i.hasOwnProperty("simpleToggle")?i.simpleToggle:!0});jq("#addThisTag").on("click",function(){ASC.CRM.TagView.addTagExtension({},jq("#addTagDialog input:first").val().trim())});jq("#addTagDialog input").trigger("focus").off("keyup").on("keyup",function(n){var t,i;if(n||(n=event),n.keyCode?t=n.keyCode:n.which&&(t=n.which),t==13){if(i=jq("#addTagDialog input:first").val().trim(),i=="")return;ASC.CRM.TagView.addTagExtension({},i)}});if(jq.browser.mobile===!0)jq("#tagContainer").on("click",".tag_item",function(){jq(this).addClass("tag_hover")})}},deleteTag:function(n){i(n)},addTagExtension:function(n,i){t(n,i)},addExistingTag:function(n){var t=jQuery.base64.decode(jq(n).attr("data-value"));ASC.CRM.TagView.addTagExtension({element:n},t)},callback_add_tag:function(n,t){jq.tmpl("taqTmpl",{tagLabel:t}).appendTo("#tagContainer>div:first");jq("#addTagDialog input:first").val("");n.hasOwnProperty("element")&&(jq(n.element).remove(),jq("#addTagDialog a.dropdown-item").length==0&&jq("#addTagDialog .h_line").hide());jq(window).trigger("addTagComplete",t)},callback_delete_tag:function(n,t){n.element.remove();jq("#addTagDialog .h_line").show();jq.tmpl("tagInAllTagsTmpl",{tagLabel:t}).appendTo("#addTagDialog ul.dropdown-content");jq(window).trigger("deleteTagComplete",t)},prepareTagDataForSubmitForm:function(n){var t={};t.tagListInfo=[];jq("#tagContainer .tag_item .tag_title").each(function(){var n=jq(this).text().trim();n&&t.tagListInfo.push(n)});t.tagListInfo.length>0?n.val(jq.toJSON(t)):n.val()}}}();ASC.CRM.ImportFromCSVView=function(){var n=function(){ASC.CRM.Common.removeExportButtons();jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})})};return{init:function(t,i){if(jq("#delimiterCharacterSelect,#encodingSelect, #quoteCharacterSelect").tlcombobox({align:"left"}),n(),t!=3&&(jq.tmpl("tagViewTmpl",{tags:[],availableTags:ASC.CRM.Data.tagList,containerClass:"initial"}).appendTo("#importFromCSVTags"),ASC.CRM.TagView.init(i,!0,{simpleToggle:!1})),t==0){ASC.CRM.UserSelectorListView.Init("_ImportContactsManager","UserSelectorListView_ImportContactsManager",!1,ASC.CRM.Resources.CRMContactResource.NotifyContactManager,new Array(ASC.CRM.Resources.CurrentUser),null,new Array(Teamlab.profile.id),"#importContactsManager",!1);var r=jq.tmpl("makePublicPanelTemplate",{Title:ASC.CRM.Resources.CRMContactResource.MakePublicPanelTitleForImportContacts,Description:ASC.CRM.Resources.CRMContactResource.MakePublicPanelDescrForContact,IsPublicItem:!1,CheckBoxLabel:ASC.CRM.Resources.CRMContactResource.MakePublicPanelCheckBoxLabelForImportContacts});r.find(".makePublicPanelSelector").append(jq("<option value='2'><\/option>").text(ASC.CRM.Resources.CRMCommonResource.AccessRightsForReading)).append(jq("<option value='1'><\/option>").text(ASC.CRM.Resources.CRMCommonResource.AccessRightsForReadWriting)).val("2").tlCombobox({align:"left"});r.appendTo("#makePublicPanel")}Teamlab.getStatusCrmImportFromCSV({},{entityType:i},{max_request_attempts:1,success:function(n,r){r==null||jQuery.isEmptyObject(r)||r.isCompleted?ASC.CRM.ImportEntities.init(t,i):(jq("#importFromCSVSteps").hide(),jq("#importStartedFinalMessage").show(),ASC.CRM.ImportEntities.checkImportStatus(!0,i))},error:function(n,t){var i=t[0];i!=null&&toastr.error(i)}})}}}();ASC.CRM.ImportEntities=function(){var i="",u=0,f,n,e,o={},r={},s=function(n){var t=JSON.parse(n),i=t.data,r=0;jq("#columnMapping tbody tr td").each(function(n){(n+1)%3==0&&jq(this).text(i[r++])});t.isMaxIndex&&jq("#nextSample").hide().prev().hide()},h=function(){var n=i+""+u;if(o[n]){s(o[n]);return}Teamlab.getCrmImportFromCSVSampleRow({},{csvFileURI:i,indexRow:u,jsonSettings:jq.toJSON(r)},{before:function(){jq("#columnMapping thead tr td:last span:last").block()},after:function(){jq("#columnMapping thead tr td:last span:last").unblock()},success:function(t,i){o[n]=i;s(i)},error:function(n,i){var r=i[0];r!=null&&t(r)}})},v=function(n){jq(jq.format("#importFromCSVSteps dd:eq({0})",n-1)).hide();jq(jq.format("#importFromCSVSteps dt:eq({0})",n-1)).hide();jq(jq.format("#importFromCSVSteps dd:eq({0})",n)).show();jq(jq.format("#importFromCSVSteps dt:eq({0})",n)).show()},c=function(){return{has_header:jq("#ignoreFirstRow").is(":checked"),delimiter_character:jq("#delimiterCharacterSelect option:selected").val(),encoding:jq("#encodingSelect option:selected").val(),quote_character:jq("#quoteCharacterSelect option:selected").val()}},y=function(){r=c();this._settings.data.importSettings=jq.toJSON(r);LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.ImportFromCSVStepOneProgressLable;LoadingBanner.showLoaderBtn("#importFromCSVSteps")},l=function(n,r){var u=JSON.parse(r),f,o,e;if(!u.Success)return t(u.Error||u.Message),jq("#uploadCSVFile").removeClass("edit_button").addClass("import_button"),jq("#uploadCSVFile").text(ASC.CRM.Resources.CRMJSResource.SelectCSVFileButton),jq("#uploadCSVFile").prev().hide(),LoadingBanner.hideLoaderBtn("#importFromCSVSteps"),!1;f=JSON.parse(jQuery.base64.decode(u.Data));i=f.assignedPath;f.isMaxIndex?jq("#prevSample").parent().hide():jq("#prevSample").parent().show();o=jq("#columnMapping tbody");o.html("");jq.tmpl("columnMappingTemplate",f,{renderSelector:function(n){var t=jq("#columnSelectorBase").clone();return t.attr("id",jq.format("columnSelector_{0}",n)),t.show(),jq("<div>").append(t).html()}}).appendTo(o);e=jq("#columnMapping select");e.each(function(){var t,n,i,r,u;try{if(t=jq(this),n=t.parent().prev().text().trim(),jq.browser.msie&&(i=jq(n.match(/\(/g)).length,r=jq(n.match(/\)/g)).length,i!=r))return;u=t.find("option").filter(function(){return jq(this).text().trim().toLowerCase()==n.toLowerCase()}).first();u.prop("selected",!0)}catch(f){}});e.on("change",function(){var n=jq(this);n.find("option:first").is(":selected")?n.parents("td").addClass("missing"):n.parents("td").removeClass("missing")});e.trigger("change");v(1);LoadingBanner.hideLoaderBtn("#importFromCSVSteps")},p=function(){jq.tmpl("template-blockUIPanel",{id:"importErrorPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Error,questionText:"",innerHtmlText:'<div class="errorNote"><\/div>',OKBtn:ASC.CRM.Resources.CRMCommonResource.OK}).insertAfter("#columnMapping");jq("#importErrorPanel .button.blue").on("click",function(){jq.unblockUI()})},t=function(n){LoadingBanner.hideLoaderBtn("#importFromCSVSteps");jq("#importErrorPanel .errorNote").text(n);StudioBlockUIManager.blockUI("#importErrorPanel",500)},a=function(){jq("#importFromCSVSteps dd:first .middle-button-container a.button.blue.middle:first").addClass("disable");jq("#uploadCSVFile").removeClass("edit_button").addClass("import_button").text(ASC.CRM.Resources.CRMJSResource.SelectCSVFileButton).prev().hide();ASC.CRM.ImportEntities.prevStep(0)};return{init:function(r,u){n=r;e=u;n==0||r=="0"?jq("#removingDuplicatesBehaviorPanel").show():jq("#removingDuplicatesBehaviorPanel").hide();jq.tmpl("columnSelectorTemplate",ASC.CRM.Data.columnSelectorData).appendTo("#columnSelectorBase");jq("#columnSelectorBase").find("option[name=is_header]").each(function(){var n=jq(this);n.nextUntil("option[name=is_header]").wrapAll(jq("<optgroup>").attr("label",n.val()));n.remove()});f=new AjaxUpload("uploadCSVFile",{action:"ajaxupload.ashx?type=ASC.Web.CRM.Classes.ImportFileHandler,ASC.Web.CRM",autoSubmit:!1,onChange:function(n,r){if(i="",!n)return a(),!1;if(!r||r[0].toLowerCase()!="csv")return t(ASC.CRM.Resources.CRMJSResource.ErrorMessage_NotSupportedFileFormat),a(),!1;var u=jq("#uploadCSVFile").prev();return u.show(),u.text(jq.format(ASC.CRM.Resources.CRMJSResource.SelectedCSVFileLabel,n)),jq("#uploadCSVFile").removeClass("import_button").addClass("edit_button").text(ASC.CRM.Resources.CRMJSResource.Change),jq("#importFromCSVSteps dd:first .middle-button-container a.button.blue.middle:first").removeClass("disable"),!0},onSubmit:y,onComplete:l});p()},prevStep:function(n){jq(jq.format("#importFromCSVSteps dd:eq({0})",n+1)).hide();jq(jq.format("#importFromCSVSteps dt:eq({0})",n+1)).hide();jq(jq.format("#importFromCSVSteps dd:eq({0})",n)).show();jq(jq.format("#importFromCSVSteps dt:eq({0})",n)).show();n!=0},getColumnMapping:function(){var n={};return jq("#columnMapping select").each(function(){var t=jq(this).find("option:selected").attr("name").trim(),i;if(t==""||t==-1||(typeof n[t]=="undefined"&&(n[t]=[]),i=this.id.split("_"),i.length<2))return!0;n[t].push(i[1])}),n},startImport:function(){var c,w,b,a,l,f,v,y,u,s;jq("select[id^=columnSelector].requiredInputError").removeClass("requiredInputError");var h=ASC.CRM.ImportEntities.getColumnMapping(),o=jq("#columnMapping select"),p=!0;for(c in h)if(h[c].length>1&&c!="tag"){for(u=0,s=h[c].length;u<s;u++)jq("#columnSelector_"+h[c][u]).addClass("requiredInputError");p=!1}if(!p){t(ASC.CRM.Resources.CRMJSResource.ErrorMappingMoreBasicColumn);return}switch(n){case"0":case 0:if(w=o.find("option[name=firstName]:selected"),b=o.find("option[name=companyName]:selected"),w.length==0&&b.length==0){t(ASC.CRM.Resources.CRMJSResource.ErrorContactNotMappingBasicColumn);return}break;case"1":case 1:if(l=o.find("option[name=title]:selected"),a=o.find("option[name=responsible]:selected"),l.length==0||a.length==0){t(ASC.CRM.Resources.CRMJSResource.ErrorOpportunityNotMappingBasicColumn);return}break;case"3":case 3:var l=o.find("option[name=title]:selected"),k=o.find("option[name=due_date]:selected"),a=o.find("option[name=responsible]:selected");if(l.length==0||k.length==0||a.length==0){t(ASC.CRM.Resources.CRMJSResource.ErrorTaskNotMappingBasicColumn);return}break;case"7":case 7:if(l=o.find("option[name=title]:selected"),l.length==0){t(ASC.CRM.Resources.CRMJSResource.ErrorCasesNotMappingBasicColumn);return}}if(f=r,f.column_mapping=h,n!=3&&n!="3"&&(f.tags=jq.map(jq("#tagContainer .tag_title"),function(n){return jq(n).text().trim()})),n==0||n=="0"){for(v=new Array(Teamlab.profile.id),u=0,s=window.SelectedUsers_ImportContactsManager.IDs.length;u<s;u++)v.push(window.SelectedUsers_ImportContactsManager.IDs[u]);f.contact_managers=v;f.share_type=jq("#isPublic").is(":checked")?jq(".makePublicPanel select.makePublicPanelSelector").val():0}else if(n!=3&&n!="3"){for(y=new Array(SelectedUsers.CurrentUserID),u=0,s=SelectedUsers.IDs.length;u<s;u++)y.push(SelectedUsers.IDs[u]);f.access_list=y;f.is_private=jq("#isPrivate").is(":checked")}(n==0||n=="0")&&(f.removing_duplicates_behavior=jq("input[name='removingDuplicatesBehavior']:checked").val());Teamlab.startCrmImportFromCSV({},{entityType:e,csvFileURI:i,jsonSettings:jq.toJSON(f)},{before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.ImportFromCSVStepTwoProgressLable;LoadingBanner.showLoaderBtn("#importFromCSVSteps")},after:function(){LoadingBanner.hideLoaderBtn("#importFromCSVSteps")},success:function(){jq("#importFromCSVSteps").hide();jq("#importStartedFinalMessage").show();ASC.CRM.ImportEntities.checkImportStatus(!0,e)},error:function(n,i){var r=i[0];r!=null&&t(r)}})},startUploadCSVFile:function(n){jq(n).hasClass("disable")||(i==""?f.submit():(r=c(),f._settings.data.importSettings=jq.toJSON(r),LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.ImportFromCSVStepOneProgressLable,LoadingBanner.showLoaderBtn("#importFromCSVSteps"),Teamlab.uploadFakeCrmImportFromCSV({},{csvFileURI:i,jsonSettings:jq.toJSON(r)},{success:function(n,t){var i={Success:t.success,Data:t.data,Message:t.message};l(null,jq.toJSON(i))},error:function(n,t){var i=t[0];i!=null&&toastr.error(i)}})))},getPrevSampleRow:function(){u--;jq("#nextSample").show().prev().show();u==0&&jq("#prevSample").hide().next().hide();h()},getNextSampleRow:function(){u++;jq("#prevSample").show().next().show();h()},checkImportStatus:function(n,i){n&&(jq("#importStartedFinalMessage div.progress").css("width","0%"),jq("#importStartedFinalMessage div.percent").text("0%"),jq("#importErrorBox").hide(),jq("#importStartedFinalMessage div.progressErrorBox").html(""));Teamlab.getStatusCrmImportFromCSV({},{entityType:i},{max_request_attempts:1,success:function(n,t){if(t==null||jQuery.isEmptyObject(t))return jq("#importStartedFinalMessage div.progress").css("width","100%"),jq("#importStartedFinalMessage div.percent").text("100%"),jq("#importErrorBox").hide(),jq("#importStartedFinalMessage div.progressErrorBox").html(""),!1;jq("#importStartedFinalMessage div.progress").css("width",parseInt(t.percentage)+"%");jq("#importStartedFinalMessage div.percent").text(parseInt(t.percentage)+"%");t.error!=null&&t.error!=""?ASC.CRM.ImportEntities.buildErrorList(t):t.isCompleted||setTimeout("ASC.CRM.ImportEntities.checkImportStatus(false, '"+i+"')",3e3)},error:function(n,i){var r=i[0];r!=null&&t(r)}})},buildErrorList:function(n){var t="error",i;switch(typeof n.error){case"object":t=n.error.Message+"<br/>";break;case"string":t=n.error}i=jq("#importStartedFinalMessage #importLinkBox a").clone().removeClass("button.blue");jq("#importStartedFinalMessage div.progressErrorBox").html(jq("<div><\/div>").addClass("red-text").html(t)).append(i);jq("#importStartedFinalMessage #importErrorBox").show();jq("#importStartedFinalMessage #importLinkBox").hide()}}}(jQuery);ASC.CRM.UserSelectorListView=new function(){this.Init=function(n,t,i,r,u,f,e,o,s){var l,c,v,y,w,e,p,h,a;if(window[t]=new ASC.CRM.UserSelectorListView.InitNewUserSelectorListView(n,t,u,i,r,o),l=jq("#usrSrListViewAdvUsrSrContainer"+n+" .addUserLink"),l.useradvancedSelector({showme:!1,inPopup:s,onechosen:!1,showGroups:!0,withGuests:!1}),c=[],v=l.data("items"),ASC.CRM.Data.isCrmAvailableForAllUsers==!0)c=jq.merge([],v);else for(h=0,a=ASC.CRM.Data.crmAvailableWithAdminList.length;h<a;h++)for(y=0,w=v.length;y<w;y++)if(ASC.CRM.Data.crmAvailableWithAdminList[h].id==v[y].id){c.push(v[y]);continue}if(e=e!=null&&e!=""&&e.length!=0?e:[],p=[],f!=null||e.length!=0)if(f!=null)for(h=0,a=c.length;h<a;h++)f.indexOf(c[h].id)!=-1&&e.indexOf(c[h].id)==-1&&p.push(c[h]);else for(h=0,a=c.length;h<a;h++)e.indexOf(c[h].id)==-1&&p.push(c[h]);else p=c;l.useradvancedSelector("rewriteItemList",p,[]);l.on("showList",function(i,r){for(var u=0,f=r.length;u<f;u++)window[t].PushUserIntoList(n,t,r[u].id,r[u].title)});window["SelectedUsers"+n].IDs.length==0&&(jq("#cbxNotify"+n).prop("checked",!1),jq("#notifyPanel"+n).hide());window["SelectedUsers"+n].IDs.length!=0&&l.useradvancedSelector("disable",window["SelectedUsers"+n].IDs)};this.InitNewUserSelectorListView=function(n,t,i,r,u,f){var o,e,s;if(typeof window[t]!="undefined")return window[t];for(this.ObjId=n,this.ObjName=t,this.ShowNotifyPanel=r,this.NotifyLabel=u,this.DeleteImgSrc=window["SelectedUsers"+n].DeleteImgSrc,this.PushUserIntoList=function(n,t,i,r){for(var e,s,o=!1,u=window["SelectedUsers"+n],f=0,h=u.IDs.length;f<h;f++)if(u.IDs[f]==i){o=!0;break}if(o)return!1;u.IDs.push(i);u.Names.push(r);e=jq("<div><\/div>").attr("id","selectedUser_"+i+n).addClass("selectedUser");s=jq("<img>").attr("src",u.DeleteImgSrc).css("margin","0px 4px -2px 0px").css("display","none").css("width","12px").css("height","12px").css("cursor","pointer").attr("id","deleteSelectedUserImg_"+i+n).attr("title",u.DeleteImgTitle);e.append(jq.htmlEncodeLight(r)).append(s);jq("#selectedUsers"+n).append(e);jq("#selectedUser_"+i+n).off("mouseover").on("mouseover",function(){window[t].SelectedItem_mouseOver(jq(this))});jq("#selectedUser_"+i+n).off("mouseout").on("mouseout",function(){window[t].SelectedItem_mouseOut(jq(this))});jq("#deleteSelectedUserImg_"+i+n).off("click").on("click",function(){window[t].SelectedUser_deleteItem(jq(this))});jq("#cbxNotify"+n).prop("checked",!0);jq("#notifyPanel"+n).show();jq("#usrSrListViewAdvUsrSrContainer"+n+" .addUserLink").useradvancedSelector("reset",!0);jq("#usrSrListViewAdvUsrSrContainer"+n+" .addUserLink").useradvancedSelector("disable",[i]);jq("#selectedUsers"+n).parent().find("div[id=DepsAndUsersContainer]").hide();jq(window).trigger("advUserSelectorPushUserComplete",[n,i])},this.SelectedItem_mouseOver=function(n){var t=jq(n).attr("id").split("_")[1];jq(n).hasClass("selectedUser")&&(jq("#selectedUser_"+t+this.ObjId+" img:first").hide(),jq("#selectedUser_"+t+this.ObjId+" img:last").show())},this.SelectedItem_mouseOut=function(n){var t=jq(n).attr("id").split("_")[1];jq(n).hasClass("selectedUser")&&(jq("#selectedUser_"+t+this.ObjId+" img:first").show(),jq("#selectedUser_"+t+this.ObjId+" img:last").hide())},this.SelectedUser_deleteItem=function(t){var u=jq(t).attr("id").split("_")[1],i,r;for(jq("#selectedUser_"+u+this.ObjId).remove(),i=window["SelectedUsers"+this.ObjId],r=0;r<i.IDs.length;r++)if(i.IDs[r]==u){i.IDs.splice(r,1);i.Names.splice(r,1);break}i.IDs.length==0&&(jq("#cbxNotify"+this.ObjId).prop("checked",!1),jq("#notifyPanel"+this.ObjId).hide());jq("#usrSrListViewAdvUsrSrContainer"+n+" .addUserLink").useradvancedSelector("undisable",[u]);jq(window).trigger("advUserSelectorDeleteComplete",[this.ObjId,u])},o=[],e=0,s=window["SelectedUsers"+n].IDs.length;e<s;e++)o.push({id:window["SelectedUsers"+n].IDs[e],displayName:window["SelectedUsers"+n].Names[e]});return jq.tmpl("userSelectorListViewTemplate",{objId:n,objName:t,usersWhoHasAccess:i,deleteImgSrc:this.DeleteImgSrc,selectedUsers:o,showNotifyPanel:r,notifyLabel:u,addEmployeeLabel:ASC.CRM.Resources.AddUser}).appendTo(f),this}};ASC.CRM.PartialExport=function(){function r(n){ProgressDialog.generate(n||{entityType:i,base64FilterString:jq(t).advansedFilter("hash")})}function u(r,u){(t=r,i=u,ProgressDialog.init({header:ASC.CRM.Resources.CRMCommonResource.ExportData,footer:ASC.CRM.Resources.CRMCommonResource.ExportDataInfo.format("<a class='link underline' href='/Products/Files/'>","<\/a>"),progress:ASC.CRM.Resources.CRMCommonResource.ExportDataProgress},jq("#studioPageContent .mainPageContent .containerBodyBlock:first"),{terminate:Teamlab.cancelCrmCancelPartialExport,status:Teamlab.getCrmPartialExportStatus,generate:Teamlab.startCrmPartialExport}),n)||(n=!0)}var n=!1,t=null,i=null;return{init:u,startExport:r}}();
typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}}());ASC.CRM.NavSidePanel=function(){var h=!1,t=0,s=null,u="eyJpZCI6InNvcnRlciIsInR5cGUiOiJzb3J0ZXIiLCJwYXJhbXMiOiJleUpwWkNJNkltTnlaV0YwWldRaUxDSmtaV1lpT25SeWRXVXNJbVJ6WXlJNmRISjFaU3dpYzI5eWRFOXlaR1Z5SWpvaVpHVnpZMlZ1WkdsdVp5SjkifTt7ImlkIjoicGVyc29uIiwidHlwZSI6ImNvbWJvYm94IiwicGFyYW1zIjoiZXlKMllXeDFaU0k2SW1OdmJYQmhibmtpTENKMGFYUnNaU0k2SWlBZ0lDQWdJQ0FnSUNCRGIyMXdZVzVwWlhNZ0lDQWdJQ0FpTENKZlgybGtJam80TnpJd01UUjkifQ==",f="eyJpZCI6InNvcnRlciIsInR5cGUiOiJzb3J0ZXIiLCJwYXJhbXMiOiJleUpwWkNJNkltTnlaV0YwWldRaUxDSmtaV1lpT25SeWRXVXNJbVJ6WXlJNmRISjFaU3dpYzI5eWRFOXlaR1Z5SWpvaVpHVnpZMlZ1WkdsdVp5SjkifTt7ImlkIjoicGVyc29uIiwidHlwZSI6ImNvbWJvYm94IiwicGFyYW1zIjoiZXlKMllXeDFaU0k2SW5CbGNuTnZiaUlzSW5ScGRHeGxJam9pSUNBZ0lDQWdJQ0FnSUZCbGNuTnZibk1nSUNBZ0lDQWlMQ0pmWDJsa0lqbzROekl3TVRSOSJ9",o=["Default.aspx","Tasks.aspx","Deals.aspx","Invoices.aspx","Cases.aspx"],l=["Default.aspx","Tasks.aspx","Deals.aspx","Cases.aspx"],a=function(){if(!h){h=!0;t=jq.getURLParam("id");t=t!=null&&!isNaN(parseInt(t))?parseInt(t):0;s=jq.getURLParam("action");var l=e();if(l=="Default.aspx"&&s!="manage"&&t!=0?ASC.CRM.TaskActionView.init(!1):ASC.CRM.TaskActionView.init(!0),(v(l)||jq.inArray(l,o)!=-1)&&t==0&&s==null)jq("#exportListToCSV").on("click",ASC.CRM.Common.exportCurrentListToCsv);else ASC.CRM.Common.hideExportButtons();t==0&&jq.inArray(l,o)!=-1&&i("Default.aspx",0)&&(r({id:"#nav-menu-contacts .companies-menu-item:first",href:"Default.aspx",onclick:n},"Default.aspx#"+u),r({id:"#nav-menu-contacts .persons-menu-item:first",href:"Default.aspx",onclick:n},"Default.aspx#"+f));jq("#nav-menu-contacts .companies-menu-item:first").on("click",function(){if(i("Default.aspx",0)){var n=e();i(n,0)&&jq.getURLParam("action")==null&&jq.getURLParam("id")==null?(ASC.Controls.AnchorController.move(u),ASC.CRM.ListContactView.filterSortersCorrection()):n!="Default.aspx"||jq.getURLParam("action")!=null||jq.getURLParam("id")!=null?location.href="Default.aspx#"+u:(ASC.Controls.AnchorController.move(u),ASC.CRM.ListContactView.filterSortersCorrection())}else location.href="Default.aspx#"+u});jq("#nav-menu-contacts .persons-menu-item:first").on("click",function(){if(i("Default.aspx",0)){var n=e();i(n,0)&&jq.getURLParam("action")==null&&jq.getURLParam("id")==null?(ASC.Controls.AnchorController.move(f),ASC.CRM.ListContactView.filterSortersCorrection()):n!="Default.aspx"||jq.getURLParam("action")!=null||jq.getURLParam("id")!=null?location.href="Default.aspx#"+f:(ASC.Controls.AnchorController.move(f),ASC.CRM.ListContactView.filterSortersCorrection())}else location.href="Default.aspx#"+f});t==0&&jq.inArray(l,o)!=-1&&(n(),c([{id:"#nav-menu-contacts .category-wrapper a",href:"Default.aspx",onclick:n},{id:"#nav-menu-tasks a",href:"Tasks.aspx",onclick:n},{id:"#nav-menu-deals a",href:"Deals.aspx",onclick:n},{id:"#nav-menu-invoices .category-wrapper a",href:"Invoices.aspx",onclick:n},{id:"#nav-menu-cases a",href:"Cases.aspx",onclick:n}]),i("Invoices.aspx",0)&&(r({id:"#nav-menu-invoices .drafts-menu-item:first",href:"Invoices.aspx",onclick:n},"Invoices.aspx#eyJpZCI6InNvcnRlciIsInR5cGUiOiJzb3J0ZXIiLCJwYXJhbXMiOiJleUpwWkNJNkltNTFiV0psY2lJc0ltUmxaaUk2ZEhKMVpTd2laSE5qSWpwMGNuVmxMQ0p6YjNKMFQzSmtaWElpT2lKa1pYTmpaVzVrYVc1bkluMD0ifTt7ImlkIjoiZHJhZnQiLCJ0eXBlIjoiY29tYm9ib3giLCJwYXJhbXMiOiJleUoyWVd4MVpTSTZJakVpTENKMGFYUnNaU0k2SWlBZ0lDQWdJQ0FnSUNCRWNtRm1kQ0FnSUNBZ0lDSXNJbDlmYVdRaU9qRXdNelV3TTMwPSJ9"),r({id:"#nav-menu-invoices .sent-menu-item:first",href:"Invoices.aspx",onclick:n},"Invoices.aspx#eyJpZCI6InNvcnRlciIsInR5cGUiOiJzb3J0ZXIiLCJwYXJhbXMiOiJleUpwWkNJNkltNTFiV0psY2lJc0ltUmxaaUk2ZEhKMVpTd2laSE5qSWpwMGNuVmxMQ0p6YjNKMFQzSmtaWElpT2lKa1pYTmpaVzVrYVc1bkluMD0ifTt7ImlkIjoiZHJhZnQiLCJ0eXBlIjoiY29tYm9ib3giLCJwYXJhbXMiOiJleUoyWVd4MVpTSTZJaklpTENKMGFYUnNaU0k2SWlBZ0lDQWdJQ0FnSUNCVFpXNTBJQ0FnSUNBZ0lpd2lYMTlwWkNJNk1UQXpOVEF6ZlE9PSJ9"),r({id:"#nav-menu-invoices .paid-menu-item:first",href:"Invoices.aspx",onclick:n},"Invoices.aspx#eyJpZCI6InNvcnRlciIsInR5cGUiOiJzb3J0ZXIiLCJwYXJhbXMiOiJleUpwWkNJNkltNTFiV0psY2lJc0ltUmxaaUk2ZEhKMVpTd2laSE5qSWpwMGNuVmxMQ0p6YjNKMFQzSmtaWElpT2lKa1pYTmpaVzVrYVc1bkluMD0ifTt7ImlkIjoiZHJhZnQiLCJ0eXBlIjoiY29tYm9ib3giLCJwYXJhbXMiOiJleUoyWVd4MVpTSTZJalFpTENKMGFYUnNaU0k2SWlBZ0lDQWdJQ0FnSUNCUVlXbGtJQ0FnSUNBZ0lpd2lYMTlwWkNJNk1UQXpOVEF6ZlE9PSJ9"),r({id:"#nav-menu-invoices .rejected-menu-item:first",href:"Invoices.aspx",onclick:n},"Invoices.aspx#eyJpZCI6InNvcnRlciIsInR5cGUiOiJzb3J0ZXIiLCJwYXJhbXMiOiJleUpwWkNJNkltNTFiV0psY2lJc0ltUmxaaUk2ZEhKMVpTd2laSE5qSWpwMGNuVmxMQ0p6YjNKMFQzSmtaWElpT2lKa1pYTmpaVzVrYVc1bkluMD0ifTt7ImlkIjoiZHJhZnQiLCJ0eXBlIjoiY29tYm9ib3giLCJwYXJhbXMiOiJleUoyWVd4MVpTSTZJak1pTENKMGFYUnNaU0k2SWlBZ0lDQWdJQ0FnSUNCU1pXcGxZM1JsWkNBZ0lDQWdJQ0lzSWw5ZmFXUWlPakV3TXpVd00zMD0ifQ==")))}},e=function(){var t=location.pathname.split("/"),n=t[t.length-1];return n==""&&(n="Default.aspx"),n},v=function(n){return jq.inArray(n,l)!=-1||n=="Settings.aspx"&&jq.getURLParam("type")=="invoice_items"},y=function(n){ASC.CRM.Common.hideExportButtons();n=="Default.aspx"&&(jq("#nav-menu-contacts").addClass("active currentCategory"),ASC.CRM.ListContactView.init(".main-list-contacts",".filter-content",".paging-content"));n=="Tasks.aspx"&&(jq("#nav-menu-tasks").addClass("active currentCategory"),ASC.CRM.ListTaskView.init(".main-list-tasks",".filter-content",".paging-content"));n=="Deals.aspx"&&(jq("#nav-menu-deals").addClass("active currentCategory"),ASC.CRM.ListDealView.init(".main-list-deals",".filter-content",".paging-content"));n=="Invoices.aspx"&&(jq("#nav-menu-invoices").addClass("active currentCategory"),ASC.CRM.ListInvoiceView.init(".main-list-invoices",".filter-content",".paging-content"));n=="Cases.aspx"&&(jq("#nav-menu-cases").addClass("active currentCategory"),ASC.CRM.ListCasesView.init(".main-list-cases",".filter-content",".paging-content"))},n=function(){jq(".menu-list li").removeClass("active currentCategory");var n=e();y(n)},c=function(n){var t=e(),u=jq.getURLParam("id");i(t,u)&&n.forEach(function(n){r(n)})},i=function(n,t){return!!(window.history&&window.history.replaceState)&&!t&&!jq.getURLParam("action")&&jq.inArray(n,o)!=-1},r=function(n,t){jq(n.id).on("click",function(i){var u,r;return i.which==1&&i.ctrlKey||i.which==2?!0:(i.stopPropagation(),jq("#privatePanelWrapper").appendTo("#hiddenBlockForPrivatePanel"),u=jq(".main-list:not(.display-none)"),u.addClass("display-none"),u.html(""),jq(".filter-content, .paging-content").html(""),r=n.href,typeof t!="undefined"&&t!=null&&t!=""&&(r=t),history.pushState({href:r},{href:r},r),n.onclick(),!1)})};return{init:a,initMenuItems:c}}(jQuery);
ASC.CRM.FileUploader=function(){var n=function(){FileUploadManager.DisableBrowseBtn(!0);jq("#pm_upload_btn").hide();ASC.CRM.FileUploader.OnBeginCallback_function()},t=function(n,t){var i=JSON.parse(t.result);ASC.CRM.FileUploader.fileIDs.push(i.Data);FileUploadManager._uploadDone(n,t)},i=function(n,t){FileUploadManager.ClearFiles();ASC.CRM.FileUploader.OnAllUploadCompleteCallback_function();FileUploadManager._uploadStop(n,t)},r=function(n){var t=jq("#fu_item_{0} div.studioFileUploaderProgressBar".format(n.id));t.length===0?jq("#fu_item_"+n.id).replaceWith(jq.tmpl(FileUploadManager.renderedItemTemplate,n)):t.replaceWith(jq.tmpl(FileUploadManager.renderedItemTemplate,n).find("div.studioFileUploaderProgressBar:first"))};return{fileNames:function(){return jq(FileUploadManager.GetFiles()).map(function(n,t){return t.name})},fileIDs:[],activateUploader:function(){FileUploadManager.Init({DropZone:"pm_DragDropHolder",TargetContainerID:"history_uploadContainer",BrowseButton:"pm_upload_btn",UploadButton:"fakeUploadButton",MaxSize:window.uploadFileSizeLimit,FileUploadHandler:"ASC.Web.CRM.Classes.FileUploaderHandler, ASC.Web.CRM",Data:{UserID:Teamlab.profile.id},DeleteLinkCSSClass:"pm_deleteLinkCSSClass",LoadingImageCSSClass:"pm_loadingCSSClass loader-middle",CompleteCSSClass:"pm_completeCSSClass",DeleteAfterUpload:!1,Events:{OnPreUploadStart:n,OnUploadDone:t,OnUploadStop:i,OnRenderItemInUploadingProcess:r},EmptyFileErrorMsg:ASC.CRM.Resources.CRMCommonResource.EmptyFileErrorMsg,FileSizeErrorMsg:ASC.CRM.Resources.CRMCommonResource.FileSizeErrorMsg})},OnAllUploadCompleteCallback_function:function(){},OnBeginCallback_function:function(){},start:function(){FileUploadManager.StartUpload()},getUploadFileCount:function(){return FileUploadManager.GetFiles().length},showFileUploaderDialog:function(){var n=jq(window).scrollTop()-135;n=n+"px";jq.blockUI({message:jq("#fileUploaderPanel"),css:{left:"50%",top:"25%",opacity:"1",border:"none",padding:"0px",width:"550px",cursor:"default",textAlign:"left",position:"absolute","margin-left":"-300px","margin-top":n,"background-color":"White"},overlayCSS:{backgroundColor:"#AAA",cursor:"default",opacity:"0.3"},focusInput:!1,baseZ:666,fadeIn:0,fadeOut:0})},reinit:function(){jq("#history_uploadContainer").empty();FileUploadManager.DisableBrowseBtn(!1);jq("#pm_upload_btn").show();ASC.CRM.FileUploader.fileIDs.clear()}}}(jQuery);
typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}});ASC.CRM.myTaskContactFilter={filterId:"tasksAdvansedFilter",idFilterByContact:"contactID",type:"custom-contact",hiddenContainerId:"hiddenBlockForTaskContactSelector",headerContainerId:"taskContactSelectorForFilter",isInProc:!1,onSelectContact:function(n,t){jq("#"+ASC.CRM.myTaskContactFilter.headerContainerId).find(".inner-text .value").text(t.title);var i=jq("#"+ASC.CRM.myTaskContactFilter.filterId);i.advansedFilter(ASC.CRM.myTaskContactFilter.idFilterByContact,{id:t.id,displayName:t.title,value:jq.toJSON([t.id,"contact"])});i.advansedFilter("resize")},createFilterByContact:function(n){var t=document.createElement("div");return t.classList.add("default-value"),t.innerHTML=['<span class="title">',n.title,"<\/span>",'<span class="selector-wrapper">','<span class="contact-selector"><\/span>',"<\/span>",'<span class="btn-delete">&times;<\/span>',].join(""),t},customizeFilterByContact:function(n,t,i){var r=jq("#"+ASC.CRM.myTaskContactFilter.headerContainerId);if(r.parent().is("#"+ASC.CRM.myTaskContactFilter.hiddenContainerId)){r.off("showList").on("showList",function(n,i){ASC.CRM.myTaskContactFilter.onSelectContact(n,i);t.removeClass("default-value")});r.next().addBack().appendTo(t.find("span.contact-selector:first"));i.isset||setTimeout(function(){t.hasClass("default-value")&&r.trigger("click")},0)}},destroyFilterByContact:function(){var n=jq("#"+ASC.CRM.myTaskContactFilter.headerContainerId);n.parent().is("#"+ASC.CRM.myTaskContactFilter.hiddenContainerId)||(n.off("showList"),n.find(".inner-text .value").text(ASC.CRM.Resources.CRMCommonResource.Select),n.next().addBack().appendTo(jq("#"+ASC.CRM.myTaskContactFilter.hiddenContainerId)),n.contactadvancedSelector("reset"))},processFilter:function(n,t,i,r){if(r&&r.id&&isFinite(r.id)){var u=jq("#"+ASC.CRM.myTaskContactFilter.headerContainerId);u.find(".inner-text .value").text(r.displayName);u.contactadvancedSelector("select",[r.id]);t.removeClass("default-value")}}};ASC.CRM.ListTaskView=new function(){var n=function(n,t){if(ASC.CRM.ListTaskView.cookieKey&&ASC.CRM.ListTaskView.cookieKey!=""){var i={page:n,countOnPage:t};jq.cookies.set(ASC.CRM.ListTaskView.cookieKey,i,{path:location.pathname})}},i=function(){return jq("#taskFilterContainer, #taskList, #tableForTaskNavigation").hide(),ASC.CRM.Common.hideExportButtons(),jq("#emptyContentForTasksFilter:not(.display-none)").addClass("display-none"),jq("#tasksEmptyScreen.display-none").removeClass("display-none"),LoadingBanner.hideLoading(),!1},f=function(){return jq("#taskList, #tableForTaskNavigation").hide(),ASC.CRM.Common.hideExportButtons(),jq("#taskFilterContainer").show(),ASC.CRM.ListTaskView.resizeFilter(),jq("#emptyContentForTasksFilter.display-none").removeClass("display-none"),LoadingBanner.hideLoading(),!1},e=function(i,r,f){window.taskPageNavigator=new ASC.Controls.PageNavigator.init("taskPageNavigator","#divForTaskPager",r,ASC.CRM.Data.VisiblePageCount,f,ASC.CRM.Resources.CRMJSResource.Previous,ASC.CRM.Resources.CRMJSResource.Next);window.taskPageNavigator.changePageCallback=function(r){n(r,window.taskPageNavigator.EntryCountOnPage);var f=window.taskPageNavigator.EntryCountOnPage*(r-1);i==!0?u(f):t(f)}},o=function(n){var t;t=n>=ASC.CRM.ListTaskView.Total?n+1:ASC.CRM.ListTaskView.Total;window.taskPageNavigator.drawPageNavigator((n/ASC.CRM.ListTaskView.CountOfRows).toFixed(0)*1+1,t)},s=function(){var i=0;ASC.CRM.ListTaskView.defaultCurrentPageNumber!=0?(n(ASC.CRM.ListTaskView.defaultCurrentPageNumber,window.taskPageNavigator.EntryCountOnPage),i=(ASC.CRM.ListTaskView.defaultCurrentPageNumber-1)*window.taskPageNavigator.EntryCountOnPage,ASC.CRM.ListTaskView.defaultCurrentPageNumber=0):n(0,window.taskPageNavigator.EntryCountOnPage);t(i)},t=function(n){ASC.CRM.ListTaskView.isFirstLoad||(LoadingBanner.displayLoading(),jq("#taskFilterContainer, #taskList, #tableForTaskNavigation").show(),jq("#tasksAdvansedFilter").advansedFilter("resize"));l(n)},r=function(){ASC.CRM.ListContactView.isFirstLoad=!1;jq(".containerBodyBlock").children(".loader-page").hide();jq("#tasksEmptyScreen").is(":visible")||jq("#emptyContentForTasksFilter").is(":visible")||(jq("#taskFilterContainer, #taskList, #tableForTaskNavigation").show(),jq("#tasksAdvansedFilter").advansedFilter("resize"))},u=function(n){LoadingBanner.displayLoading();var t={entityid:ASC.CRM.ListTaskView.ContactID!=0?ASC.CRM.ListTaskView.ContactID:ASC.CRM.ListTaskView.EntityID,entitytype:ASC.CRM.ListTaskView.EntityType,sortBy:"deadLine",sortOrder:"descending",count:ASC.CRM.ListTaskView.CountOfRows,startIndex:n};Teamlab.getCrmTasks({__startIndex:n},{filter:t,success:ASC.CRM.ListTaskView.CallbackMethods.get_tasks_for_entity})},l=function(n){var t=ASC.CRM.ListTaskView.getFilterSettings();t.Count=ASC.CRM.ListTaskView.CountOfRows;t.startIndex=n;Teamlab.getCrmTasks({__startIndex:n},{filter:t,success:ASC.CRM.ListTaskView.CallbackMethods.get_tasks_by_filter})},a=function(n){Teamlab.removeCrmTask({},n,{success:ASC.CRM.ListTaskView.CallbackMethods.delete_task,before:function(){jq("#task_"+n+" .check").hide();jq("#task_"+n+" .ajax_edit_task").show();jq("#taskMenu_"+n).hide();PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()}})},v=function(n,t){var i,r,u;Teamlab.updateCrmTask({},n,{id:n,isClosed:t},{success:ASC.CRM.TaskActionView.CallbackMethods.edit_task,error:function(n,t){var i=jq("#addTaskPanel .error-popup");i.text(t[0]);i.removeClass("display-none").show()},before:function(){jq("#taskStatusListContainer").hide();jq("#task_"+n+" .check").hide();jq("#task_"+n+" .ajax_edit_task").show();jq("#taskMenu_"+n).hide()},after:function(){jq("#task_"+n+" .ajax_edit_task").hide();jq("#task_"+n+" .check").show();jq("#taskMenu_"+n).show()}});t&&(i=ASC.CRM.ListTaskView.TaskList[ASC.CRM.ListTaskView.findIndexOfTaskByID(n)],r={content:jq.format(ASC.CRM.Resources.CRMJSResource.TaskIsOver,i.title),categoryId:ASC.CRM.Data.HistoryCategorySystem.TaskClosed,created:Teamlab.serializeTimestamp(new Date)},i.contact!=null&&(r.contactId=i.contact.id),i.entity!=null&&(r.entityId=i.entity.entityId,r.entityType=i.entity.entityType),(i.contact!=null||i.entity!=null)&&(u=ASC.CRM.ListTaskView.ContactID==0&&ASC.CRM.ListTaskView.EntityID==0?new function(){}:ASC.CRM.HistoryView.CallbackMethods.add_event,Teamlab.addCrmHistoryEvent({},r,u)))},h=function(){if(jq("#taskStatusListContainer").length===1){jq.dropdownToggle({dropdownID:"taskStatusListContainer",switcherSelector:"#taskTable .changeStatusCombobox.canEdit",addTop:4,addLeft:0,showFunction:function(n,t){jq("#taskTable .changeStatusCombobox.selected").removeClass("selected");t.is(":hidden")&&(n.addClass("selected"),jq("#taskStatusListContainer").attr("taskid")!=n.attr("taskid")&&jq("#taskStatusListContainer").attr("taskid",n.attr("taskid")))},hideFunction:function(){jq("#taskTable .changeStatusCombobox.selected").removeClass("selected")}});jq("#taskStatusListContainer li").on({click:function(){if(jq(this).is(".selected")){jq("#taskStatusListContainer").hide();jq("#taskTable .changeStatusCombobox.selected").removeClass("selected");return}var n=jq("#taskStatusListContainer").attr("taskid"),t=jq(this).attr("class");if(t==jq("#task_"+n+" .changeStatusCombobox span").attr("class")){jq("#taskStatusListContainer").hide();jq("#taskTable .changeStatusCombobox.selected").removeClass("selected");return}v(n,t=="closed")}})}},y=function(){jq("#taskList").on("click",".divForUser:not(.removedUser) span",function(){var t=jq(this).attr("resp_id"),n=[];n.push({type:"person",id:"responsibleID",isset:!0,params:{id:t}});jq("#tasksAdvansedFilter").advansedFilter({filters:n})})},p=function(){var n=["<a class='link dotline plus'>",ASC.CRM.Resources.CRMTaskResource.CreateFirstTask,"<\/a>"].join("");jq.browser.mobile!=!0&&(n+=["<br/><a class='crm-importLink link' href='Tasks.aspx?action=import'>",ASC.CRM.Resources.CRMTaskResource.ImportTasks,"<\/a>"].join(""));jq.tmpl("template-emptyScreen",{ID:"tasksEmptyScreen",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_tasks,Header:ASC.CRM.Resources.CRMTaskResource.EmptyContentTasksHeader,Describe:jq.format(ASC.CRM.Resources.CRMTaskResource.EmptyContentTasksDescribe,"<span class='hintCategories baseLinkAction'>","<\/span>"),ButtonHTML:n,CssClass:"display-none"}).insertAfter("#taskList");jq.tmpl("template-emptyScreen",{ID:"emptyContentForTasksFilter",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_filter,Header:ASC.CRM.Resources.CRMTaskResource.EmptyContentTasksFilterHeader,Describe:ASC.CRM.Resources.CRMTaskResource.EmptyContentTasksFilterDescribe,ButtonHTML:["<a class='clearFilterButton link dotline' href='javascript:void(0);' onclick='ASC.CRM.ListTaskView.advansedFilter.advansedFilter(null);'>",ASC.CRM.Resources.CRMCommonResource.ClearFilter,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#taskList")},w=function(){if(jq("#tasksAdvansedFilter").advansedFilter){var n=new Date,u=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),f=new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,0),t=Teamlab.serializeTimestamp(n),i=Teamlab.serializeTimestamp(u),r=Teamlab.serializeTimestamp(f);ASC.CRM.ListTaskView.advansedFilter=jq("#tasksAdvansedFilter").advansedFilter({anykey:!1,hint:ASC.CRM.Resources.CRMCommonResource.AdvansedFilterInfoText.format("<b>","<\/b>",'<br/><br/><a href="'+ASC.Resources.Master.FilterHelpCenterLink+'" target="_blank">',"<\/a>"),hintDefaultDisable:!1,maxfilters:-1,colcount:2,maxlength:"100",store:!0,inhash:!0,filters:[{type:"person",id:"my",apiparamname:"responsibleID",title:ASC.CRM.Resources.CRMTaskResource.MyTasksFilter,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible,group:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible,groupby:"responsible",bydefault:{id:Teamlab.profile.id,value:Teamlab.profile.id}},{type:"person",id:"responsibleID",apiparamname:"responsibleID",title:ASC.CRM.Resources.CRMTaskResource.CustomResponsibleFilter,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible,group:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible,groupby:"responsible"},{type:"combobox",id:"overdue",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMTaskResource.OverdueTasksFilter,filtertitle:ASC.CRM.Resources.CRMTaskResource.ByDueDate,group:ASC.CRM.Resources.CRMTaskResource.ByDueDate,groupby:"deadline",options:[{value:jq.toJSON(["",t]),classname:"",title:ASC.CRM.Resources.CRMTaskResource.OverdueTasksFilter,def:!0},{value:jq.toJSON([i,r]),classname:"",title:ASC.CRM.Resources.CRMTaskResource.TodayTasksFilter},{value:jq.toJSON([t,""]),classname:"",title:ASC.CRM.Resources.CRMTaskResource.TheNextTasksFilter}]},{type:"combobox",id:"today",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMTaskResource.TodayTasksFilter,filtertitle:ASC.CRM.Resources.CRMTaskResource.ByDueDate,group:ASC.CRM.Resources.CRMTaskResource.ByDueDate,groupby:"deadline",options:[{value:jq.toJSON(["",t]),classname:"",title:ASC.CRM.Resources.CRMTaskResource.OverdueTasksFilter},{value:jq.toJSON([i,r]),classname:"",title:ASC.CRM.Resources.CRMTaskResource.TodayTasksFilter,def:!0},{value:jq.toJSON([t,""]),classname:"",title:ASC.CRM.Resources.CRMTaskResource.TheNextTasksFilter}]},{type:"combobox",id:"theNext",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMTaskResource.TheNextTasksFilter,filtertitle:ASC.CRM.Resources.CRMTaskResource.ByDueDate,group:ASC.CRM.Resources.CRMTaskResource.ByDueDate,groupby:"deadline",options:[{value:jq.toJSON(["",t]),classname:"",title:ASC.CRM.Resources.CRMTaskResource.OverdueTasksFilter},{value:jq.toJSON([i,r]),classname:"",title:ASC.CRM.Resources.CRMTaskResource.TodayTasksFilter},{value:jq.toJSON([t,""]),classname:"",title:ASC.CRM.Resources.CRMTaskResource.TheNextTasksFilter,def:!0}]},{type:"daterange",id:"fromToDate",title:ASC.CRM.Resources.CRMTaskResource.CustomDateFilter,filtertitle:ASC.CRM.Resources.CRMTaskResource.ByDueDate,group:ASC.CRM.Resources.CRMTaskResource.ByDueDate,groupby:"deadline"},{type:"combobox",id:"openTask",apiparamname:"isClosed",title:ASC.CRM.Resources.CRMTaskResource.OnlyOpenTasks,filtertitle:ASC.CRM.Resources.CRMTaskResource.TasksByStatus,group:ASC.CRM.Resources.CRMTaskResource.TasksByStatus,groupby:"taskStatus",options:[{value:!1,classname:"",title:ASC.CRM.Resources.CRMTaskResource.OnlyOpenTasks,def:!0},{value:!0,classname:"",title:ASC.CRM.Resources.CRMTaskResource.OnlyClosedTasks}]},{type:"combobox",id:"closedTask",apiparamname:"isClosed",title:ASC.CRM.Resources.CRMTaskResource.OnlyClosedTasks,filtertitle:ASC.CRM.Resources.CRMTaskResource.TasksByStatus,group:ASC.CRM.Resources.CRMTaskResource.TasksByStatus,groupby:"taskStatus",options:[{value:!1,classname:"",title:ASC.CRM.Resources.CRMTaskResource.OnlyOpenTasks},{value:!0,classname:"",title:ASC.CRM.Resources.CRMTaskResource.OnlyClosedTasks,def:!0}]},{type:"combobox",id:"categoryID",apiparamname:"categoryID",title:ASC.CRM.Resources.CRMCommonResource.ByCategory,group:ASC.CRM.Resources.CRMCommonResource.Other,options:ASC.CRM.Data.taskCategories,defaulttitle:ASC.CRM.Resources.CRMCommonResource.Choose},{type:ASC.CRM.myTaskContactFilter.type,id:ASC.CRM.myTaskContactFilter.idFilterByContact,apiparamname:jq.toJSON(["entityid","entityType"]),title:ASC.CRM.Resources.CRMContactResource.Contact,group:ASC.CRM.Resources.CRMCommonResource.Other,hashmask:"",create:ASC.CRM.myTaskContactFilter.createFilterByContact,customize:ASC.CRM.myTaskContactFilter.customizeFilterByContact,destroy:ASC.CRM.myTaskContactFilter.destroyFilterByContact,process:ASC.CRM.myTaskContactFilter.processFilter}],sorters:[{id:"title",title:ASC.CRM.Resources.CRMCommonResource.Title,dsc:!1,def:!1},{id:"category",title:ASC.CRM.Resources.CRMCommonResource.Category,dsc:!1,def:!1},{id:"deadline",title:ASC.CRM.Resources.CRMTaskResource.DueDate,dsc:!1,def:!0},{id:"contactmanager",title:ASC.CRM.Resources.CRMCommonResource.Responsible,dsc:!1,def:!1},{id:"contact",title:ASC.CRM.Resources.CRMContactResource.Contact,dsc:!1,def:!1}]}).on("setfilter",ASC.CRM.ListTaskView.setFilter).on("resetfilter",ASC.CRM.ListTaskView.resetFilter)}},c=function(n){if(jq.dropdownToggle({dropdownID:"taskActionMenu",switcherSelector:"#taskTable .entity-menu",addTop:0,addLeft:10,rightPos:!0,showFunction:function(n,t){jq("#taskTable .entity-menu.active").removeClass("active");t.is(":hidden")&&n.addClass("active")},hideFunction:function(){jq("#taskTable .entity-menu.active").removeClass("active")}}),!n)jq("body").off("contextmenu").on("contextmenu",function(n){var t=jq.fixEvent(n),i,r,u;return typeof t=="undefined"||!t?!0:(i=jq(t.srcElement||t.target),!i.parents("#taskTable").length)?(jq("#taskActionMenu").hide(),!0):(r=i.closest("tr.with-entity-menu"),u=parseInt(r.attr("id").split("_")[1]),!u||!r.find(".entity-menu").length)?!0:(ASC.CRM.ListTaskView.showActionMenu(u),jq("#taskTable .entity-menu.active").removeClass("active"),jq.showDropDownByContext(t,i,jq("#taskActionMenu")),!1)})};return{CallbackMethods:{get_tasks_by_filter:function(n,t){var s,u,e;for(ASC.CRM.ListTaskView.TaskList=[],ASC.CRM.ListTaskView.Total=n.__total||0,s=n.__startIndex||0,u=0,e=t.length;u<e;u++)ASC.CRM.ListTaskView.taskItemFactory(t[u]),ASC.CRM.ListTaskView.TaskList.push(t[u]);if(ASC.CRM.ListTaskView.Total===0&&typeof ASC.CRM.ListTaskView.advansedFilter!="undefined"&&ASC.CRM.ListTaskView.advansedFilter.advansedFilter().length==1?(ASC.CRM.ListTaskView.noTasks=!0,ASC.CRM.ListTaskView.noTasksForQuery=!0):(ASC.CRM.ListTaskView.noTasks=!1,ASC.CRM.ListTaskView.noTasksForQuery=ASC.CRM.ListTaskView.Total===0?!0:!1),ASC.CRM.ListTaskView.noTasks)return i(),ASC.CRM.ListTaskView.isFirstLoad?r():LoadingBanner.hideLoading(),!1;if(ASC.CRM.ListTaskView.noTasksForQuery)return f(),jq("#taskFilterContainer").show(),ASC.CRM.ListTaskView.resizeFilter(),ASC.CRM.ListTaskView.isFirstLoad?r():LoadingBanner.hideLoading(),!1;if(t.length==0)return jq("tasksEmptyScreen:not(.display-none)").addClass("display-none"),jq("#emptyContentForTasksFilter:not(.display-none)").addClass("display-none"),jq("#taskTable tbody tr").remove(),jq("#tableForTasksNavigation").show(),ASC.CRM.Common.hideExportButtons(),LoadingBanner.hideLoading(),!1;for(jq("#totalTasksOnPage").text(ASC.CRM.ListTaskView.Total),jq("#emptyContentForTasksFilter:not(.display-none)").addClass("display-none"),jq("#tasksEmptyScreen:not(.display-none)").addClass("display-none"),ASC.CRM.Common.showExportButtons(),jq("#taskFilterContainer").show(),ASC.CRM.ListTaskView.resizeFilter(),jq("#taskTable tbody").replaceWith(jq.tmpl("taskListTmpl",{tasks:ASC.CRM.ListTaskView.TaskList})),jq("#taskList").show(),ASC.CRM.Common.RegisterContactInfoCard(),u=0,e=ASC.CRM.ListTaskView.TaskList.length;u<e;u++)ASC.CRM.Common.tooltip("#taskTitle_"+ASC.CRM.ListTaskView.TaskList[u].id,"tooltip");o(s);window.scrollTo(0,0);ASC.CRM.ListTaskView.isFirstLoad?r():LoadingBanner.hideLoading()},get_tasks_for_entity:function(n,t){var f,r,u;for(ASC.CRM.ListTaskView.TaskList=[],ASC.CRM.ListTaskView.Total=n.__total||0,f=n.__startIndex||0,r=0,u=t.length;r<u;r++)ASC.CRM.ListTaskView.taskItemFactory(t[r]),ASC.CRM.ListTaskView.TaskList.push(t[r]);if(ASC.CRM.ListTaskView.noTasks=ASC.CRM.ListTaskView.Total===0,ASC.CRM.ListTaskView.noTasks)return i(),LoadingBanner.hideLoading(),!1;if(t.length==0)return jq("tasksEmptyScreen:not(.display-none)").addClass("display-none"),jq("#taskTable tbody tr").remove(),jq("#tableForTasksNavigation").show(),ASC.CRM.Common.hideExportButtons(),LoadingBanner.hideLoading(),!1;for(jq("#totalTasksOnPage").text(ASC.CRM.ListTaskView.Total),jq("#tasksEmptyScreen:not(.display-none)").addClass("display-none"),ASC.CRM.Common.showExportButtons(),jq("#taskList").show(),jq("#taskTable tbody").replaceWith(jq.tmpl("taskListTmpl",{tasks:ASC.CRM.ListTaskView.TaskList})),ASC.CRM.Common.RegisterContactInfoCard(),r=0,u=ASC.CRM.ListTaskView.TaskList.length;r<u;r++)ASC.CRM.Common.tooltip("#taskTitle_"+ASC.CRM.ListTaskView.TaskList[r].id,"tooltip");o(f);window.scrollTo(0,0);LoadingBanner.hideLoading()},delete_task:function(n,r){jq("#task_"+r.id).animate({opacity:"hide"},500);ASC.CRM.UpdateCRMCaldavCalendar(r,2);setTimeout(function(){var u,n;if(jq("#task_"+r.id).remove(),ASC.CRM.ListTaskView.Total-=1,jq("#totalTasksOnPage").text(ASC.CRM.ListTaskView.Total),u=ASC.CRM.ListTaskView.findIndexOfTaskByID(r.id),u!=-1&&ASC.CRM.ListTaskView.TaskList.splice(u,1),ASC.CRM.ListTaskView.Total==0&&(typeof ASC.CRM.ListTaskView.advansedFilter=="undefined"||ASC.CRM.ListTaskView.advansedFilter.advansedFilter().length==1)?(ASC.CRM.ListTaskView.noTasks=!0,ASC.CRM.ListTaskView.noTasksForQuery=!0):(ASC.CRM.ListTaskView.noTasks=!1,ASC.CRM.ListTaskView.noTasksForQuery=ASC.CRM.ListTaskView.Total===0?!0:!1),PopupKeyUpActionProvider.EnableEsc=!0,ASC.CRM.ListTaskView.noTasks){i();jq.unblockUI();return}if(ASC.CRM.ListTaskView.noTasksForQuery){f();jq.unblockUI();return}if(jq("#taskTable tbody tr").length==0){for(jq.unblockUI(),n=ASC.CRM.ListTaskView.CountOfRows*(window.taskPageNavigator.CurrentPageNumber-1);n>=ASC.CRM.ListTaskView.Total&&n>=ASC.CRM.ListTaskView.CountOfRows;)n-=ASC.CRM.ListTaskView.CountOfRows;t(n)}else jq.unblockUI()},500)}},init:function(t,i,r){var s,o;if(jq(t).length!=0){ASC.CRM.Common.setDocumentTitle(ASC.CRM.Resources.CRMTaskResource.Tasks);jq(t).removeClass("display-none");jq.tmpl("tasksListFilterTmpl").appendTo(i);jq.tmpl("tasksListPagingTmpl").appendTo(r);jq("#privatePanelWrapper").appendTo("#permissionsDealsPanelInnerHtml");ASC.CRM.ListTaskView.ContactID=0;ASC.CRM.ListTaskView.EntityType="";ASC.CRM.ListTaskView.EntityID=0;ASC.CRM.ListTaskView.cookieKey=ASC.CRM.Data.CookieKeyForPagination.tasks;ASC.CRM.ListTaskView.TaskList=[];ASC.CRM.ListTaskView.isFilterVisible=!1;ASC.CRM.ListTaskView.isTabActive=!1;ASC.CRM.ListTaskView.Total=0;ASC.CRM.ListTaskView.advansedFilter=null;jq.tmpl("taskExtendedListTmpl",{IsTab:!1}).appendTo(t);p();c(!1);var f={page:1,countOnPage:jq("#tableForTaskNavigation select:first>option:first").val()},l=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+location.pathname+location.search,u=location.hash,a=encodeURIComponent(l);u=u&&typeof u=="string"&&u.charAt(0)==="#"?u.substring(1):u;s=jq.cookies.get(a);u==""||s==u?(o=ASC.CRM.Common.getPagingParamsFromCookie(ASC.CRM.ListTaskView.cookieKey),o!=null&&(f=o)):n(f.page,f.countOnPage);ASC.CRM.ListTaskView.CountOfRows=f.countOnPage;ASC.CRM.ListTaskView.defaultCurrentPageNumber=f.page;jq("#tableForTaskNavigation select:first").val(ASC.CRM.ListTaskView.CountOfRows).on("change",function(){ASC.CRM.ListTaskView.changeCountOfRows(this.value,!1)}).tlCombobox();h();jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})});jq("#tasksEmptyScreen .emptyScrBttnPnl>a.link.plus").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})});y();e(!1,ASC.CRM.ListTaskView.CountOfRows,ASC.CRM.ListTaskView.defaultCurrentPageNumber);ASC.CRM.ListTaskView.isFirstLoad=!0;jq(".containerBodyBlock").children(".loader-page").show();ASC.CRM.Common.registerChangeHoverStateByParent("label.task_category","#taskTable .with-entity-menu");jq("#"+ASC.CRM.myTaskContactFilter.headerContainerId).contactadvancedSelector({showme:!0,addtext:ASC.CRM.Resources.CRMContactResource.AddNewCompany,noresults:ASC.CRM.Resources.CRMCommonResource.NoMatches,noitems:ASC.CRM.Resources.CRMCommonResource.NoMatches,inPopup:!0,onechosen:!0,isTempLoad:!0});jq(window).on("afterResetSelectedContact",function(n,t,i){i==="taskContactSelectorForFilter"&&ASC.CRM.myTaskContactFilter.filterId&&jq("#"+ASC.CRM.myTaskContactFilter.filterId).advansedFilter("resize")});w();ASC.CRM.PartialExport.init(ASC.CRM.ListTaskView.advansedFilter,"task")}},isFirstLoad:!0,initTab:function(n,t,i){ASC.CRM.ListTaskView.ContactID=n;ASC.CRM.ListTaskView.EntityType=t;ASC.CRM.ListTaskView.EntityID=i;ASC.CRM.ListTaskView.CountOfRows=ASC.CRM.Data.DefaultEntryCountOnPage;ASC.CRM.ListTaskView.TaskList=[];ASC.CRM.ListTaskView.isFilterVisible=!1;ASC.CRM.ListTaskView.isTabActive=!1;jq.tmpl("template-emptyScreen",{ID:"tasksEmptyScreen",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_tasks,Header:ASC.CRM.Resources.CRMTaskResource.EmptyContentTasksHeader,Describe:jq.format(ASC.CRM.Resources.CRMTaskResource.EmptyContentTasksDescribe,"<span class='hintCategories baseLinkAction' >","<\/span>"),ButtonHTML:["<a class='link dotline plus'>",ASC.CRM.Resources.CRMTaskResource.CreateTask,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#taskListTab");jq.tmpl("taskExtendedListTmpl",{IsTab:!0}).appendTo("#taskListTab");jq("#tableForTaskNavigation select").val(ASC.CRM.ListTaskView.CountOfRows).on("change",function(){ASC.CRM.ListTaskView.changeCountOfRows(this.value,!0)}).tlCombobox();h();c(!0);e(!0,ASC.CRM.ListTaskView.CountOfRows,0);ASC.CRM.Common.registerChangeHoverStateByParent("label.task_category","#taskTable .with-entity-menu")},bindEmptyScrBtnEvent:function(n){jq("#tasksEmptyScreen .emptyScrBttnPnl>a.link.plus").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,ASC.CRM.ListTaskView.EntityType,ASC.CRM.ListTaskView.EntityID,window.contactForInitTaskActionPanel,n)})},setFilter:function(){s()},resetFilter:function(){s()},activate:function(){ASC.CRM.ListTaskView.isTabActive==!1&&(ASC.CRM.ListTaskView.isTabActive=!0,u(0))},resizeFilter:function(){var n=jq("#taskFilterContainer").is(":hidden")==!1;ASC.CRM.ListTaskView.isFilterVisible==!1&&n&&(ASC.CRM.ListTaskView.isFilterVisible=!0,ASC.CRM.ListTaskView.advansedFilter&&jq("#tasksAdvansedFilter").advansedFilter("resize"))},getFilterSettings:function(){var n={},t;return ASC.CRM.ListTaskView.advansedFilter.advansedFilter==null?n:(t=ASC.CRM.ListTaskView.advansedFilter.advansedFilter(),jq(t).each(function(t,i){var u,r,t,f;switch(i.id){case"sorter":n.sortBy=i.params.id;n.sortOrder=i.params.dsc==!0?"descending":"ascending";break;case"text":n.filterValue=i.params.value;break;case"fromToDate":n.fromDate=new Date(i.params.from);n.toDate=new Date(i.params.to);n.toDate=new Date(n.toDate.getFullYear(),n.toDate.getMonth(),n.toDate.getDate(),23,59,59,0);break;default:if(i.hasOwnProperty("apiparamname")&&i.params.hasOwnProperty("value")&&i.params.value!=null)try{for(u=JSON.parse(i.apiparamname),r=JSON.parse(i.params.value),u.length!=r.length&&(n[i.apiparamname]=i.params.value),t=0,f=u.length;t<f;t++)(typeof r[t]!="string"||r[t].trim().length!=0)&&(n[u[t]]=r[t])}catch(e){n[i.apiparamname]=i.params.value}}}),n)},taskItemFactory:function(n){if(n.isClosed?(n.classForTitle="header-base-small gray-text",n.classForTaskDeadline="gray-text"):n.deadLine<new Date?(n.classForTitle="header-base-small red-text",n.classForTaskDeadline="red-text"):(n.classForTitle="header-base-small",n.classForTaskDeadline=""),n.entity!=null)switch(n.entity.entityType){case"opportunity":n.entityURL="Deals.aspx?id="+n.entity.entityId;n.entityType=ASC.CRM.Resources.CRMJSResource.Deal;break;case"case":n.entityURL="Cases.aspx?id="+n.entity.entityId;n.entityType=ASC.CRM.Resources.CRMJSResource.Case;break;default:n.entityURL="";n.entityType=""}n.category.cssClass=n.category.imagePath.split("/")[n.category.imagePath.split("/").length-1].split(".")[0];window.UserManager.getUser(n.responsible.id)==null&&(n.responsible.displayName=ASC.CRM.Data.ProfileRemoved,n.responsible.activationStatus=2)},showConfirmationPanelForDelete:function(n){jq("#confirmationDeleteOneTaskPanel .middle-button-container>.button.blue.middle").off("click").on("click",function(){a(n)});PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#confirmationDeleteOneTaskPanel",500)},findIndexOfTaskByID:function(n){for(var i=ASC.CRM.ListTaskView.TaskList.length,t=0;t<i;t++)if(ASC.CRM.ListTaskView.TaskList[t].id==n)return t;return-1},showActionMenu:function(n){var u=ASC.CRM.ListTaskView.findIndexOfTaskByID(n),i,r;if(u!==-1){var t=ASC.CRM.ListTaskView.TaskList[u],c=t.contact!=null?t.contact.id:0,e=t.contact!=null?t.contact.displayName:"",o=t.entity!=null?t.entity.entityType:"",s=t.entity!=null?t.entity.entityId:0,h=t.category.imagePath.indexOf("task_category_email")!=-1,f=t.contact!=null&&t.contact.email!=null?t.contact.email.data:"";jq("#editTaskLink").off("click").on("click",function(){jq("#taskActionMenu").hide();jq("#taskTable .entity-menu.active").removeClass("active");ASC.CRM.TaskActionView.showTaskPanel(n,o,s,window.contactForInitTaskActionPanel,{})});jq("#deleteTaskLink").off("click").on("click",function(){jq("#taskActionMenu").hide();jq("#taskTable .entity-menu.active").removeClass("active");ASC.CRM.ListTaskView.showConfirmationPanelForDelete(n)});h?(jq("#sendEmailLink").removeClass("display-none"),i=ASC.CRM.Common.getMailModuleBasePath(),r="",r=f!=""?[i,"#composeto/email='",e,"' <",f,">"].join(""):[i,"#composeto/"].join(""),jq("#sendEmailLink").attr("href",r)):jq("#sendEmailLink").addClass("display-none")}},changeCountOfRows:function(i,r){if(!isNaN(i)){var f=i*1;ASC.CRM.ListTaskView.CountOfRows=f;taskPageNavigator.EntryCountOnPage=f;r==!0?u(0):(n(1,f),t(0))}}}};ASC.CRM.TaskActionView=new function(){var n=function(n){jq("#taskDeadlineContainer").find("a").each(function(){jq(this).css("border-bottom","");jq(this).css("font-weight","normal")});(n==0||n==3||n==7)&&(jq("#deadline_"+n).css("border-bottom","none"),jq("#deadline_"+n).css("font-weight","bold"))},i=function(n){if(window.taskContactSelector.ShowAddButton=!1,window.taskContactSelector.clearSelector(),typeof n=="object"&&n!=null&&n.length!=0)if(Array.isArray(n)){window.taskContactSelector.setContact(jq("#contactTitle_taskContactSelector_0"),n[0].id,n[0].displayName,n[0].smallFotoUrl);window.taskContactSelector.showInfoContent(jq("#contactTitle_taskContactSelector_0"));for(var t=1,i=n.length;t<i;t++)window.taskContactSelector.AddNewSelectorWithSelectedContact(n[t]),window.taskContactSelector.SelectedContacts.push(n[t].id)}else window.taskContactSelector.setContact(jq("#contactTitle_taskContactSelector_0"),n.id,n.displayName,n.smallFotoUrl),window.taskContactSelector.showInfoContent(jq("#contactTitle_taskContactSelector_0"));else window.taskContactSelector.changeContact("taskContactSelector_0"),window.taskContactSelector.crossButtonEventClick("taskContactSelector_0")},t=function(n,t){var i=jq("#taskActionViewAdvUsrSrContainer"),r=(i.data("items")||[]).map(function(n){return n.id}),u;if(i.useradvancedSelector("undisable",r),n&&n.isPrivate&&n.accessList){var f=n.accessList.map(function(n){return n.id}),e=ASC.CRM.Data.crmAdminList.map(function(n){return n.id}),o=f.concat(e),s=r.filter(function(n){return!o.includes(n)});i.useradvancedSelector("disable",s)}u=t&&t.responsible&&t.responsible.activationStatus!=2?t.responsible:Teamlab.profile;i.useradvancedSelector("select",[u.id]);i.useradvancedSelector("reset")},u=function(){var n={};n=ASC.CRM.Data.taskCategories.length>0?ASC.CRM.Data.taskCategories[0]:{id:0,title:"",imgSrc:""};window.taskCategorySelector=new ASC.CRM.CategorySelector("taskCategorySelector",n);taskCategorySelector.renderControl(ASC.CRM.Data.taskCategories,n,"#taskCategorySelectorContainer",0,"")},f=function(){for(var t="<option value='-1' id='optDeadlineHours_-1'>--<\/option>",n=0;n<24;n++)t+=["<option value='",n,"' id='optDeadlineHours_",n,"'>",n<10?"0"+n:n,"<\/option>"].join("");for(jq("#taskDeadlineHours").html(t).val("-1"),t="<option value='-1' id='optDeadlineMinutes_-1'>--<\/option>",n=0;n<60;n++)t+=["<option value='",n,"' id='optDeadlineMinutes_",n,"'>",n<10?"0"+n:n,"<\/option>"].join("");jq("#taskDeadlineMinutes").html(t).val("-1")},r=function(n,t,i,r){var f={},e=!0,u=null,o;return jq("#addTaskPanel input[id$=taskDeadline]").val().trim()!=""&&(u=jq("#taskDeadline").datepicker("getDate"),parseInt(jq("#taskDeadlineHours option:selected").val())!=-1?u.setHours(parseInt(jq("#taskDeadlineHours option:selected").val())):u.setHours(0),parseInt(jq("#taskDeadlineMinutes option:selected").val())!=-1?u.setMinutes(parseInt(jq("#taskDeadlineMinutes option:selected").val())):u.setMinutes(0),u=Teamlab.serializeTimestamp(u)),f={id:n,title:jq("#tbxTitle").val(),description:jq("#tbxDescribe").val(),deadline:u,responsibleid:jq("#taskActionViewAdvUsrSrContainer").attr("data-responsible-id"),categoryid:window.taskCategorySelector.CategoryID,isnotify:jq("#notifyResponsible").is(":checked"),contactid:r,alertValue:jq("#taskAlertInterval").val()},i!=0&&(f.entityType=t,f.entityid=i),o=parseInt(jq("#taskDeadlineHours option:selected").val())==-1&&parseInt(jq("#taskDeadlineMinutes option:selected").val())!=-1||parseInt(jq("#taskDeadlineHours option:selected").val())!=-1&&parseInt(jq("#taskDeadlineMinutes option:selected").val())==-1,jq("#tbxTitle").val().trim()==""?(AddRequiredErrorText(jq("#tbxTitle"),ASC.CRM.Resources.CRMJSResource.EmptyTaskTitle),ShowRequiredError(jq("#tbxTitle"),!0),e=!1):RemoveRequiredErrorClass(jq("#tbxTitle")),f.responsibleid==""?(AddRequiredErrorText(jq("#taskActionViewAdvUsrSrContainer"),ASC.CRM.Resources.CRMJSResource.EmptyTaskResponsible),ShowRequiredError(jq("#taskActionViewAdvUsrSrContainer"),!0),e=!1):RemoveRequiredErrorClass(jq("#taskActionViewAdvUsrSrContainer")),f.deadline==null||o?(AddRequiredErrorText(jq("#taskDeadline"),ASC.CRM.Resources.CRMJSResource.EmptyTaskDeadline),ShowRequiredError(jq("#taskDeadline"),!0),o?(jq("#taskDeadlineHours").addClass("requiredInputError"),jq("#taskDeadlineMinutes").addClass("requiredInputError")):(jq("#taskDeadlineHours").removeClass("requiredInputError"),jq("#taskDeadlineMinutes").removeClass("requiredInputError")),e=!1):(RemoveRequiredErrorClass(jq("#taskDeadline")),jq("#taskDeadlineHours").removeClass("requiredInputError"),jq("#taskDeadlineMinutes").removeClass("requiredInputError")),e?f:null};return{CallbackMethods:{add_task:function(n,t){var r,i;ASC.CRM.UpdateCRMCaldavCalendar(t,0);r=typeof ASC.CRM.ListTaskView=="undefined"||typeof ASC.CRM.ListTaskView.advansedFilter=="undefined";typeof ASC.CRM.ListTaskView!="undefined"&&typeof ASC.CRM.ListTaskView.TaskList!="undefined"&&(i=t,ASC.CRM.ListTaskView.taskItemFactory(i),ASC.CRM.ListTaskView.TaskList.push(i),jq("#taskTable tbody tr").length==0&&(r||jq("#emptyContentForTasksFilter:not(.display-none)").addClass("display-none"),jq("#tasksEmptyScreen:not(.display-none)").addClass("display-none"),r||(jq("#taskFilterContainer").show(),ASC.CRM.ListTaskView.resizeFilter()),jq("#taskList").show()),jq.tmpl("taskTmpl",i).prependTo("#taskTable tbody"),ASC.CRM.ListTaskView.Total+=1,jq("#totalTasksOnPage").text(ASC.CRM.ListTaskView.Total),jq("#tableForTaskNavigation").show(),ASC.CRM.Common.tooltip("#taskTitle_"+i.id,"tooltip"),ASC.CRM.Common.RegisterContactInfoCard());PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()},edit_task:function(n,t,i){ASC.CRM.UpdateCRMCaldavCalendar(t,t.isClosed?2:1,i);var r=t;ASC.CRM.ListTaskView.taskItemFactory(r);ASC.CRM.ListTaskView.TaskList.push(r);jq("#task_"+r.id).attr("id","old_task").hide();jq.tmpl("taskTmpl",r).insertBefore(jq("#old_task"));jq("#old_task").remove();ASC.CRM.Common.tooltip("#taskTitle_"+r.id,"tooltip");PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI();ASC.CRM.Common.RegisterContactInfoCard()}},init:function(i){jq.tmpl("template-blockUIPanel",{id:"addTaskPanel",headerTest:ASC.CRM.Resources.CRMTaskResource.AddNewTask,questionText:"",innerHtmlText:'<div class="addTaskPanelContainer"><\/div>',progressText:""}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first");jq("#addTaskPanel .addTaskPanelContainer").replaceWith(jq.tmpl("taskActionViewTmpl",{}).appendTo("#addTaskPanel .addTaskPanelContainer"));f();jq("#taskDeadline").mask(ASC.Resources.Master.DatePatternJQ);jq("#taskDeadline").datepickerWithButton({onSelect:function(){var i=jq("#taskDeadline").datepicker("getDate")||new Date,t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0,0),u=Math.floor((i.getTime()-r.getTime())/864e5);n(u);setTimeout(function(){jq("#taskDeadline").datepicker("setDate",i).datepicker("hide");jq('<input type="text" />').insertAfter("#taskDeadline").trigger("focus").remove()},100)}});jq.browser.mobile&&jq("#ui-datepicker-div").addClass("blockMsg");u();window.taskContactSelector=new ASC.CRM.ContactSelector.ContactSelector("taskContactSelector",{SelectorType:ASC.CRM.Data.ContactSelectorTypeEnum.All,EntityType:0,EntityID:0,ShowOnlySelectorContent:!1,DescriptionText:ASC.CRM.Resources.CRMCommonResource.FindContactByName,DeleteContactText:"",AddContactText:"",IsInPopup:!0,ShowChangeButton:i,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!0,ShowNewCompanyContent:!0,ShowNewContactContent:!0,presetSelectedContactsJson:"",ExcludedArrayIDs:[],HTMLParent:"#addTaskPanel .connectWithContactContainer"});window.taskContactSelector.SelectItemEvent=function(n,i){window.taskContactSelector.setContact(i.input,n.id,n.displayName,n.smallFotoUrl);window.taskContactSelector.showInfoContent(i.input);t(n)}},showTaskPanel:function(n,t,i,r,u){var f=ASC.CRM.TaskActionView.initPanel(n,r,u);PopupKeyUpActionProvider.EnableEsc=!1;HideRequiredError();jq("#addTaskPanel .error-popup").addClass("display-none");jq("#createNewButton").hide();StudioBlockUIManager.blockUI("#addTaskPanel",650);jq("#addTaskPanel input[id$=tbxTitle]").trigger("focus");jq("#taskActionPopupOK").off("click").on("click",function(){if(!jq(this).hasClass("disable"))if(window.taskContactSelector.SelectedContacts.length>1)ASC.CRM.TaskActionView.saveTaskGroup(t,i,window.taskContactSelector.SelectedContacts,f,u);else{var r=0;window.taskContactSelector.SelectedContacts.length==1&&(r=window.taskContactSelector.SelectedContacts[0]);ASC.CRM.TaskActionView.saveTask(n,t,i,r,f,u)}})},keyPress:function(n){var i,t;t||(t=n);t||(t=window.event);t.keyCode?i=t.keyCode:t.which&&(i=t.which);i>=48&&i<=57&&jq("#taskDeadlineContainer").find("a").each(function(){jq(this).css("border-bottom","")})},changeDeadline:function(t){var i=parseInt(jq(t).attr("id").split("_")[1].trim()),r=new Date,u=new Date(r.setDate(r.getDate()+i));jq("#taskDeadline").datepicker("setDate",u);n(i)},saveTask:function(n,t,i,u,f,e){var o=r(n,t,i,u),h,c,s;if(o==null)return!1;n!=0?(h=ASC.CRM.ListTaskView.findIndexOfTaskByID(n),c=ASC.CRM.ListTaskView.TaskList[h].responsible.id,ASC.CRM.ListTaskView.TaskList.splice(f,1),Teamlab.updateCrmTask({},n,o,{success:function(n,t){ASC.CRM.TaskActionView.CallbackMethods.edit_task(n,t,c)},error:function(n,t){var i=jq("#addTaskPanel .error-popup");i.text(t[0]);i.removeClass("display-none").show()},before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMTaskResource.SavingTask;LoadingBanner.showLoaderBtn("#addTaskPanel")},after:function(){LoadingBanner.hideLoaderBtn("#addTaskPanel")}})):(s=ASC.CRM.TaskActionView.CallbackMethods.add_task,typeof e=="object"&&e!=null&&e.hasOwnProperty("success")&&typeof e.success=="function"&&(s=e.success),Teamlab.addCrmTask({},o,{success:s,error:function(n,t){var i=jq("#addTaskPanel .error-popup");i.text(t[0]);i.removeClass("display-none").show()},before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMTaskResource.SavingTask;LoadingBanner.showLoaderBtn("#addTaskPanel")},after:function(){LoadingBanner.hideLoaderBtn("#addTaskPanel")}}))},saveTaskGroup:function(n,t,i,u,f){var o=r(0,n,t,i),e;if(o==null)return!1;e=function(){jq.unblockUI()};typeof f=="object"&&f.hasOwnProperty("success")&&typeof f.success=="function"&&(e=f.success);Teamlab.addCrmTaskGroup({},o,{success:e,error:function(n,t){var i=jq("#addTaskPanel .error-popup");i.text(t[0]);i.removeClass("display-none").show()},before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMTaskResource.SavingTask;LoadingBanner.showLoaderBtn("#addTaskPanel")},after:function(){LoadingBanner.hideLoaderBtn("#addTaskPanel")}})},initPanel:function(r,u,f){var v,s,c,y,e,h,l,o,a;if(!jq("#taskActionViewAdvUsrSrContainer").next().is(".advanced-selector-container")){if(jq("#taskActionViewAdvUsrSrContainer").useradvancedSelector({showme:!1,inPopup:!0,onechosen:!0,showGroups:!0,withGuests:!1}),ASC.CRM.Data.isCrmAvailableForAllUsers==!1){for(v=[],s=jq("#taskActionViewAdvUsrSrContainer").data("items"),e=0,h=ASC.CRM.Data.crmAvailableWithAdminList.length;e<h;e++)for(c=0,y=s.length;c<y;c++)if(ASC.CRM.Data.crmAvailableWithAdminList[e].id==s[c].id){v.push(s[c]);continue}jq("#taskActionViewAdvUsrSrContainer").useradvancedSelector("rewriteItemList",v,[])}jq("#taskActionViewAdvUsrSrContainer").on("showList",function(n,t){t.id==Teamlab.profile.id?jq("#notifyResponsible").prop("checked",!1).prop("disabled",!0):jq("#notifyResponsible").prop("disabled",!1).prop("checked",!0);jq("#taskActionViewAdvUsrSrContainer").attr("data-responsible-id",t.id);jq("#taskActionViewAdvUsrSrContainer .taskResponsibleLabel").text(Encoder.htmlDecode(t.title))});if(typeof f!="undefined"&&f!=null&&f.hasOwnProperty("taskResponsibleSelectorUserIDs")){var p=[],s=[],w=[],b=[];for(e=0,h=ASC.CRM.Data.crmAdminList.length;e<h;e++)p.push(ASC.CRM.Data.crmAdminList[e].id);for(w=f.taskResponsibleSelectorUserIDs.concat(p),s=jq("#taskActionViewAdvUsrSrContainer").data("items"),e=0,h=s.length;e<h;e++)w.indexOf(s[e].id)!=-1&&b.push(s[e]);jq("#taskActionViewAdvUsrSrContainer").useradvancedSelector("rewriteItemList",b,[])}}return r>0?(jq("div.noMatches").hide(),l=ASC.CRM.ListTaskView.findIndexOfTaskByID(r),l!=-1&&(o=ASC.CRM.ListTaskView.TaskList[l],jq("#tbxTitle").val(o.title),jq("#tbxDescribe").val(o.description),jq("#taskDeadline").datepicker("setDate",o.deadLine),o.deadLine.getHours()==0&&o.deadLine.getMinutes()==0?(jq("#taskDeadlineHours").val("-1"),jq("#taskDeadlineMinutes").val("-1")):(jq("#taskDeadlineHours").val(o.deadLine.getHours()),jq("#taskDeadlineMinutes").val(o.deadLine.getMinutes())),a=window.taskCategorySelector.getRowByContactID(o.category.id),window.taskCategorySelector.changeContact(a),t(o.contact,o),i(o.contact),jq("#taskAlertInterval").val(o.alertValue),jq("#taskActionPopupOK").html(ASC.CRM.Resources.CRMJSResource.SaveChanges),jq("#addTaskPanel div.containerHeaderBlock td:first").html(ASC.CRM.Resources.CRMJSResource.EditTask)),l):(jq("#taskActionPopupOK").html(ASC.CRM.Resources.CRMJSResource.AddThisTask),jq("#addTaskPanel div.containerHeaderBlock td:first").html(ASC.CRM.Resources.CRMJSResource.AddNewTask),jq("#tbxTitle").val(""),jq("#tbxDescribe").val(""),jq("#taskDeadline").datepicker("setDate",new Date),n(0),jq("#optDeadlineHours_-1").prop("selected",!0),jq("#optDeadlineMinutes_-1").prop("selected",!0),a=window.taskCategorySelector.getRowByContactID(0),window.taskCategorySelector.changeContact(a),t(u,null),i(u),jq("#taskAlertInterval").val("1440"),-1)},changeTime:function(n){jq(n).val()=="-1"&&(jq("#taskDeadlineHours").val("-1"),jq("#taskDeadlineMinutes").val("-1"))}}};jq(document).ready(function(){jq.dropdownToggle({switcherSelector:".noContentBlock .hintCategories",dropdownID:"files_hintCategoriesPanel",fixWinSize:!1})});
typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}}());ASC.CRM.ListContactView=function(){var n=function(n,t){if(ASC.CRM.ListContactView.cookieKey&&ASC.CRM.ListContactView.cookieKey!=""){var u={page:n,countOnPage:t},r="/",i=location.pathname.split("/");i.splice(i.length-1,1);r=i.join("/");jq.cookies.set(ASC.CRM.ListContactView.cookieKey,u,{path:r})}},u=function(){jq("#contactsHeaderMenu .menuActionDelete").removeClass("unlockAction");jq("#contactsHeaderMenu .menuActionAddTag").removeClass("unlockAction");jq("#contactsHeaderMenu .menuActionAddTask").removeClass("unlockAction");jq("#contactsHeaderMenu .menuActionPermissions").removeClass("unlockAction");jq("#contactsHeaderMenu .menuActionSendEmail").removeClass("unlockAction")},t=function(){var t=ASC.CRM.ListContactView.selectedItems.length,n;if(t===0){u();return}var i=!1,r=!1,f=!1;for(n=0;n<t;n++)ASC.CRM.ListContactView.selectedItems[n].canDelete&&(i=!0),ASC.CRM.ListContactView.selectedItems[n].canEdit&&(r=!0),ASC.CRM.ListContactView.selectedItems[n].primaryEmail!=null&&(f=!0);i?jq("#contactsHeaderMenu .menuActionDelete:not('.unlockAction')").addClass("unlockAction"):jq("#contactsHeaderMenu .menuActionDelete.unlockAction").removeClass("unlockAction");r?jq("#contactsHeaderMenu .menuActionAddTag:not(.unlockAction)").addClass("unlockAction"):jq("#contactsHeaderMenu .menuActionAddTag.unlockAction").removeClass("unlockAction");jq("#contactsHeaderMenu .menuActionPermissions:not(.unlockAction)").addClass("unlockAction");jq("#contactsHeaderMenu .menuActionAddTask:not(.unlockAction)").addClass("unlockAction");f?jq("#contactsHeaderMenu .menuActionSendEmail").addClass("unlockAction"):jq("#contactsHeaderMenu .menuActionSendEmail").removeClass("unlockAction")},k=function(t,i){window.contactPageNavigator=new ASC.Controls.PageNavigator.init("contactPageNavigator","#divForContactPager",t,ASC.CRM.Data.VisiblePageCount,i,ASC.CRM.Resources.CRMJSResource.Previous,ASC.CRM.Resources.CRMJSResource.Next);contactPageNavigator.changePageCallback=function(t){n(t,contactPageNavigator.EntryCountOnPage);var i=contactPageNavigator.EntryCountOnPage*(t-1);ASC.CRM.ListContactView.renderContent(i)}},d=function(){jq.dropdownToggle({dropdownID:"contactActionMenu",switcherSelector:"#companyTable .entity-menu",addTop:0,addLeft:10,rightPos:!0,beforeShowFunction:function(n){var t=n.attr("id").split("_")[1];t&&s(parseInt(t))},showFunction:function(n,t){jq("#companyTable .entity-menu.active").removeClass("active");t.is(":hidden")&&n.addClass("active")},hideFunction:function(){jq("#companyTable .entity-menu.active").removeClass("active")}});jq("body").off("contextmenu").on("contextmenu",function(n){var t=jq.fixEvent(n),i,r;return typeof t=="undefined"||!t?!0:(i=jq(t.srcElement||t.target),!i.parents("#companyTable").length)?(jq("#contactActionMenu").hide(),!0):(r=parseInt(i.closest("tr.with-entity-menu").attr("id").split("_")[1]),!r)?!0:(s(r),jq("#companyTable .entity-menu.active").removeClass("active"),jq.showDropDownByContext(t,i,jq("#contactActionMenu")),!1)});if(ASC.VoipNavigationItem&&ASC.VoipNavigationItem.isInit)jq("#companyTable").on("click",".primaryDataContainer .primaryPhone",function(){var n=jq(this).parents("tr:first").attr("id").split("_")[1];f(n)})},f=function(n){try{n&&ASC.VoipNavigationItem.call(n)}catch(t){console.error(t)}},g=function(){var n="";ASC.Resources.Master.HelpLink&&(n=["<div class='headerPanelSmall-splitter'>",String.format(ASC.CRM.Resources.CRMJSResource.VoipSettingsLearnMore,"<a class='link underline' href='"+ASC.Resources.Master.HelpLink+"/guides/use-voip.aspx' target='_blank'>","<\/a>"),"<\/div>",].join(""));jq.tmpl("template-blockUIPanel",{id:"enableVoipSettingsPanel",headerTest:ASC.CRM.Resources.CRMJSResource.VoipSettingsPanelHeader,questionText:"",innerHtmlText:["<div class='headerPanelSmall-splitter'>",ASC.CRM.Resources.CRMJSResource.VoipSettingsPanelText,"<\/div>","<div class='headerPanelSmall-splitter usertext'>",ASC.CRM.Resources.CRMJSResource.VoipSettingsPanelUserText,"<\/div>","<div class='headerPanelSmall-splitter admintext display-none'>",ASC.CRM.Resources.CRMJSResource.VoipSettingsPanelAdminText,"&nbsp;<a class='link underline' href='/Management.aspx?type=9#Twilio'>",ASC.CRM.Resources.CRMJSResource.GoToSettings,"<\/a>","<\/div>",n].join(""),CancelBtn:ASC.CRM.Resources.CRMCommonResource.OK}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first")},nt=function(){PopupKeyUpActionProvider.EnableEsc=!0;jq("#enableVoipSettingsPanel .usertext").toggleClass("display-none",Teamlab.profile.isAdmin);jq("#enableVoipSettingsPanel .admintext").toggleClass("display-none",!Teamlab.profile.isAdmin);StudioBlockUIManager.blockUI("#enableVoipSettingsPanel",500)},tt=function(){ScrolledGroupMenu.init({menuSelector:"#contactsHeaderMenu",menuAnchorSelector:"#mainSelectAll",menuSpacerSelector:"main .filter-content .header-menu-spacer",userFuncInTop:function(){jq("#contactsHeaderMenu .menu-action-on-top").hide()},userFuncNotInTop:function(){jq("#contactsHeaderMenu .menu-action-on-top").show()}});jq("#contactsHeaderMenu").on("click",".menuActionDelete.unlockAction",function(){vt()});jq("#contactsHeaderMenu").on("click",".menuActionSendEmail.unlockAction",function(){ASC.CRM.ListContactView.showSendEmailDialog()});jq("#contactsHeaderMenu").on("click",".menuActionPermissions.unlockAction",function(){lt({isBatch:!0})});jq("#contactsHeaderMenu").on("click",".menuActionAddTask.unlockAction",function(){ASC.CRM.ListContactView.showTaskPanel(ASC.CRM.ListContactView.selectedItems,!1)})},it=function(n){var t;t=n>=ASC.CRM.ListContactView.Total?n+1:ASC.CRM.ListContactView.Total;contactPageNavigator.drawPageNavigator((n/ASC.CRM.ListContactView.entryCountOnPage).toFixed(0)*1+1,t)},rt=function(){jq("#contactsHeaderMenu .menu-action-simple-pagenav").html("");var n=jq("<div><\/div>"),t=0;jq("#divForContactPager .pagerPrevButtonCSSClass").length!=0&&(t++,jq("#divForContactPager .pagerPrevButtonCSSClass").clone().appendTo(n));jq("#divForContactPager .pagerNextButtonCSSClass").length!=0&&(t++,t===2&&jq("<span style='padding: 0 8px;'>&nbsp;<\/span>").clone().appendTo(n),jq("#divForContactPager .pagerNextButtonCSSClass").clone().appendTo(n));n.children().length!=0?(n.appendTo("#contactsHeaderMenu .menu-action-simple-pagenav"),jq("#contactsHeaderMenu .menu-action-simple-pagenav").show()):jq("#contactsHeaderMenu .menu-action-simple-pagenav").hide()},i=function(n){n!=0?(jq("#contactsHeaderMenu .menu-action-checked-count > span").text(jq.format(ASC.CRM.Resources.CRMJSResource.ElementsSelectedCount,n)),jq("#contactsHeaderMenu .menu-action-checked-count").show()):(jq("#contactsHeaderMenu .menu-action-checked-count > span").text(""),jq("#contactsHeaderMenu .menu-action-checked-count").hide())},e=function(){jq("#companyTable tbody tr").remove();jq("#contactsFilterContainer, #contactsHeaderMenu, #mainContactList, #tableForContactNavigation").hide();ASC.CRM.Common.hideExportButtons();jq("#emptyContentForContactsFilter").hide();jq("#contactsEmptyScreen").show()},o=function(){jq("#companyTable tbody tr").remove();jq("#contactsHeaderMenu, #companyListBox, #tableForContactNavigation").hide();jq("#contactsFilterContainer").show();jq("#mainSelectAll").prop("disabled",!0);ASC.CRM.Common.hideExportButtons();jq("#contactsEmptyScreen").hide();jq("#emptyContentForContactsFilter").show()},s=function(n){for(var t=null,i=0,r=ASC.CRM.ListContactView.fullContactList.length;i<r;i++)if(n==ASC.CRM.ListContactView.fullContactList[i].id){t=ASC.CRM.ListContactView.fullContactList[i];break}if(t!=null){jq("#contactActionMenu .addTaskLink").off("click").on("click",function(){jq("#contactActionMenu").hide();jq("#taskActionMenu").hide();jq("#companyTable .entity-menu.active").removeClass("active");ASC.CRM.ListContactView.showTaskPanel(t,!1)});if(jq("#contactActionMenu .addDealLink").attr("href",jq.format("Deals.aspx?action=manage&contactID={0}",n)),jq("#contactActionMenu .addCaseLink").attr("href",jq.format("Cases.aspx?action=manage&contactID={0}",n)),t.primaryEmail!=null&&t.primaryEmail.emailHref!=""?(jq("#contactActionMenu .sendEmailLink").attr("href",t.primaryEmail.emailHref),jq("#contactActionMenu .sendEmailLink").removeClass("display-none")):jq("#contactActionMenu .sendEmailLink").addClass("display-none"),t.primaryPhone!=null&&ASC.Resources.Master.Hub.VoipAllowed){jq("#contactActionMenu .makeVoIPCallLink").removeClass("display-none");jq("#contactActionMenu .makeVoIPCallLink").off("click").on("click",function(){jq("#contactActionMenu").hide();jq("#companyTable .entity-menu.active").removeClass("active");ASC.VoipNavigationItem&&ASC.VoipNavigationItem.isInit?f(t.id):nt()})}else jq("#contactActionMenu .makeVoIPCallLink").addClass("display-none");if(t.canEdit==!0){jq("#contactActionMenu .dropdown-item-seporator").show();jq("#contactActionMenu .addPhoneLink").show();jq("#contactActionMenu .addEmailLink").show();jq("#contactActionMenu .editContactLink").show();t.canDelete?jq("#contactActionMenu .deleteContactLink").show():jq("#contactActionMenu .deleteContactLink").hide();jq("#contactActionMenu .showProfileLink").show();jq("#contactActionMenu .showProfileLinkNewTab").show();jq("#contactActionMenu .addPhoneLink").text(t.primaryPhone!=null?ASC.CRM.Resources.CRMJSResource.EditPhone:ASC.CRM.Resources.CRMJSResource.AddNewPhone);jq("#contactActionMenu .addPhoneLink").off("click").on("click",function(){jq("#contactActionMenu").hide();jq("#companyTable .entity-menu.active").removeClass("active");ut(n,t.primaryPhone)});jq("#contactActionMenu .addEmailLink").text(t.primaryEmail!=null?ASC.CRM.Resources.CRMJSResource.EditEmail:ASC.CRM.Resources.CRMJSResource.AddNewEmail);jq("#contactActionMenu .addEmailLink").off("click").on("click",function(){jq("#contactActionMenu").hide();jq("#companyTable .entity-menu.active").removeClass("active");ft(n,t.primaryEmail)});jq("#contactActionMenu .editContactLink").attr("href",jq.format("Default.aspx?id={0}&action=manage{1}",n,t.isCompany?"":"&type=people"));jq("#contactActionMenu .deleteContactLink").off("click").on("click",function(){jq("#contactActionMenu").hide();jq("#companyTable .entity-menu.active").removeClass("active");ASC.CRM.ListContactView.showConfirmationPanelForDelete(t.displayName,t.id,t.isCompany,!0)});jq("#contactActionMenu .showProfileLink").attr("href",jq.format("Default.aspx?id={0}{1}",n,t.isCompany?"":"&type=people"));jq("#contactActionMenu .showProfileLinkNewTab").off("click").on("click",function(){jq("#contactActionMenu").hide();jq("#companyTable .entity-menu.active").removeClass("active");window.open(jq.format("Default.aspx?id={0}{1}",n,t.isCompany?"":"&type=people"),"_blank")})}else jq("#contactActionMenu .dropdown-item-seporator").hide(),jq("#contactActionMenu .addPhoneLink").hide(),jq("#contactActionMenu .addEmailLink").hide(),jq("#contactActionMenu .editContactLink").hide(),jq("#contactActionMenu .deleteContactLink").hide(),jq("#contactActionMenu .showProfileLink").hide(),jq("#contactActionMenu .showProfileLinkNewTab").hide()}},ut=function(n,t){var i=jq("#addPrimaryPhone_"+n),r,u;i.css("borderColor","");r=jq("#contactItem_"+n).find(".primaryPhone");r.length!=0?(r.remove(),t!=null&&i.val(t.data)):i.val("");i.show().trigger("focus");i.off("blur").on("blur",function(){i.off("blur");var r=i.val().trim();if(r.length==0){if(t==null){i.val("").hide();return}c(n,r,t)}else h(n,r,t)});u=function(r){if(ASC.CRM.ListContactView.isEnterKeyPressed(r)){i.off("keyup");i.off("blur");var u=i.val().trim();if(u.length==0){if(t==null){i.val("").hide();return}c(n,u,t)}else h(n,u,t)}};i.off("keyup").on("keyup",u)},h=function(n,t,i){var r,u;i==null?(r={contactId:n},u={data:t,isPrimary:!0,infoType:"Phone",category:"Work"},Teamlab.addCrmContactInfo(r,n,u,{success:ASC.CRM.ListContactView.CallbackMethods.add_primary_phone,before:function(n){jq("#check_contact_"+n.contactId).hide();jq("#loaderImg_"+n.contactId).show()},after:function(n){jq("#check_contact_"+n.contactId).show();jq("#loaderImg_"+n.contactId).hide()}})):(r={contactId:n},u={id:i.id,data:t,isPrimary:!0,infoType:"Phone"},Teamlab.updateCrmContactInfo(r,n,u,{success:ASC.CRM.ListContactView.CallbackMethods.add_primary_phone,before:function(n){jq("#check_contact_"+n.contactId).hide();jq("#loaderImg_"+n.contactId).show()},after:function(n){jq("#check_contact_"+n.contactId).show();jq("#loaderImg_"+n.contactId).hide()}}))},c=function(n,t,i){var r={contactId:n};Teamlab.deleteCrmContactInfo(r,n,i.id,{success:ASC.CRM.ListContactView.CallbackMethods.delete_primary_phone,before:function(n){jq("#check_contact_"+n.contactId).hide();jq("#loaderImg_"+n.contactId).show()},after:function(n){jq("#check_contact_"+n.contactId).show();jq("#loaderImg_"+n.contactId).hide()}})},ft=function(n,t){var i=jq("#addPrimaryEmail_"+n),r,u;i.css("borderColor","");r=jq("#contactItem_"+n).find(".primaryEmail");r.length!=0?(r.remove(),t!=null&&i.val(t.data)):i.val("");i.show().trigger("focus");i.off("blur").on("blur",function(){var r=i.val().trim();if(r.length==0){if(t==null)return i.off("blur"),i.val("").hide(),!1;i.off("blur");a(n,r,t)}else if(jq.isValidEmail(r))i.off("blur"),l(n,r,t);else return i.css("borderColor","#CC0000"),!1});u=function(r){if(ASC.CRM.ListContactView.isEnterKeyPressed(r)){var u=i.val().trim();if(u.length==0){if(t==null)return i.val("").hide(),!1;i.off("blur");i.off("keyup");a(n,u,t)}else if(jq.isValidEmail(u))i.off("blur"),i.off("keyup"),l(n,u,t);else return i.css("borderColor","#CC0000"),!1}};i.off("keyup").on("keyup",u)},l=function(n,t,i){var r,u;i==null?(r={contactId:n},u={data:t,isPrimary:!0,infoType:"Email",category:"Work"},Teamlab.addCrmContactInfo(r,n,u,{success:ASC.CRM.ListContactView.CallbackMethods.add_primary_email,before:function(n){jq("#check_contact_"+n.contactId).hide();jq("#loaderImg_"+n.contactId).show()},after:function(n){jq("#check_contact_"+n.contactId).show();jq("#loaderImg_"+n.contactId).hide()}})):(r={contactId:n},u={id:i.id,data:t,isPrimary:!0,infoType:"Email"},Teamlab.updateCrmContactInfo(r,n,u,{success:ASC.CRM.ListContactView.CallbackMethods.add_primary_email,before:function(n){jq("#check_contact_"+n.contactId).hide();jq("#loaderImg_"+n.contactId).show()},after:function(n){jq("#check_contact_"+n.contactId).show();jq("#loaderImg_"+n.contactId).hide()}}))},a=function(n,t,i){var r={contactId:n};Teamlab.deleteCrmContactInfo(r,n,i.id,{success:ASC.CRM.ListContactView.CallbackMethods.delete_primary_email,before:function(n){jq("#check_contact_"+n.contactId).hide();jq("#loaderImg_"+n.contactId).show()},after:function(n){jq("#check_contact_"+n.contactId).show();jq("#loaderImg_"+n.contactId).hide()}})},v=function(){var n={sortBy:"displayName",sortOrder:"ascending",tags:[]},t;return ASC.CRM.ListContactView.advansedFilter.advansedFilter==null?n:(t=ASC.CRM.ListContactView.advansedFilter.advansedFilter(),jq(t).each(function(t,i){var r,u,t,f;switch(i.id){case"sorter":n.sortBy=i.params.id;n.sortOrder=i.params.dsc==!0?"descending":"ascending";break;case"text":n.filterValue=i.params.value;break;case"fromToDate":n.fromDate=new Date(i.params.from);n.toDate=new Date(i.params.to);break;default:if(i.hasOwnProperty("apiparamname")&&i.params.hasOwnProperty("value")&&i.params.value!=null)try{for(r=JSON.parse(i.apiparamname),u=JSON.parse(i.params.value),r.length!=u.length&&(n[i.apiparamname]=i.params.value),t=0,f=r.length;t<f;t++)n[r[t]]=u[t]}catch(e){n[i.apiparamname]=i.params.value}}}),n.hasOwnProperty("contactStage")||(n.contactStage="-1"),n.hasOwnProperty("contactType")||(n.contactType="-1"),n)},et=function(n,t){var f=jq.inArray(n.id,t),i,u;for(n.isChecked=f!=-1,n.primaryPhone=null,n.primaryEmail=null,i=0,u=n.commonData.length;i<u;i++)n.commonData[i].isPrimary&&(n.commonData[i].infoType==0&&(n.primaryPhone={data:n.commonData[i].data,id:n.commonData[i].id}),n.commonData[i].infoType==1&&(n.primaryEmail={data:n.commonData[i].data,id:n.commonData[i].id,emailHref:r(n.id)}))},r=function(n){return typeof ASC.CRM.ListContactView.basePathMail=="undefined"&&(ASC.CRM.ListContactView.basePathMail=ASC.CRM.Common.getMailModuleBasePath()),[ASC.CRM.ListContactView.basePathMail,"#composeto/crm=",n].join("")},y=function(n){var t=jq("<a><\/a>").addClass("dropdown-item").text(ASC.CRM.Common.convertText(n.title,!1)).on("click",function(){ct(this)});jq("#addTagDialog ul.dropdown-content").append(jq("<li><\/li>").append(t))},ot=function(){for(var n=0,t=ASC.CRM.Data.contactTags.length;n<t;n++)y(ASC.CRM.Data.contactTags[n]);jq.dropdownToggle({dropdownID:"addTagDialog",switcherSelector:"#contactsHeaderMenu .menuActionAddTag.unlockAction",addTop:5,addLeft:0,showFunction:function(){jq("#addTagDialog input.textEdit").val("")}})},st=function(){jq.tmpl("template-blockUIPanel",{id:"deletePanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:ASC.CRM.Resources.CRMCommonResource.ConfirmationDeleteText,innerHtmlText:['<div id="deleteList" class="containerForListBatchDelete mobile-overflow">',"<dl>",'<dt class="listForBatchDelete confirmRemoveCompanies">',ASC.CRM.Resources.CRMContactResource.Companies,":","<\/dt>",'<dd class="listForBatchDelete confirmRemoveCompanies">',"<\/dd>",'<dt class="listForBatchDelete confirmRemovePersons">',ASC.CRM.Resources.CRMContactResource.Persons,":","<\/dt>",'<dd class="listForBatchDelete confirmRemovePersons">',"<\/dd>","<\/dl>","<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMContactResource.DeletingContacts}).insertAfter("#mainContactList");jq("#deletePanel").on("click",".middle-button-container .button.blue",function(){ASC.CRM.ListContactView.deleteBatchContacts()});jq.tmpl("template-blockUIPanel",{id:"setPermissionsPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.SetPermissions,innerHtmlText:"",OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,OKBtnClass:"setPermissionsLink",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMCommonResource.SaveChangesProggress}).insertAfter("#mainContactList");jq("#permissionsContactsPanelInnerHtml").insertBefore("#setPermissionsPanel .containerBodyBlock .middle-button-container").removeClass("display-none")},ht=function(){jq.tmpl("template-blockUIPanel",{id:"createLinkPanel",headerTest:ASC.CRM.Resources.CRMContactResource.GenerateLinks,questionText:"",innerHtmlText:['<div class="headerPanel-splitter bold clearFix">','<input type="checkbox" id="cbxBlind" style="float:left" />','<label for="cbxBlind" style="float:left;padding: 3px 0 0 4px;">',ASC.CRM.Resources.CRMContactResource.BlindLinkInfoText,"<\/label>","<\/div>",'<div class="describe-text headerPanel-splitter">',ASC.CRM.Resources.CRMContactResource.BatchSizeInfoText,"<\/div>",'<div class="headerPanel-splitter">','<b style="padding-right:5px;">',ASC.CRM.Resources.CRMContactResource.BatchSize,"<\/b>",'<input maxlength="10" class="textEdit" id="tbxBatchSize" style="width:100px;" />',"<\/div>",'<div id="linkList" style="display:none;"><\/div>'].join(""),OKBtn:ASC.CRM.Resources.CRMContactResource.Generate,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMContactResource.Generation}).insertAfter("#mainContactList")},ct=function(n){var t={tagName:jq(n).text(),isNewTag:!1};p(t)},p=function(n){for(var i=[],t=0,r=ASC.CRM.ListContactView.selectedItems.length;t<r;t++)ASC.CRM.ListContactView.selectedItems[t].canEdit&&i.push(ASC.CRM.ListContactView.selectedItems[t].id);n.contactIDs=i;Teamlab.addCrmTag(n,"contact",n.contactIDs,n.tagName,{success:ASC.CRM.ListContactView.CallbackMethods.add_tag,before:function(n){for(var t=0,i=n.contactIDs.length;t<i;t++)jq("#check_contact_"+n.contactIDs[t]).hide(),jq("#loaderImg_"+n.contactIDs[t]).show()},after:function(n){for(var t=0,i=n.contactIDs.length;t<i;t++)jq("#check_contact_"+n.contactIDs[t]).show(),jq("#loaderImg_"+n.contactIDs[t]).hide()}})},lt=function(n){jq("#setPermissionsPanel div.tintMedium").length>0&&(jq("#setPermissionsPanel div.tintMedium span.header-base").remove(),jq("#setPermissionsPanel div.tintMedium").removeClass("tintMedium").css("padding","0px"));jq("#isPrivate").prop("checked",!1);ASC.CRM.PrivatePanel.changeIsPrivateCheckBox();jq("#selectedUsers div.selectedUser[id^=selectedUser_]").remove();SelectedUsers.IDs=[];LoadingBanner.hideLoaderBtn("#setPermissionsPanel");jq("#setPermissionsPanel .setPermissionsLink").off("click").on("click",function(){at(n)});PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#setPermissionsPanel",600)},at=function(n){var r=SelectedUsers.IDs,i,t,u,f;for(r.push(SelectedUsers.CurrentUserID),i=[],t=0,u=ASC.CRM.ListContactView.selectedItems.length;t<u;t++)i.push(ASC.CRM.ListContactView.selectedItems[t].id);f={contactid:i,isPrivate:jq("#isPrivate").is(":checked"),accessList:r};Teamlab.updateCrmContactRights(n,f,{success:ASC.CRM.ListContactView.CallbackMethods.update_contact_rights,before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.SaveChangesProggress;LoadingBanner.showLoaderBtn("#setPermissionsPanel")},after:function(){LoadingBanner.hidewLoaderBtn("#setPermissionsPanel")}})},vt=function(){var r=!1,u=!1,t,f,n,i;for(jq("#deleteList dd.confirmRemoveCompanies, #deleteList dd.confirmRemovePersons").html(""),t=0,f=ASC.CRM.ListContactView.selectedItems.length;t<f;t++)(n=ASC.CRM.ListContactView.selectedItems[t],n.canDelete==!0)&&(n.isCompany?(r=!0,i=jq("<label><\/label>").attr("title",n.displayName).text(n.displayName),jq("#deleteList dd.confirmRemoveCompanies").append(i.prepend(jq("<input>").attr("type","checkbox").prop("checked",!0).attr("id","company_"+n.id)))):(u=!0,i=jq("<label><\/label>").attr("title",n.displayName).text(n.displayName),jq("#deleteList dd.confirmRemovePersons").append(i.prepend(jq("<input>").attr("type","checkbox").prop("checked",!0).attr("id","person_"+n.id)))));r?jq("#deleteList dt.confirmRemoveCompanies, #deleteList dd.confirmRemoveCompanies").show():jq("#deleteList dt.confirmRemoveCompanies, #deleteList dd.confirmRemoveCompanies").hide();u?jq("#deleteList dt.confirmRemovePersons, #deleteList dd.confirmRemovePersons").show():jq("#deleteList dt.confirmRemovePersons, #deleteList dd.confirmRemovePersons").hide();LoadingBanner.hideLoaderBtn("#deletePanel");PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#deletePanel",500)},w=function(n){return{id:n.id,isCompany:n.isCompany,primaryEmail:n.primaryEmail,displayName:n.displayName,smallFotoUrl:n.smallFotoUrl,canEdit:n.canEdit,canDelete:n.canDelete}},yt=function(){jq.dropdownToggle({dropdownID:"simpleContactActionMenu",switcherSelector:"#contactTable .entity-menu",addTop:0,addLeft:10,rightPos:!0,beforeShowFunction:function(n){var t=n.attr("id").split("_")[1];t&&pt(t,n.attr("data-displayName"),n.attr("data-email"))},showFunction:function(n,t){jq("#contactTable .entity-menu.active").removeClass("active");t.is(":hidden")&&n.addClass("active")},hideFunction:function(){jq("#contactTable .entity-menu.active").removeClass("active")}})},pt=function(n,t,i){jq("#simpleContactActionMenu .unlinkContact").off("click").on("click",function(){ASC.CRM.ListContactView.removeMember(n)});if(typeof ASC.CRM.ListContactView.basePathMail=="undefined"&&(ASC.CRM.ListContactView.basePathMail=ASC.CRM.Common.getMailModuleBasePath()),i!=""){var r=[ASC.CRM.ListContactView.basePathMail,"#composeto/crm=",n].join(""),u=[ASC.CRM.ListContactView.basePathMail,"#inbox/","from=",i,"/sortorder=descending/"].join("");jq("#simpleContactActionMenu .writeEmail").attr("href",r);jq("#simpleContactActionMenu .viewMailingHistory").attr("href",u).removeClass("display-none")}else jq("#simpleContactActionMenu .writeEmail").addClass("display-none"),jq("#simpleContactActionMenu .viewMailingHistory").addClass("display-none")},b=function(n){var i,t,r;if(typeof n.contact=="object"&&n.contact!=null){for(i=null,t=0,r=ASC.CRM.ListContactView.fullContactList.length;t<r;t++)if(n.contact.id==ASC.CRM.ListContactView.fullContactList[t].id){i=ASC.CRM.ListContactView.fullContactList[t];break}if(i!=null){for(i.nearTask=n,t=0,r=ASC.CRM.ListContactView.selectedItems.length;t<r;t++)if(ASC.CRM.ListContactView.selectedItems[t].id==i.id){i.isChecked=!0;break}jq("#contactItem_"+n.contact.id).replaceWith(jq.tmpl("contactTmpl",i));ASC.CRM.Common.tooltip("#taskTitle_"+n.id,"tooltip",!0)}}},wt=function(n){jq("#mainSelectAll").prop("checked",!1);ASC.CRM.ListContactView.selectAll(jq("#mainSelectAll"));jq("#tableForContactNavigation select").val(n).on("change",function(){ASC.CRM.ListContactView.changeCountOfRows(this.value)}).tlCombobox()},bt=function(){var n=["<a class='link dotline plus' href='Default.aspx?action=manage'>",ASC.CRM.Resources.CRMContactResource.CreateFirstCompany,"<\/a><br/>","<a class='link dotline plus' href='Default.aspx?action=manage&type=people'>",ASC.CRM.Resources.CRMContactResource.CreateFirstPerson,"<\/a>"].join("");jq.browser.mobile!==!0&&(n+=["<br/><a class='crm-importLink link' href='Default.aspx?action=import'>",ASC.CRM.Resources.CRMContactResource.ImportContacts,"<\/a>"].join(""));jq.tmpl("template-emptyScreen",{ID:"contactsEmptyScreen",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_persons,Header:ASC.CRM.Resources.CRMContactResource.EmptyContactListHeader,Describe:jq.format(ASC.CRM.Resources.CRMContactResource.EmptyContactListDescription,"<span class='hintTypes baseLinkAction' >","<\/span>","<span class='hintCsv baseLinkAction' >","<\/span>"),ButtonHTML:n}).insertAfter("#mainContactList");jq.tmpl("template-emptyScreen",{ID:"emptyContentForContactsFilter",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_filter,Header:ASC.CRM.Resources.CRMContactResource.EmptyContactListFilterHeader,Describe:ASC.CRM.Resources.CRMContactResource.EmptyContactListFilterDescribe,ButtonHTML:["<a class='clearFilterButton link dotline' href='javascript:void(0);' ","onclick='ASC.CRM.ListContactView.advansedFilter.advansedFilter(null);'>",ASC.CRM.Resources.CRMCommonResource.ClearFilter,"<\/a>"].join("")}).insertAfter("#mainContactList")},kt=function(){if(jq("#contactsAdvansedFilter").advansedFilter){var i=new Date,e=new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0,0),h=new Date(new Date(e).setDate(i.getDate()-1)),o=new Date(new Date(e).setDate(1)),s=new Date(new Date(o).setDate(o.getDate()-1)),c=new Date(new Date(s).setDate(1)),n=Teamlab.serializeTimestamp(e),t=Teamlab.serializeTimestamp(h),r=Teamlab.serializeTimestamp(o),u=Teamlab.serializeTimestamp(c),f=Teamlab.serializeTimestamp(s);ASC.CRM.ListContactView.advansedFilter=jq("#contactsAdvansedFilter").advansedFilter({anykey:!1,hintDefaultDisable:!1,maxfilters:-1,colcount:2,maxlength:"100",store:!0,inhash:!0,filters:[{type:"person",id:"my",apiparamname:"responsibleid",title:ASC.CRM.Resources.CRMCommonResource.My,filtertitle:ASC.CRM.Resources.CRMContactResource.FilterByContactManager,group:ASC.CRM.Resources.CRMContactResource.ByContactManager,groupby:"responsible",enable:!0,bydefault:{id:Teamlab.profile.id,value:Teamlab.profile.id}},{type:"flag",id:"noresponsible",apiparamname:"responsibleid",title:ASC.CRM.Resources.CRMContactResource.WithoutContactManager,group:ASC.CRM.Resources.CRMContactResource.ByContactManager,groupby:"responsible",defaultparams:{value:"00000000-0000-0000-0000-000000000000"}},{type:"person",id:"responsibleID",apiparamname:"responsibleid",title:ASC.CRM.Resources.CRMCommonResource.Custom,filtertitle:ASC.CRM.Resources.CRMContactResource.FilterByContactManager,group:ASC.CRM.Resources.CRMContactResource.ByContactManager,groupby:"responsible",enable:!0},{type:"combobox",id:"lastMonth",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.LastMonth,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,groupby:"byDate",options:[{value:jq.toJSON([u,f]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth,def:!0},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([r,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"yesterday",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.Yesterday,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,groupby:"byDate",options:[{value:jq.toJSON([u,f]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday,def:!0},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([r,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"today",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.Today,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,groupby:"byDate",options:[{value:jq.toJSON([u,f]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today,def:!0},{value:jq.toJSON([r,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"thisMonth",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.ThisMonth,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,groupby:"byDate",options:[{value:jq.toJSON([u,f]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([r,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth,def:!0}]},{type:"daterange",id:"fromToDate",title:ASC.CRM.Resources.CRMCommonResource.Custom,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByCreationDate,groupby:"byDate"},{type:"combobox",id:"restricted",apiparamname:"isShared",title:ASC.CRM.Resources.CRMContactResource.PublicContacts,filtertitle:ASC.CRM.Resources.CRMContactResource.FilterByAccessibility,group:ASC.CRM.Resources.CRMContactResource.FilterByAccessibility,groupby:"accessibility",options:[{value:!0,classname:"",title:ASC.CRM.Resources.CRMContactResource.PublicContacts,def:!0},{value:!1,classname:"",title:ASC.CRM.Resources.CRMContactResource.RestrictedContacts}]},{type:"combobox",id:"shared",apiparamname:"isShared",title:ASC.CRM.Resources.CRMContactResource.RestrictedContacts,filtertitle:ASC.CRM.Resources.CRMContactResource.FilterByAccessibility,group:ASC.CRM.Resources.CRMContactResource.FilterByAccessibility,groupby:"accessibility",options:[{value:!0,classname:"",title:ASC.CRM.Resources.CRMContactResource.PublicContacts},{value:!1,classname:"",title:ASC.CRM.Resources.CRMContactResource.RestrictedContacts,def:!0}]},{type:"combobox",id:"company",apiparamname:"contactListView",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_Company,filtertitle:ASC.CRM.Resources.CRMCommonResource.Show,group:ASC.CRM.Resources.CRMCommonResource.Show,groupby:"type",options:[{value:"company",classname:"",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_Company,def:!0},{value:"person",classname:"",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_Person},{value:"withopportunity",classname:"",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_WithOpportunity}]},{type:"combobox",id:"person",apiparamname:"contactListView",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_Person,filtertitle:ASC.CRM.Resources.CRMCommonResource.Show,group:ASC.CRM.Resources.CRMCommonResource.Show,groupby:"type",options:[{value:"company",classname:"",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_Company},{value:"person",classname:"",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_Person,def:!0},{value:"withopportunity",classname:"",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_WithOpportunity}]},{type:"combobox",id:"withopportunity",apiparamname:"contactListView",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_WithOpportunity,filtertitle:ASC.CRM.Resources.CRMCommonResource.Show,group:ASC.CRM.Resources.CRMCommonResource.Show,groupby:"type",options:[{value:"company",classname:"",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_Company},{value:"person",classname:"",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_Person},{value:"withopportunity",classname:"",title:ASC.CRM.Resources.CRMEnumResource.ContactListViewType_WithOpportunity,def:!0}]},{type:"combobox",id:"contactStage",apiparamname:"contactStage",title:ASC.CRM.Resources.CRMContactResource.AfterStage,group:ASC.CRM.Resources.CRMCommonResource.Other,options:ASC.CRM.Data.contactStages,defaulttitle:ASC.CRM.Resources.CRMCommonResource.Choose,enable:ASC.CRM.Data.contactStages.length>0},{type:"combobox",id:"contactType",apiparamname:"contactType",title:ASC.CRM.Resources.CRMContactResource.ContactType,group:ASC.CRM.Resources.CRMCommonResource.Other,options:ASC.CRM.Data.contactTypes,defaulttitle:ASC.CRM.Resources.CRMCommonResource.Choose,enable:ASC.CRM.Data.contactTypes.length>0},{type:"combobox",id:"tags",apiparamname:"tags",title:ASC.CRM.Resources.CRMCommonResource.FilterWithTag,group:ASC.CRM.Resources.CRMCommonResource.Other,options:ASC.CRM.Data.contactTags,defaulttitle:ASC.CRM.Resources.CRMCommonResource.Choose,multiple:!0,enable:ASC.CRM.Data.contactTags.length>0}],sorters:[{id:"displayname",title:ASC.CRM.Resources.CRMCommonResource.Title,dsc:!1,visible:!0},{id:"firstname",title:ASC.CRM.Resources.CRMContactResource.FirstName,dsc:!1,visible:!0},{id:"lastname",title:ASC.CRM.Resources.CRMContactResource.LastName,dsc:!1,visible:!0},{id:"contacttype",title:ASC.CRM.Resources.CRMContactResource.AfterStage,dsc:!1},{id:"created",title:ASC.CRM.Resources.CRMCommonResource.CreateDate,dsc:!0,def:!0},{id:"history",title:ASC.CRM.Resources.CRMCommonResource.History,dsc:!0,def:!1}]}).on("setfilter",ASC.CRM.ListContactView.changeFilter).on("resetfilter",ASC.CRM.ListContactView.changeFilter)}};return{CallbackMethods:{get_contacts_by_filter:function(t,i){var r,h,s,u,f;if(ASC.CRM.ListContactView.Total=t.__total||0,r=t.__startIndex||0,ASC.CRM.ListContactView.Total===0&&typeof ASC.CRM.ListContactView.advansedFilter!="undefined"&&ASC.CRM.ListContactView.advansedFilter.advansedFilter().length==1?(ASC.CRM.ListContactView.noContacts=!0,ASC.CRM.ListContactView.noContactsForQuery=!0):(ASC.CRM.ListContactView.noContacts=!1,ASC.CRM.ListContactView.noContactsForQuery=ASC.CRM.ListContactView.Total===0?!0:!1),ASC.CRM.ListContactView.noContacts)return e(),ASC.CRM.ListContactView.isFirstLoad?ASC.CRM.ListContactView.hideFirstLoader():LoadingBanner.hideLoading(),!1;if(ASC.CRM.ListContactView.noContactsForQuery)return o(),ASC.CRM.ListContactView.isFirstLoad?ASC.CRM.ListContactView.hideFirstLoader():LoadingBanner.hideLoading(),!1;if(i.length==0){for(jq("#contactsEmptyScreen").hide(),jq("#emptyContentForContactsFilter").hide(),jq("#contactsHeaderMenu").show(),jq("#companyListBox").show(),jq("#companyTable tbody tr").remove(),jq("#tableForContactNavigation").show(),jq("#mainSelectAll").prop("disabled",!0),ASC.CRM.ListContactView.Total=parseInt(jq("#totalContactsOnPage").text())||0,r=ASC.CRM.ListContactView.entryCountOnPage*(contactPageNavigator.CurrentPageNumber-1);r>=ASC.CRM.ListContactView.Total&&r>=ASC.CRM.ListContactView.entryCountOnPage;)r-=ASC.CRM.ListContactView.entryCountOnPage;return h=(r-r%ASC.CRM.ListContactView.entryCountOnPage)/ASC.CRM.ListContactView.entryCountOnPage+1,n(h,ASC.CRM.ListContactView.entryCountOnPage),ASC.CRM.ListContactView.renderContent(r),!1}for(it(r),rt(),jq("#totalContactsOnPage").text(ASC.CRM.ListContactView.Total),jq("#emptyContentForContactsFilter").hide(),jq("#contactsHeaderMenu, #companyListBox, #tableForContactNavigation").show(),jq("#contactsEmptyScreen").hide(),jq("#companyListBox").show(),jq("#mainSelectAll").prop("disabled",!1),ASC.CRM.Common.showExportButtons(),s=[],u=0,f=ASC.CRM.ListContactView.selectedItems.length;u<f;u++)s.push(ASC.CRM.ListContactView.selectedItems[u].id);for(u=0,f=i.length;u<f;u++)et(i[u],s),ASC.CRM.ListContactView.fullContactList.push(i[u]);jq("#companyTable tbody").replaceWith(jq.tmpl("contactListTmpl",{contacts:i}));ASC.CRM.ListContactView.checkFullSelection();ASC.CRM.Common.RegisterContactInfoCard();ASC.CRM.Common.tooltip(".nearestTask","tooltip",!0);window.scrollTo(0,0);ScrolledGroupMenu.fixContentHeaderWidth(jq("#contactsHeaderMenu"));ASC.CRM.ListContactView.isFirstLoad?ASC.CRM.ListContactView.hideFirstLoader():LoadingBanner.hideLoading()},add_primary_phone:function(n,t){var r,i,u;for(jq("#addPrimaryPhone_"+n.contactId).hide(),r="primaryPhone"+(ASC.VoipNavigationItem&&ASC.VoipNavigationItem.isInit?" link":""),jq("<span><\/span>").attr("title",t.data).attr("class",r).text(t.data).appendTo(jq("#addPrimaryPhone_"+n.contactId).parent()),i=0,u=ASC.CRM.ListContactView.fullContactList.length;i<u;i++)ASC.CRM.ListContactView.fullContactList[i].id==n.contactId&&(ASC.CRM.ListContactView.fullContactList[i].primaryPhone={data:t.data,id:t.id})},delete_primary_phone:function(n){jq("#addPrimaryPhone_"+n.contactId).val("").hide();for(var t=0,i=ASC.CRM.ListContactView.fullContactList.length;t<i;t++)ASC.CRM.ListContactView.fullContactList[t].id==n.contactId&&(ASC.CRM.ListContactView.fullContactList[t].primaryPhone=null)},add_primary_email:function(n,i){var u,f;for(jq("#addPrimaryEmail_"+n.contactId).hide(),jq("<a><\/a>").attr("title",i.data).attr("class","primaryEmail linkMedium").text(i.data).attr("href","mailto:"+i.data).appendTo(jq("#addPrimaryEmail_"+n.contactId).parent()),jq("#addPrimaryEmailMenu").hide(),u=0,f=ASC.CRM.ListContactView.fullContactList.length;u<f;u++)ASC.CRM.ListContactView.fullContactList[u].id==n.contactId&&(ASC.CRM.ListContactView.fullContactList[u].primaryEmail={data:i.data,id:i.id,emailHref:r(n.contactId)});if(jq("#contactItem_"+n.contactId).hasClass("selected"))for(u=0,f=ASC.CRM.ListContactView.selectedItems.length;u<f;u++)ASC.CRM.ListContactView.selectedItems[u].id==n.contactId&&(ASC.CRM.ListContactView.selectedItems[u].primaryEmail={data:i.data,id:i.id,emailHref:r(n.contactId)});t()},delete_primary_email:function(n){var i,r;for(jq("#addPrimaryEmail_"+n.contactId).val("").hide(),i=0,r=ASC.CRM.ListContactView.fullContactList.length;i<r;i++)ASC.CRM.ListContactView.fullContactList[i].id==n.contactId&&(ASC.CRM.ListContactView.fullContactList[i].primaryEmail=null);if(jq("#contactItem_"+n.contactId).hasClass("selected"))for(i=0,r=ASC.CRM.ListContactView.selectedItems.length;i<r;i++)ASC.CRM.ListContactView.selectedItems[i].id==n.contactId&&(ASC.CRM.ListContactView.selectedItems[i].primaryEmail=null);t()},delete_batch_contacts:function(n){for(var c,f,v,s,y,p,l,h,u,a=[],r=0,w=ASC.CRM.ListContactView.fullContactList.length;r<w;r++){for(c=!1,f=0,v=n.contactIDsForDelete.length;f<v;f++)if(n.contactIDsForDelete[f]==ASC.CRM.ListContactView.fullContactList[r].id){c=!0;break}c||a.push(ASC.CRM.ListContactView.fullContactList[r])}for(ASC.CRM.ListContactView.fullContactList=a,ASC.CRM.ListContactView.Total-=n.contactIDsForDelete.length,jq("#totalContactsOnPage").text(ASC.CRM.ListContactView.Total),s=[],r=0,y=ASC.CRM.ListContactView.selectedItems.length;r<y;r++)s.push(ASC.CRM.ListContactView.selectedItems[r].id);for(r=0,p=n.contactIDsForDelete.length;r<p;r++)l=jq("#contactItem_"+n.contactIDsForDelete[r]),l.length!=0&&l.remove(),h=jq.inArray(n.contactIDsForDelete[r],s),h!=-1&&(s.splice(h,1),ASC.CRM.ListContactView.selectedItems.splice(h,1));if(jq("#mainSelectAll").prop("checked",!1),t(),i(ASC.CRM.ListContactView.selectedItems.length),ASC.CRM.ListContactView.Total==0&&(typeof ASC.CRM.ListContactView.advansedFilter=="undefined"||ASC.CRM.ListContactView.advansedFilter.advansedFilter().length==1)?(ASC.CRM.ListContactView.noContacts=!0,ASC.CRM.ListContactView.noContactsForQuery=!0):(ASC.CRM.ListContactView.noContacts=!1,ASC.CRM.ListContactView.noContactsForQuery=ASC.CRM.ListContactView.Total===0?!0:!1),PopupKeyUpActionProvider.EnableEsc=!0,ASC.CRM.ListContactView.noContacts){e();jq.unblockUI();return}if(ASC.CRM.ListContactView.noContactsForQuery){o();jq.unblockUI();return}if(jq("#companyTable tbody tr").length==0){for(jq.unblockUI(),u=ASC.CRM.ListContactView.entryCountOnPage*(contactPageNavigator.CurrentPageNumber-1);u>=ASC.CRM.ListContactView.Total&&u>=ASC.CRM.ListContactView.entryCountOnPage;)u-=ASC.CRM.ListContactView.entryCountOnPage;ASC.CRM.ListContactView.renderContent(u)}else jq.unblockUI()},add_tag:function(n){if(jq("#addTagDialog").hide(),n.isNewTag){var t={value:n.tagName,title:n.tagName};ASC.CRM.Data.contactTags.push(t);y(t);ASC.CRM.ListContactView.advansedFilter.advansedfilter({nonetrigger:!0,sorters:[],filters:[{id:"tags",type:"combobox",options:ASC.CRM.Data.contactTags,enable:ASC.CRM.Data.contactTags.length>0}]})}},add_new_task:function(n,t){if(Array.isArray(t))for(var i=0,r=t.length;i<r;i++)ASC.CRM.UpdateCRMCaldavCalendar(t[i],0),b(t[i]);else ASC.CRM.UpdateCRMCaldavCalendar(t,0),b(t);ASC.CRM.Common.RegisterContactInfoCard();PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()},render_simple_content:function(n,t){for(var i=0,r=t.length;i<r;i++)ASC.CRM.Common.contactItemFactory(t[i],n);jq(window).trigger("getContactsFromApi",[t]);jq.tmpl("simpleContactTmpl",t).prependTo("#contactTable tbody");typeof n!="undefined"&&n!=null&&n.hasOwnProperty("showActionMenu")&&n.showActionMenu===!0&&(jq.tmpl("simpleContactActionMenuTmpl",null).insertAfter("#contactTable"),yt());jq(window).trigger("renderSimpleContactListReady",n,t);ASC.CRM.Common.RegisterContactInfoCard();LoadingBanner.hideLoading()},removeMember:function(n){jq("#contactItem_"+n.contactID).remove()},addMember:function(n,t){ASC.CRM.Common.contactItemFactory(t,n);jq.tmpl("simpleContactTmpl",t).prependTo("#contactTable tbody");ASC.CRM.Common.RegisterContactInfoCard()},update_contact_rights:function(n,t){for(var i,e,u,r=0,f=t.length;r<f;r++)for(i=0,e=ASC.CRM.ListContactView.fullContactList.length;i<e;i++)if(t[r].id==ASC.CRM.ListContactView.fullContactList[i].id){u=t[r].id;ASC.CRM.ListContactView.fullContactList[i].isPrivate=t[r].isPrivate;jq("#contactItem_"+u).replaceWith(jq.tmpl("contactTmpl",ASC.CRM.ListContactView.fullContactList[i]));n.isBatch?jq("#check_contact_"+u).prop("checked",!0):ASC.CRM.ListContactView.selectedItems=[];ASC.CRM.ListContactView.fullContactList[i].nearTask&&ASC.CRM.ListContactView.fullContactList[i].nearTask!=null&&ASC.CRM.Common.tooltip("#taskTitle_"+ASC.CRM.ListContactView.fullContactList[i].nearTask.id,"tooltip",!0);break}ASC.CRM.Common.RegisterContactInfoCard();PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()}},fullContactList:[],selectedItems:[],entryCountOnPage:0,defaultCurrentPageNumber:0,emailQuotas:0,noContacts:!1,noContactsForQuery:!1,cookieKey:"",isFirstLoad:!0,clear:function(){ASC.CRM.ListContactView.fullContactList=[];ASC.CRM.ListContactView.selectedItems=[];ASC.CRM.ListContactView.entryCountOnPage=0;ASC.CRM.ListContactView.defaultCurrentPageNumber=0;ASC.CRM.ListContactView.emailQuotas=0;ASC.CRM.ListContactView.noContacts=!1;ASC.CRM.ListContactView.noContactsForQuery=!1;ASC.CRM.ListContactView.cookieKey=""},init:function(t,i,r){var s,o;if(jq(t).length!=0){ASC.CRM.Common.setDocumentTitle(ASC.CRM.Resources.CRMContactResource.AllContacts);ASC.CRM.ListContactView.clear();jq(t).removeClass("display-none");jq.tmpl("contactsListFilterTmpl",{IsCRMAdmin:ASC.CRM.Data.IsCRMAdmin}).appendTo(i);jq.tmpl("contactsListBaseTmpl",{IsCRMAdmin:ASC.CRM.Data.IsCRMAdmin}).appendTo(t);jq.tmpl("contactsListPagingTmpl").appendTo(r);jq("#privatePanelWrapper").appendTo("#permissionsPanelInnerHtml");ASC.CRM.ListContactView.emailQuotas=ASC.CRM.Data.mailQuotas;ASC.CRM.ListContactView.cookieKey=ASC.CRM.Data.CookieKeyForPagination.contacts;ASC.CRM.ListContactView.needToSendApi=!0;ASC.CRM.ListContactView.advansedFilter=null;var f={page:1,countOnPage:jq("#tableForContactNavigation select:first>option:first").val()},e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+location.pathname+location.search,u=location.hash,h=encodeURIComponent(e.charAt(e.length-1)==="/"?e+"Default.aspx":e);u=u&&typeof u=="string"&&u.charAt(0)==="#"?u.substring(1):u;s=jq.cookies.get(h);u==""||s==u?(o=ASC.CRM.Common.getPagingParamsFromCookie(ASC.CRM.ListContactView.cookieKey),o!=null&&(f=o)):n(f.page,f.countOnPage);ASC.CRM.ListContactView.entryCountOnPage=f.countOnPage;ASC.CRM.ListContactView.defaultCurrentPageNumber=f.page;wt(ASC.CRM.ListContactView.entryCountOnPage);ASC.CRM.ListContactView.isFirstLoad=!0;jq(".containerBodyBlock").children(".loader-page").show();bt();k(ASC.CRM.ListContactView.entryCountOnPage,ASC.CRM.ListContactView.defaultCurrentPageNumber);d();ot();jq("#menuCreateNewTask").on("click",function(){ASC.CRM.ListContactView.showTaskPanel(null,!0)});ASC.CRM.ListContactView.initConfirmationPanelForDelete();g();st();ASC.CRM.Data.IsCRMAdmin===!0&&ht();tt();jq(document).on("click",function(n){jq.dropdownToggle().registerAutoHide(n,"#contactsHeaderMenu .menuActionAddTag","#addTagDialog");jq.dropdownToggle().registerAutoHide(n,"#contactsHeaderMenu .menuActionSendEmail","#sendEmailDialog");jq.dropdownToggle().registerAutoHide(n,"#companyTable .with-entity-menu","#contactActionMenu",function(){jq("#companyTable .entity-menu.active").removeClass("active")})});kt();ASC.CRM.PartialExport.init(ASC.CRM.ListContactView.advansedFilter,"contact")}},onContextMenu:function(n){return n.preventDefault(),!1},isEnterKeyPressed:function(n){return n.keyCode==13},filterSortersCorrection:function(){var n=v(),i,t;n.hasOwnProperty("contactListView")&&n.contactListView==="person"?(i=!0,t=n.sortOrder=="descending",n.sortBy=="created"&&(i=t),n.sortBy=="displayname"&&(n.sortBy="created"),ASC.CRM.ListContactView.advansedFilter.advansedfilter({nonetrigger:!0,filters:[],sorters:[{id:"displayname",visible:!1,selected:!1},{id:"firstname",visible:!0,selected:n.sortBy==="firstname",dsc:n.sortBy==="firstname"?t:!1},{id:"lastname",visible:!0,selected:n.sortBy==="lastname",dsc:n.sortBy==="lastname"?t:!1},{id:"contacttype",selected:n.sortBy==="contacttype",dsc:n.sortBy==="contacttype"?t:!1},{id:"created",selected:n.sortBy==="created",dsc:i},{id:"history",selected:n.sortBy==="history",dsc:n.sortBy==="history"?t:!1}]})):(i=!0,t=n.sortOrder=="descending",n.sortBy=="created"&&(i=t),(n.sortBy=="firstname"||n.sortBy=="lastname")&&(n.sortBy="created"),ASC.CRM.ListContactView.advansedFilter.advansedfilter({nonetrigger:!0,filters:[],sorters:[{id:"displayname",visible:!0,selected:n.sortBy==="displayname",dsc:n.sortBy==="displayname"?t:!1},{id:"firstname",visible:!1,selected:!1},{id:"lastname",visible:!1,selected:!1},{id:"contacttype",selected:n.sortBy==="contacttype",dsc:n.sortBy==="contacttype"?t:!1},{id:"created",selected:n.sortBy==="created",dsc:i},{id:"history",selected:n.sortBy==="history",dsc:n.sortBy==="history"?t:!1}]}))},changeFilter:function(){var i,t;ASC.CRM.ListContactView.needToSendApi=!0;i=0;ASC.CRM.ListContactView.defaultCurrentPageNumber!=0?(n(ASC.CRM.ListContactView.defaultCurrentPageNumber,window.contactPageNavigator.EntryCountOnPage),i=(ASC.CRM.ListContactView.defaultCurrentPageNumber-1)*window.contactPageNavigator.EntryCountOnPage,ASC.CRM.ListContactView.defaultCurrentPageNumber=0):n(0,window.contactPageNavigator.EntryCountOnPage);ASC.CRM.ListContactView.advansedFilter.one("adv-ready",function(){ASC.CRM.ListContactView.needToSendApi===!0&&(ASC.CRM.ListContactView.needToSendApi=!1,ASC.CRM.ListContactView.deselectAll(),ASC.CRM.ListContactView.renderContent(i))});t=typeof arguments[2]=="object"?arguments[2]:null;t!=null&&t.hasOwnProperty("id")&&(t.id=="sorter"||t.id=="text")&&(ASC.CRM.ListContactView.needToSendApi=!1,ASC.CRM.ListContactView.deselectAll(),ASC.CRM.ListContactView.renderContent(i));ASC.CRM.ListContactView.filterSortersCorrection()},renderContent:function(n){ASC.CRM.ListContactView.fullContactList=[];ASC.CRM.ListContactView.isFirstLoad||(LoadingBanner.displayLoading(),jq("#contactsFilterContainer").show(),jq("#emptyContentForContactsFilter").is(":visible")||jq("#contactsHeaderMenu, #tableForContactNavigation").show(),jq("#contactsAdvansedFilter").advansedFilter("resize"));jq("#mainSelectAll").prop("checked",!1);ASC.CRM.ListContactView.getContacts(n)},hideFirstLoader:function(){ASC.CRM.ListContactView.isFirstLoad=!1;jq(".containerBodyBlock").children(".loader-page").hide();jq("#contactsEmptyScreen").is(":visible")||(jq("#contactsFilterContainer").show(),jq("#emptyContentForContactsFilter").is(":visible")||jq("#contactsHeaderMenu, #tableForContactNavigation").show(),jq("#contactsAdvansedFilter").advansedFilter("resize"))},addRecordsToContent:function(){if(!ASC.CRM.ListContactView.showMore)return!1;jq("#showMoreContactsButtons .crm-showMoreLink").hide();jq("#showMoreContactsButtons .loading-link").show();var n=jq("#companyTable tbody tr").length;ASC.CRM.ListContactView.getContacts(n)},getContacts:function(n){var t=v();t.StartIndex=typeof n=="undefined"?0:n;t.Count=ASC.CRM.ListContactView.entryCountOnPage;Teamlab.getCrmSimpleContacts({},{filter:t,success:ASC.CRM.ListContactView.CallbackMethods.get_contacts_by_filter})},changeCountOfRows:function(t){if(!isNaN(t)){var i=t*1;ASC.CRM.ListContactView.entryCountOnPage=i;contactPageNavigator.EntryCountOnPage=i;n(1,i);ASC.CRM.ListContactView.renderContent(0)}},selectAll:function(n){for(var r,f,s=jq(n).is(":checked"),e=[],u=0,o=ASC.CRM.ListContactView.selectedItems.length;u<o;u++)e.push(ASC.CRM.ListContactView.selectedItems[u].id);for(u=0,o=ASC.CRM.ListContactView.fullContactList.length;u<o;u++)r=ASC.CRM.ListContactView.fullContactList[u],f=jq.inArray(r.id,e),s&&f==-1&&(ASC.CRM.ListContactView.selectedItems.push(w(r)),e.push(r.id),jq("#contactItem_"+r.id).addClass("selected"),jq("#check_contact_"+r.id).prop("checked",!0)),s||f==-1||(ASC.CRM.ListContactView.selectedItems.splice(f,1),e.splice(f,1),jq("#contactItem_"+r.id).removeClass("selected"),jq("#check_contact_"+r.id).prop("checked",!1));i(ASC.CRM.ListContactView.selectedItems.length);t()},selectItem:function(n){for(var u=parseInt(jq(n).attr("id").split("_")[2]),o=[],f=0,s=null,r=0,e=ASC.CRM.ListContactView.fullContactList.length;r<e;r++)u==ASC.CRM.ListContactView.fullContactList[r].id&&(s=w(ASC.CRM.ListContactView.fullContactList[r]));for(r=0,e=ASC.CRM.ListContactView.selectedItems.length;r<e;r++)o.push(ASC.CRM.ListContactView.selectedItems[r].id);f=jq.inArray(u,o);jq(n).is(":checked")?(jq("#contactItem_"+u).addClass("selected"),f==-1&&ASC.CRM.ListContactView.selectedItems.push(s),ASC.CRM.ListContactView.checkFullSelection()):(jq("#mainSelectAll").prop("checked",!1),jq("#contactItem_"+u).removeClass("selected"),f!=-1&&ASC.CRM.ListContactView.selectedItems.splice(f,1));i(ASC.CRM.ListContactView.selectedItems.length);t()},deselectAll:function(){ASC.CRM.ListContactView.selectedItems=[];jq("#companyTable input:checkbox").prop("checked",!1);jq("#mainSelectAll").prop("checked",!1);jq("#companyTable tr.selected").removeClass("selected");i(0);u()},checkFullSelection:function(){var n=jq("#companyTable tbody tr").length,t=jq("#companyTable input[id^=check_contact_]:checked").length;jq("#mainSelectAll").prop("checked",n==t)},deleteBatchContacts:function(){var n=[],t;jq("#deletePanel input:checked").each(function(){n.push(parseInt(jq(this).attr("id").split("_")[1]))});t={contactIDsForDelete:n};Teamlab.removeCrmContact(t,n,{success:ASC.CRM.ListContactView.CallbackMethods.delete_batch_contacts,before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMContactResource.DeletingContacts;LoadingBanner.showLoaderBtn("#deletePanel")},after:function(){LoadingBanner.hideLoaderBtn("#deletePanel")}})},initConfirmationPanelForDelete:function(){jq.tmpl("template-blockUIPanel",{id:"confirmationDeleteOneContactPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:['<div class="confirmationAction">',"<b><\/b>","<\/div>",'<div class="confirmationNote">',ASC.CRM.Resources.CRMJSResource.DeleteConfirmNote,"<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMJSResource.DeleteContactInProgress}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first")},showConfirmationPanelForDelete:function(n,t,i,r){i=="true"||i==!0?jq("#confirmationDeleteOneContactPanel .confirmationAction>b").text(jq.format(ASC.CRM.Resources.CRMJSResource.DeleteCompanyConfirmMessage,Encoder.htmlDecode(n))):jq("#confirmationDeleteOneContactPanel .confirmationAction>b").text(jq.format(ASC.CRM.Resources.CRMJSResource.DeletePersonConfirmMessage,Encoder.htmlDecode(n)));jq("#confirmationDeleteOneContactPanel .middle-button-container>.button.blue.middle").off("click").on("click",function(){ASC.CRM.ListContactView.deleteContact(t,r)});PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#confirmationDeleteOneContactPanel",500)},deleteContact:function(n,t){var i,r;t===!0?(i=[],i.push(n),r={contactIDsForDelete:i},Teamlab.removeCrmContact(r,i,{success:ASC.CRM.ListContactView.CallbackMethods.delete_batch_contacts,before:function(){jq("#contactActionMenu").hide()}})):Teamlab.removeCrmContact({},n,{before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMJSResource.DeleteContactInProgress;LoadingBanner.showLoaderBtn("#confirmationDeleteOneContactPanel");jq("#crm_contactMakerDialog input, #crm_contactMakerDialog select, #crm_contactMakerDialog textarea").prop("disabled",!0);LoadingBanner.strLoading=ASC.CRM.Resources.CRMJSResource.DeleteContactInProgress;LoadingBanner.showLoaderBtn("#crm_contactMakerDialog")},success:function(){ASC.CRM.Common.unbindOnbeforeUnloadEvent();location.href="Default.aspx"}})},showTaskPanel:function(n,t){window.taskContactSelector.ShowChangeButton=t;t==!0?jq("#selector_taskContactSelector .crm-removeLink").removeClass("display-none"):jq("#selector_taskContactSelector .crm-removeLink").addClass("display-none");ASC.CRM.TaskActionView.showTaskPanel(0,"contact",0,n,{success:ASC.CRM.ListContactView.CallbackMethods.add_new_task})},addNewTag:function(){var n=jq("#addTagDialog input").val().trim(),t;if(n=="")return!1;t={tagName:n,isNewTag:!0};p(t)},showSendEmailDialog:function(){var n,t,i;for(typeof ASC.CRM.ListContactView.basePathMail=="undefined"&&(ASC.CRM.ListContactView.basePathMail=ASC.CRM.Common.getMailModuleBasePath()),n=[ASC.CRM.ListContactView.basePathMail,"#composeto/crm=",].join(""),t=0,i=ASC.CRM.ListContactView.selectedItems.length;t<i;t++)ASC.CRM.ListContactView.selectedItems[t].primaryEmail!=null&&(n+=ASC.CRM.ListContactView.selectedItems[t].id+",");n=n.substring(0,n.length-1);jq("#sendEmailDialog .sendMailByTl").attr("href",n);jq.dropdownToggle().toggle("#contactsHeaderMenu .menuActionSendEmail","sendEmailDialog",5,0)},showCreateLinkPanel:function(){var t=[],n,i;for(jq("#sendEmailDialog").hide(),jq("#createLinkPanel #linkList").html(""),jq("#cbxBlind").prop("checked",!1),jq("#tbxBatchSize").val("10"),jq.forceNumber({parent:"#createLinkPanel",input:"#tbxBatchSize",integerOnly:!0,positiveOnly:!0}),n=0,i=ASC.CRM.ListContactView.selectedItems.length;n<i;n++)ASC.CRM.ListContactView.selectedItems[n].primaryEmail!=null&&t.push(ASC.CRM.ListContactView.selectedItems[n].primaryEmail.data);jq("#createLinkPanel .middle-button-container a:first").off("click").on("click",function(){ASC.CRM.ListContactView.createLink(t)});PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#createLinkPanel",500)},createLink:function(n){var t,f;jq("#createLinkPanel #linkList").html("");LoadingBanner.strLoading=ASC.CRM.Resources.CRMContactResource.Generation;LoadingBanner.showLoaderBtn("#createLinkPanel");var o=jq("#cbxBlind").is(":checked")?"bcc=":"cc=",s=jq("#tbxBatchSize").val().trim()==""?0:parseInt(jq("#tbxBatchSize").val().trim()),r=[],u="",i=0,e="";for(e=ASC.CRM.ListContactView.selectedItems.length-n.length>0?jq.format(ASC.CRM.Resources.CRMJSResource.GenerateLinkInfo,jq.format(ASC.CRM.Resources.CRMJSResource.RecipientsWithoutEmail,ASC.CRM.ListContactView.selectedItems.length-n.length)):jq.format(ASC.CRM.Resources.CRMJSResource.GenerateLinkInfo,""),jq("#createLinkPanel #linkList").append(jq("<div><\/div>").text(e).addClass("headerPanel-splitter")),t=0,f=n.length;t<f;t++)(u+=i==0?"mailto:"+n[t]+"?"+o:n[t]+",",i++,i==s)&&(i=0,r.push(u),u="");for(u&&r.push(u),t=0,f=r.length;t<f;t++)i=t+1,jq("#linkList").append(jq("<a><\/a>").text(ASC.CRM.Resources.CRMJSResource.Batch+" "+i).attr("href",r[t])),t!=r.length-1&&jq("#linkList").append(jq("<span><span/>").addClass("splitter").text(","));LoadingBanner.hideLoaderBtn("#createLinkPanel");jq("#linkList").show()},checkSMTPSettings:function(){var n=ASC.CRM.Data.smtpSettings;return n?!n.Host||!n.Port||!n.SenderDisplayName||!n.SenderEmailAddress?!1:n.RequiredHostAuthentication&&!n.HostLogin?!1:!0:!1},renderSimpleContent:function(n,t){typeof entityData!="undefined"&&window.entityData!=null&&window.entityData.id!=0&&(LoadingBanner.displayLoading(),Teamlab.getCrmEntityMembers({showCompanyLink:window.entityData.type!="company",showUnlinkBtn:n,showActionMenu:t},window.entityData.type,window.entityData.id,{success:ASC.CRM.ListContactView.CallbackMethods.render_simple_content}))},removeMember:function(n){Teamlab.removeCrmEntityMember({contactID:n},window.entityData.type,window.entityData.id,n,{before:function(n){jq("#trashImg_"+n.contactID).length==1?(jq("#trashImg_"+n.contactID).hide(),jq("#loaderImg_"+n.contactID).show()):(jq("#simpleContactActionMenu").hide(),jq("#contactTable .entity-menu.active").removeClass("active"))},after:ASC.CRM.ListContactView.CallbackMethods.removeMember})},addMember:function(n){var t={contactid:n,personid:n,caseid:window.entityData.id,companyid:window.entityData.id,opportunityid:window.entityData.id};Teamlab.addCrmEntityMember({showCompanyLink:window.entityData.type!="company",showUnlinkBtn:!1,showActionMenu:!0},window.entityData.type,window.entityData.id,n,t,{success:ASC.CRM.ListContactView.CallbackMethods.addMember})},showSenderPage:function(){for(var t,i=[],n=0,r=ASC.CRM.ListContactView.selectedItems.length;n<r;n++)ASC.CRM.ListContactView.selectedItems[n].primaryEmail!=null&&(t={},t.primaryEmail=ASC.CRM.ListContactView.selectedItems[n].primaryEmail.data,t.title=ASC.CRM.ListContactView.selectedItems[n].displayName,t.id=ASC.CRM.ListContactView.selectedItems[n].id,i.push(t));if(i.length>ASC.CRM.ListContactView.emailQuotas)return toastr.error(jq.format(ASC.CRM.Resources.CRMJSResource.ErrorEmailRecipientsCount,ASC.CRM.ListContactView.emailQuotas)),!1;if(ASC.CRM.SmtpSender.setItems(i),jq("#sendEmailDialog").hide(),ASC.CRM.ListContactView.checkSMTPSettings())window.location.href="Sender.aspx";else return window.location.href="/Management.aspx?type=10",!1}}}();ASC.CRM.ContactPhotoUploader=function(){return{initPhotoUploader:function(n,t,i){var r=new AjaxUpload("changeLogo",{action:"ajaxupload.ashx?type=ASC.Web.CRM.Classes.ContactPhotoHandler,ASC.Web.CRM",autoSubmit:!0,data:i,onSubmit:function(){var n="";jq("#uploadPhotoPath").length==1&&(n=jq("#uploadPhotoPath").val());this.setData(jQuery.extend({tmpDirName:n},i))},onChange:function(n,t){return jQuery.inArray("."+t,ASC.Files.Utility.Resource.ExtsImage)==-1?(jq("#divLoadPhotoFromPC .fileUploadDscr").hide(),jq("#divLoadPhotoFromPC .fileUploadError").text(ASC.CRM.Resources.CRMJSResource.ErrorMessage_NotImageSupportFormat).show(),!1):(jq("#divLoadPhotoFromPC .fileUploadError").hide(),jq("#divLoadPhotoFromPC .fileUploadDscr").hide(),jq(".under_logo .linkChangePhoto").addClass("disable"),LoadingBanner.displayLoading(),!0)},onComplete:function(n,i){var r=jq.evalJSON(i),u;if(!r.Success){jq("#divLoadPhotoFromPC .fileUploadDscr").hide();jq("#divLoadPhotoFromPC .fileUploadError").text(r.Message).show();jq(".under_logo .linkChangePhoto").removeClass("disable");LoadingBanner.hideLoading();return}jq("#divLoadPhotoFromPC .fileUploadError").hide();jq("#divLoadPhotoFromPC .fileUploadDscr").show();PopupKeyUpActionProvider.CloseDialog();jq("#uploadPhotoPath").length==1&&jq("#uploadPhotoPath").val(r.Data.Path);u=new Date;t.attr("src",r.Data.Url+"?"+u.getTime());jq(".under_logo .linkChangePhoto").removeClass("disable");jq(window).trigger("contactPhotoUploadSuccessComplete",r.Data.Url);LoadingBanner.hideLoading()},parentDialog:n,isInPopup:!0,name:"changeLogo"})}}}();ASC.CRM.ContactFullCardView=function(){var r="/",n="contactFullCardToggledBlocks",s=function(n){var t,e;if(typeof sliderListItems!="undefined"&&window.sliderListItems!=null){var r=[],i=[],f=0;for(i[0]="",t=0,e=window.sliderListItems.items.length;t<e;t++)r[t]=window.sliderListItems.items[t].color,i[t+1]=window.sliderListItems.items[t].title,window.sliderListItems.items[t].id==window.sliderListItems.status&&(f=t+1);jq("#loyaltySliderDetails").length!=0&&jq("#loyaltySliderDetails").sliderWithSections({value:f,values:i,max:window.sliderListItems.positionsCount,colors:r,marginWidth:1,sliderOptions:{stop:function(n,t){t.value!=0?u(window.sliderListItems.items[t.value-1].id):u(0)}},disabled:!n})}},h=function(){jq.tmpl("template-blockUIPanel",{id:"changeContactStatusConfirmation",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:ASC.CRM.ContactFullCardView.isCompany?ASC.CRM.Resources.CRMContactResource.ConfirmationChangePersonsStatus:ASC.CRM.Resources.CRMContactResource.ConfirmationChangeCompanyStatus,innerHtmlText:['<div class="noAskingCCSAnymore">','<input type="checkbox" style="float: left;" id="noAskCCSAnymore"/>','<label style="float:left; padding: 2px 0 0 4px;" for="noAskCCSAnymore">',ASC.CRM.Resources.CRMCommonResource.DontAskAnymore,"<\/label>",'<span style="height: 20px;margin: 0 0 0 4px;">','<div class="HelpCenterSwitcher" ',"onclick=\"jq(this).helper({ BlockHelperID: 'changeContactStatusConfirmation_helpInfo', popup: true});\">","<\/div>",'<div class="popup_helper" id="changeContactStatusConfirmation_helpInfo">',ASC.CRM.Data.IsCRMAdmin===!0?ASC.CRM.Resources.CRMContactResource.ContactStatusGroupChangeHelpForAdmin.format('<a href="Settings.aspx?type=contact_stage" target="_blank">',"<\/a>"):ASC.CRM.Resources.CRMContactResource.ContactStatusGroupChangeHelpForUser,"<\/div>","<\/span>","<\/div>"].join(""),OKBtn:ASC.CRM.ContactFullCardView.isCompany?ASC.CRM.Resources.CRMContactResource.OKCompanyStatusGroupChange:ASC.CRM.Resources.CRMContactResource.OKPersonStatusGroupChange,CancelBtn:ASC.CRM.Resources.CRMContactResource.CancelContactStatusGroupChange,progressText:ASC.CRM.Resources.CRMContactResource.LoadingWait}).insertAfter("#contactDetailsMenuPanel");jq("#changeContactStatusConfirmation").on("click",".middle-button-container .button.blue",function(){jq("#noAskCCSAnymore").is(":checked")&&Teamlab.updateCRMContactStatusSettings({},!0,function(){ASC.CRM.ContactFullCardView.changeContactStatusGroupAuto=!0});LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.LoadingWait;LoadingBanner.showLoaderBtn("#changeContactStatusConfirmation");var n=jq("#changeContactStatusConfirmation").attr("data-statusValue");ASC.CRM.ContactFullCardView.isCompany===!0?Teamlab.updateCrmCompanyContactStatus({},window.sliderListItems.id,{companyid:window.sliderListItems.id,contactStatusid:n},function(){PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()}):Teamlab.updateCrmPersonContactStatus({},window.sliderListItems.id,{personid:window.sliderListItems.id,contactStatusid:n},function(){PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()})});jq("#changeContactStatusConfirmation").on("click",".middle-button-container .button.gray",function(){jq("#noAskCCSAnymore").is(":checked")&&Teamlab.updateCRMContactStatusSettings({},!1,function(){ASC.CRM.ContactFullCardView.changeContactStatusGroupAuto=!1});LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.LoadingWait;LoadingBanner.showLoaderBtn("#changeContactStatusConfirmation");var n=jq("#changeContactStatusConfirmation").attr("data-statusValue");Teamlab.updateCrmContactContactStatus({},window.sliderListItems.id,{contactid:window.sliderListItems.id,contactStatusid:n},function(){PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()})});jq("#changeContactStatusConfirmation").on("click",".cancelButton",function(){var n=jq("#changeContactStatusConfirmation").attr("data-statusValue");Teamlab.updateCrmContactContactStatus({},window.sliderListItems.id,{contactid:window.sliderListItems.id,contactStatusid:n},{})})},c=function(){jq.tmpl("template-blockUIPanel",{id:"addTagToContactGroupConfirmation",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:["<div>",(ASC.CRM.ContactFullCardView.isCompany?ASC.CRM.Resources.CRMContactResource.ConfirmationAddTagToCompanyGroup:ASC.CRM.Resources.CRMContactResource.ConfirmationAddTagToPersonGroup).replace(/\n/g,"<br/>"),"<\/div>",'<div class="noAskingATCAnymore clearFix">','<input type="checkbox" style="float: left;" id="noAskingATCAnymore"/>','<label style="float:left; padding: 2px 0 0 4px;" for="noAskingATCAnymore">',ASC.CRM.Resources.CRMCommonResource.DontAskAnymore,"<\/label>",'<span style="height: 20px;margin: 0 0 0 4px;">','<div class="HelpCenterSwitcher" ',"onclick=\"jq(this).helper({ BlockHelperID: 'addTagToContactGroupConfirmation_helpInfo', popup: true});\">","<\/div>",'<div class="popup_helper" id="addTagToContactGroupConfirmation_helpInfo">',ASC.CRM.Data.IsCRMAdmin===!0?ASC.CRM.Resources.CRMContactResource.AddTagToContactGroupHelpForAdmin.format('<a href="Settings.aspx?type=tag" target="_blank">',"<\/a>"):ASC.CRM.Resources.CRMContactResource.AddTagToContactGroupHelpForUser,"<\/div>","<\/span>","<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMContactResource.OKAddContactTagToGroup,OKBtnClass:"OKAddTagToGroup",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,OtherBtnHtml:['<a class="button gray middle CancelAddTagToGroup">',ASC.CRM.ContactFullCardView.isCompany?ASC.CRM.Resources.CRMContactResource.CancelAddContactTagToGroupForCompany:ASC.CRM.Resources.CRMContactResource.CancelAddContactTagToGroupForPerson,"<\/a>"].join(""),progressText:ASC.CRM.Resources.CRMContactResource.LoadingWait}).insertAfter("#contactDetailsMenuPanel");jq("#addTagToContactGroupConfirmation").on("click",".OKAddTagToGroup",function(){jq("#noAskingATCAnymore").is(":checked")&&Teamlab.updateCRMContactTagSettings({},!0,function(){ASC.CRM.ContactFullCardView.addTagToContactGroupAuto=!0});LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.LoadingWait;LoadingBanner.showLoaderBtn("#addTagToContactGroupConfirmation");f(ASC.CRM.ContactFullCardView.tagParams,ASC.CRM.ContactFullCardView.tagText)});jq("#addTagToContactGroupConfirmation").on("click",".CancelAddTagToGroup",function(){jq("#noAskingATCAnymore").is(":checked")&&Teamlab.updateCRMContactTagSettings({},!1,function(){ASC.CRM.ContactFullCardView.addTagToContactGroupAuto=!1});LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.LoadingWait;LoadingBanner.showLoaderBtn("#addTagToContactGroupConfirmation");t(ASC.CRM.ContactFullCardView.tagParams,ASC.CRM.ContactFullCardView.tagText)})},l=function(){jq.tmpl("template-blockUIPanel",{id:"deleteTagFromContactGroupConfirmation",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:["<div>",(ASC.CRM.ContactFullCardView.isCompany?ASC.CRM.Resources.CRMContactResource.ConfirmationDeleteTagFromCompanyGroup:ASC.CRM.Resources.CRMContactResource.ConfirmationDeleteTagFromPersonGroup).replace(/\n/g,"<br/>"),"<\/div>",'<div class="noAskingATCAnymore clearFix">','<input type="checkbox" style="float: left;" id="noAskingDTCAnymore"/>','<label style="float:left; padding: 2px 0 0 4px;" for="noAskingATCAnymore">',ASC.CRM.Resources.CRMCommonResource.DontAskAnymore,"<\/label>",'<span style="height: 20px;margin: 0 0 0 4px;">','<div class="HelpCenterSwitcher" ',"onclick=\"jq(this).helper({ BlockHelperID: 'deleteTagFromContactGroupConfirmation_helpInfo', popup: true});\">","<\/div>",'<div class="popup_helper" id="deleteTagFromContactGroupConfirmation_helpInfo">',ASC.CRM.Data.IsCRMAdmin===!0?ASC.CRM.Resources.CRMContactResource.DeleteTagFromContactGroupHelpForAdmin.format('<a href="Settings.aspx?type=tag" target="_blank">',"<\/a>"):ASC.CRM.Resources.CRMContactResource.DeleteTagFromContactGroupHelpForUser,"<\/div>","<\/span>","<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMContactResource.OKDeleteContactTagFromGroup,OKBtnClass:"OKDeleteTagFromGroup",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,OtherBtnHtml:['<a class="button gray middle CancelDeleteTagFromGroup">',ASC.CRM.ContactFullCardView.isCompany?ASC.CRM.Resources.CRMContactResource.CancelDeleteContactTagFromGroupForCompany:ASC.CRM.Resources.CRMContactResource.CancelDeleteContactTagFromGroupForPerson,"<\/a>"].join(""),progressText:ASC.CRM.Resources.CRMContactResource.LoadingWait}).insertAfter("#contactDetailsMenuPanel");jq("#deleteTagFromContactGroupConfirmation").on("click",".OKDeleteTagFromGroup",function(){jq("#noAskingDTCAnymore").is(":checked")&&Teamlab.updateCRMContactTagSettings({},!0,function(){ASC.CRM.ContactFullCardView.addTagToContactGroupAuto=!0});LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.LoadingWait;LoadingBanner.showLoaderBtn("#deleteTagFromContactGroupConfirmation");e(ASC.CRM.ContactFullCardView.tagParams,ASC.CRM.ContactFullCardView.tagText)});jq("#deleteTagFromContactGroupConfirmation").on("click",".CancelDeleteTagFromGroup",function(){jq("#noAskingDTCAnymore").is(":checked")&&Teamlab.updateCRMContactTagSettings({},!1,function(){ASC.CRM.ContactFullCardView.addTagToContactGroupAuto=!1});LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.LoadingWait;LoadingBanner.showLoaderBtn("#deleteTagFromContactGroupConfirmation");i(ASC.CRM.ContactFullCardView.tagParams,ASC.CRM.ContactFullCardView.tagText)})},a=function(n){jq.tmpl("template-blockUIPanel",{id:"writeMailToHistoryConfirmation",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:["<div>",ASC.CRM.Resources.CRMContactResource.WriteEmailByMailProductDscr,"<\/div>",'<div class="noAskingWMHAnymore clearFix">','<input type="checkbox" id="noAskMailHistoryAnymore" style="float:left" />','<label for="noAskMailHistoryAnymore" style="float:left;padding: 2px 0 0 4px;">',ASC.CRM.Resources.CRMCommonResource.DontAskAnymore,"<\/label>","<\/div>",'<div id="linkList" style="display:none;"><\/div>'].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,OKBtnClass:"OKGoToWriteMail",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel}).insertAfter("#contactDetailsMenuPanel");jq("#writeMailToHistoryConfirmation").on("click",".OKGoToWriteMail",function(){jq("#noAskMailHistoryAnymore").is(":checked")&&(LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.LoadingWait,LoadingBanner.showLoaderBtn("#writeMailToHistoryConfirmation"),Teamlab.updateCRMContactMailToHistorySettings({},!0,function(){ASC.CRM.ContactFullCardView.writeMailToHistoryAuto=!0}));window.open(n,"_blank");jq.unblockUI()})},v=function(){jq.tmpl("template-blockUIPanel",{id:"mergePanel",headerTest:ASC.CRM.Resources.CRMContactResource.MergePanelHeaderText,questionText:"",innerHtmlText:['<div class="describe-text">',ASC.CRM.Resources.CRMContactResource.MergePanelDescriptionText,"<\/div>",'<ul id="listContactsToMerge">',"<\/ul>"].join(""),OKBtn:ASC.CRM.Resources.CRMContactResource.MergePanelButtonStartText,OKBtnClass:"OKMergeContacts",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMContactResource.MergePanelProgress}).insertAfter("#contactProfile");jq("#mergePanel").on("click",".OKMergeContacts",function(){ASC.CRM.ContactFullCardView.mergeContacts()})},y=function(n,t){jq.tmpl("template-blockUIPanel",{id:"divLoadPhotoWindow",headerTest:ASC.CRM.Resources.CRMContactResource.ChooseProfilePhoto,questionText:"",innerHtmlText:['<div id="divLoadPhotoFromPC" style="margin-top: -20px;">',"<h4>",ASC.CRM.Resources.CRMContactResource.LoadPhotoFromPC,"<\/h4>",'<div class="describe-text" style="margin-bottom: 5px;">',n,"<\/div>","<div>",'<a id="changeLogo" class="button middle gray">',ASC.CRM.Resources.CRMJSResource.Browse,"...","<\/a>",'<span class="fileUploadDscr">',ASC.CRM.Resources.CRMJSResource.NoFileSelected,"<\/span>",'<span class="fileUploadError"><\/span>',"<br />","<\/div>","<\/div>",'<div id="divLoadPhotoDefault">',"<h4>",ASC.CRM.Resources.CRMContactResource.ChangePhotoToDefault,"<\/h4>",'<div id="divDefaultImagesHolder" data-uploadOnly="false">','<div class="ImageHolderOuter" onclick="ASC.CRM.SocialMedia.DeleteContactAvatar();">','<img class="AvatarImage" src=',t,' alt="" />',"<\/div>","<\/div>","<\/div>",'<div id="divLoadPhotoFromSocialMedia">',"<h4>",ASC.CRM.Resources.CRMContactResource.LoadPhotoFromSocialMedia,"<\/h4>",'<div id="divImagesHolder" data-uploadOnly="false">',"<\/div>",'<div style="clear: both;">','<div id="divAjaxImageContainerPhotoLoad">',"<\/div>","<\/div>","<\/div>"].join(""),OKBtn:"",CancelBtn:"",progressText:""}).insertAfter("#contactProfile")},p=function(){var i,u,t,e,f;jq.registerHeaderToggleClick("#contactProfile .crm-detailsTable","tr.headerToggleBlock");jq("#contactProfile .crm-detailsTable").on("click",".headerToggle, .openBlockLink, .closeBlockLink",function(){var f=jq(this).parents("tr.headerToggleBlock:first"),o=f.attr("data-toggleid"),s=f.hasClass("open"),t=jq.cookies.get(n),u,i,e;if(t!=null)t[o]=s;else for(t={},u=jq("#contactProfile .crm-detailsTable tr.headerToggleBlock"),i=0,e=u.length;i<e;i++)t[jq(u[i]).attr("data-toggleid")]=jq(u[i]).hasClass("open");jq.cookies.set(n,t,{path:r})});if(i=jq.cookies.get(n),i!=null)for(u=jq("#contactProfile .crm-detailsTable tr.headerToggleBlock"),t=0,e=u.length;t<e;t++)f=jq(u[t]).attr("data-toggleid"),i.hasOwnProperty(f)&&i[f]===!0&&jq(u[t]).addClass("open");else jq("#contactHistoryTable .headerToggleBlock").addClass("open");jq("#contactProfile .headerToggle").not("#contactProfile .headerToggleBlock.open .headerToggle").each(function(){jq(this).parents("tr.headerToggleBlock:first").nextUntil(".headerToggleBlock").hide()})},w=function(n){var t,i;return n.infoType==7&&(t=JSON.parse(Encoder.htmlDecode(n.data)),n.data=ASC.CRM.Common.getAddressTextForDisplay(t),i=ASC.CRM.Common.getAddressQueryForMap(t),n.href="http://maps.google.com/maps?q="+i),n.infoType==2&&(n.href=n.data.indexOf("://")==-1?"http://"+n.data:n.data),n.infoType==4&&(n.href=n.data.indexOf("://")==-1?"https://twitter.com/#!/"+n.data:n.data,ASC.CRM.SocialMedia.socialNetworks.push(n)),n.infoType==5&&(n.href=n.data.indexOf("://")==-1?"http://"+n.data:n.data,ASC.CRM.SocialMedia.socialNetworks.push(n)),n.infoType==6&&(n.data.indexOf("://")==-1&&(n.href="http://facebook.com/"+n.data),ASC.CRM.SocialMedia.socialNetworks.push(n)),n.infoType==8&&(n.href=n.data.indexOf("://")==-1?"http://"+n.data+".livejournal.com/":n.data),n.infoType==9&&(n.href=n.data.indexOf("://")==-1?"http://myspace.com/"+n.data:n.data),n.infoType==11&&(n.href=n.data.indexOf("://")==-1?"http://"+n.data+".blogspot.com/":n.data),n.infoType==14&&(n.href="http://www.icq.com/people/"+n.data+"/"),n.infoType==17&&(n.href=n.data.indexOf("://")==-1?"https://vk.com/"+n.data:n.data),n},b=function(n){LoadingBanner.hideLoaderBtn("#changeContactStatusConfirmation");jq("#changeContactStatusConfirmation").attr("data-statusValue",n);PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#changeContactStatusConfirmation",520)},k=function(n,t){LoadingBanner.hideLoaderBtn("#addTagToContactGroupConfirmation");ASC.CRM.ContactFullCardView.tagText=t;ASC.CRM.ContactFullCardView.tagParams=n;jq("#addTagDialog").hide();PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#addTagToContactGroupConfirmation",570)},d=function(n,t){LoadingBanner.hideLoaderBtn("#deleteTagFromContactGroupConfirmation");ASC.CRM.ContactFullCardView.tagText=t;ASC.CRM.ContactFullCardView.tagParams=n;jq("#addTagDialog").hide();PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#deleteTagFromContactGroupConfirmation",570)},u=function(n){switch(ASC.CRM.ContactFullCardView.changeContactStatusGroupAuto){case null:ASC.CRM.ContactFullCardView.additionalContactsCount==0?Teamlab.updateCrmContactContactStatus({},window.sliderListItems.id,{contactid:window.sliderListItems.id,contactStatusid:n},function(){PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()}):b(n);break;case!1:Teamlab.updateCrmContactContactStatus({},window.sliderListItems.id,{contactid:window.sliderListItems.id,contactStatusid:n},function(){PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()});break;case!0:ASC.CRM.ContactFullCardView.isCompany===!0?Teamlab.updateCrmCompanyContactStatus({},window.sliderListItems.id,{companyid:window.sliderListItems.id,contactStatusid:n},function(){PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()}):Teamlab.updateCrmPersonContactStatus({},window.sliderListItems.id,{personid:window.sliderListItems.id,contactStatusid:n},function(){PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()})}},t=function(n,t){Teamlab.addCrmTag(n,ASC.CRM.TagView.EntityType,ASC.CRM.TagView.EntityID,t,{success:function(n,t){ASC.CRM.TagView.callback_add_tag(n,t);PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()},before:function(){jq("#tagContainer .adding_tag_loading").show();jq("#addTagDialog").hide()},after:function(){jq("#tagContainer .adding_tag_loading").hide();LoadingBanner.hideLoaderBtn("#addTagToContactGroupConfirmation")}})},f=function(n,t){Teamlab.addCrmContactTagToGroup(n,ASC.CRM.ContactFullCardView.isCompany===!0?"company":"person",ASC.CRM.ContactFullCardView.contactID,t,{success:function(n,t){ASC.CRM.TagView.callback_add_tag(n,t);PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()},before:function(){jq("#tagContainer .adding_tag_loading").show();jq("#addTagDialog").hide()},after:function(){jq("#tagContainer .adding_tag_loading").hide();LoadingBanner.hideLoaderBtn("#addTagToContactGroupConfirmation")}})},g=function(n,i){switch(ASC.CRM.ContactFullCardView.addTagToContactGroupAuto){case null:ASC.CRM.ContactFullCardView.additionalContactsCount==0?t(n,i):k(n,i);break;case!1:t(n,i);break;case!0:f(n,i)}},i=function(n,t){Teamlab.removeCrmTag({element:n},"contact",ASC.CRM.ContactFullCardView.contactID,t,{success:function(n,t){ASC.CRM.TagView.callback_delete_tag(n,t);PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()}})},e=function(n,t){Teamlab.deleteCrmContactTagFromGroup({element:n},ASC.CRM.ContactFullCardView.isCompany===!0?"company":"person",ASC.CRM.ContactFullCardView.contactID,t,{success:function(n,t){ASC.CRM.TagView.callback_delete_tag(n,t);PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()},after:function(){LoadingBanner.hideLoaderBtn("#deleteTagFromContactGroupConfirmation")}})},nt=function(n){var t=jQuery.base64.decode(n.children(".tag_title:first").attr("data-value"));switch(ASC.CRM.ContactFullCardView.addTagToContactGroupAuto){case null:ASC.CRM.ContactFullCardView.additionalContactsCount==0?i(n,t):d(n,t);break;case!1:i(n,t);break;case!0:e(n,t)}},tt=function(){var r,f,i,t,e,n,u;if(typeof contactNetworks!="undefined"&&window.contactNetworks.length!=0)for(i=!0,t=0,e=window.contactNetworks.length;t<e;t++)w(window.contactNetworks[t]),n=window.contactNetworks[t],n.isPrimary?(f=jq.tmpl("collectionContainerTmpl",{Type:n.infoTypeLocalName}).insertBefore("#contactTagsTR").children(".collectionItemsTD"),jq.tmpl("collectionTmpl",n).appendTo(f),i=!0):i||window.contactNetworks[t-1].infoType!=n.infoType?(r=jq.tmpl("collectionContainerTmpl",{Type:n.infoTypeLocalName}).appendTo("#contactAdditionalTable").children(".collectionItemsTD"),jq.tmpl("collectionTmpl",n).appendTo(r),i=!1):jq.tmpl("collectionTmpl",n).appendTo(r);if(jq("#contactGeneralList .writeEmail").length==1){u=ASC.CRM.Common.getMailModuleBasePath();pathCreateEmail=[u,"#composeto/crm=",ASC.CRM.ContactFullCardView.contactID].join("");pathSortEmails=[u,"#inbox/","from=",jq("#contactGeneralList .writeEmail").attr("data-email"),"/sortorder=descending/"].join("");a(pathCreateEmail);jq("#contactGeneralList .writeEmail").on("click",function(){ASC.CRM.ContactFullCardView.writeMailToHistoryAuto==!0?(window.open(pathCreateEmail,"_blank"),jq.unblockUI()):(jq("#noAskMailHistoryAnymore").prop("checked",!1),StudioBlockUIManager.blockUI("#writeMailToHistoryConfirmation",500))});jq("#contactGeneralList .viewMailingHistory a.button").attr("href",pathSortEmails);jq("#contactGeneralList .viewMailingHistory").removeClass("display-none")}else jq("#contactGeneralList .viewMailingHistory").remove()},it=function(){var u,i,t,n,r;if(typeof customFieldList!="undefined"&&window.customFieldList.length!=0){for(u=[],i={label:"",labelid:0,list:[]},n=0,r=window.customFieldList.length;n<r;n++)t=window.customFieldList[n],t.mask.trim()!=""&&(t.mask=JSON.parse(t.mask)),t.fieldType==4||n==r-1?(t.fieldType!=4&&i.list.push(t),(n!=0||n==r-1)&&i.label==""?jq("#contactAdditionalTable").length==0?jq.tmpl("customFieldListWithoutLabelTmpl",{list:i.list}).insertBefore("#contactHistoryTable"):jq.tmpl("customFieldListWithoutLabelWithGroupTmpl",{list:i.list}).appendTo("#contactAdditionalTable"):u.push(i),i={label:t.label,labelid:t.id,list:[]}):i.list.push(t);for(n=0,r=u.length;n<r;n++)u[n].list.length==0&&(u.splice(n,1),n--,r--);jq.tmpl("customFieldListTmpl",u).insertBefore("#contactHistoryTable")}},o=function(){jq("#mergePanel .infoPanel").hide();jq("#contactDetailsMenuPanel").hide();jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active");PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#mergePanel",400)};return{contactID:0,isCompany:undefined,init:function(n,t,i,u,f,e,o,a,w){var k,d,b,rt;for(ASC.CRM.ContactFullCardView.contactID=n,ASC.CRM.ContactFullCardView.isCompany=t,ASC.CRM.ContactFullCardView.companyID=i,ASC.CRM.ContactFullCardView.changeContactStatusGroupAuto=u,ASC.CRM.ContactFullCardView.addTagToContactGroupAuto=f,ASC.CRM.ContactFullCardView.writeMailToHistoryAuto=e,ASC.CRM.ContactFullCardView.additionalContactsCount=a,ASC.CRM.ContactFullCardView.tagParams={},ASC.CRM.ContactFullCardView.tagText="",k=location.pathname.split("/"),k.splice(k.length-1,1),r=k.join("/"),d=jq("#contactProfile .contact_photo:first"),ASC.CRM.Common.loadContactFoto(d,d,d.attr("data-avatarurl")),w&&(y(o,ASC.CRM.Data.DefaultContactPhoto[t===!0?"CompanyMediumSizePhoto":"PersonMediumSizePhoto"]),ASC.CRM.ContactPhotoUploader.initPhotoUploader(jq("#divLoadPhotoWindow"),jq("#contactProfile .contact_photo"),{contactID:jq.getURLParam("id"),uploadOnly:!1})),b=0,rt=window.contactTags.length;b<rt;b++)window.contactTags[b]=Encoder.htmlDecode(window.contactTags[b]);for(b=0,rt=window.contactAvailableTags.length;b<rt;b++)window.contactAvailableTags[b]=Encoder.htmlDecode(window.contactAvailableTags[b]);jq.tmpl("tagViewTmpl",{tags:window.contactTags,availableTags:window.contactAvailableTags,readonly:!w}).appendTo("#contactTagsTR>td:last");ASC.CRM.TagView.init("contact",!1,{addTag:function(n,t){g(n,t)},deleteTag:function(n){nt(n)}});typeof contactResponsibleIDs!="undefined"&&window.contactResponsibleIDs.length!=0&&jq("#contactManagerList").html(ASC.CRM.Common.getAccessListHtml(window.contactResponsibleIDs));tt();it();jq("#contactAdditionalTable tbody").children().length<=1&&jq("#contactAdditionalTable").remove();ASC.CRM.Common.RegisterContactInfoCard();p();h();c();l();v();s(w);jq("#contactManagerList").text().trim().length==0&&jq("#contactManagerList").parents("tr:first").remove()},showMergePanel:function(){if(typeof contactToMergeSelector=="undefined"){LoadingBanner.displayLoading();var n=ASC.CRM.ContactFullCardView.isCompany===!0?ASC.CRM.Data.ContactSelectorTypeEnum.Companies:ASC.CRM.Data.ContactSelectorTypeEnum.Persons,t=0,i=0;Teamlab.getCrmContactsByPrefix({},{filter:{prefix:jq("#baseInfo_Title").val().trim(),searchType:n,entityType:t,entityID:i},success:function(r,u){for(var h,e=[],f=0,s=u.length;f<s;f++)e.push(u[f].id),u[f].id==ASC.CRM.ContactFullCardView.contactID&&(u.splice(f,1),f--,s--);h=u.length;jq.tmpl("listContactsToMergeTmpl",{contacts:u,count:h}).appendTo("#listContactsToMerge");window.contactToMergeSelector=new ASC.CRM.ContactSelector.ContactSelector("contactToMergeSelector",{SelectorType:n,EntityType:t,EntityID:i,ShowOnlySelectorContent:!1,DescriptionText:ASC.CRM.ContactFullCardView.isCompany===!0?ASC.CRM.Resources.CRMContactResource.FindCompanyByName:ASC.CRM.Resources.CRMContactResource.FindEmployeeByName,DeleteContactText:"",AddContactText:"",IsInPopup:!0,ShowChangeButton:!0,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!0,ShowNewCompanyContent:!1,ShowNewContactContent:!1,presetSelectedContactsJson:"",ExcludedArrayIDs:e,HTMLParent:"#listContactsToMerge .contactToMergeSelectorContainer"});jq("#listContactsToMerge input[type='radio']:first").prop("checked",!0);LoadingBanner.hideLoading();o()}})}else o()},mergeContacts:function(){var t=ASC.CRM.ContactFullCardView.contactID,n=jq("#listContactsToMerge input[name=contactToMerge]:checked").val()*1;if(n==0){if(typeof window.contactToMergeSelector.SelectedContacts[0]=="undefined"){jq("#mergePanel .infoPanel > div").text(ASC.CRM.Resources.CRMJSResource.ErrorContactIsNotSelected);jq("#mergePanel .infoPanel").show();return}n=window.contactToMergeSelector.SelectedContacts[0]*1}Teamlab.mergeCrmContacts({isCompany:ASC.CRM.ContactFullCardView.isCompany},{fromcontactid:t,tocontactid:n},{before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMContactResource.MergePanelProgress;LoadingBanner.showLoaderBtn("#mergePanel")},success:function(n,t){location.href=["Default.aspx?id=",t.id,n.isCompany===!0?"":"&type=people"].join("")},error:function(n,t){toastr.error(t[0])},after:function(){LoadingBanner.hideLoaderBtn("#mergePanel")}})}}}();ASC.CRM.ContactDetailsView=function(){var t=[],i=!1,n=[],u=function(){var t=ASC.Controls.AnchorController.getAnchor();return(t==null||t==""||jq.inArray(t,n)==-1)&&(t="profile"),t},f=function(n,t,i,r,u){window.ASC.Controls.ClientTabsNavigator.init("ContactTabs",{tabs:[{title:ASC.CRM.Resources.CRMCommonResource.Profile,selected:i=="profile",anchor:"profile",divID:"profileTab",onclick:"ASC.CRM.ContactDetailsView.activateCurrentTab('"+n+"','profile');"},{title:ASC.CRM.Resources.CRMTaskResource.Tasks,selected:i=="tasks",anchor:"tasks",divID:"tasksTab",onclick:"ASC.CRM.ContactDetailsView.activateCurrentTab('"+n+"','tasks');"},{title:ASC.CRM.Resources.CRMContactResource.Persons,selected:i=="contacts",anchor:"contacts",divID:"contactsTab",visible:t,onclick:"ASC.CRM.ContactDetailsView.activateCurrentTab('"+n+"','contacts');"},{title:ASC.CRM.Resources.CRMDealResource.Deals,selected:i=="deals",anchor:"deals",divID:"dealsTab",onclick:"ASC.CRM.ContactDetailsView.activateCurrentTab('"+n+"','deals');"},{title:ASC.CRM.Resources.CRMCommonResource.InvoiceModuleName,selected:i=="invoices",anchor:"invoices",divID:"invoicesTab",onclick:"ASC.CRM.ContactDetailsView.activateCurrentTab('"+n+"','invoices');"},{title:ASC.CRM.Resources.CRMCommonResource.Documents,selected:i=="files",anchor:"files",divID:"filesTab",onclick:"ASC.CRM.ContactDetailsView.activateCurrentTab('"+n+"','files');"},{title:ASC.CRM.Resources.CRMCommonResource.Projects,selected:i=="projects",anchor:"projects",divID:"projectsTab",visible:r,onclick:"ASC.CRM.ContactDetailsView.activateCurrentTab('"+n+"','projects');"},{title:"Twitter",selected:i=="twitter",anchor:"twitter",divID:"socialMediaTab",visible:u,onclick:"ASC.CRM.ContactDetailsView.activateCurrentTab('"+n+"','twitter');"}]})},e=function(n){if(jq.browser.mobile===!0){var t={id:0,title:ASC.CRM.Resources.CRMJSResource.LinkWithProject};n.splice(0,0,t);jq.tmpl("projectSelectorOptionTmpl",n).appendTo("#projectsInContactPanel select");jq("#projectsInContactPanel select").on("change",function(){r(jq(this).children("option:selected"),this.value)})}else{jq.tmpl("projectSelectorItemTmpl",n).appendTo("#projectSelectorContainer>.dropdown-content");jq.dropdownToggle({dropdownID:"projectSelectorContainer",switcherSelector:"#projectsInContactPanel .selectProject>div",addTop:2});n.length>0&&(jq("#projectsInContactPanel .selectProject .menuAction").addClass("unlockAction"),jq("#projectSelectorContainer").removeClass("display-none"));jq("#projectSelectorContainer").on("click",".dropdown-content>li",function(){jq("#projectSelectorContainer").hide();var n=jq(this).attr("data-id");r(jq(this),n)})}},r=function(n,t){var i={contactid:ASC.Projects.AllProject.contactID,projectid:t};Teamlab.addProjectForCrmContact({element:n},t,i,h)},o=function(n){n.remove();jq.browser.mobile===!0?jq("#projectsInContactPanel select").val(0).tlCombobox():jq("#projectSelectorContainer .dropdown-item").length==0&&(jq("#projectsInContactPanel .selectProject .menuAction").removeClass("unlockAction"),jq("#projectSelectorContainer").addClass("display-none"))},s=function(n){jq.browser.mobile===!0?jq.tmpl("projectSelectorOptionTmpl",n).appendTo("#projectsInContactPanel select"):(jq.tmpl("projectSelectorItemTmpl",n).appendTo("#projectSelectorContainer>.dropdown-content"),jq("#projectsInContactPanel .selectProject .menuAction:not(.unlockAction)").addClass("unlockAction"),jq("#projectSelectorContainer.display-none").hide(),jq("#projectSelectorContainer.display-none").removeClass("display-none"))},h=function(n,t){ASC.Projects.AllProject.addProjectsToSimpleList(t);o(n.element)},c=function(n,t){jq(n.element).remove();jq("#tableListProjects>tbody>tr").length==0&&(jq("#projectsInContactPanel").hide(),jq("#tableListProjectsContainer:not(.display-none)").addClass("display-none"),jq("#projectsEmptyScreen.display-none").removeClass("display-none"));s(t)},l=function(n,r,u){var f,s,h,o,c;if(t=r,typeof n[0].__count!="undefined"&&n[0].__count!=0){for(f=0;f<r.length;f++)r[f].canLinkContact===!1&&(r.splice(f,1),f--);for(t=r,f=0,s=u.length;f<s;f++)for(h=u[f].id,o=0,c=r.length;o<c;o++)if(r[o].id==h){r.splice(o,1);break}e(r)}typeof n[1].__count!="undefined"&&n[1].__count!=0?(jq("#projectsEmptyScreen:not(.display-none)").addClass("display-none"),jq("#projectsEmptyScreenWithoutButton:not(.display-none)").addClass("display-none"),jq("#tableListProjectsContainer.display-none").removeClass("display-none"),ASC.Projects.AllProject.renderListProjects(u),jq("#projectsInContactPanel").show()):(jq("#tableListProjectsContainer:not(.display-none)").addClass("display-none"),i===!0||t.length!=0?jq("#projectsEmptyScreen.display-none").removeClass("display-none"):jq("#projectsEmptyScreenWithoutButton.display-none").removeClass("display-none"));LoadingBanner.hideLoading()},a=function(n){LoadingBanner.displayLoading();Teamlab.joint().getPrjProjects({},{filter:{sortBy:"title",sortOrder:"ascending",fields:"id,title,isPrivate,security,responsible"}}).getProjectsForCrmContact({},n).start({},{success:l})},v=function(n){jq("#projectsEmptyScreen .emptyScrBttnPnl>a").on("click",function(){jq("#projectsEmptyScreen:not(.display-none)").addClass("display-none");jq("#projectsInContactPanel").show()});ASC.Projects.AllProject.init(!0);ASC.Projects.AllProject.contactID=n;jq("#projectsInContactPanel .createNewProject>div").on("click",function(){location.href=[StudioManager.getLocationPathToModule("Projects"),"Projects.aspx?action=add&contactID=",ASC.Projects.AllProject.contactID].join("")});a(ASC.Projects.AllProject.contactID);jq("#tableListProjects").on("click",".trash>img.trash_delete",function(){var n=jq(this);n.hide();n.parent().children(".trash_progress").show();var t=n.parents("tr:first"),i=t.attr("id"),r={contactid:ASC.Projects.AllProject.contactID,projectid:i};Teamlab.removeProjectFromCrmContact({element:t},i,r,c)})},y=function(){window.Attachments.init();window.Attachments.bind("addFile",function(n,t){var i=parseInt(jq.getURLParam("id")),r,u;isNaN(i)||(r="contact",u=[],u.push(t.id),Teamlab.addCrmEntityFiles({},i,r,{entityid:i,entityType:r,fileids:u},function(n,t){window.Attachments.appendFilesToLayout(t.files);n.fromAttachmentsControl=!0;ASC.CRM.HistoryView.isTabActive=!1}))});window.Attachments.bind("deleteFile",function(n,t){var i=jq("#fileContent_"+t),r;i.length!=0?(r=i.parents("[id^=eventAttach_]").attr("id").split("_")[1],ASC.CRM.HistoryView.deleteFile(t,r)):Teamlab.removeCrmEntityFiles({fileId:t},t,{success:function(n){window.Attachments.deleteFileFromLayout(n.fileId)}})})},p=function(){jq(document).ready(function(){jq.dropdownToggle({dropdownID:"contactDetailsMenuPanel",switcherSelector:".mainContainerClass .containerHeaderBlock .menu-small",addTop:0,addLeft:-10,showFunction:function(n,t){t.is(":hidden")?n.addClass("active"):n.removeClass("active")},hideFunction:function(){jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active")}})})},w=function(n){var i=null,t;n==0&&(i={taskResponsibleSelectorUserIDs:window.contactResponsibleIDs});jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"contact",0,window.contactForInitTaskActionPanel,i)});ASC.CRM.ListTaskView.bindEmptyScrBtnEvent(i);t=jq("#menuCreateNewDeal").attr("href")+"&contactID="+jq.getURLParam("id");jq("#menuCreateNewDeal").attr("href",t);t=jq("#menuCreateNewInvoice").attr("href")+"&contactID="+jq.getURLParam("id");jq("#menuCreateNewInvoice").attr("href",t)},b=function(n){n===!0&&jq.tmpl("template-emptyScreen",{ID:"emptyPeopleInCompanyPanel",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_company_participants,Header:ASC.CRM.Resources.CRMContactResource.EmptyContentPeopleHeader,Describe:ASC.CRM.Resources.CRMContactResource.EmptyContentPeopleDescribe,ButtonHTML:["<a class='link-with-entity link dotline' ",'onclick=\'javascript:jq("#peopleInCompanyPanel").show();jq("#emptyPeopleInCompanyPanel").addClass("display-none");\'>',ASC.CRM.Resources.CRMContactResource.AssignContact,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#contactListBox");jq.tmpl("template-emptyScreen",{ID:"projectsEmptyScreen",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_projects,Header:ASC.CRM.Resources.CRMContactResource.EmptyContactProjectListHeader,Describe:ASC.CRM.Resources.CRMContactResource.EmptyContactProjectListDescription,ButtonHTML:["<a class='link-with-entity link dotline'>",ASC.CRM.Resources.CRMContactResource.AssignProject,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#tableListProjects");jq.tmpl("template-emptyScreen",{ID:"projectsEmptyScreenWithoutButton",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_projects,Header:ASC.CRM.Resources.CRMContactResource.EmptyContactProjectListHeader,Describe:ASC.CRM.Resources.CRMContactResource.EmptyContactProjectListDescriptionWithoutButton,CssClass:"display-none"}).insertAfter("#tableListProjects");jq.tmpl("template-emptyScreen",{ID:"invoiceEmptyScreen",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_invoices,Header:ASC.CRM.Resources.CRMInvoiceResource.EmptyContentInvoicesHeader,Describe:ASC.CRM.Resources.CRMInvoiceResource.EmptyContentInvoicesDescribe,ButtonHTML:["<a class='link dotline plus' href='Invoices.aspx?action=create&contactID="+jq.getURLParam("id")+"'>",ASC.CRM.Resources.CRMInvoiceResource.CreateFirstInvoice,"<\/a>"].join("")}).insertAfter("#invoiceTable")},k=function(){window.contactSelector=new ASC.CRM.ContactSelector.ContactSelector("contactSelector",{SelectorType:2,EntityType:0,EntityID:0,ShowOnlySelectorContent:!0,DescriptionText:ASC.CRM.Resources.CRMContactResource.FindContactByName,DeleteContactText:"",AddContactText:"",IsInPopup:!1,ShowChangeButton:!1,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!1,ShowNewCompanyContent:!1,ShowNewContactContent:!0,presetSelectedContactsJson:"",ExcludedArrayIDs:[],HTMLParent:"#peopleInCompanyPanel"});window.contactSelector.SelectItemEvent=ASC.CRM.ContactDetailsView.addPersonToCompany;ASC.CRM.ListContactView.removeMember=ASC.CRM.ContactDetailsView.removePersonFromCompany;jq(window).on("getContactsFromApi",function(n,t){var r=t.length,u,i;if(ASC.CRM.ContactFullCardView.additionalContactsCount=r,r==0)jq("#emptyPeopleInCompanyPanel.display-none").removeClass("display-none");else{for(jq("#peopleInCompanyPanel").show(),u=[],i=0;i<r;i++)u.push(t[i].id);window.contactSelector.SelectedContacts=u}})};return{init:function(t,r,e,o,s,h){i=ASC.CRM.Data.CanCreateProjects;n=["profile","tasks","deals","invoices","files"];r===!0&&n.push("contacts");e&&n.push("projects");o&&n.push("twitter");var c=u();f(t,r===!0,c,e,o);ASC.CRM.HistoryView.init(t,"contact",0);ASC.CRM.DealTabView.initTab(t);ASC.CRM.ListTaskView.initTab(t,"contact",0);ASC.CRM.ListInvoiceView.initTab(t,"contact");ASC.CRM.SocialMedia.initTab(r,h);ASC.CRM.ListContactView.isContentRendered=!1;ASC.CRM.ListInvoiceView.isContentRendered=!1;ASC.CRM.ContactDetailsView.isProjectTabRendered=!1;b(r);r===!0&&k();y();p();w(s);ASC.CRM.SocialMedia.init(ASC.CRM.Data.DefaultContactPhoto[r===!0?"CompanyBigSizePhoto":"PersonBigSizePhoto"]);ASC.CRM.ContactDetailsView.checkSocialMediaError();ASC.CRM.ContactDetailsView.activateCurrentTab(t,c)},activateCurrentTab:function(n,t){var r,i,u;if(t=="profile",t=="tasks"&&ASC.CRM.ListTaskView.activate(),t=="contacts"&&ASC.CRM.ListContactView.isContentRendered==!1&&(ASC.CRM.ListContactView.isContentRendered=!0,ASC.CRM.ListContactView.renderSimpleContent(!1,!0)),t=="twitter"){if(r=!1,typeof contactNetworks!="undefined"&&window.contactNetworks.length!=0)for(i=0,u=window.contactNetworks.length;i<u;i++)if(window.contactNetworks[i].infoType==4){r=!0;break}ASC.CRM.SocialMedia.activate(r)}t=="deals"&&ASC.CRM.DealTabView.activate();t=="invoices"&&ASC.CRM.ListInvoiceView.isContentRendered==!1&&(ASC.CRM.ListInvoiceView.isContentRendered=!0,ASC.CRM.ListInvoiceView.renderSimpleContent());t=="files"&&window.Attachments.loadFiles();t=="projects"&&ASC.CRM.ContactDetailsView.isProjectTabRendered==!1&&(ASC.CRM.ContactDetailsView.isProjectTabRendered=!0,v(n))},removePersonFromCompany:function(n){Teamlab.removeCrmEntityMember({contactID:parseInt(n)},window.entityData.type,window.entityData.id,n,{before:function(){jq("#simpleContactActionMenu").hide();jq("#contactTable .entity-menu.active").removeClass("active")},success:function(n){var t=jq.inArray(n.contactID,window.contactSelector.SelectedContacts);t!=-1?window.contactSelector.SelectedContacts.splice(t,1):console.log("Can't find such contact in list");ASC.CRM.ContactSelector.Cache={};ASC.CRM.ContactFullCardView.additionalContactsCount=window.contactSelector.SelectedContacts.length;jq("#contactItem_"+n.contactID).animate({opacity:"hide"},500);setTimeout(function(){jq("#contactItem_"+n.contactID).remove();window.contactSelector.SelectedContacts.length==0&&(jq("#peopleInCompanyPanel").hide(),jq("#emptyPeopleInCompanyPanel.display-none").removeClass("display-none"))},500);ASC.CRM.HistoryView.isTabActive=!1}})},addPersonToCompany:function(n){if(jq("#contactItem_"+n.id).length>0)return!1;var t={personid:n.id,companyid:window.entityData.id};Teamlab.addCrmEntityMember({showCompanyLink:window.entityData.type!="company",showUnlinkBtn:!1,showActionMenu:!0},window.entityData.type,window.entityData.id,n.id,t,{success:function(n,t){ASC.CRM.ListContactView.CallbackMethods.addMember(n,t);window.contactSelector.SelectedContacts.push(t.id);ASC.CRM.ContactFullCardView.additionalContactsCount=window.contactSelector.SelectedContacts.length;jq("#emptyPeopleInCompanyPanel:not(.display-none)").addClass("display-none");ASC.CRM.HistoryView.isTabActive=!1}})},checkSocialMediaError:function(){var n=jq("input[id$='_ctrlSMErrorMessage']").val();n!=""&&n!==undefined&&ASC.CRM.SocialMedia.ShowErrorMessage(n)}}}();ASC.CRM.ContactActionView=function(){var f=!1,e=!1,n="";this.ContactData=null;var l=function(){var e,h,n,f,c,u,i,t;jq("#generalListEdit").on("click",".not_primary_field",function(){ASC.CRM.ContactActionView.choosePrimaryElement(jq(this),jq(this).parent().parent().parent().attr("id")=="addressContainer")});if(typeof contactNetworks!="undefined"&&window.contactNetworks.length!=0){for(e=0,h=window.contactNetworks.length;e<h;e++)if(n=window.contactNetworks[e],n.hasOwnProperty("infoType")&&n.hasOwnProperty("data")){if(n.infoType==7){f=JSON.parse(Encoder.htmlDecode(n.data));c=o(jq("#addressContainer").children("div:first").clone(),n.isPrimary,n.category,f.street,f.city,f.state,f.zip,f.country);c.insertAfter(jq("#addressContainer").children("div:last")).show();continue}n.infoType==0?(u="phoneContainer",i=ASC.CRM.ContactActionView.createNewCommunication(u,Encoder.htmlDecode(n.data),n.isPrimary),s(i.children("table").find("a"),jq("#phoneCategoriesPanel ul.dropdown-content li").children("a[category="+n.category+"]").text(),n.category)):n.infoType==1?(u="emailContainer",i=ASC.CRM.ContactActionView.createNewCommunication(u,Encoder.htmlDecode(n.data),n.isPrimary),r(i.children("table").find("a"),jq("#baseCategoriesPanel ul.dropdown-content li").children("a[category="+n.category+"]").text(),n.category)):(u="websiteAndSocialProfilesContainer",i=ASC.CRM.ContactActionView.createNewCommunication(u,Encoder.htmlDecode(n.data)),r(i.find("a.social_profile_category"),jq("#baseCategoriesPanel ul.dropdown-content li").children("a[category="+n.category+"]").text(),n.category),ASC.CRM.ContactActionView.changeSocialProfileCategory(i.find("a.social_profile_type"),n.infoType,jq("#socialProfileCategoriesPanel ul.dropdown-content li").children("a[category="+n.infoType+"]").text(),jq("#socialProfileCategoriesPanel ul.dropdown-content li").children("a[category="+n.infoType+"]").attr("categoryName")));i.insertAfter(jq("#"+u).children("div:last")).show();continue}t="crm-addNewLink";jq("#emailContainer").children("div").length>1&&jq("#emailContainer").prev("dt").removeClass("crm-headerHiddenToggledBlock");jq("#emailContainer").children("div:not(:first)").find("."+t).hide();jq("#emailContainer").children("div:last").find("."+t).show();jq("#phoneContainer").children("div").length>1&&jq("#phoneContainer").prev("dt").removeClass("crm-headerHiddenToggledBlock");jq("#phoneContainer").children("div:not(:first)").find("."+t).hide();jq("#phoneContainer").children("div:last").find("."+t).show();jq("#websiteAndSocialProfilesContainer").children("div").length>1&&jq("#websiteAndSocialProfilesContainer").prev("dt").removeClass("crm-headerHiddenToggledBlock");jq("#websiteAndSocialProfilesContainer").children("div:not(:first)").find("."+t).hide();jq("#websiteAndSocialProfilesContainer").children("div:last").find("."+t).show();jq("#addressContainer").children("div").length>1&&jq("#addressContainer").prev("dt").removeClass("crm-headerHiddenToggledBlock");jq("#addressContainer").children("div:not(:first)").find("."+t).hide();jq("#addressContainer").children("div:last").find("."+t).show()}},a=function(){for(var n=0,t=window.contactActionTags.length;n<t;n++)window.contactActionTags[n]=Encoder.htmlDecode(window.contactActionTags[n]);for(n=0,t=window.contactActionAvailableTags.length;n<t;n++)window.contactActionAvailableTags[n]=Encoder.htmlDecode(window.contactActionAvailableTags[n]);jq.tmpl("tagViewTmpl",{tags:window.contactActionTags,availableTags:window.contactActionAvailableTags}).appendTo("#tagsContainer>div:first");ASC.CRM.TagView.init("contact",!0);window.contactActionTags.length>0&&(jq("#tagsContainer>div:first").removeClass("display-none"),jq("#tagsContainer").prev().removeClass("crm-headerHiddenToggledBlock"))},v=function(){typeof customFieldList!="undefined"&&window.customFieldList.length!=0&&ASC.CRM.Common.renderCustomFields(customFieldList,"custom_field_","customFieldRowTmpl","#generalListEdit");jq.registerHeaderToggleClick("#contactProfileEdit","dt.headerToggleBlock");jq("#contactProfileEdit dt.headerToggleBlock").each(function(){jq(this).nextUntil("dt.headerToggleBlock").hide()})},y=function(n){var i,t,r;if(typeof contactAvailableTypes!="undefined"&&window.contactAvailableTypes.length!=0){for(i="",t=0,r=window.contactAvailableTypes.length;t<r;t++)i+=["<option value='",window.contactAvailableTypes[t].id,"'",window.contactAvailableTypes[t].id==n?" selected='selected'":"",">",jq.htmlEncodeLight(window.contactAvailableTypes[t].title),"<\/option>"].join("");jq("#contactTypeContainer select").html(jq("#contactTypeContainer select").html()+i);n!=0&&(jq("#contactTypeContainer").prev().removeClass("crm-headerHiddenToggledBlock"),jq("#contactTypeContainer > div:first").removeClass("display-none"))}},p=function(n){for(var t=null,i="",r=['<optgroup label="',ASC.CRM.Resources.CRMCommonResource.Currency_Basic,'">'].join(""),u=['<optgroup label="',ASC.CRM.Resources.CRMCommonResource.Currency_Other,'">'].join(""),f=0,e=window.contactActionCurrencies.length;f<e;f++)t=window.contactActionCurrencies[f],i=['<option value="',t.abbreviation,'"',t.abbreviation==n?' selected="selected">':">",jq.format("{0} - {1}",t.abbreviation,t.title),"<\/option>"].join(""),t.isBasic?r+=i:u+=i;r+="<\/optgroup>";u+="<\/optgroup>";jq("#currencyContainer select").html(jq("#currencyContainer select").html()+r+u);n!=""&&(jq("#currencyContainer").prev().removeClass("crm-headerHiddenToggledBlock"),jq("#currencyContainer > div:first").removeClass("display-none"))},w=function(){jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})})},b=function(){jq.tmpl("template-blockUIPanel",{id:"confirmationAccessRightsPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.ConfirmationAccessRightsPanelHeader,innerHtmlText:[ASC.CRM.Resources.CRMCommonResource.ConfirmationAccessRightsPanelText1,"<p>",ASC.CRM.Resources.CRMCommonResource.ConfirmationAccessRightsPanelText2,"<\/p>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel}).insertAfter("#contactProfileEdit .contactManagerPanel");jq("#confirmationAccessRightsPanel").on("click",".middle-button-container .button.blue",function(){e=!0;jq.unblockUI();ASC.CRM.ContactActionView.submitForm(n);window.__doPostBack(n,"")})},k=function(n){var t=n===!0?"#company":"#person";jq.tmpl("template-blockUIPanel",{id:"confirmationGotoSettingsPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:['<div class="confirmationNote">',ASC.CRM.Resources.CRMJSResource.ConfirmGoToCustomFieldPage,"<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,OKBtnHref:"Settings.aspx?type=custom_field"+t,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:""}).insertAfter("#otherContactCustomFieldPanel");jq("#confirmationGotoSettingsPanel .button.blue").on("click",function(){ASC.CRM.Common.unbindOnbeforeUnloadEvent()})},d=function(n,t){jq.tmpl("template-blockUIPanel",{id:"divLoadPhotoWindow",headerTest:ASC.CRM.Resources.CRMContactResource.ChooseProfilePhoto,questionText:"",innerHtmlText:['<div id="divLoadPhotoFromPC" style="margin-top: -20px;">',"<h4>",ASC.CRM.Resources.CRMContactResource.LoadPhotoFromPC,"<\/h4>",'<div class="describe-text" style="margin-bottom: 5px;">',n,"<\/div>","<div>",'<a id="changeLogo" class="button middle gray">',ASC.CRM.Resources.CRMJSResource.Browse,"...","<\/a>",'<span class="fileUploadDscr">',ASC.CRM.Resources.CRMJSResource.NoFileSelected,"<\/span>",'<span class="fileUploadError"><\/span>',"<br />","<\/div>","<\/div>",'<div id="divLoadPhotoDefault">',"<h4>",ASC.CRM.Resources.CRMContactResource.ChangePhotoToDefault,"<\/h4>",'<div id="divDefaultImagesHolder" data-uploadOnly="true">','<div class="ImageHolderOuter" onclick="ASC.CRM.SocialMedia.DeleteContactAvatar();">','<img class="AvatarImage" src=',t,' alt="" />',"<\/div>","<\/div>","<\/div>",'<div id="divLoadPhotoFromSocialMedia">',"<h4>",ASC.CRM.Resources.CRMContactResource.LoadPhotoFromSocialMedia,"<\/h4>",'<div id="divImagesHolder" data-uploadOnly="true">',"<\/div>",'<div style="clear: both;">','<div id="divAjaxImageContainerPhotoLoad">',"<\/div>","<\/div>","<\/div>"].join(""),OKBtn:"",CancelBtn:"",progressText:""}).insertAfter("#divSMProfilesWindow")},o=function(n,i,r,u,f,e,o,s){var c,a,l,v;return jq("#addressContainer").children("div").length!=1&&n.attr("style","margin-top: 10px;"),typeof i!="undefined"&&t(n,i),typeof r!="undefined"&&(c=n.find("select.address_category"),a=c.children('option[category="'+r+'"]'),a.length==1&&(c.children("option").prop("selected",!1),a.prop("selected",!0),c.val(a.val()),h(c,r))),l=jq("#addressContainer").children("div:last").attr("selectname").split("_"),v=l[2]*1+1,n.find("input, textarea, select").not(".address_category").each(function(){if(jq(this).attr("name")!=""){var n=jq(this).attr("name").split("_");n[2]=v;jq(this).attr("name",n.join("_"))}}),l=n.attr("selectname").split("_"),l[2]=v,n.attr("selectname",l.join("_")),n.find("textarea.contact_street").val(u||""),n.find("input.contact_city").val(f||""),n.find("input.contact_state").val(e||""),n.find("input.contact_zip").val(o||""),n.find("input.contact_country").val(s||""),n},t=function(n,t){var u=t?1:0,f=t?"is_primary primary_field":"is_primary not_primary_field",i=n.find(".is_primary"),r;i.attr("class",f);i.attr("alt",ASC.CRM.Resources.CRMJSResource.Primary);i.attr("title",ASC.CRM.Resources.CRMJSResource.Primary);r=n.attr("selectname").split("_");r[5]=u;n.attr("selectname",r.join("_"));n.find("input, textarea, select").not(".address_category").each(function(){var n=jq(this).attr("name").split("_");n[5]=u;jq(this).attr("name",n.join("_"))})},i=function(n,t){var f=t?1:0,e=t?"is_primary primary_field":"is_primary not_primary_field",i=n.find(".is_primary"),r,u;i.attr("class",e);i.attr("alt",ASC.CRM.Resources.CRMJSResource.Primary);i.attr("title",ASC.CRM.Resources.CRMJSResource.Primary);r=n.find("input.textEdit");u=r.attr("name").split("_");u[4]=f;r.attr("name",u.join("_"))},r=function(n,t,i){jq(n).text(t);var r=jq(n).parents("tr:first").find("input"),u=r.attr("name").split("_");u[3]=i;r.attr("name",u.join("_"));jq("#baseCategoriesPanel").hide()},s=function(n,t,i){jq(n).text(t);var r=jq(n).parents("tr:first").find("input"),u=r.attr("name").split("_");u[3]=i;r.attr("name",u.join("_"));jq("#phoneCategoriesPanel").hide()},h=function(n,t){jq(n).parents("table:first").find("input, textarea, select").not(".address_category").each(function(){var n=jq(this).attr("name").split("_");n[3]=t;jq(this).attr("name",n.join("_"))})},g=function(n){var i,t,r;if(jq("#trashImg_"+n).length==1&&(jq("#trashImg_"+n).hide(),jq("#loaderImg_"+n).show()),typeof n=="number")i=jq.inArray(n,window.assignedContactSelector.SelectedContacts),i!=-1?window.assignedContactSelector.SelectedContacts.splice(i,1):console.log("Can't find such contact in list"),ASC.CRM.ContactSelector.Cache={};else for(t=0,r=ASC.CRM.SocialMedia.selectedPersons.length;t<r;t++)if(ASC.CRM.SocialMedia.selectedPersons[t].id==n){ASC.CRM.SocialMedia.selectedPersons.splice(t,1);break}jq("#contactItem_"+n).animate({opacity:"hide"},500);setTimeout(function(){jq("#contactItem_"+n).remove();jq("#contactTable tr").length==0&&jq("#contactListBox").parent().addClass("hiddenFields")},500)},nt=function(n,t){if(jq("#contactItem_"+n.id).length>0)return!1;if(t.newContact==!0){var i={Key:t.data.firstName,Value:t.data.lastName,canEdit:!0,displayName:n.displayName,id:"new_"+jq("#contactTable tr").length,isCompany:!1,isPrivate:!1,isShared:t.data.isShared,smallFotoUrl:n.smallFotoUrl};ASC.CRM.Common.contactItemFactory(i,{showUnlinkBtn:!0,showActionMenu:!1});jq.tmpl("simpleContactTmpl",i).prependTo("#contactTable tbody");jq("#contactListBox").parent().removeClass("hiddenFields");ASC.CRM.Common.RegisterContactInfoCard();ASC.CRM.SocialMedia.selectedPersons.push(i)}else Teamlab.getCrmContact({},n.id,{success:function(n,t){ASC.CRM.Common.contactItemFactory(t,{showUnlinkBtn:!0,showActionMenu:!1});jq.tmpl("simpleContactTmpl",t).prependTo("#contactTable tbody");jq("#contactListBox").parent().removeClass("hiddenFields");ASC.CRM.Common.RegisterContactInfoCard();window.assignedContactSelector.SelectedContacts.push(t.id)}})},tt=function(n){var i=n.value.trim(),t=jq(n).parents("table:first");return i==""||jq.isValidEmail(i)?(t.css("borderColor",""),t.parent().children(".requiredErrorText").hide(),!0):(t.css("borderColor","#CC0000"),t.parent().children(".requiredErrorText").show(),n.focus(),!1)},et=function(n){var i=n.value.trim(),t=jq(n).parents("table:first"),r=new RegExp(/(^\+)?(\d+)/);return i==""||r.test(i)?(t.css("borderColor",""),t.parent().children(".requiredErrorText").hide(),!0):(t.css("borderColor","#CC0000"),t.parent().children(".requiredErrorText").show(),n.focus(),!1)},it=function(){jq("#contactProfileEdit input, #contactProfileEdit select, #contactProfileEdit textarea").prop("readonly",!0).addClass("disabled");jq("#contactProfileEdit .input_with_type").addClass("disabled");jq(".under_logo .linkChangePhoto").addClass("disable")},c=function(){jq("#contactProfileEdit input.disabled, #contactProfileEdit select.disabled, #contactProfileEdit textarea.disabled").prop("readonly",!1).removeClass("disabled");jq("#contactProfileEdit .input_with_type.disabled").removeClass("disabled");jq(".under_logo .linkChangePhoto.disable").removeClass("disable")},rt=function(){var n=!0,t=!0;return(jq("#typeAddedContact").val()=="people"?(jq("#contactProfileEdit input[name=baseInfo_firstName]").val().trim()==""&&(ShowRequiredError(jq("#contactProfileEdit input[name=baseInfo_firstName]")),n=!1),typeof companySelector!="undefined"&&(jq("#companySelectorsContainer input[name=baseInfo_compID]").val(typeof window.companySelector.SelectedContacts[0]!="undefined"?window.companySelector.SelectedContacts[0]:""),jq("#companySelectorsContainer input[name=baseInfo_compName]").val(jq("#contactTitle_companySelector_0").val().trim()))):jq("#contactProfileEdit input[name=baseInfo_companyName]").val().trim()==""&&(ShowRequiredError(jq("#contactProfileEdit input[name=baseInfo_companyName]")),n=!1),!n)?(c(),!1):(jq("#emailContainer > div:not(:first) > table input").each(function(){tt(this)||(t=!1)}),!t)?(c(),jq.scrollTo(jq("#emailContainer").position().top-100,{speed:400}),!1):!ASC.CRM.Data.IsCRMAdmin&&!window.SelectedUsers_ContactManager.IDs.includes(Teamlab.profile.id)&&!jq("#isPublic").is(":checked")&&!e?(StudioBlockUIManager.blockUI("#confirmationAccessRightsPanel",400),!1):!0},ut=function(){jq("#addressContainer").children("div:first").find("input, textarea, select").attr("name","");jq("#addressContainer").children("div:not(:first)").each(function(){var n=jq(this);n.find(".contact_street").val().trim()+n.find(".contact_city").val().trim()+n.find(".contact_state").val().trim()+n.find(".contact_zip").val().trim()+n.find(".contact_country").val().trim()==""?n.find("input, textarea, select").attr("name",""):n.addClass("not_empty")});(jq("#addressContainer").children("div:not(:first)").find(".primary_field").length==0||!jq("#addressContainer").children("div:not(:first)").find(".primary_field").parent().parent().hasClass("not_empty"))&&jq("#addressContainer").children("div.not_empty").length>0&&ASC.CRM.ContactActionView.choosePrimaryElement(jq(jq("#addressContainer").children("div.not_empty")[0]).children(".actions_for_item").children(".is_primary"),!0)},ft=function(){jq("#emailContainer").children("div:first").find("input").attr("name","");jq("#phoneContainer").children("div:first").find("input").attr("name","");jq("#emailContainer").children("div:not(:first)").find("input").each(function(){jq(this).val().trim()!=""&&jq(this).parents("table:first").parent().addClass("not_empty")});jq("#phoneContainer").children("div:not(:first)").find("input").each(function(){jq(this).val().trim()!=""&&jq(this).parents("table:first").parent().addClass("not_empty")});(jq("#emailContainer").children("div:not(:first)").find(".primary_field").length==0||!jq("#emailContainer").children("div:not(:first)").find(".primary_field").parent().parent().hasClass("not_empty"))&&jq("#emailContainer").children("div.not_empty").length>0&&ASC.CRM.ContactActionView.choosePrimaryElement(jq(jq("#emailContainer").children("div.not_empty")[0]).children(".actions_for_item").children(".is_primary"),!1);(jq("#phoneContainer").children("div:not(:first)").find(".primary_field").length==0||!jq("#phoneContainer").children("div:not(:first)").find(".primary_field").parent().parent().hasClass("not_empty"))&&jq("#phoneContainer").children("div.not_empty").length>0&&ASC.CRM.ContactActionView.choosePrimaryElement(jq(jq("#phoneContainer").children("div.not_empty")[0]).children(".actions_for_item").children(".is_primary"),!1)},u=function(){jq("#contactProfileEdit").on("keyup change paste","input, select, textarea",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()});jq("#contactProfileEdit").on("click",".crm-deleteLink",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()});jq(window).on("contactPhotoUploadSuccessComplete addTagComplete deleteTagComplete setContactInSelector editContactInSelector deleteContactFromSelector advUserSelectorDeleteComplete advUserSelectorPushUserComplete",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()})};return{init:function(n,t,i,r,e,o,s){var c,it,ut;if(f===!1){f=!0;c=jq.cookies.get(s);c!=null&&c!=""&&(jq.cookies.del(s),jq.tmpl("template-blockUIPanel",{id:"saveContactError",headerTest:ASC.CRM.Resources.CRMCommonResource.Alert,questionText:"",innerHtmlText:["<div>",c,"<\/div>"].join(""),CancelBtn:ASC.CRM.Resources.CRMCommonResource.Close,progressText:""}).insertAfter("#crm_contactMakerDialog"),PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#saveContactError",500));var h=jq("#typeAddedContact").val()==="company",tt=jq("#contactPhoto .contact_photo:first"),rt=tt.attr("data-avatarurl");rt!=""&&ASC.CRM.Common.loadContactFoto(tt,tt,rt);ASC.CRM.UserSelectorListView.Init("_ContactManager","UserSelectorListView_ContactManager",!0,ASC.CRM.Resources.CRMContactResource.NotifyContactManager,[],null,[],"#contactActionViewManager",!1);h===!1?(window.presetCompanyForPersonJson!=null&&window.presetCompanyForPersonJson!=""&&(window.presetCompanyForPersonJson=new Array(JSON.parse(window.presetCompanyForPersonJson))),window.companySelector=new ASC.CRM.ContactSelector.ContactSelector("companySelector",{SelectorType:e,EntityType:0,EntityID:0,ShowOnlySelectorContent:!1,DescriptionText:ASC.CRM.Resources.CRMContactResource.FindCompanyByName,DeleteContactText:"",AddContactText:"",IsInPopup:!1,ShowChangeButton:!0,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!0,ShowNewCompanyContent:!0,ShowNewContactContent:!1,presetSelectedContactsJson:"",ExcludedArrayIDs:[],HTMLParent:"#companySelectorsContainer div:first",presetSelectedContactsJson:window.presetCompanyForPersonJson})):window.assignedContactSelector=new ASC.CRM.ContactSelector.ContactSelector("assignedContactSelector",{SelectorType:e,EntityType:0,EntityID:0,ShowOnlySelectorContent:!0,DescriptionText:ASC.CRM.Resources.CRMContactResource.FindContactByName,DeleteContactText:"",AddContactText:"",IsInPopup:!1,ShowChangeButton:!1,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!1,ShowNewCompanyContent:!1,ShowNewContactContent:!0,ShowOnlySelectorContent:!0,AcceptNewContactShowOnly:!0,HTMLParent:"#assignedContactsListEdit dd.assignedContacts",ExcludedArrayIDs:[],presetSelectedContactsJson:window.presetPersonsForCompanyJson});ASC.CRM.Data.IsCRMAdmin===!0?k(h):b();ASC.CRM.ListContactView.renderSimpleContent(!0,!1);a();l();jq("#generalListEdit").on("click",".crm-headerHiddenToggledBlock",function(){var n=jq(this).next("dd").attr("id");n=="addressContainer"?ASC.CRM.ContactActionView.editAddress(jq("#addressContainer > div:first .crm-addNewLink")):n=="tagsContainer"||n=="contactTypeContainer"||n=="currencyContainer"?jq("#"+n+" > div:first").removeClass("display-none"):ASC.CRM.ContactActionView.editCommunications(jq("#"+n).children("div:first").find(".crm-addNewLink"),n);jq(this).removeClass("crm-headerHiddenToggledBlock")});if(jq.dropdownToggle({dropdownID:"phoneCategoriesPanel",switcherSelector:"#phoneContainer .input_with_type a",addTop:2,addLeft:0}),jq.dropdownToggle({dropdownID:"baseCategoriesPanel",switcherSelector:"#emailContainer .input_with_type a",noActiveSwitcherSelector:"#websiteAndSocialProfilesContainer .input_with_type a.social_profile_category",addTop:2,addLeft:0}),jq.dropdownToggle({dropdownID:"baseCategoriesPanel",switcherSelector:"#websiteAndSocialProfilesContainer .input_with_type a.social_profile_category",noActiveSwitcherSelector:"#emailContainer .input_with_type a",addTop:2,addLeft:0}),jq.dropdownToggle({dropdownID:"socialProfileCategoriesPanel",switcherSelector:"#websiteAndSocialProfilesContainer .input_with_type a.social_profile_type",addTop:2,addLeft:0}),v(),y(t),p(i),it=jq.tmpl("makePublicPanelTemplate",{Title:h?ASC.CRM.Resources.CRMContactResource.MakePublicPanelTitleForCompany:ASC.CRM.Resources.CRMContactResource.MakePublicPanelTitleForPerson,Description:ASC.CRM.Resources.CRMContactResource.MakePublicPanelDescrForContact,IsPublicItem:r==1||r==2,CheckBoxLabel:h?ASC.CRM.Resources.CRMContactResource.MakePublicPanelCheckBoxLabelForCompany:ASC.CRM.Resources.CRMContactResource.MakePublicPanelCheckBoxLabelForPerson}),it.find(".makePublicPanelSelector").append(jq("<option value='2'><\/option>").text(ASC.CRM.Resources.CRMCommonResource.AccessRightsForReading)).append(jq("<option value='1'><\/option>").text(ASC.CRM.Resources.CRMCommonResource.AccessRightsForReadWriting)).val(r==1||r==2?r:"2").tlCombobox(),it.appendTo("#makePublicPanel"),ASC.CRM.Common.initTextEditCalendars(),w(),ASC.CRM.ListContactView.initConfirmationPanelForDelete(),d(o,ASC.CRM.Data.DefaultContactPhoto[h===!0?"CompanyMediumSizePhoto":"PersonMediumSizePhoto"]),ASC.CRM.ContactPhotoUploader.initPhotoUploader(jq("#divLoadPhotoWindow"),jq("#contactProfileEdit .contact_photo"),{contactID:n,uploadOnly:!0}),typeof assignedContactSelector!="undefined"&&(window.assignedContactSelector.SelectedContacts.length==0&&jq("#contactListBox").parent().addClass("hiddenFields"),window.assignedContactSelector.SelectItemEvent=nt,ASC.CRM.ListContactView.removeMember=g),!isNaN(n)&&jq("#deleteContactButton").length==1){ut=jq("#deleteContactButton").attr("contactName");jq("#deleteContactButton").off("click").on("click",function(){ASC.CRM.ListContactView.showConfirmationPanelForDelete(ut,n,h,!1)})}ASC.CRM.SocialMedia.init(ASC.CRM.Data.DefaultContactPhoto[h===!0?"CompanyBigSizePhoto":"PersonBigSizePhoto"]);jq(".cancelSbmtFormBtn:first").on("click",function(){return ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0});u()}},editCommunicationsEvent:function(n,t){n=n||window.event;var i=jq(n.target||n.srcElement);ASC.CRM.ContactActionView.editCommunications(i,t)},editCommunications:function(n,t){var i="crm-addNewLink",f,o,e,r;n.length==0&&t=="overviewContainer"||n.hasClass(i)?(f=jq("#"+t).children("div:visible:last"),f.length!=0&&f.find("."+i).hide(),o=jq("#"+t).find(".primary_field").length==0?!0:undefined,e=ASC.CRM.ContactActionView.createNewCommunication(t,"",o),e.insertAfter(jq("#"+t).children("div:last")).show(),e.find("input.textEdit").trigger("focus")):n.hasClass("crm-deleteLink")&&(u(null,n),r=n.parent().parent(),jq("#"+t).children("div").length==2&&r.parent().prev("dt").addClass("crm-headerHiddenToggledBlock"),r.remove(),r.find(".primary_field").length==1&&jq("#"+t).children("div:not(:first)").length>=1&&ASC.CRM.ContactActionView.choosePrimaryElement(jq(jq("#"+t).children("div:not(:first)")[0]).find(".is_primary"),!1),jq("#"+t).children("div:not(:first)").find("."+i).hide(),jq("#"+t).children("div:last").find("."+i).show())},createNewCommunication:function(n,t,r){var u=jq("#"+n).children("div:first").clone(),e,f,o,s;return n!="overviewContainer"?(e=jq("#"+n).children("div:last").find("input.textEdit"),e.length!=0&&(f=e.attr("name").split("_"),o=f[2]*1+1,f=u.find("input.textEdit").attr("name").split("_"),f[2]=o,u.find("input.textEdit").attr("name",f.join("_"))),t&&t!=""&&u.children("table").find("input").val(t),typeof r!="undefined"&&(s=u.children(".actions_for_item").children(".is_primary"),s.length!=0&&i(u,r))):t&&t!=""&&u.children("textarea").val(t),u},editAddressEvent:function(n){n=n||window.event;var t=jq(n.target||n.srcElement);ASC.CRM.ContactActionView.editAddress(t)},editAddress:function(n){var t="crm-addNewLink",r,f,e,i;n.hasClass(t)?(r=jq("#addressContainer").children("div:visible:last"),r.length!=0&&r.find("."+t).hide(),f=jq("#addressContainer").find(".primary_field").length==0?!0:undefined,e=o(jq("#addressContainer").children("div:first").clone(),f).insertAfter(jq("#addressContainer").children("div:last")).show(),e.find("textarea").trigger("focus")):n.hasClass("crm-deleteLink")&&(u(null,n),i=n.parent().parent(),jq("#addressContainer").children("div").length==2&&i.parent().prev("dt").addClass("crm-headerHiddenToggledBlock"),i.remove(),i.find(".primary_field").length==1&&jq("#addressContainer").children("div:not(:first)").length>=1&&ASC.CRM.ContactActionView.choosePrimaryElement(jq(jq("#addressContainer").children("div:not(:first)")[0]).find(".is_primary"),!0),jq("#addressContainer").children("div:not(:first)").find("."+t).hide(),jq("#addressContainer").children("div:last").find("."+t).show())},changeSocialProfileCategory:function(n,t,i,r){var e=jq(n).parents("table:first").parent(),u;jq(n).text(i);$inputObj=jq(n).parents("tr:first").find("input");u=$inputObj.attr("name").split("_");u[1]=r;$inputObj.attr("name",u.join("_"));var f=e.find(".find_profile"),o=!1,s="",h="",c=" ";switch(t){case 4:o=window.twitterSearchEnabled;h=ASC.CRM.Resources.CRMJSResource.FindTwitter;c=ASC.CRM.Resources.CRMJSResource.ContactTwitterDescription;s=function(n,t){return function(){ASC.CRM.SocialMedia.FindTwitterProfiles(jq(this),jq("#typeAddedContact").val(),n,t)}}(-3,5)}if(o){f.off("click").on("click",s);f.attr("title",h).show()}else f.hide();e.children(".text-medium-describe").text(c);jq("#socialProfileCategoriesPanel").hide()},choosePrimaryElement:function(n,r){var u,f;r?(f=jq(n).parent().parent(),t(f,!0),jq(n).parents("dd:first").children("div:not(:first)").not(f).each(function(){t(jq(this),!1)})):(u=jq(n).parent().parent(),i(u,!0),jq(n).parents("dd:first").children("div:not(:first)").not(u).each(function(){i(jq(this),!1)}));jq(n).parents("dd:first").find(".is_primary").not(n).attr("class","is_primary not_primary_field");jq(n).parents("dd:first").find(".is_primary").not(n).attr("alt",ASC.CRM.Resources.CRMJSResource.CheckAsPrimary);jq(n).parents("dd:first").find(".is_primary").not(n).attr("title",ASC.CRM.Resources.CRMJSResource.CheckAsPrimary)},submitForm:function(t){var r,e,f,i,u;if(n=t,jq("[id*=saveContactButton]:first").hasClass("postInProcess"))return!1;jq("[id*=saveContactButton]:first").addClass("postInProcess");try{if(it(),HideRequiredError(),rt()===!0){if(LoadingBanner.showLoaderBtn("#crm_contactMakerDialog"),ut(),ft(),jq("#overviewContainer").children("div:first").find("textarea").attr("name",""),jq("#websiteAndSocialProfilesContainer").children("div:first").find("input").attr("name",""),jq("#websiteAndSocialProfilesContainer").children("div:not(:first)").find("input").each(function(){jq(this).val().trim()!=""&&jq(this).parents("table:first").parent().addClass("not_empty")}),jq("#isPublicContact").val(jq("#isPublic").is(":checked")?jq(".makePublicPanel select.makePublicPanelSelector").val():0),jq("#notifyContactManagers").val(jq("#cbxNotify_ContactManager").is(":checked")),jq("#selectedContactManagers").val(window.SelectedUsers_ContactManager.IDs.join(",")),r=jq("#generalListEdit input[type='checkbox'][id^='custom_field_']"),r)for(i=0,u=r.length;i<u;i++)jq(r[i]).is(":checked")&&(e=r[i].id.replace("custom_field_",""),jq("#generalListEdit input[name='customField_"+e+"']").val(jq(r[i]).is(":checked")));if(ASC.CRM.TagView.prepareTagDataForSubmitForm(jq("input[name='baseInfo_assignedTags']")),jq("#typeAddedContact").val()=="people")return ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0;if(ASC.CRM.SocialMedia.selectedPersons.length==0)return jq("#assignedContactsListEdit input[name='baseInfo_assignedContactsIDs']").val(window.assignedContactSelector.SelectedContacts),ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0;for(f=[],i=0,u=ASC.CRM.SocialMedia.selectedPersons.length;i<u;i++)f.push({FirstName:ASC.CRM.SocialMedia.selectedPersons[i].Key,LastName:ASC.CRM.SocialMedia.selectedPersons[i].Value});return jq("#assignedContactsListEdit input[name='baseInfo_assignedNewContactsIDs']").val(jq.toJSON(f)),jq("#assignedContactsListEdit input[name='baseInfo_assignedContactsIDs']").val(window.assignedContactSelector.SelectedContacts),ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0}return jq("[id*=saveContactButton]:first").removeClass("postInProcess"),!1}catch(o){return console.log(o),jq("[id*=saveContactButton]:first").removeClass("postInProcess"),!1}},showBaseCategoriesPanel:function(n){jq("#baseCategoriesPanel a.dropdown-item").off("click").on("click",function(){r(n,jq(this).text(),jq(this).attr("category"))})},showPhoneCategoriesPanel:function(n){jq("#phoneCategoriesPanel a.dropdown-item").off("click").on("click",function(){s(n,jq(this).text(),jq(this).attr("category"))})},showSocialProfileCategoriesPanel:function(n){jq("#socialProfileCategoriesPanel a.dropdown-item").off("click").on("click",function(){ASC.CRM.ContactActionView.changeSocialProfileCategory(n,jq(this).attr("category")*1,jq(this).text(),jq(this).attr("categoryName"))})},changeAddressCategory:function(n){h(n,jq(n).find("option:selected").attr("category"))},showAssignedContactPanel:function(){jq("#assignedContactsListEdit .assignedContacts").removeClass("hiddenFields");jq("#assignedContactsListEdit .assignedContactsLink").addClass("hiddenFields")},showGotoAddSettingsPanel:function(){if(window.onbeforeunload==null){var n=jq("#typeAddedContact").val()==="company",t=n===!0?"#company":"#person";location.href="Settings.aspx?type=custom_field"+t}else PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#confirmationGotoSettingsPanel",500)},prepareSocialNetworks:function(){var r,i,u,n,t;for(jq("#divImagesHolder").html(""),r=jq("#websiteAndSocialProfilesContainer").find("input"),ASC.CRM.SocialMedia.socialNetworks=[],i=0,u=r.length;i<u;i++)(n=jq(r[i]),t=n.val().trim(),t!="")&&(n.attr("name").indexOf("contactInfo_Twitter_")==0?ASC.CRM.SocialMedia.socialNetworks.push({data:t,infoType:4}):n.attr("name").indexOf("contactInfo_LinkedIn_")==0?ASC.CRM.SocialMedia.socialNetworks.push({data:t,infoType:5}):n.attr("name").indexOf("contactInfo_Facebook_")==0&&ASC.CRM.SocialMedia.socialNetworks.push({data:t,infoType:6}));ASC.CRM.SocialMedia.ContactImageListLoaded=!1}}}();jQuery.fn.sliderWithSections=function(n){function p(n,r){var u=(r-t.marginWidth*(i.max-1)-2*t.liBorderWidth*i.max)/i.max;return((u+2*t.liBorderWidth+t.marginWidth)*n).toFixed(4)+"px"}var t=jQuery.extend({disabled:!1,value:null,colors:null,values:null,defaultColor:"#E1E1E1",liBorderWidth:1,sliderOptions:null,max:0,marginWidth:1,slide:function(){}},n),i={step:1,min:0,orientation:"horizontal",max:t.max,range:!1,slide:function(n,r){var o=jQuery(this),f=jQuery(r.handle),e,u,s;for(f.attr("aria-valuetext",t.values[r.value]).attr("aria-valuenow",r.value),r.value!=0?(o.next(".ui-slider-tooltip").find(".ttContent").html(t.values[r.value]),f.removeClass("ui-slider-tooltip-hide")):f.addClass("ui-slider-tooltip-hide"),e=o.children("ol.ui-slider-scale").children("li"),u=0;u<i.max;u++)u<r.value?(s=t.colors!=null&&t.colors[u]?t.colors[u]:"transparent",jQuery(e[u]).css("background-color",s)):jQuery(e[u]).css("background-color",t.defaultColor);t.slide(n,r)},value:t.value},r,c,s,l;t.sliderOptions=n?jQuery.extend(i,n.sliderOptions):i;var e=jQuery(this),o=t.values[t.value],a=o?"":"ui-slider-tooltip-hide",f=jQuery('<div><a href="#" tabindex="0" class="ui-slider-handle '+a+'" role="slider" aria-valuenow="'+t.value+'" aria-valuetext="'+o+'"><\/a><\/div>'),u=jQuery('<span class="ui-slider-tooltip ui-widget-content ui-corner-all"><span class="ttContent">'+o+'<\/span><span class="ui-tooltip-pointer-down ui-widget-content"><span class="ui-tooltip-pointer-down-inner"><\/span><\/span><\/span>'),v=f.append('<ol class="ui-slider-scale ui-helper-reset" role="presentation" style="width: 100%; height: 100%;"><\/ol>').find(".ui-slider-scale:eq(0)"),h=e.css("width").replace("px","")*1,y=((h-t.marginWidth*(i.max-1)-2*t.liBorderWidth*i.max)/i.max).toFixed(4);for(r=0;r<=i.max;r++)c=r==i.max?"display: none;":"",s="transparent",s=r<t.value?t.colors!=null&&t.colors[r]?t.colors[r]:"transparent":t.defaultColor,v.append('<li style="left:'+p(r,h)+"; background-color:"+s+"; height: 100%; width:"+y+"px;"+c+'"><\/li>');return f.appendTo(e).slider(t.sliderOptions).attr("role","application"),u.appendTo(e),l=new MutationObserver(function(n){n.forEach(function(n){var t,i;if(n.type==="attributes"||n.attributeName==="class"){if(t=n.target.classList,t.contains("ui-slider-tooltip-hide")){u.removeClass("visible");return}if(t.contains("ui-state-active")||t.contains("ui-state-focus")||t.contains("ui-state-hover")){i=n.target.getBoundingClientRect();u.css("left",i.left-16);u.css("top",i.top-36);u.addClass("visible");return}u.removeClass("visible")}})}),l.observe(f.find(".ui-slider-handle")[0],{attributes:!0}),t.disabled&&f.slider("disable"),this};jq(document).ready(function(){jq.dropdownToggle({switcherSelector:".noContentBlock .hintTypes",dropdownID:"files_hintTypesPanel",fixWinSize:!1});jq.dropdownToggle({switcherSelector:".noContentBlock .hintCsv",dropdownID:"files_hintCsvPanel",fixWinSize:!1});ASC.CRM.Common.setPostionPageLoader()});
typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}}());ASC.CRM.ListCasesView=function(){var n=function(n,t){if(ASC.CRM.ListCasesView.cookieKey&&ASC.CRM.ListCasesView.cookieKey!=""){var i={page:n,countOnPage:t};jq.cookies.set(ASC.CRM.ListCasesView.cookieKey,i,{path:location.pathname})}},w=function(n){var t,i;return(n=n||0,t={startIndex:n,count:ASC.CRM.ListCasesView.entryCountOnPage},!ASC.CRM.ListCasesView.advansedFilter)?t:(i=ASC.CRM.ListCasesView.advansedFilter.advansedFilter(),jq(i).each(function(n,i){switch(i.id){case"sorter":t.sortBy=i.params.id;t.sortOrder=i.params.dsc==!0?"descending":"ascending";break;case"text":t.filterValue=i.params.value;break;default:i.hasOwnProperty("apiparamname")&&i.params.hasOwnProperty("value")&&i.params.value!=null&&(t[i.apiparamname]=i.params.value)}}),t)},e=function(){ASC.CRM.ListCasesView.deselectAll();var i=0;ASC.CRM.ListCasesView.defaultCurrentPageNumber!=0?(n(ASC.CRM.ListCasesView.defaultCurrentPageNumber,window.casesPageNavigator.EntryCountOnPage),i=(ASC.CRM.ListCasesView.defaultCurrentPageNumber-1)*window.casesPageNavigator.EntryCountOnPage,ASC.CRM.ListCasesView.defaultCurrentPageNumber=0):n(0,window.casesPageNavigator.EntryCountOnPage);t(i)},t=function(n){ASC.CRM.ListCasesView.casesList=[];ASC.CRM.ListCasesView.isFirstLoad||(LoadingBanner.displayLoading(),jq("#caseFilterContainer, #casesHeaderMenu, #caseList, #tableForCasesNavigation").show(),jq("#casesAdvansedFilter").advansedFilter("resize"));jq("#mainSelectAllCases").prop("checked",!1);g(n)},b=function(i,r){window.casesPageNavigator=new ASC.Controls.PageNavigator.init("casesPageNavigator","#divForCasesPager",i,ASC.CRM.Data.VisiblePageCount,r,ASC.CRM.Resources.CRMJSResource.Previous,ASC.CRM.Resources.CRMJSResource.Next);window.casesPageNavigator.changePageCallback=function(i){n(i,window.casesPageNavigator.EntryCountOnPage);var r=window.casesPageNavigator.EntryCountOnPage*(i-1);t(r)}},k=function(n){var t;t=n>=ASC.CRM.ListCasesView.Total?n+1:ASC.CRM.ListCasesView.Total;window.casesPageNavigator.drawPageNavigator((n/ASC.CRM.ListCasesView.entryCountOnPage).toFixed(0)*1+1,t);jq("#tableForCasesNavigation").show()},d=function(){jq("#casesHeaderMenu .menu-action-simple-pagenav").html("");var n=jq("<div><\/div>"),t=0;jq("#divForCasesPager .pagerPrevButtonCSSClass").length!=0&&(t++,jq("#divForCasesPager .pagerPrevButtonCSSClass").clone().appendTo(n));jq("#divForCasesPager .pagerNextButtonCSSClass").length!=0&&(t++,t===2&&jq("<span style='padding: 0 8px;'>&nbsp;<\/span>").clone().appendTo(n),jq("#divForCasesPager .pagerNextButtonCSSClass").clone().appendTo(n));n.children().length!=0?(n.appendTo("#casesHeaderMenu .menu-action-simple-pagenav"),jq("#casesHeaderMenu .menu-action-simple-pagenav").show()):jq("#casesHeaderMenu .menu-action-simple-pagenav").hide()},i=function(n){n!=0?(jq("#casesHeaderMenu .menu-action-checked-count > span").text(jq.format(ASC.CRM.Resources.CRMJSResource.ElementsSelectedCount,n)),jq("#casesHeaderMenu .menu-action-checked-count").show()):(jq("#casesHeaderMenu .menu-action-checked-count > span").text(""),jq("#casesHeaderMenu .menu-action-checked-count").hide())},o=function(){jq("#caseTable tbody tr").remove();jq("#caseFilterContainer, #casesHeaderMenu, #caseList, #tableForCasesNavigation").hide();ASC.CRM.Common.hideExportButtons();jq("#emptyContentForCasesFilter").hide();jq("#casesEmptyScreen").show()},s=function(){jq("#caseTable tbody tr").remove();jq("#casesHeaderMenu, #caseList, #tableForCasesNavigation").hide();jq("#caseFilterContainer").show();ASC.CRM.Common.hideExportButtons();jq("#mainSelectAllCases").prop("disabled",!0);jq("#casesEmptyScreen").hide();jq("#emptyContentForCasesFilter").show()},h=function(n){for(var t=null,i=0,r=ASC.CRM.ListCasesView.casesList.length;i<r;i++)if(n==ASC.CRM.ListCasesView.casesList[i].id){t=ASC.CRM.ListCasesView.casesList[i];break}if(t!=null){jq("#caseActionMenu .editCaseLink").attr("href",jq.format("Cases.aspx?id={0}&action=manage",n));jq("#caseActionMenu .deleteCaseLink").off("click").on("click",function(){jq("#caseActionMenu").hide();jq("#caseTable .entity-menu.active").removeClass("active");ASC.CRM.ListCasesView.showConfirmationPanelForDelete(t.title,n,!0)});jq("#caseActionMenu .showProfileLink").attr("href",jq.format("Cases.aspx?id={0}",n));jq("#caseActionMenu .showProfileLinkNewTab").off("click").on("click",function(){jq("#caseActionMenu").hide();jq("#caseTable .entity-menu.active").removeClass("active");window.open(jq.format("Cases.aspx?id={0}",n),"_blank")});if(ASC.CRM.Data.IsCRMAdmin===!0||Teamlab.profile.id==t.createdBy.id){jq("#caseActionMenu .setPermissionsLink").show();jq("#caseActionMenu .setPermissionsLink").off("click").on("click",function(){jq("#caseActionMenu").hide();jq("#caseTable .entity-menu.active").removeClass("active");ASC.CRM.ListCasesView.deselectAll();ASC.CRM.ListCasesView.selectedItems.push(f(t));p({isBatch:!1})});jq("#caseActionMenu .dropdown-item-seporator:first").show()}else jq("#caseActionMenu .setPermissionsLink").hide(),jq("#caseActionMenu .dropdown-item-seporator:first").hide()}},g=function(n){var t=w(n);Teamlab.getCrmCases({startIndex:n||0},{filter:t,success:tt})},c=function(){var n=jq("#caseFilterContainer").is(":hidden")==!1;ASC.CRM.ListCasesView.isFilterVisible==!1&&n&&(ASC.CRM.ListCasesView.isFilterVisible=!0,ASC.CRM.ListCasesView.advansedFilter&&jq("#casesAdvansedFilter").advansedFilter("resize"))},nt=function(n,t){var i=jq.inArray(n.id,t);n.isChecked=i!=-1},tt=function(n,i){var f,h,u,e;if(ASC.CRM.ListCasesView.Total=n.__total||0,f=n.__startIndex||0,ASC.CRM.ListCasesView.Total===0&&typeof ASC.CRM.ListCasesView.advansedFilter!="undefined"&&ASC.CRM.ListCasesView.advansedFilter.advansedFilter().length==1?(ASC.CRM.ListCasesView.noCases=!0,ASC.CRM.ListCasesView.noCasesForQuery=!0):(ASC.CRM.ListCasesView.noCases=!1,ASC.CRM.ListCasesView.noCasesForQuery=ASC.CRM.ListCasesView.Total===0?!0:!1),ASC.CRM.ListCasesView.noCases)return o(),ASC.CRM.ListCasesView.isFirstLoad?r():LoadingBanner.hideLoading(),!1;if(ASC.CRM.ListCasesView.noCasesForQuery)return s(),c(),ASC.CRM.ListCasesView.isFirstLoad?r():LoadingBanner.hideLoading(),!1;if(i.length==0){for(jq("casesEmptyScreen").hide(),jq("#emptyContentForCasesFilter").hide(),jq("#caseList").show(),jq("#caseTable tbody tr").remove(),jq("#tableForCasesNavigation").show(),jq("#mainSelectAllCases").prop("disabled",!0),ASC.CRM.Common.hideExportButtons(),ASC.CRM.ListCasesView.Total=parseInt(jq("#totalCasesOnPage").text())||0,f=ASC.CRM.ListCasesView.entryCountOnPage*(window.casesPageNavigator.CurrentPageNumber-1);f>=ASC.CRM.ListCasesView.Total&&f>=ASC.CRM.ListCasesView.entryCountOnPage;)f-=ASC.CRM.ListCasesView.entryCountOnPage;return t(f),!1}for(jq("#totalCasesOnPage").text(ASC.CRM.ListCasesView.Total),jq("#emptyContentForCasesFilter").hide(),jq("#casesEmptyScreen").hide(),ASC.CRM.Common.showExportButtons(),jq("#caseFilterContainer").show(),c(),jq("#mainSelectAllCases").prop("disabled",!1),h=[],u=0,e=ASC.CRM.ListCasesView.selectedItems.length;u<e;u++)h.push(ASC.CRM.ListCasesView.selectedItems[u].id);for(u=0,e=i.length;u<e;u++)nt(i[u],h);ASC.CRM.ListCasesView.casesList=i;jq("#caseTable tbody").replaceWith(jq.tmpl("caseListTmpl",{cases:ASC.CRM.ListCasesView.casesList}));jq("#casesHeaderMenu, #caseList, #tableForCasesNavigation").show();ASC.CRM.ListCasesView.checkFullSelection();k(f);d();window.scrollTo(0,0);ScrolledGroupMenu.fixContentHeaderWidth(jq("#casesHeaderMenu"));ASC.CRM.ListCasesView.isFirstLoad?r():LoadingBanner.hideLoading()},r=function(){ASC.CRM.ListContactView.isFirstLoad=!1;jq(".containerBodyBlock").children(".loader-page").hide();jq("#casesEmptyScreen").is(":visible")||jq("#emptyContentForCasesFilter").is(":visible")||(jq("#caseFilterContainer, #casesHeaderMenu, #caseList, #tableForCasesNavigation").show(),jq("#casesAdvansedFilter").advansedFilter("resize"))},it=function(n,t){if(jq("#addTagCasesDialog").hide(),n.isNewTag){var t={value:n.tagName,title:n.tagName};window.caseTags.push(t);v(t);ASC.CRM.ListCasesView.advansedFilter=ASC.CRM.ListCasesView.advansedFilter.advansedFilter({nonetrigger:!0,sorters:[],filters:[{id:"tags",type:"combobox",options:ASC.CRM.Data.caseTags,enable:ASC.CRM.Data.caseTags.length>0}]})}},l=function(n){for(var l,f,y,e,p,w,a,h,c,v=[],r=0,b=ASC.CRM.ListCasesView.casesList.length;r<b;r++){for(l=!1,f=0,y=n.casesIDsForDelete.length;f<y;f++)if(n.casesIDsForDelete[f]==ASC.CRM.ListCasesView.casesList[r].id){l=!0;break}l||v.push(ASC.CRM.ListCasesView.casesList[r])}for(ASC.CRM.ListCasesView.casesList=v,ASC.CRM.ListCasesView.Total-=n.casesIDsForDelete.length,jq("#totalCasesOnPage").text(ASC.CRM.ListCasesView.Total),e=[],r=0,p=ASC.CRM.ListCasesView.selectedItems.length;r<p;r++)e.push(ASC.CRM.ListCasesView.selectedItems[r].id);for(r=0,w=n.casesIDsForDelete.length;r<w;r++)a=jq("#caseItem_"+n.casesIDsForDelete[r]),a.length!=0&&a.remove(),h=jq.inArray(n.casesIDsForDelete[r],e),h!=-1&&(e.splice(h,1),ASC.CRM.ListCasesView.selectedItems.splice(h,1));if(jq("#mainSelectAllCases").prop("checked",!1),u(),i(ASC.CRM.ListCasesView.selectedItems.length),ASC.CRM.ListCasesView.Total==0&&(typeof ASC.CRM.ListCasesView.advansedFilter=="undefined"||ASC.CRM.ListCasesView.advansedFilter.advansedFilter().length==1)?(ASC.CRM.ListCasesView.noCases=!0,ASC.CRM.ListCasesView.noCasesForQuery=!0):(ASC.CRM.ListCasesView.noCases=!1,ASC.CRM.ListCasesView.noCasesForQuery=ASC.CRM.ListCasesView.Total===0?!0:!1),PopupKeyUpActionProvider.EnableEsc=!0,ASC.CRM.ListCasesView.noCases)return o(),jq.unblockUI(),!1;if(ASC.CRM.ListCasesView.noCasesForQuery)return s(),jq.unblockUI(),!1;jq("#caseTable tbody tr").length==0?(jq.unblockUI(),c=ASC.CRM.ListCasesView.entryCountOnPage*(window.casesPageNavigator.CurrentPageNumber-1),c>=ASC.CRM.ListCasesView.Total&&(c-=ASC.CRM.ListCasesView.entryCountOnPage),t(c)):jq.unblockUI()},rt=function(n,t){for(var i,e,u,r=0,f=t.length;r<f;r++)for(i=0,e=ASC.CRM.ListCasesView.casesList.length;i<e;i++)if(u=t[r].id,u==ASC.CRM.ListCasesView.casesList[i].id){ASC.CRM.ListCasesView.casesList[i].isPrivate=t[r].isPrivate;jq("#caseItem_"+u).replaceWith(jq.tmpl("caseTmpl",ASC.CRM.ListCasesView.casesList[i]));n.isBatch?jq("#checkCase_"+u).prop("checked",!0):ASC.CRM.ListCasesView.selectedItems=[];break}PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()},a=function(){jq("#casesHeaderMenu .menuActionDelete").removeClass("unlockAction").off("click");jq("#casesHeaderMenu .menuActionAddTag").removeClass("unlockAction").off("click");jq("#casesHeaderMenu .menuActionPermissions").removeClass("unlockAction").off("click")},u=function(){var i=ASC.CRM.ListCasesView.selectedItems.length,t,n;if(i===0){a();return}for(t=!1,n=0;n<i;n++)if(ASC.CRM.Data.IsCRMAdmin===!0||ASC.CRM.ListCasesView.selectedItems[n].createdBy.id==Teamlab.profile.id){t=!0;break}t?jq("#casesHeaderMenu .menuActionPermissions:not('.unlockAction')").addClass("unlockAction"):jq("#casesHeaderMenu .menuActionPermissions.unlockAction").removeClass("unlockAction");jq("#casesHeaderMenu .menuActionDelete:not(.unlockAction)").addClass("unlockAction");jq("#casesHeaderMenu .menuActionAddTag:not(.unlockAction)").addClass("unlockAction")},v=function(n){var t=jq("<a><\/a>").addClass("dropdown-item").text(ASC.CRM.Common.convertText(n.title,!1)).on("click",function(){st(this)});jq("#addTagCasesDialog ul.dropdown-content").append(jq("<li><\/li>").append(t))},ut=function(){for(var n=0,t=ASC.CRM.Data.caseTags.length;n<t;n++)v(ASC.CRM.Data.caseTags[n]);jq.dropdownToggle({dropdownID:"addTagCasesDialog",switcherSelector:"#casesHeaderMenu .menuActionAddTag.unlockAction",addTop:5,addLeft:0,showFunction:function(){jq("#addTagCasesDialog input.textEdit").val("")}})},ft=function(){jq.dropdownToggle({dropdownID:"caseActionMenu",switcherSelector:"#caseTable .entity-menu",addTop:0,addLeft:10,rightPos:!0,beforeShowFunction:function(n){var t=n.attr("id").split("_")[1];t&&h(parseInt(t))},showFunction:function(n,t){jq("#caseTable .entity-menu.active").removeClass("active");t.is(":hidden")&&n.addClass("active")},hideFunction:function(){jq("#caseTable .entity-menu.active").removeClass("active")}});jq("body").off("contextmenu").on("contextmenu",function(n){var t=jq.fixEvent(n),i,r;return typeof t=="undefined"||!t?!0:(i=jq(t.srcElement||t.target),!i.parents("#caseTable").length)?(jq("#caseActionMenu").hide(),!0):(r=parseInt(i.closest("tr.with-entity-menu").attr("id").split("_")[1]),!r)?!0:(h(r),jq("#caseTable .entity-menu.active").removeClass("active"),jq.showDropDownByContext(t,i,jq("#caseActionMenu")),!1)})},et=function(){ScrolledGroupMenu.init({menuSelector:"#casesHeaderMenu",menuAnchorSelector:"#mainSelectAllCases",menuSpacerSelector:"main .filter-content .header-menu-spacer",userFuncInTop:function(){jq("#casesHeaderMenu .menu-action-on-top").hide()},userFuncNotInTop:function(){jq("#casesHeaderMenu .menu-action-on-top").show()}});jq("#casesHeaderMenu").on("click",".menuActionDelete.unlockAction",function(){ht()});jq("#casesHeaderMenu").on("click",".menuActionPermissions.unlockAction",function(){p({isBatch:!0})})},ot=function(){jq.tmpl("template-blockUIPanel",{id:"deleteCasesPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:ASC.CRM.Resources.CRMCommonResource.ConfirmationDeleteText,innerHtmlText:['<div id="deleteCasesList" class="containerForListBatchDelete mobile-overflow">',"<dl>",'<dt class="listForBatchDelete">',ASC.CRM.Resources.CRMCommonResource.CasesModuleName,":","<\/dt>",'<dd class="listForBatchDelete">',"<\/dd>","<\/dl>","<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMCasesResource.DeletingCases}).insertAfter("#caseList");jq("#deleteCasesPanel").on("click",".middle-button-container .button.blue",function(){ASC.CRM.ListCasesView.deleteBatchCases()});jq.tmpl("template-blockUIPanel",{id:"setPermissionsCasesPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.SetPermissions,innerHtmlText:"",OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,OKBtnClass:"setPermissionsLink",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMCommonResource.SaveChangesProggress}).insertAfter("#caseList");jq("#permissionsCasesPanelInnerHtml").insertBefore("#setPermissionsCasesPanel .containerBodyBlock .middle-button-container").removeClass("display-none")},st=function(n){var t={tagName:jq(n).text(),isNewTag:!1};y(t)},y=function(n){for(var i=[],t=0,r=ASC.CRM.ListCasesView.selectedItems.length;t<r;t++)i.push(ASC.CRM.ListCasesView.selectedItems[t].id);n.selectedIDs=i;Teamlab.addCrmTag(n,"case",n.selectedIDs,n.tagName,{success:it,before:function(n){for(var t=0,i=n.selectedIDs.length;t<i;t++)jq("#checkCase_"+n.selectedIDs[t]).hide(),jq("#loaderImg_"+n.selectedIDs[t]).show()},after:function(n){for(var t=0,i=n.selectedIDs.length;t<i;t++)jq("#loaderImg_"+n.selectedIDs[t]).hide(),jq("#checkCase_"+n.selectedIDs[t]).show()}})},ht=function(){var n,t,i;for(jq("#deleteCasesList dd.listForBatchDelete").html(""),n=0,t=ASC.CRM.ListCasesView.selectedItems.length;n<t;n++)i=jq("<label><\/label>").attr("title",ASC.CRM.ListCasesView.selectedItems[n].title).text(ASC.CRM.ListCasesView.selectedItems[n].title),jq("#deleteCasesList dd.listForBatchDelete").append(i.prepend(jq("<input>").attr("type","checkbox").prop("checked",!0).attr("id","case_"+ASC.CRM.ListCasesView.selectedItems[n].id)));LoadingBanner.hideLoaderBtn("#deleteCasesPanel");PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#deleteCasesPanel",500)},p=function(n){jq("#setPermissionsCasesPanel div.tintMedium").length>0&&(jq("#setPermissionsCasesPanel div.tintMedium span.header-base").remove(),jq("#setPermissionsCasesPanel div.tintMedium").removeClass("tintMedium").css("padding","0px"));jq("#isPrivate").prop("checked",!1);ASC.CRM.PrivatePanel.changeIsPrivateCheckBox();jq("#setPermissionsCasesPanel .addUserLink").useradvancedSelector("reset",!1);jq("#setPermissionsCasesPanel .advanced-selector-list>li.selected").removeClass("selected");window.SelectedUsers.IDs.clear();window.SelectedUsers.Names.clear();jq("#selectedUsers div.selectedUser[id^=selectedUser_]").remove();LoadingBanner.hideLoaderBtn("#setPermissionsCasesPanel");jq("#setPermissionsCasesPanel .setPermissionsLink").off("click").on("click",function(){ct(n)});PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#setPermissionsCasesPanel",600)},ct=function(n){var r=SelectedUsers.IDs,i,t,u,f;for(r.push(SelectedUsers.CurrentUserID),i=[],t=0,u=ASC.CRM.ListCasesView.selectedItems.length;t<u;t++)i.push(ASC.CRM.ListCasesView.selectedItems[t].id);f={casesid:i,isPrivate:jq("#isPrivate").is(":checked"),accessList:r};Teamlab.updateCrmCaseRights(n,f,{success:rt,before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.SaveChangesProggress;LoadingBanner.showLoaderBtn("#setPermissionsCasesPanel")},after:function(){LoadingBanner.hideLoaderBtn("#setPermissionsCasesPanel")}})},f=function(n){return{id:n.id,isClosed:n.isClosed,isPrivate:n.isPrivate,title:n.title,canEdit:n.canEdit,createdBy:n.createdBy}},lt=function(n){jq("#mainSelectAllCases").prop("checked",!1);jq("#tableForCasesNavigation select:first").val(n).on("change",function(){ASC.CRM.ListCasesView.changeCountOfRows(this.value)}).tlCombobox()},at=function(){jq("#casesAdvansedFilter").advansedFilter&&(ASC.CRM.ListCasesView.advansedFilter=jq("#casesAdvansedFilter").advansedFilter({anykey:!1,hintDefaultDisable:!1,maxfilters:-1,maxlength:"100",store:!0,inhash:!0,filters:[{type:"combobox",id:"opened",apiparamname:"isClosed",title:ASC.CRM.Resources.CRMJSResource.CaseStatusOpened,filtertitle:ASC.CRM.Resources.CRMCasesResource.CasesByStatus,group:ASC.CRM.Resources.CRMCasesResource.CasesByStatus,groupby:"caseStatus",options:[{value:!1,classname:"",title:ASC.CRM.Resources.CRMJSResource.CaseStatusOpened,def:!0},{value:!0,classname:"",title:ASC.CRM.Resources.CRMJSResource.CaseStatusClosed}]},{type:"combobox",id:"closed",apiparamname:"isClosed",title:ASC.CRM.Resources.CRMJSResource.CaseStatusClosed,filtertitle:ASC.CRM.Resources.CRMCasesResource.CasesByStatus,group:ASC.CRM.Resources.CRMCasesResource.CasesByStatus,groupby:"caseStatus",options:[{value:!1,classname:"",title:ASC.CRM.Resources.CRMJSResource.CaseStatusOpened},{value:!0,classname:"",title:ASC.CRM.Resources.CRMJSResource.CaseStatusClosed,def:!0}]},{type:"combobox",id:"tags",apiparamname:"tags",title:ASC.CRM.Resources.CRMCommonResource.FilterWithTag,group:ASC.CRM.Resources.CRMCommonResource.Other,options:ASC.CRM.Data.caseTags,defaulttitle:ASC.CRM.Resources.CRMCommonResource.Choose,enable:ASC.CRM.Data.caseTags.length>0,multiple:!0}],sorters:[{id:"title",title:ASC.CRM.Resources.CRMCommonResource.Title,dsc:!1,def:!0}]}).on("setfilter",ASC.CRM.ListCasesView.setFilter).on("resetfilter",ASC.CRM.ListCasesView.resetFilter))},vt=function(){var n=["<a class='link dotline plus' href='Cases.aspx?action=manage'>",ASC.CRM.Resources.CRMCasesResource.CreateFirstCase,"<\/a>"].join("");jq.browser.mobile!==!0&&(n+=["<br/><a class='crm-importLink link' href='Cases.aspx?action=import'>",ASC.CRM.Resources.CRMCasesResource.ImportCases,"<\/a>"].join(""));jq.tmpl("template-emptyScreen",{ID:"casesEmptyScreen",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_cases,Header:ASC.CRM.Resources.CRMCasesResource.EmptyContentCasesHeader,Describe:ASC.CRM.Resources.CRMCasesResource.EmptyContentCasesDescribe,ButtonHTML:n}).insertAfter("#caseList");jq.tmpl("template-emptyScreen",{ID:"emptyContentForCasesFilter",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_filter,Header:ASC.CRM.Resources.CRMCasesResource.EmptyContentCasesFilterHeader,Describe:ASC.CRM.Resources.CRMCasesResource.EmptyContentCasesFilterDescribe,ButtonHTML:["<a class='clearFilterButton link dotline' href='javascript:void(0);'","onclick='ASC.CRM.ListCasesView.advansedFilter.advansedFilter(null);'>",ASC.CRM.Resources.CRMCommonResource.ClearFilter,"<\/a>"].join("")}).insertAfter("#caseList")};return{casesList:[],selectedItems:[],isFilterVisible:!1,isFirstLoad:!0,entryCountOnPage:0,defaultCurrentPageNumber:0,noCases:!1,noCasesForQuery:!1,cookieKey:"",clear:function(){ASC.CRM.ListCasesView.casesList=[];ASC.CRM.ListCasesView.selectedItems=[];ASC.CRM.ListCasesView.isFilterVisible=!1;ASC.CRM.ListCasesView.entryCountOnPage=0;ASC.CRM.ListCasesView.defaultCurrentPageNumber=0;ASC.CRM.ListCasesView.noCases=!1;ASC.CRM.ListCasesView.noCasesForQuery=!1;ASC.CRM.ListCasesView.cookieKey="";ASC.CRM.ListCasesView.advansedFilter=null},init:function(t,i,r){var o,e;if(jq(t).length!=0){ASC.CRM.Common.setDocumentTitle(ASC.CRM.Resources.CRMCasesResource.AllCases);ASC.CRM.ListCasesView.clear();jq(t).removeClass("display-none");jq.tmpl("casesListFilterTmpl").appendTo(i);jq.tmpl("casesListBaseTmpl",{IsCRMAdmin:ASC.CRM.Data.IsCRMAdmin}).appendTo(t);jq.tmpl("casesListPagingTmpl").appendTo(r);jq("#privatePanelWrapper").appendTo("#permissionsCasesPanelInnerHtml");ASC.CRM.ListCasesView.cookieKey=ASC.CRM.Data.CookieKeyForPagination.cases;var f={page:1,countOnPage:jq("#tableForCasesNavigation select:first>option:first").val()},s=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+location.pathname+location.search,u=location.hash,h=encodeURIComponent(s);u=u&&typeof u=="string"&&u.charAt(0)==="#"?u.substring(1):u;o=jq.cookies.get(h);u==""||o==u?(e=ASC.CRM.Common.getPagingParamsFromCookie(ASC.CRM.ListCasesView.cookieKey),e!=null&&(f=e)):n(f.page,f.countOnPage);ASC.CRM.ListCasesView.entryCountOnPage=f.countOnPage;ASC.CRM.ListCasesView.defaultCurrentPageNumber=f.page;lt(ASC.CRM.ListCasesView.entryCountOnPage);vt();b(ASC.CRM.ListCasesView.entryCountOnPage,ASC.CRM.ListCasesView.defaultCurrentPageNumber);ut();ft();et();jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})});ASC.CRM.ListCasesView.initConfirmationPanelForDelete();ot();ASC.CRM.ListCasesView.isFirstLoad=!0;jq(".containerBodyBlock").children(".loader-page").show();at();ASC.CRM.PartialExport.init(ASC.CRM.ListCasesView.advansedFilter,"case")}},setFilter:function(){e()},resetFilter:function(){e()},selectAll:function(n){for(var h,t,e,s=jq(n).is(":checked"),o=[],r=0,c=ASC.CRM.ListCasesView.selectedItems.length;r<c;r++)o.push(ASC.CRM.ListCasesView.selectedItems[r].id);for(r=0,h=ASC.CRM.ListCasesView.casesList.length;r<h;r++)t=ASC.CRM.ListCasesView.casesList[r],e=jq.inArray(t.id,o),s&&e==-1&&(ASC.CRM.ListCasesView.selectedItems.push(f(t)),o.push(t.id),jq("#caseItem_"+t.id).addClass("selected"),jq("#checkCase_"+t.id).prop("checked",!0)),s||e==-1||(ASC.CRM.ListCasesView.selectedItems.splice(e,1),o.splice(e,1),jq("#caseItem_"+t.id).removeClass("selected"),jq("#checkCase_"+t.id).prop("checked",!1));i(ASC.CRM.ListCasesView.selectedItems.length);u()},selectItem:function(n){for(var r,o=parseInt(jq(n).attr("id").split("_")[1]),s=null,h=[],t=0,e=ASC.CRM.ListCasesView.casesList.length;t<e;t++)o==ASC.CRM.ListCasesView.casesList[t].id&&(s=f(ASC.CRM.ListCasesView.casesList[t]));for(t=0,e=ASC.CRM.ListCasesView.selectedItems.length;t<e;t++)h.push(ASC.CRM.ListCasesView.selectedItems[t].id);r=jq.inArray(o,h);jq(n).is(":checked")?(jq(n).parents("tr:first").addClass("selected"),r==-1&&ASC.CRM.ListCasesView.selectedItems.push(s),ASC.CRM.ListCasesView.checkFullSelection()):(jq("#mainSelectAllCases").prop("checked",!1),jq(n).parents("tr:first").removeClass("selected"),r!=-1&&ASC.CRM.ListCasesView.selectedItems.splice(r,1));i(ASC.CRM.ListCasesView.selectedItems.length);u()},deselectAll:function(){ASC.CRM.ListCasesView.selectedItems=[];i(0);jq("#caseTable input:checkbox").prop("checked",!1);jq("#mainSelectAllCases").prop("checked",!1);jq("#caseTable tr.selected").removeClass("selected");a()},checkFullSelection:function(){var n=jq("#caseTable tbody tr").length,t=jq("#caseTable input[id^=checkCase_]:checked").length;jq("#mainSelectAllCases").prop("checked",n==t)},deleteBatchCases:function(){var n=[],t;jq("#deleteCasesPanel input:checked").each(function(){n.push(parseInt(jq(this).attr("id").split("_")[1]))});t={casesIDsForDelete:n};Teamlab.removeCrmCase(t,n,{success:l,before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMCasesResource.DeletingCases;LoadingBanner.showLoaderBtn("#deleteCasesPanel")},after:function(){LoadingBanner.hideLoaderBtn("#deleteCasesPanel")}})},initConfirmationPanelForDelete:function(){jq.tmpl("template-blockUIPanel",{id:"confirmationDeleteOneCasePanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:['<div class="confirmationAction">',"<b><\/b>","<\/div>",'<div class="confirmationNote">',ASC.CRM.Resources.CRMJSResource.DeleteConfirmNote,"<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMJSResource.DeleteCaseInProgress}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first")},showConfirmationPanelForDelete:function(n,t,i){jq("#confirmationDeleteOneCasePanel .confirmationAction>b").text(jq.format(ASC.CRM.Resources.CRMJSResource.DeleteCaseConfirmMessage,Encoder.htmlDecode(n)));jq("#confirmationDeleteOneCasePanel .middle-button-container>.button.blue.middle").off("click").on("click",function(){ASC.CRM.ListCasesView.deleteCase(t,i)});PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#confirmationDeleteOneCasePanel",500)},deleteCase:function(n,t){var i,r;t===!0?(i=[],i.push(n),r={casesIDsForDelete:i},Teamlab.removeCrmCase(r,i,l)):Teamlab.removeCrmCase({},n,{before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMJSResource.DeleteCaseInProgress;LoadingBanner.showLoaderBtn("#confirmationDeleteOneCasePanel");jq("#crm_caseMakerDialog input, #crm_caseMakerDialog select, #crm_caseMakerDialog textarea").prop("disabled",!0);LoadingBanner.strLoading=ASC.CRM.Resources.CRMJSResource.DeleteCaseInProgress;LoadingBanner.showLoaderBtn("#crm_caseMakerDialog")},success:function(){ASC.CRM.Common.unbindOnbeforeUnloadEvent();location.href="Cases.aspx"}})},addNewTag:function(){var n=jq("#addTagCasesDialog input").val().trim(),t;if(n=="")return!1;t={tagName:n,isNewTag:!0};y(t)},changeCountOfRows:function(i){if(!isNaN(i)){var r=i*1;ASC.CRM.ListCasesView.entryCountOnPage=r;casesPageNavigator.EntryCountOnPage=r;n(1,r);t(0)}}}}();ASC.CRM.CasesActionView=function(){var t=function(){typeof casesEditCustomFieldList!="undefined"&&window.casesEditCustomFieldList.length!=0&&ASC.CRM.Common.renderCustomFields(window.casesEditCustomFieldList,"custom_field_","customFieldRowTmpl","#crm_caseMakerDialog dl.customFieldsContainer");jq.registerHeaderToggleClick("#crm_caseMakerDialog .case_info","dt.headerToggleBlock");jq("#crm_caseMakerDialog .case_info dt.headerToggleBlock").each(function(){jq(this).nextUntil("dt.headerToggleBlock").hide()});ASC.CRM.Common.initTextEditCalendars()},i=function(){jq.tmpl("template-blockUIPanel",{id:"confirmationGotoSettingsPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:['<div class="confirmationNote">',ASC.CRM.Resources.CRMJSResource.ConfirmGoToCustomFieldPage,"<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,OKBtnHref:"Settings.aspx?type=custom_field#case",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:""}).insertAfter("#otherCasesCustomFieldPanel");jq("#confirmationGotoSettingsPanel .button.blue").on("click",function(){ASC.CRM.Common.unbindOnbeforeUnloadEvent()})},r=function(){var i,t;if(window.casesActionSelectedContacts==""){i=function(n,t){t=="casesContactSelector"&&(jq("#selector_"+window.casesContactSelector.ObjName).children("div:first").children("div[id^='item_']").remove(),jq("#membersCasesSelectorsContainer").prev("dt").addClass("crm-headerHiddenToggledBlock"),jq(window).off("contactSelectorIsReady",i))};jq(window).on("contactSelectorIsReady",i)}window.casesContactSelector=new ASC.CRM.ContactSelector.ContactSelector("casesContactSelector",{SelectorType:ASC.CRM.Data.ContactSelectorTypeEnum.All,EntityType:0,EntityID:0,ShowOnlySelectorContent:!0,DescriptionText:ASC.CRM.Resources.CRMCommonResource.FindContactByName,DeleteContactText:ASC.CRM.Resources.CRMCommonResource.DeleteParticipant,AddContactText:ASC.CRM.Resources.CRMCommonResource.AddParticipant,IsInPopup:!1,ShowChangeButton:!1,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!1,ShowNewCompanyContent:!0,ShowNewContactContent:!0,HTMLParent:"#membersCasesSelectorsContainer",ExcludedArrayIDs:[],presetSelectedContactsJson:window.casesActionSelectedContacts});window.entityData&&window.entityData.id?ASC.CRM.ListContactView.renderSimpleContent(!0,!1):(t=parseInt(jq.getURLParam("contactID")),t&&window.casesContactSelector.SelectedContacts.length==1&&t==window.casesContactSelector.SelectedContacts[0]&&n(t,!1));window.casesContactSelector.SelectedContacts.length>0&&jq("#casesContactListBox").parent().removeClass("hiddenFields");window.casesContactSelector.SelectItemEvent=f;ASC.CRM.ListContactView.removeMember=e;jq(window).on("deleteContactFromSelector",function(){jq("#selector_"+window.casesContactSelector.ObjName).children("div:first").children("div[id^='item_']").length==1&&jq("#membersCasesSelectorsContainer").prev("dt").addClass("crm-headerHiddenToggledBlock")})},u=function(){jq("#crm_caseMakerDialog").on("keyup change paste","input, select, textarea",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()});jq("#crm_caseMakerDialog").on("click",".crm-deleteLink",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()});jq(window).on("addTagComplete deleteTagComplete setContactInSelector editContactInSelector deleteContactFromSelector advUserSelectorDeleteComplete advUserSelectorPushUserComplete",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()})},f=function(t,i){if(jq("#contactItem_"+t.id).length>0)return!1;if(i.newContact==!0){var r={canEdit:!0,displayName:t.displayName,id:t.id,isCompany:t.smallFotoUrl.indexOf("isc=true")!=-1,isPrivate:!1,isShared:!1,shareType:0,smallFotoUrl:t.smallFotoUrl};ASC.CRM.Common.contactItemFactory(r,{showUnlinkBtn:!0,showActionMenu:!1});jq.tmpl("simpleContactTmpl",r).prependTo("#contactTable tbody");jq("#casesContactListBox").parent().removeClass("hiddenFields");window.casesContactSelector.SelectedContacts.push(r.id);ASC.CRM.Common.RegisterContactInfoCard()}else n(t.id,!0)},n=function(n,t){Teamlab.getCrmContact({},n,{success:function(n,i){ASC.CRM.Common.contactItemFactory(i,{showUnlinkBtn:!0,showActionMenu:!1});jq.tmpl("simpleContactTmpl",i).prependTo("#contactTable tbody");jq("#casesContactListBox").parent().removeClass("hiddenFields");ASC.CRM.Common.RegisterContactInfoCard();t&&window.casesContactSelector.SelectedContacts.push(i.id)}})},e=function(n){jq("#trashImg_"+n).length==1&&(jq("#trashImg_"+n).hide(),jq("#loaderImg_"+n).show());var t=jq.inArray(n,window.casesContactSelector.SelectedContacts);t!=-1?window.casesContactSelector.SelectedContacts.splice(t,1):console.log("Can't find such contact in list");ASC.CRM.ContactSelector.Cache={};jq("#contactItem_"+n).animate({opacity:"hide"},500);setTimeout(function(){jq("#contactItem_"+n).remove();jq("#contactTable tr").length==0&&jq("#casesContactListBox").parent().addClass("hiddenFields")},500)};return{init:function(n){var o=jq.cookies.get(n),f,e,s,h;o!=null&&o!=""&&(jq.cookies.del(n),jq.tmpl("template-blockUIPanel",{id:"saveCasesError",headerTest:ASC.CRM.Resources.CRMCommonResource.Alert,questionText:"",innerHtmlText:["<div>",o,"<\/div>"].join(""),CancelBtn:ASC.CRM.Resources.CRMCommonResource.Close,progressText:""}).insertAfter("#crm_caseMakerDialog"),PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#saveCasesError",500));t();jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})});for(ASC.CRM.ListCasesView.initConfirmationPanelForDelete(),ASC.CRM.Data.IsCRMAdmin===!0&&i(),f=0,e=window.casesActionTags.length;f<e;f++)window.casesActionTags[f]=Encoder.htmlDecode(window.casesActionTags[f]);for(f=0,e=window.casesActionAvailableTags.length;f<e;f++)window.casesActionAvailableTags[f]=Encoder.htmlDecode(window.casesActionAvailableTags[f]);jq.tmpl("tagViewTmpl",{tags:window.casesActionTags,availableTags:window.casesActionAvailableTags}).appendTo("#tagsContainer>div:first");ASC.CRM.TagView.init("cases",!0);window.casesActionTags.length>0&&(jq("#tagsContainer>div:first").removeClass("display-none"),jq("#tagsContainer").prev().removeClass("crm-headerHiddenToggledBlock"));r();jq("#crm_caseMakerDialog").on("click",".crm-headerHiddenToggledBlock",function(){var n=jq(this).next("dd").attr("id");n=="membersCasesSelectorsContainer"?window.casesContactSelector.AddNewSelector(jq(this)):n=="tagsContainer"&&jq("#tagsContainer > div:first").removeClass("display-none");jq(this).removeClass("crm-headerHiddenToggledBlock")});if(s=parseInt(jq.getURLParam("id")),!isNaN(s)&&jq("#deleteCaseButton").length==1){h=jq("#deleteCaseButton").attr("caseTitle");jq("#deleteCaseButton").off("click").on("click",function(){ASC.CRM.ListCasesView.showConfirmationPanelForDelete(h,s,!1)})}jq(".cancelSbmtFormBtn:first").on("click",function(){return ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0});u()},submitForm:function(){var i,n,t,r,u;if(jq("[id*=saveCaseButton]:first").hasClass("postInProcess"))return!1;jq("[id*=saveCaseButton]:first").addClass("postInProcess");try{if(i=jq("#caseTitle").val().trim(),i=="")return AddRequiredErrorText(jq("#caseTitle"),ASC.CRM.Resources.CRMJSResource.ErrorEmptyCaseTitle),ShowRequiredError(jq("#caseTitle")),jq("[id*=saveCaseButton]:first").removeClass("postInProcess"),!1;if(LoadingBanner.strLoading=jq("#caseTypePage").html(),LoadingBanner.showLoaderBtn("#crm_caseMakerDialog"),jq("#crm_caseMakerDialog input[name=memberID]").val(window.casesContactSelector.SelectedContacts.join(",")),jq("#crm_caseMakerDialog .casePrivatePanel").length==1&&(jq("#isPrivate").is(":checked")||(window.SelectedUsers.IDs=[],jq("#notifyPrivate").prop("checked",!1)),jq("#isPrivateCase").val(jq("#isPrivate").is(":checked")),jq("#notifyPrivateUsers").val(jq("#cbxNotify").is(":checked")),jq("#selectedUsersCase").val(window.SelectedUsers.IDs.join(","))),ASC.CRM.TagView.prepareTagDataForSubmitForm(jq("#crm_caseMakerDialog input[name='baseInfo_assignedTags']")),n=jq("#crm_caseMakerDialog input[type='checkbox'][id^='custom_field_']"),n)for(t=0,r=n.length;t<r;t++)jq(n[t]).is(":checked")&&(u=n[t].id.replace("custom_field_",""),jq("#crm_caseMakerDialog input[name='customField_"+u+"']").val(jq(n[t]).is(":checked")));return ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0}catch(f){return console.log(f),jq("[id*=saveCaseButton]:first").removeClass("postInProcess"),!1}},showGotoAddSettingsPanel:function(){window.onbeforeunload==null?location.href="Settings.aspx?type=custom_field#case":(PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#confirmationGotoSettingsPanel",500))}}}();ASC.CRM.CasesFullCardView=function(){var t="/",n="caseFullCardToggledBlocks",i=function(){var r,u,i,e,f;jq.registerHeaderToggleClick("#caseProfile .crm-detailsTable","tr.headerToggleBlock");jq("#caseProfile .crm-detailsTable").on("click",".headerToggle, .openBlockLink, .closeBlockLink",function(){var f=jq(this).parents("tr.headerToggleBlock:first"),o=f.attr("data-toggleid"),s=f.hasClass("open"),i=jq.cookies.get(n),u,r,e;if(i!=null)i[o]=s;else for(i={},u=jq("#caseProfile .crm-detailsTable tr.headerToggleBlock"),r=0,e=u.length;r<e;r++)i[jq(u[r]).attr("data-toggleid")]=jq(u[r]).hasClass("open");jq.cookies.set(n,i,{path:t})});if(r=jq.cookies.get(n),r!=null)for(u=jq("#caseProfile .crm-detailsTable tr.headerToggleBlock"),i=0,e=u.length;i<e;i++)f=jq(u[i]).attr("data-toggleid"),r.hasOwnProperty(f)&&r[f]===!0&&jq(u[i]).addClass("open");else jq("#caseHistoryTable .headerToggleBlock").addClass("open");jq("#caseProfile .headerToggle").not("#caseProfile .headerToggleBlock.open .headerToggle").each(function(){jq(this).parents("tr.headerToggleBlock:first").nextUntil(".headerToggleBlock").hide()})},r=function(){if(typeof casesCustomFieldList!="undefined"&&window.casesCustomFieldList.length!=0){var n=ASC.CRM.Common.sortCustomFieldList(window.casesCustomFieldList);jq.tmpl("customFieldListTmpl",n).insertBefore("#caseHistoryTable")}},u=function(n){jq("#caseDetailsMenuPanel").hide();jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active");jq("#caseStatusSwitcher").text(n.isClosed===!0?ASC.CRM.Resources.CRMJSResource.CaseStatusClosed:ASC.CRM.Resources.CRMJSResource.CaseStatusOpened);n.isClosed===!0?(jq("#closeCase").hide(),jq("#openCase").show()):(jq("#openCase").hide(),jq("#closeCase").show())};return{init:function(){for(var n=0,t=window.caseTags.length;n<t;n++)window.caseTags[n]=Encoder.htmlDecode(window.caseTags[n]);for(n=0,t=window.caseAvailableTags.length;n<t;n++)window.caseAvailableTags[n]=Encoder.htmlDecode(window.caseAvailableTags[n]);jq.tmpl("tagViewTmpl",{tags:window.caseTags,availableTags:window.caseAvailableTags}).appendTo("#caseTagsTD");ASC.CRM.TagView.init("case",!1);typeof caseResponsibleIDs!="undefined"&&window.caseResponsibleIDs.length!=0&&jq("#caseProfile .caseAccessList").html(ASC.CRM.Common.getAccessListHtml(window.caseResponsibleIDs));r();i()},changeCaseStatus:function(n){var t=parseInt(jq.getURLParam("id")),i={caseid:t,isClosed:n==1};Teamlab.updateCrmCase(i,t,i,u)}}}();ASC.CRM.CasesDetailsView=function(){var n=["profile","tasks","contacts","files"],t=function(){var t=ASC.Controls.AnchorController.getAnchor();return(t==null||t==""||jq.inArray(t,n)==-1)&&(t="profile"),t},i=function(n){window.ASC.Controls.ClientTabsNavigator.init("CaseTabs",{tabs:[{title:ASC.CRM.Resources.CRMCommonResource.Profile,selected:n=="profile",anchor:"profile",divID:"profileTab",onclick:"ASC.CRM.CasesDetailsView.activateCurrentTab('profile');"},{title:ASC.CRM.Resources.CRMTaskResource.Tasks,selected:n=="tasks",anchor:"tasks",divID:"tasksTab",onclick:"ASC.CRM.CasesDetailsView.activateCurrentTab('tasks');"},{title:ASC.CRM.Resources.CRMCasesResource.PeopleInCase,selected:n=="contacts",anchor:"contacts",divID:"contactsTab",onclick:"ASC.CRM.CasesDetailsView.activateCurrentTab('contacts');"},{title:ASC.CRM.Resources.CRMCommonResource.Documents,selected:n=="files",anchor:"files",divID:"filesTab",onclick:"ASC.CRM.CasesDetailsView.activateCurrentTab('files');"}]})},r=function(){window.Attachments.init();window.Attachments.bind("addFile",function(n,t){var i=jq.getURLParam("id")*1,r="case",u=[];u.push(t.id);Teamlab.addCrmEntityFiles({},i,r,{entityid:i,entityType:r,fileids:u},{success:function(n,t){window.Attachments.appendFilesToLayout(t.files);n.fromAttachmentsControl=!0;ASC.CRM.HistoryView.isTabActive=!1}})});window.Attachments.bind("deleteFile",function(n,t){var i=jq("#fileContent_"+t),r;i.length!=0?(r=i.parents("[id^=eventAttach_]").attr("id").split("_")[1],ASC.CRM.HistoryView.deleteFile(t,r)):Teamlab.removeCrmEntityFiles({fileId:t},t,{success:function(n){window.Attachments.deleteFileFromLayout(n.fileId)},error:function(){toastr.error(ASC.CRM.Resources.CRMJSResource.ErrorMassage_SecurityException_DeleteEditingFile)}})})},u=function(){jq(document).ready(function(){jq.dropdownToggle({dropdownID:"caseDetailsMenuPanel",switcherSelector:".mainContainerClass .containerHeaderBlock .menu-small",addTop:0,addLeft:-10,showFunction:function(n,t){t.is(":hidden")?n.addClass("active"):n.removeClass("active")},hideFunction:function(){jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active")}})})},f=function(){var n={};window.caseResponsibleIDs.length!=0&&(n.taskResponsibleSelectorUserIDs=window.caseResponsibleIDs);jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,window.entityData.type,window.entityData.id,null,n)});ASC.CRM.ListTaskView.bindEmptyScrBtnEvent(n)},e=function(){jq.tmpl("template-emptyScreen",{ID:"emptyCaseParticipantPanel",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_case_participants,Header:ASC.CRM.Resources.CRMCasesResource.EmptyPeopleInCaseContent,Describe:ASC.CRM.Resources.CRMCasesResource.EmptyPeopleInCaseDescript,ButtonHTML:["<a class='link dotline plus' ",'onclick=\'javascript:jq("#caseParticipantPanel").show();jq("#emptyCaseParticipantPanel").addClass("display-none");\'>',ASC.CRM.Resources.CRMCommonResource.AddParticipant,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#contactListBox")},o=function(){window.casesContactSelector=new ASC.CRM.ContactSelector.ContactSelector("casesContactSelector",{SelectorType:-1,EntityType:0,EntityID:0,ShowOnlySelectorContent:!0,DescriptionText:ASC.CRM.Resources.CRMCommonResource.FindContactByName,DeleteContactText:"",AddContactText:"",IsInPopup:!1,ShowChangeButton:!1,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!1,ShowNewCompanyContent:!0,ShowNewContactContent:!0,presetSelectedContactsJson:"",ExcludedArrayIDs:[],HTMLParent:"#caseParticipantPanel"});window.casesContactSelector.SelectItemEvent=ASC.CRM.CasesDetailsView.addMemberToCase;ASC.CRM.ListContactView.removeMember=ASC.CRM.CasesDetailsView.removeMemberFromCase;jq(window).on("getContactsFromApi",function(n,t){var u=t.length,r,i;if(u==0)jq("#emptyCaseParticipantPanel.display-none").removeClass("display-none");else{for(jq("#caseParticipantPanel").show(),r=[],i=0;i<u;i++)r.push(t[i].id);casesContactSelector.SelectedContacts=r}})};return{init:function(){var n=t();i(n);ASC.CRM.ListContactView.isContentRendered=!1;e();o();ASC.CRM.HistoryView.init(0,window.entityData.type,window.entityData.id);ASC.CRM.ListTaskView.initTab(0,window.entityData.type,window.entityData.id);r();u();f();ASC.CRM.CasesDetailsView.activateCurrentTab(n)},activateCurrentTab:function(n){n=="profile";n=="tasks"&&ASC.CRM.ListTaskView.activate();n=="contacts"&&ASC.CRM.ListContactView.isContentRendered==!1&&(ASC.CRM.ListContactView.isContentRendered=!0,ASC.CRM.ListContactView.renderSimpleContent(!1,!0));n=="files"&&window.Attachments.loadFiles()},removeMemberFromCase:function(n){Teamlab.removeCrmEntityMember({contactID:parseInt(n)},window.entityData.type,window.entityData.id,n,{before:function(){jq("#simpleContactActionMenu").hide();jq("#contactTable .entity-menu.active").removeClass("active")},after:function(n){var t=jq.inArray(n.contactID,window.casesContactSelector.SelectedContacts);t!=-1?window.casesContactSelector.SelectedContacts.splice(t,1):console.log("Can't find such contact in list");ASC.CRM.ContactSelector.Cache={};jq("#contactItem_"+n.contactID).animate({opacity:"hide"},500);ASC.CRM.HistoryView.removeOption("contact",n.contactID);setTimeout(function(){jq("#contactItem_"+n.contactID).remove();window.casesContactSelector.SelectedContacts.length==0&&(jq("#caseParticipantPanel").hide(),jq("#emptyCaseParticipantPanel.display-none").removeClass("display-none"))},500)}})},addMemberToCase:function(n){if(jq("#contactItem_"+n.id).length>0)return!1;var t={contactid:n.id,caseid:entityData.id};Teamlab.addCrmEntityMember({showCompanyLink:!0,showUnlinkBtn:!1,showActionMenu:!0},entityData.type,entityData.id,n.id,t,{success:function(n,t){ASC.CRM.ListContactView.CallbackMethods.addMember(n,t);window.casesContactSelector.SelectedContacts.push(t.id);jq("#emptyCaseParticipantPanel:not(.display-none)").addClass("display-none");ASC.CRM.HistoryView.appendOption("contact",{value:t.id,title:t.displayName})}})}}}();
typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}}());ASC.CRM.myFilter={filterId:"dealsAdvansedFilter",idFilterByContact:"contactID",idFilterByParticipant:"participantID",type:"custom-contact",hiddenContainerId:"hiddenBlockForContactSelector",headerContainerId:"contactSelectorForFilter",onSelectContact:function(n,t){jq("#"+ASC.CRM.myFilter.headerContainerId).find(".inner-text .value").text(t.title);var i=jq("#"+ASC.CRM.myFilter.filterId);i.advansedFilter(ASC.CRM.myFilter.idFilterByContact,{id:t.id,displayName:t.title,value:jq.toJSON([t.id,!1])});i.advansedFilter("resize")},onSelectParticipant:function(n,t){jq("#"+ASC.CRM.myFilter.headerContainerId).find(".inner-text .value").text(t.title);var i=jq("#"+ASC.CRM.myFilter.filterId);i.advansedFilter(ASC.CRM.myFilter.idFilterByParticipant,{id:t.id,displayName:t.title,value:jq.toJSON([t.id,!0])});i.advansedFilter("resize")},createFilter:function(n){var t=document.createElement("div");return t.classList.add("default-value"),t.innerHTML=['<span class="title">',n.title,"<\/span>",'<span class="selector-wrapper">','<span class="contact-selector"><\/span>',"<\/span>",'<span class="btn-delete">&times;<\/span>',].join(""),t},customizeFilter:function(n,t,i){var u=t.attr("data-id")==ASC.CRM.myFilter.idFilterByParticipant,r=jq("#"+ASC.CRM.myFilter.headerContainerId);r.off("showList").on("showList",function(n,i){if(u)ASC.CRM.myFilter.onSelectParticipant(n,i);else ASC.CRM.myFilter.onSelectContact(n,i);t.removeClass("default-value")});return r.next().addBack().appendTo(t.find("span.contact-selector:first")),i.isset||setTimeout(function(){t.hasClass("default-value")&&r.trigger("click")},0),{}},destroyFilter:function(){var n=jq("#"+ASC.CRM.myFilter.headerContainerId);n.parent().is("#"+ASC.CRM.myFilter.hiddenContainerId)||(n.off("showList"),n.find(".inner-text .value").text(ASC.CRM.Resources.CRMCommonResource.Select),n.contactadvancedSelector("reset"),n.next().addBack().appendTo(jq("#"+ASC.CRM.myFilter.hiddenContainerId)))},processFilter:function(n,t,i,r){if(r&&r.id&&isFinite(r.id)){var u=jq("#"+ASC.CRM.myFilter.headerContainerId);u.find(".inner-text .value").text(r.displayName);u.contactadvancedSelector("select",[r.id]);t.removeClass("default-value")}}};ASC.CRM.ListDealView=function(){var n=function(n,t){if(ASC.CRM.ListDealView.cookieKey&&ASC.CRM.ListDealView.cookieKey!=""){var i={page:n,countOnPage:t};jq.cookies.set(ASC.CRM.ListDealView.cookieKey,i,{path:location.pathname})}},w=function(n){var t=ASC.CRM.ListDealView.getFilterSettings(n);Teamlab.getCrmOpportunities({startIndex:n||0},{filter:t,success:g})},e=function(){var n=jq("#dealFilterContainer").is(":hidden")==!1;ASC.CRM.ListDealView.isFilterVisible==!1&&n&&(ASC.CRM.ListDealView.isFilterVisible=!0,ASC.CRM.ListDealView.advansedFilter&&jq("#dealsAdvansedFilter").advansedFilter("resize"))},o=function(){ASC.CRM.ListDealView.deselectAll();var i=0;ASC.CRM.ListDealView.defaultCurrentPageNumber!=0?(n(ASC.CRM.ListDealView.defaultCurrentPageNumber,window.dealPageNavigator.EntryCountOnPage),i=(ASC.CRM.ListDealView.defaultCurrentPageNumber-1)*window.dealPageNavigator.EntryCountOnPage,ASC.CRM.ListDealView.defaultCurrentPageNumber=0):n(0,window.dealPageNavigator.EntryCountOnPage);t(0||i)},t=function(n){ASC.CRM.ListDealView.dealList=[];ASC.CRM.ListDealView.bidList=[];ASC.CRM.ListDealView.isFirstLoad||(LoadingBanner.displayLoading(),jq("#dealFilterContainer, #dealHeaderMenu, #dealList, #tableForDealNavigation").show(),jq("#dealsAdvansedFilter").advansedFilter("resize"));jq("#mainSelectAllDeals").prop("checked",!1);w(n)},b=function(i,r){window.dealPageNavigator=new ASC.Controls.PageNavigator.init("dealPageNavigator","#divForDealPager",i,ASC.CRM.Data.VisiblePageCount,r,ASC.CRM.Resources.CRMJSResource.Previous,ASC.CRM.Resources.CRMJSResource.Next);window.dealPageNavigator.changePageCallback=function(i){n(i,window.dealPageNavigator.EntryCountOnPage);var r=window.dealPageNavigator.EntryCountOnPage*(i-1);t(r)}},k=function(n){var t;t=n>=ASC.CRM.ListDealView.Total?n+1:ASC.CRM.ListDealView.Total;window.dealPageNavigator.drawPageNavigator((n/ASC.CRM.ListDealView.entryCountOnPage).toFixed(0)*1+1,t)},d=function(){jq("#dealHeaderMenu .menu-action-simple-pagenav").html("");var n=jq("<div><\/div>"),t=0;jq("#divForDealPager .pagerPrevButtonCSSClass").length!=0&&(t++,jq("#divForDealPager .pagerPrevButtonCSSClass").clone().appendTo(n));jq("#divForDealPager .pagerNextButtonCSSClass").length!=0&&(t++,t===2&&jq("<span style='padding: 0 8px;'>&nbsp;<\/span>").clone().appendTo(n),jq("#divForDealPager .pagerNextButtonCSSClass").clone().appendTo(n));n.children().length!=0?(n.appendTo("#dealHeaderMenu .menu-action-simple-pagenav"),jq("#dealHeaderMenu .menu-action-simple-pagenav").show()):jq("#dealHeaderMenu .menu-action-simple-pagenav").hide()},i=function(n){n!=0?(jq("#dealHeaderMenu .menu-action-checked-count > span").text(jq.format(ASC.CRM.Resources.CRMJSResource.ElementsSelectedCount,n)),jq("#dealHeaderMenu .menu-action-checked-count").show()):(jq("#dealHeaderMenu .menu-action-checked-count > span").text(""),jq("#dealHeaderMenu .menu-action-checked-count").hide())},s=function(){jq("#dealTable tbody tr").remove();jq("#dealFilterContainer, #dealHeaderMenu, #dealList, #tableForDealNavigation").hide();ASC.CRM.Common.hideExportButtons();jq("#emptyContentForDealsFilter:not(.display-none)").addClass("display-none");jq("#dealsEmptyScreen.display-none").removeClass("display-none")},h=function(){jq("#dealTable tbody tr").remove();jq("#dealHeaderMenu, #dealList, #tableForDealNavigation").hide();jq("#dealFilterContainer").show();ASC.CRM.Common.hideExportButtons();jq("#mainSelectAllDeals").prop("disabled",!0);jq("#dealsEmptyScreen:not(.display-none)").addClass("display-none");jq("#emptyContentForDealsFilter.display-none").removeClass("display-none")},g=function(n,i){var c,f,u,o;for(ASC.CRM.ListDealView.Total=n.__total||0,f=n.__startIndex||0,c=[],u=0,o=ASC.CRM.ListDealView.selectedItems.length;u<o;u++)c.push(ASC.CRM.ListDealView.selectedItems[u].id);for(ASC.CRM.ListDealView.bidList=[],u=0,o=i.length;u<o;u++)ASC.CRM.ListDealView._dealItemFactory(i[u],c);if(ASC.CRM.ListDealView.dealList=i,jq(window).trigger("getDealsFromApi",[n,i]),ASC.CRM.ListDealView.Total===0&&typeof ASC.CRM.ListDealView.advansedFilter!="undefined"&&ASC.CRM.ListDealView.advansedFilter.advansedFilter().length==1?(ASC.CRM.ListDealView.noDeals=!0,ASC.CRM.ListDealView.noDealsForQuery=!0):(ASC.CRM.ListDealView.noDeals=!1,ASC.CRM.ListDealView.noDealsForQuery=ASC.CRM.ListDealView.Total===0?!0:!1),ASC.CRM.ListDealView.noDeals)return s(),ASC.CRM.ListDealView.isFirstLoad?r():LoadingBanner.hideLoading(),!1;if(ASC.CRM.ListDealView.noDealsForQuery)return h(),e(),ASC.CRM.ListDealView.isFirstLoad?r():LoadingBanner.hideLoading(),!1;if(i.length==0){for(jq("dealsEmptyScreen:not(.display-none)").addClass("display-none"),jq("#emptyContentForDealsFilter:not(.display-none)").addClass("display-none"),jq("#dealList").show(),jq("#dealTable tbody tr").remove(),jq("#tableForDealsNavigation").show(),jq("#mainSelectAllDeals").prop("disabled",!0),ASC.CRM.Common.hideExportButtons(),ASC.CRM.ListDealView.Total=parseInt(jq("#totalDealsOnPage").text())||0,f=ASC.CRM.ListDealView.entryCountOnPage*(window.dealPageNavigator.CurrentPageNumber-1);f>=ASC.CRM.ListDealView.Total&&f>=ASC.CRM.ListDealView.entryCountOnPage;)f-=ASC.CRM.ListDealView.entryCountOnPage;return t(f),!1}for(jq("#totalDealsOnPage").text(ASC.CRM.ListDealView.Total),jq("#emptyContentForDealsFilter:not(.display-none)").addClass("display-none"),jq("#dealsEmptyScreen:not(.display-none)").addClass("display-none"),ASC.CRM.Common.showExportButtons(),jq("#dealFilterContainer, #dealHeaderMenu, #tableForDealNavigation").show(),e(),jq("#mainSelectAllDeals").prop("disabled",!1),jq("#dealTable tbody").replaceWith(jq.tmpl("dealListTmpl",{opportunities:ASC.CRM.ListDealView.dealList})),jq("#dealList").show(),ASC.CRM.ListDealView.checkFullSelection(),ASC.CRM.Common.RegisterContactInfoCard(),u=0,o=ASC.CRM.ListDealView.dealList.length;u<o;u++)ASC.CRM.Common.tooltip("#dealTitle_"+ASC.CRM.ListDealView.dealList[u].id,"tooltip");k(f);d();ASC.CRM.ListDealView.bidList.length==0?jq("#dealList .showTotalAmount").hide():jq("#dealList .showTotalAmount").show();window.scrollTo(0,0);ScrolledGroupMenu.fixContentHeaderWidth(jq("#dealHeaderMenu"));ASC.CRM.ListDealView.isFirstLoad?r():LoadingBanner.hideLoading()},nt=function(n,t){if(jq("#addTagDealsDialog").hide(),n.isNewTag){var t={value:n.tagName,title:n.tagName};ASC.CRM.Data.dealTags.push(t);v(t);ASC.CRM.ListDealView.advansedFilter=ASC.CRM.ListDealView.advansedFilter.advansedFilter({nonetrigger:!0,sorters:[],filters:[{id:"tags",type:"combobox",options:ASC.CRM.Data.dealTags,enable:ASC.CRM.Data.dealTags.length>0}]})}},c=function(n){for(var f,v,o,w,e,b,c,k,d,y,l,a,p=[],r=0,g=ASC.CRM.ListDealView.dealList.length;r<g;r++){for(f=ASC.CRM.ListDealView.dealList[r],v=!1,o=0,w=n.dealsIDsForDelete.length;o<w;o++)if(n.dealsIDsForDelete[o]==f.id){v=!0;break}if(v){if(f.bidValue)for(e=0,b=ASC.CRM.ListDealView.bidList.length;e<b;e++)if(ASC.CRM.ListDealView.bidList[e].bidCurrencyAbbreviation==f.bidCurrency.abbreviation){ASC.CRM.ListDealView.bidList[e].bidValue-=f.bidValue*(f.perPeriodValue?f.perPeriodValue:1);break}}else p.push(f)}for(ASC.CRM.ListDealView.dealList=p,ASC.CRM.ListDealView.Total-=n.dealsIDsForDelete.length,jq("#totalDealsOnPage").text(ASC.CRM.ListDealView.Total),c=[],r=0,k=ASC.CRM.ListDealView.selectedItems.length;r<k;r++)c.push(ASC.CRM.ListDealView.selectedItems[r].id);for(r=0,d=n.dealsIDsForDelete.length;r<d;r++)y=jq("#dealItem_"+n.dealsIDsForDelete[r]),y.length!=0&&y.remove(),l=jq.inArray(n.dealsIDsForDelete[r],c),l!=-1&&(c.splice(l,1),ASC.CRM.ListDealView.selectedItems.splice(l,1));if(jq("#mainSelectAllDeals").prop("checked",!1),u(),i(ASC.CRM.ListDealView.selectedItems.length),ASC.CRM.ListDealView.Total==0&&(typeof ASC.CRM.ListDealView.advansedFilter=="undefined"||ASC.CRM.ListDealView.advansedFilter.advansedFilter().length==1)?(ASC.CRM.ListDealView.noDeals=!0,ASC.CRM.ListDealView.noDealsForQuery=!0):(ASC.CRM.ListDealView.noDeals=!1,ASC.CRM.ListDealView.noDealsForQuery=ASC.CRM.ListDealView.Total===0?!0:!1),PopupKeyUpActionProvider.EnableEsc=!0,ASC.CRM.ListDealView.noDeals)return s(),jq.unblockUI(),!1;if(ASC.CRM.ListDealView.noDealsForQuery)return h(),jq.unblockUI(),!1;jq("#dealTable tbody tr").length==0?(jq.unblockUI(),a=ASC.CRM.ListDealView.entryCountOnPage*(dealPageNavigator.CurrentPageNumber-1),a>=ASC.CRM.ListDealView.Total&&(a-=ASC.CRM.ListDealView.entryCountOnPage),t(a)):jq.unblockUI()},tt=function(n,t){for(var i,e,u,r=0,f=t.length;r<f;r++)for(i=0,e=ASC.CRM.ListDealView.dealList.length;i<e;i++)if(u=t[r].id,u==ASC.CRM.ListDealView.dealList[i].id){ASC.CRM.ListDealView.dealList[i].isPrivate=t[r].isPrivate;jq("#dealItem_"+u).replaceWith(jq.tmpl("dealTmpl",ASC.CRM.ListDealView.dealList[i]));n.isBatch?jq("#checkDeal_"+u).prop("checked",!0):ASC.CRM.ListDealView.selectedItems=[];break}ASC.CRM.Common.RegisterContactInfoCard();PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI()},r=function(){ASC.CRM.ListContactView.isFirstLoad=!1;jq(".containerBodyBlock").children(".loader-page").hide();jq("#dealsEmptyScreen").is(":visible")||jq("#emptyContentForDealsFilter")||(jq("#dealFilterContainer, #dealHeaderMenu, #dealList, #tableForDealNavigation").show(),jq("#dealsAdvansedFilter").advansedFilter("resize"))},l=function(n){for(var r,u,t=null,i=0,e=ASC.CRM.ListDealView.dealList.length;i<e;i++)if(n==ASC.CRM.ListDealView.dealList[i].id){t=ASC.CRM.ListDealView.dealList[i];break}if(t!=null){jq("#dealActionMenu .editDealLink").attr("href",jq.format("Deals.aspx?id={0}&action=manage",n));jq("#dealActionMenu .deleteDealLink").off("click").on("click",function(){jq("#dealActionMenu").hide();jq("#dealTable .entity-menu.active").removeClass("active");ASC.CRM.ListDealView.showConfirmationPanelForDelete(t.title,n,!0)});jq("#dealActionMenu .showProfileLink").attr("href",jq.format("Deals.aspx?id={0}",n));jq("#dealActionMenu .showProfileLinkNewTab").off("click").on("click",function(){jq("#dealActionMenu").hide();jq("#dealTable .entity-menu.active").removeClass("active");window.open(jq.format("Deals.aspx?id={0}",n),"_blank")});if(r=!1,ASC.CRM.Data.IsCRMAdmin===!0||Teamlab.profile.id==t.createdBy.id){jq("#dealActionMenu .setPermissionsLink").show();jq("#dealActionMenu .setPermissionsLink").off("click").on("click",function(){jq("#dealActionMenu").hide();jq("#dealTable .entity-menu.active").removeClass("active");ASC.CRM.ListDealView.deselectAll();ASC.CRM.ListDealView.selectedItems.push(f(t));p({isBatch:!1})});r=!0}else jq("#dealActionMenu .setPermissionsLink").hide();if(ASC.CRM.Data.IsCRMAdmin===!0&&jq("#dealActionMenu .createProject").length==1){u=StudioManager.getLocationPathToModule("Projects")+"Projects.aspx?action=add&opportunityID=";jq("#dealActionMenu .createProject").attr("href",u+n);jq("#dealActionMenu .createProject").off("click").on("click",function(){jq("#dealTable .entity-menu.active").removeClass("active");jq("#dealActionMenu").hide()});r=!0}r?jq("#dealActionMenu .dropdown-item-seporator:first").show():jq("#dealActionMenu .dropdown-item-seporator:first").hide()}},a=function(){jq("#dealHeaderMenu .menuActionDelete").removeClass("unlockAction");jq("#dealHeaderMenu .menuActionAddTag").removeClass("unlockAction");jq("#dealHeaderMenu .menuActionPermissions").removeClass("unlockAction")},u=function(){var i=ASC.CRM.ListDealView.selectedItems.length,t,n;if(i===0){a();return}for(t=!1,n=0;n<i;n++)if(ASC.CRM.Data.IsCRMAdmin===!0||ASC.CRM.ListDealView.selectedItems[n].createdBy.id==Teamlab.profile.id){t=!0;break}t?jq("#dealHeaderMenu .menuActionPermissions:not('.unlockAction')").addClass("unlockAction"):jq("#dealHeaderMenu .menuActionPermissions.unlockAction").removeClass("unlockAction");jq("#dealHeaderMenu .menuActionDelete:not('.unlockAction')").addClass("unlockAction");jq("#dealHeaderMenu .menuActionAddTag:not('.unlockAction')").addClass("unlockAction")},v=function(n){var t=jq("<a><\/a>").addClass("dropdown-item").text(ASC.CRM.Common.convertText(n.title,!1)).on("click",function(){et(this)});jq("#addTagDealsDialog ul.dropdown-content").append(jq("<li><\/li>").append(t))},it=function(){for(var n=0,t=ASC.CRM.Data.dealTags.length;n<t;n++)v(ASC.CRM.Data.dealTags[n]);jq.dropdownToggle({dropdownID:"addTagDealsDialog",switcherSelector:"#dealHeaderMenu .menuActionAddTag.unlockAction",addTop:5,addLeft:0,showFunction:function(){jq("#addTagDealsDialog input.textEdit").val("")}})},rt=function(){jq.dropdownToggle({dropdownID:"dealActionMenu",switcherSelector:"#dealTable .entity-menu",addTop:0,addLeft:10,rightPos:!0,beforeShowFunction:function(n){var t=n.attr("id").split("_")[1];t&&l(parseInt(t))},showFunction:function(n,t){jq("#dealTable .entity-menu.active").removeClass("active");t.is(":hidden")&&n.addClass("active")},hideFunction:function(){jq("#dealTable .entity-menu.active").removeClass("active")}});jq("body").off("contextmenu").on("contextmenu",function(n){var t=jq.fixEvent(n),i,r;return typeof t=="undefined"||!t?!0:(i=jq(t.srcElement||t.target),!i.parents("#dealTable").length)?(jq("#dealActionMenu").hide(),!0):(r=parseInt(i.closest("tr.with-entity-menu").attr("id").split("_")[1]),!r)?!0:(l(r),jq("#dealTable .entity-menu.active").removeClass("active"),jq.showDropDownByContext(t,i,jq("#dealActionMenu")),!1)})},ut=function(){ScrolledGroupMenu.init({menuSelector:"#dealHeaderMenu",menuAnchorSelector:"#mainSelectAllDeals",menuSpacerSelector:"main .filter-content .header-menu-spacer",userFuncInTop:function(){jq("#dealHeaderMenu .menu-action-on-top").hide()},userFuncNotInTop:function(){jq("#dealHeaderMenu .menu-action-on-top").show()}});jq("#dealHeaderMenu").on("click",".menuActionDelete.unlockAction",function(){ot()});jq("#dealHeaderMenu").on("click",".menuActionPermissions.unlockAction",function(){p({isBatch:!0})})},ft=function(){jq.tmpl("template-blockUIPanel",{id:"deleteDealsPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:ASC.CRM.Resources.CRMCommonResource.ConfirmationDeleteText,innerHtmlText:['<div id="deleteDealsList" class="containerForListBatchDelete mobile-overflow">',"<dl>",'<dt class="listForBatchDelete">',ASC.CRM.Resources.CRMDealResource.Deals,":","<\/dt>",'<dd class="listForBatchDelete">',"<\/dd>","<\/dl>","<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMDealResource.DeletingDeals}).insertAfter("#dealList");jq("#deleteDealsPanel").on("click",".middle-button-container .button.blue",function(){ASC.CRM.ListDealView.deleteBatchDeals()});jq.tmpl("template-blockUIPanel",{id:"setPermissionsDealsPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.SetPermissions,innerHtmlText:"",OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,OKBtnClass:"setPermissionsLink",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMCommonResource.SaveChangesProggress}).insertAfter("#dealList");jq("#permissionsDealsPanelInnerHtml").insertBefore("#setPermissionsDealsPanel .containerBodyBlock .middle-button-container").removeClass("display-none")},et=function(n){var t={tagName:jq(n).text(),isNewTag:!1};y(t)},y=function(n){for(var i=[],t=0,r=ASC.CRM.ListDealView.selectedItems.length;t<r;t++)i.push(ASC.CRM.ListDealView.selectedItems[t].id);n.selectedIDs=i;Teamlab.addCrmTag(n,"opportunity",n.selectedIDs,n.tagName,{success:nt,before:function(n){for(var t=0,i=n.selectedIDs.length;t<i;t++)jq("#checkDeal_"+n.selectedIDs[t]).hide(),jq("#loaderImg_"+n.selectedIDs[t]).show()},after:function(n){for(var t=0,i=n.selectedIDs.length;t<i;t++)jq("#loaderImg_"+n.selectedIDs[t]).hide(),jq("#checkDeal_"+n.selectedIDs[t]).show()}})},ot=function(){var n,t,i;for(jq("#deleteDealsList dd.listForBatchDelete").html(""),n=0,t=ASC.CRM.ListDealView.selectedItems.length;n<t;n++)i=jq("<label><\/label>").attr("title",ASC.CRM.ListDealView.selectedItems[n].title).text(ASC.CRM.ListDealView.selectedItems[n].title),jq("#deleteDealsList dd.listForBatchDelete").append(i.prepend(jq("<input>").attr("type","checkbox").prop("checked",!0).attr("id","deal_"+ASC.CRM.ListDealView.selectedItems[n].id)));LoadingBanner.hideLoaderBtn("#deleteDealsPanel");PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#deleteDealsPanel",500)},p=function(n){jq("#setPermissionsDealsPanel div.tintMedium").length>0&&(jq("#setPermissionsDealsPanel div.tintMedium span.header-base").remove(),jq("#setPermissionsDealsPanel div.tintMedium").removeClass("tintMedium").css("padding","0px"));jq("#isPrivate").prop("checked",!1);ASC.CRM.PrivatePanel.changeIsPrivateCheckBox();jq("#setPermissionsDealsPanel .addUserLink").useradvancedSelector("reset",!1);jq("#setPermissionsDealsPanel .advanced-selector-list>li.selected").removeClass("selected");window.SelectedUsers.IDs.clear();window.SelectedUsers.Names.clear();jq("#selectedUsers div.selectedUser[id^=selectedUser_]").remove();LoadingBanner.hideLoaderBtn("#setPermissionsDealsPanel");jq("#setPermissionsDealsPanel .setPermissionsLink").off("click").on("click",function(){st(n)});PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#setPermissionsDealsPanel",600)},st=function(n){var i=window.SelectedUsers.IDs,r=[],t,u,f;for(i.push(window.SelectedUsers.CurrentUserID),t=0,u=ASC.CRM.ListDealView.selectedItems.length;t<u;t++)r.push(ASC.CRM.ListDealView.selectedItems[t].id);f={opportunityid:r,isPrivate:jq("#isPrivate").is(":checked"),accessList:i};Teamlab.updateCrmOpportunityRights(n,f,{success:tt,before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMCommonResource.SaveChangesProggress;LoadingBanner.showLoaderBtn("#setPermissionsDealsPanel")},after:function(){LoadingBanner.hideLoaderBtn("#setPermissionsDealsPanel")}})},f=function(n){return{id:n.id,isClosed:n.isClosed,isPrivate:n.isPrivate,title:n.title,canEdit:n.canEdit,createdBy:n.createdBy}},ht=function(n){jq("#mainSelectAllDeals").prop("checked",!1);jq("#tableForDealNavigation select:first").val(n).on("change",function(){ASC.CRM.ListDealView.changeCountOfRows(this.value)}).tlCombobox()},ct=function(){var n=["<a class='link dotline plus' href='Deals.aspx?action=manage'>",ASC.CRM.Resources.CRMDealResource.CreateFirstDeal,"<\/a>"].join("");jq.browser.mobile!=!0&&(n+=["<br/><a class='crm-importLink link' href='Deals.aspx?action=import'>",ASC.CRM.Resources.CRMDealResource.ImportDeals,"<\/a>"].join(""));jq.tmpl("template-emptyScreen",{ID:"dealsEmptyScreen",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_deals,Header:ASC.CRM.Resources.CRMDealResource.EmptyContentDealsHeader,Describe:jq.format(ASC.CRM.Resources.CRMDealResource.EmptyContentDealsDescribe,"<span class='hintStages baseLinkAction'>","<\/span>"),ButtonHTML:n,CssClass:"display-none"}).insertAfter("#dealList");jq.tmpl("template-emptyScreen",{ID:"emptyContentForDealsFilter",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_filter,Header:ASC.CRM.Resources.CRMDealResource.EmptyContentDealsFilterHeader,Describe:ASC.CRM.Resources.CRMDealResource.EmptyContentDealsFilterDescribe,ButtonHTML:["<a class='clearFilterButton link dotline' href='javascript:void(0);' onclick='ASC.CRM.ListDealView.advansedFilter.advansedFilter(null);'>",ASC.CRM.Resources.CRMCommonResource.ClearFilter,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#dealList")},lt=function(){if(jq("#dealsAdvansedFilter").advansedFilter){var r=new Date,i=new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0),c=new Date(new Date(i).setDate(r.getDate()-1)),s=new Date(new Date(i).setDate(1)),l=new Date(i.getFullYear(),i.getMonth()+1,0),h=new Date(new Date(s).setDate(s.getDate()-1)),a=new Date(new Date(h).setDate(1)),n=Teamlab.serializeTimestamp(i),t=Teamlab.serializeTimestamp(c),u=Teamlab.serializeTimestamp(s),f=Teamlab.serializeTimestamp(l),e=Teamlab.serializeTimestamp(a),o=Teamlab.serializeTimestamp(h);ASC.CRM.ListDealView.advansedFilter=jq("#dealsAdvansedFilter").advansedFilter({anykey:!1,hintDefaultDisable:!1,maxfilters:-1,colcount:2,maxlength:"100",store:!0,inhash:!0,filters:[{type:"person",id:"my",apiparamname:"responsibleID",title:ASC.CRM.Resources.CRMCommonResource.My,group:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible,groupby:"responsible",filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible,enable:!0,bydefault:{id:Teamlab.profile.id,value:Teamlab.profile.id}},{type:"person",id:"responsibleID",apiparamname:"responsibleID",title:ASC.CRM.Resources.CRMDealResource.CustomResponsibleFilter,group:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible,groupby:"responsible",filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByResponsible},{type:"combobox",id:"lastMonth",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.LastMonth,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByDate,groupby:"byDate",options:[{value:jq.toJSON([e,o]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth,def:!0},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([u,f]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"yesterday",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.Yesterday,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByDate,groupby:"byDate",options:[{value:jq.toJSON([e,o]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday,def:!0},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([u,f]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"today",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.Today,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByDate,groupby:"byDate",options:[{value:jq.toJSON([e,o]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today,def:!0},{value:jq.toJSON([u,f]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"thisMonth",apiparamname:jq.toJSON(["fromDate","toDate"]),title:ASC.CRM.Resources.CRMCommonResource.ThisMonth,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByDate,groupby:"byDate",options:[{value:jq.toJSON([e,o]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([u,f]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth,def:!0}]},{type:"daterange",id:"fromToDate",title:ASC.CRM.Resources.CRMDealResource.CustomDateFilter,filtertitle:ASC.CRM.Resources.CRMCommonResource.FilterByDate,group:ASC.CRM.Resources.CRMCommonResource.FilterByDate,groupby:"byDate"},{type:ASC.CRM.myFilter.type,id:ASC.CRM.myFilter.idFilterByParticipant,apiparamname:jq.toJSON(["contactID","contactAlsoIsParticipant"]),title:ASC.CRM.Resources.CRMDealResource.FilterByParticipant,group:ASC.CRM.Resources.CRMCommonResource.Other,groupby:"contact",hashmask:"",create:ASC.CRM.myFilter.createFilter,customize:ASC.CRM.myFilter.customizeFilter,destroy:ASC.CRM.myFilter.destroyFilter,process:ASC.CRM.myFilter.processFilter},{type:ASC.CRM.myFilter.type,id:ASC.CRM.myFilter.idFilterByContact,apiparamname:jq.toJSON(["contactID","contactAlsoIsParticipant"]),title:ASC.CRM.Resources.CRMDealResource.FilterByContact,group:ASC.CRM.Resources.CRMCommonResource.Other,groupby:"contact",hashmask:"",create:ASC.CRM.myFilter.createFilter,customize:ASC.CRM.myFilter.customizeFilter,destroy:ASC.CRM.myFilter.destroyFilter,process:ASC.CRM.myFilter.processFilter},{type:"combobox",id:"tags",apiparamname:"tags",title:ASC.CRM.Resources.CRMCommonResource.FilterWithTag,group:ASC.CRM.Resources.CRMCommonResource.Other,options:ASC.CRM.Data.dealTags,defaulttitle:ASC.CRM.Resources.CRMCommonResource.Choose,enable:ASC.CRM.Data.dealTags.length>0,multiple:!0},{type:"combobox",id:"opportunityStagesID",apiparamname:"opportunityStagesID",title:ASC.CRM.Resources.CRMDealResource.ByStage,group:ASC.CRM.Resources.CRMDealResource.FilterByStageOrStageType,groupby:"stageType",options:ASC.CRM.Data.dealMilestones,defaulttitle:ASC.CRM.Resources.CRMCommonResource.Choose,enable:ASC.CRM.Data.dealMilestones.length>0},{type:"combobox",id:"stageTypeOpen",apiparamname:"stageType",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_Open,group:ASC.CRM.Resources.CRMDealResource.FilterByStageOrStageType,filtertitle:ASC.CRM.Resources.CRMDealResource.ByStageType,groupby:"stageType",options:[{value:"Open",classname:"",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_Open,def:!0},{value:"ClosedAndWon",classname:"",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_ClosedAndWon},{value:"ClosedAndLost",classname:"",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_ClosedAndLost}]},{type:"combobox",id:"stageTypeClosedAndWon",apiparamname:"stageType",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_ClosedAndWon,filtertitle:ASC.CRM.Resources.CRMDealResource.ByStageType,group:ASC.CRM.Resources.CRMDealResource.FilterByStageOrStageType,groupby:"stageType",options:[{value:"Open",classname:"",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_Open},{value:"ClosedAndWon",classname:"",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_ClosedAndWon,def:!0},{value:"ClosedAndLost",classname:"",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_ClosedAndLost}]},{type:"combobox",id:"stageTypeClosedAndLost",apiparamname:"stageType",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_ClosedAndLost,filtertitle:ASC.CRM.Resources.CRMDealResource.ByStageType,group:ASC.CRM.Resources.CRMDealResource.FilterByStageOrStageType,groupby:"stageType",options:[{value:"Open",classname:"",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_Open},{value:"ClosedAndWon",classname:"",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_ClosedAndWon},{value:"ClosedAndLost",classname:"",title:ASC.CRM.Resources.CRMEnumResource.DealMilestoneStatus_ClosedAndLost,def:!0}]}],sorters:[{id:"title",title:ASC.CRM.Resources.CRMCommonResource.Title,dsc:!1,def:!1},{id:"responsible",title:ASC.CRM.Resources.CRMCommonResource.Responsible,dsc:!1,def:!1},{id:"stage",title:ASC.CRM.Resources.CRMDealResource.DealMilestone,dsc:!1,def:!0},{id:"bidvalue",title:ASC.CRM.Resources.CRMDealResource.ExpectedValue,dsc:!1,def:!1},{id:"dateandtime",title:ASC.CRM.Resources.CRMDealResource.Estimated,dsc:!1,def:!1}]}).on("setfilter",ASC.CRM.ListDealView.setFilter).on("resetfilter",ASC.CRM.ListDealView.resetFilter)}};return{contactID:0,dealList:[],bidList:[],selectedItems:[],isFilterVisible:!1,entryCountOnPage:0,defaultCurrentPageNumber:0,noDeals:!1,noDealsForQuery:!1,cookieKey:"",clear:function(){ASC.CRM.ListDealView.contactID=0;ASC.CRM.ListDealView.dealList=[];ASC.CRM.ListDealView.bidList=[];ASC.CRM.ListDealView.selectedItems=[];ASC.CRM.ListDealView.isFilterVisible=!1;ASC.CRM.ListDealView.entryCountOnPage=0;ASC.CRM.ListDealView.defaultCurrentPageNumber=0;ASC.CRM.ListDealView.noDeals=!1;ASC.CRM.ListDealView.noDealsForQuery=!1;ASC.CRM.ListDealView.cookieKey="";ASC.CRM.ListDealView.advansedFilter=null},init:function(t,i,r){var o,e;if(jq(t).length!=0){ASC.CRM.Common.setDocumentTitle(ASC.CRM.Resources.CRMDealResource.MyDeals);ASC.CRM.ListDealView.clear();jq(t).removeClass("display-none");jq.tmpl("dealsListFilterTmpl").appendTo(i);jq.tmpl("dealsListBaseTmpl",{IsCRMAdmin:ASC.CRM.Data.IsCRMAdmin,CanCreateProjects:ASC.CRM.Data.CanCreateProjects}).appendTo(t);jq.tmpl("dealsListPagingTmpl").appendTo(r);jq("#privatePanelWrapper").appendTo("#permissionsDealsPanelInnerHtml");ASC.CRM.ListDealView.cookieKey=ASC.CRM.Data.CookieKeyForPagination.deals;var f={page:1,countOnPage:jq("#tableForDealNavigation select:first>option:first").val()},s=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+location.pathname+location.search,u=location.hash,h=encodeURIComponent(s);u=u&&typeof u=="string"&&u.charAt(0)==="#"?u.substring(1):u;o=jq.cookies.get(h);u==""||o==u?(e=ASC.CRM.Common.getPagingParamsFromCookie(ASC.CRM.ListDealView.cookieKey),e!=null&&(f=e)):n(f.page,f.countOnPage);ASC.CRM.ListDealView.entryCountOnPage=f.countOnPage;ASC.CRM.ListDealView.defaultCurrentPageNumber=f.page;ht(ASC.CRM.ListDealView.entryCountOnPage);ct();jq.tmpl("dealExtendedListTmpl",{contactID:0}).prependTo("#dealList");b(ASC.CRM.ListDealView.entryCountOnPage,ASC.CRM.ListDealView.defaultCurrentPageNumber);it();rt();ut();jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})});ASC.CRM.ListDealView.initConfirmationPanelForDelete();ft();jq("#"+ASC.CRM.myFilter.headerContainerId).contactadvancedSelector({showme:!0,addtext:ASC.CRM.Resources.CRMContactResource.AddNewCompany,noresults:ASC.CRM.Resources.CRMCommonResource.NoMatches,noitems:ASC.CRM.Resources.CRMCommonResource.NoMatches,inPopup:!0,onechosen:!0,isTempLoad:!0});ASC.CRM.ListDealView.isFirstLoad=!0;jq(".containerBodyBlock").children(".loader-page").show();lt();ASC.CRM.PartialExport.init(ASC.CRM.ListDealView.advansedFilter,"opportunity")}},setFilter:function(){o()},resetFilter:function(){o()},getFilterSettings:function(n){var t,i;return(n=n||0,t={startIndex:n,count:ASC.CRM.ListDealView.entryCountOnPage},!ASC.CRM.ListDealView.advansedFilter)?t:(i=ASC.CRM.ListDealView.advansedFilter.advansedFilter(),jq(i).each(function(n,i){var r,u,n,f;switch(i.id){case"sorter":t.sortBy=i.params.id;t.sortOrder=i.params.dsc==!0?"descending":"ascending";break;case"text":t.filterValue=i.params.value;break;case"fromToDate":t.fromDate=new Date(i.params.from);t.toDate=new Date(i.params.to);break;default:if(i.hasOwnProperty("apiparamname")&&i.params.hasOwnProperty("value")&&i.params.value!=null)try{for(r=JSON.parse(i.apiparamname),u=JSON.parse(i.params.value),r.length!=u.length&&(t[i.apiparamname]=i.params.value),n=0,f=r.length;n<f;n++)t[r[n]]=u[n]}catch(e){t[i.apiparamname]=i.params.value}}}),t)},_dealItemFactory:function(n,t){var r,i,u,f;n.isOverdue=!1;switch(n.stage.stageType){case 1:n.closedStatusString=ASC.CRM.Resources.CRMJSResource.SuccessfullyClosed+": "+n.actualCloseDateString;n.classForTitle="linkHeaderMedium gray-text";break;case 2:n.closedStatusString=ASC.CRM.Resources.CRMJSResource.UnsuccessfullyClosed+": "+n.actualCloseDateString;n.classForTitle="linkHeaderMedium gray-text";break;case 0:n.closedStatusString="";n.expectedCloseDateString!=""&&n.expectedCloseDate<new Date?(n.isOverdue=!0,n.classForTitle="linkHeaderMedium red-text"):n.classForTitle="linkHeaderMedium"}if(n.bidNumberFormat=ASC.CRM.Common.numberFormat(n.bidValue,{before:n.bidCurrency.symbol,thousands_sep:" ",dec_point:ASC.CRM.Data.CurrencyDecimalSeparator}),typeof n.bidValue!="undefined"&&n.bidValue!=0){for(typeof n.perPeriodValue=="undefined"&&(n.perPeriodValue=0),r=!1,i=0,u=ASC.CRM.ListDealView.bidList.length;i<u;i++)if(ASC.CRM.ListDealView.bidList[i].bidCurrencyAbbreviation==n.bidCurrency.abbreviation){ASC.CRM.ListDealView.bidList[i].bidValue+=n.bidValue*(n.perPeriodValue!=0?n.perPeriodValue:1);r=!0;break}r||ASC.CRM.ListDealView.bidList.push({bidValue:n.bidValue*(n.perPeriodValue!=0?n.perPeriodValue:1),bidCurrencyAbbreviation:n.bidCurrency.abbreviation,bidCurrencySymbol:n.bidCurrency.symbol,isConvertable:n.bidCurrency.isConvertable})}f=jq.inArray(n.id,t);n.isChecked=f!=-1},expectedValue:function(n,t){switch(n){case 1:return ASC.CRM.Resources.CRMJSResource.BidType_PerHour+" "+jq.format(ASC.CRM.Resources.CRMJSResource.PerPeriodHours,t);case 2:return ASC.CRM.Resources.CRMJSResource.BidType_PerDay+" "+jq.format(ASC.CRM.Resources.CRMJSResource.PerPeriodDays,t);case 3:return ASC.CRM.Resources.CRMJSResource.BidType_PerWeek+" "+jq.format(ASC.CRM.Resources.CRMJSResource.PerPeriodWeeks,t);case 4:return ASC.CRM.Resources.CRMJSResource.BidType_PerMonth+" "+jq.format(ASC.CRM.Resources.CRMJSResource.PerPeriodMonths,t);case 5:return ASC.CRM.Resources.CRMJSResource.BidType_PerYear+" "+jq.format(ASC.CRM.Resources.CRMJSResource.PerPeriodYears,t);default:return""}},changeCountOfRows:function(i){if(!isNaN(i)){var r=i*1;ASC.CRM.ListDealView.entryCountOnPage=r;dealPageNavigator.EntryCountOnPage=r;n(1,r);t(0)}},showExchangeRatePopUp:function(){ASC.CRM.ListDealView.bidList.length!=0&&(ASC.CRM.ExchangeRateView.init(ASC.CRM.ListDealView.bidList),jq("#ExchangeRateTabs>a:first").trigger("click"),PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#exchangeRatePopUp",550))},selectAll:function(n){for(var h,t,e,s=jq(n).is(":checked"),o=[],r=0,c=ASC.CRM.ListDealView.selectedItems.length;r<c;r++)o.push(ASC.CRM.ListDealView.selectedItems[r].id);for(r=0,h=ASC.CRM.ListDealView.dealList.length;r<h;r++)t=ASC.CRM.ListDealView.dealList[r],e=jq.inArray(t.id,o),s&&e==-1&&(ASC.CRM.ListDealView.selectedItems.push(f(t)),o.push(t.id),jq("#dealItem_"+t.id).addClass("selected"),jq("#checkDeal_"+t.id).prop("checked",!0)),s||e==-1||(ASC.CRM.ListDealView.selectedItems.splice(e,1),o.splice(e,1),jq("#dealItem_"+t.id).removeClass("selected"),jq("#checkDeal_"+t.id).prop("checked",!1));i(ASC.CRM.ListDealView.selectedItems.length);u()},selectItem:function(n){for(var o=parseInt(jq(n).attr("id").split("_")[1]),s=null,h=[],r=0,t=0,e=ASC.CRM.ListDealView.dealList.length;t<e;t++)o==ASC.CRM.ListDealView.dealList[t].id&&(s=f(ASC.CRM.ListDealView.dealList[t]));for(t=0,e=ASC.CRM.ListDealView.selectedItems.length;t<e;t++)h.push(ASC.CRM.ListDealView.selectedItems[t].id);r=jq.inArray(o,h);jq(n).is(":checked")?(jq(n).parents("tr:first").addClass("selected"),r==-1&&ASC.CRM.ListDealView.selectedItems.push(s),ASC.CRM.ListDealView.checkFullSelection()):(jq("#mainSelectAllDeals").prop("checked",!1),jq(n).parents("tr:first").removeClass("selected"),r!=-1&&ASC.CRM.ListDealView.selectedItems.splice(r,1));i(ASC.CRM.ListDealView.selectedItems.length);u()},deselectAll:function(){ASC.CRM.ListDealView.selectedItems=[];i(0);jq("#dealTable input:checkbox").prop("checked",!1);jq("#mainSelectAllDeals").prop("checked",!1);jq("#dealTable tr.selected").removeClass("selected");a()},checkFullSelection:function(){var n=jq("#dealTable tbody tr").length,t=jq("#dealTable input[id^=checkDeal_]:checked").length;jq("#mainSelectAllDeals").prop("checked",n==t)},deleteBatchDeals:function(){var n=[],t=null;jq("#deleteDealsPanel input:checked").each(function(){n.push(parseInt(jq(this).attr("id").split("_")[1]))});t={dealsIDsForDelete:n};Teamlab.removeCrmOpportunity(t,n,{success:c,before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMDealResource.DeletingDeals;LoadingBanner.showLoaderBtn("#deleteDealsPanel")},after:function(){LoadingBanner.hideLoaderBtn("#deleteDealsPanel")}})},initConfirmationPanelForDelete:function(){jq.tmpl("template-blockUIPanel",{id:"confirmationDeleteOneDealPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:['<div class="confirmationAction">',"<b><\/b>","<\/div>",'<div class="confirmationNote">',ASC.CRM.Resources.CRMJSResource.DeleteConfirmNote,"<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMJSResource.DeleteDealInProgress}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first")},showConfirmationPanelForDelete:function(n,t,i){jq("#confirmationDeleteOneDealPanel .confirmationAction>b").text(jq.format(ASC.CRM.Resources.CRMJSResource.DeleteDealConfirmMessage,Encoder.htmlDecode(n)));jq("#confirmationDeleteOneDealPanel .middle-button-container>.button.blue.middle").off("click").on("click",function(){ASC.CRM.ListDealView.deleteDeal(t,i)});PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#confirmationDeleteOneDealPanel",500)},deleteDeal:function(n,t){var i,r,u;t===!0?(i=[],i.push(n),r={dealsIDsForDelete:i},Teamlab.removeCrmOpportunity(r,i,c)):(u=jq.getURLParam("contact_id")||"",Teamlab.removeCrmOpportunity({contact_id:u.trim()},n,{before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMJSResource.DeleteDealInProgress;LoadingBanner.showLoaderBtn("#confirmationDeleteOneDealPanel");jq("#crm_dealMakerDialog input, #crm_dealMakerDialog select, #crm_dealMakerDialog textarea").prop("disabled",!0);LoadingBanner.strLoading=ASC.CRM.Resources.CRMJSResource.DeleteDealInProgress;LoadingBanner.showLoaderBtn("#crm_dealMakerDialog")},success:function(n){ASC.CRM.Common.unbindOnbeforeUnloadEvent();location.href=n.contact_id!=""?jq.format("Default.aspx?id={0}#deals",n.contact_id):"Deals.aspx"}}))},addNewTag:function(){var n=jq("#addTagDealsDialog input").val().trim(),t;if(n=="")return!1;t={tagName:n,isNewTag:!0};y(t)}}}();ASC.CRM.DealActionView=function(){var n=function(){var n,i,t;typeof customFieldList!="undefined"&&window.customFieldList.length!=0&&ASC.CRM.Common.renderCustomFields(customFieldList,"custom_field_","customFieldRowTmpl","#crm_dealMakerDialog .deal_info dl:last");jq.registerHeaderToggleClick("#crm_dealMakerDialog .deal_info","dt.headerToggleBlock");jq("#crm_dealMakerDialog .deal_info dt.headerToggleBlock").each(function(){jq(this).nextUntil("dt.headerToggleBlock").hide()});ASC.CRM.Common.initTextEditCalendars();jq.forceNumber({parent:"#crm_dealMakerDialog",input:"#perPeriodValue, #probability",integerOnly:!0,positiveOnly:!0});jq("#probability").on("focusout",function(){var n=jq("#probability").val().trim();n!=""&&n*1>100&&jq("#probability").val(100)});for(jq.forceNumber({parent:"#crm_dealMakerDialog",input:"#bidValue",integerOnly:!1,positiveOnly:!0,separator:ASC.CRM.Data.CurrencyDecimalSeparator,lengthAfterSeparator:null}),n=0,i=window.dealMilestones.length;n<i;n++)t=window.dealMilestones[n],jq("<option>").attr("value",t.id).text(t.title).appendTo(jq("#dealMilestone"));jq("#probability").val(window.dealMilestones[jq("#dealMilestone")[0].selectedIndex].probability)},t=function(){jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})})},i=function(){jq.tmpl("template-blockUIPanel",{id:"confirmationGotoSettingsPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:['<div class="confirmationNote">',ASC.CRM.Resources.CRMJSResource.ConfirmGoToCustomFieldPage,"<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,OKBtnHref:"Settings.aspx?type=custom_field#opportunity",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:""}).insertAfter("#otherDealsCustomFieldPanel");jq("#confirmationGotoSettingsPanel .button.blue").on("click",function(){ASC.CRM.Common.unbindOnbeforeUnloadEvent()})},r=function(){jq(window).on("contactSelectorIsReady",function(n,t){if(t=="dealClientSelector"){jq("#selectorContent_dealClientSelector_0 .crm-addNewLink").parent().remove();jq("#newContactContent_dealClientSelector_0 .crm-addNewLink").remove();jq("#infoContent_dealClientSelector_0 .crm-addNewLink").removeAttr("onclick");jq("#infoContent_dealClientSelector_0 .crm-addNewLink").on("click",function(){jq("#item_dealClientSelector_0").addClass("hasMembers");jq("div[id^='item_dealMemberSelector_']").length==0&&window.dealMemberSelector.AddNewSelector(jq(this));jq("#dealMembersHeader").show();jq("#dealMembersBody").show()})}t=="dealMemberSelector"&&window.dealMemberSelector.SelectedContacts.length!=0&&jq("#item_dealClientSelector_0").addClass("hasMembers")});window.dealClientSelector=new ASC.CRM.ContactSelector.ContactSelector("dealClientSelector",{SelectorType:ASC.CRM.Data.ContactSelectorTypeEnum.CompaniesAndPersonsWithoutCompany,EntityType:0,EntityID:0,ShowOnlySelectorContent:!1,DescriptionText:ASC.CRM.Resources.CRMCommonResource.FindContactByName,DeleteContactText:ASC.CRM.Resources.CRMCommonResource.DeleteParticipant,AddContactText:"",IsInPopup:!1,ShowChangeButton:window.hasDealTargetClient?!1:!0,ShowAddButton:!0,ShowDeleteButton:!1,ShowContactImg:!0,ShowNewCompanyContent:!0,ShowNewContactContent:!0,HTMLParent:"#dealClientContainer",ExcludedArrayIDs:window.dealMembersIDs,presetSelectedContactsJson:window.presetClientContactsJson});window.dealMemberSelector=new ASC.CRM.ContactSelector.ContactSelector("dealMemberSelector",{SelectorType:ASC.CRM.Data.ContactSelectorTypeEnum.All,EntityType:0,EntityID:0,ShowOnlySelectorContent:!0,DescriptionText:ASC.CRM.Resources.CRMCommonResource.FindContactByName,DeleteContactText:ASC.CRM.Resources.CRMCommonResource.DeleteParticipant,AddContactText:ASC.CRM.Resources.CRMCommonResource.AddParticipant,IsInPopup:!1,ShowChangeButton:!1,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!1,ShowNewCompanyContent:!0,ShowNewContactContent:!0,HTMLParent:"#dealMembersBody",ExcludedArrayIDs:window.dealClientIDs,presetSelectedContactsJson:window.presetMemberContactsJson});ASC.CRM.ListContactView.renderSimpleContent(!0,!1);jq(window).on("renderSimpleContactListReady",function(){window.dealClientIDs!=null&&window.dealClientIDs.length==1&&jq("#contactItem_"+window.dealClientIDs[0]).remove();window.dealMemberSelector.SelectedContacts.length>0&&jq(".assignedDealContacts").removeClass("hiddenFields")});window.dealMemberSelector.SelectItemEvent=o;ASC.CRM.ListContactView.removeMember=s;window.showMembersPanel===!0&&(jq("#dealMembersHeader").show(),jq("#dealMembersBody").show());jq(window).on("editContactInSelector deleteContactFromSelector",function(n,t,i){i=="dealClientSelector"&&(window.dealMemberSelector.ExcludedArrayIDs=[])});jq("#infoContent_dealClientSelector_0 .crm-removeLink").on("click",function(){window.dealMemberSelector.ExcludedArrayIDs=[]});window.dealClientSelector.SelectItemEvent=h},u=function(){var f,r,e,i,n,t,u;if(jq("#advUserSelectorResponsible").useradvancedSelector({showme:!1,inPopup:!1,onechosen:!0,showGroups:!0,withGuests:!1}),ASC.CRM.Data.isCrmAvailableForAllUsers==!1){for(f=[],i=jq("#advUserSelectorResponsible").data("items"),t=0,u=ASC.CRM.Data.crmAvailableWithAdminList.length;t<u;t++)for(r=0,e=i.length;r<e;r++)if(ASC.CRM.Data.crmAvailableWithAdminList[t].id==i[r].id){f.push(i[r]);continue}jq("#advUserSelectorResponsible").useradvancedSelector("rewriteItemList",f,[])}for(i=jq("#advUserSelectorResponsible").data("items")||[],n=null,t=0,u=i.length;t<u;t++)if(i[t].id==window.responsibleId){n=i[t];break}n!=null?(jq("#advUserSelectorResponsible").useradvancedSelector("select",[window.responsibleId]),jq("#advUserSelectorResponsible").attr("data-responsible-id",window.responsibleId),jq("#advUserSelectorResponsible .dealResponsibleLabel").text(Encoder.htmlDecode(n.title))):(n=window.UserManager.getUser(window.responsibleId),n!=null?(jq("#advUserSelectorResponsible").attr("data-responsible-id",n.id),jq("#advUserSelectorResponsible .dealResponsibleLabel").text(Encoder.htmlDecode(n.displayName+(n.isTerminated?" ("+ASC.CRM.Resources.DisabledEmployeeTitle.toLowerCase()+")":"")))):(n=window.UserManager.getRemovedProfile(),jq("#advUserSelectorResponsible").attr("data-responsible-id",""),jq("#advUserSelectorResponsible .dealResponsibleLabel").text(Encoder.htmlDecode(n.displayName))));jq("#advUserSelectorResponsible").on("showList",function(n,t){ASC.CRM.Common.bindOnbeforeUnloadEvent();jq("#advUserSelectorResponsible").attr("data-responsible-id",t.id);jq("#advUserSelectorResponsible .dealResponsibleLabel").text(Encoder.htmlDecode(t.title))})},f=function(){jq("#nameDeal").val(window.targetDeal.title);jq("#descriptionDeal").val(window.targetDeal.description);jq("#bidValue").val(window.targetDeal.bid_value.toString().replace(/[\.\,]/g,ASC.CRM.Data.CurrencyDecimalSeparator));jq(jq.format("#bidCurrency option[value={0}]",window.targetDeal.bid_currency)).prop("selected","selected");window.targetDeal.bid_type>0&&(jq(jq.format("#bidType [value={0}]",window.targetDeal.bid_type)).prop("selected","selected"),jq("#bidType").nextAll().show(),jq("#perPeriodValue").val(window.targetDeal.per_period_value),jq("#bidType").trigger("change"));jq("#probability").val(window.targetDeal.deal_milestone_probability);jq("#expectedCloseDate").val(window.targetDeal.expected_close_date);jq(jq.format("#dealMilestone option[value={0}]",window.targetDeal.deal_milestone)).prop("selected","selected");jq("#contactID").val("contact_id");jq("#deleteDealButton").off("click").on("click",function(){ASC.CRM.ListDealView.showConfirmationPanelForDelete(jq.htmlEncodeLight(window.targetDeal.title),window.targetDeal.id,!1)})},e=function(){jq("#crm_dealMakerDialog").on("keyup change paste","input, select, textarea",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()});jq("#crm_dealMakerDialog").on("click",".crm-deleteLink",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()});jq(window).on("addTagComplete deleteTagComplete setContactInSelector editContactInSelector deleteContactFromSelector",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()})},o=function(n,t){if(jq("#contactItem_"+n.id).length>0)return!1;if(t.newContact==!0){var i={canEdit:!0,displayName:n.displayName,id:n.id,isCompany:n.smallFotoUrl.indexOf("isc=true")!=-1,isPrivate:!1,isShared:!1,shareType:0,smallFotoUrl:n.smallFotoUrl};ASC.CRM.Common.contactItemFactory(i,{showUnlinkBtn:!0,showActionMenu:!1});jq.tmpl("simpleContactTmpl",i).prependTo("#contactTable tbody");jq(".assignedDealContacts").removeClass("hiddenFields");window.dealMemberSelector.SelectedContacts.push(i.id);window.dealClientSelector.ExcludedArrayIDs.push(i.id);window.dealClientSelector.Cache={};ASC.CRM.Common.RegisterContactInfoCard()}else Teamlab.getCrmContact({},n.id,{success:function(n,t){ASC.CRM.Common.contactItemFactory(t,{showUnlinkBtn:!0,showActionMenu:!1});jq.tmpl("simpleContactTmpl",t).prependTo("#contactTable tbody");jq(".assignedDealContacts").removeClass("hiddenFields");ASC.CRM.Common.RegisterContactInfoCard();window.dealMemberSelector.SelectedContacts.push(t.id);window.dealClientSelector.ExcludedArrayIDs.push(t.id)}})},s=function(n){jq("#trashImg_"+n).length==1&&(jq("#trashImg_"+n).hide(),jq("#loaderImg_"+n).show());window.dealClientSelector.Cache={};window.dealMemberSelector.Cache={};window.dealMemberSelector.SelectedContacts.length==1&&(jq("#dealMembersHeader").hide(),jq("#dealMembersBody").hide(),jq(".assignedDealContacts").addClass("hiddenFields"),jq("#item_dealClientSelector_0").removeClass("hasMembers"));var t=jq.inArray(n,window.dealMemberSelector.SelectedContacts);t!=-1?window.dealMemberSelector.SelectedContacts.splice(t,1):console.log("Can't find such contact in list");window.dealClientSelector.ExcludedArrayIDs=jq.merge([],window.dealMemberSelector.SelectedContacts);jq("#contactItem_"+n).animate({opacity:"hide"},500);setTimeout(function(){jq("#contactItem_"+n).remove();jq("#contactTable tr").length==0&&jq(".assignedDealContacts").addClass("hiddenFields")},500)},h=function(n,t){window.dealClientSelector.setContact(t.input,n.id,n.displayName,n.smallFotoUrl);window.dealClientSelector.showInfoContent(t.input);window.dealMemberSelector.ExcludedArrayIDs=[n.id]};return{init:function(o,s){var h=jq.cookies.get(s),c;h!=null&&h!=""&&(jq.cookies.del(s),jq.tmpl("template-blockUIPanel",{id:"saveDealError",headerTest:ASC.CRM.Resources.CRMCommonResource.Alert,questionText:"",innerHtmlText:["<div>",h,"<\/div>"].join(""),CancelBtn:ASC.CRM.Resources.CRMCommonResource.Close,progressText:""}).insertAfter("#crm_dealMakerDialog"),PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#saveDealError",500));n();t();ASC.CRM.ListDealView.initConfirmationPanelForDelete();ASC.CRM.Data.IsCRMAdmin===!0&&i();c=parseInt(jq.getURLParam("id"));isNaN(c)||typeof targetDeal!="object"?jq("#expectedCloseDate").val(o):f();r();u();jq(".cancelSbmtFormBtn:first").on("click",function(){return ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0});e()},selectBidTypeEvent:function(n){var i=n.selectedIndex,r,t,u;i!=0?jq(n).nextAll().show():jq(n).nextAll().hide();r=jq(n).nextAll("span.splitter");t="";switch(i){case 1:t=ASC.CRM.Resources.CRMJSResource.PerPeriodHours;break;case 2:t=ASC.CRM.Resources.CRMJSResource.PerPeriodDays;break;case 3:t=ASC.CRM.Resources.CRMJSResource.PerPeriodWeeks;break;case 4:t=ASC.CRM.Resources.CRMJSResource.PerPeriodMonths;break;case 5:t=ASC.CRM.Resources.CRMJSResource.PerPeriodYears}u=t.split("{0}");jq(r).each(function(n){jq(this).text(u[n].trim())})},submitForm:function(){var r,u,n,t,i,f;if(jq("[id*=saveDealButton]:first").hasClass("postInProcess"))return!1;jq("[id*=saveDealButton]:first").addClass("postInProcess");try{if(r=!0,jq("#nameDeal").val().trim()==""?(ShowRequiredError(jq("#nameDeal")),r=!1):RemoveRequiredErrorClass(jq("#nameDeal")),u=jq("#advUserSelectorResponsible").attr("data-responsible-id"),u==""?(ShowRequiredError(jq("#advUserSelectorResponsible")),r=!1):RemoveRequiredErrorClass(jq("#advUserSelectorResponsible")),!r)return jq("[id*=saveDealButton]:first").removeClass("postInProcess"),!1;if(n=jq("#probability").val().trim(),n==""?(n=0,jq("#probability").val(0)):(n=n*1,n>100&&jq("#probability").val(100)),jq("#crm_dealMakerDialog input, #crm_dealMakerDialog select, #crm_dealMakerDialog textarea").prop("readonly","readonly").addClass("disabled"),jq("#responsibleID").val(u),window.dealClientSelector.SelectedContacts.length>0?jq("#selectedContactID").val(window.dealClientSelector.SelectedContacts[0]):jq("#selectedContactID").val(0),jq("#selectedMembersID").val(window.dealMemberSelector.SelectedContacts.join(",")),LoadingBanner.strLoading=jq.getURLParam("id")!=null?ASC.CRM.Resources.CRMJSResource.EditingDealProgress:ASC.CRM.Resources.CRMJSResource.AddNewDealProgress,LoadingBanner.showLoaderBtn("#crm_dealMakerDialog"),jq("#crm_dealMakerDialog .dealPrivatePanel").length==1&&(jq("#isPrivate").is(":checked")||(window.SelectedUsers.IDs=[],jq("#cbxNotify").prop("checked",!1)),jq("#isPrivateDeal").val(jq("#isPrivate").is(":checked")),jq("#notifyPrivateUsers").val(jq("#cbxNotify").is(":checked")),jq("#selectedPrivateUsers").val(window.SelectedUsers.IDs.join(","))),t=jq("#crm_dealMakerDialog .deal_info input[type='checkbox'][id^='custom_field_']"),t)for(i=0;i<t.length;i++)jq(t[i]).is(":checked")&&(f=t[i].id.replace("custom_field_",""),jq("#crm_dealMakerDialog .deal_info input[name='customField_"+f+"']").val(jq(t[i]).is(":checked")));return ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0}catch(e){return console.log(e),jq("[id*=saveDealButton]:first").removeClass("postInProcess"),!1}},showGotoAddSettingsPanel:function(){window.onbeforeunload==null?location.href="Settings.aspx?type=custom_field#opportunity":(PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#confirmationGotoSettingsPanel",500))}}}();ASC.CRM.DealFullCardView=function(){var t="/",n="dealFullCardToggledBlocks",i=function(){var r,u,i,e,f;jq.registerHeaderToggleClick("#dealProfile .crm-detailsTable","tr.headerToggleBlock");jq("#dealProfile .crm-detailsTable").on("click",".headerToggle, .openBlockLink, .closeBlockLink",function(){var f=jq(this).parents("tr.headerToggleBlock:first"),o=f.attr("data-toggleid"),s=f.hasClass("open"),i=jq.cookies.get(n),u,r,e;if(i!=null)i[o]=s;else for(i={},u=jq("#dealProfile .crm-detailsTable tr.headerToggleBlock"),r=0,e=u.length;r<e;r++)i[jq(u[r]).attr("data-toggleid")]=jq(u[r]).hasClass("open");jq.cookies.set(n,i,{path:t})});if(r=jq.cookies.get(n),r!=null)for(u=jq("#dealProfile .crm-detailsTable tr.headerToggleBlock"),i=0,e=u.length;i<e;i++)f=jq(u[i]).attr("data-toggleid"),r.hasOwnProperty(f)&&r[f]===!0&&jq(u[i]).addClass("open");else jq("#dealHistoryTable .headerToggleBlock").addClass("open");jq("#dealProfile .headerToggle").not("#dealProfile .headerToggleBlock.open .headerToggle").each(function(){jq(this).parents("tr.headerToggleBlock:first").nextUntil(".headerToggleBlock").hide()})},r=function(){if(typeof customFieldList!="undefined"&&window.customFieldList.length!=0){var n=ASC.CRM.Common.sortCustomFieldList(window.customFieldList);jq.tmpl("customFieldListTmpl",n).insertBefore("#dealHistoryTable")}};return{init:function(){for(var n=0,t=window.dealTags.length;n<t;n++)window.dealTags[n]=Encoder.htmlDecode(window.dealTags[n]);for(n=0,t=window.dealAvailableTags.length;n<t;n++)window.dealAvailableTags[n]=Encoder.htmlDecode(window.dealAvailableTags[n]);jq.tmpl("tagViewTmpl",{tags:window.dealTags,availableTags:window.dealAvailableTags}).appendTo("#dealTagsTD");ASC.CRM.TagView.init("opportunity",!1);typeof dealResponsibleIDs!="undefined"&&window.dealResponsibleIDs.length!=0&&jq("#dealProfile .dealAccessList").html(ASC.CRM.Common.getAccessListHtml(window.dealResponsibleIDs));r();ASC.CRM.Common.RegisterContactInfoCard();i();jq.dropdownToggle({dropdownID:"dealMilestoneDropDown",switcherSelector:"#dealMilestoneSwitcher",addTop:0,showFunction:function(n,t){var i=parseInt(t.css("left"))+jq("#dealMilestoneSwitcher").width()-12;t.css("left",i)}})},changeDealMilestone:function(n,t){Teamlab.updateCrmOpportunityMilestone({},n,t,function(n,t){jq("#dealMilestoneDropDown").hide();var i=t.stage;jq("#dealMilestoneSwitcher").text(i.title);jq("#dealMilestoneProbability").text(i.successProbability+"%");i.stageType!=0?(jq("#closeDealDate").text(t.actualCloseDateString),jq("#closeDealDate").parent().removeClass("display-none")):(jq("#closeDealDate").text(ASC.CRM.Resources.CRMJSResource.NoCloseDate),jq("#closeDealDate").parent().addClass("display-none"))})}}}();ASC.CRM.DealDetailsView=function(){var n=["profile","tasks","contacts","invoices","files"],t=function(){var t=ASC.Controls.AnchorController.getAnchor();return(t==null||t==""||jq.inArray(t,n)==-1)&&(t="profile"),t},i=function(n){window.ASC.Controls.ClientTabsNavigator.init("DealTabs",{tabs:[{title:ASC.CRM.Resources.CRMCommonResource.Profile,selected:n=="profile",anchor:"profile",divID:"profileTab",onclick:"ASC.CRM.DealDetailsView.activateCurrentTab('profile');"},{title:ASC.CRM.Resources.CRMTaskResource.Tasks,selected:n=="tasks",anchor:"tasks",divID:"tasksTab",onclick:"ASC.CRM.DealDetailsView.activateCurrentTab('tasks');"},{title:ASC.CRM.Resources.CRMDealResource.PeopleInDeal,selected:n=="contacts",anchor:"contacts",divID:"contactsTab",onclick:"ASC.CRM.DealDetailsView.activateCurrentTab('contacts');"},{title:ASC.CRM.Resources.CRMInvoiceResource.Invoices,selected:n=="invoices",anchor:"invoices",divID:"invoicesTab",onclick:"ASC.CRM.DealDetailsView.activateCurrentTab('invoices');"},{title:ASC.CRM.Resources.CRMCommonResource.Documents,selected:n=="files",anchor:"files",divID:"filesTab",onclick:"ASC.CRM.DealDetailsView.activateCurrentTab('files');"}]})},r=function(){window.Attachments.init();window.Attachments.bind("addFile",function(n,t){var i=jq.getURLParam("id")*1,r="opportunity",u=[];u.push(t.id);Teamlab.addCrmEntityFiles({},i,r,{entityid:i,entityType:r,fileids:u},{success:function(n,t){window.Attachments.appendFilesToLayout(t.files);n.fromAttachmentsControl=!0;ASC.CRM.HistoryView.isTabActive=!1}})});window.Attachments.bind("deleteFile",function(n,t){var i=jq("#fileContent_"+t),r;i.length!=0?(r=i.parents("[id^=eventAttach_]").attr("id").split("_")[1],ASC.CRM.HistoryView.deleteFile(t,r)):Teamlab.removeCrmEntityFiles({fileId:t},t,{success:function(n){window.Attachments.deleteFileFromLayout(n.fileId)}})})},u=function(){jq(document).ready(function(){jq.dropdownToggle({dropdownID:"dealDetailsMenuPanel",switcherSelector:".mainContainerClass .containerHeaderBlock .menu-small",addTop:0,addLeft:-10,showFunction:function(n,t){t.is(":hidden")?n.addClass("active"):n.removeClass("active")},hideFunction:function(){jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active")}})});jq("#dealDetailsMenuPanel .createProject").off("click").on("click",function(){jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active");jq("#dealDetailsMenuPanel").hide()})},f=function(){var n={};window.dealResponsibleIDs.length!=0&&(n.taskResponsibleSelectorUserIDs=window.dealResponsibleIDs);jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,window.entityData.type,window.entityData.id,null,n)});ASC.CRM.ListTaskView.bindEmptyScrBtnEvent(n)},e=function(){jq.tmpl("template-emptyScreen",{ID:"emptyDealParticipantPanel",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_opportunity_participants,Header:ASC.CRM.Resources.CRMDealResource.EmptyPeopleInDealContent,Describe:ASC.CRM.Resources.CRMDealResource.EmptyPeopleInDealDescript,ButtonHTML:["<a class='link dotline plus' ",'onclick=\'javascript:jq("#dealParticipantPanel").show();jq("#emptyDealParticipantPanel").addClass("display-none");\'>',ASC.CRM.Resources.CRMCommonResource.AddParticipant,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#contactListBox");jq.tmpl("template-emptyScreen",{ID:"invoiceEmptyScreen",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_invoices,Header:ASC.CRM.Resources.CRMInvoiceResource.EmptyContentInvoicesHeader,Describe:ASC.CRM.Resources.CRMInvoiceResource.EmptyContentInvoicesDescribe}).insertAfter("#invoiceTable")},o=function(){window.dealContactSelector=new ASC.CRM.ContactSelector.ContactSelector("dealContactSelector",{SelectorType:-1,EntityType:0,EntityID:0,ShowOnlySelectorContent:!0,DescriptionText:ASC.CRM.Resources.CRMCommonResource.FindContactByName,DeleteContactText:"",AddContactText:"",IsInPopup:!1,ShowChangeButton:!1,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!1,ShowNewCompanyContent:!0,ShowNewContactContent:!0,presetSelectedContactsJson:"",ExcludedArrayIDs:[],HTMLParent:"#dealParticipantPanel"});window.dealContactSelector.SelectItemEvent=ASC.CRM.DealDetailsView.addMemberToDeal;ASC.CRM.ListContactView.removeMember=ASC.CRM.DealDetailsView.removeMemberFromDeal;jq(window).on("getContactsFromApi",function(n,t){var u=t.length,r,i;if(u==0)jq("#emptyDealParticipantPanel.display-none").removeClass("display-none");else{for(jq("#dealParticipantPanel").show(),r=[],i=0;i<u;i++)r.push(t[i].id);dealContactSelector.SelectedContacts=r}})};return{init:function(){var n=t();i(n);ASC.CRM.ListContactView.isContentRendered=!1;ASC.CRM.ListInvoiceView.isContentRendered=!1;e();o();ASC.CRM.HistoryView.init(0,window.entityData.type,window.entityData.id);ASC.CRM.ListTaskView.initTab(0,window.entityData.type,window.entityData.id);r();u();f();ASC.CRM.DealDetailsView.activateCurrentTab(n)},activateCurrentTab:function(n){n=="profile";n=="tasks"&&ASC.CRM.ListTaskView.activate();n=="contacts"&&ASC.CRM.ListContactView.isContentRendered==!1&&(ASC.CRM.ListContactView.isContentRendered=!0,ASC.CRM.ListContactView.renderSimpleContent(!1,!0));n=="invoices"&&ASC.CRM.ListInvoiceView.isContentRendered==!1&&(ASC.CRM.ListInvoiceView.isContentRendered=!0,ASC.CRM.ListInvoiceView.renderSimpleContent());n=="files"&&window.Attachments.loadFiles()},removeMemberFromDeal:function(n){Teamlab.removeCrmEntityMember({contactID:parseInt(n)},window.entityData.type,window.entityData.id,n,{before:function(){jq("#simpleContactActionMenu").hide();jq("#contactTable .entity-menu.active").removeClass("active")},after:function(n){var t=jq.inArray(n.contactID,window.dealContactSelector.SelectedContacts);t!=-1?window.dealContactSelector.SelectedContacts.splice(t,1):console.log("Can't find such contact in list");ASC.CRM.ContactSelector.Cache={};jq("#contactItem_"+n.contactID).animate({opacity:"hide"},500);ASC.CRM.HistoryView.removeOption("contact",n.contactID);setTimeout(function(){jq("#contactItem_"+n.contactID).remove();window.dealContactSelector.SelectedContacts.length==0&&(jq("#dealParticipantPanel").hide(),jq("#emptyDealParticipantPanel.display-none").removeClass("display-none"))},500)}})},addMemberToDeal:function(n){if(jq("#contactItem_"+n.id).length>0)return!1;var t={contactid:n.id,opportunityid:window.entityData.id};Teamlab.addCrmEntityMember({showCompanyLink:!0,showUnlinkBtn:!1,showActionMenu:!0},window.entityData.type,window.entityData.id,n.id,t,{success:function(n,t){ASC.CRM.ListContactView.CallbackMethods.addMember(n,t);window.dealContactSelector.SelectedContacts.push(t.id);jq("#emptyDealParticipantPanel:not(.display-none)").addClass("display-none");ASC.CRM.HistoryView.appendOption("contact",{value:t.id,title:t.displayName})}})}}}();ASC.CRM.ExchangeRateView=function(){var n=null,t=function(){var n=jq("#amount").val().trim();n!=""?(jq("#introducedAmount").text(n+" "+jq("#fromCurrency").val()),jq("#conversionResult").text(n*1*ASC.CRM.ExchangeRateView.Rate+" "+jq("#toCurrency").val())):(jq("#introducedAmount").text(""),jq("#conversionResult").text(""))},r=function(){jq.tmpl("template-blockUIPanel",{id:"exchangeRatePopUp",headerTest:ASC.CRM.Resources.CRMCommonResource.ConversionRates}).appendTo("body");jq.tmpl("exchangeRateViewTmpl",{ratesPublisherDisplayDate:ASC.CRM.Data.ratesPublisherDisplayDate}).appendTo("#exchangeRatePopUp .containerBodyBlock:first");window.ASC.Controls.ClientTabsNavigator.init("ExchangeRateTabs",{tabs:[{title:ASC.CRM.Resources.CRMDealResource.TotalAmount,selected:!0,anchor:"",divID:"totalAmountTab"},{title:ASC.CRM.Resources.CRMCommonResource.MoneyCalculator,selected:!1,anchor:"",divID:"converterTab"},{title:ASC.CRM.Resources.CRMCommonResource.SummaryTable,selected:!1,anchor:"",divID:"exchangeTab"}]})},i=function(n){var r,i,u,t,e,f;for(jq("#totalOnPage .diferrentBids").html(""),jq("#totalOnPage .totalBid").html(""),r=0,u=!1,t=0,e=n.length;t<e;t++)n[t].bidCurrencyAbbreviation!=ASC.CRM.Data.defaultCurrency.abbreviation&&(u=!0),i=ASC.CRM.Common.numberFormat(n[t].bidValue,{before:n[t].bidCurrencySymbol,thousands_sep:" ",dec_point:ASC.CRM.Data.CurrencyDecimalSeparator}),jq.tmpl("bidFormat",{number:i,abbreviation:n[t].bidCurrencyAbbreviation}).appendTo("#totalOnPage .diferrentBids"),n[t].isConvertable||jq.tmpl("bidFormat",{number:i,abbreviation:n[t].bidCurrencyAbbreviation}).appendTo("#totalOnPage .totalBid"),f=ASC.CRM.ExchangeRateView.ExchangeRates[n[t].bidCurrencyAbbreviation],n[t].isConvertable&&typeof f!="undefined"&&(r+=n[t].bidValue/f);i=ASC.CRM.Common.numberFormat(r,{before:ASC.CRM.Data.defaultCurrency.symbol,thousands_sep:" ",dec_point:ASC.CRM.Data.CurrencyDecimalSeparator});jq.tmpl("bidFormat",{number:i,abbreviation:ASC.CRM.Data.defaultCurrency.abbreviation}).prependTo("#totalOnPage .totalBid");u==!0?jq("#totalOnPage .totalBidAndExchangeRateLink").show():jq("#totalOnPage .totalBidAndExchangeRateLink").hide();jq("#totalOnPage").show()},u=function(r){LoadingBanner.displayLoading();Teamlab.getCrmCurrencySummaryTable({},ASC.CRM.Data.defaultCurrency.abbreviation,function(u,f){var s,o,e,h;for(n=f,s="",o={},e=0,h=n.length;e<h;e++)o=n[e],s+=['<option value="',o.abbreviation,'"',o.abbreviation==ASC.CRM.Data.defaultCurrency.abbreviation?' selected="selected">':">",jq.format("{0} - {1}",o.abbreviation,o.title),"<\/option>"].join("");for(jq("#fromCurrency").html(s),jq("#toCurrency").html(s),jq("#exchangeRateContent select:first").html(s),jq.tmpl("ratesTableTmpl",{currencyRates:n}).appendTo("#ratesTable"),jq("#introducedFromCurrency").text(ASC.CRM.Data.defaultCurrency.title+":"),jq("#introducedToCurrency").text(ASC.CRM.Data.defaultCurrency.title+":"),jq("#conversionRate").text(jq.format("1 {0} = 1 {0}",ASC.CRM.Data.defaultCurrency.abbreviation)),e=0,h=n.length;e<h;e++)ASC.CRM.ExchangeRateView.ExchangeRates[n[e].abbreviation]=n[e].rate,ASC.CRM.ExchangeRateView.ExchangeRatesNames[n[e].abbreviation]=n[e].title;i(r);jq.forceNumber({parent:"#convertRateContent",input:"#amount",integerOnly:!0,positiveOnly:!0,onPasteCallback:t});jq("#amount").on("keyup",function(){t()});LoadingBanner.hideLoading()})};return{Rate:1,ExchangeRates:{},ExchangeRatesNames:{},init:function(n){ASC.CRM.ExchangeRateView.Rate=1;jq("#exchangeRatePopUp").length==0?(r(),u(n)):i(n)},changeCurrency:function(){var n=jq("#fromCurrency").val(),i=jq("#toCurrency").val(),r={amount:1,fromcurrency:n,tocurrency:i};LoadingBanner.displayLoading();Teamlab.getCrmCurrencyConvertion({},r,function(r,u){ASC.CRM.ExchangeRateView.Rate=u;jq("#conversionRate").text("1 "+n+" = "+u+" "+i);jq("#introducedFromCurrency").text(ASC.CRM.ExchangeRateView.ExchangeRatesNames[n]+":");jq("#introducedToCurrency").text(ASC.CRM.ExchangeRateView.ExchangeRatesNames[i]+":");t();LoadingBanner.hideLoading()})},updateSummaryTable:function(n){LoadingBanner.displayLoading();Teamlab.getCrmCurrencySummaryTable({},n,function(n,t){for(var i,o,u=jq("#ratesTable td.rateValue"),r=0,s=u.length;r<s;r++){var f=jq(u[r]),h=f.attr("id").toLowerCase(),e="";for(i=0,o=t.length;i<o;i++)if(t[i].abbreviation.toLowerCase()==h){e=t[i].rate;break}f.text(e)}LoadingBanner.hideLoading()})}}}();ASC.CRM.DealTabView=function(){var i=function(){if(jq("#dealTable tbody tr").remove(),ASC.CRM.DealTabView.Total==0)return jq("#dealList:not(.display-none)").addClass("display-none"),jq("#emptyContentForDealsFilter.display-none").removeClass("display-none"),LoadingBanner.hideLoading(),!1;jq("#dealButtonsPanel").show();jq("#dealList.display-none").removeClass("display-none");jq.tmpl("dealTmpl",ASC.CRM.DealTabView.dealList).prependTo("#dealTable tbody");ASC.CRM.ListDealView.bidList.length==0?jq("#dealList .showTotalAmount").hide():jq("#dealList .showTotalAmount").show();LoadingBanner.hideLoading()},r=function(){if(ASC.CRM.DealTabView.dealList.length==0)return!1;jq.tmpl("dealTmpl",ASC.CRM.DealTabView.dealList).appendTo("#dealTable tbody");ASC.CRM.Common.RegisterContactInfoCard();ASC.CRM.ListDealView.bidList.length==0?jq("#dealList .showTotalAmount").hide():jq("#dealList .showTotalAmount").show()},u=function(){if(!ASC.CRM.DealTabView.showMore)return!1;ASC.CRM.DealTabView.dealList=[];var n=jq("#dealTable tbody tr").length;jq("#showMoreDealsButtons .crm-showMoreLink").hide();jq("#showMoreDealsButtons .loading-link").show();f(n)},n=function(n){return{contactID:ASC.CRM.DealTabView.contactID,count:ASC.CRM.DealTabView.entryCountOnPage,startIndex:n,contactAlsoIsParticipant:!0}},f=function(i){var r=n(i);Teamlab.getCrmOpportunities({startIndex:i},{filter:r,success:t})},t=function(n,t){for(var u=0,f=t.length;u<f;u++)ASC.CRM.ListDealView._dealItemFactory(t[u],[]);for(ASC.CRM.DealTabView.dealList=t,jq(window).trigger("getDealsFromApi",[n,t]),ASC.CRM.DealTabView.Total=n.__total||0,typeof n.__nextIndex=="undefined"&&(ASC.CRM.DealTabView.showMore=!1),n.__startIndex?r():i(),u=0,f=ASC.CRM.DealTabView.dealList.length;u<f;u++)ASC.CRM.Common.tooltip("#dealTitle_"+ASC.CRM.DealTabView.dealList[u].id,"tooltip");jq("#showMoreDealsButtons .loading-link").hide();ASC.CRM.DealTabView.showMore?jq("#showMoreDealsButtons .crm-showMoreLink").show():jq("#showMoreDealsButtons .crm-showMoreLink").hide()},e=function(n,i){h();i&&i.length?(jq("#emptyContentForDealsFilter:not(.display-none)").addClass("display-none"),jq("#dealList.display-none").removeClass("display-none"),t(n,i),jq("#dealsInContactPanel").show()):(jq("#dealList:not(.display-none)").addClass("display-none"),jq("#emptyContentForDealsFilter.display-none").removeClass("display-none"))},o=function(n,t){jq("#dealList.display-none").removeClass("display-none");ASC.CRM.ListDealView._dealItemFactory(t,[]);jq.tmpl("dealTmpl",t).prependTo("#dealTable tbody");jq("#emptyContentForDealsFilter:not(.display-none)").addClass("display-none");ASC.CRM.HistoryView.appendOption("opportunity",{value:t.id,title:t.title})},s=function(){Teamlab.getCrmOpportunities({},{filter:n(0),before:LoadingBanner.displayLoading,success:e,error:function(n,t){console.log(t)},after:LoadingBanner.hideLoading})},h=function(){window.dealsSelector=new ASC.CRM.DealSelector.DealSelector({ObjName:"dealsSelector",Description:ASC.CRM.Resources.CRMDealResource.FindDealByName,ContactID:ASC.CRM.DealTabView.contactID,InternalSearch:!1,ParentSelector:"#dealsInContactPanel",SelectItemEvent:c})},c=function(n){Teamlab.addCrmDealForContact({},ASC.CRM.DealTabView.contactID,n.id,o)};return{contactID:0,dealList:[],bidList:[],isTabActive:!1,showMore:!0,entryCountOnPage:0,currentPageNumber:1,isFirstLoad:!0,initTab:function(n){ASC.CRM.DealTabView.contactID=n;ASC.CRM.DealTabView.entryCountOnPage=ASC.CRM.Data.DefaultEntryCountOnPage;ASC.CRM.ListDealView.bidList=[];jq.tmpl("template-emptyScreen",{ID:"emptyContentForDealsFilter",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_deals,Header:ASC.CRM.Resources.CRMDealResource.EmptyContentDealsHeader,Describe:jq.format(ASC.CRM.Resources.CRMDealResource.EmptyContentDealsDescribe,"<span class='hintStages baseLinkAction'>","<\/span>"),ButtonHTML:["<a class='link-with-entity link dotline'>",ASC.CRM.Resources.CRMDealResource.LinkOrCreateDeal,"<\/a>"].join(""),CssClass:"display-none"}).insertAfter("#dealList");jq.tmpl("dealExtendedListTmpl",{contactID:n}).appendTo("#dealList");jq("#emptyContentForDealsFilter .emptyScrBttnPnl>a").on("click",function(){jq("#emptyContentForDealsFilter:not(.display-none)").addClass("display-none");jq("#dealsInContactPanel").show()});jq("#showMoreDealsButtons .crm-showMoreLink").on("click",function(){u()})},activate:function(){if(ASC.CRM.DealTabView.isTabActive==!1){ASC.CRM.DealTabView.isTabActive=!0;jq("#emptyContentForDealsFilter .emptyScrBttnPnl>a").on("click",function(){jq("#emptyContentForDealsFilter:not(.display-none)").addClass("display-none");jq("#dealsInContactPanel").show()});s()}}}}();jq(document).ready(function(){jq.dropdownToggle({switcherSelector:".noContentBlock .hintStages",dropdownID:"files_hintStagesPanel",fixWinSize:!1})});ASC.CRM.DealSelector=new function(){var n=function(n,t){return t.length?n.DomObjects.empty.hide():n.DomObjects.empty.outerWidth(n.DomObjects.table.width()).show(),t},t=function(t){t.DomObjects.input.autocomplete({minLength:0,delay:300,focus:function(n){n.preventDefault?n.preventDefault():n.returnValue=!1;var f=jq(this).data("ui-autocomplete"),t=f.menu,r=t.element.scrollTop(),i=t.active.offset().top-t.element.offset().top,u=t.element.height();i<0?t.element.scrollTop(r+i):i+t.active.height()>u&&t.element.scrollTop(r+i-u+t.active.height())},select:function(n,i){return t.Cache={},t.SelectItemEvent(i.item),jq(this).val(""),!1},selectFirst:!1,search:function(){return t.DomObjects.parent.is(":visible")},source:function(i,r){var u=i.term,f,e;if(u in t.Cache){r(n(t,t.Cache[u]));return}for(f in t.Cache)if(t.Cache[f].length==0&&u.indexOf(f)==0){r(n(t,[]));return}e={prefix:u,contactID:t.ContactID,internalSearch:t.InternalSearch};Teamlab.getCrmOpportunitiesByPrefix({},{filter:e,success:function(i,f){t.DomObjects.loader.hide();t.DomObjects.search.show();t.Cache[u]=f;r(n(t,f))},before:function(){t.DomObjects.search.hide();t.DomObjects.loader.show()}})}});t.DomObjects.input.data("ui-autocomplete")._renderMenu=function(n,t){var i=this;jq.each(t,function(t,r){i._renderItemData(n,r)})};t.DomObjects.input.data("ui-autocomplete")._renderItem=function(n,t){return jq("<li><\/li>").data("item.autocomplete",t).append(jq("<a><\/a>").html(jq.htmlEncodeLight(t.title))).appendTo(n)};t.DomObjects.input.data("ui-autocomplete")._resizeMenu=function(){var n=this;n.menu.element.outerWidth(t.DomObjects.table.width())};t.DomObjects.input.data("ui-autocomplete")._suggest=function(n){var i=this,r=i.menu.element.empty().zIndex(i.element.zIndex()+1);i._renderMenu(r,n);i.menu.refresh();r.show();i._resizeMenu();r.position(jq.extend({"of":t.DomObjects.table},i.options.position))}},i=function(n){function t(){n.DomObjects.input.autocomplete("search",n.DomObjects.input.val().trim())}n.DomObjects.search.on("click",t);n.DomObjects.input.on("click",t);n.DomObjects.input.on("keyup",function(){n.DomObjects.input.val().trim()==""?n.DomObjects.cross.hide():n.DomObjects.cross.show()});n.DomObjects.cross.on("click",function(){n.DomObjects.cross.hide();n.DomObjects.input.val("").trigger("blur");n.DomObjects.empty.hide()});n.DomObjects.link.on("click",function(){location.href="Deals.aspx?action=manage&contactID="+n.ContactID});jq(document).on("click",function(t){if(n.DomObjects.empty.is(":visible")){console.log("document.click");var i=jq(t.target);i.is(n.DomObjects.input)||i.is(n.DomObjects.empty)||i.parents(".noMatches").is(n.DomObjects.empty)||n.DomObjects.empty.hide()}})};this.DealSelector=function(n){if(!n||!n.ObjName||!n.ParentSelector)return null;var r=jq(n.ParentSelector);return r.length?(this.ObjName=n.ObjName,this.Description=n.Description||"",this.ContactID=n.ContactID||0,this.InternalSearch=Boolean(n.InternalSearch),this.ParentSelector=n.ParentSelector,this.SelectItemEvent=n.SelectItemEvent,this.Cache={},jq.tmpl("dealSelectorContainerTmpl",this).appendTo(this.ParentSelector),this.DomObjects={parent:r,table:r.find("table"),search:r.find(".searchButton"),loader:r.find(".loaderImg"),input:r.find("input[type=text].textEdit"),cross:r.find(".crossButton"),empty:r.find(".noMatches"),link:r.find(".noMatches .link")},t(this),i(this),this):null}};
typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}}());ASC.CRM.myInvoiceContactFilter={filterId:"invoiceAdvansedFilter",idFilterByContact:"contactID",type:"custom-contact",hiddenContainerId:"hiddenBlockForInvoiceContactSelector",headerContainerId:"invoiceContactSelectorForFilter",onSelectContact:function(n,t){jq("#"+ASC.CRM.myInvoiceContactFilter.headerContainerId).find(".inner-text .value").text(t.title);var i=jq("#"+ASC.CRM.myInvoiceContactFilter.filterId);i.advansedFilter(ASC.CRM.myInvoiceContactFilter.idFilterByContact,{id:t.id,displayName:t.title,value:jq.toJSON([t.id,"contact"])});i.advansedFilter("resize")},createFilterByContact:function(n){var t=document.createElement("div");return t.classList.add("default-value"),t.innerHTML=['<span class="title">',n.title,"<\/span>",'<span class="selector-wrapper">','<span class="contact-selector"><\/span>',"<\/span>",'<span class="btn-delete">&times;<\/span>',].join(""),t},customizeFilterByContact:function(n,t,i){var r=jq("#"+ASC.CRM.myInvoiceContactFilter.headerContainerId);if(r.parent().is("#"+ASC.CRM.myInvoiceContactFilter.hiddenContainerId)){r.off("showList").on("showList",function(n,i){ASC.CRM.myInvoiceContactFilter.onSelectContact(n,i);t.removeClass("default-value")});r.next().addBack().appendTo(t.find("span.contact-selector:first"));i.isset||setTimeout(function(){t.hasClass("default-value")&&r.trigger("click")},0)}},destroyFilterByContact:function(){var n=jq("#"+ASC.CRM.myInvoiceContactFilter.headerContainerId);n.parent().is("#"+ASC.CRM.myInvoiceContactFilter.hiddenContainerId)||(n.off("showList"),n.find(".inner-text .value").text(ASC.CRM.Resources.CRMCommonResource.Select),n.next().addBack().appendTo(jq("#"+ASC.CRM.myInvoiceContactFilter.hiddenContainerId)),n.contactadvancedSelector("reset"))},processFilter:function(n,t,i,r){if(r&&r.id&&isFinite(r.id)){var u=jq("#"+ASC.CRM.myInvoiceContactFilter.headerContainerId);u.find(".inner-text .value").text(r.displayName);u.contactadvancedSelector("select",[r.id]);t.removeClass("default-value")}}};ASC.CRM.ListInvoiceView=function(){function at(n){location.href="Invoices.aspx?id={0}&action=pdf".format(n.id)}var n=function(n,t){if(ASC.CRM.ListInvoiceView.cookieKey&&ASC.CRM.ListInvoiceView.cookieKey!=""){var i={page:n,countOnPage:t};jq.cookies.set(ASC.CRM.ListInvoiceView.cookieKey,i,{path:location.pathname})}},w=function(n){var t,i;return(n=n||0,t={startIndex:n,count:ASC.CRM.ListInvoiceView.entryCountOnPage},!ASC.CRM.ListInvoiceView.advansedFilter)?t:(i=ASC.CRM.ListInvoiceView.advansedFilter.advansedFilter(),jq(i).each(function(n,i){var r,u,n,f;switch(i.id){case"sorter":t.sortBy=i.params.id;t.sortOrder=i.params.dsc==!0?"descending":"ascending";break;case"text":t.filterValue=i.params.value;break;case"issueDateFromTo":t.issueDateFrom=new Date(i.params.from);t.issueDateTo=new Date(i.params.to);break;case"dueDateFromTo":t.dueDateFrom=new Date(i.params.from);t.dueDateTo=new Date(i.params.to);break;default:if(i.hasOwnProperty("apiparamname")&&i.params.hasOwnProperty("value")&&i.params.value!=null)try{for(r=JSON.parse(i.apiparamname),u=JSON.parse(i.params.value),r.length!=u.length&&(t[i.apiparamname]=i.params.value),n=0,f=r.length;n<f;n++)t[r[n]]=u[n]}catch(e){t[i.apiparamname]=i.params.value}}}),t)},s=function(){ASC.CRM.ListInvoiceView.deselectAll();var i=0;ASC.CRM.ListInvoiceView.defaultCurrentPageNumber!=0?(n(ASC.CRM.ListInvoiceView.defaultCurrentPageNumber,window.invoicePageNavigator.EntryCountOnPage),i=(ASC.CRM.ListInvoiceView.defaultCurrentPageNumber-1)*window.invoicePageNavigator.EntryCountOnPage,ASC.CRM.ListInvoiceView.defaultCurrentPageNumber=0):n(0,window.invoicePageNavigator.EntryCountOnPage);t(i)},t=function(n){ASC.CRM.ListInvoiceView.invoiceList=[];ASC.CRM.ListCasesView.isFirstLoad||(LoadingBanner.displayLoading(),jq("#invoiceFilterContainer, #invoiceHeaderMenu, #invoiceList, #tableForInvoiceNavigation").show(),jq("#invoiceAdvansedFilter").advansedFilter("resize"));jq("#mainSelectAllInvoices").prop("checked",!1);g(n)},b=function(i,r){window.invoicePageNavigator=new ASC.Controls.PageNavigator.init("invoicePageNavigator","#divForInvoicePager",i,ASC.CRM.Data.VisiblePageCount,r,ASC.CRM.Resources.CRMJSResource.Previous,ASC.CRM.Resources.CRMJSResource.Next);window.invoicePageNavigator.changePageCallback=function(i){n(i,window.invoicePageNavigator.EntryCountOnPage);var r=window.invoicePageNavigator.EntryCountOnPage*(i-1);t(r)}},k=function(n){var t;t=n>=ASC.CRM.ListInvoiceView.Total?n+1:ASC.CRM.ListInvoiceView.Total;window.invoicePageNavigator.drawPageNavigator((n/ASC.CRM.ListInvoiceView.entryCountOnPage).toFixed(0)*1+1,t);jq("#tableForInvoiceNavigation").show()},d=function(){jq("#invoiceHeaderMenu .menu-action-simple-pagenav").html("");var n=jq("<div><\/div>"),t=0;jq("#divForInvoicePager .pagerPrevButtonCSSClass").length!=0&&(t++,jq("#divForInvoicePager .pagerPrevButtonCSSClass").clone().appendTo(n));jq("#divForInvoicePager .pagerNextButtonCSSClass").length!=0&&(t++,t===2&&jq("<span style='padding: 0 8px;'>&nbsp;<\/span>").clone().appendTo(n),jq("#divForInvoicePager .pagerNextButtonCSSClass").clone().appendTo(n));n.children().length!=0?(n.appendTo("#invoiceHeaderMenu .menu-action-simple-pagenav"),jq("#invoiceHeaderMenu .menu-action-simple-pagenav").show()):jq("#invoiceHeaderMenu .menu-action-simple-pagenav").hide()},r=function(n){n!=0?(jq("#invoiceHeaderMenu .menu-action-checked-count > span").text(jq.format(ASC.CRM.Resources.CRMJSResource.ElementsSelectedCount,n)),jq("#invoiceHeaderMenu .menu-action-checked-count").show()):(jq("#invoiceHeaderMenu .menu-action-checked-count > span").text(""),jq("#invoiceHeaderMenu .menu-action-checked-count").hide())},u=function(){jq("#invoiceTable tbody tr").remove();jq("#invoiceFilterContainer, #invoiceHeaderMenu, #invoiceList, #tableForInvoiceNavigation").hide();jq("#emptyContentForInvoiceFilter").hide();jq("#invoiceEmptyScreen").show()},h=function(){jq("#invoiceTable tbody tr").remove();jq("#invoiceHeaderMenu, #invoiceList, #tableForInvoiceNavigation").hide();jq("#invoiceFilterContainer").show();jq("#mainSelectAllInvoices").prop("disabled",!0);jq("#invoiceEmptyScreen").hide();jq("#emptyContentForInvoiceFilter").show()},c=function(n){function f(){t.canEdit?jq("#invoiceActionMenu .editInvoiceLink").attr("href",jq.format("Invoices.aspx?id={0}&action=edit",n)).show():jq("#invoiceActionMenu .editInvoiceLink").removeAttr("href").hide();t.canDelete?jq("#invoiceActionMenu .deleteInvoiceLink").off("click").on("click",function(){jq("#invoiceActionMenu").hide();jq("#invoiceTable .entity-menu.active").removeClass("active");ASC.CRM.ListInvoiceView.showConfirmationPanelForDelete(t.number,n,!0)}).show():jq("#invoiceActionMenu .deleteInvoiceLink").off("click").hide();t.canEdit||t.canDelete?jq("#invoiceActionMenu ul.dropdown-content .dropdown-item-seporator:last").show():jq("#invoiceActionMenu ul.dropdown-content .dropdown-item-seporator:last").hide()}function e(){jq("#invoiceActionMenu .status-btn").remove();t.status.id==1&&i(2,ASC.CRM.Resources.CRMInvoiceResource.MarkAsSend,"invoice-send");t.status.id==2&&(i(3,ASC.CRM.Resources.CRMInvoiceResource.MarkAsRejected,"invoice-rejected"),i(4,ASC.CRM.Resources.CRMInvoiceResource.MarkAsPaid,"invoice-paid"));t.status.id==3&&i(1,ASC.CRM.Resources.CRMInvoiceResource.MarkAsDraft,"invoice-draft");t.status.id==4&&i(2,ASC.CRM.Resources.CRMInvoiceResource.MarkAsSend,"invoice-send")}function i(n,i,r){var u=jq("<a><\/a>").addClass("dropdown-item with-icon "+r).text(i).on("click",function(){st(t.id,n)}),f=jq("<li><\/li>").addClass("status-btn").append(u);f.insertAfter(jq("#invoiceActionMenu ul.dropdown-content .dropdown-item-seporator:first"))}for(var t=null,r=0,u=ASC.CRM.ListInvoiceView.invoiceList.length;r<u;r++)if(n==ASC.CRM.ListInvoiceView.invoiceList[r].id){t=ASC.CRM.ListInvoiceView.invoiceList[r];break}if(t!=null){jq("#invoiceActionMenu .showProfileLink").attr("href",jq.format("Invoices.aspx?id={0}",n));jq("#invoiceActionMenu .showProfileLinkNewTab").off("click").on("click",function(){jq("#invoiceActionMenu").hide();jq("#invoiceTable .entity-menu.active").removeClass("active");window.open(jq.format("Invoices.aspx?id={0}",n),"_blank")});jq("#invoiceActionMenu .downloadLink").off("click").on("click",function(){ct(t)});jq("#invoiceActionMenu .printLink").off("click").on("click",function(){ht(n)});jq("#invoiceActionMenu .sendLink").off("click").on("click",function(){lt(t)});jq("#invoiceActionMenu .duplicateInvoiceLink").attr("href",jq.format("Invoices.aspx?id={0}&action=duplicate",n));f();e()}},g=function(n){var t=w(n);Teamlab.getCrmInvoices({startIndex:n||0},{filter:t,success:nt})},l=function(){var n=jq("#invoiceFilterContainer").is(":hidden")==!1;ASC.CRM.ListInvoiceView.isFilterVisible==!1&&n&&(ASC.CRM.ListInvoiceView.isFilterVisible=!0,ASC.CRM.ListInvoiceView.advansedFilter&&jq("#invoiceAdvansedFilter").advansedFilter("resize"))},f=function(n,t,i){var f=jq.inArray(n.id,t);if(n.isChecked=f!=-1,n.isSimpleView=i||!1,n.status.id==2){var u=new Date,e=new Date(u.getFullYear(),u.getMonth(),u.getDate(),0,0,0,0),o=n.dueDate.getTime()-e.getTime(),r=Math.round(o/864e5);n.dueDateString=r==0?ASC.CRM.Resources.CRMCommonResource.Today:r>0?jq.format(ASC.CRM.Resources.CRMCommonResource.DateDueInDays,r):jq.format(ASC.CRM.Resources.CRMCommonResource.DateOverueByDays,r*-1)}else n.dueDateString="";n.displaySum=ASC.CRM.Common.numberFormat(n.cost,{before:n.currency.symbol,after:" "+n.currency.abbreviation,thousands_sep:" ",dec_point:ASC.CRM.Data.CurrencyDecimalSeparator,decimals:2})},nt=function(n,r){var o,c,e,s;if(ASC.CRM.ListInvoiceView.Total=n.__total||0,o=n.__startIndex||0,ASC.CRM.ListInvoiceView.Total===0&&typeof ASC.CRM.ListInvoiceView.advansedFilter!="undefined"&&ASC.CRM.ListInvoiceView.advansedFilter.advansedFilter().length==1?(ASC.CRM.ListInvoiceView.noInvoices=!0,ASC.CRM.ListInvoiceView.noInvoicesForQuery=!0):(ASC.CRM.ListInvoiceView.noInvoices=!1,ASC.CRM.ListInvoiceView.noInvoicesForQuery=ASC.CRM.ListInvoiceView.Total===0?!0:!1),ASC.CRM.ListInvoiceView.noInvoices)return u(),ASC.CRM.ListInvoiceView.isFirstLoad?i():LoadingBanner.hideLoading(),!1;if(ASC.CRM.ListInvoiceView.noInvoicesForQuery)return h(),l(),ASC.CRM.ListInvoiceView.isFirstLoad?i():LoadingBanner.hideLoading(),!1;if(r.length==0){for(jq("invoiceEmptyScreen").hide(),jq("#emptyContentForInvoiceFilter").hide(),jq("#invoiceFilterContainer, #invoiceHeaderMenu, #invoiceList, #tableForInvoiceNavigation").show(),jq("#invoiceTable tbody tr").remove(),jq("#mainSelectAllInvoices").prop("disabled",!0),ASC.CRM.ListInvoiceView.Total=parseInt(jq("#totalInvoicesOnPage").text())||0,o=ASC.CRM.ListInvoiceView.entryCountOnPage*(window.invoicePageNavigator.CurrentPageNumber-1);o>=ASC.CRM.ListInvoiceView.Total&&o>=ASC.CRM.ListInvoiceView.entryCountOnPage;)o-=ASC.CRM.ListInvoiceView.entryCountOnPage;return t(o),!1}for(jq("#totalInvoicesOnPage").text(ASC.CRM.ListInvoiceView.Total),jq("#emptyContentForInvoiceFilter").hide(),jq("#invoiceEmptyScreen").hide(),jq("#invoiceFilterContainer").show(),l(),jq("#mainSelectAllInvoices").prop("disabled",!1),c=[],e=0,s=ASC.CRM.ListInvoiceView.selectedItems.length;e<s;e++)c.push(ASC.CRM.ListInvoiceView.selectedItems[e].id);for(e=0,s=r.length;e<s;e++)f(r[e],c);ASC.CRM.ListInvoiceView.invoiceList=r;jq("#invoiceTable tbody").replaceWith(jq.tmpl("invoiceListTmpl",{invoices:ASC.CRM.ListInvoiceView.invoiceList}));jq("#invoiceHeaderMenu, #invoiceList, #tableForInvoiceNavigation").show();ASC.CRM.ListInvoiceView.checkFullSelection();ASC.CRM.Common.RegisterContactInfoCard();k(o);d();window.scrollTo(0,0);ScrolledGroupMenu.fixContentHeaderWidth(jq("#invoiceHeaderMenu"));ASC.CRM.ListInvoiceView.isFirstLoad?i():LoadingBanner.hideLoading()},i=function(){ASC.CRM.ListInvoiceView.isFirstLoad=!1;jq(".containerBodyBlock").children(".loader-page").hide();jq("#invoiceEmptyScreen").is(":visible")||jq("#emptyContentForInvoiceFilter").is(":visible")||(jq("#invoiceFilterContainer, #invoiceHeaderMenu, #invoiceList, #tableForInvoiceNavigation").show(),jq("#invoiceAdvansedFilter").advansedFilter("resize"));LoadingBanner.hideLoading()},tt=function(n,t){if(ASC.CRM.ListInvoiceView.Total=t.length||0,ASC.CRM.ListInvoiceView.noInvoices=ASC.CRM.ListInvoiceView.Total===0?!0:!1,ASC.CRM.ListInvoiceView.noInvoices)return u(),ASC.CRM.ListInvoiceView.isFirstLoad?i():LoadingBanner.hideLoading(),!1;if(t.length==0)return jq("invoiceEmptyScreen").hide(),jq("#emptyContentForInvoiceFilter").hide(),jq("#invoiceTable tbody tr").remove(),LoadingBanner.hideLoading(),!1;jq("#emptyContentForInvoiceFilter").hide();jq("#invoiceEmptyScreen").hide();for(var r=0,e=t.length;r<e;r++)f(t[r],[],!0);ASC.CRM.ListInvoiceView.invoiceList=t;jq("#invoiceList").show();jq("#invoiceTable tbody").replaceWith(jq.tmpl("invoiceListTmpl",{invoices:ASC.CRM.ListInvoiceView.invoiceList}));ASC.CRM.Common.RegisterContactInfoCard();LoadingBanner.hideLoading()},a=function(n){for(var l,f,y,o,p,w,a,s,c,v=[],i=0,b=ASC.CRM.ListInvoiceView.invoiceList.length;i<b;i++){for(l=!1,f=0,y=n.invoiceIDsForDelete.length;f<y;f++)if(n.invoiceIDsForDelete[f]==ASC.CRM.ListInvoiceView.invoiceList[i].id){l=!0;break}l||v.push(ASC.CRM.ListInvoiceView.invoiceList[i])}for(ASC.CRM.ListInvoiceView.invoiceList=v,ASC.CRM.ListInvoiceView.Total-=n.invoiceIDsForDelete.length,jq("#totalInvoicesOnPage").text(ASC.CRM.ListInvoiceView.Total),o=[],i=0,p=ASC.CRM.ListInvoiceView.selectedItems.length;i<p;i++)o.push(ASC.CRM.ListInvoiceView.selectedItems[i].id);for(i=0,w=n.invoiceIDsForDelete.length;i<w;i++)a=jq("#invoice_"+n.invoiceIDsForDelete[i]),a.length!=0&&a.remove(),s=jq.inArray(n.invoiceIDsForDelete[i],o),s!=-1&&(o.splice(s,1),ASC.CRM.ListInvoiceView.selectedItems.splice(s,1));if(jq("#mainSelectAllInvoices").prop("checked",!1),e(),r(ASC.CRM.ListInvoiceView.selectedItems.length),ASC.CRM.ListInvoiceView.Total==0&&(typeof ASC.CRM.ListInvoiceView.advansedFilter=="undefined"||ASC.CRM.ListInvoiceView.advansedFilter.advansedFilter().length==1)?(ASC.CRM.ListInvoiceView.noInvoices=!0,ASC.CRM.ListInvoiceView.noInvoicesForQuery=!0):(ASC.CRM.ListInvoiceView.noInvoices=!1,ASC.CRM.ListInvoiceView.noInvoicesForQuery=ASC.CRM.ListInvoiceView.Total===0?!0:!1),PopupKeyUpActionProvider.EnableEsc=!0,ASC.CRM.ListInvoiceView.noInvoices)return u(),jq.unblockUI(),!1;if(ASC.CRM.ListInvoiceView.noInvoicesForQuery)return h(),jq.unblockUI(),!1;jq("#invoiceTable tbody tr").length==0?(jq.unblockUI(),c=ASC.CRM.ListInvoiceView.entryCountOnPage*(window.invoicePageNavigator.CurrentPageNumber-1),c>=ASC.CRM.ListInvoiceView.Total&&(c-=ASC.CRM.ListInvoiceView.entryCountOnPage),t(c)):jq.unblockUI()},v=function(n,t){var e=t.invoices!=null?t.invoices:[],a=[],u,r,h,c,l,i,s;for(jq.each(ASC.CRM.ListInvoiceView.selectedItems,function(n,t){a.push(t.id)}),i=0,s=e.length;i<s;i++){for(u=e[i],f(u,a,ASC.CRM.ListInvoiceView.hasOwnProperty("entityId")&&ASC.CRM.ListInvoiceView.entityId>0),r=0,h=ASC.CRM.ListInvoiceView.invoiceList.length;r<h;r++)u.id==ASC.CRM.ListInvoiceView.invoiceList[r].id&&(ASC.CRM.ListInvoiceView.invoiceList[r]=u);for(r=0,h=ASC.CRM.ListInvoiceView.selectedItems.length;r<h;r++)u.id==ASC.CRM.ListInvoiceView.selectedItems[i].id&&(ASC.CRM.ListInvoiceView.selectedItems[i]=o(u));c=jq("#invoice_"+e[i].id);c.length==1&&c.replaceWith(jq.tmpl("invoiceTmpl",e[i]))}if(l=!1,t.invoiceItems!=null&&t.invoiceItems.length!=0)for(i=0,s=t.invoiceItems.length;i<s;i++)if(t.invoiceItems[i].stockQuantity<0){l=!0;break}l&&(jq("#changeInvoiceStatusError").length==0&&jq.tmpl("template-blockUIPanel",{id:"changeInvoiceStatusError",headerTest:ASC.CRM.Resources.CRMInvoiceResource.Warning,questionText:"",innerHtmlText:["<div>",ASC.CRM.Resources.CRMInvoiceResource.InvoiceItemNegativeQuantityErrorText,"<\/div>"].join(""),CancelBtn:ASC.CRM.Resources.CRMCommonResource.Close,progressText:""}).appendTo("body"),PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#changeInvoiceStatusError",500))},y=function(){jq("#invoiceHeaderMenu .menuActionChangeStatus").removeClass("unlockAction");jq("#invoiceHeaderMenu .menuActionDelete").removeClass("unlockAction")},e=function(){var t,n,i;if(ASC.CRM.ListInvoiceView.selectedItems.length===0){y();return}for(t=!1,n=0,i=ASC.CRM.ListInvoiceView.selectedItems.length;n<i;n++)if(ASC.CRM.ListInvoiceView.selectedItems[n].canDelete){t=!0;break}jq("#invoiceHeaderMenu .menuActionChangeStatus").addClass("unlockAction");t?jq("#invoiceHeaderMenu .menuActionDelete:not(.unlockAction)").addClass("unlockAction"):jq("#invoiceHeaderMenu .menuActionDelete.unlockAction").removeClass("unlockAction")},p=function(){jq.dropdownToggle({dropdownID:"invoiceActionMenu",switcherSelector:"#invoiceTable .entity-menu",addTop:0,addLeft:2,rightPos:!0,beforeShowFunction:function(n){var t=n.attr("id").split("_")[1];t&&c(parseInt(t))},showFunction:function(n,t){jq("#invoiceTable .entity-menu.active").removeClass("active");t.is(":hidden")&&n.addClass("active")},hideFunction:function(){jq("#invoiceTable .entity-menu.active").removeClass("active")}});jq("body").off("contextmenu").on("contextmenu",function(n){var t=jq.fixEvent(n),i,r;return typeof t=="undefined"||!t?!0:(i=jq(t.srcElement||t.target),!i.parents("#invoiceTable").length)?(jq("#invoiceActionMenu").hide(),!0):(r=parseInt(i.closest("tr.with-entity-menu").attr("id").split("_")[1]),!r)?!0:(c(r),jq("#invoiceTable .entity-menu.active").removeClass("active"),jq.showDropDownByContext(t,i,jq("#invoiceActionMenu")),!1)})},it=function(){ScrolledGroupMenu.init({menuSelector:"#invoiceHeaderMenu",menuAnchorSelector:"#mainSelectAllInvoices",menuSpacerSelector:"main .filter-content .header-menu-spacer",userFuncInTop:function(){jq("#invoiceHeaderMenu .menu-action-on-top").hide()},userFuncNotInTop:function(){jq("#invoiceHeaderMenu .menu-action-on-top").show()}})},rt=function(){jq.tmpl("template-blockUIPanel",{id:"deleteInvoicesPanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:ASC.CRM.Resources.CRMCommonResource.ConfirmationDeleteText,innerHtmlText:['<div id="deleteInvoiceList" class="containerForListBatchDelete mobile-overflow">',"<dl>",'<dt class="listForBatchDelete">',ASC.CRM.Resources.CRMCommonResource.InvoiceModuleName,":","<\/dt>",'<dd class="listForBatchDelete">',"<\/dd>","<\/dl>","<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMInvoiceResource.DeletingInvoices}).insertAfter("#invoiceList");jq("#deleteInvoicesPanel").on("click",".middle-button-container .button.blue",function(){ASC.CRM.ListInvoiceView.deleteBatchInvoices()})},ut=function(){var t,i,n,r;for(jq("#deleteInvoiceList dd.listForBatchDelete").html(""),t=0,i=ASC.CRM.ListInvoiceView.selectedItems.length;t<i;t++)n=ASC.CRM.ListInvoiceView.selectedItems[t],n.canDelete&&(r=jq("<label><\/label>").attr("title",n.number).text(n.number),jq("#deleteInvoiceList dd.listForBatchDelete").append(r.prepend(jq("<input>").attr("type","checkbox").prop("checked",!0).attr("id","invoice_"+n.id))));LoadingBanner.hideLoaderBtn("#deleteInvoicesPanel");PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#deleteInvoicesPanel",500)},ft=function(){for(var i,n=0,t=ASC.CRM.Data.invoiceStatuses.length;n<t;n++)i=jq("<a><\/a>").addClass("dropdown-item").text(ASC.CRM.Common.convertText(ASC.CRM.Data.invoiceStatuses[n].displayname,!1)).attr("data-value",ASC.CRM.Data.invoiceStatuses[n].apiname),jq("#changeStatusDialog ul.dropdown-content").append(jq("<li><\/li>").append(i));jq.dropdownToggle({dropdownID:"changeStatusDialog",switcherSelector:"#invoiceHeaderMenu .menuActionChangeStatus.unlockAction",addTop:5,addLeft:0});jq("#changeStatusDialog .dropdown-item").on("click",function(){var n=jq(this).attr("data-value");ot(n)})},et=function(){jq("#invoiceTable").on("click",".invoiceStatus div",function(){for(var r=jq(this).attr("data-status-id"),i=[],n="",t=0,u=ASC.CRM.Data.invoiceStatuses.length;t<u;t++)if(ASC.CRM.Data.invoiceStatuses[t].value==r){n=ASC.CRM.Data.invoiceStatuses[t];break}n.apiname!=""&&(i.push({type:"combobox",id:n.apiname,isset:!0,params:{value:n.value,title:n.displayname,classname:"",def:!0}}),jq("#invoiceAdvansedFilter").advansedFilter({filters:i}))})},ot=function(n){for(var r,t=[],i=0,u=ASC.CRM.ListInvoiceView.selectedItems.length;i<u;i++)t.push(ASC.CRM.ListInvoiceView.selectedItems[i].id);r={ids:t};Teamlab.updateCrmInvoicesStatusBatch(r,n,t,{success:v,before:function(){jq("#changeStatusDialog").hide();LoadingBanner.displayLoading()},after:function(){LoadingBanner.hideLoading()}})},st=function(n,t){var i=[n],r={ids:i};Teamlab.updateCrmInvoicesStatusBatch(r,t,i,{success:v,before:function(){jq("#invoiceActionMenu").hide();LoadingBanner.displayLoading()},after:function(){LoadingBanner.hideLoading()}})},ht=function(n){jq("#invoiceActionMenu").hide();jq("#invoiceTable .entity-menu.active").removeClass("active");var i,t;i=window.open("");t=i.document;Teamlab.getCrmInvoiceJsonData({},n,{success:function(n,i){var r=jq.tmpl("invoiceDetailsStylesTmpl",{})[0].outerHTML,u=jq.tmpl("invoiceDetailsTmpl",i)[0].outerHTML;t.write(["<html>","<head>",r,"<\/head>","<body>",u,"<script type='text/javascript'>window.onload = function () {this.print();};<\/script>","<\/body>","<\/html>"].join(""));t.close()},before:function(){LoadingBanner.displayLoading()},after:function(){LoadingBanner.hideLoading()}})},ct=function(n){LoadingBanner.displayLoading();jq("#invoiceActionMenu").hide();jq("#invoiceTable .entity-menu.active").removeClass("active");ASC.CRM.ListInvoiceView.checkInvoicePdfFile(n,"","",null,at)},lt=function(n){LoadingBanner.displayLoading();jq("#invoiceActionMenu").hide();jq("#invoiceTable .entity-menu.active").removeClass("active");ASC.CRM.ListInvoiceView.checkInvoicePdfFile(n,"","",null,ASC.CRM.Common.createInvoiceMail)},o=function(n){return{id:n.id,number:n.number,status:n.status,canDelete:n.canDelete,canEdit:n.canEdit}},vt=function(n){jq("#mainSelectAllInvoices").prop("checked",!1);jq("#tableForInvoiceNavigation select:first").val(n).on("change",function(){ASC.CRM.ListInvoiceView.changeCountOfRows(this.value)}).tlCombobox()},yt=function(){var o,s,e,i,a;if(jq("#invoiceAdvansedFilter").advansedFilter){var u=[],h=ASC.CRM.Data.invoiceStatuses.length,f=new Date,r=new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0,0),v=new Date(new Date(r).setDate(f.getDate()-1)),y=new Date(new Date(r).setDate(f.getDate()+1)),c=new Date(new Date(r).setDate(1)),p=new Date(r.getFullYear(),r.getMonth()+1,0),l=new Date(new Date(c).setDate(c.getDate()-1)),w=new Date(new Date(l).setDate(1)),n=Teamlab.serializeTimestamp(r),t=Teamlab.serializeTimestamp(v),b=Teamlab.serializeTimestamp(y);for(beginningOfThisMonthString=Teamlab.serializeTimestamp(c),endOfThisMonthString=Teamlab.serializeTimestamp(p),beginningOfLastMonthString=Teamlab.serializeTimestamp(w),endOfLastMonthString=Teamlab.serializeTimestamp(l),filters=[{type:"combobox",id:"issueLastMonth",apiparamname:jq.toJSON(["issueDateFrom","issueDateTo"]),title:ASC.CRM.Resources.CRMCommonResource.LastMonth,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,group:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,groupby:"byIssueDate",options:[{value:jq.toJSON([beginningOfLastMonthString,endOfLastMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth,def:!0},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([beginningOfThisMonthString,endOfThisMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"issueYesterday",apiparamname:jq.toJSON(["issueDateFrom","issueDateTo"]),title:ASC.CRM.Resources.CRMCommonResource.Yesterday,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,group:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,groupby:"byIssueDate",options:[{value:jq.toJSON([beginningOfLastMonthString,endOfLastMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday,def:!0},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([beginningOfThisMonthString,endOfThisMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"issueToday",apiparamname:jq.toJSON(["issueDateFrom","issueDateTo"]),title:ASC.CRM.Resources.CRMCommonResource.Today,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,group:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,groupby:"byIssueDate",options:[{value:jq.toJSON([beginningOfLastMonthString,endOfLastMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today,def:!0},{value:jq.toJSON([beginningOfThisMonthString,endOfThisMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"issueThisMonth",apiparamname:jq.toJSON(["issueDateFrom","issueDateTo"]),title:ASC.CRM.Resources.CRMCommonResource.ThisMonth,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,group:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,groupby:"byIssueDate",options:[{value:jq.toJSON([beginningOfLastMonthString,endOfLastMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([beginningOfThisMonthString,endOfThisMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth,def:!0}]},{type:"daterange",id:"issueDateFromTo",title:ASC.CRM.Resources.CRMCommonResource.CustomDateFilter,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,group:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,groupby:"byIssueDate"}],i=0;i<h;i++)u.push({value:ASC.CRM.Data.invoiceStatuses[i].value,classname:"",title:ASC.CRM.Data.invoiceStatuses[i].displayname});for(i=0;i<h;i++){for(o=ASC.CRM.Data.invoiceStatuses[i],s=jQuery.extend(!0,[],u),e=0;e<h;e++)s[e].value==o.value&&(s[e].def=!0);filters.push({type:"combobox",id:o.apiname,apiparamname:"status",title:o.displayname,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.InvoicesByStatus,group:ASC.CRM.Resources.CRMInvoiceResource.InvoicesByStatus,groupby:"invoiceStatus",options:s})}for(filters=filters.concat([{type:"combobox",id:"dueLastMonth",apiparamname:jq.toJSON(["dueDateFrom","dueDateTo"]),title:ASC.CRM.Resources.CRMCommonResource.LastMonth,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,group:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,groupby:"byDueDate",options:[{value:jq.toJSON([beginningOfLastMonthString,endOfLastMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth,def:!0},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([beginningOfThisMonthString,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"dueYesterday",apiparamname:jq.toJSON(["dueDateFrom","dueDateTo"]),title:ASC.CRM.Resources.CRMCommonResource.Yesterday,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,group:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,groupby:"byDueDate",options:[{value:jq.toJSON([beginningOfLastMonthString,endOfLastMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday,def:!0},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([beginningOfThisMonthString,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"dueToday",apiparamname:jq.toJSON(["dueDateFrom","dueDateTo"]),title:ASC.CRM.Resources.CRMCommonResource.Today,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,group:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,groupby:"byDueDate",options:[{value:jq.toJSON([beginningOfLastMonthString,endOfLastMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today,def:!0},{value:jq.toJSON([beginningOfThisMonthString,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth}]},{type:"combobox",id:"dueThisMonth",apiparamname:jq.toJSON(["dueDateFrom","dueDateTo"]),title:ASC.CRM.Resources.CRMCommonResource.ThisMonth,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,group:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,groupby:"byDueDate",options:[{value:jq.toJSON([beginningOfLastMonthString,endOfLastMonthString]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.LastMonth},{value:jq.toJSON([t,t]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Yesterday},{value:jq.toJSON([n,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.Today},{value:jq.toJSON([beginningOfThisMonthString,n]),classname:"",title:ASC.CRM.Resources.CRMCommonResource.ThisMonth,def:!0}]},{type:"daterange",id:"dueDateFromTo",title:ASC.CRM.Resources.CRMCommonResource.CustomDateFilter,filtertitle:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,group:ASC.CRM.Resources.CRMInvoiceResource.ByDueDate,groupby:"byDueDate"}]),filters.push({type:ASC.CRM.myInvoiceContactFilter.type,id:ASC.CRM.myInvoiceContactFilter.idFilterByContact,apiparamname:jq.toJSON(["entityid","entityType"]),title:ASC.CRM.Resources.CRMContactResource.Contact,group:ASC.CRM.Resources.CRMCommonResource.Other,hashmask:"",create:ASC.CRM.myInvoiceContactFilter.createFilterByContact,customize:ASC.CRM.myInvoiceContactFilter.customizeFilterByContact,destroy:ASC.CRM.myInvoiceContactFilter.destroyFilterByContact,process:ASC.CRM.myInvoiceContactFilter.processFilter}),u=[],i=0,a=ASC.CRM.Data.currencies.length;i<a;i++)u.push({value:ASC.CRM.Data.currencies[i].abbreviation,title:[ASC.CRM.Data.currencies[i].abbreviation," - ",ASC.CRM.Data.currencies[i].title].join("")});filters.push({type:"combobox",id:"currency",apiparamname:"currency",title:ASC.CRM.Resources.CRMInvoiceResource.ByCurrency,group:ASC.CRM.Resources.CRMCommonResource.Other,options:u,defaulttitle:ASC.CRM.Resources.CRMCommonResource.Choose});ASC.CRM.ListInvoiceView.advansedFilter=jq("#invoiceAdvansedFilter").advansedFilter({anykey:!1,hintDefaultDisable:!1,maxfilters:-1,colcount:2,maxlength:"100",store:!0,inhash:!0,filters:filters,sorters:[{id:"number",title:ASC.CRM.Resources.CRMInvoiceResource.Number,dsc:!0,def:!0},{id:"issueDate",title:ASC.CRM.Resources.CRMInvoiceResource.IssueDate,dsc:!1,def:!1},{id:"contact",title:ASC.CRM.Resources.CRMContactResource.Contact,dsc:!1,def:!1},{id:"dueDate",title:ASC.CRM.Resources.CRMInvoiceResource.DueDate,dsc:!1,def:!1},{id:"status",title:ASC.CRM.Resources.CRMInvoiceResource.Status,dsc:!1,def:!1}]}).on("setfilter",ASC.CRM.ListInvoiceView.setFilter).on("resetfilter",ASC.CRM.ListInvoiceView.resetFilter)}},pt=function(n,t){var i=["<a class='link dotline plus' href='Invoices.aspx?action=create'>",ASC.CRM.Resources.CRMInvoiceResource.CreateFirstInvoice,"<\/a>"].join("");jq.tmpl("template-emptyScreen",{ID:"invoiceEmptyScreen",ImgSrc:n,Header:ASC.CRM.Resources.CRMInvoiceResource.EmptyContentInvoicesHeader,Describe:ASC.CRM.Resources.CRMInvoiceResource.EmptyContentInvoicesDescribe,ButtonHTML:i}).insertAfter("#invoiceList");jq.tmpl("template-emptyScreen",{ID:"emptyContentForInvoiceFilter",ImgSrc:t,Header:ASC.CRM.Resources.CRMInvoiceResource.EmptyContentInvoicesFilterHeader,Describe:ASC.CRM.Resources.CRMInvoiceResource.EmptyContentInvoicesFilterDescribe,ButtonHTML:["<a class='clearFilterButton link dotline' href='javascript:void(0);'","onclick='ASC.CRM.ListInvoiceView.advansedFilter.advansedFilter(null);'>",ASC.CRM.Resources.CRMCommonResource.ClearFilter,"<\/a>"].join("")}).insertAfter("#invoiceList")};return{invoiceList:[],selectedItems:[],isFilterVisible:!1,isFirstLoad:!0,entryCountOnPage:0,defaultCurrentPageNumber:0,noInvoices:!1,noInvoicesForQuery:!1,cookieKey:"",clear:function(){ASC.CRM.ListInvoiceView.invoiceList=[];ASC.CRM.ListInvoiceView.selectedItems=[];ASC.CRM.ListInvoiceView.isFilterVisible=!1;ASC.CRM.ListInvoiceView.entryCountOnPage=0;ASC.CRM.ListInvoiceView.defaultCurrentPageNumber=0;ASC.CRM.ListInvoiceView.noInvoices=!1;ASC.CRM.ListInvoiceView.noInvoicesForQuery=!1;ASC.CRM.ListInvoiceView.cookieKey=""},init:function(t,i,r){var o,e,c;if(jq(t).length!=0){ASC.CRM.Common.setDocumentTitle(ASC.CRM.Resources.CRMInvoiceResource.AllInvoices);ASC.CRM.ListInvoiceView.clear();ASC.CRM.ListInvoiceView.advansedFilter=null;jq(t).removeClass("display-none");jq.tmpl("invoicesListFilterTmpl").appendTo(i);jq.tmpl("invoicesListBaseTmpl").appendTo(t);jq.tmpl("invoicesListPagingTmpl").appendTo(r);ASC.CRM.ListInvoiceView.cookieKey=ASC.CRM.Data.CookieKeyForPagination.invoices;var f={page:1,countOnPage:jq("#tableForInvoiceNavigation select:first>option:first").val()},s=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+location.pathname+location.search,u=location.hash,h=encodeURIComponent(s);u=u&&typeof u=="string"&&u.charAt(0)==="#"?u.substring(1):u;o=jq.cookies.get(h);u==""||o==u?(e=ASC.CRM.Common.getPagingParamsFromCookie(ASC.CRM.ListInvoiceView.cookieKey),e!=null&&(f=e)):n(f.page,f.countOnPage);ASC.CRM.ListInvoiceView.entryCountOnPage=f.countOnPage;ASC.CRM.ListInvoiceView.defaultCurrentPageNumber=f.page;vt(ASC.CRM.ListInvoiceView.entryCountOnPage);pt(ASC.CRM.Data.EmptyScrImgs.empty_screen_invoices,ASC.CRM.Data.EmptyScrImgs.empty_screen_filter);b(ASC.CRM.ListInvoiceView.entryCountOnPage,ASC.CRM.ListInvoiceView.defaultCurrentPageNumber);p();it();jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})});ASC.CRM.ListInvoiceView.initConfirmationPanelForDelete();rt();c=0;jq("#"+ASC.CRM.myInvoiceContactFilter.headerContainerId).contactadvancedSelector({showme:!0,addtext:ASC.CRM.Resources.CRMContactResource.AddNewCompany,noresults:ASC.CRM.Resources.CRMCommonResource.NoMatches,noitems:ASC.CRM.Resources.CRMCommonResource.NoMatches,inPopup:!0,onechosen:!0,isTempLoad:!0});jq(window).on("afterResetSelectedContact",function(n,t,i){i==="invoiceContactSelectorForFilter"&&ASC.CRM.myInvoiceContactFilter.filterId&&jq("#"+ASC.CRM.myInvoiceContactFilter.filterId).advansedFilter("resize")});ASC.CRM.ListInvoiceView.isFirstLoad=!0;jq(".containerBodyBlock").children(".loader-page").show();yt();jq("#invoiceHeaderMenu").on("click",".menuActionDelete.unlockAction",function(){ut()});ft();et()}},setFilter:function(){s()},resetFilter:function(){s()},selectAll:function(n){for(var h,t,u,s=jq(n).is(":checked"),f=[],i=0,c=ASC.CRM.ListInvoiceView.selectedItems.length;i<c;i++)f.push(ASC.CRM.ListInvoiceView.selectedItems[i].id);for(i=0,h=ASC.CRM.ListInvoiceView.invoiceList.length;i<h;i++)t=ASC.CRM.ListInvoiceView.invoiceList[i],u=jq.inArray(t.id,f),s&&u==-1&&(ASC.CRM.ListInvoiceView.selectedItems.push(o(t)),f.push(t.id),jq("#invoice_"+t.id).addClass("selected"),jq("#checkInvoice_"+t.id).prop("checked",!0)),s||u==-1||(ASC.CRM.ListInvoiceView.selectedItems.splice(u,1),f.splice(u,1),jq("#invoice_"+t.id).removeClass("selected"),jq("#checkInvoice_"+t.id).prop("checked",!1));r(ASC.CRM.ListInvoiceView.selectedItems.length);e()},selectItem:function(n){for(var i,f=parseInt(jq(n).attr("id").split("_")[1]),s=null,h=[],t=0,u=ASC.CRM.ListInvoiceView.invoiceList.length;t<u;t++)f==ASC.CRM.ListInvoiceView.invoiceList[t].id&&(s=o(ASC.CRM.ListInvoiceView.invoiceList[t]));for(t=0,u=ASC.CRM.ListInvoiceView.selectedItems.length;t<u;t++)h.push(ASC.CRM.ListInvoiceView.selectedItems[t].id);i=jq.inArray(f,h);jq(n).is(":checked")?(jq(n).parents("tr:first").addClass("selected"),i==-1&&ASC.CRM.ListInvoiceView.selectedItems.push(s),ASC.CRM.ListInvoiceView.checkFullSelection()):(jq("#mainSelectAllInvoices").prop("checked",!1),jq(n).parents("tr:first").removeClass("selected"),i!=-1&&ASC.CRM.ListInvoiceView.selectedItems.splice(i,1));r(ASC.CRM.ListInvoiceView.selectedItems.length);e()},deselectAll:function(){ASC.CRM.ListInvoiceView.selectedItems=[];r(0);jq("#invoiceTable input:checkbox").prop("checked",!1);jq("#mainSelectAllInvoices").prop("checked",!1);jq("#invoiceTable tr.selected").removeClass("selected");y()},checkFullSelection:function(){var n=jq("#invoiceTable tbody tr").length,t=jq("#invoiceTable input[id^=checkInvoice_]:checked").length;jq("#mainSelectAllInvoices").prop("checked",n==t)},deleteBatchInvoices:function(){var n=[],t;(jq("#deleteInvoicesPanel input:checked").each(function(){n.push(parseInt(jq(this).attr("id").split("_")[1]))}),n.length!=0)&&(t={invoiceIDsForDelete:n},Teamlab.removeCrmInvoice(t,n,{success:a,before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMInvoiceResource.DeletingInvoices;LoadingBanner.showLoaderBtn("#deleteInvoicesPanel")},after:function(){LoadingBanner.hideLoaderBtn("#deleteInvoicesPanel")}}))},initConfirmationPanelForDelete:function(){jq.tmpl("template-blockUIPanel",{id:"confirmationDeleteOneInvoicePanel",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:['<div class="confirmationAction">',"<b><\/b>","<\/div>",'<div class="confirmationNote">',ASC.CRM.Resources.CRMJSResource.DeleteConfirmNote,"<\/div>"].join(""),OKBtn:ASC.CRM.Resources.CRMCommonResource.OK,CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel,progressText:ASC.CRM.Resources.CRMInvoiceResource.DeleteInvoiceInProgress}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first")},showConfirmationPanelForDelete:function(n,t,i){jq("#confirmationDeleteOneInvoicePanel .confirmationAction>b").text(jq.format(ASC.CRM.Resources.CRMInvoiceResource.DeleteInvoiceConfirmMessage,Encoder.htmlDecode(n)));jq("#confirmationDeleteOneInvoicePanel .middle-button-container>.button.blue.middle").off("click").on("click",function(){ASC.CRM.ListInvoiceView.deleteInvoice(t,i)});PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#confirmationDeleteOneInvoicePanel",500)},deleteInvoice:function(n,t){var i,r;t===!0?(i=[],i.push(n),r={invoiceIDsForDelete:i},Teamlab.removeCrmInvoice(r,i,a)):Teamlab.removeCrmInvoice({},n,{before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMInvoiceResource.DeleteInvoiceInProgress;LoadingBanner.showLoaderBtn("#confirmationDeleteOneInvoicePanel");LoadingBanner.strLoading=ASC.CRM.Resources.CRMInvoiceResource.DeleteInvoiceInProgress;LoadingBanner.showLoaderBtn("#invoiceList")},success:function(){location.href="Invoices.aspx"}})},changeCountOfRows:function(i){if(!isNaN(i)){var r=i*1;ASC.CRM.ListInvoiceView.entryCountOnPage=r;window.invoicePageNavigator.EntryCountOnPage=r;n(1,r);t(0)}},initTab:function(n,t){ASC.CRM.ListInvoiceView.entityId=n;ASC.CRM.ListInvoiceView.entityType=t},renderSimpleContent:function(){typeof entityData!="undefined"&&window.entityData!=null&&(ASC.CRM.ListInvoiceView.entityId=window.entityData.id,ASC.CRM.ListInvoiceView.entityType=window.entityData.type);LoadingBanner.displayLoading();p();ASC.CRM.ListInvoiceView.initConfirmationPanelForDelete();Teamlab.getCrmEntityInvoices({},ASC.CRM.ListInvoiceView.entityType,ASC.CRM.ListInvoiceView.entityId,{success:tt})},checkInvoicePdfFile:function(n,t,i,r,u){var f={invoice:n},e={invoiceId:n.id,storageUrl:t,revisionId:i};Teamlab.getInvoiceConverterData(f,e,{success:function(n,t){t.fileId>0?(n.invoice.fileId=t.fileId,LoadingBanner.hideLoading(),u(n.invoice,r)):setTimeout(function(){ASC.CRM.ListInvoiceView.checkInvoicePdfFile(n.invoice,t.storageUrl,t.revisionId,r,u)},2e3)},error:function(n,t){LoadingBanner.hideLoading();console.log(t)}})}}}();ASC.CRM.InvoiceActionView=function(){var i={Create:"create",Edit:"edit",Duplicate:"duplicate"},u,r=jq.getURLParam("action")||i.Create,ti=function(n){ui();jq("#invoiceIssueDate").mask(ASC.Resources.Master.DatePatternJQ);jq("#invoiceIssueDate").datepickerWithButton({onSelect:or});jq("#invoiceIssueDate").datepicker("setDate",window.ServiceFactory.serializeDate(window.invoice.issueDate));fi(n);ei(n);r==i.Create?jq("#consigneeEqualClientCbx").prop("checked",!1):jq("#consigneeEqualClientCbx").prop("checked",jq("#invoiceContactID").val()==jq("#invoiceConsigneeID").val());rt();window.invoice.entity?ct(window.invoice.entity):k();jq("#invoiceDueDate").mask(ASC.Resources.Master.DatePatternJQ);jq("#invoiceDueDate").datepickerWithButton({onSelect:vt});jq("#invoiceDueDate").datepicker("setDate",window.ServiceFactory.serializeDate(window.invoice.dueDate));jq("#invoiceDueDate").datepicker("option","minDate",window.ServiceFactory.serializeDate(window.invoice.issueDate));vt();jq("#invoiceLanguage").val(window.invoice.language||ASC.Resources.Master.CurrentCulture);r==i.Create&&window.invoicePresetContact&&window.invoicePresetContact.currencyAbbreviation?d(jq("#invoiceCurrency").val(window.invoicePresetContact.currencyAbbreviation)):(jq("#invoiceCurrency").val(window.invoice.currency.abbreviation),jq("#invoiceExchangeRate").val(window.invoice.exchangeRate),window.invoice.currency.abbreviation!=ASC.CRM.Data.defaultCurrency.abbreviation?(jq("#celectedCurrency").text(window.invoice.currency.abbreviation),jq("#exchangeRateContainer").removeClass("display-none")):(jq("#celectedCurrency").text(""),jq("#exchangeRateContainer").addClass("display-none")));jq("#invoicePurchaseOrderNumber").val(window.invoice.purchaseOrderNumber);jq("#invoiceTerms").val(window.invoice.terms);jq("#invoiceDescription").val(window.invoice.description);jq("#invoiceLineTableContainer").append(jq.tmpl("invoiceLineTableTmpl",cr()));ut(jq("#invoiceLineTableContainer .description textarea"));jq("#invoiceLineTableContainer .tbl-body-row").length||ht(!1);oi();ASC.CRM.Data.IsCRMAdmin===!0&&(si(),hi())},ii=function(){jq.dropdownToggle({dropdownID:"addressDialog",switcherSelector:".add-billing-address, .edit-billing-address, .add-delivery-address, .edit-delivery-address",addTop:0,addLeft:0,showFunction:function(n){bi(n)}});jq.dropdownToggle({dropdownID:"linkOpportunityDialog",switcherSelector:"#linkOpportunityButton",addTop:5,addLeft:0});jq.dropdownToggle({dropdownID:"selectItemDialog",switcherSelector:"#invoiceLineTableContainer .item .custom-input",addTop:0,addLeft:0,showFunction:function(n){u=n;li()}});jq.dropdownToggle({dropdownID:"selectTaxDialog",switcherSelector:"#invoiceLineTableContainer .tax1 .custom-input, #invoiceLineTableContainer .tax2 .custom-input",addTop:0,addLeft:0,showFunction:function(n){u=n;ai()}});jq(window).on("editContactInSelector",function(n,t,i){vi(i)});jq("#consigneeEqualClientCbx").on("click",function(){rt()});jq("#invoiceLineTableContainer").on("change",".quantity input, .price input, .discount input",function(){b(this)});jq("#invoiceLineTableContainer").on("input",".discount input",function(){Number(this.value)>100&&(this.value="100")});jq.forceNumber({parent:"#invoiceLineTableContainer",input:".quantity input, .discount input, .price input",integerOnly:!1,positiveOnly:!0});jq("#invoiceLineTableContainer").on("click",".add-line",function(){ht(!0)});jq("#invoiceLineTableContainer").on("click",".crm-removeLink",function(){di(this)});jq("#crm_invoiceMakerDialog #linkOpportunityDialog").on("click",".dropdown-item",function(){var n={entityType:"opportunity",entityId:jq(this).attr("data-value"),entityTitle:jq(this).text()};ct(n)});jq("#crm_invoiceMakerDialog #opportunityContainer").on("click",".crm-removeLink",function(){k()});jq("#crm_invoiceMakerDialog").on("click","#deleteButton",function(){gi()});jq("#deleteDialog .big-button-container>.button.blue.middle").on("click",function(){nr()});jq("#invoiceCurrency").on("change",function(){d(this)});jq("#currencyHelpSwitcher").on("click",function(){jq(this).helper({BlockHelperID:"currencyHelpInfo"})});jq.forceNumber({parent:"#exchangeRateContainer",input:"#invoiceExchangeRate",integerOnly:!1,positiveOnly:!0});jq("#invoiceExchangeRate").on("change",function(){lt()});jq("#exchangeRateSaveBtn").on("click",function(){tr()});jq("#invoiceLineTableContainer .tbl-body").sortable({handle:".crm-moveLink"});jq("#crm_invoiceMakerDialog .selector").on("click",".add-new-btn",function(){c(this,!0)});jq("#crm_invoiceMakerDialog .selector").on("click",".cancel-btn",function(){c(this,!1)});jq("#crm_invoiceMakerDialog .selector").on("click",".set-default-btn",function(){hr(this)});jq("#crm_invoiceMakerDialog .selector").on("click",".create-btn:not(disable)",function(){sr(this)});jq("#newItemPrice").on("focus",function(){jq("#priceTip").show()});jq("#newItemPrice").on("blur",function(){jq("#priceTip").hide()});jq("#crm_invoiceMakerDialog #selectItemDialog").on("keyup",".custom-input input",function(){wt(this)});jq("#crm_invoiceMakerDialog #selectItemDialog").on("click",".custom-input .serch",function(){wt(jq("#selectItemDialog .custom-input input"))});jq("#crm_invoiceMakerDialog .selector").on("click",".custom-list a",function(){bt(this)});jq("#crm_invoiceMakerDialog").on("click","#changeFormatBtn",function(){ir()});jq("#numberFormatDialog .big-button-container>.button.blue.middle").on("click",function(){ur()});jq("#numberFormatDialog #autogenCbx").on("click",function(){rr()});jq.forceNumber({parent:"#numberFormatDialog",input:"#numberInpt",integerOnly:!0,positiveOnly:!0});jq("#crm_invoiceMakerDialog .duedate-link").on("click",function(){at(this)});jq("#duedatePresetHelpSwitcher").on("click",function(){jq(this).helper({BlockHelperID:"duedatePresetHelpInfo"})});jq("#crm_invoiceMakerDialog").on("click","#setDefaultTermsBtn",function(){fr()});jq("#clientNotesHelpSwitcher").on("click",function(){jq(this).helper({BlockHelperID:"clientNotesHelpInfo"})});jq("#defaultTermsDialog .big-button-container>.button.blue.middle").on("click",function(){er()});jq.forceNumber({parent:"#selectItemDialog",input:"#newItemPrice",integerOnly:!1,positiveOnly:!0,lengthAfterSeparator:2});jq("#selectItemDialog ").on("keyup change","#newItemName, #newItemPrice",function(){pt(this)});jq.forceNumber({parent:"#selectTaxDialog",input:"#newTaxRate",integerOnly:!1,positiveOnly:!1,lengthAfterSeparator:2});jq("#selectTaxDialog ").on("keyup change","#newTaxName, #newTaxRate",function(){pt(this)});jq("#addressDialog").on("click",".button.gray.middle",function(){jq("#addressDialog").hide()})},ri=function(){jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})})},ui=function(){if(r==i.Duplicate){window.invoice.id=0;window.invoice.number=jq("#invoiceNumber").val();for(var n=0;n<window.invoice.invoiceLines.length;n++)window.invoice.invoiceLines[n].id=0,window.invoice.invoiceLines[n].invoiceID=0}r==i.Edit||window.invoiceSettings&&window.invoiceSettings.autogenerated?jq("#invoiceNumber").prop("readonly",!0).addClass("disabled"):jq("#invoiceNumber").trigger("focus")},fi=function(n){var t=[];r==i.Create?window.invoicePresetContact?(t=[window.invoicePresetContact],jq("#invoiceContactID").val(window.invoicePresetContact.id),p(window.invoicePresetContact.id)):jq("#invoiceContactID").val("0"):window.invoice.contact?(t=[window.invoice.contact],jq("#invoiceContactID").val(window.invoice.contact.id),p(window.invoice.contact.id)):jq("#invoiceContactID").val("0");window.invoiceContactSelector=new ASC.CRM.ContactSelector.ContactSelector("invoiceContactSelector",{SelectorType:n,EntityType:0,EntityID:0,ShowOnlySelectorContent:!1,DescriptionText:ASC.CRM.Resources.CRMCommonResource.FindContactByName,DeleteContactText:"",AddContactText:"",IsInPopup:!1,ShowChangeButton:!0,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!0,ShowNewCompanyContent:!0,ShowNewContactContent:!0,HTMLParent:"#invoiceContactSelectorContainer",ExcludedArrayIDs:[],presetSelectedContactsJson:t});window.invoiceContactSelector.SelectItemEvent=function(n,t){window.invoiceContactSelector.setContact(t.input,n.id,n.displayName,n.smallFotoUrl);window.invoiceContactSelector.showInfoContent(t.input);jq("#invoiceContactID").val(n.id);yi(n.id);n.currency&&d(jq("#invoiceCurrency").val(n.currency.abbreviation));p(n.id)};jq(window).on("editContactInSelector",function(n,t,i){i=="invoiceContactSelector"&&(jq("#invoiceOpportunityBlock").hide(),jq("#linkOpportunityDialog").hide())});s()},ei=function(n){var t=[];r==i.Create?jq("#invoiceConsigneeID").val("0"):window.invoice.consignee?(t=[window.invoice.consignee],jq("#invoiceConsigneeID").val(window.invoice.consignee.id)):jq("#invoiceConsigneeID").val("0");window.invoiceConsigneeSelector=new ASC.CRM.ContactSelector.ContactSelector("invoiceConsigneeSelector",{SelectorType:n,EntityType:0,EntityID:0,ShowOnlySelectorContent:!1,DescriptionText:ASC.CRM.Resources.CRMCommonResource.FindContactByName,DeleteContactText:"",AddContactText:"",IsInPopup:!1,ShowChangeButton:!0,ShowAddButton:!1,ShowDeleteButton:!1,ShowContactImg:!0,ShowNewCompanyContent:!0,ShowNewContactContent:!0,HTMLParent:"#invoiceConsigneeSelectorContainer",ExcludedArrayIDs:[],presetSelectedContactsJson:t});window.invoiceConsigneeSelector.SelectItemEvent=function(n,t){window.invoiceConsigneeSelector.setContact(t.input,n.id,n.displayName,n.smallFotoUrl);window.invoiceConsigneeSelector.showInfoContent(t.input);jq("#invoiceConsigneeID").val(n.id);pi(n.id)};h()},rt=function(){var n=jq("#consigneeEqualClientCbx").is(":checked");n?(jq("#consigneeContainer").addClass("display-none"),jq("#invoiceConsigneeID").val(invoiceContactSelector.SelectedContacts[0]||0),jq("#invoiceContactInfoContainer .delivery-address").removeClass("display-none")):(jq("#consigneeContainer").removeClass("display-none"),jq("#invoiceConsigneeID").val(invoiceConsigneeSelector.SelectedContacts[0]||0),jq("#invoiceContactInfoContainer .delivery-address").addClass("display-none"))},ut=function(n){jq.each(n,function(){autosize(jq(this));autosize.update(jq(this))})},oi=function(){jq.tmpl("template-blockUIPanel",{id:"deleteDialog",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:'<div class="deleteContainer"><\/div>',progressText:""}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first");jq("#deleteDialog .deleteContainer").replaceWith(jq.tmpl("deleteDialogTmpl",{}))},si=function(){jq.tmpl("template-blockUIPanel",{id:"numberFormatDialog",headerTest:ASC.CRM.Resources.CRMInvoiceResource.ChangeFormat,questionText:"",innerHtmlText:'<div class="numberFormatContainer"><\/div>',progressText:""}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first");jq("#numberFormatDialog .numberFormatContainer").replaceWith(jq.tmpl("numberFormatDialogTmpl",{}))},hi=function(){jq.tmpl("template-blockUIPanel",{id:"defaultTermsDialog",headerTest:ASC.CRM.Resources.CRMInvoiceResource.SetDefaultTerms,questionText:"",innerHtmlText:'<div class="defaultTermsContainer"><\/div>',progressText:""}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first");jq("#defaultTermsDialog .defaultTermsContainer").replaceWith(jq.tmpl("defaultTermsDialogTmpl",{}))},p=function(n){jq("#linkOpportunityDialog li").remove();Teamlab.getCrmOpportunitiesByContact({},n,{before:function(){LoadingBanner.displayLoading()},success:function(n,t){t.length?(ci(t),jq("#invoiceOpportunityBlock").show()):jq("#invoiceOpportunityBlock").hide();LoadingBanner.hideLoading()},error:function(n,t){LoadingBanner.hideLoading();console.log(t)}})},ci=function(n){for(var i,r,t=0;t<n.length;t++)i=jq("<a><\/a>").addClass("dropdown-item").attr("data-value",n[t].id).text(n[t].title),r=jq("<li><\/li>").append(i),jq("#linkOpportunityDialog ul").append(r)},iu=function(){var n=jq("<span><\/span>").addClass("gray").text(ASC.CRM.Resources.CRMInvoiceResource.EmptyOpportunitiesText),t=jq("<li><\/li>").append(n);jq("#linkOpportunityDialog ul").append(t)},li=function(){var n=jq("#selectItemDialog");n.find(".custom-input input").val("");n.find(".left-side").hide();n.find(".custom-list li").remove();jq(window.invoiceItems).each(function(t,i){ft(n,i)})},ft=function(n,t){var i=t.title.trim(),r=t.stockKeepingUnit.trim(),u=r?"({0}) {1}".format(r,i):i,f=jq("<a><\/a>").attr("data-value",t.id).attr("title",u).text(u),e=jq("<li><\/li>").append(f);return n.find(".custom-list").prepend(e),f},ai=function(){var n=jq("#selectTaxDialog");n.find(".left-side").hide();n.find(".custom-list li").remove();jq(window.invoiceTaxes).each(function(t,i){et(n,i)})},et=function(n,t){var i=t.name.trim(),r=jq("<a><\/a>").attr("data-value",t.id).attr("title",i).text(i),u=jq("<li><\/li>").append(r);n.find(".custom-list").prepend(u)},vi=function(n){n=="invoiceContactSelector"&&(jq("#invoiceContactID").val("0"),jq("#consigneeEqualClientCbx").is(":checked")&&jq("#consigneeEqualClientCbx").trigger("click"),jq("#addressDialog").find("[name='billingAddressID']").val("0"),window.invoiceContactInfo=null,s(),jq("#linkOpportunityDialog li").remove(),k());n=="invoiceConsigneeSelector"&&(jq("#invoiceConsigneeID").val("0"),jq("#addressDialog").find("[name='deliveryAddressID']").val("0"),window.invoiceConsigneeInfo=null,h())},yi=function(n){Teamlab.getCrmContactInfo({},n,{before:function(){LoadingBanner.displayLoading()},success:function(n,t){window.invoiceContactInfo=t;var r=tt(7,3),i=f(0,r);jq("#addressDialog").find("[name='billingAddressID']").val(i!=null?i.id:0);s();LoadingBanner.hideLoading()},error:function(n,t){console.log(t);LoadingBanner.hideLoading()}})},s=function(){var n=jq("#invoiceContactInfoContainer"),t,i;window.invoiceContactInfo?(t=dt(7,3),i=dt(7,1),t?(n.find(".add-billing-address").addClass("display-none"),n.find(".edit-billing-address").removeClass("display-none")):(n.find(".add-billing-address").removeClass("display-none"),n.find(".edit-billing-address").addClass("display-none")),i?(n.find(".add-delivery-address").addClass("display-none"),n.find(".edit-delivery-address").removeClass("display-none")):(n.find(".add-delivery-address").removeClass("display-none"),n.find(".edit-delivery-address").addClass("display-none")),n.removeClass("display-none")):n.addClass("display-none")},pi=function(n){Teamlab.getCrmContactInfo({},n,{before:function(){LoadingBanner.displayLoading()},success:function(n,t){window.invoiceConsigneeInfo=t;var r=it(7,1),i=f(0,r);jq("#addressDialog").find("[name='deliveryAddressID']").val(i!=null?i.id:0);h();LoadingBanner.hideLoading()},error:function(n,t){console.log(t);LoadingBanner.hideLoading()}})},h=function(){var n=jq("#invoiceConsigneeInfoContainer"),t;window.invoiceConsigneeInfo?(t=wr(7,1),t?(n.find(".add-delivery-address").addClass("display-none"),n.find(".edit-delivery-address").removeClass("display-none")):(n.find(".add-delivery-address").removeClass("display-none"),n.find(".edit-delivery-address").addClass("display-none")),n.removeClass("display-none")):n.addClass("display-none")},wi=function(){if(jq("#addressDialog").find("[name='deliveryAddressID']").val(0),jq("#addressDialog").find("[name='billingAddressID']").val(0),window.invoiceJsonData)try{if(window.invoiceJsonData=JSON.parse(jq.base64.decode(window.invoiceJsonData)),window.invoiceJsonData!=null){(!window.invoiceJsonData.hasOwnProperty("DeliveryAddressID")||isNaN(window.invoiceJsonData.DeliveryAddressID))&&(window.invoiceJsonData.DeliveryAddressID=0);var t=it(7,1),n=f(window.invoiceJsonData.DeliveryAddressID,t);jq("#addressDialog").find("[name='deliveryAddressID']").val(n!=null?n.id:0);(!window.invoiceJsonData.hasOwnProperty("BillingAddressID")||isNaN(window.invoiceJsonData.BillingAddressID))&&(window.invoiceJsonData.BillingAddressID=0);t=tt(7,3);n=f(window.invoiceJsonData.BillingAddressID,t);jq("#addressDialog").find("[name='billingAddressID']").val(n!=null?n.id:0)}}catch(i){console.log(i);window.invoiceJsonData=null}else window.invoiceJsonData=null},bi=function(n){var t=n.parents("#invoiceConsigneeInfoContainer").length>0,i=t?jq("#invoiceConsigneeID").val():jq("#invoiceContactID").val();(n.hasClass("add-billing-address")||n.hasClass("edit-billing-address"))&&ot(i,t,!0,3);(n.hasClass("add-delivery-address")||n.hasClass("edit-delivery-address"))&&ot(i,t,!1,1)},ot=function(n,t,i,r){var s=t?it(7,r):tt(7,r),u=jq("#addressDialog"),l=u.find("select.address_type_select"),e=i?parseInt(u.find("[name='billingAddressID']").val()):parseInt(u.find("[name='deliveryAddressID']").val()),o=f(e,s),c,h,a;if(u.find(".address_category").val(r),e=o!=null?o.id:e,i?u.find("[name='billingAddressID']").val(e):u.find("[name='deliveryAddressID']").val(e),o!=null&&s.length!=0){for(w(u,o.data),c="",l.html(""),h=0,a=s.length;h<a;h++)c+=["<option value='",s[h].id,"'>",i?ASC.CRM.Resources.CRMJSResource.BillingAddress:ASC.CRM.Resources.CRMJSResource.DeliveryAddress," #",h+1,"<\/option>"].join("");l.html(c).val(o.id).off("change").on("change",function(){e=parseInt(this.value);o=f(e,s);i?u.find("[name='billingAddressID']").val(e):u.find("[name='deliveryAddressID']").val(e);w(u,o.data)}).tlCombobox();u.find(".address_type_select").parent().show()}else w(u,null),u.find(".address_type_select").parent().hide();u.find(".button.blue.middle").off().on("click",function(){var c=u.find(".address_category").val(),r=u.find(".contact_street").val().trim(),f=u.find(".contact_city").val().trim(),e=u.find(".contact_state").val().trim(),s=u.find(".contact_zip").val().trim(),h=u.find(".contact_country").val().trim(),l={id:o?o.id:0,category:["Home","Postal","Office","Billing","Other","Work"][c],infoType:7,data:JSON.stringify({street:r,city:f,state:e,zip:s,country:h})};r||f||e||s||h?ki(n,l,t,i):u.hide()})},f=function(n,t){if(t==null)return null;if(n==0)return t[0];for(var i=0,r=t.length;i<r;i++)if(t[i].id==n)return t[i];return t[0]},w=function(n,t){if(t!=null){var i=JSON.parse(t);n.find(".contact_street").val(i.street);n.find(".contact_city").val(i.city);n.find(".contact_state").val(i.state);n.find(".contact_zip").val(i.zip);n.find(".contact_country").val(i.country)}else n.find(".contact_street").val(""),n.find(".contact_city").val(""),n.find(".contact_state").val(""),n.find(".contact_zip").val(""),n.find(".contact_country").val("")},ki=function(n,t,i,r){function e(){window.LoadingBanner.displayLoading()}function o(t,i){t.isConsignee?(br(i),h()):(pr(i),s());t.isBilling?jq("#addressDialog").find("[name='billingAddressID']").val(i.id):jq("#addressDialog").find("[name='deliveryAddressID']").val(i.id);jq("#addressDialog").hide();jq(window).trigger("addressCrmContactSaveSuccess",[n,i]);window.LoadingBanner.hideLoading()}function c(){console.log(error);window.LoadingBanner.hideLoading()}var u={contactId:n,isConsignee:i,isBilling:r},f={before:e,success:o,error:c};t.id==0?window.Teamlab.addCrmContactInfo(u,n,t,f):window.Teamlab.updateCrmContactInfo(u,n,t,f)},b=function(i){var s=jq(i).val(),f=jq(i).parent(),r;if(f.is(".item")){var o=t(i,".tbl-body-row"),c=Number(jq("#invoiceExchangeRate").val())||1,l=v(i).id,u=nt(l),h=o.find(".price input");autosize.update(o.find(".description textarea").val(u.description));h.val(n(u.price/c,2).toFixed(2));r=e(u.invoiceTax1ID);a(o.find(".tax1 .custom-input"),r?r.name:"",r?r.id:0);r=e(u.invoiceTax2ID);a(o.find(".tax2 .custom-input"),r?r.name:"",r?r.id:0);st(h,u.price)}(f.is(".quantity")||f.is(".discount")||f.is(".price"))&&(s?jq(i).val(Number(s).toFixed(2)):jq(i).val("0.00"));st(i,s);y()},st=function(n,i){var r=jq(n).parent(),u,f,e;r.is(".price")&&(u=t(r,".tbl-body-row"),u.toggleClass("price-error",i>ASC.CRM.Data.MaxInvoiceItemPrice),f=jq("#crm_invoiceMakerDialog .middle-button-container a.button.big:not(.cancelSbmtFormBtn )"),e=jq("#crm_invoiceMakerDialog .tbl-body-row.price-error").length>0,f.toggleClass("disable",e))},ht=function(n){jq("#invoiceLineTableContainer .tbl-body").append(jq.tmpl("invoiceLineTmpl",lr()));var t=jq("#invoiceLineTableContainer .tbl-body-row:last");ut(t.find(".description textarea"));y();n===!0&&t.find(".description:first textarea").trigger("focus")},di=function(n){var i=t(n,".tbl-body-row");autosize.destroy(i.find(".description textarea"));i.remove();y()},ct=function(n){jq("#selectedOpportunity").text(n.entityTitle);jq("#invoiceOpportunityID").val(n.entityId);jq("#opportunitySelector").addClass("display-none");jq("#opportunityContainer").removeClass("display-none")},k=function(){jq("#selectedOpportunity").text("");jq("#invoiceOpportunityID").val(0);jq("#opportunitySelector").removeClass("display-none");jq("#opportunityContainer").addClass("display-none")},gi=function(){var n=jq.format(ASC.CRM.Resources.CRMInvoiceResource.DeleteInvoiceConfirmMessage,Encoder.htmlDecode(window.invoice.number));jq("#deleteDialog .header-base-small").text(n);jq("#deleteDialog .error-popup").text("").hide();StudioBlockUIManager.blockUI("#deleteDialog",500)},nr=function(){Teamlab.removeCrmInvoice({},window.invoice.id,{before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMInvoiceResource.DeleteInvoiceInProgress;LoadingBanner.showLoaderBtn("#deleteDialog")},success:function(){ASC.CRM.Common.unbindOnbeforeUnloadEvent();location.href="Invoices.aspx"},error:function(n,t){jq("#deleteDialog .error-popup").text(t[0]).show();LoadingBanner.hideLoaderBtn("#deleteDialog");console.log(t)}})},d=function(n){var t=jq(n).val(),i;t!=ASC.CRM.Data.defaultCurrency.abbreviation?(jq("#celectedCurrency").text(t),jq("#exchangeRateContainer").removeClass("display-none")):(jq("#celectedCurrency").text(""),jq("#exchangeRateContainer").addClass("display-none"));jq("#invoiceLineTableContainer .currency").text(t);i=kt(t,ASC.CRM.Data.defaultCurrency.abbreviation);i?jq("#invoiceExchangeRate").val(i.rate.toFixed(2)):jq("#invoiceExchangeRate").val("1.00");lt()},lt=function(){var i=Number(jq("#invoiceExchangeRate").val());i<=0?(jq("#invoiceExchangeRate").val("1.00"),i=1):jq("#invoiceExchangeRate").val(i.toFixed(2));jq("#exchangeRateSavedText").addClass("display-none");jq("#invoiceLineTableContainer .tbl-body-row .item .custom-input").each(function(){var r=jq(this),f=t(r,".tbl-body-row"),e=v(r).id,u=nt(e);u!=null&&f.find(".price input").val(n(u.price/i,2).toFixed(2))});y()},tr=function(){function i(){var r=Number(jq("#invoiceExchangeRate").val()),t=jq("#invoiceCurrency").val(),i=ASC.CRM.Data.defaultCurrency.abbreviation,n=kt(t,i)||{};return n.fromCurrency=t,n.toCurrency=i,n.rate=r,n}var n=i(),t={before:function(){LoadingBanner.displayLoading()},success:function(n,t){yr(t);jq("#exchangeRateSavedText").removeClass("display-none");LoadingBanner.hideLoading()},error:function(n,t){LoadingBanner.hideLoading();console.log(t)}};n.id?Teamlab.updateCrmCurrencyRate({},n.id,n,t):Teamlab.addCrmCurrencyRate({},n,t)},ir=function(){jq("#numberFormatDialog .error-popup").text("").hide();jq("#autogenCbx").attr("checked",window.invoiceSettings.autogenerated);o(!window.invoiceSettings.autogenerated,!1);jq("#prefixInpt").val(window.invoiceSettings.prefix);jq("#numberInpt").val(window.invoiceSettings.number);StudioBlockUIManager.blockUI("#numberFormatDialog",500)},o=function(n,t){var i="#prefixInpt, #numberInpt";t&&(i+=", #autogenCbx");n?jq(i).prop("disabled",!0).prop("readonly",!0).addClass("disabled"):jq(i).prop("disabled",!1).prop("readonly",!1).removeClass("disabled")},rr=function(){var n=jq("#autogenCbx").is(":checked");o(!n,!1)},ur=function(){var n={autogenerated:jq("#autogenCbx").is(":checked"),prefix:jq("#prefixInpt").val().trim(),number:jq("#numberInpt").val().trim()};if(n.autogenerated&&!n.number){jq("#numberFormatDialog .error-popup").text(ASC.CRM.Resources.CRMInvoiceResource.NumberFormatRequiredErrorMsg).show();return}jq("#numberFormatDialog .error-popup").text("").hide();Teamlab.updateCrmInvoiceSettingsName({},n,{before:function(){o(!0,!0);LoadingBanner.strLoading=ASC.CRM.Resources.CRMInvoiceResource.SaveNumberSettingsProgress;LoadingBanner.showLoaderBtn("#numberFormatDialog")},success:function(t,i){window.invoiceSettings=i;n.autogenerated?jq("#invoiceNumber").val(i.prefix+i.number).prop("readonly",!0).addClass("disabled"):jq("#invoiceNumber").prop("readonly",!1).removeClass("disabled");o(!1,!0);LoadingBanner.hideLoaderBtn("#numberFormatDialog");jq.unblockUI()},error:function(n,t){jq("#numberFormatDialog .error-popup").text(ASC.CRM.Resources.CRMInvoiceResource.NumberFormatErrorMsg).show();o(!1,!0);LoadingBanner.hideLoaderBtn("#numberFormatDialog");console.log(t)}})},fr=function(){ASC.CRM.Data.IsCRMAdmin===!0?(jq("#defaultTermsDialog .error-popup").text("").hide(),jq("#defaultTerms").val(window.invoiceSettings.terms),StudioBlockUIManager.blockUI("#defaultTermsDialog",500)):jq("#invoiceTerms").val(window.invoiceSettings.terms)},g=function(n){var t="#defaultTerms";n?jq(t).prop("disabled",!0).prop("readonly",!0).addClass("disabled"):jq(t).prop("disabled",!1).prop("readonly",!1).removeClass("disabled")},er=function(){var n={terms:jq("#defaultTerms").val()};Teamlab.updateCrmInvoiceSettingsTerms({},n,{before:function(){g(!0);LoadingBanner.strLoading=ASC.CRM.Resources.CRMInvoiceResource.SaveTermsSettingsProgress;LoadingBanner.showLoaderBtn("#defaultTermsDialog")},success:function(n,t){window.invoiceSettings=t;jq("#invoiceTerms").val(t.terms);g(!1);LoadingBanner.hideLoaderBtn("#defaultTermsDialog");jq.unblockUI()},error:function(n,t){jq("#numberFormatDialog .error-popup").text(t[0]).show();g(!1);LoadingBanner.hideLoaderBtn("#defaultTermsDialog");console.log(t)}})},or=function(){var t=jq(this).datepicker("getDate")||new Date,n;jq("#invoiceDueDate").datepicker("option","minDate",t);n=jq(".duedate-link.selected");n.length>0&&at(n);jq("#invoiceIssueDate").datepicker("hide")},at=function(n){var t=parseInt(jq(n).attr("id").replace("duedate_","")),i=jq("#invoiceIssueDate").datepicker("getDate")||new Date,r=new Date(i.setDate(i.getDate()+t));jq("#invoiceDueDate").datepicker("setDate",r);yt(t)},vt=function(){var n=jq("#invoiceDueDate").datepicker("getDate")||new Date,t=jq("#invoiceIssueDate").datepicker("getDate")||new Date,i=Math.floor((n.getTime()-t.getTime())/864e5);yt(i);jq("#invoiceDueDate").datepicker("hide")},yt=function(n){jq(".duedate-link").removeClass("selected");(n==0||n==15||n==30||n==45)&&jq("#duedate_"+n).addClass("selected");jq(window).trigger("selectInvoiceDueDateComplete",[n])},c=function(n,i){var u=jq(n).is(".selector")?jq(n):t(n,".selector"),r=u.find(".left-side");i?r.is(":visible")||(r.find("input").val(""),r.find(".create-btn").addClass("disable"),r.show(),u.css("left",u.position().left-r.outerWidth(!0)+"px"),r.find("input:first").trigger("focus")):r.is(":visible")&&(r.hide(),u.css("left",u.position().left+r.outerWidth(!0)+"px"),u.find(".createTaxError").hide())},sr=function(n){var i,f,r,o,e,u,s;if(!jq(n).hasClass("disable")){if(i=t(n,".selector"),i.attr("id")=="selectItemDialog"){if(f=jq("#newItemName").val().trim(),r=jq("#newItemPrice").val().trim(),!f||!r)return;if(r=Number(r),r<=0)return;o={title:f,description:"",price:r,sku:"",stockQuantity:0,trackInventory:!1,invoiceTax1id:0,invoiceTax2id:0};Teamlab.addCrmInvoiceItem({},o,{before:function(){l(i,!0)},after:function(){l(i,!1)},success:function(n,t){var r=ft(i,t);c(i,!1);ar(t);bt(r)}})}if(i.attr("id")=="selectTaxDialog"){if(e=jq("#newTaxName").val().trim(),u=jq("#newTaxRate").val().trim(),!e||!u)return;if(u=Number(u),Math.abs(u)>100)return;s={name:e,description:"",rate:u};Teamlab.addCrmInvoiceTax({},s,{before:function(){i.find(".createTaxError").hide();l(i,!0)},after:function(){l(i,!1)},success:function(n,t){et(i,t);c(i,!1);vr(t)},error:function(){i.find(".createTaxError").show()}})}}},l=function(n,t){t?(n.find(".left-side input").prop("readonly",!0).addClass("disabled"),LoadingBanner.strLoading=ASC.CRM.Resources.CRMJSResource.PleaseWait,LoadingBanner.showLoaderBtn("#"+n.attr("id"))):(n.find(".left-side input").prop("readonly",!1).removeClass("disabled"),LoadingBanner.hideLoaderBtn("#"+n.attr("id")))},pt=function(n){var r=t(n,".selector"),i=!0;r.find(".left-side input").each(function(){var n=jq(this).val().trim(),t,r;n||(i=!1);jq(this).is("#newItemPrice")&&(t=Number(n),(t<=0||t>ASC.CRM.Data.MaxInvoiceItemPrice)&&(i=!1));jq(this).is("#newTaxRate")&&(r=Number(n),Math.abs(r)>100&&(i=!1))});i?r.find(".left-side .create-btn").removeClass("disable"):r.find(".left-side .create-btn").addClass("disable")},wt=function(n){var i=jq(n).val().trim(),r=t(n,".selector");r.find(".custom-list li").each(function(){var n=jq(this).find("a").text();i!=""&&n.indexOf(i)==-1?jq(this).hide():jq(this).show()})},bt=function(n){var i=jq(n),r=t(n,".selector");a(u,i.text(),i.attr("data-value"));r.hide();b(u)},hr=function(n){var i=t(n,".selector");a(u,"",0);i.hide();b(u)},a=function(n,t,i){n.find("input[type=text]").val(Number(i)>0?t:"");n.find("input[type=hidden]").val(i)},v=function(n){return{text:n.find("input[type=text]").val(),id:n.find("input[type=hidden]").val()}},cr=function(){function i(n,i){for(var u=-1,r=0;r<t.taxLines.length;r++)if(t.taxLines[r].id==n.id){u=r;break}u>-1?t.taxLines[r].value+=i:t.taxLines.push({id:n.id,name:n.name,rate:n.rate,value:i})}var t={invoiceLines:[],subtotal:0,discountValue:0,taxValue:0,total:0,currency:window.invoice.currency.abbreviation,taxLines:[],isAdmin:ASC.CRM.Data.IsCRMAdmin};return t.invoiceLines=jq.map(window.invoice.invoiceLines,function(r){r.invoiceItem=nt(r.invoiceItemID);r.invoiceTax1=e(r.invoiceTax1ID);r.invoiceTax2=e(r.invoiceTax2ID);r.subtotal=n(r.quantity*r.price,2);r.discountValue=n(r.subtotal*r.discount/100,2);var u=0;return r.invoiceTax1&&(u+=r.invoiceTax1.rate,i(r.invoiceTax1,n((r.subtotal-r.discountValue)*r.invoiceTax1.rate/100,2))),r.invoiceTax2&&(u+=r.invoiceTax2.rate,i(r.invoiceTax2,n((r.subtotal-r.discountValue)*r.invoiceTax2.rate/100,2))),r.taxValue=n((r.subtotal-r.discountValue)*u/100,2),r.total=n(r.subtotal-r.discountValue+r.taxValue,2),t.subtotal+=r.subtotal,t.discountValue+=r.discountValue,t.taxValue+=r.taxValue,t.total+=r.total,r}),t.subtotal=n(t.subtotal,2),t.discountValue=n(t.discountValue,2),t.taxValue=n(t.taxValue,2),t.total=n(t.total,2),t},lr=function(){var n={};return n.description="",n.discount=0,n.id=0,n.invoiceID=window.invoice.id,n.invoiceItem=null,n.invoiceTax1=null,n.invoiceTax2=null,n.price=0,n.quantity=1,n.sortOrder=0,n.subtotal=0,n.discountValue=0,n.taxValue=0,n.total=0,n},y=function(){function f(n,i){for(var u=-1,r=0;r<t.taxLines.length;r++)if(t.taxLines[r].id==n.id){u=r;break}u>-1?t.taxLines[r].value+=i:t.taxLines.push({id:n.id,name:n.name,rate:n.rate,value:i})}function o(){var n=jq("#invoiceLineTableContainer .tbl-body-row");n.length==1?n.find(".crm-moveLink, .crm-removeLink").addClass("display-none"):n.find(".crm-moveLink, .crm-removeLink").removeClass("display-none")}var t={subtotal:0,discountValue:0,taxValue:0,total:0,currency:jq("#invoiceCurrency").val(),taxLines:[]},i,r,u;jq("#invoiceLineTableContainer .tbl-body-row").each(function(){var r=jq(this),y=Number(r.find(".quantity input").val()),p=Number(r.find(".price input").val()),w=Number(r.find(".discount input").val()),o=e(v(r.find(".tax1 .custom-input")).id),s=e(v(r.find(".tax2 .custom-input")).id),i=n(y*p,2),u=n(i*w/100,2),l=(i-u).toFixed(2),h,c,a;r.find(".amount").text(l).attr("title",l);h=0;o&&(h+=o.rate,f(o,n((i-u)*o.rate/100,2)));s&&(h+=s.rate,f(s,n((i-u)*s.rate/100,2)));c=n((i-u)*h/100,2);a=n(i-u+c,2);t.subtotal+=i;t.discountValue+=u;t.taxValue+=c;t.total+=a});t.subtotal=n(t.subtotal,2);t.discountValue=n(t.discountValue,2);t.taxValue=n(t.taxValue,2);t.total=n(t.total,2);i=(t.subtotal-t.discountValue).toFixed(2);jq("#invoiceLineTableContainer .subtotal").text(i).attr("title",i);r=jq("<div><\/div>").addClass("tbl-taxes");jq.each(t.taxLines,function(n,t){r.append(jq.tmpl("invoiceTaxLineTmpl",t))});jq("#invoiceLineTableContainer .tbl-taxes").replaceWith(r);jq("#invoiceLineTableContainer .currency").text(t.currency);u=t.total.toFixed(2);jq("#invoiceLineTableContainer .total").text(u).attr("title",u);o()},n=function(n,t){return t=t||0,Math.round(n*Math.pow(10,t))/Math.pow(10,t)},t=function(n,t){var i=jq(n).parents(t);return i.length?jq(i[0]):null},nt=function(n){for(var t=0;t<window.invoiceItems.length;t++)if(window.invoiceItems[t].id==n)return window.invoiceItems[t];return null},ar=function(n){var t={id:n.id,title:n.title,stockKeepingUnit:n.stockKeepingUnit,description:n.description,price:n.price,stockQuantity:n.stockQuantity,trackInventory:n.trackInventory,invoiceTax1ID:n.invoiceTax1ID,invoiceTax2ID:n.invoiceTax2ID};window.invoiceItems.push(t)},e=function(n){if(Number(n)>0)for(var t=0;t<window.invoiceTaxes.length;t++)if(window.invoiceTaxes[t].id==n)return window.invoiceTaxes[t];return null},vr=function(n){var t={id:n.id,name:n.name,description:n.description,rate:n.rate};window.invoiceTaxes.splice(1,0,t)},kt=function(n,t){for(var i=0;i<window.currencyRates.length;i++)if(window.currencyRates[i].fromCurrency==n&&window.currencyRates[i].toCurrency==t)return window.currencyRates[i];return null},yr=function(n){for(var i=-1,t=0;t<window.currencyRates.length;t++)if(window.currencyRates[t].id==n.id){i=t;break}i==-1?window.currencyRates.splice(1,0,n):window.currencyRates[i]=n},dt=function(n,t){return window.invoiceContactInfo?jq.grep(window.invoiceContactInfo,function(i){return i.infoType==n&&i.category==t}).sort(function(n,t){return n.id-t.id})[0]||null:null},tt=function(n,t){return window.invoiceContactInfo?jq.grep(window.invoiceContactInfo,function(i){return i.infoType==n&&i.category==t}).sort(function(n,t){return n.id-t.id})||null:null},pr=function(n){for(var i=!1,t=0;t<window.invoiceContactInfo.length;t++)if(window.invoiceContactInfo[t].id==n.id){window.invoiceContactInfo[t]=n;i=!0;break}i||window.invoiceContactInfo.splice(1,0,n)},wr=function(n,t){return window.invoiceConsigneeInfo?jq.grep(window.invoiceConsigneeInfo,function(i){return i.infoType==n&&i.category==t}).sort(function(n,t){return n.id-t.id})[0]||null:null},it=function(n,t){return window.invoiceConsigneeInfo?jq.grep(window.invoiceConsigneeInfo,function(i){return i.infoType==n&&i.category==t}).sort(function(n,t){return n.id-t.id})||null:null},br=function(n){for(var i=!1,t=0;t<window.invoiceConsigneeInfo.length;t++)if(window.invoiceConsigneeInfo[t].id==n.id){window.invoiceConsigneeInfo[t]=n;i=!0;break}i||window.invoiceConsigneeInfo.splice(1,0,n)},gt=function(n){var t=n.val().trim();if(!t)return null;try{jQuery.datepicker.parseDate(ASC.Resources.Master.DatepickerDatePattern,t)}catch(i){return console.error("Try parse "+t+" to "+ASC.Resources.Master.DatepickerDatePattern+" format.",i),null}return n.datepicker("getDate")},kr=function(){function f(){RemoveRequiredErrorClass(jq("#invoiceNumber"));RemoveRequiredErrorClass(jq("#invoiceIssueDate"));RemoveRequiredErrorClass(jq("#invoiceContactID"));RemoveRequiredErrorClass(jq("#invoiceConsigneeID"));RemoveRequiredErrorClass(jq("#invoiceDueDate"));RemoveRequiredErrorClass(jq("#invoiceLanguage"));RemoveRequiredErrorClass(jq("#invoiceCurrency"));RemoveRequiredErrorClass(jq("#invoiceExchangeRate"));RemoveRequiredErrorClass(jq("#invoiceTerms"));RemoveRequiredErrorClass(jq("#invoiceLineTableHeader"))}var n,i,t,r,u;return f(),n=!0,jq("#invoiceNumber").val().trim()==""&&(ShowRequiredError(jq("#invoiceNumber")),n=!1),i=gt(jq("#invoiceIssueDate")),i||(ShowRequiredError(jq("#invoiceIssueDate")),n=!1),jq("#invoiceContactID").val()<=0&&(ShowRequiredError(jq("#invoiceContactID")),n=!1),t=jq("#invoiceDueDate"),r=gt(t),r||(AddRequiredErrorText(t,ASC.CRM.Resources.CRMInvoiceResource.DueDateRequiredErrorMsg),ShowRequiredError(t),n=!1),i&&r&&i>r&&(AddRequiredErrorText(t,ASC.CRM.Resources.CRMInvoiceResource.DueDateInvalidErrorMsg),ShowRequiredError(t),n=!1),jq("#invoiceLanguage").val().trim()==""&&(ShowRequiredError(jq("#invoiceLanguage")),n=!1),jq("#invoiceCurrency").val().trim()==""&&(ShowRequiredError(jq("#invoiceCurrency")),n=!1),jq("#invoiceExchangeRate").val()<=0&&jq("#exchangeRateContainer").is(":visible")&&(ShowRequiredError(jq("#invoiceExchangeRate")),n=!1),jq("#invoiceTerms").val().trim()==""&&(ShowRequiredError(jq("#invoiceTerms")),n=!1),jq("#invoiceLineTableContainer .tbl-body-row").length?(u=!1,jq.each(jq("#invoiceLineTableContainer .tbl-body-row .item input[type=hidden]"),function(){jq(this).val()<=0&&(u=!0)}),u&&(AddRequiredErrorText(jq("#invoiceLineTableHeader"),ASC.CRM.Resources.CRMInvoiceResource.ProductsAndServicesEmptyItemErrorMsgs),ShowRequiredError(jq("#invoiceLineTableHeader")),n=!1)):(AddRequiredErrorText(jq("#invoiceLineTableHeader"),ASC.CRM.Resources.CRMInvoiceResource.ProductsAndServicesRequiredErrorMsg),ShowRequiredError(jq("#invoiceLineTableHeader")),n=!1),n},ni=function(){jq("#invoiceLineTableContainer .tbl-body-row").each(function(n,t){jq(t).find("[name^=iLine]").each(function(t,i){var r=jq(i).attr("name").split("_");r[2]=n;jq(i).attr("name",r.join("_"))})})},dr=function(){jq("#crm_invoiceMakerDialog input, #crm_invoiceMakerDialog select, #crm_invoiceMakerDialog textarea").prop("readonly","readonly").addClass("disabled");LoadingBanner.strLoading=r==i.Edit?ASC.CRM.Resources.CRMJSResource.EditingInvoiceProgress:ASC.CRM.Resources.CRMJSResource.AddNewInvoiceProgress;LoadingBanner.showLoaderBtn("#crm_invoiceMakerDialog")},gr=function(){jq("#crm_invoiceMakerDialog input, #crm_invoiceMakerDialog select, #crm_invoiceMakerDialog textarea").prop("readonly",!1).removeClass("disabled");LoadingBanner.hideLoaderBtn("#crm_invoiceMakerDialog")},nu=function(n){var t=jq.cookies.get(n);t!=null&&t!=""&&(console.log(t),jq.cookies.del(n),jq("#saveInvoiceError .saveInvoiceErrorText").text(jq.format(ASC.CRM.Resources.CRMInvoiceResource.SavingInvoiceServerError,t)),jq("[id*=_saveButton]:first").removeClass("postInProcess"),StudioBlockUIManager.blockUI("#saveInvoiceError",500))},tu=function(){jq("#crm_invoiceMakerDialog").on("keyup change paste","input, select, textarea",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()});jq("#crm_invoiceMakerDialog").on("click",".crm-removeLink",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()});jq(window).on("setContactInSelector editContactInSelector deleteContactFromSelector addressCrmContactSaveSuccess selectInvoiceDueDateComplete",function(){ASC.CRM.Common.bindOnbeforeUnloadEvent()})};return{init:function(n,t){if(jq.tmpl("template-blockUIPanel",{id:"saveInvoiceError",headerTest:ASC.CRM.Resources.CRMInvoiceResource.Warning,questionText:"",innerHtmlText:"<div class='saveInvoiceErrorText'><\/div>",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Close,progressText:""}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first"),nu(t),typeof invoiceItems!="undefined")try{window.invoiceItems=JSON.parse(jq.base64.decode(window.invoiceItems))}catch(i){console.log(i);window.invoiceItems=[]}if(typeof invoiceTaxes!="undefined")try{window.invoiceTaxes=JSON.parse(jq.base64.decode(window.invoiceTaxes))}catch(i){console.log(i);window.invoiceTaxes=[]}if(typeof invoiceSettings!="undefined")try{window.invoiceSettings=JSON.parse(jq.base64.decode(window.invoiceSettings))}catch(i){console.log(i);window.invoiceSettings=null}if(typeof invoicePresetContact!="undefined")try{window.invoicePresetContact=window.invoicePresetContact?JSON.parse(jq.base64.decode(window.invoicePresetContact)):null}catch(i){console.log(i);window.invoicePresetContact=null}if(typeof currencyRates!="undefined")try{window.currencyRates=window.currencyRates?JSON.parse(jq.base64.decode(window.currencyRates)):null}catch(i){console.log(i);window.currencyRates=[]}if(typeof invoiceContactInfo!="undefined")try{window.invoiceContactInfo=window.invoiceContactInfo?JSON.parse(jq.base64.decode(window.invoiceContactInfo)).response:null}catch(i){console.log(i);window.invoiceContactInfo=null}if(typeof invoiceConsigneeInfo!="undefined")try{window.invoiceConsigneeInfo=window.invoiceConsigneeInfo?JSON.parse(jq.base64.decode(window.invoiceConsigneeInfo)).response:null}catch(i){console.log(i);window.invoiceConsigneeInfo=null}if(wi(),typeof invoice!="undefined")try{window.invoice=JSON.parse(jq.base64.decode(window.invoice)).response;ti(n);ii();tu();ri();jq(".cancelSbmtFormBtn:first").on("click",function(){return ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0});return!0}catch(i){return console.log(i),!1}else return ASC.CRM.Common.unbindOnbeforeUnloadEvent(),window.location.href="Invoices.aspx",!1},submitForm:function(n){var t=jq("[id*=_saveButton]:first");if(t.hasClass("disable")||t.hasClass("postInProcess"))return!1;t.addClass("postInProcess");try{return kr()?(dr(),window.invoice!=null&&window.invoice.id!=0?(ni(),ASC.CRM.Common.unbindOnbeforeUnloadEvent(),!0):(Teamlab.getCrmInvoiceByNumberExistence({buttonId:n},jq("#invoiceNumber").val().trim(),{success:function(n,i){return i==!0?(jq("#saveInvoiceError .saveInvoiceErrorText").text(ASC.CRM.Resources.CRMInvoiceResource.InvoiceNumberBusyError),t.removeClass("postInProcess"),StudioBlockUIManager.blockUI("#saveInvoiceError",500),gr(),!1):(ni(),ASC.CRM.Common.unbindOnbeforeUnloadEvent(),__doPostBack(n.buttonId,""),!0)},error:function(){return t.removeClass("postInProcess"),!1}}),!1)):(t.removeClass("postInProcess"),!1)}catch(i){return console.log(i),t.removeClass("postInProcess"),!1}}}}();ASC.CRM.InvoiceDetailsView=function(){function l(){location.href="Invoices.aspx?id={0}&action=pdf".format(window.invoice.id)}var i=function(){jq.tmpl("template-blockUIPanel",{id:"deleteDialog",headerTest:ASC.CRM.Resources.CRMCommonResource.Confirmation,questionText:"",innerHtmlText:'<div class="deleteContainer"><\/div>',progressText:""}).appendTo("#studioPageContent .mainPageContent .containerBodyBlock:first");jq("#deleteDialog .deleteContainer").replaceWith(jq.tmpl("deleteDialogTmpl",{}))},r=function(){jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active");jq("#invoiceDetailsMenuPanel").hide();var n=jq.format(ASC.CRM.Resources.CRMInvoiceResource.DeleteInvoiceConfirmMessage,window.invoice.number);jq("#deleteDialog .header-base-small").text(n);jq("#deleteDialog .error-popup").text("").hide();StudioBlockUIManager.blockUI("#deleteDialog",500)},u=function(){Teamlab.removeCrmInvoice({},window.invoice.id,{before:function(){LoadingBanner.strLoading=ASC.CRM.Resources.CRMInvoiceResource.DeleteInvoiceInProgress;LoadingBanner.showLoaderBtn("#deleteDialog")},success:function(){location.href="Invoices.aspx"},error:function(n,t){jq("#deleteDialog .error-popup").text(t[0]).show();LoadingBanner.hideLoaderBtn("#deleteDialog");console.log(t)}})},f=function(){jq(document).ready(function(){jq.dropdownToggle({dropdownID:"invoiceDetailsMenuPanel",switcherSelector:".mainContainerClass .containerHeaderBlock .menu-small",addTop:0,addLeft:-10,beforeShowFunction:function(){a();v()},showFunction:function(n,t){t.is(":hidden")?n.addClass("active"):n.removeClass("active")},hideFunction:function(){jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active")}})});jq("#invoiceDetailsMenuPanel .print-btn").on("click",function(){jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active");jq("#invoiceDetailsMenuPanel").hide();s()});jq("#invoiceDetailsMenuPanel .download-btn").on("click",function(){h()});jq("#invoiceDetailsMenuPanel .delete-btn").on("click",function(){r()});jq("#deleteDialog .big-button-container>.button.blue.middle").on("click",function(){u()});jq("#invoiceDetailsMenuPanel .mail-btn").on("click",function(){jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active");jq("#invoiceDetailsMenuPanel").hide();c()})},e=function(){jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})})},o=function(){if(typeof invoice!="undefined")try{window.invoice=Teamlab.create("crm-invoice",null,JSON.parse(jq.base64.decode(window.invoice)).response)}catch(t){console.log(t);window.invoice=null}if(typeof invoiceData!="undefined")try{window.invoiceData=JSON.parse(jq.base64.decode(window.invoiceData))}catch(t){console.log(t);window.invoiceData=null}window.invoice&&window.invoiceData||(window.location.href="Invoices.aspx");(window.invoiceData.LogoBase64==null||window.invoiceData.LogoBase64=="")&&window.invoiceData.hasOwnProperty("LogoBase64Id")&&window.invoiceData.LogoBase64Id>0?Teamlab.getOrganisationSettingsLogo({},window.invoiceData.LogoBase64Id,function(t,i){window.invoiceData.LogoBase64=i;jq(".invoice-container").replaceWith(jq.tmpl("invoiceDetailsTmpl",window.invoiceData));n()}):(jq(".invoice-container").replaceWith(jq.tmpl("invoiceDetailsTmpl",window.invoiceData)),n())},n=function(){var n=jq(".invoice-container .invoice-status"),t;n.length&&n.remove();n=jq("<div><\/div>").addClass("invoice-status").text(window.invoice.status.title);switch(window.invoice.status.id){case 1:n.addClass("draft");break;case 2:t=typeof window.invoice.dueDate=="string"?window.ServiceFactory.serializeDate(window.invoice.dueDate):window.invoice.dueDate;t<new Date?(n.addClass("overdue"),n.text(ASC.CRM.Resources.CRMInvoiceResource.OverdueInvoicesFilter)):n.addClass("sent");break;case 3:n.addClass("rejected");break;case 4:n.addClass("paid");break;default:n.addClass("draft")}jq(".invoice-container").prepend(n)},s=function(){var i=jq.tmpl("invoiceDetailsStylesTmpl",{})[0].outerHTML,r=jq.tmpl("invoiceDetailsTmpl",window.invoiceData)[0].outerHTML,t,n;t=window.open("");n=t.document;n.write(["<html>","<head>",i,"<\/head>","<body>",r,"<script type='text/javascript'>window.onload = function () {this.print();};<\/script>","<\/body>","<\/html>"].join(""));n.close()},h=function(){LoadingBanner.displayLoading();jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active");jq("#invoiceDetailsMenuPanel").hide();t(window.invoice.id,"","",null,l)},c=function(){LoadingBanner.displayLoading();t(window.invoice.id,"","",null,ASC.CRM.Common.createInvoiceMail)},t=function(n,t,i,r,u){var f={invoiceId:n,storageUrl:t,revisionId:i};Teamlab.getInvoiceConverterData(null,f,{success:function(n,t){t.fileId>0?(window.invoice.fileId=t.fileId,LoadingBanner.hideLoading(),u(window.invoice,r)):setTimeout(function(){ASC.CRM.InvoiceDetailsView.checkPdfFile(t.invoiceId,t.storageUrl,t.revisionId,r,u)},2e3)},error:function(n,t){LoadingBanner.hideLoading();console.log(t)}})},a=function(){window.invoice.canEdit?jq("#invoiceDetailsMenuPanel .edit-btn").show():jq("#invoiceDetailsMenuPanel .edit-btn").hide();window.invoice.canDelete?jq("#invoiceDetailsMenuPanel .delete-btn").show():jq("#invoiceDetailsMenuPanel .delete-btn").hide()},v=function(){function t(n,t){var r=jq("<a><\/a>").addClass("dropdown-item").text(t).on("click",function(){i(window.invoice.id,n)}),u=jq("<li><\/li>").addClass("status-btn").append(r);jq("#invoiceDetailsMenuPanel ul.dropdown-content").prepend(u)}function i(t,i){var r=[t],u={ids:r};Teamlab.updateCrmInvoicesStatusBatch(u,i,r,{success:function(t,i){var u,r,f;if(i.invoices!=null&&i.invoices.length!=0&&(window.invoice=i.invoices[0],n()),u=!1,i.invoiceItems!=null&&i.invoiceItems.length!=0)for(r=0,f=i.invoiceItems.length;r<f;r++)if(i.invoiceItems[r].stockQuantity<0){u=!0;break}u&&(jq("#changeInvoiceStatusError").length==0&&jq.tmpl("template-blockUIPanel",{id:"changeInvoiceStatusError",headerTest:ASC.CRM.Resources.CRMInvoiceResource.Warning,questionText:"",innerHtmlText:["<div>",ASC.CRM.Resources.CRMInvoiceResource.InvoiceItemNegativeQuantityErrorText,"<\/div>"].join(""),CancelBtn:ASC.CRM.Resources.CRMCommonResource.Close,progressText:""}).appendTo("body"),PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#changeInvoiceStatusError",500))},before:function(){jq(".mainContainerClass .containerHeaderBlock .menu-small.active").removeClass("active");jq("#invoiceDetailsMenuPanel").hide();LoadingBanner.displayLoading()},after:function(){LoadingBanner.hideLoading()}})}jq("#invoiceDetailsMenuPanel .status-btn").remove();window.invoice.status.id==1&&t(2,ASC.CRM.Resources.CRMInvoiceResource.MarkAsSend);window.invoice.status.id==2&&(t(3,ASC.CRM.Resources.CRMInvoiceResource.MarkAsRejected),t(4,ASC.CRM.Resources.CRMInvoiceResource.MarkAsPaid));window.invoice.status.id==3&&t(1,ASC.CRM.Resources.CRMInvoiceResource.MarkAsDraft);window.invoice.status.id==4&&t(2,ASC.CRM.Resources.CRMInvoiceResource.MarkAsSend)};return{init:function(){i();f();e();o()},checkPdfFile:t}}();
typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}});ASC.CRM.SocialMedia=function(){var n={addAndSaveTwitter:function(n,t){ASC.CRM.SocialMedia.LoadContactActivity();var i=jq("#contactTagsTR");i.length&&($currentPrimaryContainer=jq.tmpl("collectionContainerTmpl",{Type:t.infoTypeName}).insertBefore("#contactTagsTR").children(".collectionItemsTD"),jq.tmpl("collectionTmpl",t).appendTo($currentPrimaryContainer))},getContactTweets:function(n,t){LoadingBanner.hideLoading();t.length!=0?(jq("#tweetsEmptyScreen:not(.display-none)").addClass("display-none"),jq.tmpl("twitterMessageListTmpl",t).appendTo("#divSocialMediaContent")):ASC.CRM.SocialMedia.ShowErrorMessage(ASC.CRM.Resources.CRMCommonResource.NoLoadedMessages)}};return _GetContactSMImagesResponse=function(n){var i=n.length,t;if(i>0){for(t=0;t<i;t++)jq.tmpl("socialMediaAvatarTmpl",n[t]).appendTo("#divImagesHolder"),jq("#linkSaveAvatar").css("display","inline");_FinishGettingContactImages(!0)}else jq("#divImagesHolder").html(['<div class="describe-text">',ASC.CRM.Resources.CRMContactResource.NoPhotoFromSocialMedia,"<\/div>"].join("")),_FinishGettingContactImages(!1)},_FinishGettingContactImages=function(n){ASC.CRM.SocialMedia.ContactImageListLoaded=!0;jq("#divAjaxImageContainerPhotoLoad [id$='_ctrlImgAjaxLoader']").remove();n&&jq("#divLoadPhotoFromSocialMedia").css("height","100px");jq("#divImagesHolder").css("display","block");LoadingBanner.hideLoading();PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI("#divLoadPhotoWindow",520)},_FindTwitterProfilesResponse=function(n,t,i,r){var u="TwitterProfileTmpl";n.parent().is(".emptyScrBttnPnl")&&(u="TwitterProfileTabTmpl");_RenderSMProfiles(r,u);jq("#divSMProfilesWindow .divWait").hide();_CalculateProfilesWindowHeight();ASC.CRM.SocialMedia.TwitterTargetTextbox=jq(n).parent().parent().children("table").find("input");_ShowProfilesWindow()},_CalculateProfilesWindowHeight=function(){var n=jq("#sm_tbl_UserList").outerHeight();return n>200?270:n==0?100:n+65},_CalculateProfilesWindowPosition=function(n,t,i){var u=t==null?0:t,f=i==null?0:i,e=jq("#divSMProfilesWindow"),r=n.offset();elemPosTop=r.top-23+u;elemPosLeft=r.left+n.outerWidth()+3+f;e.css({position:"absolute",top:elemPosTop,left:elemPosLeft})},_RenderSMProfiles=function(n,t){var r=n.length,i;if(r>0)for(i=0;i<r;i++)jq.tmpl(t,n[i]).appendTo("#sm_tbl_UserList");else jq("#divSMProfilesWindow .divNoProfiles").css("display","block")},_AddTwitterProfileToContactResponse=function(n){n.error!=null&&toastr.error("Error");_HideProfilesWindow()},_ShowProfilesWindow=function(){jq("#divSMProfilesWindow").show();var n=_CalculateProfilesWindowHeight();jq("#divSMProfilesWindow").css("height",n);jq("#divSMProfilesWindow").off("mouseenter").on("mouseenter",function(){ASC.CRM.SocialMedia.MouseInProfilesWindow=!0});jq("#divSMProfilesWindow").off("mouseleave").on("mouseleave",function(){ASC.CRM.SocialMedia.MouseInProfilesWindow=!1});jq(document).on("click",_CheckProfilesWindow)},_ShowWaitProfilesWindow=function(n){jq("#divSMProfilesWindow .divWait").show();jq("#divSMProfilesWindow .divHeader span").text(jq.format(ASC.CRM.Resources.CRMJSResource.PossibleSocialMediaAccounts,n));var t=_CalculateProfilesWindowHeight();jq("#divSMProfilesWindow").css("height",t);jq("#divSMProfilesWindow").show()},_CheckProfilesWindow=function(){ASC.CRM.SocialMedia.MouseInProfilesWindow==!1&&_HideProfilesWindow()},_HideProfilesWindow=function(){jq("#divSMProfilesWindow").hide();jq(document).off("click",_CheckProfilesWindow)},{init:function(n){ASC.CRM.SocialMedia.SocialMediaLoaded=!1;ASC.CRM.SocialMedia.ContactImageListLoaded=!1;ASC.CRM.SocialMedia.MouseInProfilesWindow=!1;ASC.CRM.SocialMedia.selectedPersons=[];ASC.CRM.SocialMedia.defaultAvatarSrc=n;ASC.CRM.SocialMedia.socialNetworks=[]},initTab:function(n,t){jq.tmpl("twitterMessageListPanelTmpl").appendTo("#divSocialMediaContent");jq.tmpl("template-emptyScreen",{ID:"tweetsEmptyScreen",ImgSrc:ASC.CRM.Data.EmptyScrImgs.empty_screen_twitter,Header:ASC.CRM.Resources.CRMSocialMediaResource.EmptyContentTwitterAccountsHeader,Describe:ASC.CRM.Resources.CRMSocialMediaResource.EmptyContentTwitterAccountsDescribe,ButtonHTML:t?["<a class='link dotline plus' href='javascript:void(0);'","onclick='ASC.CRM.SocialMedia.FindTwitterProfiles(jq(this),\"",n?"company":"people","\", 1, 9);'>",ASC.CRM.Resources.CRMSocialMediaResource.LinkTwitterAccount,"<\/a>"].join(""):"",CssClass:"display-none"}).appendTo("#divSocialMediaContent")},activate:function(n){ASC.CRM.SocialMedia.SocialMediaLoaded==!1&&(ASC.CRM.SocialMedia.SocialMediaLoaded=!0,n?ASC.CRM.SocialMedia.LoadContactActivity():jq("#tweetsEmptyScreen.display-none").removeClass("display-none"))},switchCheckedPersonsInCompany:function(n){jq("#chbPersonsRelationship input[type='checkbox']").prop("checked",n)},ShowErrorMessage:function(n){jq("#smErrorDescriptionContainer").css("display","block");jq("#smErrorDescription").text(n)},LoadContactActivity:function(){jq("#smErrorDescriptionContainer").css("display","none");jq("#smErrorDescription").text("");LoadingBanner.displayLoading();var i=jq("[id$='_ctrlContactID']").val(),t=jq.cookies.get("sm_msg_count");(t==null||t===undefined||isNaN(t))&&(t=10);Teamlab.getCrmContactTweets({},i,t,{max_request_attempts:1,success:n.getContactTweets,error:function(n,t){var i=t[0],r;LoadingBanner.hideLoading();try{r=JSON.parse(i);i=r.description}catch(u){}i===ASC.CRM.Resources.SocialMediaAccountNotFoundTwitter?jq("#tweetsEmptyScreen.display-none").removeClass("display-none"):ASC.CRM.SocialMedia.ShowErrorMessage(i)}})},GetContactImageList:function(){ASC.CRM.SocialMedia.socialNetworks!=null&&ASC.CRM.SocialMedia.socialNetworks.length!=0?Teamlab.getCrmContactSocialMediaAvatar({},ASC.CRM.SocialMedia.socialNetworks,{max_request_attempts:1,success:function(n,t){_GetContactSMImagesResponse(t)},error:function(){_GetContactSMImagesResponse([])}}):_GetContactSMImagesResponse([])},OpenLoadPhotoWindow:function(){var n=jq(".linkChangePhoto"),t;n&&(!n||n.hasClass("disable"))||(jq("[name='chbSocialNetwork']").prop("checked",!1),t=jq("img.contact_photo").attr("src"),t.indexOf(ASC.CRM.SocialMedia.defaultAvatarSrc+"?")==0?(jq("#divLoadPhotoDefault").addClass("display-none"),jq("#divLoadPhotoFromSocialMedia").css("margin-top","10px")):(jq("#divLoadPhotoDefault").removeClass("display-none"),jq("#divLoadPhotoFromSocialMedia").css("margin-top","-16px")),ASC.CRM.SocialMedia.ContactImageListLoaded==!1?(LoadingBanner.displayLoading(),ASC.CRM.SocialMedia.GetContactImageList()):(PopupKeyUpActionProvider.EnableEsc=!1,StudioBlockUIManager.blockUI("#divLoadPhotoWindow",520)))},SelectUserAvatar:function(n){n.target||(n.target=n.srcElement);var t=jq(n.target).is(":checked");t!=!1&&jq("[name='chbSocialNetwork']").not(jq(n.target)).prop("checked",!1)},UploadUserAvatar:function(n,t,i){var r,f,u;LoadingBanner.displayLoading();jq(".under_logo .linkChangePhoto").addClass("disable");r=jq("[id$='_ctrlContactID']").val();r==""&&(r=0);f=jq("#divImagesHolder").attr("data-uploadOnly")=="true";u={contactId:r,socialNetwork:t,userIdentity:i,uploadOnly:f};jq("#uploadPhotoPath").length==1&&(u.tmpDirName=jq("#uploadPhotoPath").val());Teamlab.updateCrmContactAvatar({},r,u,{success:function(n,t){PopupKeyUpActionProvider.CloseDialog();jq(".under_logo .linkChangePhoto").removeClass("disable");LoadingBanner.hideLoading();var i=new Date;jq("img.contact_photo").attr("src",t.url+"?"+i.getTime());jq("#uploadPhotoPath").length==1&&jq("#uploadPhotoPath").val(t.path)},error:function(){PopupKeyUpActionProvider.CloseDialog();jq(".under_logo .linkChangePhoto").removeClass("disable");LoadingBanner.hideLoading();toastr.error(ASC.CRM.Resources.CRMJSResource.ErrorMessage_SaveImageError)}})},DeleteContactAvatar:function(){var n;LoadingBanner.displayLoading();jq(".under_logo .linkChangePhoto").addClass("disable");n=jq("[id$='_ctrlContactID']").val();n==""&&(n=0);var t=jq.getURLParam("type"),i=jq("#divImagesHolder").attr("data-uploadOnly")=="true",r={contactId:n,uploadOnly:i,contactType:t};Teamlab.removeCrmContactAvatar({},n,r,{success:function(){PopupKeyUpActionProvider.CloseDialog();jq(".under_logo .linkChangePhoto").removeClass("disable");LoadingBanner.hideLoading();var n=new Date;jq("img.contact_photo").attr("src",[ASC.CRM.SocialMedia.defaultAvatarSrc,"?",n.getTime()].join(""));jq("#uploadPhotoPath").length==1&&jq("#uploadPhotoPath").val("")},error:function(){PopupKeyUpActionProvider.CloseDialog();jq(".under_logo .linkChangePhoto").removeClass("disable");LoadingBanner.hideLoading();toastr.error(ASC.CRM.Resources.CRMJSResource.ErrorMessage_SaveImageError)}})},FindTwitterProfiles:function(n,t,i,r){_HideProfilesWindow();jq("#divSMProfilesWindow .divNoProfiles").css("display","none");jq("#sm_tbl_UserList").html("");jq("#divSMProfilesWindow .divSMProfilesWindowBody .errorBox").remove();var u;(jq("#baseInfo_Title").length==1?u=jq("#baseInfo_Title").val().trim():(t=="company"&&(u=jq("[name='baseInfo_companyName']").val()),t=="people"&&(u=jq("[name='baseInfo_firstName']").val()+" "+jq("[name='baseInfo_lastName']").val())),u!==undefined&&u.trim().length!=0)&&(_CalculateProfilesWindowPosition(jq(n),i,r),_ShowWaitProfilesWindow(u),Teamlab.getCrmContactTwitterProfiles({},u,{max_request_attempts:1,success:function(t,u){_FindTwitterProfilesResponse(n,i,r,u)},error:function(n,t){var i=t[0];jq("#divSMProfilesWindow .divWait").hide();jq("#divSMProfilesWindow .divSMProfilesWindowBody").prepend(jq("<div><\/div>").addClass("errorBox").text(i))}}))},AddAndSaveTwitterProfileToContact:function(t,i){var r={data:t,isPrimary:!0,infoType:"Twitter",category:"Work"};Teamlab.addCrmContactTwitter({},i,r,{success:n.addAndSaveTwitter,before:function(){},after:function(){_HideProfilesWindow()}})},AddTwitterProfileToContact:function(n){jq(ASC.CRM.SocialMedia.TwitterTargetTextbox).val(n);_HideProfilesWindow()}}}();
typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}}());ASC.CRM.SmtpSender=function(){var t=function(){ASC.CRM.FileUploader.activateUploader();ASC.CRM.FileUploader.fileIDs.clear()},n=function(){return!jq("#watermarkInfo").length||ASC.Resources.Master.CustomMode?"":jq.format("<div style='color:#787878;font-size:12px;margin-top:10px'>{0}<\/div>",jq.format(ASC.CRM.Resources.CRMJSResource.TeamlabWatermark,jq.format("<a style='color:#787878;font-size:12px;' href='https://www.onlyoffice.com'>{0}<\/a>","ONLYOFFICE.com")))},i=function(){ASC.CRM.FileUploader.OnAllUploadCompleteCallback_function=function(){var i,t,r;jq("#sendEmailPanel").hide();jq("#sendProcessPanel").show();i=ASC.CRM.SmtpSender.selectedItems.map(function(n){return n.id});t=jq("#sendEmailPanel #tbxEmailSubject").val().trim();t==""&&(t=ASC.CRM.Resources.CRMJSResource.NoSubject);r={contactIds:i,subject:t,body:ASC.CRM.SmtpSender.editor.getData()+n(),fileIDs:ASC.CRM.FileUploader.fileIDs,storeInHistory:jq("#storeInHistory").is(":checked")};Teamlab.sendSMTPMailToContacts({},r,{success:function(){ASC.CRM.SmtpSender.checkSendStatus(!0)},error:function(n,t){var i=t[0];i!=null&&toastr.error(i)}})}},r=function(){var n=function(){ASC.CRM.SmtpSender.showSendEmailPanel()},t={toolbar:"CrmEmail"};ckeditorConnector.load(function(){ASC.CRM.SmtpSender.editor=jq("#ckEditor").ckeditor(n,t).editor})},u=function(){return ASC.CRM.SmtpSender.selectedItems.length>ASC.CRM.SmtpSender.emailQuotas?(console.log(jq.format(ASC.CRM.Resources.CRMJSResource.ErrorEmailRecipientsCount,ASC.CRM.SmtpSender.emailQuotas)),!1):ASC.CRM.SmtpSender.selectedItems.length?ASC.CRM.ListContactView.checkSMTPSettings()?!0:(console.log("Empty field in smtp settings."),!1):(console.log("Empty recipient list."),!1)};return{selectedItems:[],emailQuotas:0,editor:null,init:function(n){ASC.CRM.SmtpSender.selectedItems=ASC.CRM.SmtpSender.getItems();ASC.CRM.SmtpSender.emailQuotas=n;u()?(i(),r(),t()):window.location.href="Default.aspx"},showSendEmailPanel:function(){Teamlab.getStatusSMTPMailToContacts({},{success:function(n,t){if(t==null||jQuery.isEmptyObject(t)||t.isCompleted){jq("#sendEmailPanel #emailFromLabel").text(jq.format("{0} ({1})",ASC.CRM.Data.smtpSettings.SenderDisplayName,ASC.CRM.Data.smtpSettings.SenderEmailAddress));jq("#sendEmailPanel #previewEmailFromLabel").text(jq.format("{0} ({1})",ASC.CRM.Data.smtpSettings.SenderDisplayName,ASC.CRM.Data.smtpSettings.SenderEmailAddress));jq("#tbxEmailSubject").val("");jq.browser.mobile?jq("#ckEditor").val(""):ASC.CRM.SmtpSender.editor.setData("");jq("#storeInHistory").prop("checked",!1);jq("#sendButton").text(ASC.CRM.Resources.CRMJSResource.NextPreview).off("click").on("click",function(){ASC.CRM.SmtpSender.showSendEmailPanelPreview()});jq("#backButton a.button.blue.middle").off("click").on("click",function(){ASC.CRM.SmtpSender.showSendEmailPanelCreate()});var i=ASC.CRM.SmtpSender.selectedItems.length,r=i==1?ASC.CRM.Resources.CRMJSResource.AddressGenitiveSingular:ASC.CRM.Resources.CRMJSResource.AddressGenitivePlural;jq("#emailAddresses").html([i,r].join(" "));jq("#previewEmailAddresses").html([i,r].join(" "));jq("#sendEmailPanel").show();jq("#sendEmailPanel #createContent").show();jq("#sendEmailPanel #previewContent").hide();jq("#sendProcessPanel").hide()}else ASC.CRM.SmtpSender.checkSendStatus(!0)},error:function(n,t){var i=t[0];i!=null&&toastr.error(i)}})},showSendEmailPanelCreate:function(){jq("#createContent").show();jq("#previewContent").hide();jq("#sendProcessPanel").hide();jq("#backButton").hide();jq("#sendButton").text(ASC.CRM.Resources.CRMJSResource.NextPreview).off("click").on("click",function(){ASC.CRM.SmtpSender.showSendEmailPanelPreview()})},showSendEmailPanelPreview:function(){var t="",i;if(t=jq.browser.mobile?jq("#ckEditor").val().trim():ASC.CRM.SmtpSender.editor.getData(),t=="")return AddRequiredErrorText(jq("#requiredMessageBody"),ASC.CRM.Resources.CRMJSResource.EmptyLetterBodyContent),ShowRequiredError(jq("#requiredMessageBody"),!0),!1;RemoveRequiredErrorClass(jq("#requiredMessageBody"));jq.browser.mobile&&(t=t.replace(/\n/g,"<br />"));i=jq("#sendEmailPanel #tbxEmailSubject").val().trim();i==""&&(i=ASC.CRM.Resources.CRMJSResource.NoSubject);Teamlab.getPreviewSMTPMailToContacts({},{template:t,contactId:ASC.CRM.SmtpSender.selectedItems[0].id},{before:function(){LoadingBanner.showLoaderBtn("#sendEmailPanel")},after:function(){LoadingBanner.hideLoaderBtn("#sendEmailPanel")},success:function(t,r){jq("#previewSubject").text(i);jq("#previewMessage").html(r+n());var u=ASC.CRM.FileUploader.fileNames();jq("#previewAttachments span").html("");u.length>0?(u.each(function(n){jq("#previewAttachments span").append(this);n!=u.length-1&&jq("#previewAttachments span").append(", ")}),jq("#previewAttachments").show()):jq("#previewAttachments").hide();jq("#sendProcessPanel").hide();jq("#createContent").hide();jq("#previewContent").show();jq("#backButton").show();jq("#sendButton").text(ASC.CRM.Resources.CRMJSResource.Send).off("click").on("click",function(){ASC.CRM.SmtpSender.sendEmail()})},error:function(n,t){var i=t[0];i!=null&&(toastr.error(i),LoadingBanner.hideLoaderBtn("#sendEmailPanel"))}})},sendEmail:function(){var r,t,i,u;AjaxPro.onLoading=function(){};ASC.CRM.FileUploader.getUploadFileCount()>0?ASC.CRM.FileUploader.start():(r=ASC.CRM.SmtpSender.selectedItems.map(function(n){return n.id}),t=jq("#sendEmailPanel #tbxEmailSubject").val().trim(),t==""&&(t=ASC.CRM.Resources.CRMJSResource.NoSubject),i="",i=jq.browser.mobile?jq("#ckEditor").val().trim():ASC.CRM.SmtpSender.editor.getData(),u={contactIds:r,subject:t,body:i+n(),fileIDs:[],storeInHistory:jq("#storeInHistory").is(":checked")},Teamlab.sendSMTPMailToContacts({},u,{success:function(){ASC.CRM.SmtpSender.checkSendStatus(!0)},error:function(n,t){var i=t[0];i!=null&&toastr.error(i)}}))},checkSendStatus:function(n){jq("#sendEmailPanel").hide();jq("#sendProcessPanel").show();jq("#sendProcessPanel #abortButton").show();jq("#sendProcessPanel #okButton").hide();n&&(jq("#sendProcessProgress .progress").css("width","0%"),jq("#sendProcessProgress .percent").text("0%"),jq("#emailsTotalCount").html(""),jq("#emailsAlreadySentCount").html(""),jq("#emailsEstimatedTime").html(""),jq("#emailsErrorsCount").html(""));Teamlab.getStatusSMTPMailToContacts({},{success:function(n,t){if(t==null||jQuery.isEmptyObject(t)){jq("#sendProcessProgress .progress").css("width","100%");jq("#sendProcessProgress .percent").text("100%");jq("#sendProcessPanel #abortButton").hide();jq("#sendProcessPanel #okButton").show();return}ASC.CRM.SmtpSender.displayProgress(t);t.error!=null&&t.error!=""&&ASC.CRM.SmtpSender.buildErrorList(t);t.isCompleted?(jq("#sendProcessPanel #abortButton").hide(),jq("#sendProcessPanel #okButton").show()):setTimeout("ASC.CRM.SmtpSender.checkSendStatus(false)",3e3)},error:function(n,t){var i=t[0];i!=null&&toastr.error(i)}})},buildErrorList:function(n){var t="error";switch(typeof n.error){case"object":t=n.error.Message+"<br/>";break;case"string":t=n.error}jq("#emailsErrorsCount").html(jq("<div><\/div>").addClass("red-text").html(t)).append(jq("<a><\/a>").attr("href","/Management.aspx?type=10").text(ASC.CRM.Resources.CRMJSResource.GoToSettings))},abortMassSend:function(){Teamlab.cancelSMTPMailToContacts({},{success:function(n,t){t==null||jQuery.isEmptyObject(t)||ASC.CRM.SmtpSender.displayProgress(t);jq("#sendProcessPanel #abortButton").hide()},error:function(n,t){var i=t[0];i!=null&&toastr.error(i)}})},displayProgress:function(n){jq("#sendProcessProgress .progress").css("width",n.percentage+"%");jq("#sendProcessProgress .percent").text(n.percentage+"%");jq("#emailsAlreadySentCount").html(n.status.deliveryCount);jq("#emailsEstimatedTime").html(n.status.estimatedTime);jq("#emailsTotalCount").html(n.status.recipientCount);jq("#emailsErrorsCount").html("0")},emailInsertTag:function(){var r=jq("#emailTagTypeSelector option:selected").val()=="company",n=r?jq("#emailCompanyTagSelector option:selected").val():jq("#emailPersonTagSelector option:selected").val();if(jq.browser.mobile){var t=jq("#ckEditor").caret().start,i=jq("#ckEditor").val(),u=i.slice(0,t)+n+i.slice(t);jq("#ckEditor").val(u)}else ASC.CRM.SmtpSender.editor.insertHtml(n)},renderTagSelector:function(){var n=jq("#emailTagTypeSelector option:selected").val()=="company";n?(jq("#emailPersonTagSelector").hide(),jq("#emailCompanyTagSelector").show()):(jq("#emailCompanyTagSelector").hide(),jq("#emailPersonTagSelector").show())},setItems:function(n){localStorageManager.setItem("senderTargets",n)},getItems:function(){var n=localStorageManager.getItem("senderTargets")||[];return localStorageManager.removeItem("senderTargets"),n}}}();
typeof ASC=="undefined"&&(ASC={});typeof ASC.CRM=="undefined"&&(ASC.CRM=function(){return{}}());ASC.CRM.Reports=function(){function t(){var n=jq(this),t=Number(n.val());t<=0?n.val("1.00"):n.val(t.toFixed(2))}function i(){var n=[];jq("#currencyRatesDialog .currency-rate-item").each(function(t,i){var r=jq(i);n.push({fromCurrency:r.find("span:first-child").text().trim(),rate:r.find("input").val().trim(),toCurrency:window.defaultCurrency})});Teamlab.addCrmCurrencyRates(null,n,{before:function(){jq("#currencyRatesDialog .button").addClass("disable");LoadingBanner.displayLoading()},after:function(){jq("#currencyRatesDialog .button").removeClass("disable");LoadingBanner.hideLoading()},success:function(n,t){jq.unblockUI();window.currencyRates=t;toastr.success(ASC.CRM.Resources.CRMJSResource.SettingsUpdated);jq("#generateBtn_Reports").trigger("click")},error:function(n,t){console.log(t);toastr.error(t[0])}})}function r(n){if(jq("#currencyRatesDialog").length)jq("#currencyRatesDialog .content").empty();else{jq.tmpl("template-blockUIPanel",{id:"currencyRatesDialog",headerTest:ASC.CRM.Resources.CRMReportResource.CurrencySettingsDialogHdr,questionText:"",innerHtmlText:ASC.CRM.Resources.CRMReportResource.CurrencySettingsDialogBody+"<br/><div class='content'><\/div>",OKBtn:ASC.CRM.Resources.CRMCommonResource.Save,OKBtnClass:"saveButton",CancelBtn:ASC.CRM.Resources.CRMCommonResource.Cancel}).insertAfter(".reports-content-container");jq("#currencyRatesDialog").on("click",".saveButton",i);jq("#currencyRatesDialog").on("change",".textEdit",t)}var r=[];jq(n).each(function(n,t){r.push({fromCurrency:t,rate:"1.00",toCurrency:window.defaultCurrency})});jq.tmpl("currencyRateItemTmpl",r).appendTo("#currencyRatesDialog .content");jq("#currencyRatesDialog .content .crm-deleteLink").remove();jq(r).each(function(n,t){jq.forceNumber({parent:"#currencyRatesDialog",input:"#currencyRate_"+t.fromCurrency,integerOnly:!1,positiveOnly:!0})})}function u(t){n(!1);r(t);StudioBlockUIManager.blockUI("#currencyRatesDialog",400)}function f(){window.Attachments.init();window.Attachments.bind("deleteFile",function(n,t){Teamlab.removeCrmReportFile({fileId:t},t,{success:function(n){window.Attachments.deleteFileFromLayout(n.fileId)}})});window.Attachments.loadFiles()}function e(t){n(!0);var i={type:t,timePeriod:jq("#timePeriod_Reports").val(),managers:window.SelectedUsers_Reports.IDs};Teamlab.checkCrmReport(i,{success:function(t,r){r&&r.hasData?r.missingRates&&r.missingRates.length?(ProgressDialog.close(),u(r.missingRates)):ProgressDialog.generate(i):(n(!1),toastr.warning(ASC.CRM.Resources.CRMReportResource.NoData))}})}function n(n){n?LoadingBanner.showLoaderBtn(".reports-content-container"):LoadingBanner.hideLoaderBtn(".reports-content-container")}function o(n,t){jq("#menuCreateNewTask").on("click",function(){ASC.CRM.TaskActionView.showTaskPanel(0,"",0,null,{})});if(ProgressDialog.init({header:ASC.CRM.Resources.CRMReportResource.ReportBuilding,footer:ASC.CRM.Resources.CRMReportResource.ReportBuildingInfo.format("<a class='link underline' href='Reports.aspx'>","<\/a>"),progress:ASC.CRM.Resources.CRMReportResource.ReportBuildingProgress},jq("#studioPageContent .mainPageContent .containerBodyBlock:first"),{terminate:Teamlab.terminateCrmReport,status:Teamlab.getCrmReportStatus,generate:Teamlab.generateCrmReport}),t){f();return}if(jq("#generateBtn_Reports").length){jq("#generateBtn_Reports").on("click",function(){jq(this).hasClass("disable")||e(n)});jq("#timePeriod_Reports").tlCombobox({align:"left"});jq("#timePeriod_Reports").prev().find(".combobox-options").css("max-height","none");ASC.CRM.UserSelectorListView.Init("_Reports","UserSelector_Reports",!1,"",[],null,[],"#userSelectorContainer_Reports",!1);jq("#selectedUsers_Reports").attr("style","")}}function s(n,t){window.currencyRates=JSON.parse(window.currencyRates);o(n,t);jq(".reports-menu-container, .reports-content-container").removeClass("display-none");jq(".loader-page").hide()}return{init:s}}();
(function(){function h(t){return typeof t=="string"&&(t=n.getElementById(t)),t}function t(n,t,r){if(i.addEventListener)n&&n.addEventListener(t,r,!1);else if(i.attachEvent){var u=function(){r.call(n,i.event)};n&&n.attachEvent("on"+t,u)}}function c(n,t){return n.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function l(n,t){c(n,t)||(n.className+=" "+t)}function f(n,t){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");n.className=n.className.replace(i," ")}function a(n){var t,u,i,f,e=r(n);return t=e.left,i=e.top,u=t+n.offsetWidth,f=i+n.offsetHeight,{left:t,right:u,top:i,bottom:f}}function v(t){var i,r,u;return!t.pageX&&t.clientX?(i=1,r=document.body,r.getBoundingClientRect&&(u=r.getBoundingClientRect(),i=(u.right-u.left)/r.clientWidth),{x:t.clientX/i+n.body.scrollLeft+n.documentElement.scrollLeft,y:t.clientY/i+n.body.scrollTop+n.documentElement.scrollTop}):{x:t.pageX,y:t.pageY}}function o(n){return n.replace(/.*(\/|\\)/,"")}function s(n){return/[.]/.exec(n)?/[^.]+$/.exec(n.toLowerCase()):""}var n=document,i=window,u=function(){var t=n.createElement("div");return function(n){t.innerHTML=n;var i=t.childNodes[0];return t.removeChild(i),i}}(),r,e;r=document.documentElement.getBoundingClientRect?function(n){var f=n.getBoundingClientRect(),e=n.ownerDocument,i=e.body,r=e.documentElement,o=r.clientTop||i.clientTop||0,s=r.clientLeft||i.clientLeft||0,t=1,u,h,c;return i.getBoundingClientRect&&(u=i.getBoundingClientRect(),t=(u.right-u.left)/i.clientWidth),t>1&&(o=0,s=0),h=f.top/t+(window.pageYOffset||r&&r.scrollTop/t||i.scrollTop/t)-o,c=f.left/t+(window.pageXOffset||r&&r.scrollLeft/t||i.scrollLeft/t)-s,{top:h,left:c}}:function(n){if(i.jQuery)return jQuery(n).offset();var t=0,r=0;do t+=n.offsetTop||0,r+=n.offsetLeft||0;while(n=n.offsetParent);return{left:r,top:t}};e=function(){var n=0;return function(){return"ValumsAjaxUpload"+n++}}();Ajax_upload=AjaxUpload=function(t,i){var r,u;t.jquery?t=t[0]:typeof t=="string"&&/^#.*/.test(t)&&(t=t.slice(1));t=h(t);this._input=null;this._button=t;this._disabled=!1;this._submitting=!1;this._justClicked=!1;this._parentDialog=n.body;this._isInPopup=!1;window.jQuery&&jQuery.ui&&jQuery.ui.dialog&&(r=jQuery(this._button).parents(".ui-dialog"),r.length&&(this._parentDialog=r[0]));this._settings={action:"upload.php",name:"userfile",id:null,title:"",data:{},autoSubmit:!0,responseType:!1,onChange:function(){},onSubmit:function(){},onComplete:function(){}};for(u in i)this._settings[u]=i[u];this._settings.parentDialog&&(this._parentDialog=this._settings.parentDialog);this._settings.isInPopup&&(this._isInPopup=this._settings.isInPopup);this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(n){this._settings.data=n},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},destroy:function(){this._input&&(this._input.parentNode&&this._input.parentNode.removeChild(this._input),this._input=null)},_createInput:function(){var r=this,i=n.createElement("input"),u,f;i.setAttribute("type","file");i.setAttribute("name",this._settings.name);i.setAttribute("class","fileuploadinput"+(this._settings.name==="userfile"?"":this._settings.name));i.setAttribute("title",this._settings.title);this._settings.accept&&i.setAttribute("accept",this._settings.accept);u={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583};for(f in u)i.style[f]=u[f];i.style.opacity==="0"||(i.style.filter="alpha(opacity=0)");this._parentDialog.appendChild?this._parentDialog.appendChild(i):this._parentDialog.append(i);t(i,"change",function(){r.justClicked=!1;var n=o(this.value);r._settings.onChange.call(r,n,s(n))!=!1&&r._settings.autoSubmit&&r.submit()});/safari/i.test(navigator.userAgent)&&!window.chrome&&t(i,"click",function(){r.justClicked=!0;setTimeout(function(){r.justClicked=!1},3e3)});this._input=i},_rerouteClicks:function(){var i=this,u,e={top:0,left:0},o=!1;t(i._button,"mouseover",function(){i._input&&!o&&(o=!0,u=a(i._button),i._parentDialog!=n.body&&(i._isInPopup?(e.top=jq(i._button).offset().top-jq(i._button).position().top,e.left=jq(i._button).offset().left-jq(i._button).position().left):e=r(i._parentDialog)))});t(document,"mousemove",function(n){var t=i._input,r;if(!t||!o){!t||o||t.style.display=="none"||i.justClicked||(t.style.display="none");return}if(i._disabled){f(i._button,"hover");t.style.display="none";return}r=v(n);r.x>=u.left&&r.x<=u.right&&r.y>=u.top&&r.y<=u.bottom?(t.style.top=r.y-e.top+"px",t.style.left=r.x-e.left+"px",t.style.display="block",l(i._button,"hover")):(o=!1,i.justClicked||(t.style.display="none"),f(i._button,"hover"))})},_createIframe:function(){var i=e(),t=u('<iframe src="javascript:false;" name="'+i+'" />');return t.id=i,t.style.display="none",n.body.appendChild(t),t},submit:function(){var h=this,u=this._settings,f,i,r,e;this._input.value!==""&&(f=o(this._input.value),u.onSubmit.call(this,f,s(f))==!1?(n.body.removeChild(this._input),this._input=null,this._createInput()):(i=this._createIframe(),r=this._createForm(i),r.appendChild(this._input),r.submit(),n.body.removeChild(r),r=null,this._input=null,this._createInput(),e=!1,t(i,"load",function(){var t,r;if(i.src=="javascript:'%3Chtml%3E%3C/html%3E';"||i.src=="javascript:'<html><\/html>';"){e&&setTimeout(function(){n.body.removeChild(i)},0);return}(t=i.contentDocument?i.contentDocument:frames[i.id].document,t.readyState&&t.readyState!="complete")||t.body&&t.body.innerHTML=="false"||t.body&&t.body.innerHTML==""||(t.XMLDocument?r=t.XMLDocument:t.body?(r=t.body.innerHTML,u.responseType&&u.responseType.toLowerCase()=="json"&&(t.body.firstChild&&t.body.firstChild.nodeName.toUpperCase()=="PRE"&&(r=t.body.firstChild.firstChild.nodeValue),r=r?window.eval("("+r+")"):{})):r=t,u.onComplete.call(h,f,r),e=!0,i.src="javascript:'<html><\/html>';")})))},_createForm:function(t){var f=this._settings,i=u('<form method="post" enctype="multipart/form-data"><\/form>'),e,r;i.style.display="none";i.action=f.action;i.target=t.name;n.body.appendChild(i);for(e in f.data)r=n.createElement("input"),r.type="hidden",r.name=e,r.value=f.data[e],i.appendChild(r);return i}}})();
/*!
	Autosize 3.0.17
	license: MIT
	http://www.jacklmoore.com/autosize
*/
!function(n,t){if("function"==typeof define&&define.amd)define(["exports","module"],t);else if("undefined"!=typeof exports&&"undefined"!=typeof module)t(exports,module);else{var i={exports:{}};t(i.exports,i);n.autosize=i.exports}}(this,function(n,t){"use strict";function f(n){function l(){var r=window.getComputedStyle(n,null);"vertical"===r.resize?n.style.resize="none":"both"===r.resize&&(n.style.resize="horizontal");i="content-box"===r.boxSizing?-(parseFloat(r.paddingTop)+parseFloat(r.paddingBottom)):parseFloat(r.borderTopWidth)+parseFloat(r.borderBottomWidth);isNaN(i)&&(i=0);t()}function f(t){var i=n.style.width;n.style.width="0px";n.offsetWidth;n.style.width=i;n.style.overflowY=t;e()}function a(n){for(var t=[];n&&n.parentNode&&n.parentNode instanceof Element;)n.parentNode.scrollTop&&t.push({node:n.parentNode,scrollTop:n.parentNode.scrollTop}),n=n.parentNode;return t}function e(){var u=n.style.height,f=a(n),t=document.documentElement&&document.documentElement.scrollTop,r;return n.style.height="auto",r=n.scrollHeight+i,0===n.scrollHeight?void(n.style.height=u):(n.style.height=r+"px",o=n.clientWidth,f.forEach(function(n){n.node.scrollTop=n.scrollTop}),void(t&&(document.documentElement.scrollTop=t)))}function t(){var u;e();var t=window.getComputedStyle(n,null),i=Math.round(parseFloat(t.height)),o=Math.round(parseFloat(n.style.height));(i!==o?"visible"!==t.overflowY&&f("visible"):"hidden"!==t.overflowY&&f("hidden"),s!==i)&&(s=i,u=r("autosize:resized"),n.dispatchEvent(u))}if(n&&n.nodeName&&"TEXTAREA"===n.nodeName&&!u.has(n)){var i=null,o=n.clientWidth,s=null,h=function(){n.clientWidth!==o&&t()},c=function(i){window.removeEventListener("resize",h,!1);n.removeEventListener("input",t,!1);n.removeEventListener("keyup",t,!1);n.removeEventListener("autosize:destroy",c,!1);n.removeEventListener("autosize:update",t,!1);u["delete"](n);Object.keys(i).forEach(function(t){n.style[t]=i[t]})}.bind(n,{height:n.style.height,resize:n.style.resize,overflowY:n.style.overflowY,overflowX:n.style.overflowX,wordWrap:n.style.wordWrap});n.addEventListener("autosize:destroy",c,!1);"onpropertychange"in n&&"oninput"in n&&n.addEventListener("keyup",t,!1);window.addEventListener("resize",h,!1);n.addEventListener("input",t,!1);n.addEventListener("autosize:update",t,!1);u.add(n);n.style.overflowX="hidden";n.style.wordWrap="break-word";l()}}function e(n){if(n&&n.nodeName&&"TEXTAREA"===n.nodeName){var t=r("autosize:destroy");n.dispatchEvent(t)}}function o(n){if(n&&n.nodeName&&"TEXTAREA"===n.nodeName){var t=r("autosize:update");n.dispatchEvent(t)}}var u="function"==typeof Set?new Set:function(){var n=[];return{has:function(t){return Boolean(n.indexOf(t)>-1)},add:function(t){n.push(t)},"delete":function(t){n.splice(n.indexOf(t),1)}}}(),r=function(n){return new Event(n)},i;try{new Event("test")}catch(s){r=function(n){var t=document.createEvent("Event");return t.initEvent(n,!0,!1),t}}i=null;"undefined"==typeof window||"function"!=typeof getComputedStyle?(i=function(n){return n},i.destroy=function(n){return n},i.update=function(n){return n}):(i=function(n,t){return n&&Array.prototype.forEach.call(n.length?n:[n],function(n){return f(n,t)}),n},i.destroy=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],e),n},i.update=function(n){return n&&Array.prototype.forEach.call(n.length?n:[n],o),n});t.exports=i});
ProgressDialog=function(){function w(i,r,u,o){if(!jq("#progressDialog").length){f=LoadingBanner;e=r;n=i;t=u;o&&o===1?r.append(jq.tmpl("progressBarTmpl",{header:n.header||"",percentage:n.percentage||0})):r.append(jq.tmpl("progressDialogTmpl",{header:n.header||"",footer:n.footer||""}));jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#progressDialog .actions-container.close").off("click").on("click",it);jq("#progressDialog").off("click").on("click",".progress-error",b);t!==null&&y()}}function b(){var n=jq(this).closest(".pd-row").index()+1;jq(this).helper({BlockHelperID:"progressDialogBodyTable tr:nth-child("+n+") .popup_helper",position:"fixed"})}function h(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%");n.next().text(t+"%")}function k(n,t){h("#progressDialog progress",n);jq("#progressDialog").find("#progressDialogHeader").text(t)}function c(){jq("#progressDialog").show()}function r(){clearTimeout(s);jq("#progressDialog").hide();jq("#progressDialogBodyTable tbody").empty()}function l(n){jq("#progressDialogHeader").text(n)}function d(n,t){function i(n){var t=new RegExp('[\t*+:"<>?|\\\\/]',"gim");return(n||"").trim().replace(t,"_")}jq("#"+t.id).length||(t.fileName=i(t.fileName),t.fileTypeCssClass=ASC.Files.Utility.getCssClassByFileTitle(t.fileName,!0),jq("#progressDialogBodyTable tbody").append(jq.tmpl(n,t)),jq("#progressDialogBodyTable").parent().scrollTo("#"+t.id))}function a(n,t){h("#"+n+" progress",t)}function g(n){jq("#"+n).removeClass("done").removeClass("error").addClass("started")}function nt(n,t){jq("#"+n).removeClass("started").removeClass("done").addClass("error").removeAttr("id").find(".popup_helper").text(t)}function tt(n,t){jq("#"+n).removeClass("started").removeClass("error").addClass("done").removeAttr("id").find(".linkMedium").attr("href",t)}function it(){if(t===null)return r();t.terminate?t.terminate({success:function(){u();r()},error:o}):r()}function rt(n){p();t.generate(n,{success:v,error:o})}function v(t,r){if(!r||typeof r.id=="undefined"||jq.isEmptyObject(r)){u();return}d("progressDialogRowTmpl",r);c();switch(r.status){case i.Queued:case i.Started:var f=typeof r.percentage!="undefined"?Math.round(r.percentage):r.status===i.Queued?10:60;l(f>0?n.progress.format(f):n.header);a(r.id,f);g(r.id);s=setTimeout(y,1600);break;case i.Done:case i.Failed:u();l(n.header);a(r.id,100);r.exception?(nt(r.id,r.exception),toastr.error(r.exception)):tt(r.id,r.fileUrl?r.fileUrl:ASC.Files.Utility.GetFileWebEditorUrl(r.fileId))}}function y(){p();t.status({success:v,error:o})}function o(n,t){u();toastr.error(t[0])}function p(){f.showLoaderBtn(e)}function u(){f.hideLoaderBtn(e)}var i={Queued:0,Started:1,Done:2,Failed:3},f,e,s,n,t;return{init:w,show:c,close:r,generate:rt,setProgress:k}}();

