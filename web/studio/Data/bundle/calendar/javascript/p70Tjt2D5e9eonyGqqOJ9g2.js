/*!
 * Socket.IO v2.2.0
 * (c) 2014-2018 Guillermo Rauch
 * Released under the MIT License.
 */
!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.io=t():n.io=t()}(this,function(){return function(n){function t(r){if(i[r])return i[r].exports;var u=i[r]={exports:{},id:r,loaded:!1};return n[r].call(u.exports,u,u.exports,t),u.loaded=!0,u.exports}var i={};return t.m=n,t.c=i,t.p="",t(0)}([function(n,t,i){"use strict";function u(n,t){"object"===("undefined"==typeof n?"undefined":o(n))&&(t=n,n=void 0);t=t||{};var c,i=s(n),h=i.source,u=i.id,l=i.path,a=r[u]&&l in r[u].nsps,v=t.forceNew||t["force new connection"]||!1===t.multiplex||a;return v?(e("ignoring socket cache for %s",h),c=f(h,t)):(r[u]||(e("new io instance for %s",h),r[u]=f(h,t)),c=r[u]),i.query&&!t.query&&(t.query=i.query),c.socket(i.path,t)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},s=i(1),h=i(7),f=i(12),e=i(3)("socket.io-client"),r;n.exports=t=u;r=t.managers={};t.protocol=h.protocol;t.connect=u;t.Manager=i(12);t.Socket=i(36)},function(n,t,i){"use strict";function u(n,t){var i=n,e,u;return t=t||"undefined"!=typeof location&&location,null==n&&(n=t.protocol+"//"+t.host),"string"==typeof n&&("/"===n.charAt(0)&&(n="/"===n.charAt(1)?t.protocol+n:t.host+n),/^(https?|wss?):\/\//.test(n)||(r("protocol-less url %s",n),n="undefined"!=typeof t?t.protocol+"//"+n:"https://"+n),r("parse %s",n),i=f(n)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/",e=i.host.indexOf(":")!==-1,u=e?"["+i.host+"]":i.host,i.id=i.protocol+"://"+u+":"+i.port,i.href=i.protocol+"://"+u+(t&&t.port===i.port?"":":"+i.port),i}var f=i(2),r=i(3)("socket.io-client:url");n.exports=u},function(n){var t=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.exports=function(n){var o=n,u=n.indexOf("["),f=n.indexOf("]");u!=-1&&f!=-1&&(n=n.substring(0,u)+n.substring(u,f).replace(/:/g,";")+n.substring(f,n.length));for(var s=t.exec(n||""),r={},e=14;e--;)r[i[e]]=s[e]||"";return u!=-1&&f!=-1&&(r.source=o,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r}},function(n,t,i){(function(r){function f(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function e(n){var i=this.useColors,r,u,f;(n[0]=(i?"%c":"")+this.namespace+(i?" %c":" ")+n[0]+(i?"%c ":" ")+"+"+t.humanize(this.diff),i)&&(r="color: "+this.color,n.splice(1,0,r,"color: inherit"),u=0,f=0,n[0].replace(/%[a-zA-Z%]/g,function(n){"%%"!==n&&(u++,"%c"===n&&(f=u))}),n.splice(f,0,r))}function o(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(n){try{null==n?t.storage.removeItem("debug"):t.storage.debug=n}catch(i){}}function u(){var n;try{n=t.storage.debug}catch(i){}return!n&&"undefined"!=typeof r&&"env"in r&&(n=r.env.DEBUG),n}function h(){try{return window.localStorage}catch(n){}}t=n.exports=i(5);t.log=o;t.formatArgs=e;t.save=s;t.load=u;t.useColors=f;t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:h();t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];t.formatters.j=function(n){try{return JSON.stringify(n)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}};t.enable(u())}).call(t,i(4))},function(n){function h(){throw new Error("setTimeout has not been defined");}function c(){throw new Error("clearTimeout has not been defined");}function l(n){if(r===setTimeout)return setTimeout(n,0);if((r===h||!r)&&setTimeout)return r=setTimeout,setTimeout(n,0);try{return r(n,0)}catch(t){try{return r.call(null,n,0)}catch(t){return r.call(this,n,0)}}}function y(n){if(u===clearTimeout)return clearTimeout(n);if((u===c||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(n);try{return u(n)}catch(t){try{return u.call(null,n)}catch(t){return u.call(this,n)}}}function p(){o&&e&&(o=!1,e.length?f=e.concat(f):s=-1,f.length&&a())}function a(){var t,n;if(!o){for(t=l(p),o=!0,n=f.length;n;){for(e=f,f=[];++s<n;)e&&e[s].run();s=-1;n=f.length}e=null;o=!1;y(t)}}function v(n,t){this.fun=n;this.array=t}function i(){}var r,u,t=n.exports={};!function(){try{r="function"==typeof setTimeout?setTimeout:h}catch(n){r=h}try{u="function"==typeof clearTimeout?clearTimeout:c}catch(n){u=c}}();var e,f=[],o=!1,s=-1;t.nextTick=function(n){var i=new Array(arguments.length-1),t;if(arguments.length>1)for(t=1;t<arguments.length;t++)i[t-1]=arguments[t];f.push(new v(n,i));1!==f.length||o||l(a)};v.prototype.run=function(){this.fun.apply(null,this.array)};t.title="browser";t.browser=!0;t.env={};t.argv=[];t.version="";t.versions={};t.on=i;t.addListener=i;t.once=i;t.off=i;t.removeListener=i;t.removeAllListeners=i;t.emit=i;t.prependListener=i;t.prependOnceListener=i;t.listeners=function(){return[]};t.binding=function(){throw new Error("process.binding is not supported");};t.cwd=function(){return"/"};t.chdir=function(){throw new Error("process.chdir is not supported");};t.umask=function(){return 0}},function(n,t,i){function u(n){var r,i=0;for(r in n)i=(i<<5)-i+n.charCodeAt(r),i|=0;return t.colors[Math.abs(i)%t.colors.length]}function r(n){function i(){var n,f,e,s;if(i.enabled){var u=i,o=+new Date,h=o-(r||o);for(u.diff=h,u.prev=r,u.curr=o,r=o,n=new Array(arguments.length),f=0;f<n.length;f++)n[f]=arguments[f];n[0]=t.coerce(n[0]);"string"!=typeof n[0]&&n.unshift("%O");e=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,function(i,r){var f,o;return"%%"===i?i:(e++,f=t.formatters[r],"function"==typeof f&&(o=n[e],i=f.call(u,o),n.splice(e,1),e--),i)});t.formatArgs.call(u,n);s=i.log||t.log||console.log.bind(console);s.apply(u,n)}}var r;return i.namespace=n,i.enabled=t.enabled(n),i.useColors=t.useColors(),i.color=u(n),i.destroy=f,"function"==typeof t.init&&t.init(i),t.instances.push(i),i}function f(){var n=t.instances.indexOf(this);return n!==-1&&(t.instances.splice(n,1),!0)}function e(n){var i,r,f,u;for(t.save(n),t.names=[],t.skips=[],r=("string"==typeof n?n:"").split(/[\s,]+/),f=r.length,i=0;i<f;i++)r[i]&&(n=r[i].replace(/\*/g,".*?"),"-"===n[0]?t.skips.push(new RegExp("^"+n.substr(1)+"$")):t.names.push(new RegExp("^"+n+"$")));for(i=0;i<t.instances.length;i++)u=t.instances[i],u.enabled=t.enabled(u.namespace)}function o(){t.enable("")}function s(n){if("*"===n[n.length-1])return!0;for(var i=0,r=t.skips.length;i<r;i++)if(t.skips[i].test(n))return!1;for(i=0,r=t.names.length;i<r;i++)if(t.names[i].test(n))return!0;return!1}function h(n){return n instanceof Error?n.stack||n.message:n}t=n.exports=r.debug=r["default"]=r;t.coerce=h;t.disable=o;t.enable=e;t.enabled=s;t.humanize=i(6);t.instances=[];t.names=[];t.skips=[];t.formatters={}},function(n){function e(n){var e,f,o;if((n=String(n),!(n.length>100))&&(e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(n),e)){f=parseFloat(e[1]);o=(e[2]||"ms").toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return f*h;case"days":case"day":case"d":return f*u;case"hours":case"hour":case"hrs":case"hr":case"h":return f*r;case"minutes":case"minute":case"mins":case"min":case"m":return f*i;case"seconds":case"second":case"secs":case"sec":case"s":return f*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}function o(n){return n>=u?Math.round(n/u)+"d":n>=r?Math.round(n/r)+"h":n>=i?Math.round(n/i)+"m":n>=t?Math.round(n/t)+"s":n+"ms"}function s(n){return f(n,u,"day")||f(n,r,"hour")||f(n,i,"minute")||f(n,t,"second")||n+" ms"}function f(n,t,i){if(!(n<t))return n<1.5*t?Math.floor(n/t)+" "+i:Math.ceil(n/t)+" "+i+"s"}var t=1e3,i=60*t,r=60*i,u=24*r,h=365.25*u;n.exports=function(n,t){t=t||{};var i=typeof n;if("string"===i&&n.length>0)return e(n);if("number"===i&&isNaN(n)===!1)return t.long?s(n):o(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n));}},function(n,t,i){function o(){}function s(n){var i=""+n.type,r;if(t.BINARY_EVENT!==n.type&&t.BINARY_ACK!==n.type||(i+=n.attachments+"-"),n.nsp&&"/"!==n.nsp&&(i+=n.nsp+","),null!=n.id&&(i+=n.id),null!=n.data){if(r=l(n.data),r===!1)return c;i+=r}return f("encoded %j as %s",n,i),i}function l(n){try{return JSON.stringify(n)}catch(t){return!1}}function a(n,t){function i(n){var i=e.deconstructPacket(n),u=s(i.packet),r=i.buffers;r.unshift(u);t(r)}e.removeBlobs(n,i)}function r(){this.reconstructor=null}function v(n){var i=0,r={type:Number(n.charAt(0))},e,o,u,s,c;if(null==t.types[r.type])return h("unknown packet type "+r.type);if(t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type){for(e="";"-"!==n.charAt(++i)&&(e+=n.charAt(i),i!=n.length););if(e!=Number(e)||"-"!==n.charAt(i))throw new Error("Illegal attachments");r.attachments=Number(e)}if("/"===n.charAt(i+1))for(r.nsp="";++i;){if(u=n.charAt(i),","===u)break;if(r.nsp+=u,i===n.length)break}else r.nsp="/";if(o=n.charAt(i+1),""!==o&&Number(o)==o){for(r.id="";++i;){if(u=n.charAt(i),null==u||Number(u)!=u){--i;break}if(r.id+=n.charAt(i),i===n.length)break}r.id=Number(r.id)}if(n.charAt(++i)){if(s=y(n.substr(i)),c=s!==!1&&(r.type===t.ERROR||w(s)),!c)return h("invalid payload");r.data=s}return f("decoded %s as %j",n,r),r}function y(n){try{return JSON.parse(n)}catch(t){return!1}}function u(n){this.reconPack=n;this.buffers=[]}function h(n){return{type:t.ERROR,data:"parser error: "+n}}var f=i(3)("socket.io-parser"),p=i(8),e=i(9),w=i(10),b=i(11),c;t.protocol=4;t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"];t.CONNECT=0;t.DISCONNECT=1;t.EVENT=2;t.ACK=3;t.ERROR=4;t.BINARY_EVENT=5;t.BINARY_ACK=6;t.Encoder=o;t.Decoder=r;c=t.ERROR+'"encode error"';o.prototype.encode=function(n,i){if(f("encoding packet %j",n),t.BINARY_EVENT===n.type||t.BINARY_ACK===n.type)a(n,i);else{var r=s(n);i([r])}};p(r.prototype);r.prototype.add=function(n){var i;if("string"==typeof n)i=v(n),t.BINARY_EVENT===i.type||t.BINARY_ACK===i.type?(this.reconstructor=new u(i),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",i)):this.emit("decoded",i);else{if(!b(n)&&!n.base64)throw new Error("Unknown type: "+n);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");i=this.reconstructor.takeBinaryData(n);i&&(this.reconstructor=null,this.emit("decoded",i))}};r.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()};u.prototype.takeBinaryData=function(n){if(this.buffers.push(n),this.buffers.length===this.reconPack.attachments){var t=e.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null};u.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]}},function(n){function t(n){if(n)return i(n)}function i(n){for(var i in t.prototype)n[i]=t.prototype[i];return n}n.exports=t;t.prototype.on=t.prototype.addEventListener=function(n,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(t),this};t.prototype.once=function(n,t){function i(){this.off(n,i);t.apply(this,arguments)}return i.fn=t,this.on(n,i),this};t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(n,t){var i,u,r;if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;if(i=this._callbacks["$"+n],!i)return this;if(1==arguments.length)return delete this._callbacks["$"+n],this;for(r=0;r<i.length;r++)if(u=i[r],u===t||u.fn===t){i.splice(r,1);break}return this};t.prototype.emit=function(n){var r,t,i,u;if(this._callbacks=this._callbacks||{},r=[].slice.call(arguments,1),t=this._callbacks["$"+n],t)for(t=t.slice(0),i=0,u=t.length;i<u;++i)t[i].apply(this,r);return this};t.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};t.prototype.hasListeners=function(n){return!!this.listeners(n).length}},function(n,t,i){function r(n,t){var s,u,i,o;if(!n)return n;if(e(n))return s={_placeholder:!0,num:t.length},t.push(n),s;if(f(n)){for(i=new Array(n.length),u=0;u<n.length;u++)i[u]=r(n[u],t);return i}if("object"==typeof n&&!(n instanceof Date)){i={};for(o in n)i[o]=r(n[o],t);return i}return n}function u(n,t){var i,r;if(!n)return n;if(n&&n._placeholder)return t[n.num];if(f(n))for(i=0;i<n.length;i++)n[i]=u(n[i],t);else if("object"==typeof n)for(r in n)n[r]=u(n[r],t);return n}var f=i(10),e=i(11),o=Object.prototype.toString,s="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===o.call(Blob),h="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===o.call(File);t.deconstructPacket=function(n){var t=[],u=n.data,i=n;return i.data=r(u,t),i.attachments=t.length,{packet:i,buffers:t}};t.reconstructPacket=function(n,t){return n.data=u(n.data,t),n.attachments=void 0,n};t.removeBlobs=function(n,t){function r(n,o,c){var a,l,v;if(!n)return n;if(s&&n instanceof Blob||h&&n instanceof File)u++,a=new FileReader,a.onload=function(){c?c[o]=this.result:i=this.result;--u||t(i)},a.readAsArrayBuffer(n);else if(f(n))for(l=0;l<n.length;l++)r(n[l],l,n);else if("object"==typeof n&&!e(n))for(v in n)r(n[v],v,n)}var u=0,i=n;r(i);u||t(i)}},function(n){var t={}.toString;n.exports=Array.isArray||function(n){return"[object Array]"==t.call(n)}},function(n){function t(n){return i&&Buffer.isBuffer(n)||r&&(n instanceof ArrayBuffer||u(n))}n.exports=t;var i="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,r="function"==typeof ArrayBuffer,u=function(n){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer}},function(n,t,i){"use strict";function r(n,t){if(!(this instanceof r))return new r(n,t);n&&"object"===("undefined"==typeof n?"undefined":h(n))&&(t=n,n=void 0);t=t||{};t.path=t.path||"/socket.io";this.nsps={};this.subs=[];this.opts=t;this.reconnection(t.reconnection!==!1);this.reconnectionAttempts(t.reconnectionAttempts||1/0);this.reconnectionDelay(t.reconnectionDelay||1e3);this.reconnectionDelayMax(t.reconnectionDelayMax||5e3);this.randomizationFactor(t.randomizationFactor||.5);this.backoff=new y({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==t.timeout?2e4:t.timeout);this.readyState="closed";this.uri=n;this.connecting=[];this.lastPing=null;this.encoding=!1;this.packetBuffer=[];var i=t.parser||v;this.encoder=new i.Encoder;this.decoder=new i.Decoder;this.autoConnect=t.autoConnect!==!1;this.autoConnect&&this.open()}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},c=i(13),l=i(36),a=i(8),v=i(7),f=i(38),e=i(39),u=i(3)("socket.io-client:manager"),o=i(35),y=i(40),s=Object.prototype.hasOwnProperty;n.exports=r;r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var n in this.nsps)s.call(this.nsps,n)&&this.nsps[n].emit.apply(this.nsps[n],arguments)};r.prototype.updateSocketIds=function(){for(var n in this.nsps)s.call(this.nsps,n)&&(this.nsps[n].id=this.generateId(n))};r.prototype.generateId=function(n){return("/"===n?"":n+"#")+this.engine.id};a(r.prototype);r.prototype.reconnection=function(n){return arguments.length?(this._reconnection=!!n,this):this._reconnection};r.prototype.reconnectionAttempts=function(n){return arguments.length?(this._reconnectionAttempts=n,this):this._reconnectionAttempts};r.prototype.reconnectionDelay=function(n){return arguments.length?(this._reconnectionDelay=n,this.backoff&&this.backoff.setMin(n),this):this._reconnectionDelay};r.prototype.randomizationFactor=function(n){return arguments.length?(this._randomizationFactor=n,this.backoff&&this.backoff.setJitter(n),this):this._randomizationFactor};r.prototype.reconnectionDelayMax=function(n){return arguments.length?(this._reconnectionDelayMax=n,this.backoff&&this.backoff.setMax(n),this):this._reconnectionDelayMax};r.prototype.timeout=function(n){return arguments.length?(this._timeout=n,this):this._timeout};r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()};r.prototype.open=r.prototype.connect=function(n){var i,t,e,o,r,s;return(u("readyState %s",this.readyState),~this.readyState.indexOf("open"))?this:(u("opening %s",this.uri),this.engine=c(this.uri,this.opts),i=this.engine,t=this,this.readyState="opening",this.skipReconnect=!1,e=f(i,"open",function(){t.onopen();n&&n()}),o=f(i,"error",function(i){if(u("connect_error"),t.cleanup(),t.readyState="closed",t.emitAll("connect_error",i),n){var r=new Error("Connection error");r.data=i;n(r)}else t.maybeReconnectOnOpen()}),!1!==this._timeout&&(r=this._timeout,u("connect attempt will timeout after %d",r),s=setTimeout(function(){u("connect attempt timed out after %d",r);e.destroy();i.close();i.emit("error","timeout");t.emitAll("connect_timeout",r)},r),this.subs.push({destroy:function(){clearTimeout(s)}})),this.subs.push(e),this.subs.push(o),this)};r.prototype.onopen=function(){u("open");this.cleanup();this.readyState="open";this.emit("open");var n=this.engine;this.subs.push(f(n,"data",e(this,"ondata")));this.subs.push(f(n,"ping",e(this,"onping")));this.subs.push(f(n,"pong",e(this,"onpong")));this.subs.push(f(n,"error",e(this,"onerror")));this.subs.push(f(n,"close",e(this,"onclose")));this.subs.push(f(this.decoder,"decoded",e(this,"ondecoded")))};r.prototype.onping=function(){this.lastPing=new Date;this.emitAll("ping")};r.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)};r.prototype.ondata=function(n){this.decoder.add(n)};r.prototype.ondecoded=function(n){this.emit("packet",n)};r.prototype.onerror=function(n){u("error",n);this.emitAll("error",n)};r.prototype.socket=function(n,t){function u(){~o(r.connecting,i)||r.connecting.push(i)}var i=this.nsps[n],r;return i||(i=new l(this,n,t),this.nsps[n]=i,r=this,i.on("connecting",u),i.on("connect",function(){i.id=r.generateId(n)}),this.autoConnect&&u()),i};r.prototype.destroy=function(n){var t=o(this.connecting,n);~t&&this.connecting.splice(t,1);this.connecting.length||this.close()};r.prototype.packet=function(n){u("writing packet %j",n);var t=this;n.query&&0===n.type&&(n.nsp+="?"+n.query);t.encoding?t.packetBuffer.push(n):(t.encoding=!0,this.encoder.encode(n,function(i){for(var r=0;r<i.length;r++)t.engine.write(i[r],n.options);t.encoding=!1;t.processPacketQueue()}))};r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var n=this.packetBuffer.shift();this.packet(n)}};r.prototype.cleanup=function(){var t,n,i;for(u("cleanup"),t=this.subs.length,n=0;n<t;n++)i=this.subs.shift(),i.destroy();this.packetBuffer=[];this.encoding=!1;this.lastPing=null;this.decoder.destroy()};r.prototype.close=r.prototype.disconnect=function(){u("disconnect");this.skipReconnect=!0;this.reconnecting=!1;"opening"===this.readyState&&this.cleanup();this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};r.prototype.onclose=function(n){u("onclose");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",n);this._reconnection&&!this.skipReconnect&&this.reconnect()};r.prototype.reconnect=function(){var n,t,i;if(this.reconnecting||this.skipReconnect)return this;n=this;this.backoff.attempts>=this._reconnectionAttempts?(u("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1):(t=this.backoff.duration(),u("will wait %dms before reconnect attempt",t),this.reconnecting=!0,i=setTimeout(function(){n.skipReconnect||(u("attempting reconnect"),n.emitAll("reconnect_attempt",n.backoff.attempts),n.emitAll("reconnecting",n.backoff.attempts),n.skipReconnect||n.open(function(t){t?(u("reconnect attempt error"),n.reconnecting=!1,n.reconnect(),n.emitAll("reconnect_error",t.data)):(u("reconnect success"),n.onreconnect())}))},t),this.subs.push({destroy:function(){clearTimeout(i)}}))};r.prototype.onreconnect=function(){var n=this.backoff.attempts;this.reconnecting=!1;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",n)}},function(n,t,i){n.exports=i(14);n.exports.parser=i(21)},function(n,t,i){function r(n,t){return this instanceof r?(t=t||{},n&&"object"==typeof n&&(t=n,n=null),n?(n=e(n),t.hostname=n.host,t.secure="https"===n.protocol||"wss"===n.protocol,t.port=n.port,n.query&&(t.query=n.query)):t.host&&(t.hostname=e(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,void this.open()):new r(n,t)}function o(n){var i={};for(var t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i}var s=i(15),h=i(8),u=i(3)("engine.io-client:socket"),c=i(35),f=i(21),e=i(2),l=i(29);n.exports=r;r.priorWebsocketSuccess=!1;h(r.prototype);r.protocol=f.protocol;r.Socket=r;r.Transport=i(20);r.transports=i(15);r.parser=i(21);r.prototype.createTransport=function(n){var i,t;return u('creating transport "%s"',n),i=o(this.query),i.EIO=f.protocol,i.transport=n,t=this.transportOptions[n]||{},this.id&&(i.sid=this.id),new s[n]({query:i,socket:this,agent:t.agent||this.agent,hostname:t.hostname||this.hostname,port:t.port||this.port,secure:t.secure||this.secure,path:t.path||this.path,forceJSONP:t.forceJSONP||this.forceJSONP,jsonp:t.jsonp||this.jsonp,forceBase64:t.forceBase64||this.forceBase64,enablesXDR:t.enablesXDR||this.enablesXDR,timestampRequests:t.timestampRequests||this.timestampRequests,timestampParam:t.timestampParam||this.timestampParam,policyPort:t.policyPort||this.policyPort,pfx:t.pfx||this.pfx,key:t.key||this.key,passphrase:t.passphrase||this.passphrase,cert:t.cert||this.cert,ca:t.ca||this.ca,ciphers:t.ciphers||this.ciphers,rejectUnauthorized:t.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:t.perMessageDeflate||this.perMessageDeflate,extraHeaders:t.extraHeaders||this.extraHeaders,forceNode:t.forceNode||this.forceNode,localAddress:t.localAddress||this.localAddress,requestTimeout:t.requestTimeout||this.requestTimeout,protocols:t.protocols||void 0,isReactNative:this.isReactNative})};r.prototype.open=function(){var n,t;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)n="websocket";else{if(0===this.transports.length)return t=this,void setTimeout(function(){t.emit("error","No transports available")},0);n=this.transports[0]}this.readyState="opening";try{n=this.createTransport(n)}catch(i){return this.transports.shift(),void this.open()}n.open();this.setTransport(n)};r.prototype.setTransport=function(n){u("setting transport %s",n.name);var t=this;this.transport&&(u("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners());this.transport=n;n.on("drain",function(){t.onDrain()}).on("packet",function(n){t.onPacket(n)}).on("error",function(n){t.onError(n)}).on("close",function(){t.onClose("transport close")})};r.prototype.probe=function(n){function o(){if(i.onlyBinaryUpgrades){var e=!this.supportsBinary&&i.transport.supportsBinary;f=f||e}f||(u('probe transport "%s" opened',n),t.send([{type:"ping",data:"probe"}]),t.once("packet",function(e){if(!f)if("pong"===e.type&&"probe"===e.data){if(u('probe transport "%s" pong',n),i.upgrading=!0,i.emit("upgrading",t),!t)return;r.priorWebsocketSuccess="websocket"===t.name;u('pausing current transport "%s"',i.transport.name);i.transport.pause(function(){f||"closed"!==i.readyState&&(u("changing transport and sending upgrade packet"),a(),i.setTransport(t),t.send([{type:"upgrade"}]),i.emit("upgrade",t),t=null,i.upgrading=!1,i.flush())})}else{u('probe transport "%s" failed',n);var o=new Error("probe error");o.transport=t.name;i.emit("upgradeError",o)}}))}function s(){f||(f=!0,a(),t.close(),t=null)}function e(r){var f=new Error("probe error: "+r);f.transport=t.name;s();u('probe transport "%s" failed because of error: %s',n,r);i.emit("upgradeError",f)}function h(){e("transport closed")}function c(){e("socket closed")}function l(n){t&&n.name!==t.name&&(u('"%s" works - aborting "%s"',n.name,t.name),s())}function a(){t.removeListener("open",o);t.removeListener("error",e);t.removeListener("close",h);i.removeListener("close",c);i.removeListener("upgrading",l)}u('probing transport "%s"',n);var t=this.createTransport(n,{probe:1}),f=!1,i=this;r.priorWebsocketSuccess=!1;t.once("open",o);t.once("error",e);t.once("close",h);this.once("close",c);this.once("upgrading",l);t.open()};r.prototype.onOpen=function(){if(u("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var n=0,t=this.upgrades.length;n<t;n++)this.probe(this.upgrades[n])}};r.prototype.onPacket=function(n){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(u('socket receive: type "%s", data "%s"',n.type,n.data),this.emit("packet",n),this.emit("heartbeat"),n.type){case"open":this.onHandshake(JSON.parse(n.data));break;case"pong":this.setPing();this.emit("pong");break;case"error":var t=new Error("server error");t.code=n.data;this.onError(t);break;case"message":this.emit("data",n.data);this.emit("message",n.data)}else u('packet received with socket readyState "%s"',this.readyState)};r.prototype.onHandshake=function(n){this.emit("handshake",n);this.id=n.sid;this.transport.query.sid=n.sid;this.upgrades=this.filterUpgrades(n.upgrades);this.pingInterval=n.pingInterval;this.pingTimeout=n.pingTimeout;this.onOpen();"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))};r.prototype.onHeartbeat=function(n){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},n||t.pingInterval+t.pingTimeout)};r.prototype.setPing=function(){var n=this;clearTimeout(n.pingIntervalTimer);n.pingIntervalTimer=setTimeout(function(){u("writing ping packet - expecting pong within %sms",n.pingTimeout);n.ping();n.onHeartbeat(n.pingTimeout)},n.pingInterval)};r.prototype.ping=function(){var n=this;this.sendPacket("ping",function(){n.emit("ping")})};r.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;0===this.writeBuffer.length?this.emit("drain"):this.flush()};r.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(u("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))};r.prototype.write=r.prototype.send=function(n,t,i){return this.sendPacket("message",n,t,i),this};r.prototype.sendPacket=function(n,t,i,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof i&&(r=i,i=null),"closing"!==this.readyState&&"closed"!==this.readyState){i=i||{};i.compress=!1!==i.compress;var u={type:n,data:t,options:i};this.emit("packetCreate",u);this.writeBuffer.push(u);r&&this.once("flush",r);this.flush()}};r.prototype.close=function(){function i(){n.onClose("forced close");u("socket closing - telling transport to close");n.transport.close()}function t(){n.removeListener("upgrade",t);n.removeListener("upgradeError",t);i()}function r(){n.once("upgrade",t);n.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var n=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?r():i()}):this.upgrading?r():i()}return this};r.prototype.onError=function(n){u("socket error %j",n);r.priorWebsocketSuccess=!1;this.emit("error",n);this.onClose("transport error",n)};r.prototype.onClose=function(n,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){u('socket close with reason: "%s"',n);var i=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",n,t);i.writeBuffer=[];i.prevBufferLen=0}};r.prototype.filterUpgrades=function(n){for(var i=[],t=0,r=n.length;t<r;t++)~c(this.transports,n[t])&&i.push(n[t]);return i}},function(n,t,i){function r(n){var r,o=!1,s=!1,h=!1!==n.jsonp,i,t;if("undefined"!=typeof location&&(i="https:"===location.protocol,t=location.port,t||(t=i?443:80),o=n.hostname!==location.hostname||t!==n.port,s=n.secure!==i),n.xdomain=o,n.xscheme=s,r=new u(n),"open"in r&&!n.forceJSONP)return new f(n);if(!h)throw new Error("JSONP disabled");return new e(n)}var u=i(16),f=i(18),e=i(32),o=i(33);t.polling=r;t.websocket=o},function(n,t,i){var r=i(17);n.exports=function(n){var t=n.xdomain,i=n.xscheme,u=n.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(f){}try{if("undefined"!=typeof XDomainRequest&&!i&&u)return new XDomainRequest}catch(f){}if(!t)try{return new self[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(f){}}},function(n){try{n.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){n.exports=!1}},function(n,t,i){function e(){}function u(n){if(s.call(this,n),this.requestTimeout=n.requestTimeout,this.extraHeaders=n.extraHeaders,"undefined"!=typeof location){var i="https:"===location.protocol,t=location.port;t||(t=i?443:80);this.xd="undefined"!=typeof location&&n.hostname!==location.hostname||t!==n.port;this.xs=n.secure!==i}}function r(n){this.method=n.method||"GET";this.uri=n.uri;this.xd=!!n.xd;this.xs=!!n.xs;this.async=!1!==n.async;this.data=void 0!==n.data?n.data:null;this.agent=n.agent;this.isBinary=n.isBinary;this.supportsBinary=n.supportsBinary;this.enablesXDR=n.enablesXDR;this.requestTimeout=n.requestTimeout;this.pfx=n.pfx;this.key=n.key;this.passphrase=n.passphrase;this.cert=n.cert;this.ca=n.ca;this.ciphers=n.ciphers;this.rejectUnauthorized=n.rejectUnauthorized;this.extraHeaders=n.extraHeaders;this.create()}function o(){for(var n in r.requests)r.requests.hasOwnProperty(n)&&r.requests[n].abort()}var c=i(16),s=i(19),l=i(8),a=i(30),f=i(3)("engine.io-client:polling-xhr"),h;(n.exports=u,n.exports.Request=r,a(u,s),u.prototype.supportsBinary=!0,u.prototype.request=function(n){return n=n||{},n.uri=this.uri(),n.xd=this.xd,n.xs=this.xs,n.agent=this.agent||!1,n.supportsBinary=this.supportsBinary,n.enablesXDR=this.enablesXDR,n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,n.requestTimeout=this.requestTimeout,n.extraHeaders=this.extraHeaders,new r(n)},u.prototype.doWrite=function(n,t){var r="string"!=typeof n&&void 0!==n,i=this.request({method:"POST",data:n,isBinary:r}),u=this;i.on("success",t);i.on("error",function(n){u.onError("xhr post error",n)});this.sendXhr=i},u.prototype.doPoll=function(){f("xhr poll");var n=this.request(),t=this;n.on("data",function(n){t.onData(n)});n.on("error",function(n){t.onError("xhr poll error",n)});this.pollXhr=n},l(r.prototype),r.prototype.create=function(){var t={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR},n,i,u;t.pfx=this.pfx;t.key=this.key;t.passphrase=this.passphrase;t.cert=this.cert;t.ca=this.ca;t.ciphers=this.ciphers;t.rejectUnauthorized=this.rejectUnauthorized;n=this.xhr=new c(t);i=this;try{f("xhr open %s: %s",this.method,this.uri);n.open(this.method,this.uri,this.async);try{if(this.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(u in this.extraHeaders)this.extraHeaders.hasOwnProperty(u)&&n.setRequestHeader(u,this.extraHeaders[u])}}catch(e){}if("POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=!0);this.requestTimeout&&(n.timeout=this.requestTimeout);this.hasXDR()?(n.onload=function(){i.onLoad()},n.onerror=function(){i.onError(n.responseText)}):n.onreadystatechange=function(){if(2===n.readyState)try{var t=n.getResponseHeader("Content-Type");i.supportsBinary&&"application/octet-stream"===t&&(n.responseType="arraybuffer")}catch(r){}4===n.readyState&&(200===n.status||1223===n.status?i.onLoad():setTimeout(function(){i.onError(n.status)},0))};f("xhr data %s",this.data);n.send(this.data)}catch(e){return void setTimeout(function(){i.onError(e)},0)}"undefined"!=typeof document&&(this.index=r.requestsCount++,r.requests[this.index]=this)},r.prototype.onSuccess=function(){this.emit("success");this.cleanup()},r.prototype.onData=function(n){this.emit("data",n);this.onSuccess()},r.prototype.onError=function(n){this.emit("error",n);this.cleanup(!0)},r.prototype.cleanup=function(n){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=e:this.xhr.onreadystatechange=e,n)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete r.requests[this.index];this.xhr=null}},r.prototype.onLoad=function(){var n,t;try{try{t=this.xhr.getResponseHeader("Content-Type")}catch(i){}n="application/octet-stream"===t?this.xhr.response||this.xhr.responseText:this.xhr.responseText}catch(i){this.onError(i)}null!=n&&this.onData(n)},r.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},r.prototype.abort=function(){this.cleanup()},r.requestsCount=0,r.requests={},"undefined"!=typeof document)&&("function"==typeof attachEvent?attachEvent("onunload",o):"function"==typeof addEventListener&&(h="onpagehide"in self?"pagehide":"unload",addEventListener(h,o,!1)))},function(n,t,i){function u(n){var t=n&&n.forceBase64;o&&!t||(this.supportsBinary=!1);f.call(this,n)}var f=i(20),s=i(29),e=i(21),h=i(30),c=i(31),r=i(3)("engine.io-client:polling"),o;n.exports=u;o=function(){var n=i(16),t=new n({xdomain:!1});return null!=t.responseType}();h(u,f);u.prototype.name="polling";u.prototype.doOpen=function(){this.poll()};u.prototype.pause=function(n){function i(){r("paused");u.readyState="paused";n()}var u=this,t;(this.readyState="pausing",this.polling||!this.writable)?(t=0,this.polling&&(r("we are currently polling - waiting to pause"),t++,this.once("pollComplete",function(){r("pre-pause polling complete");--t||i()})),this.writable||(r("we are currently writing - waiting to pause"),t++,this.once("drain",function(){r("pre-pause writing complete");--t||i()}))):i()};u.prototype.poll=function(){r("polling");this.polling=!0;this.doPoll();this.emit("poll")};u.prototype.onData=function(n){var t=this,i;r("polling got data %s",n);i=function(n){return"opening"===t.readyState&&t.onOpen(),"close"===n.type?(t.onClose(),!1):void t.onPacket(n)};e.decodePayload(n,this.socket.binaryType,i);"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():r('ignoring poll - transport state "%s"',this.readyState))};u.prototype.doClose=function(){function n(){r("writing close packet");t.write([{type:"close"}])}var t=this;"open"===this.readyState?(r("transport open - closing"),n()):(r("transport not open - deferring close"),this.once("open",n))};u.prototype.write=function(n){var t=this,i;this.writable=!1;i=function(){t.writable=!0;t.emit("drain")};e.encodePayload(n,this.supportsBinary,function(n){t.doWrite(n,i)})};u.prototype.uri=function(){var n=this.query||{},t=this.secure?"https":"http",i="",r;return!1!==this.timestampRequests&&(n[this.timestampParam]=c()),this.supportsBinary||n.sid||(n.b64=1),n=s.encode(n),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(i=":"+this.port),n.length&&(n="?"+n),r=this.hostname.indexOf(":")!==-1,t+"://"+(r?"["+this.hostname+"]":this.hostname)+i+this.path+n}},function(n,t,i){function r(n){this.path=n.path;this.hostname=n.hostname;this.port=n.port;this.secure=n.secure;this.query=n.query;this.timestampParam=n.timestampParam;this.timestampRequests=n.timestampRequests;this.readyState="";this.agent=n.agent||!1;this.socket=n.socket;this.enablesXDR=n.enablesXDR;this.pfx=n.pfx;this.key=n.key;this.passphrase=n.passphrase;this.cert=n.cert;this.ca=n.ca;this.ciphers=n.ciphers;this.rejectUnauthorized=n.rejectUnauthorized;this.forceNode=n.forceNode;this.isReactNative=n.isReactNative;this.extraHeaders=n.extraHeaders;this.localAddress=n.localAddress}var u=i(21),f=i(8);n.exports=r;f(r.prototype);r.prototype.onError=function(n,t){var i=new Error(n);return i.type="TransportError",i.description=t,this.emit("error",i),this};r.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this};r.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this};r.prototype.send=function(n){if("open"!==this.readyState)throw new Error("Transport not open");this.write(n)};r.prototype.onOpen=function(){this.readyState="open";this.writable=!0;this.emit("open")};r.prototype.onData=function(n){var t=u.decodePacket(n,this.socket.binaryType);this.onPacket(t)};r.prototype.onPacket=function(n){this.emit("packet",n)};r.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},function(n,t,i){function a(n,i){var r="b"+t.packets[n.type]+n.data.data;return i(r)}function v(n,i,r){var u;if(!i)return t.encodeBase64Packet(n,r);var e=n.data,s=new Uint8Array(e),f=new Uint8Array(1+e.byteLength);for(f[0]=o[n.type],u=0;u<s.length;u++)f[u+1]=s[u];return r(f.buffer)}function y(n,i,r){if(!i)return t.encodeBase64Packet(n,r);var u=new FileReader;return u.onload=function(){t.encodePacket({type:n.type,data:u.result},i,!0,r)},u.readAsArrayBuffer(n.data)}function p(n,i,u){var f,e;return i?l?y(n,i,u):(f=new Uint8Array(1),f[0]=o[n.type],e=new r([f.buffer,n.data]),u(e)):t.encodeBase64Packet(n,u)}function w(n){try{n=c.decode(n,{strict:!1})}catch(t){return!1}return n}function s(n,t,i){for(var u=new Array(n.length),f=d(n.length,i),e=function(n,i,r){t(i,function(t,i){u[n]=i;r(t,u)})},r=0;r<n.length;r++)e(r,n[r],f)}var h,b=i(22),k=i(23),e=i(24),d=i(25),c=i(26);"undefined"!=typeof ArrayBuffer&&(h=i(27));var g="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),nt="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),l=g||nt;t.protocol=3;var o=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},f=b(o),u={type:"error",data:"parser error"},r=i(28);t.encodePacket=function(n,t,i,u){var f,e;return("function"==typeof t&&(u=t,t=!1),"function"==typeof i&&(u=i,i=null),f=void 0===n.data?void 0:n.data.buffer||n.data,"undefined"!=typeof ArrayBuffer&&f instanceof ArrayBuffer)?v(n,t,u):"undefined"!=typeof r&&f instanceof r?p(n,t,u):f&&f.base64?a(n,u):(e=o[n.type],void 0!==n.data&&(e+=i?c.encode(String(n.data),{strict:!1}):String(n.data)),u(""+e))};t.encodeBase64Packet=function(n,i){var e="b"+t.packets[n.type],u,o;if("undefined"!=typeof r&&n.data instanceof r)return u=new FileReader,u.onload=function(){var n=u.result.split(",")[1];i(e+n)},u.readAsDataURL(n.data);try{o=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(c){for(var s=new Uint8Array(n.data),h=new Array(s.length),f=0;f<s.length;f++)h[f]=s[f];o=String.fromCharCode.apply(null,h)}return e+=btoa(o),i(e)};t.decodePacket=function(n,i,o){var s;if(void 0===n)return u;if("string"==typeof n)return"b"===n.charAt(0)?t.decodeBase64Packet(n.substr(1),i):o&&(n=w(n),n===!1)?u:(s=n.charAt(0),Number(s)==s&&f[s]?n.length>1?{type:f[s],data:n.substring(1)}:{type:f[s]}:u);var c=new Uint8Array(n),s=c[0],h=e(n,1);return r&&"blob"===i&&(h=new r([h])),{type:f[s],data:h}};t.decodeBase64Packet=function(n,t){var u=f[n.charAt(0)],i;return h?(i=h.decode(n.substr(1)),"blob"===t&&r&&(i=new r([i])),{type:u,data:i}):{type:u,data:{base64:!0,data:n.substr(1)}}};t.encodePayload=function(n,i,u){function e(n){return n.length+":"+n}function o(n,r){t.encodePacket(n,!!f&&i,!1,function(n){r(null,e(n))})}"function"==typeof i&&(u=i,i=null);var f=k(n);return i&&f?r&&!l?t.encodePayloadAsBlob(n,u):t.encodePayloadAsArrayBuffer(n,u):n.length?void s(n,o,function(n,t){return u(t.join(""))}):u("0:")};t.decodePayload=function(n,i,r){var o,c,a;if("string"!=typeof n)return t.decodePayloadAsBinary(n,i,r);if("function"==typeof i&&(r=i,i=null),""===n)return r(u,0,1);for(var s,h,f="",e=0,l=n.length;e<l;e++)if(c=n.charAt(e),":"===c){if(""===f||f!=(s=Number(f))||(h=n.substr(e+1,s),f!=h.length))return r(u,0,1);if(h.length){if(o=t.decodePacket(h,i,!1),u.type===o.type&&u.data===o.data)return r(u,0,1);if(a=r(o,e+s,l),!1===a)return}e+=s;f=""}else f+=c;if(""!==f)return r(u,0,1)};t.encodePayloadAsArrayBuffer=function(n,i){function r(n,i){t.encodePacket(n,!0,!0,function(n){return i(null,n)})}return n.length?void s(n,r,function(n,t){var f=t.reduce(function(n,t){var i;return i="string"==typeof t?t.length:t.byteLength,n+i.toString().length+i+2},0),r=new Uint8Array(f),u=0;return t.forEach(function(n){var o="string"==typeof n,f=n,e,i,t;if(o){for(i=new Uint8Array(n.length),t=0;t<n.length;t++)i[t]=n.charCodeAt(t);f=i.buffer}for(r[u++]=o?0:1,e=f.byteLength.toString(),t=0;t<e.length;t++)r[u++]=parseInt(e[t]);for(r[u++]=255,i=new Uint8Array(f),t=0;t<i.length;t++)r[u++]=i[t]}),i(r.buffer)}):i(new ArrayBuffer(0))};t.encodePayloadAsBlob=function(n,i){function u(n,i){t.encodePacket(n,!0,!0,function(n){var f=new Uint8Array(1),e,t,s;if(f[0]=1,"string"==typeof n){for(e=new Uint8Array(n.length),t=0;t<n.length;t++)e[t]=n.charCodeAt(t);n=e.buffer;f[0]=0}for(var h=n instanceof ArrayBuffer?n.byteLength:n.size,u=h.toString(),o=new Uint8Array(u.length+1),t=0;t<u.length;t++)o[t]=parseInt(u[t]);(o[u.length]=255,r)&&(s=new r([f.buffer,o.buffer,n]),i(null,s))})}s(n,u,function(n,t){return i(new r(t))})};t.decodePayloadAsBinary=function(n,i,r){var f,c,h,a,s,v;for("function"==typeof i&&(r=i,i=null),f=n,c=[];f.byteLength>0;){for(var l=new Uint8Array(f),y=0===l[0],o="",s=1;255!==l[s];s++){if(o.length>310)return r(u,0,1);o+=l[s]}if(f=e(f,2+o.length),o=parseInt(o),h=e(f,0,o),y)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(p){for(a=new Uint8Array(h),h="",s=0;s<a.length;s++)h+=String.fromCharCode(a[s])}c.push(h);f=e(f,o)}v=c.length;c.forEach(function(n,u){r(t.decodePacket(n,i,!0),u,v)})}},function(n){n.exports=Object.keys||function(n){var t=[],r=Object.prototype.hasOwnProperty;for(var i in n)r.call(n,i)&&t.push(i);return t}},function(n,t,i){function r(n){var t,u,i;if(!n||"object"!=typeof n)return!1;if(f(n)){for(t=0,u=n.length;t<u;t++)if(r(n[t]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(n)||"function"==typeof ArrayBuffer&&n instanceof ArrayBuffer||e&&n instanceof Blob||o&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return r(n.toJSON(),!0);for(i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&r(n[i]))return!0;return!1}var f=i(10),u=Object.prototype.toString,e="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===u.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===u.call(File);n.exports=r},function(n){n.exports=function(n,t,i){var r=n.byteLength;if(t=t||0,i=i||r,n.slice)return n.slice(t,i);if(t<0&&(t+=r),i<0&&(i+=r),i>r&&(i=r),t>=r||t>=i||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(n),f=new Uint8Array(i-t),u=t,e=0;u<i;u++,e++)f[e]=o[u];return f.buffer}},function(n){function t(n,t,r){function u(n,i){if(u.count<=0)throw new Error("after called too many times");--u.count;n?(f=!0,t(n),t=r):0!==u.count||f||t(null,i)}var f=!1;return r=r||i,u.count=n,0===n?t():u}function i(){}n.exports=t},function(n){function o(n){for(var t,u,r=[],i=0,f=n.length;i<f;)t=n.charCodeAt(i++),t>=55296&&t<=56319&&i<f?(u=n.charCodeAt(i++),56320==(64512&u)?r.push(((1023&t)<<10)+(1023&u)+65536):(r.push(t),i--)):r.push(t);return r}function h(n){for(var t,f=n.length,u=-1,r="";++u<f;)t=n[u],t>65535&&(t-=65536,r+=i(t>>>10&1023|55296),t=56320|1023&t),r+=i(t);return r}function s(n,t){if(n>=55296&&n<=57343){if(t)throw Error("Lone surrogate U+"+n.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function e(n,t){return i(n>>t&63|128)}function c(n,t){if(0==(4294967168&n))return i(n);var r="";return 0==(4294965248&n)?r=i(n>>6&31|192):0==(4294901760&n)?(s(n,t)||(n=65533),r=i(n>>12&15|224),r+=e(n,6)):0==(4292870144&n)&&(r=i(n>>18&7|240),r+=e(n,12),r+=e(n,6)),r+i(63&n|128)}function l(n,t){t=t||{};for(var i,e=!1!==t.strict,r=o(n),s=r.length,u=-1,f="";++u<s;)i=r[u],f+=c(i,e);return f}function r(){if(t>=f)throw Error("Invalid byte index");var n=255&u[t];if(t++,128==(192&n))return 63&n;throw Error("Invalid continuation byte");}function a(n){var e,o,h,c,i;if(t>f)throw Error("Invalid byte index");if(t==f)return!1;if(e=255&u[t],t++,0==(128&e))return e;if(192==(224&e)){if(o=r(),i=(31&e)<<6|o,i>=128)return i;throw Error("Invalid continuation byte");}if(224==(240&e)){if(o=r(),h=r(),i=(15&e)<<12|o<<6|h,i>=2048)return s(i,n)?i:65533;throw Error("Invalid continuation byte");}if(240==(248&e)&&(o=r(),h=r(),c=r(),i=(7&e)<<18|o<<12|h<<6|c,i>=65536&&i<=1114111))return i;throw Error("Invalid UTF-8 detected");}function v(n,i){var e,s,r;for(i=i||{},e=!1!==i.strict,u=o(n),f=u.length,t=0,r=[];(s=a(e))!==!1;)r.push(s);return h(r)}
/*! https://mths.be/utf8js v2.1.2 by @mathias */
var u,f,t,i=String.fromCharCode;n.exports={version:"2.1.2",encode:l,decode:v}},function(n,t){!function(){"use strict";for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256),r=0;r<n.length;r++)i[n.charCodeAt(r)]=r;t.encode=function(t){for(var u=new Uint8Array(t),f=u.length,i="",r=0;r<f;r+=3)i+=n[u[r]>>2],i+=n[(3&u[r])<<4|u[r+1]>>4],i+=n[(15&u[r+1])<<2|u[r+2]>>6],i+=n[63&u[r+2]];return f%3==2?i=i.substring(0,i.length-1)+"=":f%3==1&&(i=i.substring(0,i.length-2)+"=="),i};t.decode=function(n){var t,h,u,f,c,e=.75*n.length,l=n.length,o=0,s,r;for("="===n[n.length-1]&&(e--,"="===n[n.length-2]&&e--),s=new ArrayBuffer(e),r=new Uint8Array(s),t=0;t<l;t+=4)h=i[n.charCodeAt(t)],u=i[n.charCodeAt(t+1)],f=i[n.charCodeAt(t+2)],c=i[n.charCodeAt(t+3)],r[o++]=h<<2|u>>4,r[o++]=(15&u)<<4|f>>2,r[o++]=(3&f)<<6|63&c;return s}}()},function(n){function i(n){return n.map(function(n){var t,i;return n.buffer instanceof ArrayBuffer?(t=n.buffer,n.byteLength!==t.byteLength&&(i=new Uint8Array(n.byteLength),i.set(new Uint8Array(t,n.byteOffset,n.byteLength)),t=i.buffer),t):n})}function r(n,r){r=r||{};var u=new t;return i(n).forEach(function(n){u.append(n)}),r.type?u.getBlob(r.type):u.getBlob()}function u(n,t){return new Blob(i(n),t||{})}var t="undefined"!=typeof t?t:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,f=function(){try{var n=new Blob(["hi"]);return 2===n.size}catch(t){return!1}}(),e=f&&function(){try{var n=new Blob([new Uint8Array([1,2])]);return 2===n.size}catch(t){return!1}}(),o=t&&t.prototype.append&&t.prototype.getBlob;"undefined"!=typeof Blob&&(r.prototype=Blob.prototype,u.prototype=Blob.prototype);n.exports=function(){return f?e?Blob:u:o?r:void 0}()},function(n,t){t.encode=function(n){var t="";for(var i in n)n.hasOwnProperty(i)&&(t.length&&(t+="&"),t+=encodeURIComponent(i)+"="+encodeURIComponent(n[i]));return t};t.decode=function(n){for(var i,r={},u=n.split("&"),t=0,f=u.length;t<f;t++)i=u[t].split("="),r[decodeURIComponent(i[0])]=decodeURIComponent(i[1]);return r}},function(n){n.exports=function(n,t){var i=function(){};i.prototype=t.prototype;n.prototype=new i;n.prototype.constructor=n}},function(n){"use strict";function r(n){var t="";do t=e[n%i]+t,n=Math.floor(n/i);while(n>0);return t}function h(n){var r=0;for(t=0;t<n.length;t++)r=r*i+o[n.charAt(t)];return r}function u(){var n=r(+new Date);return n!==f?(s=0,f=n):n+"."+r(s++)}for(var f,e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,o={},s=0,t=0;t<i;t++)o[e[t]]=t;u.encode=r;u.decode=h;n.exports=u},function(n,t,i){(function(t){function s(){}function h(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof t?t:{}}function r(n){var i,t;(f.call(this,n),this.query=this.query||{},u)||(i=h(),u=i.___eio=i.___eio||[]);this.index=u.length;t=this;u.push(function(n){t.onData(n)});this.query.j=this.index;"function"==typeof addEventListener&&addEventListener("beforeunload",function(){t.script&&(t.script.onerror=s)},!1)}var f=i(19),c=i(30),u,e,o;n.exports=r;e=/\n/g;o=/\\n/g;c(r,f);r.prototype.supportsBinary=!1;r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null);f.prototype.doClose.call(this)};r.prototype.doPoll=function(){var r=this,n=document.createElement("script"),t,i;this.script&&(this.script.parentNode.removeChild(this.script),this.script=null);n.async=!0;n.src=this.uri();n.onerror=function(n){r.onError("jsonp poll error",n)};t=document.getElementsByTagName("script")[0];t?t.parentNode.insertBefore(n,t):(document.head||document.body).appendChild(n);this.script=n;i="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);i&&setTimeout(function(){var n=document.createElement("iframe");document.body.appendChild(n);document.body.removeChild(n)},100)};r.prototype.doWrite=function(n,t){function s(){h();t()}function h(){if(i.iframe)try{i.form.removeChild(i.iframe)}catch(n){i.onError("jsonp polling iframe removal error",n)}try{var t='<iframe src="javascript:0" name="'+i.iframeId+'">';u=document.createElement(t)}catch(n){u=document.createElement("iframe");u.name=i.iframeId;u.src="javascript:0"}u.id=i.iframeId;i.form.appendChild(u);i.iframe=u}var i=this;if(!this.form){var u,r=document.createElement("form"),f=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;r.className="socketio";r.style.position="absolute";r.style.top="-1000px";r.style.left="-1000px";r.target=c;r.method="POST";r.setAttribute("accept-charset","utf-8");f.name="d";r.appendChild(f);document.body.appendChild(r);this.form=r;this.area=f}this.form.action=this.uri();h();n=n.replace(o,"\\\n");this.area.value=n.replace(e,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===i.iframe.readyState&&s()}:this.iframe.onload=s}}).call(t,function(){return this}())},function(n,t,i){function r(n){var t=n&&n.forceBase64;t&&(this.supportsBinary=!1);this.perMessageDeflate=n.perMessageDeflate;this.usingBrowserWebSocket=f&&!n.forceNode;this.protocols=n.protocols;this.usingBrowserWebSocket||(u=e);o.call(this,n)}var f,e,o=i(20),s=i(21),h=i(29),c=i(30),l=i(31),a=i(3)("engine.io-client:websocket"),u;if("undefined"==typeof self)try{e=i(34)}catch(v){}else f=self.WebSocket||self.MozWebSocket;u=f||e;n.exports=r;c(r,o);r.prototype.name="websocket";r.prototype.supportsBinary=!0;r.prototype.doOpen=function(){if(this.check()){var t=this.uri(),i=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx;n.key=this.key;n.passphrase=this.passphrase;n.cert=this.cert;n.ca=this.ca;n.ciphers=this.ciphers;n.rejectUnauthorized=this.rejectUnauthorized;this.extraHeaders&&(n.headers=this.extraHeaders);this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?i?new u(t,i):new u(t):new u(t,i,n)}catch(r){return this.emit("error",r)}void 0===this.ws.binaryType&&(this.supportsBinary=!1);this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer";this.addEventListeners()}};r.prototype.addEventListeners=function(){var n=this;this.ws.onopen=function(){n.onOpen()};this.ws.onclose=function(){n.onClose()};this.ws.onmessage=function(t){n.onData(t.data)};this.ws.onerror=function(t){n.onError("websocket error",t)}};r.prototype.write=function(n){function u(){t.emit("flush");setTimeout(function(){t.writable=!0;t.emit("drain")},0)}var t=this;this.writable=!1;for(var r=n.length,i=0,f=r;i<f;i++)!function(n){s.encodePacket(n,t.supportsBinary,function(i){var f,e;t.usingBrowserWebSocket||(f={},(n.options&&(f.compress=n.options.compress),t.perMessageDeflate)&&(e="string"==typeof i?Buffer.byteLength(i):i.length,e<t.perMessageDeflate.threshold&&(f.compress=!1)));try{t.usingBrowserWebSocket?t.ws.send(i):t.ws.send(i,f)}catch(o){a("websocket closed before onclose event")}--r||u()})}(n[i])};r.prototype.onClose=function(){o.prototype.onClose.call(this)};r.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()};r.prototype.uri=function(){var n=this.query||{},t=this.secure?"wss":"ws",i="",r;return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(i=":"+this.port),this.timestampRequests&&(n[this.timestampParam]=l()),this.supportsBinary||(n.b64=1),n=h.encode(n),n.length&&(n="?"+n),r=this.hostname.indexOf(":")!==-1,t+"://"+(r?"["+this.hostname+"]":this.hostname)+i+this.path+n};r.prototype.check=function(){return!(!u||"__initialize"in u&&this.name===r.prototype.name)}},function(){},function(n){var t=[].indexOf;n.exports=function(n,i){if(t)return n.indexOf(i);for(var r=0;r<n.length;++r)if(n[r]===i)return r;return-1}},function(n,t,i){"use strict";function r(n,t,i){this.io=n;this.nsp=t;this.json=this;this.ids=0;this.acks={};this.receiveBuffer=[];this.sendBuffer=[];this.connected=!1;this.disconnected=!0;this.flags={};i&&i.query&&(this.query=i.query);this.io.autoConnect&&this.open()}var v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},u=i(7),c=i(8),o=i(37),s=i(38),h=i(39),f=i(3)("socket.io-client:socket"),y=i(29),l=i(23),a,e;n.exports=t=r;a={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1};e=c.prototype.emit;c(r.prototype);r.prototype.subEvents=function(){if(!this.subs){var n=this.io;this.subs=[s(n,"open",h(this,"onopen")),s(n,"packet",h(this,"onpacket")),s(n,"close",h(this,"onclose"))]}};r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)};r.prototype.send=function(){var n=o(arguments);return n.unshift("message"),this.emit.apply(this,n),this};r.prototype.emit=function(n){if(a.hasOwnProperty(n))return e.apply(this,arguments),this;var t=o(arguments),i={type:(void 0!==this.flags.binary?this.flags.binary:l(t))?u.BINARY_EVENT:u.EVENT,data:t};return i.options={},i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(f("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this.flags={},this};r.prototype.packet=function(n){n.nsp=this.nsp;this.io.packet(n)};r.prototype.onopen=function(){if(f("transport is open - connecting"),"/"!==this.nsp)if(this.query){var n="object"===v(this.query)?y.encode(this.query):this.query;f("sending connect packet with query %s",n);this.packet({type:u.CONNECT,query:n})}else this.packet({type:u.CONNECT})};r.prototype.onclose=function(n){f("close (%s)",n);this.connected=!1;this.disconnected=!0;delete this.id;this.emit("disconnect",n)};r.prototype.onpacket=function(n){var t=n.nsp===this.nsp,i=n.type===u.ERROR&&"/"===n.nsp;if(t||i)switch(n.type){case u.CONNECT:this.onconnect();break;case u.EVENT:this.onevent(n);break;case u.BINARY_EVENT:this.onevent(n);break;case u.ACK:this.onack(n);break;case u.BINARY_ACK:this.onack(n);break;case u.DISCONNECT:this.ondisconnect();break;case u.ERROR:this.emit("error",n.data)}};r.prototype.onevent=function(n){var t=n.data||[];f("emitting event %j",t);null!=n.id&&(f("attaching ack callback to event"),t.push(this.ack(n.id)));this.connected?e.apply(this,t):this.receiveBuffer.push(t)};r.prototype.ack=function(n){var i=this,t=!1;return function(){if(!t){t=!0;var r=o(arguments);f("sending ack %j",r);i.packet({type:l(r)?u.BINARY_ACK:u.ACK,id:n,data:r})}}};r.prototype.onack=function(n){var t=this.acks[n.id];"function"==typeof t?(f("calling ack %s with %j",n.id,n.data),t.apply(this,n.data),delete this.acks[n.id]):f("bad ack %s",n.id)};r.prototype.onconnect=function(){this.connected=!0;this.disconnected=!1;this.emit("connect");this.emitBuffered()};r.prototype.emitBuffered=function(){for(var n=0;n<this.receiveBuffer.length;n++)e.apply(this,this.receiveBuffer[n]);for(this.receiveBuffer=[],n=0;n<this.sendBuffer.length;n++)this.packet(this.sendBuffer[n]);this.sendBuffer=[]};r.prototype.ondisconnect=function(){f("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};r.prototype.destroy=function(){if(this.subs){for(var n=0;n<this.subs.length;n++)this.subs[n].destroy();this.subs=null}this.io.destroy(this)};r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(f("performing disconnect (%s)",this.nsp),this.packet({type:u.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this};r.prototype.compress=function(n){return this.flags.compress=n,this};r.prototype.binary=function(n){return this.flags.binary=n,this}},function(n){function t(n,t){var r=[],i;for(t=t||0,i=t||0;i<n.length;i++)r[i-t]=n[i];return r}n.exports=t},function(n){"use strict";function t(n,t,i){return n.on(t,i),{destroy:function(){n.removeListener(t,i)}}}n.exports=t},function(n){var t=[].slice;n.exports=function(n,i){if("string"==typeof i&&(i=n[i]),"function"!=typeof i)throw new Error("bind() requires a function");var r=t.call(arguments,2);return function(){return i.apply(n,r.concat(t.call(arguments)))}}},function(n){function t(n){n=n||{};this.ms=n.min||100;this.max=n.max||1e4;this.factor=n.factor||2;this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0;this.attempts=0}n.exports=t;t.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++),t,i;return this.jitter&&(t=Math.random(),i=Math.floor(t*this.jitter*n),n=0==(1&Math.floor(10*t))?n-i:n+i),0|Math.min(n,this.max)};t.prototype.reset=function(){this.attempts=0};t.prototype.setMin=function(n){this.ms=n};t.prototype.setMax=function(n){this.max=n};t.prototype.setJitter=function(n){this.jitter=n}}])});
typeof ASC=="undefined"&&(ASC={});ASC.SocketIO=function(n){var t=ASC.Resources.Master,i,r;t.Hub&&t.Hub.Url&&(i=t.Hub,r={path:i.Url,reconnectionAttempts:5,perMessageDeflate:"false"},t.numberId&&i.VoipEnabled&&(r.query={numberId:t.numberId}),this.socket=io(n,r))};ASC.SocketIO.prototype.emit=function(){return this.socket&&this.socket.emit.apply(this.socket,arguments),this};ASC.SocketIO.prototype.on=function(){return this.socket&&(arguments[0]==="connect"&&typeof arguments[1]=="function"&&this.socket.connected?arguments[1]():this.socket.on.apply(this.socket,arguments)),this};ASC.SocketIO.prototype.connect=function(){return this.on.call(this,"connect",arguments[0])};ASC.SocketIO.prototype.reconnect_failed=function(){return this.on.call(this,"reconnect_failed",arguments[0])};ASC.SocketIO.prototype.connected=function(){return this.socket&&this.socket.connected};ASC.SocketIO.disabled=function(){return!ASC.Resources.Master.Hub||!ASC.Resources.Master.Hub.Url};ASC.SocketIO.init=function(){var t=ASC.Resources.Master,n,i;t.Hub&&t.Hub.Url&&(n=ASC.Resources.Master.Hub.Url,i=n.length-1,n.lastIndexOf("/")===n.length-1&&(n=n.substring(0,i)),jq.ajax({type:"OPTIONS",url:n+"/?EIO=3&transport=polling","async":!0}))};ASC.SocketIO.Factory=function(){var n,t,i,r;return{get chat(){return n||(n=new ASC.SocketIO("/chat")),n},get voip(){return t||(t=new ASC.SocketIO("/voip")),t},get counters(){return i||(i=new ASC.SocketIO("/counters")),i},get files(){return r||(r=new ASC.SocketIO("/files")),r}}}();jq(document).ready(function(){ASC.SocketIO.init();ASC.SocketIO.Factory.counters.on("getNewMessagesCount",function(n){ASC.Controls.MailReader&&ASC.Controls.MailReader.setUnreadMailMessagesCount(n.ma)}).on("sendMailNotification",function(n){ASC.Mail.Utility._showSignalRMailNotification(n)}).on("updateFolders",function(n,t){window.serviceManager?(window.serviceManager.updateFolders(),t&&window.serviceManager.getAccounts()):ASC.Controls.MailReader&&ASC.Controls.MailReader.setUnreadMailMessagesCount(n)})});
(function(){function h(t){return typeof t=="string"&&(t=n.getElementById(t)),t}function t(n,t,r){if(i.addEventListener)n&&n.addEventListener(t,r,!1);else if(i.attachEvent){var u=function(){r.call(n,i.event)};n&&n.attachEvent("on"+t,u)}}function c(n,t){return n.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function l(n,t){c(n,t)||(n.className+=" "+t)}function f(n,t){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");n.className=n.className.replace(i," ")}function a(n){var t,u,i,f,e=r(n);return t=e.left,i=e.top,u=t+n.offsetWidth,f=i+n.offsetHeight,{left:t,right:u,top:i,bottom:f}}function v(t){var i,r,u;return!t.pageX&&t.clientX?(i=1,r=document.body,r.getBoundingClientRect&&(u=r.getBoundingClientRect(),i=(u.right-u.left)/r.clientWidth),{x:t.clientX/i+n.body.scrollLeft+n.documentElement.scrollLeft,y:t.clientY/i+n.body.scrollTop+n.documentElement.scrollTop}):{x:t.pageX,y:t.pageY}}function o(n){return n.replace(/.*(\/|\\)/,"")}function s(n){return/[.]/.exec(n)?/[^.]+$/.exec(n.toLowerCase()):""}var n=document,i=window,u=function(){var t=n.createElement("div");return function(n){t.innerHTML=n;var i=t.childNodes[0];return t.removeChild(i),i}}(),r,e;r=document.documentElement.getBoundingClientRect?function(n){var f=n.getBoundingClientRect(),e=n.ownerDocument,i=e.body,r=e.documentElement,o=r.clientTop||i.clientTop||0,s=r.clientLeft||i.clientLeft||0,t=1,u,h,c;return i.getBoundingClientRect&&(u=i.getBoundingClientRect(),t=(u.right-u.left)/i.clientWidth),t>1&&(o=0,s=0),h=f.top/t+(window.pageYOffset||r&&r.scrollTop/t||i.scrollTop/t)-o,c=f.left/t+(window.pageXOffset||r&&r.scrollLeft/t||i.scrollLeft/t)-s,{top:h,left:c}}:function(n){if(i.jQuery)return jQuery(n).offset();var t=0,r=0;do t+=n.offsetTop||0,r+=n.offsetLeft||0;while(n=n.offsetParent);return{left:r,top:t}};e=function(){var n=0;return function(){return"ValumsAjaxUpload"+n++}}();Ajax_upload=AjaxUpload=function(t,i){var r,u;t.jquery?t=t[0]:typeof t=="string"&&/^#.*/.test(t)&&(t=t.slice(1));t=h(t);this._input=null;this._button=t;this._disabled=!1;this._submitting=!1;this._justClicked=!1;this._parentDialog=n.body;this._isInPopup=!1;window.jQuery&&jQuery.ui&&jQuery.ui.dialog&&(r=jQuery(this._button).parents(".ui-dialog"),r.length&&(this._parentDialog=r[0]));this._settings={action:"upload.php",name:"userfile",id:null,title:"",data:{},autoSubmit:!0,responseType:!1,onChange:function(){},onSubmit:function(){},onComplete:function(){}};for(u in i)this._settings[u]=i[u];this._settings.parentDialog&&(this._parentDialog=this._settings.parentDialog);this._settings.isInPopup&&(this._isInPopup=this._settings.isInPopup);this._createInput();this._rerouteClicks()};AjaxUpload.prototype={setData:function(n){this._settings.data=n},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},destroy:function(){this._input&&(this._input.parentNode&&this._input.parentNode.removeChild(this._input),this._input=null)},_createInput:function(){var r=this,i=n.createElement("input"),u,f;i.setAttribute("type","file");i.setAttribute("name",this._settings.name);i.setAttribute("class","fileuploadinput"+(this._settings.name==="userfile"?"":this._settings.name));i.setAttribute("title",this._settings.title);this._settings.accept&&i.setAttribute("accept",this._settings.accept);u={position:"absolute",margin:"-5px 0 0 -175px",padding:0,width:"220px",height:"30px",fontSize:"14px",opacity:0,cursor:"pointer",display:"none",zIndex:2147483583};for(f in u)i.style[f]=u[f];i.style.opacity==="0"||(i.style.filter="alpha(opacity=0)");this._parentDialog.appendChild?this._parentDialog.appendChild(i):this._parentDialog.append(i);t(i,"change",function(){r.justClicked=!1;var n=o(this.value);r._settings.onChange.call(r,n,s(n))!=!1&&r._settings.autoSubmit&&r.submit()});/safari/i.test(navigator.userAgent)&&!window.chrome&&t(i,"click",function(){r.justClicked=!0;setTimeout(function(){r.justClicked=!1},3e3)});this._input=i},_rerouteClicks:function(){var i=this,u,e={top:0,left:0},o=!1;t(i._button,"mouseover",function(){i._input&&!o&&(o=!0,u=a(i._button),i._parentDialog!=n.body&&(i._isInPopup?(e.top=jq(i._button).offset().top-jq(i._button).position().top,e.left=jq(i._button).offset().left-jq(i._button).position().left):e=r(i._parentDialog)))});t(document,"mousemove",function(n){var t=i._input,r;if(!t||!o){!t||o||t.style.display=="none"||i.justClicked||(t.style.display="none");return}if(i._disabled){f(i._button,"hover");t.style.display="none";return}r=v(n);r.x>=u.left&&r.x<=u.right&&r.y>=u.top&&r.y<=u.bottom?(t.style.top=r.y-e.top+"px",t.style.left=r.x-e.left+"px",t.style.display="block",l(i._button,"hover")):(o=!1,i.justClicked||(t.style.display="none"),f(i._button,"hover"))})},_createIframe:function(){var i=e(),t=u('<iframe src="javascript:false;" name="'+i+'" />');return t.id=i,t.style.display="none",n.body.appendChild(t),t},submit:function(){var h=this,u=this._settings,f,i,r,e;this._input.value!==""&&(f=o(this._input.value),u.onSubmit.call(this,f,s(f))==!1?(n.body.removeChild(this._input),this._input=null,this._createInput()):(i=this._createIframe(),r=this._createForm(i),r.appendChild(this._input),r.submit(),n.body.removeChild(r),r=null,this._input=null,this._createInput(),e=!1,t(i,"load",function(){var t,r;if(i.src=="javascript:'%3Chtml%3E%3C/html%3E';"||i.src=="javascript:'<html><\/html>';"){e&&setTimeout(function(){n.body.removeChild(i)},0);return}(t=i.contentDocument?i.contentDocument:frames[i.id].document,t.readyState&&t.readyState!="complete")||t.body&&t.body.innerHTML=="false"||t.body&&t.body.innerHTML==""||(t.XMLDocument?r=t.XMLDocument:t.body?(r=t.body.innerHTML,u.responseType&&u.responseType.toLowerCase()=="json"&&(t.body.firstChild&&t.body.firstChild.nodeName.toUpperCase()=="PRE"&&(r=t.body.firstChild.firstChild.nodeValue),r=r?window.eval("("+r+")"):{})):r=t,u.onComplete.call(h,f,r),e=!0,i.src="javascript:'<html><\/html>';")})))},_createForm:function(t){var f=this._settings,i=u('<form method="post" enctype="multipart/form-data"><\/form>'),e,r;i.style.display="none";i.action=f.action;i.target=t.name;n.body.appendChild(i);for(e in f.data)r=n.createElement("input"),r.type="hidden",r.name=e,r.value=f.data[e],i.appendChild(r);return i}}})();
(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery","jquery-ui/ui/widget"],n):typeof exports=="object"?n(require("jquery"),require("./vendor/jquery.ui.widget")):n(window.jQuery)})(function(n){"use strict";function t(t){var i=t==="dragover";return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var u=r.dataTransfer;u&&n.inArray("Files",u.types)!==-1&&this._trigger(t,n.Event(t,{delegatedEvent:r}))!==!1&&(r.preventDefault(),i&&(u.dropEffect="copy"))}}n.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||n('<input type="file"/>').prop("disabled"));n.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);n.support.xhrFormDataFileUpload=!!window.FormData;n.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);n.widget("blueimp.fileupload",{options:{dropZone:n(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&n.each(i,function(n,i){t=t.replace("{"+n+"}",i)}),t},formData:function(n){return n.serializeArray()},add:function(t,i){if(t.isDefaultPrevented())return!1;(i.autoUpload||i.autoUpload!==!1&&n(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:n.support.blobSlice&&function(){var n=this.slice||this.webkitSlice||this.mozSlice;return n.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.loaded=0;this.bitrate=0;this.getBitrate=function(n,t,i){var r=n-this.timestamp;return(!this.bitrate||!i||r>i)&&(this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=n),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&n.support.xhrFileUpload||n.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return n.type(t.formData)==="function"?t.formData(t.form):n.isArray(t.formData)?t.formData:n.type(t.formData)==="object"?(i=[],n.each(t.formData,function(n,t){i.push({name:n,value:t})}),i):[]},_getTotal:function(t){var i=0;return n.each(t,function(n,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?n.extend(t._progress,i):t._progress=i},_initResponseObject:function(n){var t;if(n._response)for(t in n._response)n._response.hasOwnProperty(t)&&delete n._response[t];else n._response={}},_onProgress:function(t,i){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),u;if(i._time&&i.progressInterval&&r-i._time<i.progressInterval&&t.loaded!==t.total)return;i._time=r;u=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0);this._progress.loaded+=u-i._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,i.bitrateInterval);i._progress.loaded=i.loaded=u;i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(r,u,i.bitrateInterval);this._trigger("progress",n.Event("progress",{delegatedEvent:t}),i);this._trigger("progressall",n.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var r=this,i=t.xhr?t.xhr():n.ajaxSettings.xhr();i.upload&&(n(i.upload).bind("progress",function(n){var i=n.originalEvent;n.lengthComputable=i.lengthComputable;n.loaded=i.loaded;n.total=i.total;r._onProgress(n,t)}),t.xhr=function(){return i})},_isInstanceOf:function(n,t){return Object.prototype.toString.call(t)==="[object "+n+"]"},_initXHRData:function(t){var f=this,i,r=t.files[0],e=t.multipart||!n.support.xhrFileUpload,u=n.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=n.extend({},t.headers);t.contentRange&&(t.headers["Content-Range"]=t.contentRange);e&&!t.blob&&this._isInstanceOf("File",r)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.uploadName||r.name)+'"');e?n.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:u,value:t.blob}):n.each(t.files,function(r,f){i.push({name:n.type(t.paramName)==="array"&&t.paramName[r]||u,value:f})})):(f._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,n.each(this._getFormData(t),function(n,t){i.append(t.name,t.value)})),t.blob?i.append(u,t.blob,r.uploadName||r.name):n.each(t.files,function(r,e){(f._isInstanceOf("File",e)||f._isInstanceOf("Blob",e))&&i.append(n.type(t.paramName)==="array"&&t.paramName[r]||u,e,e.uploadName||e.name)})),t.data=i):(t.contentType=r.type||"application/octet-stream",t.data=t.blob||r);t.blob=null},_initIframeSettings:function(t){var i=n("<a><\/a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||"");t.formData=this._getFormData(t);t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(n){this._isXHRUpload(n)?(this._chunkedUpload(n,!0)||(n.data||this._initXHRData(n),this._initProgressListener(n)),n.postMessage&&(n.dataType="postmessage "+(n.dataType||""))):this._initIframeSettings(n)},_getParamName:function(t){var r=n(t.fileInput),i=t.paramName;return i?n.isArray(i)||(i=[i]):(i=[],r.each(function(){for(var t=n(this),u=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)i.push(u),r-=1}),i.length||(i=[r.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=n(t.fileInput.prop("form")),t.form.length||(t.form=n(this.options.fileInput.prop("form"))));t.paramName=this._getParamName(t);t.url||(t.url=t.form.prop("action")||location.href);t.type=(t.type||n.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase();t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST");t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=n.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(n){return n.state?n.state():n.isResolved()?"resolved":n.isRejected()?"rejected":"pending"},_enhancePromise:function(n){return n.success=n.done,n.error=n.fail,n.complete=n.always,n},_getXHRPromise:function(t,i,r){var u=n.Deferred(),f=u.promise();return i=i||this.options.context||f,t===!0?u.resolveWith(i,r):t===!1&&u.rejectWith(i,r),f.abort=u.promise,this._enhancePromise(f)},_addConvenienceMethods:function(t,i){var r=this,u=function(t){return n.Deferred().resolveWith(r,t).promise()};i.process=function(t,f){return(t||f)&&(i._processQueue=this._processQueue=(this._processQueue||u([this])).then(function(){return i.errorThrown?n.Deferred().rejectWith(r,[i]).promise():u(arguments)}).then(t,f)),this._processQueue||u([this])};i.submit=function(){return this.state()!=="pending"&&(i.jqXHR=this.jqXHR=r._trigger("submit",n.Event("submit",{delegatedEvent:t}),this)!==!1&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()};i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))};i.state=function(){return this.jqXHR?r._getDeferredState(this.jqXHR):this._processQueue?r._getDeferredState(this._processQueue):void 0};i.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"};i.progress=function(){return this._progress};i.response=function(){return this._response}},_getUploadedBytes:function(n){var i=n.getResponseHeader("Range"),t=i&&i.split("-"),r=t&&t.length>1&&parseInt(t[1],10);return r&&r+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var u=this,e=t.files[0],o=e.size,r=t.uploadedBytes,f=t.maxChunkSize||o,l=this._blobSlice,s=n.Deferred(),h=s.promise(),a,c;return!(this._isXHRUpload(t)&&l&&(r||(n.type(f)==="function"?f(t):f)<o))||t.data?!1:i?!0:r>=o?(e.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",e.error])):(c=function(){var i=n.extend({},t),h=i._progress.loaded;i.blob=l.call(e,r,r+(n.type(f)==="function"?f(i):f),e.type);i.chunkSize=i.blob.size;i.contentRange="bytes "+r+"-"+(r+i.chunkSize-1)+"/"+o;u._initXHRData(i);u._initProgressListener(i);a=(u._trigger("chunksend",null,i)!==!1&&n.ajax(i)||u._getXHRPromise(!1,i.context)).done(function(f,e,l){r=u._getUploadedBytes(l)||r+i.chunkSize;h+i.chunkSize-i._progress.loaded&&u._onProgress(n.Event("progress",{lengthComputable:!0,loaded:r-i.uploadedBytes,total:r-i.uploadedBytes}),i);t.uploadedBytes=i.uploadedBytes=r;i.result=f;i.textStatus=e;i.jqXHR=l;u._trigger("chunkdone",null,i);u._trigger("chunkalways",null,i);r<o?c():s.resolveWith(i.context,[f,e,l])}).fail(function(n,t,r){i.jqXHR=n;i.textStatus=t;i.errorThrown=r;u._trigger("chunkfail",null,i);u._trigger("chunkalways",null,i);s.rejectWith(i.context,[n,t,r])})},this._enhancePromise(h),h.abort=function(){return a.abort()},c(),h)},_beforeSend:function(n,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(t);this._initProgressObject(t);t._progress.loaded=t.loaded=t.uploadedBytes||0;t._progress.total=t.total=this._getTotal(t.files)||1;t._progress.bitrate=t.bitrate=0;this._active+=1;this._progress.loaded+=t.loaded;this._progress.total+=t.total},_onDone:function(t,i,r,u){var f=u._progress.total,e=u._response;u._progress.loaded<f&&this._onProgress(n.Event("progress",{lengthComputable:!0,loaded:f,total:f}),u);e.result=u.result=t;e.textStatus=u.textStatus=i;e.jqXHR=u.jqXHR=r;this._trigger("done",null,u)},_onFail:function(n,t,i,r){var u=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total);u.jqXHR=r.jqXHR=n;u.textStatus=r.textStatus=t;u.errorThrown=r.errorThrown=i;this._trigger("fail",null,r)},_onAlways:function(n,t,i,r){this._trigger("always",null,r)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var r=this,f,s,e,h,u=r._getAJAXSettings(i),o=function(){return r._sending+=1,u._bitrateTimer=new r._BitrateTimer,f=f||((s||r._trigger("send",n.Event("send",{delegatedEvent:t}),u)===!1)&&r._getXHRPromise(!1,u.context,s)||r._chunkedUpload(u)||n.ajax(u)).done(function(n,t,i){r._onDone(n,t,i,u)}).fail(function(n,t,i){r._onFail(n,t,i,u)}).always(function(n,t,i){if(r._onAlways(n,t,i,u),r._sending-=1,r._active-=1,u.limitConcurrentUploads&&u.limitConcurrentUploads>r._sending)for(var f=r._slots.shift();f;){if(r._getDeferredState(f)==="pending"){f.resolve();break}f=r._slots.shift()}r._active===0&&r._trigger("stop")})};return(this._beforeSend(t,u),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)?(this.options.limitConcurrentUploads>1?(e=n.Deferred(),this._slots.push(e),h=e.then(o)):(this._sequence=this._sequence.then(o,o),h=this._sequence),h.abort=function(){return(s=[undefined,"abort","abort"],!f)?(e&&e.rejectWith(u.context,s),o()):f.abort()},this._enhancePromise(h)):o()},_onAdd:function(t,i){var a=this,p=!0,f=n.extend({},this.options,i),u=i.files,v=u.length,o=f.limitMultiFileUploads,c=f.limitMultiFileUploadSize,b=f.limitMultiFileUploadSizeOverhead,w=0,l=this._getParamName(f),s,e,h,r,y=0;if(!v)return!1;if(c&&u[0].size===undefined&&(c=undefined),(f.singleFileUploads||o||c)&&this._isXHRUpload(f))if(f.singleFileUploads||c||!o)if(!f.singleFileUploads&&c)for(h=[],s=[],r=0;r<v;r=r+1)w+=u[r].size+b,(r+1===v||w+u[r+1].size+b>c||o&&r+1-y>=o)&&(h.push(u.slice(y,r+1)),e=l.slice(y,r+1),e.length||(e=l),s.push(e),y=r+1,w=0);else s=l;else for(h=[],s=[],r=0;r<v;r+=o)h.push(u.slice(r,r+o)),e=l.slice(r,r+o),e.length||(e=l),s.push(e);else h=[u],s=[l];return i.originalFiles=u,n.each(h||u,function(r,u){var f=n.extend({},i);return f.files=h?u:[u],f.paramName=s[r],a._initResponseObject(f),a._initProgressObject(f),a._addConvenienceMethods(t,f),p=a._trigger("add",n.Event("add",{delegatedEvent:t}),f)}),p},_replaceFileInput:function(t){var i=t.fileInput,r=i.clone(!0),u=i.is(document.activeElement);t.fileInputClone=r;n("<form><\/form>").append(r)[0].reset();i.after(r).detach();u&&r.focus();n.cleanData(i.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(n,t){return t===i[0]?r[0]:t});i[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(t,i){var s=this,r=n.Deferred(),u=[],e,f=function(n){n&&!n.entry&&(n.entry=t);r.resolve([n])},h=function(n){s._handleFileTreeEntries(n,i+t.name+"/").done(function(n){r.resolve(n)}).fail(f)},o=function(){e.readEntries(function(n){n.length?(u=u.concat(n),o()):h(u)},f)};return i=i||"",t.isFile?t._file?(t._file.relativePath=i,r.resolve(t._file)):t.file(function(n){n.relativePath=i;r.resolve(n)},f):t.isDirectory?(e=t.createReader(),o()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,i){var r=this;return n.when.apply(n,n.map(t,function(n){return r._handleFileTreeEntry(n,i)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(n.map(i,function(n){var t;return n.webkitGetAsEntry?(t=n.webkitGetAsEntry(),t&&(t._file=n.getAsFile()),t):n.getAsEntry()})):n.Deferred().resolve(n.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=n(t);var r=t.prop("webkitEntries")||t.prop("entries"),i,u;if(r&&r.length)return this._handleFileTreeEntries(r);if(i=n.makeArray(t.prop("files")),i.length)i[0].name===undefined&&i[0].fileName&&n.each(i,function(n,t){t.name=t.fileName;t.size=t.fileSize});else{if(u=t.prop("value"),!u)return n.Deferred().resolve([]).promise();i=[{name:u.replace(/^.*\\/,"")}]}return n.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return!(t instanceof n)||t.length===1?this._getSingleFileInputFiles(t):n.when.apply(n,n.map(t,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(t){var r=this,i={fileInput:n(t.target),form:n(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(u){i.files=u;r.options.replaceFileInput&&r._replaceFileInput(i);r._trigger("change",n.Event("change",{delegatedEvent:t}),i)!==!1&&r._onAdd(t,i)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};i&&i.length&&(n.each(i,function(n,t){var i=t.getAsFile&&t.getAsFile();i&&r.files.push(i)}),this._trigger("paste",n.Event("paste",{delegatedEvent:t}),r)!==!1&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var u=this,i=t.dataTransfer,r={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){r.files=i;u._trigger("drop",n.Event("drop",{delegatedEvent:t}),r)!==!1&&u._onAdd(t,r)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste}));n.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(t,i){var r=n.inArray(t,this._specialOptions)!==-1;r&&this._destroyEventHandlers();this._super(t,i);r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof n||(t.fileInput=n(t.fileInput));t.dropZone instanceof n||(t.dropZone=n(t.dropZone));t.pasteZone instanceof n||(t.pasteZone=n(t.pasteZone))},_getRegExp:function(n){var t=n.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return t!=="url"&&n.type(i)==="string"&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options,r=this.element.data();n.each(this.element[0].attributes,function(n,u){var f=u.name.toLowerCase(),e;/^data-/.test(f)&&(f=f.slice(5).replace(/-[a-z]/g,function(n){return n.charAt(1).toUpperCase()}),e=r[f],t._isRegExpOption(f,e)&&(e=t._getRegExp(e)),i[f]=e)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(n){t.files=n;i._onAdd(null,t)}):(t.files=n.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var e=this,i=n.Deferred(),u=i.promise(),r,f;return u.abort=function(){return(f=!0,r)?r.abort():(i.reject(null,"abort","abort"),u)},this._getFileInputFiles(t.fileInput).always(function(n){if(!f){if(!n.length){i.reject();return}t.files=n;r=e._onSend(null,t);r.then(function(n,t,r){i.resolve(n,t,r)},function(n,t,r){i.reject(n,t,r)})}}),this._enhancePromise(u)}if(t.files=n.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});
var FileUploadManager=new function(){var n=null,r=!1,f="draggable"in document.createElement("span"),t=[],i={QUEUED:0,STARTED:1,STOPED:2,DONE:3,FAILED:4};this.renderedItemTemplate="asc_html_itemTemplate_uploader";this.renderedProgressTemplate="asc_html_progressTemplate_uploader";this.uploadedFiles=[];this.Init=function(t){t.Events=t.Events||{};n=t;r=!n.UploadButton;h();c(jq("#"+n.BrowseButton));var i=jq("#fileupload").fileupload({url:l(),autoUpload:!1,singleFileUploads:!0,sequentialUploads:!0,progressInterval:1e3,dropZone:f?jq("#"+n.DropZone):null});a(i)};this.StartUpload=function(){for(var n=0;n<t.length;n++)t[n].files[0].status==i.QUEUED&&t[n].submit()};this.RemoveFile=function(n){for(var i=0;i<t.length;i++)if(t[i].files[0].id==n){t[i].abort();break}i!=t.length&&t.splice(i,1)};this.DisableBrowseBtn=function(n){jq("#fileupload").prop("disabled",n)};this.GetFiles=function(){return jq.map(t,function(n){return n.files[0]})};this.ClearFiles=function(){t.clear();FileUploadManager.uploadedFiles.clear()};this._uploadStart=function(){jq(n.OverAllProcessHolder).show()};this._uploadAdd=function(n,f){f.id=s();var e=f.files[0];e.id=s();e.percent=0;e.loaded=0;p(e)&&(e.status=i.QUEUED,t.push(f),u(e,null),r&&(jq("#fu_item_loading_{0}".format(e.id)).show(),jq("#fu_item_delete_{0}".format(e.id)).hide(),f.submit()))};this._uploadSubmit=function(n,t){var r=t.files[0];r.status==i.QUEUED&&(r.status=i.STARTED)};this._uploadSend=function(n,t){var r=t.files[0];return r.status==i.STARTED};this._uploadDone=function(n,t){var f=t.files[0],r;f.percent=100;f.loaded=f.size;f.status=i.DONE;r=JSON.parse(t.result);r.Data&&FileUploadManager.uploadedFiles.push({fileName:r.Data.FileName,size:r.Data.Size,offsetPhysicalPath:r.Data.OffsetPhysicalPath,contentType:r.Data.ContentType});u(f,r)};this._uploadProgress=function(r,f){var e=f.files[0],o,s,h;e.percent=parseInt(f.loaded/f.total*100,10);e.loaded=f.loaded;u(e,null);o=0;s=0;jq.each(t,function(n,t){var r=t.files[0];r.status!=i.STOPED&&r.status!=i.FAILED&&(o+=r.size,s+=r.loaded)});h=parseInt(s/o*100,10);n.OverAllProcessHolder!=null&&(jq("div."+n.OverAllProcessBarCssClass+" div").css("width",h+"%"),jq("td.fu_percent").text(h+"%"),jq(n.OverAllProcessHolder).show())};this._uploadStop=function(){jq("div."+n.OverAllProcessBarCssClass+" div").css("width","100%");jq("td.fu_percent").text("100%")};this._uploadFail=function(n,t){var r=t.files[0];r.percent=0;r.loaded=0;r.status=i.FAILED;t.errorThrown!="abort"&&u(r,null)};this._dragEnter=function(){return!1};this._dragLeave=function(){return o()};this._dragOver=function(){return(f&&w(),jQuery.browser.safari)?!0:!1};this._drop=function(){return o(),!1};var h=function(){var t,i;r&&jq("#"+n.UploadButton).hide();t=n.ItemTemplate||'<div id="fu_item_${id}" class="fu_item"><table cellspacing="0" cellpadding="0" style="width:100%;border-bottom:1px solid #D1D1D1;"><tr style="height:40px !important;" valign="middle"><td style="width:70%; padding-left:10px;"><div class="name ${fileNameCss}" style="padding-right:5px;" title="${fileName}" >${fileName}<input type="hidden" id="fu_itemName_hidden_{id}" value="{id}"/><div class="${descriptionCss}">${descriptionText}<\/div><\/div><\/td><td class="size" style="padding-left: 10px; width:20%; {{if exceedLimit}}color: red;{{else}}color: #83888D;{{/if}}"><div>${fileSize}&nbsp;<\/div><\/td><td style="width:10%;">&nbsp;<a id="fu_item_loading_${id}" class="${loadingCss}" style="display:none;"><\/a><a id="fu_item_complete_${id}" class="${completeCss}" style="display:none;"><\/a><a id="fu_item_delete_${id}" class="fu_item_delete ${deleteCss}" href="#"><\/a><\/td><\/tr><\/table><div class="studioFileUploaderProgressBar" style="margin-top:-41px; float:left; width:${progressBarWidth};height:40px;" ><\/div><\/div>';jQuery.template(FileUploadManager.renderedItemTemplate,t);i=n.ProgressTemplate||"<table cellpadding='5' cellspacing='0' width='100%' style='padding:10px 0;' class='describe-text'><tr><td width='100'>${overallProgressText}<\/td><td><div style=\"margin-top: 1px;\" class=\"${overAllProcessBarCssClass}\"><div><\/div><\/div><\/td><td class='fu_percent' width='20'><\/td><\/tr><\/table>";jQuery.template(FileUploadManager.renderedProgressTemplate,i);n.OverAllProcessHolder&&(jq(n.OverAllProcessHolder).html(""),jq(n.OverAllProcessHolder).append(jq.tmpl(FileUploadManager.renderedProgressTemplate,{overallProgressText:n.OverallProgressText,overAllProcessBarCssClass:n.OverAllProcessBarCssClass})),jq("div."+n.OverAllProcessBarCssClass+" div").css("width","0%"),jq("td.fu_percent").text("0%"))},c=function(n){var t=jq("<input/>").attr("id","fileupload").attr("type","file").attr("multiple","multiple").css("width","0").css("height","0").hide();t.appendTo(n.parent());n.on("click",function(n){n.preventDefault();jq("#fileupload").trigger("click")})},l=function(){var t="UploadProgress.ashx?submit="+n.FileUploadHandler,i=n.Data;for(var r in i)t+="&{0}={1}".format(r,i[r]);return t},a=function(t){t.on("fileuploadstart",function(){n.Events.OnPreUploadStart&&n.Events.OnPreUploadStart();n.Events.OnUploadStart?n.Events.OnUploadStart():FileUploadManager._uploadStart()}).on("fileuploadadd",n.Events.OnUploadAdd?n.Events.OnUploadAdd:FileUploadManager._uploadAdd).on("fileuploadsubmit",n.Events.OnUploadSubmit?n.Events.OnUploadSubmit:FileUploadManager._uploadSubmit).on("fileuploadsend",n.Events.OnUploadSend?n.Events.OnUploadSend:FileUploadManager._uploadSend).on("fileuploadprogress",n.Events.OnUploadProgress?n.Events.OnUploadProgress:FileUploadManager._uploadProgress).on("fileuploaddone",n.Events.OnUploadDone?n.Events.OnUploadDone:FileUploadManager._uploadDone).on("fileuploadfail",n.Events.OnUploadFail?n.Events.OnUploadFail:FileUploadManager._uploadFail).on("fileuploadstop",function(){n.Events.OnUploadStop?n.Events.OnUploadStop():FileUploadManager._uploadStop();n.Events.OnPostUploadStop&&n.Events.OnPostUploadStop()});if(f&&n.DropZone)jq("#"+n.DropZone).on("dragenter",FileUploadManager._dragEnter).on("dragleave",FileUploadManager._dragLeave).on("dragover",FileUploadManager._dragOver).on("drop",FileUploadManager._drop);jq(document).on("click","#"+n.TargetContainerID+" .fu_item_delete",function(t){var i=this.id.replace("fu_item_delete_","");return jq("#fu_item_"+i).remove(),FileUploadManager.RemoveFile(i),n.Events.OnFileRemove&&n.Events.OnFileRemove(t,v(i)),!1});if(!r)jq("#"+n.UploadButton).on("click",function(n){FileUploadManager.StartUpload();n.preventDefault()})},v=function(n){for(var i=0;i<t.length;i++)if(t[i].files[0].id==n)return t[i].files[0];return null},s=function(){var n=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},y=function(n){if(typeof n=="undefined"||n==null)return"";n=n.trim();var t=n.lastIndexOf(".");return 0<=t?n.substring(t).trim().toLowerCase():""},p=function(t){var i=y(t.name);return n.UploadableExts&&jq.inArray(i,n.UploadableExts)==-1?(e(n.NotSupportedFormatErrorMsg||"Sorry, this file format isn't supported",!0),!1):t.size<=0?(e(n.EmptyFileErrorMsg||"Empty file",!0),!1):t.size>n.MaxSize?(e(n.FileSizeErrorMsg||"The maximum file size is exceeded",!0),!1):!0},e=function(n,t){n&&(t?toastr.error(n):toastr.success(n))},o=function(){n.DropZone!=null&&jq("#"+n.DropZone).css(n.HideDragHighlightStyle==null?{"border-style":"solid","border-color":"#d1d1d1","background-color":"#FFF"}:n.HideDragHighlightStyle)},w=function(){n.DropZone!=null&&jq("#"+n.DropZone).css(n.ShowDragHighlightStyle==null?{"border-style":"dashed","border-color":"#98BCA1","background-color":"#E0FFE0"}:n.ShowDragHighlightStyle)},u=function(t,r){var u={id:t.id,fileName:t.name,fileNameCss:"",returnCode:t.status,progressBarCss:"",descriptionCss:"studioFileUploaderDescription",deleteCss:n.DeleteLinkCSSClass||"linkAction",loadingImageCss:n.LoadingImageCSSClass||"",completeCss:n.CompleteCSSClass||"",descriptionText:"",exceedLimit:t.size>=n.MaxSize,fileSize:t.size,progressBarWidth:t.percent+"%",status:t.status,serverData:r},f,e;jQuery.browser.safari&&o();f=1048576;e=1024;u.fileSize=u.fileSize<=f?(u.fileSize/e).toFixed(2)+" KB":(u.fileSize/f).toFixed(2)+" MB";n.OnPrepareRenderData&&n.OnPrepareRenderData(u);jq("#fu_item_"+u.id).length!=0?n.Events.OnRenderItemInUploadingProcess!=null?n.Events.OnRenderItemInUploadingProcess(u):jq("#fu_item_"+u.id).replaceWith(jq.tmpl(FileUploadManager.renderedItemTemplate,u)):jq("#"+n.TargetContainerID).append(jq.tmpl(FileUploadManager.renderedItemTemplate,u));u.status==i.STARTED&&(jq("#fu_item_delete_{0}".format(u.id)).hide(),jq("#fu_item_loading_{0}".format(u.id)).show(),jq("#fu_item_{0} div.studioFileUploaderProgressBar".format(u.id)).width(u.progressBarWidth).css("background-color","#C2DFED"));u.status==i.DONE&&(jq("#fu_item_loading_{0}".format(u.id)).hide(),u.serverData&&u.serverData.Success?(jq("#fu_item_complete_{0}".format(u.id)).show(),n.DeleteAfterUpload?jq("#fu_item_delete_{0}".format(u.id)).show():jq("#fu_item_delete_{0}".format(u.id)).hide(),n.TransferCompleteSuccessCssStyle!=null?jq("#fu_item_{0} div.studioFileUploaderProgressBar".format(u.id)).css(n.TransferCompleteSuccessCssStyle):jq("#fu_item_{0} div.studioFileUploaderProgressBar".format(u.id)).width("100%").css("background-color","#EDF6FD")):n.TransferCompleteFailureCssStyle!=null?jq("#fu_item_{0} div.studioFileUploaderProgressBar".format(u.id)).css(n.TransferCompleteFailureCssStyle):jq("#fu_item_{0} div.studioFileUploaderProgressBar".format(u.id)).width("100%").css("background-color","#FFE4C4"));u.status==i.FAILED&&jq("#fu_item_{0} div.studioFileUploaderProgressBar".format(u.id)).width("100%").css("background-color","#FFE4C4");jq("#"+n.TargetContainerID).scrollTo("#fu_item_"+u.id)}};
/* @preserve
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013-2015 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */
!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self);t.Promise=n()}}(function(){return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof _dereq_&&_dereq_,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof _dereq_&&_dereq_,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){"use strict";t.exports=function(n){function t(n){var t=new i(n),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var i=n._SomePromiseArray;n.any=function(n){return t(n)};n.prototype.any=function(){return t(this)}}},{}],2:[function(n,t){"use strict";function i(){this._customScheduler=!1;this._isTickUsed=!1;this._lateQueue=new o(16);this._normalQueue=new o(16);this._haveDrainedQueues=!1;this._trampolineEnabled=!0;var n=this;this.drainQueues=function(){n._drainQueues()};this._schedule=c}function r(n,t,i){this._lateQueue.push(n,t,i);this._queueTick()}function u(n,t,i){this._normalQueue.push(n,t,i);this._queueTick()}function f(n){this._normalQueue._pushOne(n);this._queueTick()}var e;try{throw new Error;}catch(h){e=h}var c=n("./schedule"),o=n("./queue"),s=n("./util");i.prototype.setScheduler=function(n){var t=this._schedule;return this._schedule=n,this._customScheduler=!0,t};i.prototype.hasCustomScheduler=function(){return this._customScheduler};i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0};i.prototype.disableTrampolineIfNecessary=function(){s.hasDevTools&&(this._trampolineEnabled=!1)};i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues};i.prototype.fatalError=function(n,t){t?(process.stderr.write("Fatal "+(n instanceof Error?n.stack:n)+"\n"),process.exit(2)):this.throwLater(n)};i.prototype.throwLater=function(n,t){if(1===arguments.length&&(t=n,n=function(){throw t;}),"undefined"!=typeof setTimeout)setTimeout(function(){n(t)},0);else try{this._schedule(function(){n(t)})}catch(i){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n");}};s.hasDevTools?(i.prototype.invokeLater=function(n,t,i){this._trampolineEnabled?r.call(this,n,t,i):this._schedule(function(){setTimeout(function(){n.call(t,i)},100)})},i.prototype.invoke=function(n,t,i){this._trampolineEnabled?u.call(this,n,t,i):this._schedule(function(){n.call(t,i)})},i.prototype.settlePromises=function(n){this._trampolineEnabled?f.call(this,n):this._schedule(function(){n._settlePromises()})}):(i.prototype.invokeLater=r,i.prototype.invoke=u,i.prototype.settlePromises=f);i.prototype.invokeFirst=function(n,t,i){this._normalQueue.unshift(n,t,i);this._queueTick()};i.prototype._drainQueue=function(n){for(var t,i,r;n.length()>0;)t=n.shift(),"function"==typeof t?(i=n.shift(),r=n.shift(),t.call(i,r)):t._settlePromises()};i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue);this._reset();this._haveDrainedQueues=!0;this._drainQueue(this._lateQueue)};i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))};i.prototype._reset=function(){this._isTickUsed=!1};t.exports=i;t.exports.firstLineError=e},{"./queue":26,"./schedule":29,"./util":36}],3:[function(n,t){"use strict";t.exports=function(n,t,i,r){var u=!1,f=function(n,t){this._reject(t)},e=function(n,t){t.promiseRejectionQueued=!0;t.bindingPromise._then(f,f,null,this,n)},o=function(n,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},s=function(n,t){t.promiseRejectionQueued||this._reject(n)};n.prototype.bind=function(f){var c,h,l,a;return u||(u=!0,n.prototype._propagateFrom=r.propagateFromFunction(),n.prototype._boundValue=r.boundValueFunction()),c=i(f),h=new n(t),h._propagateFrom(this,1),l=this._target(),(h._setBoundTo(c),c instanceof n)?(a={promiseRejectionQueued:!1,promise:h,target:l,bindingPromise:c},l._then(t,e,void 0,h,a),c._then(o,s,void 0,h,a),h._setOnCancel(c)):h._resolveCallback(l),h};n.prototype._setBoundTo=function(n){void 0!==n?(this._bitField=2097152|this._bitField,this._boundTo=n):this._bitField=-2097153&this._bitField};n.prototype._isBound=function(){return 2097152==(2097152&this._bitField)};n.bind=function(t,i){return n.resolve(i).bind(t)}}},{}],4:[function(n,t){"use strict";function u(){try{Promise===i&&(Promise=r)}catch(n){}return i}var r,i;"undefined"!=typeof Promise&&(r=Promise);i=n("./promise")();i.noConflict=u;t.exports=i},{"./promise":22}],5:[function(n,t){"use strict";var i=Object.create,r,u;i&&(r=i(null),u=i(null),r[" size"]=u[" size"]=0);t.exports=function(t){function u(n,r){var u,f;if(null!=n&&(u=n[r]),"function"!=typeof u){f="Object "+i.classString(n)+" has no method '"+i.toString(r)+"'";throw new t.TypeError(f);}return u}function f(n){var t=this.pop(),i=u(n,t);return i.apply(n,this)}function r(n){return n[this]}function e(n){var t=+this;return 0>t&&(t=Math.max(0,t+n.length)),n[t]}var o,i=n("./util"),s=i.canEvaluate;i.isIdentifier;t.prototype.call=function(n){var t=[].slice.call(arguments,1);return t.push(n),this._then(f,void 0,void 0,t,void 0)};t.prototype.get=function(n){var t,u="number"==typeof n,i;return u?t=e:s?(i=o(n),t=null!==i?i:r):t=r,this._then(t,void 0,void 0,n,void 0)}}},{"./util":36}],6:[function(n,t){"use strict";t.exports=function(t,i,r,u){var f=n("./util"),o=f.tryCatch,s=f.errorObj,e=t._async;t.prototype["break"]=t.prototype.cancel=function(){var n,t,i;if(!u.cancellation())return this._warn("cancellation is disabled");for(n=this,t=n;n.isCancellable();){if(!n._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}if(i=n._cancellationParent,null==i||!i.isCancellable()){n._isFollowing()?n._followee().cancel():n._cancelBranched();break}n._isFollowing()&&n._followee().cancel();t=n;n=i}};t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--};t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0};t.prototype._cancelBy=function(n){return n===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),this._enoughBranchesHaveCancelled()?(this._invokeOnCancel(),!0):!1)};t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()};t.prototype._cancel=function(){this.isCancellable()&&(this._setCancelled(),e.invoke(this._cancelPromises,this,void 0))};t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()};t.prototype._unsetOnCancel=function(){this._onCancelField=void 0};t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()};t.prototype._doInvokeOnCancel=function(n,t){var i,r;if(f.isArray(n))for(i=0;i<n.length;++i)this._doInvokeOnCancel(n[i],t);else void 0!==n&&("function"==typeof n?t||(r=o(n).call(this._boundValue()),r===s&&(this._attachExtraTrace(r.e),e.throwLater(r.e))):n._resultCancelled(this))};t.prototype._invokeOnCancel=function(){var n=this._onCancel();this._unsetOnCancel();e.invoke(this._doInvokeOnCancel,this,n)};t.prototype._invokeInternalOnCancel=function(){this.isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())};t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(n,t){"use strict";t.exports=function(t){function u(n,u,o){return function(s){var c=o._boundValue(),l,h,a,y,v,p;n:for(l=0;l<n.length;++l)if(h=n[l],h===Error||null!=h&&h.prototype instanceof Error){if(s instanceof h)return i(u).call(c,s)}else if("function"==typeof h){if(a=i(h).call(c,s),a===e)return a;if(a)return i(u).call(c,s)}else if(r.isObject(s)){for(y=f(h),v=0;v<y.length;++v)if(p=y[v],h[p]!=s[p])continue n;return i(u).call(c,s)}return t}}var r=n("./util"),f=n("./es5").keys,i=r.tryCatch,e=r.errorObj;return u}},{"./es5":13,"./util":36}],8:[function(n,t){"use strict";t.exports=function(n){function t(){this._trace=new t.CapturedTrace(u())}function f(){if(r)return new t}function u(){var n=i.length-1;if(n>=0)return i[n]}var r=!1,i=[];return n.prototype._promiseCreated=function(){},n.prototype._pushContext=function(){},n.prototype._popContext=function(){return null},n._peekContext=n.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var n=i.pop(),t=n._promiseCreated;return n._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=f,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var i=n.prototype._pushContext,f=n.prototype._popContext,e=n._peekContext,o=n.prototype._peekContext,s=n.prototype._promiseCreated;t.deactivateLongStackTraces=function(){n.prototype._pushContext=i;n.prototype._popContext=f;n._peekContext=e;n.prototype._peekContext=o;n.prototype._promiseCreated=s;r=!1};r=!0;n.prototype._pushContext=t.prototype._pushContext;n.prototype._popContext=t.prototype._popContext;n._peekContext=n.prototype._peekContext=u;n.prototype._promiseCreated=function(){var n=this._peekContext();n&&null==n._promiseCreated&&(n._promiseCreated=this)}},t}},{}],9:[function(n,t){"use strict";t.exports=function(t,i){function o(n,t){return{promise:t}}function g(){return!1}function pt(n,t,i){var u=this;try{n(t,i,function(n){if("function"!=typeof n)throw new TypeError("onCancel must be a function, got: "+r.toString(n));u._attachCancellationCallback(n)})}catch(f){return f}}function wt(n){if(!this.isCancellable())return this;var t=this._onCancel();void 0!==t?r.isArray(t)?t.push(n):this._setOnCancel([t,n]):this._setOnCancel(n)}function bt(){return this._onCancelField}function kt(n){this._onCancelField=n}function dt(){this._cancellationParent=void 0;this._onCancelField=void 0}function nt(n,t){if(0!=(1&t)){this._cancellationParent=n;var i=n._branchesRemainingToCancel;void 0===i&&(i=0);n._branchesRemainingToCancel=i+1}0!=(2&t)&&n._isBound()&&this._setBoundTo(n._boundTo)}function gt(n,t){0!=(2&t)&&n._isBound()&&this._setBoundTo(n._boundTo)}function ni(){var n=this._boundTo;return void 0!==n&&n instanceof t?n.isFulfilled()?n.value():void 0:n}function ti(){this._trace=new e(this._peekContext())}function ii(n,t){var i,u;ai(n)&&(i=this._trace,(void 0!==i&&t&&(i=i._parent),void 0!==i)?i.attachExtraTrace(n):n.__stackCleaned__||(u=v(n),r.notEnumerableProp(n,"stack",u.message+"\n"+u.stack.join("\n")),r.notEnumerableProp(n,"__stackCleaned__",!0)))}function ri(n,t,i,r,u){if(void 0===n&&null!==t&&w){if(void 0!==u&&u._returnedNonUndefined())return;if(0==(65535&r._bitField))return;i&&(i+=" ");var f="a promise was created in a "+i+"handler but was not returned from it";r._warn(f,!0,t)}}function ui(n,t){var i=n+" is deprecated and will be removed in a future version.";return t&&(i+=" Use "+t+" instead."),a(i)}function a(n,i,r){var o,f,e;u.warnings&&(f=new li(n),i?r._attachExtraTrace(f):u.longStackTraces&&(o=t._peekContext())?o.attachExtraTrace(f):(e=v(f),f.stack=e.message+"\n"+e.stack.join("\n")),l("warning",f)||it(f,"",!0))}function fi(n,t){for(var i=0;i<t.length-1;++i)t[i].push("From previous event:"),t[i]=t[i].join("\n");return i<t.length&&(t[i]=t[i].join("\n")),n+"\n"+t.join("\n")}function ei(n){for(var t=0;t<n.length;++t)(0===n[t].length||t+1<n.length&&n[t][0]===n[t+1][0])&&(n.splice(t,1),t--)}function oi(n){for(var t,o,i=n[0],r=1;r<n.length;++r){for(var u=n[r],f=i.length-1,s=i[f],e=-1,t=u.length-1;t>=0;--t)if(u[t]===s){e=t;break}for(t=e;t>=0;--t){if(o=u[t],i[f]!==o)break;i.pop();f--}i=u}}function tt(n){for(var r=[],i=0;i<n.length;++i){var t=n[i],u="    (No stack trace)"===t||h.test(t),f=u&&k(t);u&&!f&&(ht&&" "!==t.charAt(0)&&(t="    "+t),r.push(t))}return r}function si(n){for(var r,t=n.stack.replace(/\s+$/g,"").split("\n"),i=0;i<t.length;++i)if(r=t[i],"    (No stack trace)"===r||h.test(r))break;return i>0&&(t=t.slice(i)),t}function v(n){var t=n.stack,i=n.toString();return t="string"==typeof t&&t.length>0?si(n):["    (No stack trace)"],{message:i,stack:tt(t)}}function it(n,t,i){var u,f;"undefined"!=typeof console&&(r.isObject(n)?(f=n.stack,u=t+c(f,n)):u=t+String(n),"function"==typeof s?s(u,i):("function"==typeof console.log||"object"==typeof console.log)&&console.log(u))}function rt(n,t,i,r){var u=!1;try{"function"==typeof t&&(u=!0,"rejectionHandled"===n?t(r):t(i,r))}catch(e){f.throwLater(e)}"unhandledRejection"===n?l(n,i,r)||u||it(i,"Unhandled rejection "):l(n,r)}function ut(n){var t,i,u;if("function"==typeof n)t="[function "+(n.name||"anonymous")+"]";else{if(t=n&&"function"==typeof n.toString?n.toString():r.toString(n),i=/\[object [a-zA-Z0-9$_]+\]/,i.test(t))try{u=JSON.stringify(n);t=u}catch(f){}0===t.length&&(t="(empty array)")}return"(<"+hi(t)+">, no stack trace)"}function hi(n){var t=41;return n.length<t?n:n.substr(0,t-3)+"..."}function y(){return"function"==typeof d}function p(n){var t=n.match(pi);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function ci(n,t){var r,i;if(y()){for(var u,o,s=n.stack.split("\n"),h=t.stack.split("\n"),f=-1,e=-1,r=0;r<s.length;++r)if(i=p(s[r]),i){u=i.fileName;f=i.line;break}for(r=0;r<h.length;++r)if(i=p(h[r]),i){o=i.fileName;e=i.line;break}0>f||0>e||!u||!o||u!==o||f>=e||(k=function(n){if(st.test(n))return!0;var t=p(n);return t&&t.fileName===u&&f<=t.line&&t.line<=e?!0:!1})}}function e(n){this._parent=n;this._promisesCreated=0;var t=this._length=1+(void 0===n?0:n._length);d(this,e);t>32&&this.uncycle()}var ft,et,s,ot=t._getDomain,f=t._async,li=n("./errors").Warning,r=n("./util"),ai=r.canAttachTrace,st=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,h=null,c=null,ht=!1,ct=!(0==r.env("BLUEBIRD_DEBUG")||!r.env("BLUEBIRD_DEBUG")&&"development"!==r.env("NODE_ENV")),lt=!(0==r.env("BLUEBIRD_WARNINGS")||!ct&&!r.env("BLUEBIRD_WARNINGS")),vi=!(0==r.env("BLUEBIRD_LONG_STACK_TRACES")||!ct&&!r.env("BLUEBIRD_LONG_STACK_TRACES")),w=0!=r.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(lt||!!r.env("BLUEBIRD_W_FORGOTTEN_RETURN")),b,d,u;t.prototype.suppressUnhandledRejections=function(){var n=this._target();n._bitField=-1048577&n._bitField|524288};t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),f.invokeLater(this._notifyUnhandledRejection,this,void 0))};t.prototype._notifyUnhandledRejectionIsHandled=function(){rt("rejectionHandled",ft,void 0,this)};t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField};t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)};t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var n=this._settledValue();this._setUnhandledRejectionIsNotified();rt("unhandledRejection",et,n,this)}};t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField};t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField};t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0};t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField};t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField;this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())};t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0};t.prototype._warn=function(n,t,i){return a(n,t,i||this)};t.onPossiblyUnhandledRejection=function(n){var t=ot();et="function"==typeof n?null===t?n:t.bind(n):void 0};t.onUnhandledRejectionHandled=function(n){var t=ot();ft="function"==typeof n?null===t?n:t.bind(n):void 0};b=function(){};t.longStackTraces=function(){if(f.haveItemsQueued()&&!u.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!u.longStackTraces&&y()){var n=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;u.longStackTraces=!0;b=function(){if(f.haveItemsQueued()&&!u.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=n;t.prototype._attachExtraTrace=r;i.deactivateLongStackTraces();f.enableTrampoline();u.longStackTraces=!1};t.prototype._captureStackTrace=ti;t.prototype._attachExtraTrace=ii;i.activateLongStackTraces();f.disableTrampolineIfNecessary()}};t.hasLongStackTraces=function(){return u.longStackTraces&&y()};var at=function(){try{var n=document.createEvent("CustomEvent");return n.initCustomEvent("testingtheevent",!1,!0,{}),r.global.dispatchEvent(n),function(n,t){var i=document.createEvent("CustomEvent");return i.initCustomEvent(n.toLowerCase(),!1,!0,t),!r.global.dispatchEvent(i)}}catch(t){}return function(){return!1}}(),vt=function(){return r.isNode?function(){return process.emit.apply(process,arguments)}:r.global?function(n){var i="on"+n.toLowerCase(),t=r.global[i];return t?(t.apply(r.global,[].slice.call(arguments,1)),!0):!1}:function(){return!1}}(),yi={promiseCreated:o,promiseFulfilled:o,promiseRejected:o,promiseResolved:o,promiseCancelled:o,promiseChained:function(n,t,i){return{promise:t,child:i}},warning:function(n,t){return{warning:t}},unhandledRejection:function(n,t,i){return{reason:t,promise:i}},rejectionHandled:o},l=function(n){var i=!1,t;try{i=vt.apply(null,arguments)}catch(r){f.throwLater(r);i=!0}t=!1;try{t=at(n,yi[n].apply(null,arguments))}catch(r){f.throwLater(r);t=!0}return t||i};t.config=function(n){if(n=Object(n),"longStackTraces"in n&&(n.longStackTraces?t.longStackTraces():!n.longStackTraces&&t.hasLongStackTraces()&&b()),"warnings"in n){var i=n.warnings;u.warnings=!!i;w=u.warnings;r.isObject(i)&&"wForgottenReturn"in i&&(w=!!i.wForgottenReturn)}if("cancellation"in n&&n.cancellation&&!u.cancellation){if(f.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=dt;t.prototype._propagateFrom=nt;t.prototype._onCancel=bt;t.prototype._setOnCancel=kt;t.prototype._attachCancellationCallback=wt;t.prototype._execute=pt;yt=nt;u.cancellation=!0}"monitoring"in n&&(n.monitoring&&!u.monitoring?(u.monitoring=!0,t.prototype._fireEvent=l):!n.monitoring&&u.monitoring&&(u.monitoring=!1,t.prototype._fireEvent=g))};t.prototype._fireEvent=g;t.prototype._execute=function(n,t,i){try{n(t,i)}catch(r){return r}};t.prototype._onCancel=function(){};t.prototype._setOnCancel=function(){};t.prototype._attachCancellationCallback=function(){};t.prototype._captureStackTrace=function(){};t.prototype._attachExtraTrace=function(){};t.prototype._clearCancellationData=function(){};t.prototype._propagateFrom=function(){};var yt=gt,k=function(){return!1},pi=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;return r.inherits(e,Error),i.CapturedTrace=e,e.prototype.uncycle=function(){var u=this._length,s,n,c,i,r,h,e;if(!(2>u)){for(var t=[],o={},n=0,f=this;void 0!==f;++n)t.push(f),f=f._parent;for(u=this._length=n,n=u-1;n>=0;--n)s=t[n].stack,void 0===o[s]&&(o[s]=n);for(n=0;u>n;++n)if(c=t[n].stack,i=o[c],void 0!==i&&i!==n){for(i>0&&(t[i-1]._parent=void 0,t[i-1]._length=1),t[n]._parent=void 0,t[n]._length=1,r=n>0?t[n-1]:this,u-1>i?(r._parent=t[i+1],r._parent.uncycle(),r._length=r._parent._length+1):(r._parent=void 0,r._length=1),h=r._length+1,e=n-2;e>=0;--e)t[e]._length=h,h++;return}}},e.prototype.attachExtraTrace=function(n){if(!n.__stackCleaned__){this.uncycle();for(var u=v(n),f=u.message,t=[u.stack],i=this;void 0!==i;)t.push(tt(i.stack.split("\n"))),i=i._parent;oi(t);ei(t);r.notEnumerableProp(n,"stack",fi(f,t));r.notEnumerableProp(n,"__stackCleaned__",!0)}},d=function(){var i=/^\s*at\s*/,t=function(n,t){return"string"==typeof n?n:void 0!==t.name&&void 0!==t.message?t.toString():ut(t)},r,n,u;if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace)return Error.stackTraceLimit+=6,h=i,c=t,r=Error.captureStackTrace,k=function(n){return st.test(n)},function(n,t){Error.stackTraceLimit+=6;r(n,t);Error.stackTraceLimit-=6};if(n=new Error,"string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return h=/@/,c=t,ht=!0,function(n){n.stack=(new Error).stack};try{throw new Error;}catch(f){u="stack"in f}return"stack"in n||!u||"number"!=typeof Error.stackTraceLimit?(c=function(n,t){return"string"==typeof n?n:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?ut(t):t.toString()},null):(h=i,c=t,function(n){Error.stackTraceLimit+=6;try{throw new Error;}catch(t){n.stack=t.stack}Error.stackTraceLimit-=6})}([]),"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(s=function(n){console.warn(n)},r.isNode&&process.stderr.isTTY?s=function(n,t){var i=t?"\x1b[33m":"\x1b[31m";console.warn(i+n+"\x1b[0m\n")}:r.isNode||"string"!=typeof(new Error).stack||(s=function(n,t){console.warn("%c"+n,t?"color: darkorange":"color: red")})),u={warnings:lt,longStackTraces:!1,cancellation:!1,monitoring:!1},vi&&t.longStackTraces(),{longStackTraces:function(){return u.longStackTraces},warnings:function(){return u.warnings},cancellation:function(){return u.cancellation},monitoring:function(){return u.monitoring},propagateFromFunction:function(){return yt},boundValueFunction:function(){return ni},checkForgottenReturns:ri,setBounds:ci,warn:a,deprecated:ui,CapturedTrace:e,fireDomEvent:at,fireGlobalEvent:vt}}},{"./errors":12,"./util":36}],10:[function(n,t){"use strict";t.exports=function(n){function t(){return this.value}function i(){throw this.reason;}n.prototype["return"]=n.prototype.thenReturn=function(i){return i instanceof n&&i.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:i},void 0)};n.prototype["throw"]=n.prototype.thenThrow=function(n){return this._then(i,void 0,void 0,{reason:n},void 0)};n.prototype.catchThrow=function(n){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:n},void 0);var t=arguments[1],r=function(){throw t;};return this.caught(n,r)};n.prototype.catchReturn=function(i){var r,u;return arguments.length<=1?(i instanceof n&&i.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:i},void 0)):(r=arguments[1],r instanceof n&&r.suppressUnhandledRejections(),u=function(){return r},this.caught(i,u))}}},{}],11:[function(n,t){"use strict";t.exports=function(n,t){function i(){return f(this)}function r(n,i){return u(n,i,t,t)}var u=n.reduce,f=n.all;n.prototype.each=function(n){return this.mapSeries(n)._then(i,void 0,void 0,this,void 0)};n.prototype.mapSeries=function(n){return u(this,n,t,t)};n.each=function(n,t){return r(n,t)._then(i,void 0,void 0,n,void 0)};n.mapSeries=r}},{}],12:[function(n,t){"use strict";function r(n,t){function i(r){return this instanceof i?(u(this,"message","string"==typeof r?r:t),u(this,"name",n),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new i(r)}return y(i,Error),i}function e(n){return this instanceof e?(u(this,"name","OperationalError"),u(this,"message",n),this.cause=n,this.isOperational=!0,void(n instanceof Error?(u(this,"message",n.message),u(this,"stack",n.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new e(n)}var c,l,a=n("./es5"),p=a.freeze,v=n("./util"),y=v.inherits,u=v.notEnumerableProp,w=r("Warning","warning"),b=r("CancellationError","cancellation error"),k=r("TimeoutError","timeout error"),o=r("AggregateError","aggregate error"),s,f,h,i;try{c=TypeError;l=RangeError}catch(d){c=r("TypeError","type error");l=r("RangeError","range error")}for(s="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),f=0;f<s.length;++f)"function"==typeof Array.prototype[s[f]]&&(o.prototype[s[f]]=Array.prototype[s[f]]);a.defineProperty(o.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0});o.prototype.isOperational=!0;h=0;o.prototype.toString=function(){var r=Array(4*h+1).join(" "),f="\n"+r+"AggregateError of:\n",n;for(h++,r=Array(4*h+1).join(" "),n=0;n<this.length;++n){for(var u=this[n]===this?"[Circular AggregateError]":this[n]+"",t=u.split("\n"),i=0;i<t.length;++i)t[i]=r+t[i];u=t.join("\n");f+=u+"\n"}return h--,f};y(e,Error);i=Error.__BluebirdErrorTypes__;i||(i=p({CancellationError:b,TimeoutError:k,OperationalError:e,RejectionError:e,AggregateError:o}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:i,writable:!1,enumerable:!1,configurable:!1}));t.exports={Error:Error,TypeError:c,RangeError:l,CancellationError:i.CancellationError,OperationalError:i.OperationalError,TimeoutError:i.TimeoutError,AggregateError:i.AggregateError,Warning:w}},{"./es5":13,"./util":36}],13:[function(n,t){var i=function(){"use strict";return void 0===this}();if(i)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:i,propertyIsWritable:function(n,t){var i=Object.getOwnPropertyDescriptor(n,t);return!(i&&!i.writable&&!i.set)}};else{var u={}.hasOwnProperty,f={}.toString,e={}.constructor.prototype,r=function(n){var t=[];for(var i in n)u.call(n,i)&&t.push(i);return t},o=function(n,t){return{value:n[t]}},s=function(n,t,i){return n[t]=i.value,n},h=function(n){return n},c=function(n){try{return Object(n).constructor.prototype}catch(t){return e}},l=function(n){try{return"[object Array]"===f.call(n)}catch(t){return!1}};t.exports={isArray:l,keys:r,names:r,defineProperty:s,getDescriptor:o,freeze:h,getPrototypeOf:c,isES5:i,propertyIsWritable:function(){return!0}}}},{}],14:[function(n,t){"use strict";t.exports=function(n,t){var i=n.map;n.prototype.filter=function(n,r){return i(this,n,r,t)};n.filter=function(n,r,u){return i(n,r,u,t)}}},{}],15:[function(n,t){"use strict";t.exports=function(t,i){function e(n,t,i){this.promise=n;this.type=t;this.handler=i;this.called=!1;this.cancelPromise=null}function o(n){this.finallyHandler=n}function u(n,t){return null!=n.cancelPromise?(arguments.length>1?n.cancelPromise._reject(t):n.cancelPromise._cancel(),n.cancelPromise=null,!0):!1}function s(){return f.call(this,this.promise._target()._settledValue())}function h(n){if(!u(this,n))return(r.e=n,r)}function f(n){var f=this.promise,v=this.handler,c,e,a;if(!this.called&&(this.called=!0,c=this.isFinallyHandler()?v.call(f._boundValue()):v.call(f._boundValue(),n),void 0!==c&&(f._setReturnedNonUndefined(),e=i(c,f),e instanceof t))){if(null!=this.cancelPromise){if(e.isCancelled())return a=new l("late cancellation observer"),f._attachExtraTrace(a),r.e=a,r;e.isPending()&&e._attachCancellationCallback(new o(this))}return e._then(s,h,void 0,this,void 0)}return f.isRejected()?(u(this),r.e=n,r):(u(this),n)}var c=n("./util"),l=t.CancellationError,r=c.errorObj;return e.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){u(this.finallyHandler)},t.prototype._passThrough=function(n,t,i,r){return"function"!=typeof n?this.then():this._then(i,r,void 0,new e(this,t,n),void 0)},t.prototype.lastly=t.prototype["finally"]=function(n){return this._passThrough(n,0,f,f)},t.prototype.tap=function(n){return this._passThrough(n,1,f)},e}},{"./util":36}],16:[function(n,t){"use strict";t.exports=function(t,i,r,u,f,e){function v(n,i,r){for(var e,h,o,f=0;f<i.length;++f){if(r._pushContext(),e=s(i[f])(n),r._popContext(),e===l)return r._pushContext(),h=t.reject(l.e),r._popContext(),h;if(o=u(e,r),o instanceof t)return o}return null}function o(n,i,u,f){var o,s,h;e.cancellation()?(o=new t(r),s=this._finallyPromise=new t(r),this._promise=o.lastly(function(){return s}),o._captureStackTrace(),o._setOnCancel(this)):(h=this._promise=new t(r),h._captureStackTrace());this._stack=f;this._generatorFunction=n;this._receiver=i;this._generator=void 0;this._yieldHandlers="function"==typeof u?[u].concat(a):a;this._yieldedPromise=null;this._cancellationPhase=!1}var y=n("./errors"),c=y.TypeError,h=n("./util"),l=h.errorObj,s=h.tryCatch,a=[];h.inherits(o,f);o.prototype._isResolved=function(){return null===this._promise};o.prototype._cleanup=function(){this._promise=this._generator=null;e.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)};o.prototype._promiseCancelled=function(){var i,r,n;this._isResolved()||(r="undefined"!=typeof this._generator["return"],r?(this._promise._pushContext(),i=s(this._generator["return"]).call(this._generator,void 0),this._promise._popContext()):(n=new t.CancellationError("generator .return() sentinel"),t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),i=s(this._generator["throw"]).call(this._generator,n),this._promise._popContext()),this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(i))};o.prototype._promiseFulfilled=function(n){this._yieldedPromise=null;this._promise._pushContext();var t=s(this._generator.next).call(this._generator,n);this._promise._popContext();this._continue(t)};o.prototype._promiseRejected=function(n){this._yieldedPromise=null;this._promise._attachExtraTrace(n);this._promise._pushContext();var t=s(this._generator["throw"]).call(this._generator,n);this._promise._popContext();this._continue(t)};o.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var n=this._yieldedPromise;this._yieldedPromise=null;n.cancel()}};o.prototype.promise=function(){return this._promise};o.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver);this._receiver=this._generatorFunction=void 0;this._promiseFulfilled(void 0)};o.prototype._continue=function(n){var r=this._promise,f,i,e;if(n===l)return this._cleanup(),this._cancellationPhase?r.cancel():r._rejectCallback(n.e,!1);if(f=n.value,n.done===!0)return this._cleanup(),this._cancellationPhase?r.cancel():r._resolveCallback(f);if(i=u(f,this._promise),!(i instanceof t)&&(i=v(i,this._yieldHandlers,this._promise),null===i))return void this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",f)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));i=i._target();e=i._bitField;0==(50397184&e)?(this._yieldedPromise=i,i._proxy(this,null)):0!=(33554432&e)?this._promiseFulfilled(i._value()):0!=(16777216&e)?this._promiseRejected(i._reason()):this._promiseCancelled()};t.coroutine=function(n,t){if("function"!=typeof n)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(t).yieldHandler,r=o,u=(new Error).stack;return function(){var f=n.apply(this,arguments),t=new r(void 0,void 0,i,u),e=t.promise();return t._generator=f,t._promiseFulfilled(void 0),e}};t.coroutine.addYieldHandler=function(n){if("function"!=typeof n)throw new c("expecting a function but got "+h.classString(n));a.push(n)};t.spawn=function(n){if(e.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof n)return i("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new o(n,this),u=r.promise();return r._run(t.spawn),u}}},{"./errors":12,"./util":36}],17:[function(n,t){"use strict";t.exports=function(t,i){var r=n("./util");r.canEvaluate;r.tryCatch;r.errorObj;t.join=function(){var n,t=arguments.length-1,u,r;return t>0&&"function"==typeof arguments[t]&&(n=arguments[t]),u=[].slice.call(arguments),n&&u.pop(),r=new i(u).promise(),void 0!==n?r.spread(n):r}}},{"./util":36}],18:[function(n,t){"use strict";t.exports=function(t,i,r,u,f,e){function o(n,t,i,r){this.constructor$(n);this._promise._captureStackTrace();var u=c();this._callback=null===u?t:u.bind(t);this._preservedValues=r===f?new Array(this.length()):null;this._limit=i;this._inFlight=0;this._queue=i>=1?[]:v;this._init$(void 0,-2)}function h(n,t,i,u){if("function"!=typeof t)return r("expecting a function but got "+s.classString(t));var f="object"==typeof i&&null!==i?i.concurrency:0;return f="number"==typeof f&&isFinite(f)&&f>=1?f:0,new o(n,t,f,u).promise()}var c=t._getDomain,s=n("./util"),l=s.tryCatch,a=s.errorObj,v=[];s.inherits(o,i);o.prototype._init=function(){};o.prototype._promiseFulfilled=function(n,i){var o=this._values,y=this.length(),s=this._preservedValues,h=this._limit,f,p,r,v,w;if(0>i){if(i=-1*i-1,o[i]=n,h>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(h>=1&&this._inFlight>=h)return o[i]=n,this._queue.push(i),!1;null!==s&&(s[i]=n);var c=this._promise,b=this._callback,k=c._boundValue();if(c._pushContext(),f=l(b).call(k,n,i,y),p=c._popContext(),e.checkForgottenReturns(f,p,null!==s?"Promise.filter":"Promise.map",c),f===a)return this._reject(f.e),!0;if(r=u(f,this._promise),r instanceof t){if(r=r._target(),v=r._bitField,0==(50397184&v))return h>=1&&this._inFlight++,o[i]=r,r._proxy(this,-1*(i+1)),!1;if(0==(33554432&v))return 0!=(16777216&v)?(this._reject(r._reason()),!0):(this._cancel(),!0);f=r._value()}o[i]=f}return w=++this._totalResolved,w>=y?(null!==s?this._filter(o,s):this._resolve(o),!0):!1};o.prototype._drainQueue=function(){for(var n,t=this._queue,i=this._limit,r=this._values;t.length>0&&this._inFlight<i;){if(this._isResolved())return;n=t.pop();this._promiseFulfilled(r[n],n)}};o.prototype._filter=function(n,t){for(var u=t.length,r=new Array(u),f=0,i=0;u>i;++i)n[i]&&(r[f++]=t[i]);r.length=f;this._resolve(r)};o.prototype.preservedValues=function(){return this._preservedValues};t.prototype.map=function(n,t){return h(this,n,t,null)};t.map=function(n,t,i,r){return h(n,t,i,r)}}},{"./util":36}],19:[function(n,t){"use strict";t.exports=function(t,i,r,u,f){var e=n("./util"),o=e.tryCatch;t.method=function(n){if("function"!=typeof n)throw new t.TypeError("expecting a function but got "+e.classString(n));return function(){var r=new t(i),u,e;return r._captureStackTrace(),r._pushContext(),u=o(n).apply(this,arguments),e=r._popContext(),f.checkForgottenReturns(u,e,"Promise.method",r),r._resolveFromSyncValue(u),r}};t.attempt=t["try"]=function(n){var r,s,h,c,l;return"function"!=typeof n?u("expecting a function but got "+e.classString(n)):(r=new t(i),r._captureStackTrace(),r._pushContext(),arguments.length>1?(f.deprecated("calling Promise.try with more than 1 argument"),h=arguments[1],c=arguments[2],s=e.isArray(h)?o(n).apply(c,h):o(n).call(c,h)):s=o(n)(),l=r._popContext(),f.checkForgottenReturns(s,l,"Promise.try",r),r._resolveFromSyncValue(s),r)};t.prototype._resolveFromSyncValue=function(n){n===e.errorObj?this._rejectCallback(n.e,!1):this._resolveCallback(n,!0)}}},{"./util":36}],20:[function(n,t){"use strict";function u(n){return n instanceof Error&&r.getPrototypeOf(n)===Error.prototype}function f(n){var t,o,f,e;if(u(n)){for(t=new h(n),t.name=n.name,t.message=n.message,t.stack=n.stack,o=r.keys(n),f=0;f<o.length;++f)e=o[f],c.test(e)||(t[e]=n[e]);return t}return i.markAsOriginatingFromRejection(n),n}function e(n,t){return function(i,r){var u,e;null!==n&&(i?(u=f(o(i)),n._attachExtraTrace(u),n._reject(u)):t?(e=[].slice.call(arguments,1),n._fulfill(e)):n._fulfill(r),n=null)}}var i=n("./util"),o=i.maybeWrapAsError,s=n("./errors"),h=s.OperationalError,r=n("./es5"),c=/^(?:name|message|stack|cause)$/;t.exports=e},{"./errors":12,"./es5":13,"./util":36}],21:[function(n,t){"use strict";t.exports=function(t){function o(n,t){var s=this,o;if(!r.isArray(n))return e.call(s,n,t);o=i(t).apply(s._boundValue(),[null].concat(n));o===f&&u.throwLater(o.e)}function e(n,t){var o=this,r=o._boundValue(),e=void 0===n?i(t).call(r,null):i(t).call(r,null,n);e===f&&u.throwLater(e.e)}function s(n,t){var o=this,r,e;n||(r=new Error(n+""),r.cause=n,n=r);e=i(t).call(o._boundValue(),n);e===f&&u.throwLater(e.e)}var r=n("./util"),u=t._async,i=r.tryCatch,f=r.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(n,t){if("function"==typeof n){var i=e;void 0!==t&&Object(t).spread&&(i=o);this._then(i,s,void 0,this,n)}return this}}},{"./util":36}],22:[function(n,t){"use strict";t.exports=function(){function v(){}function rt(n,i){if("function"!=typeof i)throw new l("expecting a function but got "+r.classString(i));if(n.constructor!==t)throw new l("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");}function t(n){this._bitField=0;this._fulfillmentHandler0=void 0;this._rejectionHandler0=void 0;this._promise0=void 0;this._receiver0=void 0;n!==i&&(rt(this,n),this._resolveFromExecutor(n));this._promiseCreated();this._fireEvent("promiseCreated",this)}function ut(n){this.promise._resolveCallback(n)}function ft(n){this.promise._rejectCallback(n,!1)}function s(n){var r=new t(i);r._fulfillmentHandler0=n;r._rejectionHandler0=n;r._promise0=n;r._receiver0=n}var b,y=function(){return new l("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},p=function(){return new t.PromiseInspection(this._target())},e=function(n){return t.reject(new l(n))},k={},r=n("./util"),h,l,d;b=r.isNode?function(){var n=process.domain;return void 0===n&&(n=null),n}:function(){return null};r.notEnumerableProp(t,"_getDomain",b);var et=n("./es5"),g=n("./async"),c=new g;et.defineProperty(t,"_async",{value:c});h=n("./errors");l=t.TypeError=h.TypeError;t.RangeError=h.RangeError;d=t.CancellationError=h.CancellationError;t.TimeoutError=h.TimeoutError;t.OperationalError=h.OperationalError;t.RejectionError=h.OperationalError;t.AggregateError=h.AggregateError;var i=function(){},nt={},tt={},f=n("./thenables")(t,i),o=n("./promise_array")(t,i,f,e,v),it=n("./context")(t),ot=it.create,u=n("./debuggability")(t,it),st=(u.CapturedTrace,n("./finally")(t,f)),ht=n("./catch_filter")(tt),ct=n("./nodeback"),a=r.errorObj,w=r.tryCatch;return t.prototype.toString=function(){return"[object Promise]"},t.prototype.caught=t.prototype["catch"]=function(n){var f=arguments.length,t,i,o,u;if(f>1){for(i=new Array(f-1),o=0,t=0;f-1>t;++t){if(u=arguments[t],!r.isObject(u))return e("expecting an object but got "+r.classString(u));i[o++]=u}return i.length=o,n=arguments[t],this.then(void 0,ht(i,n,this))}return this.then(void 0,n)},t.prototype.reflect=function(){return this._then(p,p,void 0,this,void 0)},t.prototype.then=function(n,t){if(u.warnings()&&arguments.length>0&&"function"!=typeof n&&"function"!=typeof t){var i=".then() only accepts functions but was passed: "+r.classString(n);arguments.length>1&&(i+=", "+r.classString(t));this._warn(i)}return this._then(n,t,void 0,void 0,void 0)},t.prototype.done=function(n,t){var i=this._then(n,t,void 0,void 0,void 0);i._setIsFinal()},t.prototype.spread=function(n){return"function"!=typeof n?e("expecting a function but got "+r.classString(n)):this.all()._then(n,void 0,void 0,nt,void 0)},t.prototype.toJSON=function(){var n={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(n.fulfillmentValue=this.value(),n.isFulfilled=!0):this.isRejected()&&(n.rejectionReason=this.reason(),n.isRejected=!0),n},t.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new o(this).promise()},t.prototype.error=function(n){return this.caught(r.originatesFromRejection,n)},t.is=function(n){return n instanceof t},t.fromNode=t.fromCallback=function(n){var r=new t(i),f,u;return r._captureStackTrace(),f=arguments.length>1?!!Object(arguments[1]).multiArgs:!1,u=w(n)(ct(r,f)),u===a&&r._rejectCallback(u.e,!0),r._isFateSealed()||r._setAsyncGuaranteed(),r},t.all=function(n){return new o(n).promise()},t.cast=function(n){var r=f(n);return r instanceof t||(r=new t(i),r._captureStackTrace(),r._setFulfilled(),r._rejectionHandler0=n),r},t.resolve=t.fulfilled=t.cast,t.reject=t.rejected=function(n){var r=new t(i);return r._captureStackTrace(),r._rejectCallback(n,!0),r},t.setScheduler=function(n){if("function"!=typeof n)throw new l("expecting a function but got "+r.classString(n));return c.setScheduler(n)},t.prototype._then=function(n,r,u,f,e){var p=void 0!==e,s=p?e:new t(i),o=this._target(),a=o._bitField,v,h,l,y;return p||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===f&&0!=(2097152&this._bitField)&&(f=0!=(50397184&a)?this._boundValue():o===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s)),v=b(),0!=(50397184&a)?(y=o._settlePromiseCtx,0!=(33554432&a)?(l=o._rejectionHandler0,h=n):0!=(16777216&a)?(l=o._fulfillmentHandler0,h=r,o._unsetRejectionIsUnhandled()):(y=o._settlePromiseLateCancellationObserver,l=new d("late cancellation observer"),o._attachExtraTrace(l),h=r),c.invoke(y,o,{handler:null===v?h:"function"==typeof h&&v.bind(h),promise:s,receiver:f,value:l})):o._addCallbacks(n,r,s,f,v),s},t.prototype._length=function(){return 65535&this._bitField},t.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},t.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},t.prototype._setLength=function(n){this._bitField=-65536&this._bitField|65535&n},t.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField;this._fireEvent("promiseFulfilled",this)},t.prototype._setRejected=function(){this._bitField=16777216|this._bitField;this._fireEvent("promiseRejected",this)},t.prototype._setFollowing=function(){this._bitField=67108864|this._bitField;this._fireEvent("promiseResolved",this)},t.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},t.prototype._isFinal=function(){return(4194304&this._bitField)>0},t.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},t.prototype._setCancelled=function(){this._bitField=65536|this._bitField;this._fireEvent("promiseCancelled",this)},t.prototype._setAsyncGuaranteed=function(){c.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},t.prototype._receiverAt=function(n){var t=0===n?this._receiver0:this[4*n-1];if(t!==k)return void 0===t&&this._isBound()?this._boundValue():t},t.prototype._promiseAt=function(n){return this[4*n-2]},t.prototype._fulfillmentHandlerAt=function(n){return this[4*n-4]},t.prototype._rejectionHandlerAt=function(n){return this[4*n-3]},t.prototype._boundValue=function(){},t.prototype._migrateCallback0=function(n){var i=(n._bitField,n._fulfillmentHandler0),r=n._rejectionHandler0,u=n._promise0,t=n._receiverAt(0);void 0===t&&(t=k);this._addCallbacks(i,r,u,t,null)},t.prototype._migrateCallbackAt=function(n,t){var r=n._fulfillmentHandlerAt(t),u=n._rejectionHandlerAt(t),f=n._promiseAt(t),i=n._receiverAt(t);void 0===i&&(i=k);this._addCallbacks(r,u,f,i,null)},t.prototype._addCallbacks=function(n,t,i,r,u){var f=this._length(),e;return(f>=65531&&(f=0,this._setLength(0)),0===f)?(this._promise0=i,this._receiver0=r,"function"==typeof n&&(this._fulfillmentHandler0=null===u?n:u.bind(n)),"function"==typeof t&&(this._rejectionHandler0=null===u?t:u.bind(t))):(e=4*f-4,this[e+2]=i,this[e+3]=r,"function"==typeof n&&(this[e+0]=null===u?n:u.bind(n)),"function"==typeof t&&(this[e+1]=null===u?t:u.bind(t))),this._setLength(f+1),f},t.prototype._proxy=function(n,t){this._addCallbacks(void 0,void 0,t,n,null)},t.prototype._resolveCallback=function(n,i){var u,r,e,s,o,h;if(0==(117506048&this._bitField)){if(n===this)return this._rejectCallback(y(),!1);if(u=f(n,this),!(u instanceof t))return this._fulfill(n);if(i&&this._propagateFrom(u,2),r=u._target(),r===this)return void this._reject(y());if(e=r._bitField,0==(50397184&e)){for(s=this._length(),s>0&&r._migrateCallback0(this),o=1;s>o;++o)r._migrateCallbackAt(this,o);this._setFollowing();this._setLength(0);this._setFollowee(r)}else 0!=(33554432&e)?this._fulfill(r._value()):0!=(16777216&e)?this._reject(r._reason()):(h=new d("late cancellation observer"),r._attachExtraTrace(h),this._reject(h))}},t.prototype._rejectCallback=function(n,t,i){var f=r.ensureErrorObject(n),e=f===n,o;e||i||!u.warnings()||(o="a promise was rejected with a non-error: "+r.classString(n),this._warn(o,!0));this._attachExtraTrace(f,t?e:!1);this._reject(n)},t.prototype._resolveFromExecutor=function(n){var t=this,i,r;this._captureStackTrace();this._pushContext();i=!0;r=this._execute(n,function(n){t._resolveCallback(n)},function(n){t._rejectCallback(n,i)});i=!1;this._popContext();void 0!==r&&t._rejectCallback(r,!0)},t.prototype._settlePromiseFromHandler=function(n,t,i,f){var o=f._bitField,e,s;0==(65536&o)&&(f._pushContext(),t===nt?i&&"number"==typeof i.length?e=w(n).apply(this._boundValue(),i):(e=a,e.e=new l("cannot .spread() a non-array: "+r.classString(i))):e=w(n).call(t,i),s=f._popContext(),o=f._bitField,0==(65536&o)&&(e===tt?f._reject(i):e===a?f._rejectCallback(e.e,!1):(u.checkForgottenReturns(e,s,"",f,this),f._resolveCallback(e))))},t.prototype._target=function(){for(var n=this;n._isFollowing();)n=n._followee();return n},t.prototype._followee=function(){return this._rejectionHandler0},t.prototype._setFollowee=function(n){this._rejectionHandler0=n},t.prototype._settlePromise=function(n,i,r,u){var f=n instanceof t,e=this._bitField,s=0!=(134217728&e);0!=(65536&e)?(f&&n._invokeInternalOnCancel(),r instanceof st&&r.isFinallyHandler()?(r.cancelPromise=n,w(i).call(r,u)===a&&n._reject(a.e)):i===p?n._fulfill(p.call(r)):r instanceof v?r._promiseCancelled(n):f||n instanceof o?n._cancel():r.cancel()):"function"==typeof i?f?(s&&n._setAsyncGuaranteed(),this._settlePromiseFromHandler(i,r,u,n)):i.call(r,u,n):r instanceof v?r._isResolved()||(0!=(33554432&e)?r._promiseFulfilled(u,n):r._promiseRejected(u,n)):f&&(s&&n._setAsyncGuaranteed(),0!=(33554432&e)?n._fulfill(u):n._reject(u))},t.prototype._settlePromiseLateCancellationObserver=function(n){var r=n.handler,i=n.promise,f=n.receiver,u=n.value;"function"==typeof r?i instanceof t?this._settlePromiseFromHandler(r,f,u,i):r.call(f,u,i):i instanceof t&&i._reject(u)},t.prototype._settlePromiseCtx=function(n){this._settlePromise(n.promise,n.handler,n.receiver,n.value)},t.prototype._settlePromise0=function(n,t){var i=this._promise0,r=this._receiverAt(0);this._promise0=void 0;this._receiver0=void 0;this._settlePromise(i,n,r,t)},t.prototype._clearCallbackDataAtIndex=function(n){var t=4*n-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},t.prototype._fulfill=function(n){var t=this._bitField,i;if(!((117506048&t)>>>16)){if(n===this)return i=y(),this._attachExtraTrace(i),this._reject(i);this._setFulfilled();this._rejectionHandler0=n;(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():c.settlePromises(this))}},t.prototype._reject=function(n){var t=this._bitField;if(!((117506048&t)>>>16))return this._setRejected(),this._fulfillmentHandler0=n,this._isFinal()?c.fatalError(n,r.isNode):void((65535&t)>0?c.settlePromises(this):this._ensurePossibleRejectionHandled())},t.prototype._fulfillPromises=function(n,t){for(var i=1;n>i;i++){var r=this._fulfillmentHandlerAt(i),u=this._promiseAt(i),f=this._receiverAt(i);this._clearCallbackDataAtIndex(i);this._settlePromise(u,r,f,t)}},t.prototype._rejectPromises=function(n,t){for(var i=1;n>i;i++){var r=this._rejectionHandlerAt(i),u=this._promiseAt(i),f=this._receiverAt(i);this._clearCallbackDataAtIndex(i);this._settlePromise(u,r,f,t)}},t.prototype._settlePromises=function(){var n=this._bitField,t=65535&n,i,r;t>0&&(0!=(16842752&n)?(i=this._fulfillmentHandler0,this._settlePromise0(this._rejectionHandler0,i,n),this._rejectPromises(t,i)):(r=this._rejectionHandler0,this._settlePromise0(this._fulfillmentHandler0,r,n),this._fulfillPromises(t,r)),this._setLength(0));this._clearCancellationData()},t.prototype._settledValue=function(){var n=this._bitField;return 0!=(33554432&n)?this._rejectionHandler0:0!=(16777216&n)?this._fulfillmentHandler0:void 0},t.defer=t.pending=function(){u.deprecated("Promise.defer","new Promise");var n=new t(i);return{promise:n,resolve:ut,reject:ft}},r.notEnumerableProp(t,"_makeSelfResolutionError",y),n("./method")(t,i,f,e,u),n("./bind")(t,i,f,u),n("./cancel")(t,o,e,u),n("./direct_resolve")(t),n("./synchronous_inspection")(t),n("./join")(t,o,f,i,u),t.Promise=t,n("./map.js")(t,o,e,f,i,u),n("./call_get.js")(t),n("./using.js")(t,e,f,ot,i,u),n("./timers.js")(t,i,u),n("./generators.js")(t,e,i,f,v,u),n("./nodeify.js")(t),n("./promisify.js")(t,i),n("./props.js")(t,o,f,e),n("./race.js")(t,i,f,e),n("./reduce.js")(t,o,e,f,i,u),n("./settle.js")(t,o,u),n("./some.js")(t,o,e),n("./filter.js")(t,i),n("./each.js")(t,i),n("./any.js")(t),r.toFastProperties(t),r.toFastProperties(t.prototype),s({a:1}),s({b:2}),s({c:3}),s(1),s(function(){}),s(void 0),s(!1),s(new t(i)),u.setBounds(g.firstLineError,r.lastLineError),t}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(n,t){"use strict";t.exports=function(t,i,r,u,f){function s(n){switch(n){case-2:return[];case-3:return{}}}function e(n){var r=this._promise=new t(i);n instanceof t&&r._propagateFrom(n,3);r._setOnCancel(this);this._values=n;this._length=0;this._totalResolved=0;this._init(void 0,-2)}var o=n("./util");return o.isArray,o.inherits(e,f),e.prototype.length=function(){return this._length},e.prototype.promise=function(){return this._promise},e.prototype._init=function h(n,i){var f=r(this._values,this._promise),e,c;if(f instanceof t){if(f=f._target(),e=f._bitField,this._values=f,0==(50397184&e))return this._promise._setAsyncGuaranteed(),f._then(h,this._reject,void 0,this,i);if(0==(33554432&e))return 0!=(16777216&e)?this._reject(f._reason()):this._cancel();f=f._value()}return(f=o.asArray(f),null===f)?(c=u("expecting an array or an iterable object but got "+o.classString(f)).reason(),void this._promise._rejectCallback(c,!1)):0===f.length?void(-5===i?this._resolveEmptyArray():this._resolve(s(i))):void this._iterate(f)},e.prototype._iterate=function(n){var o=this.getActualLength(n.length),i;this._length=o;this._values=this.shouldCopyValues()?new Array(o):this._values;for(var s=this._promise,e=!1,f=null,u=0;o>u;++u)i=r(n[u],s),i instanceof t?(i=i._target(),f=i._bitField):f=null,e?null!==f&&i.suppressUnhandledRejections():null!==f?0==(50397184&f)?(i._proxy(this,u),this._values[u]=i):e=0!=(33554432&f)?this._promiseFulfilled(i._value(),u):0!=(16777216&f)?this._promiseRejected(i._reason(),u):this._promiseCancelled(u):e=this._promiseFulfilled(i,u);e||s._setAsyncGuaranteed()},e.prototype._isResolved=function(){return null===this._values},e.prototype._resolve=function(n){this._values=null;this._promise._fulfill(n)},e.prototype._cancel=function(){!this._isResolved()&&this._promise.isCancellable()&&(this._values=null,this._promise._cancel())},e.prototype._reject=function(n){this._values=null;this._promise._rejectCallback(n,!1)},e.prototype._promiseFulfilled=function(n,t){this._values[t]=n;var i=++this._totalResolved;return i>=this._length?(this._resolve(this._values),!0):!1},e.prototype._promiseCancelled=function(){return this._cancel(),!0},e.prototype._promiseRejected=function(n){return this._totalResolved++,this._reject(n),!0},e.prototype._resultCancelled=function(){var n,i;if(!this._isResolved())if(n=this._values,this._cancel(),n instanceof t)n.cancel();else for(i=0;i<n.length;++i)n[i]instanceof t&&n[i].cancel()},e.prototype.shouldCopyValues=function(){return!0},e.prototype.getActualLength=function(n){return n},e}},{"./util":36}],24:[function(n,t){"use strict";t.exports=function(t,i){function c(n){return!it.test(n)}function e(n){try{return n.__isPromisified__===!0}catch(t){return!1}}function l(n,t,i){var u=r.getDataPropertyOrDefault(n,t+i,tt);return u?e(u):!1}function a(n,t,i){for(var f,e,u,r=0;r<n.length;r+=2)if(f=n[r],i.test(f))for(e=f.replace(i,""),u=0;u<n.length;u+=2)if(n[u]===e)throw new s("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t));}function v(n,t,i,u){for(var v=r.inheritedDataKeys(n),s=[],c=0;c<v.length;++c){var f=v[c],o=n[f],y=u===h?!0:h(f,o,n);"function"!=typeof o||e(o)||l(n,f,t)||!u(f,o,n,y)||s.push(f,o)}return a(s,t,i),s}function y(n,u,e,o,s,h){function l(){var e=u,r,o,s;u===f&&(e=this);r=new t(i);r._captureStackTrace();o="string"==typeof c&&this!==a?this[c]:n;s=b(r,h);try{o.apply(e,k(arguments,s))}catch(l){r._rejectCallback(d(l),!0,!0)}return r._isFateSealed()||r._setAsyncGuaranteed(),r}var a=function(){return this}(),c=n;return"string"==typeof c&&(n=o),r.notEnumerableProp(l,"__isPromisified__",!0),l}function o(n,t,i,e,o){for(var a,p=new RegExp(rt(t)+"$"),c=v(n,t,p,i),h=0,w=c.length;w>h;h+=2){var s=c[h],l=c[h+1],y=s+t;e===u?n[y]=u(s,f,s,l,t,o):(a=e(l,function(){return u(s,f,s,l,t,o)}),r.notEnumerableProp(a,"__isPromisified__",!0),n[y]=a)}return r.toFastProperties(n),n}function p(n,t,i){return u(n,t,void 0,n,null,i)}var w,f={},r=n("./util"),b=n("./nodeback"),k=r.withAppended,d=r.maybeWrapAsError,g=r.canEvaluate,s=n("./errors").TypeError,nt="Async",tt={__isPromisified__:!0},it=new RegExp("^(?:arity|length|name|arguments|caller|callee|prototype|__isPromisified__)$"),h=function(n){return r.isIdentifier(n)&&"_"!==n.charAt(0)&&"constructor"!==n},rt=function(n){return n.replace(/([$])/,"\\$")},u=g?w:y;t.promisify=function(n,t){if("function"!=typeof n)throw new s("expecting a function but got "+r.classString(n));if(e(n))return n;t=Object(t);var u=void 0===t.context?f:t.context,o=!!t.multiArgs,i=p(n,u,o);return r.copyDescriptors(n,i,c),i};t.promisifyAll=function(n,t){var l,i,f,e,a,c,v;if("function"!=typeof n&&"object"!=typeof n)throw new s("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");if(t=Object(t),l=!!t.multiArgs,i=t.suffix,"string"!=typeof i&&(i=nt),f=t.filter,"function"!=typeof f&&(f=h),e=t.promisifier,"function"!=typeof e&&(e=u),!r.isIdentifier(i))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(a=r.inheritedDataKeys(n),c=0;c<a.length;++c)v=n[a[c]],"constructor"!==a[c]&&r.isClass(v)&&(o(v.prototype,i,f,e,l),o(v,i,f,e,l));return o(n,i,f,e,l)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(n,t){"use strict";t.exports=function(t,i,r,u){function f(n){var i,o=!1,u,r,t,f;if(void 0!==e&&n instanceof e)i=h(n),o=!0;else for(u=a.keys(n),r=u.length,i=new Array(2*r),t=0;r>t;++t)f=u[t],i[t]=n[f],i[t+r]=f;this.constructor$(i);this._isMap=o;this._init$(void 0,-3)}function o(n){var e,i=r(n);return l(i)?(e=i instanceof t?i._then(t.props,void 0,void 0,void 0,void 0):new f(i).promise(),i instanceof t&&e._propagateFrom(i,2),e):u("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var e,s=n("./util"),l=s.isObject,a=n("./es5"),h,c;"function"==typeof Map&&(e=Map);h=function(){function i(i,r){this[n]=i;this[n+t]=r;n++}var n=0,t=0;return function(r){t=r.size;n=0;var u=new Array(2*r.size);return r.forEach(i,u),u}}();c=function(n){for(var u,f,i=new e,r=n.length/2|0,t=0;r>t;++t)u=n[r+t],f=n[t],i.set(u,f);return i};s.inherits(f,i);f.prototype._init=function(){};f.prototype._promiseFulfilled=function(n,t){var u,i;if(this._values[t]=n,u=++this._totalResolved,u>=this._length){if(this._isMap)i=c(this._values);else{i={};for(var f=this.length(),r=0,e=this.length();e>r;++r)i[this._values[r+f]]=this._values[r]}return this._resolve(i),!0}return!1};f.prototype.shouldCopyValues=function(){return!1};f.prototype.getActualLength=function(n){return n>>1};t.prototype.props=function(){return o(this)};t.props=function(n){return o(n)}}},{"./es5":13,"./util":36}],26:[function(n,t){"use strict";function r(n,t,i,r,u){for(var f=0;u>f;++f)i[f+r]=n[f+t],n[f+t]=void 0}function i(n){this._capacity=n;this._length=0;this._front=0}i.prototype._willBeOverCapacity=function(n){return this._capacity<n};i.prototype._pushOne=function(n){var t=this.length(),i;this._checkCapacity(t+1);i=this._front+t&this._capacity-1;this[i]=n;this._length=t+1};i.prototype._unshiftOne=function(n){var t=this._capacity,r,i;this._checkCapacity(this.length()+1);r=this._front;i=(r-1&t-1^t)-t;this[i]=n;this._front=i;this._length=this.length()+1};i.prototype.unshift=function(n,t,i){this._unshiftOne(i);this._unshiftOne(t);this._unshiftOne(n)};i.prototype.push=function(n,t,i){var r=this.length()+3,u,f;if(this._willBeOverCapacity(r))return this._pushOne(n),this._pushOne(t),void this._pushOne(i);u=this._front+r-3;this._checkCapacity(r);f=this._capacity-1;this[u+0&f]=n;this[u+1&f]=t;this[u+2&f]=i;this._length=r};i.prototype.shift=function(){var n=this._front,t=this[n];return this[n]=void 0,this._front=n+1&this._capacity-1,this._length--,t};i.prototype.length=function(){return this._length};i.prototype._checkCapacity=function(n){this._capacity<n&&this._resizeTo(this._capacity<<1)};i.prototype._resizeTo=function(n){var t=this._capacity;this._capacity=n;var i=this._front,u=this._length,f=i+u&t-1;r(this,0,this,t,f)};t.exports=i},{}],27:[function(n,t){"use strict";t.exports=function(t,i,r,u){function f(n,f){var l=r(n),s,c;if(l instanceof t)return o(l);if(n=e.asArray(n),null===n)return u("expecting an array or an iterable object but got "+e.classString(n));s=new t(i);void 0!==f&&s._propagateFrom(f,3);for(var a=s._fulfill,v=s._reject,h=0,y=n.length;y>h;++h)c=n[h],(void 0!==c||h in n)&&t.cast(c)._then(a,v,void 0,s,null);return s}var e=n("./util"),o=function(n){return n.then(function(t){return f(t,n)})};t.race=function(n){return f(n,void 0)};t.prototype.race=function(){return f(this,void 0)}}},{"./util":36}],28:[function(n,t){"use strict";t.exports=function(t,i,r,u,f,e){function o(n,i,r,u){this.constructor$(n);var e=v();this._fn=null===e?i:e.bind(i);void 0!==r&&(r=t.resolve(r),r._attachCancellationCallback(this));this._initialValue=r;this._currentCancellable=null;this._eachValues=u===f?[]:void 0;this._promise._captureStackTrace();this._init$(void 0,-5)}function h(n,t){this.isFulfilled()?t._resolve(n):t._reject(n)}function c(n,t,i,u){if("function"!=typeof t)return r("expecting a function but got "+s.classString(t));var f=new o(n,t,i,u);return f.promise()}function a(n){this.accum=n;this.array._gotAccum(n);var i=u(this.value,this.array._promise);return i instanceof t?(this.array._currentCancellable=i,i._then(l,void 0,void 0,this,void 0)):l.call(this,i)}function l(n){var i=this.array,r=i._promise,f=y(i._fn),u,o;return r._pushContext(),u=void 0!==i._eachValues?f.call(r._boundValue(),n,this.index,this.length):f.call(r._boundValue(),this.accum,n,this.index,this.length),u instanceof t&&(i._currentCancellable=u),o=r._popContext(),e.checkForgottenReturns(u,o,void 0!==i._eachValues?"Promise.each":"Promise.reduce",r),u}var v=t._getDomain,s=n("./util"),y=s.tryCatch;s.inherits(o,i);o.prototype._gotAccum=function(n){void 0!==this._eachValues&&n!==f&&this._eachValues.push(n)};o.prototype._eachComplete=function(n){return this._eachValues.push(n),this._eachValues};o.prototype._init=function(){};o.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)};o.prototype.shouldCopyValues=function(){return!1};o.prototype._resolve=function(n){this._promise._resolveCallback(n);this._values=null};o.prototype._resultCancelled=function(n){return n===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))};o.prototype._iterate=function(n){var i,r,u,f;if(this._values=n,u=n.length,void 0!==this._initialValue?(i=this._initialValue,r=0):(i=t.resolve(n[0]),r=1),this._currentCancellable=i,!i.isRejected())for(;u>r;++r)f={accum:null,value:n[r],index:r,length:u,array:this},i=i._then(a,void 0,void 0,f,void 0);void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0));i._then(h,h,void 0,i,this)};t.prototype.reduce=function(n,t){return c(this,n,t,null)};t.reduce=function(n,t,i,r){return c(n,t,i,r)}}},{"./util":36}],29:[function(n,t){"use strict";var i,r=n("./util"),s=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n");},u=r.getNativePromise(),f,e,o;r.isNode&&"undefined"==typeof MutationObserver?(f=global.setImmediate,e=process.nextTick,i=r.isRecentNode?function(n){f.call(global,n)}:function(n){e.call(process,n)}):"function"==typeof u?(o=u.resolve(),i=function(n){o.then(n)}):i="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?"undefined"!=typeof setImmediate?function(n){setImmediate(n)}:"undefined"!=typeof setTimeout?function(n){setTimeout(n,0)}:s:function(){var t=document.createElement("div"),i={attributes:!0},n=!1,r=document.createElement("div"),f=new MutationObserver(function(){t.classList.toggle("foo");n=!1}),u;return f.observe(r,i),u=function(){n||(n=!0,r.classList.toggle("foo"))},function(n){var r=new MutationObserver(function(){r.disconnect();n()});r.observe(t,i);u()}}();t.exports=i},{"./util":36}],30:[function(n,t){"use strict";t.exports=function(t,i,r){function u(n){this.constructor$(n)}var f=t.PromiseInspection,e=n("./util");e.inherits(u,i);u.prototype._promiseResolved=function(n,t){this._values[n]=t;var i=++this._totalResolved;return i>=this._length?(this._resolve(this._values),!0):!1};u.prototype._promiseFulfilled=function(n,t){var i=new f;return i._bitField=33554432,i._settledValueField=n,this._promiseResolved(t,i)};u.prototype._promiseRejected=function(n,t){var i=new f;return i._bitField=16777216,i._settledValueField=n,this._promiseResolved(t,i)};t.settle=function(n){return r.deprecated(".settle()",".reflect()"),new u(n).promise()};t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(n,t){"use strict";t.exports=function(t,i,r){function u(n){this.constructor$(n);this._howMany=0;this._unwrap=!1;this._initialized=!1}function f(n,t){if((0|t)!==t||0>t)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new u(n),f=i.promise();return i.setHowMany(t),i.init(),f}var e=n("./util"),s=n("./errors").RangeError,h=n("./errors").AggregateError,c=e.isArray,o={};e.inherits(u,i);u.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var n=c(this._values);!this._isResolved()&&n&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}};u.prototype.init=function(){this._initialized=!0;this._init()};u.prototype.setUnwrap=function(){this._unwrap=!0};u.prototype.howMany=function(){return this._howMany};u.prototype.setHowMany=function(n){this._howMany=n};u.prototype._promiseFulfilled=function(n){return this._addFulfilled(n),this._fulfilled()===this.howMany()?(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0):!1};u.prototype._promiseRejected=function(n){return this._addRejected(n),this._checkOutcome()};u.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(o),this._checkOutcome())};u.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new h,n=this.length();n<this._values.length;++n)this._values[n]!==o&&t.push(this._values[n]);return t.length>0?this._reject(t):this._cancel(),!0}return!1};u.prototype._fulfilled=function(){return this._totalResolved};u.prototype._rejected=function(){return this._values.length-this.length()};u.prototype._addRejected=function(n){this._values.push(n)};u.prototype._addFulfilled=function(n){this._values[this._totalResolved++]=n};u.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()};u.prototype._getRangeError=function(n){var t="Input array must contain at least "+this._howMany+" items but contains only "+n+" items";return new s(t)};u.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};t.some=function(n,t){return f(n,t)};t.prototype.some=function(n){return f(this,n)};t._SomePromiseArray=u}},{"./errors":12,"./util":36}],32:[function(n,t){"use strict";t.exports=function(n){function t(n){void 0!==n?(n=n._target(),this._bitField=n._bitField,this._settledValueField=n._isFateSealed()?n._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var i=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},u=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},f=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},e=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},o=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=n.prototype._isCancelled=function(){return 65536==(65536&this._bitField)};n.prototype.isCancelled=function(){return this._target()._isCancelled()};n.prototype.isPending=function(){return e.call(this._target())};n.prototype.isRejected=function(){return f.call(this._target())};n.prototype.isFulfilled=function(){return u.call(this._target())};n.prototype.isResolved=function(){return o.call(this._target())};n.prototype.value=function(){return i.call(this._target())};n.prototype.reason=function(){var n=this._target();return n._unsetRejectionIsUnhandled(),r.call(n)};n.prototype._value=function(){return this._settledValue()};n.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()};n.PromiseInspection=t}},{}],33:[function(n,t){"use strict";t.exports=function(t,i){function f(n,u){var e,f;if(c(n)){if(n instanceof t)return n;if(e=o(n),e===r)return u&&u._pushContext(),f=t.reject(e.e),u&&u._popContext(),f;if("function"==typeof e)return s(n)?(f=new t(i),n._then(f._fulfill,f._reject,void 0,f,null),f):h(n,e,u)}return n}function e(n){return n.then}function o(n){try{return e(n)}catch(t){return r.e=t,r}}function s(n){return l.call(n,"_promise0")}function h(n,f,e){function c(n){o&&(o._resolveCallback(n),o=null)}function l(n){o&&(o._rejectCallback(n,s,!0),o=null)}var o=new t(i),a=o,s,h;return e&&e._pushContext(),o._captureStackTrace(),e&&e._popContext(),s=!0,h=u.tryCatch(f).call(n,c,l),s=!1,o&&h===r&&(o._rejectCallback(h.e,!0,!0),o=null),a}var u=n("./util"),r=u.errorObj,c=u.isObject,l={}.hasOwnProperty;return f}},{"./util":36}],34:[function(n,t){"use strict";t.exports=function(t,i,r){function u(n){this.handle=n}function e(n){return clearTimeout(this.handle),n}function o(n){throw clearTimeout(this.handle),n;}var l=n("./util"),s=t.TimeoutError,h,f,c;u.prototype._resultCancelled=function(){clearTimeout(this.handle)};h=function(n){return f(+this).thenReturn(n)};f=t.delay=function(n,f){var e,o;return void 0!==f?(e=t.resolve(f)._then(h,null,null,n,void 0),r.cancellation()&&f instanceof t&&e._setOnCancel(f)):(e=new t(i),o=setTimeout(function(){e._fulfill()},+n),r.cancellation()&&e._setOnCancel(new u(o))),e._setAsyncGuaranteed(),e};t.prototype.delay=function(n){return f(n,this)};c=function(n,t,i){var r;r="string"!=typeof t?t instanceof Error?t:new s("operation timed out"):new s(t);l.markAsOriginatingFromRejection(r);n._attachExtraTrace(r);n._reject(r);null!=i&&i.cancel()};t.prototype.timeout=function(n,t){n=+n;var i,f,s=new u(setTimeout(function(){i.isPending()&&c(i,t,f)},n));return r.cancellation()?(f=this.then(),i=f._then(e,o,void 0,s,void 0),i._setOnCancel(s)):i=this._then(e,o,void 0,s,void 0),i}}},{"./util":36}],35:[function(n,t){"use strict";t.exports=function(t,i,r,u,f,e){function c(n){setTimeout(function(){throw n;},0)}function v(n){var t=r(n);return t!==n&&"function"==typeof n._isDisposable&&"function"==typeof n._getDisposer&&n._isDisposable()&&t._setDisposable(n._getDisposer()),t}function y(n,i){function u(){if(e>=s)return o._fulfill();var f=v(n[e++]);if(f instanceof t&&f._isDisposable()){try{f=r(f._getDisposer().tryDispose(i),n.promise)}catch(h){return c(h)}if(f instanceof t)return f._then(u,c,null,null,null)}u()}var e=0,s=n.length,o=new t(f);return u(),o}function o(n,t,i){this._data=n;this._promise=t;this._context=i}function s(n,t,i){this.constructor$(n,t,i)}function p(n){return o.isDisposer(n)?(this.resources[this.index]._setDisposable(n),n.promise()):n}function l(n){this.length=n;this.promise=null;this[n-1]=null}var h=n("./util"),w=n("./errors").TypeError,b=n("./util").inherits,a=h.errorObj,k=h.tryCatch;o.prototype.data=function(){return this._data};o.prototype.promise=function(){return this._promise};o.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null};o.prototype.tryDispose=function(n){var i=this.resource(),t=this._context,r;return void 0!==t&&t._pushContext(),r=null!==i?this.doDispose(i,n):null,void 0!==t&&t._popContext(),this._promise._unsetDisposable(),this._data=null,r};o.isDisposer=function(n){return null!=n&&"function"==typeof n.resource&&"function"==typeof n.tryDispose};b(s,o);s.prototype.doDispose=function(n,t){var i=this.data();return i.call(n,n,t)};l.prototype._resultCancelled=function(){for(var i,r=this.length,n=0;r>n;++n)i=this[n],i instanceof t&&i.cancel()};t.using=function(){var s=arguments.length,c,w,g,f,u,tt,nt,b,n,d,v;if(2>s)return i("you must pass at least 2 arguments to Promise.using");if(c=arguments[s-1],"function"!=typeof c)return i("expecting a function but got "+h.classString(c));for(g=!0,2===s&&Array.isArray(arguments[0])?(w=arguments[0],s=w.length,g=!1):(w=arguments,s--),f=new l(s),n=0;s>n;++n)u=w[n],o.isDisposer(u)?(tt=u,u=u.promise(),u._setDisposable(tt)):(nt=r(u),nt instanceof t&&(u=nt._then(p,null,null,{resources:f,index:n},void 0))),f[n]=u;for(b=new Array(f.length),n=0;n<b.length;++n)b[n]=t.resolve(f[n]).reflect();return d=t.all(b).then(function(n){for(var i,r,u,t=0;t<n.length;++t){if(i=n[t],i.isRejected())return a.e=i.error(),a;if(!i.isFulfilled())return void d.cancel();n[t]=i.value()}return v._pushContext(),c=k(c),r=g?c.apply(void 0,n):c(n),u=v._popContext(),e.checkForgottenReturns(r,u,"Promise.using",v),r}),v=d.lastly(function(){var n=new t.PromiseInspection(d);return y(f,n)}),f.promise=v,v._setOnCancel(f),v};t.prototype._setDisposable=function(n){this._bitField=131072|this._bitField;this._disposer=n};t.prototype._isDisposable=function(){return(131072&this._bitField)>0};t.prototype._getDisposer=function(){return this._disposer};t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField;this._disposer=void 0};t.prototype.disposer=function(n){if("function"==typeof n)return new s(n,this,u());throw new w;}}},{"./errors":12,"./util":36}],36:[function(n,t){"use strict";function p(){try{var n=s;return s=null,n.apply(this,arguments)}catch(t){return o.e=t,o}}function w(n){return s=n,p}function f(n){return null==n||n===!0||n===!1||"string"==typeof n||"number"==typeof n}function b(n){return"function"==typeof n||"object"==typeof n&&null!==n}function k(n){return f(n)?new Error(u(n)):n}function d(n,t){for(var u=n.length,r=new Array(u+1),i=0;u>i;++i)r[i]=n[i];return r[i]=t,r}function g(n,t,r){if(!i.isES5)return{}.hasOwnProperty.call(n,t)?n[t]:void 0;var u=Object.getOwnPropertyDescriptor(n,t);if(null!=u)return null==u.get&&null==u.set?u.value:r}function c(n,t,r){if(f(n))return n;var u={value:r,configurable:!0,enumerable:!1,writable:!0};return i.defineProperty(n,t,u),n}function nt(n){throw n;}function tt(n){try{if("function"==typeof n){var t=i.names(n.prototype),r=i.isES5&&t.length>1,u=t.length>0&&!(1===t.length&&"constructor"===t[0]),f=yt.test(n+"")&&i.names(n).length>0;if(r||u||f)return!0}return!1}catch(e){return!1}}function it(n){function t(){}t.prototype=n;for(var i=8;i--;)new t;return n}function rt(n){return pt.test(n)}function ut(n,t,i){for(var u=new Array(n),r=0;n>r;++r)u[r]=t+r+i;return u}function u(n){try{return n+""}catch(t){return"[no string representation]"}}function l(n){return null!==n&&"object"==typeof n&&"string"==typeof n.message&&"string"==typeof n.name}function ft(n){try{c(n,"isOperational",!0)}catch(t){}}function et(n){return null==n?!1:n instanceof Error.__BluebirdErrorTypes__.OperationalError||n.isOperational===!0}function e(n){return l(n)&&i.propertyIsWritable(n,"stack")}function a(n){return{}.toString.call(n)}function ot(n,t,r){for(var f,e=i.names(n),u=0;u<e.length;++u)if(f=e[u],r(f))try{i.defineProperty(t,f,i.getDescriptor(n,f))}catch(o){}}function st(n,t){return h?process.env[n]:t}function ht(){if("function"==typeof Promise)try{var n=new Promise(function(){});if("[object Promise]"==={}.toString.call(n))return Promise}catch(t){}}var i=n("./es5"),ct="undefined"==typeof navigator,o={e:{}},s,lt="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,at=function(n,t){function i(){this.constructor=n;this.constructor$=t;for(var i in t.prototype)r.call(t.prototype,i)&&"$"!==i.charAt(i.length-1)&&(this[i+"$"]=t.prototype[i])}var r={}.hasOwnProperty;return i.prototype=t.prototype,n.prototype=new i,n.prototype},vt=function(){var n=[Array.prototype,Object.prototype,Function.prototype],r=function(t){for(var i=0;i<n.length;++i)if(n[i]===t)return!0;return!1},u,t;return i.isES5?(u=Object.getOwnPropertyNames,function(n){for(var h,e,t,o,f=[],s=Object.create(null);null!=n&&!r(n);){try{h=u(n)}catch(c){return f}for(e=0;e<h.length;++e)t=h[e],s[t]||(s[t]=!0,o=Object.getOwnPropertyDescriptor(n,t),null!=o&&null==o.get&&null==o.set&&f.push(t));n=i.getPrototypeOf(n)}return f}):(t={}.hasOwnProperty,function(i){var f,u,e;if(r(i))return[];f=[];n:for(u in i)if(t.call(i,u))f.push(u);else{for(e=0;e<n.length;++e)if(t.call(n[e],u))continue n;f.push(u)}return f})}(),yt=/this\s*\.\s*\S+\s*=/,pt=/^[a-z$_][a-z$_0-9]*$/i,wt=function(){return"stack"in new Error?function(n){return e(n)?n:new Error(u(n))}:function(n){if(e(n))return n;try{throw new Error(u(n));}catch(t){return t}}}(),v=function(n){return i.isArray(n)?n:null},y,h,r;"undefined"!=typeof Symbol&&Symbol.iterator&&(y="function"==typeof Array.from?function(n){return Array.from(n)}:function(n){for(var t,i=[],r=n[Symbol.iterator]();!(t=r.next()).done;)i.push(t.value);return i},v=function(n){return i.isArray(n)?n:null!=n&&"function"==typeof n[Symbol.iterator]?y(n):null});h="undefined"!=typeof process&&"[object process]"===a(process).toLowerCase();r={isClass:tt,isIdentifier:rt,inheritedDataKeys:vt,getDataPropertyOrDefault:g,thrower:nt,isArray:i.isArray,asArray:v,notEnumerableProp:c,isPrimitive:f,isObject:b,isError:l,canEvaluate:ct,errorObj:o,tryCatch:w,inherits:at,withAppended:d,maybeWrapAsError:k,toFastProperties:it,filledRange:ut,toString:u,canAttachTrace:e,ensureErrorObject:wt,originatesFromRejection:et,markAsOriginatingFromRejection:ft,classString:a,copyDescriptors:ot,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:h,env:st,global:lt,getNativePromise:ht};r.isRecentNode=r.isNode&&function(){var n=process.versions.node.split(".").map(Number);return 0===n[0]&&n[1]>10||n[0]>0}();r.isNode&&r.toFastProperties(process);try{throw new Error;}catch(bt){r.lastLineError=bt}t.exports=r},{"./es5":13}]},{},[4])(4)});"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise);
(function(n,t){function f(n){return typeof n!="string"?n:n.replace(/&(\s|[^#\w]|\w+(?:[^;\w]|$))/g,"&amp;$1").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br/>")}function u(n){return n.nodeName!==undefined}var i={options:{anchor:"left,bottom",anchorToBorder:!1,direction:"right,down",offset:"0,0",arrow:"up",arrowPosition:"-1",showArrow:!0,cssClassName:"asc-popup"},_visible:!1,_arrow:null,_arrowWidth:0,_arrowHeight:0,_arrowSize:{},_create:function(){var i=n('<div class="arrow" style="margin:0;"/>'),t;this.element.hide().addClass(this.options.cssClassName).append(i).appendTo("body");this._arrow=i;t=this._arrowSize[this.options.cssClassName];t||(t=this._arrowSize[this.options.cssClassName]={width:this._arrow.outerWidth(!0),height:this._arrow.outerHeight(!0)});this._arrowWidth=t.width;this._arrowHeight=t.height},_makeVArrow:function(n,t,i){var r=0,f;return n==="up"?(this.element.css("margin",this._arrowHeight+1+"px 0 0 0"),this._arrow.css("top",(r=-this._arrowHeight)+"px").css("background-position","0px 0px")):(this.element.css("margin","0 0 "+(this._arrowHeight+1)+"px 0"),this._arrow.css("top",(r=this.element.outerHeight(!0)-3-this._arrowHeight)+"px").css("background-position",-2*this._arrowWidth+"px 0px")),f=Math.floor((t=="left"?0:this.element.outerWidth(!0))+(t=="left"?1:-1)*Math.min(u(i[0])?this.options.anchorToBorder?i.outerWidth():i.width():0,this.element.outerWidth(!0))*.5-this._arrowWidth*.5),this._arrow.css("width",this._arrowWidth+"px").css("height",this._arrowHeight+"px").css("right","").css("bottom","").css("left",f+"px"),{x:f,y:r}},_makeHArrow:function(n,t,i){var r=0,f;return n==="left"?(this.element.css("margin","0 0 0 "+(this._arrowHeight+1)+"px"),this._arrow.css("left",(r=-this._arrowHeight)+"px").css("background-position",-3*this._arrowWidth+"px 0px")):(this.element.css("margin","0 "+(this._arrowHeight+1)+"px 0 0"),this._arrow.css("left",(r=this.element.outerWidth(!0)-3-this._arrowHeight)+"px").css("background-position",-1*this._arrowWidth+"px 0px")),f=Math.floor((t=="top"?0:this.element.outerHeight(!0))+(t=="top"?1:-1)*Math.min(u(i[0])?this.options.anchorToBorder?i.outerHeight():i.height():0,this.element.outerHeight(!0))*.5-this._arrowWidth*.5),this._arrow.css("width",this._arrowHeight+"px").css("height",this._arrowWidth+"px").css("right","").css("bottom","").css("top",f+"px"),{x:r,y:f}},_moveArrow:function(n,t,i){var f,r,e,u;return i<0?{x:0,y:0}:n==="up"||n==="down"?(f=this.element.outerWidth(!0),r=Math.floor(f*i*.01-this._arrowWidth*.5),r=r<0?0:r+this._arrowWidth>f?f-this._arrowWidth:r,this._arrow.css("left",r+"px"),{x:t.x-r,y:0}):(e=this.element.outerHeight(!0),u=Math.floor(e*i*.01-this._arrowWidth*.5),u=u<0?0:u+this._arrowWidth>e?e-this._arrowWidth:u,this._arrow.css("top",u+"px"),{x:0,y:t.y-u})},_parsePageX:function(i){var u=n(t),e=n("#studioPageContent"),r=/^\s*(\d+|left|right|center)/i.exec(i),f;return r||(r="center"),f=parseInt(r[1],10),isNaN(f)?"left"===r[1]?0:"right"===r[1]?u.width():u.width()<e.width()?Math.round((e.width()-this.element.outerWidth(!0))*.5):Math.round((u.width()-this.element.outerWidth(!0))*.5):f},_parsePageY:function(i){var f=n(t),r=/^\s*(\d+|top|bottom|center)/i.exec(i),u;return r||(r="center"),u=parseInt(r[1],10),isNaN(u)?"top"===r[1]?0:"bottom"===r[1]?f.height():Math.round((f.height()-this.element.outerHeight(!0))*.5):u},updatePosition:function(t){var i=n(t),f=u(i[0]),s=this.options.anchor.match(/^\s*(left|right)\s*,\s*(top|bottom)/i),h=this.options.direction.match(/^\s*(left|right)\s*,\s*(up|down)/i),e=this.options.offset.match(/^\s*([+-]?\d+(\.\d+)?)\s*(px)?\s*,\s*([+-]?\d+(\.\d+)?)\s*(px)?/i),v=this.options.arrow.match(/^\s*(left|right|up|down)/i),y=this.options.arrowPosition.match(/^\s*([+-]?\d+(\.\d+)?)\s*(%)?/i),l,a;if(s&&h&&e&&v){(!i||i.length<1||!f)&&(i.pageX=this._parsePageX(i.pageX||i[0].pageX),i.pageY=this._parsePageY(i.pageY||i[0].pageY));var p=s[1].toLowerCase(),w=s[2].toLowerCase(),g=h[1].toLowerCase(),nt=h[2].toLowerCase(),b={x:e[1]!=undefined?parseInt(e[1]):0,y:e[4]!=undefined?parseInt(e[4]):0},o=v[1],c=y[1]!=undefined?parseInt(y[1]):-1,k=0,d=0,r;o==="up"||o==="down"?(r=this._makeVArrow(o,p,i),c<0&&r.x<0&&(r.x=0,this._arrow.css("left","0"))):(r=this._makeHArrow(o,w,i),c<0&&r.y<0&&(r.y=0,this._arrow.css("top","0")));l=this.options.showArrow?this._moveArrow(o,r,c):{x:0,y:0};this.options.showArrow?this._arrow.show():(this._arrow.hide(),this.element.css("margin-top","4px"));a=f?i.offset():undefined;k=(f?a.left+(p==="left"?0:i.outerWidth()):i.pageX)+(g==="left"&&f?-this.element.outerWidth(!0):0)+l.x+b.x;d=(f?a.top+(w==="top"?0:i.outerHeight()):i.pageY)+(nt==="up"&&f?-this.element.outerHeight(!0):0)+l.y+b.y;this.element.css("left",k+"px").css("right","");this.element.css("top",d+"px").css("bottom","")}},open:function(n){if(this._visible){this.close();return}this.updatePosition(n);this.element.show();this._visible=!0},hide:function(){this.element.hide()},show:function(){this.element.show()},close:function(){this.element[0].style.display!="none"&&this.element.hide();this._visible=!1},isVisible:function(){return this._visible},destroy:function(){this.element.text("");n.Widget.prototype.destroy.call(this)}},e={options:{showModal:!1},_uiBlocker:undefined,_createUIBlocker:function(){var t=this.element.attr("id");(!t||t.length<1)&&(t=this.element.attr("class").replace(/^\s*(\S+)/i,"$1"));(!t||t.length<1)&&(t="asc-ui-blocker");t+="-outer";this._uiBlocker=n('<div id="'+t+'"><div class="asc-ui-blocker"/><\/div>').appendTo("body").append(this.element).find(".asc-ui-blocker").hide()},_tryClose:function(n){var t=n.data.thisObj;return!1==t._trigger("beforeClose",n)?!1:(t.close(n),!0)},_blockScreen:function(){var n=this;n.options.showModal&&(n._uiBlocker==undefined&&n._createUIBlocker(),n._uiBlocker.off("click",n._tryClose).on("click",{thisObj:n},n._tryClose).show())},_unblockScreen:function(){this._uiBlocker!=undefined&&this._uiBlocker.hide()},open:function(n){this._blockScreen();i.open.call(this,n)},close:function(n){i.close.call(this);this._unblockScreen();this._trigger("close",n)},replaceUIBlocker:function(t){var i=n(t),r;this._uiBlocker&&this._uiBlocker.length>0&&i&&i.length>0&&(r=this.element.parent(),this.element.appendTo("body"),r.remove());this._uiBlocker=i}},o,r,s;n.widget("asc.popupFrame",n.extend(!0,{},i,e));o={options:{cssClassName:"asc-popupmenu",closeTimeout:1500,divider:"divider",items:[]},_closeTimer:0,_closeOnMouseleave:!0,_label:undefined,_create:function(){i._create.call(this);var r=this;if(r._closeOnMouseleave=r.options.closeTimeout>=0,r._closeOnMouseleave)r.element.on("mouseenter",function(){r._stopCloseTimer()}).on("mouseleave",function(){r.close()});else n(t.document).on("mousedown",r,r._outerClick);n.each(r.options.items,function(t,i){i===r.options.divider||i.label===r.options.divider?n("<div class='divider'/>").appendTo(r.element):n("<div class='item "+(i.cssClass!==undefined?f(i.cssClass):"")+"'>"+f(typeof i=="string"?i:i.label)+"<\/div>").on("click",{itemIndex:t,item:i},function(n){r._itemClick(n)}).appendTo(r.element)})},_outerClick:function(t){var r=t.data;i.isVisible.call(r)&&(n.contains(r.element[0],t.target)||r._label[0]===t.target||r.close())},_itemClick:function(n){this.close();var t=typeof n.data.item.click=="function";typeof n.data.item!="string"&&t?t&&(n.data.item.click.call(this.element[0],n,n.data),typeof n.data.item.toggle=="function"&&(n.data.item.toggle.call(this.element[0],n,n.data),this.element.find(".item:eq("+n.data.itemIndex+")").text(n.data.item.label))):this._trigger("itemClick",n,n.data)},_startCloseTimer:function(){var n=this;n._closeTimer=setTimeout(function(){n.close()},n.options.closeTimeout)},_stopCloseTimer:function(){clearTimeout(this._closeTimer)},open:function(n){this._label=n;i.open.call(this,n);this._closeOnMouseleave&&this[i.isVisible.call(this)?"_startCloseTimer":"_stopCloseTimer"].call(this)},close:function(){this._closeOnMouseleave&&this._stopCloseTimer();i.close.call(this)},destroy:function(){n(t.document).off("mousedown",this._outerClick);i.destroy.call(this)},click:function(n){this.element.find(".item:eq("+n+")").trigger("click")}};n.widget("asc.popupMenu",n.extend(!0,{},i,o));r=n.extend(!0,{},i,e);s={options:{cssClassName:"asc-colorpicker",colors:{0:["#ff0000","#ff2f00","#ff5e00","#ff8d00","#ffbc00","#ffec00","#e2ff00","#b3ff00","#84ff00","#54ff00","#25ff00","#00ff09","#00ff38","#00ff67","#00ff97","#00ffc6","#00fff5","#00d9ff","#00a9ff","#007aff","#004bff","#001cff","#1200ff","#4200ff","#7100ff","#a000ff","#cf00ff","#ff00fe","#ffffff","#d5d5d5","#aaaaaa","#808080","#555555","#2b2b2b","#000000"]},colorSet:0,selectedColor:""},_table:undefined,_input:undefined,_previewIcon:undefined,_create:function(){var e,h;r._create.call(this);var t=this,o=t.options.columns&&t.options.columns>0?t.options.columns:Math.ceil(Math.sqrt(t.options.colors[t.options.colorSet].length))+1,i="",s=-1,c=t._parseColor(t.options.selectedColor),u,f;for(e=0;e<t.options.colors[t.options.colorSet].length;++e){for(s=e%o,s==0&&(i+=i.length<1?"<tbody><tr>":"<\/tr><tr>"),u=t._parseColor(t.options.colors[t.options.colorSet][e]),f=(Math.round(u.r*.9)<<16|Math.round(u.g*.9)<<8|Math.round(u.b*.9)).toString(16);f.length<6;)f="0"+f;i+="<td "+(c&&c.color==u.color?'class="selected"':"")+'><div class="icon" style="background-color:'+u.origColor+"; border: 1px solid #"+f+'"/><\/td>'}h=o-1-s;i+=(h>0?'<td class="remainder" colspan="'+h+'"/>':"")+"<\/tr>";i+='<tr><td class="remainder"><div class="icon" style="background-color:#fff; border: 1px solid #eee"/><\/td><td class="remainder" colspan="'+(o-1)+'"><div class="iwrapper"><input type="text" value=""/><\/div><\/td><\/tr>';i+="<\/tbody>";t._table=n('<table border="0" cellspacing="0" cellpadding="0">'+i+"<\/table>").on("click",function(n){t._cellClick(n)});t._previewIcon=t._table.find("tr:last .icon");t._table.find("td:not(.remainder)").on("mouseenter",function(n){t._cellHover(n)});t._input=t._table.find("input").on("keyup",function(n){t._keyUp(n)});t.element.append(t._table);t.element.on("keyup",function(n){t._checkEscKey(n)})},_parseColor:function(n){var o=/\s*#([0-9a-f]{6}\s*$|[0-9a-f]{3}\s*$)|\s*rgba?\(\s*([0-9]+\s*,\s*[0-9]+\s*,\s*[0-9]+\s*(?:,\s*(?:[0-9]+(?:\.[0-9]+)?|[0-9]*\.[0-9]+))?)\s*\)/i.exec(n),e,f;if(!o)return null;var t=/^([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$|^([0-9a-f])([0-9a-f])([0-9a-f])$|^([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3})(?:,\s*([0-9.]+))?$/i.exec(o[1]||o[2]),s=typeof t[1]=="string"||typeof t[4]=="string"?0:typeof t[10]=="string"?2:1,i=t[1]||t[4],r=t[2]||t[5],u=t[3]||t[6];for(i=i?parseInt(i.length>1?i:i+i,16):parseInt(t[7],10),r=r?parseInt(r.length>1?r:r+r,16):parseInt(t[8],10),u=u?parseInt(u.length>1?u:u+u,16):parseInt(t[9],10),e=t[10],e=e?Math.round(parseFloat(e)*100)*.01:1,f=(i<<16|r<<8|u).toString(16);f.length<6;)f="0"+f;f="#"+f;var h=i+", "+r+", "+u,c="rgb("+h+")",l="rgba("+h+", "+e+")";return{type:s,r:i,g:r,b:u,a:e,rgb:c,rgba:l,color:f,origColor:s===0?f:s===1?c:l}},_selectCell:function(){var t=this,i=t._parseColor(t.options.selectedColor);t._table.find("td.selected").removeClass("selected");i&&t._table.find("td:not(.remainder)").each(function(){var r=n(this);return i.color==t._parseColor(r.find(".icon").css("background-color")).color?(r.addClass("selected"),!1):!0})},_cellClick:function(t){var i=this,r=n(t.target),u;r.hasClass("icon")&&(i._table.find("td.selected").removeClass("selected"),u=r.parent(),u.hasClass("remainder")||u.addClass("selected"),i.options.selectedColor=r.css("background-color"),i._trigger("select",t,i.options.selectedColor),i.close())},_cellHover:function(t){var r=this,i;r._table.find("td").removeClass("highlighted");i=n(t.target);i.toggleClass("highlighted")},_updatePreviewIcon:function(n){var r=this,t=r._parseColor(n),i;if(t){for(i=(Math.round(t.r*.9)<<16|Math.round(t.g*.9)<<8|Math.round(t.b*.9)).toString(16);i.length<6;)i="0"+i;r._previewIcon.css("background-color",t.color).css("border","1px solid #"+i)}},_keyUp:function(n){var t=this,i;this._updatePreviewIcon(this._input.val());n.which==13&&(i=t._parseColor(t._input.val()),i&&(t.options.selectedColor=i.origColor,t._trigger("select",n,t.options.selectedColor),t.close()))},_checkEscKey:function(n){var t=this;n.which==27&&(t.isVisible()&&n.stopPropagation(),t.close())},open:function(n){r.open.call(this,n);this._selectCell();var t=this._parseColor(this.options.selectedColor);this._input.val(t?t.color:"");this._input.trigger("focus");this._updatePreviewIcon(this._input.val())}};n.widget("asc.colorPicker",n.extend(!0,{},r,s))})(jQuery,window);
typeof ASC=="undefined"&&(ASC={});jq.ajaxSetup({cache:!1});typeof ASC.Api=="undefined"&&(ASC.Api={});ASC.Api.TypeConverter=new function(){this.ClientTimeToServer=function(n,t){var i=new Date,o=new Date(n).getTimezoneOffset();t!=undefined&&(o=-1*t);i.setTime(n.getTime()+o*6e4);var r=i.getMonth()+1,u=i.getDate(),f=i.getHours(),e=i.getMinutes();return i.getFullYear()+"-"+(r>9?r:"0"+r)+"-"+(u>9?u:"0"+u)+"T"+(f>9?f:"0"+f)+"-"+(e>9?e:"0"+e)+"-00.000Z"};this.ServerTimeToClient=function(n){var r=n.replace(/\..*/gi,""),t=r.split("T")[0].split("-"),i=r.split("T")[1].split(":");return new Date(t[0],t[1]-1,t[2],i[0],i[1],i[2])}};ASC.CalendarSizeManager=new function(){function t(n){return(parseFloat(n.paddingTop)||0)+(parseFloat(n.paddingBottom)||0)}function i(n){return(parseFloat(n.borderTopWidth)||0)+(parseFloat(n.borderBottomWidth)||0)}function r(n){return(parseFloat(n.marginTop)||0)+(parseFloat(n.marginBottom)||0)}function u(n){return(parseFloat(n.paddingLeft)||0)+(parseFloat(n.paddingRight)||0)}function f(n){return(parseFloat(n.borderLeftWidth)||0)+(parseFloat(n.borderRightWidth)||0)}function e(n){return(parseFloat(n.marginLeft)||0)+(parseFloat(n.marginRight)||0)}function o(){var s,h,v,c,y,l,a,o;n={};n.topPanelHeight=document.querySelector("#studioPageContent .studio-top-panel").clientHeight;n.barContentHeight=document.querySelector("main .bar-content").clientHeight;n.fcHeaderHeight=document.querySelector(".fc-header-outer").clientHeight;n.fcMonthContentTheadHeight=document.querySelector(".fc-border-separate thead").clientHeight;s=document.querySelector(".fc-border-separate tbody td.fc-widget-content.fc-day0");h=window.getComputedStyle(s);n.fcMonthContentCellVPaddings=t(h);n.fcMonthContentCellVBorders=i(h);n.fcMonthContentCellVMargins=r(h);n.fcMonthContentCellVSides=n.fcMonthContentCellVPaddings+n.fcMonthContentCellVBorders+n.fcMonthContentCellVMargins;v=s.querySelector(".fc-day-number");n.fcMonthContentCellNumberHeight=s.clientHeight;c=window.getComputedStyle(v);n.fcMonthContentCellNumberVPaddings=t(c);n.fcMonthContentCellNumberVBorders=i(c);n.fcMonthContentCellNumberVMargins=r(c);n.fcMonthContentCellNumberVSides=n.fcMonthContentCellNumberVPaddings+n.fcMonthContentCellNumberVBorders+n.fcMonthContentCellNumberVMargins;y=s.querySelector(".fc-day-number");n.fcMonthContentCellContentMaxHeight=150;l=window.getComputedStyle(y);n.fcMonthContentCellContentVPaddings=t(l);n.fcMonthContentCellContentVBorders=i(l);n.fcMonthContentCellContentVMargins=r(l);n.fcMonthContentCellContentVSides=n.fcMonthContentCellContentVPaddings+n.fcMonthContentCellContentVBorders+n.fcMonthContentCellContentVMargins;a=document.querySelector(".fc-event-skin-day");n.fcMonthContentCellContentSegmentHeight=a.clientHeight;o=window.getComputedStyle(a);n.fcMonthContentCellContentSegmentVPaddings=t(o);n.fcMonthContentCellContentSegmentVBorders=i(o);n.fcMonthContentCellContentSegmentVMargins=r(o);n.fcMonthContentCellContentSegmentVSides=n.fcMonthContentCellContentSegmentVPaddings+n.fcMonthContentCellContentSegmentVBorders+n.fcMonthContentCellContentSegmentVMargins;n.fcMonthContentCellContentSegmentHPaddings=u(o);n.fcMonthContentCellContentSegmentHBorders=f(o);n.fcMonthContentCellContentSegmentHMargins=e(o);n.fcMonthContentCellContentSegmentHSides=n.fcMonthContentCellContentSegmentHPaddings+n.fcMonthContentCellContentSegmentHBorders+n.fcMonthContentCellContentSegmentHMargins}var n={topPanelHeight:48,barContentHeight:0,fcHeaderHeight:36,fcMonthContentTheadHeight:18,fcMonthContentCellVPaddings:0,fcMonthContentCellVBorders:2,fcMonthContentCellVMargins:0,fcMonthContentCellVSides:2,fcMonthContentCellNumberHeight:22,fcMonthContentCellNumberVPaddings:3,fcMonthContentCellNumberVBorders:0,fcMonthContentCellNumberVMargins:0,fcMonthContentCellNumberVSides:3,fcMonthContentCellContentMaxHeight:150,fcMonthContentCellContentVPaddings:3,fcMonthContentCellContentVBorders:0,fcMonthContentCellContentVMargins:0,fcMonthContentCellContentVSides:3,fcMonthContentCellContentSegmentHeight:18,fcMonthContentCellContentSegmentVPaddings:0,fcMonthContentCellContentSegmentVBorders:2,fcMonthContentCellContentSegmentVMargins:3,fcMonthContentCellContentSegmentVSides:5,fcMonthContentCellContentSegmentHPaddings:0,fcMonthContentCellContentSegmentHBorders:0,fcMonthContentCellContentSegmentHMargins:2,fcMonthContentCellContentSegmentHSides:2,fcMainPadding:26};return{refresh:o,cache:n}};ASC.CalendarController=new function(){var o=function(n){if(!n||"object"!=typeof n)return n;var r="function"==typeof n.pop?[]:{},i,t;for(i in n)n.hasOwnProperty(i)&&(t=n[i],r[i]=t&&"object"==typeof t?o(t):t);return r},e,r,l;this.ApiUrl="";this.Busy=!1;this.Search=!1;var t=this,n=null,f=null,u;this.characterString="@&<>";this.characterRegExp=new RegExp("[<>@&]","gim");var i=function(n){alert(n)},s=function(n){var t,i;if(!n||n.length<4)return null;t=new ICAL.Property(n[0]);for(i in n[1])t.setParameter(i,n[1][i]);return t.setValue(n[3]),t},h=function(n,t,i,r,u,f,e,o,h,c,l,a,v,y,p,w){var ot=new Date(r.getTime()),g=new Date(r.getTime()),b,rt,st,ht,k,it,tt,ut,ft,et,lt;u&&u!="null"&&(g=new Date(u.getTime()));var ct=new ICAL.Component(["vcalendar",[],[]]),d=new ICAL.Component("vevent"),nt=new ICAL.Component("valarm");if(e>0){b={};switch(e){case 1:b.minutes=5;b.isNegative=!0;break;case 2:b.minutes=15;b.isNegative=!0;break;case 3:b.minutes=30;b.isNegative=!0;break;case 4:b.hours=1;b.isNegative=!0;break;case 5:b.hours=2;b.isNegative=!0;break;case 6:b.days=1;b.isNegative=!0}nt.addPropertyWithValue("TRIGGER",new ICAL.Duration(b).toICALString());nt.addPropertyWithValue("ACTION","DISPLAY");nt.addPropertyWithValue("DESCRIPTION","Reminder")}else nt=null;if(f&&d.addPropertyWithValue("RRULE",f),rt="TENTATIVE",y==1?rt="CONFIRMED":y==2&&(rt="CANCELLED"),d.addPropertyWithValue("STATUS",rt),a&&(st=s(a),st&&d.addProperty(st)),v&&v.length)for(k=0;k<v.length;k++)ht=s(v[k]),ht&&d.addProperty(ht);if(p&&p.length)for(k=0;k<p.length;k++)it=new ICAL.Property("ATTACH"),it.setParameter("FILENAME",p[k].title),p[k].contentType&&it.setParameter("FMTTYPE",p[k].contentType),it.setValue(p[k].fileUrl),d.addProperty(it);return tt=new ICAL.Event(d),tt.summary=t,tt.description=i,tt.location=l||"",ut=ICAL.Timezone.utcTimezone,o?g.setDate(g.getDate()+1):f?ut=new ICAL.Timezone({tzid:w.timeZoneId}):(ot=new Date(ot.getTime()+-6e4*w.startOffset),g=new Date(g.getTime()+-6e4*w.endOffset)),ft=ICAL.Time.fromJSDate(ot,!1),ft.zone=ut,et=ICAL.Time.fromJSDate(g,!1),et.zone=ut,ft.isDate=o,et.isDate=o,tt.startDate=ft,tt.endDate=et,nt!=null&&d.addSubcomponent(nt),ct.addSubcomponent(d),lt=ct.toString(),{calendarId:n,alertType:e,sharingOptions:c,ics:lt}},c=function(n,t,i,r,u,f){var e=r?r.getTime()!=new Date(1,0,1,23,59,59).getTime()?new Date(r.getTime()):null:null,l=new ICAL.Component(["vcalendar",[],[]]),a=new ICAL.Component("vtodo"),s=new ICAL.Event(a),o,h,c,v;return s.summary=t,s.description=i?i:"",o=ICAL.Time.fromJSDate(new Date),o.zone=ICAL.Timezone.utcTimezone,h=new Date,c=ICAL.Time.fromJSDate(new Date(h.getTime()+h.getTimezoneOffset()*6e4)),c.zone=ICAL.Timezone.utcTimezone,e!=null&&(e=new Date(e.getTime()+e.getTimezoneOffset()*6e4),o=ICAL.Time.fromJSDate(e,!1),o.zone=ICAL.Timezone.utcTimezone,s.startDate=o),f&&s._setProp("completed",c),l.addSubcomponent(a),v=l.toString(),{calendarId:n,ics:v}};this.init=function(n,t){var f,e,u,c,i;jq(".mainPageTable.with-mainPageTableSidePanel .mainPageContent").addClass("calendar");f=jq("link[rel*=icon][type^='image']:last");f.attr("href").indexOf("logo_favicon_general.ico")!==-1&&f.attr("href",f.attr("href"));window.moment&&window.moment.locale(ASC.Resources.Master.TwoLetterISOLanguageName);jq(document).ajaxStart(function(){ASC.CalendarController.Search||LoadingBanner.displayLoading()});jq(document).ajaxStop(function(){ASC.CalendarController.Busy||LoadingBanner.hideLoading()});var s="month",r=new Date,h=null;try{ASC.Controls.AnchorController.init();e=ASC.Controls.AnchorController.getAnchor().split("/");s=e[0];u=e[1];r=u==""||u==undefined||isNaN(u)?new Date:new Date(parseInt(u));("Invalid Date"==r||r=="NaN")&&(r=new Date);h=e[2]||null}catch(v){r=new Date;s="month"}if(ASC.CalendarController.ApiUrl=ASC.Resources.Master.ApiPath+"calendar",c=jq(window).height()-(jq("#studioPageContent .mainContainer").length?jq("#studioPageContent .mainContainer").outerHeight(!0):0),i=null,jq(n).each(function(n,t){if(t.id==ASC.Resources.Master.CurrentTenantTimeZone.Id||t.name==ASC.Resources.Master.CurrentTenantTimeZone.DisplayName){i=t;return}}),i==null){var l=new Date,a=-1*l.getTimezoneOffset(),o=[];jq(n).each(function(n,t){t.offset==a&&o.push(t)});jq(o).each(function(n,t){if(l.toString().indexOf(t.id)>=0)return i=t,!1});o.length>0&&i==null&&(i=o[0])}if(i==null&&(i={id:"UTC",name:"UTC",offset:0}),jq("#asc_calendar").fullCalendar({defaultView:s,targetEventId:h,year:r.getFullYear(),month:r.getMonth(),date:r.getDate(),notifications:{editorUrl:t},selectable:!0,selectHelper:!0,editable:!0,padding:0,height:c,onHeightChange:function(){var n=ASC.CalendarSizeManager.cache;this.height=window.innerHeight-n.topPanelHeight-n.fcHeaderHeight-n.fcMainPadding-n.barContentHeight},characterRegExp:ASC.CalendarController.characterRegExp,loadEventSources:ASC.CalendarController.LoadCalendars,editCalendar:ASC.CalendarController.DoRequestToCalendar,editEvent:ASC.CalendarController.DoRequestToEvent,editTodo:ASC.CalendarController.DoRequestToTodo,editPermissions:ASC.CalendarController.EditPermissions,getPermissions:ASC.CalendarController.GetPermissions,removePermissions:ASC.CalendarController.RemovePermissions,loadSubscriptions:ASC.CalendarController.LoadSubscriptions,manageSubscriptions:ASC.CalendarController.ManageSubscriptions,viewChanged:ASC.CalendarController.ViewChangedHandler,getiCalUrl:ASC.CalendarController.GetiCalUrl,getCaldavUrl:ASC.CalendarController.getCaldavUrl,defaultTimeZone:i,timeZones:n,getMonthEvents:ASC.CalendarController.GetEventDays,replaceSpecCharacter:ASC.CalendarController.ReplaceSpecCharacter,displayInfoPanel:ASC.CalendarController.displayInfoPanel,characterString:ASC.CalendarController.characterString}),new ResizeObserver(function(){var n=document.querySelector("main .bar-content").clientHeight;n!=ASC.CalendarSizeManager.cache.barContentHeight&&(ASC.CalendarSizeManager.cache.barContentHeight=n,jq("#asc_calendar").data().fullCalendar.updateSize())}).observe(document.querySelector("main .bar-content")),ASC.Mail.Enabled=!0,ASC.Mail.Accounts=[],ASC.Mail.DefaultAccount=null,ASC.Mail.Initialized=!1,Teamlab.profile.isVisitor){ASC.Mail.Enabled=!1;return}window.Teamlab.getAccounts({},{success:function(n,t){var i,r;t&&t.length&&(i=jq.grep(t,function(n){return n.enabled&&!n.isGroup}),jq.each(i,function(n,t){return(n==0&&(ASC.Mail.DefaultAccount={email:t.email,name:t.name||Teamlab.profile.displayName}),t.isDefault)?(ASC.Mail.DefaultAccount={email:t.email,name:t.name||Teamlab.profile.displayName},!1):!0}),ASC.Mail.Accounts=i,r=jq("#asc_event .editor .owner select"),jq.each(i,function(n,t){var i=t.name?Encoder.htmlEncode(t.name):Teamlab.profile.displayName,u=jq("<option/>").attr("value",t.email).attr("data-name",Encoder.htmlDecode(i)).html("{0} &lt;{1}&gt;".format(i,t.email));r.append(u)}),r.tlcombobox(),ASC.Mail.Initialized=!0)},error:function(n,t){ASC.Mail.Enabled=!1;ASC.Mail.Initialized=!0;console.log(t)}})};this.LoadCalendars=function(r,u,f){n=f;var e=encodeURIComponent(ASC.Api.TypeConverter.ClientTimeToServer(r)),o=encodeURIComponent(ASC.Api.TypeConverter.ClientTimeToServer(u));jq.ajax({type:"get",url:t.ApiUrl+"/calendars/"+e+"/"+o+".json",complete:function(t){var r=jq.evalJSON(t.responseText),u,e,o,s;if(r.status===0){for(u=0;u<r.response.length;u++){for(e=0;e<r.response[u].events.length;e++)r.response[u].events[e].start=ASC.Api.TypeConverter.ServerTimeToClient(r.response[u].events[e].start),r.response[u].events[e].end=ASC.Api.TypeConverter.ServerTimeToClient(r.response[u].events[e].end),r.response[u].events[e].repeatRule=ASC.Api.iCal.ParseRRuleFromString(r.response[u].events[e].repeatRule);if(r.response[u].todos&&r.response[u].todos.length>0)for(o=0;o<r.response[u].todos.length;o++){try{s=ASC.Api.TypeConverter.ServerTimeToClient(r.response[u].todos[o].completed)}catch(h){s=!1}r.response[u].todos[o].completed=s.getTime()==new Date(1,0,1).getTime()?!1:!0;r.response[u].todos[o].start=ASC.Api.TypeConverter.ServerTimeToClient(r.response[u].todos[o].start)}}return r.response.sort(function(n,t){return n.isSubscription==t.isSubscription?n.objectId<t.objectId?-1:n.objectId>t.objectId?1:0:n.isSubscription?1:-1}),f({result:!0,eventSources:r.response}),!0}n({result:!1});i(r.error.message)}})};this.getCaldavUrl=function(i,r){n=r;jq.ajax({type:"get",url:t.ApiUrl+"/"+i+"/caldavurl.json",complete:function(t){var i=jq.evalJSON(t.responseText);i.status===0?i.response.completed?n({result:!0,url:i.response.data}):(n({result:!0,url:""}),toastr.error(i.response.error),console.error("Radicale error answer: {0} {1}".format(i.response.statusCode,i.response.error))):(n({result:!1,url:""}),toastr.error(i.error.message))}})};this.GetiCalUrl=function(r,u){n=u;jq.ajax({type:"get",url:t.ApiUrl+"/"+r+"/icalurl.json",complete:function(t){var r=jq.evalJSON(t.responseText);r.status===0?n({result:!0,url:r.response}):(n({result:!1,url:""}),i(r.error.message))}})};this.CreateiCalStream=function(r,u,f,e){jq.ajax({type:"post",url:t.ApiUrl+"/calendarUrl.json",data:{iCalUrl:r,name:u,textColor:f,backgroundColor:e},complete:function(t){var r=jq.evalJSON(t.responseText);r.status===0?n({result:!0,source:r.response}):(n({result:!1}),i(r.error.message))}})};this.CreateCalendar=function(r,u,f,e,o,s,h,c){jq.ajax({type:"post",url:t.ApiUrl+".json",data:{name:r,description:u,textColor:f,backgroundColor:e,timeZone:o,alertType:s,sharingOptions:h,iCalUrl:c?c:null},complete:function(r){var u=jq.evalJSON(r.responseText);u.status===0?n({result:!0,source:u.response,importUrl:t.ApiUrl+"/"+u.response.objectId+"/import"}):(n({result:!1}),i(u.error.message))}})};this.UpdateCalendar=function(r,u,f,e,o,s,h,c,l,a){jq.ajax({type:"put",url:t.ApiUrl+"/"+r+".json",data:{name:u,description:f,textColor:e,backgroundColor:o,timeZone:s,alertType:h,hideEvents:c,sharingOptions:l,iCalUrl:a?a:null},complete:function(r){var u=jq.evalJSON(r.responseText);u.status===0?n({result:!0,source:u.response,importUrl:t.ApiUrl+"/"+u.response.objectId+"/import"}):(n({result:!1}),i(u.error.message))}})};this.RemoveCalendar=function(r){jq.ajax({type:"delete",url:t.ApiUrl+"/"+r+".json",complete:function(t){var r=jq.evalJSON(t.responseText);r.status===0?n({result:!0,source:undefined}):(n({result:!1}),i(r.error.message))}})};this.UpdateCalendarView=function(r,u,f,e,o,s,h){jq.ajax({type:"put",url:t.ApiUrl+"/"+r+"/view.json",data:{calendarId:r,name:u,textColor:f,backgroundColor:e,timeZone:o,alertType:s,hideEvents:h},complete:function(t){var r=jq.evalJSON(t.responseText);r.status===0?n({result:!0,source:r.response}):(n({result:!1}),i(r.error.message))}})};this.DoRequestToCalendar=function(i,r){var u,o,e,f;if(n=r,u=[],(i.action===1||i.action===2)&&i.permissions!=undefined&&i.permissions.data!=undefined)for(o=0;o<i.permissions.data.items.length;o++)(e=i.permissions.data.items[o],e.selectedAction.id!="owner")&&u.push({actionId:e.selectedAction.id,itemId:e.id,isGroup:e.isGroup});f=i.timeZone?i.timeZone.id:"UTC";i.action===1&&(i.iCalUrl==undefined||i.iCalUrl==null||i.iCalUrl=="")?t.CreateCalendar(i.title,i.description,i.textColor,i.backgroundColor,f,i.defaultAlert.type,u):i.action===1&&i.iCalUrl!=undefined&&i.iCalUrl!=null&&i.iCalUrl!=""&&i.withoutSync==!0?t.CreateCalendar(i.title,i.description,i.textColor,i.backgroundColor,f,i.defaultAlert.type,u,i.iCalUrl):i.action===1&&i.iCalUrl!=undefined&&i.iCalUrl!=null&&i.iCalUrl!=""?t.CreateiCalStream(i.iCalUrl,i.title,i.textColor,i.backgroundColor):i.action===2&&i.iCalUrl!=undefined&&i.iCalUrl!=null&&i.iCalUrl!=""?t.UpdateCalendar(i.objectId,i.title,i.description,i.textColor,i.backgroundColor,f,i.defaultAlert.type,i.isHidden,u,i.iCalUrl):i.action===2?t.UpdateCalendar(i.objectId,i.title,i.description,i.textColor,i.backgroundColor,f,i.defaultAlert.type,i.isHidden,u):i.action===3?t.RemoveCalendar(i.objectId):i.action===4?t.UpdateCalendarView(i.objectId,i.title,i.textColor,i.backgroundColor,f,i.defaultAlert.type,i.isHidden):i.action===5&&t.CancelEditDialog(i.permissions)};this.GetEventDays=function(r,u){n=u;var f=encodeURIComponent(ASC.Api.TypeConverter.ClientTimeToServer(r.startDate)),e=encodeURIComponent(ASC.Api.TypeConverter.ClientTimeToServer(r.endDate));jq.ajax({type:"get",url:t.ApiUrl+"/eventdays/"+f+"/"+e+".json",complete:function(t){var r=jq.evalJSON(t.responseText),f;if(r.status===0){for(f=0;f<r.response.length;f++)r.response[f]=ASC.Api.TypeConverter.ServerTimeToClient(r.response[f]);return u({result:!0,days:r.response}),!0}n({result:!1});i(r.error.message)}})};this.DoRequestToTodo=function(i,r){n=r;switch(i.action){case 1:t.CreateTodo(i.sourceId,i.title,i.description,i.start,i.priority,i.completed);break;case 2:t.UpdateTodo(i.sourceId,i.title,i.description,i.start,i.priority,i.completed,i.objectId);break;case 3:t.DeleteTodo(i.sourceId,i.title,i.description,i.start,i.priority,i.completed,i.objectId)}};this.DoRequestToEvent=function(i,r){var e,o,u,s;if(n=r,e=[],(i.action===1||i.action===2)&&i.permissions!=undefined&&i.permissions.data!=undefined)for(o=0;o<i.permissions.data.items.length;o++)(u=i.permissions.data.items[o],u.selectedAction.id!="owner")&&e.push({actionId:u.selectedAction.id,itemId:u.id,isGroup:u.isGroup});i.action===1?(f=i.action,t.GetOffsetAndExecute(t.CreateEvent,i.newSourceId,undefined,i.title,i.description,i.start,i.end,i.repeatRule.ToiCalString(),i.alert.type,i.allDay,i.newTimeZone,e,i.location,i.organizer,i.attendees,i.status,i.attachments)):i.action===2?(f=i.action,s=i.source.timeZone,i.source.objectId!=i.newSourceId&&(s=i.newTimeZone),t.GetOffsetAndExecute(t.UpdateEvent,i.newSourceId,i.objectId,i.title,i.description,i.start,i.end,i.repeatRule.ToiCalString(),i.alert.type,i.allDay,s,e,i.location,i.organizer,i.attendees,i.status,i.attachments)):i.action===3?t.RemoveEvent(i.objectId,i.type,i.date):i.action===4?(f=i.action,t.UnsubscribeEvent(i.objectId)):i.action===5&&t.CancelEditDialog(i.permissions)};this.CancelEditDialog=function(n){r!=null&&f!=null&&n&&(n.data=r.data,n.users=r.users);r=null;f=null};this.UnsubscribeEvent=function(u){jq.ajax({type:"delete",url:t.ApiUrl+"/events/"+u+"/unsubscribe.json",complete:function(t){var u=jq.evalJSON(t.responseText);r=null;u.status===0?n({result:!0}):(n({result:!1}),i(u.error.message))}})};this.RemoveEvent=function(r,u,f){u==2?jq.ajax({type:"delete",url:t.ApiUrl+"/events/"+r+".json",complete:function(t){var r=jq.evalJSON(t.responseText);r.status===0?n({result:!0,event:undefined}):(n({result:!1}),i(r.error.message))}}):jq.ajax({type:"delete",url:t.ApiUrl+"/events/"+r+"/custom.json",data:{type:u,date:ASC.Api.TypeConverter.ClientTimeToServer(f,0)},complete:function(t){var r=jq.evalJSON(t.responseText),u;if(r.status===0){for(u=0;u<r.response.length;u++)r.response[u].start=ASC.Api.TypeConverter.ServerTimeToClient(r.response[u].start),r.response[u].end=ASC.Api.TypeConverter.ServerTimeToClient(r.response[u].end),r.response[u].repeatRule=ASC.Api.iCal.ParseRRuleFromString(r.response[u].repeatRule);n({result:!0,event:r.response})}else n({result:!1}),i(r.error.message)}})};this.CreateEvent=function(r,u,f,e,o,s,c,l,a,v,y,p,w,b,k,d,g){action=null;var nt=t.ApiUrl+"/icsevent.json",tt=h(r,f,e,o,s,c,l,a,v,y,p,w,b,k,d,g);jq.ajax({type:"post",url:nt,data:tt,complete:function(t){var r=jq.evalJSON(t.responseText),u;if(r.status===0){for(u=0;u<r.response.length;u++)r.response[u].start=ASC.Api.TypeConverter.ServerTimeToClient(r.response[u].start),r.response[u].end=ASC.Api.TypeConverter.ServerTimeToClient(r.response[u].end),r.response[u].repeatRule=ASC.Api.iCal.ParseRRuleFromString(r.response[u].repeatRule);n({result:!0,event:r.response})}else n({result:!1}),i(r.error.message)}})};this.UpdateEvent=function(u,f,e,o,s,c,l,a,v,y,p,w,b,k,d,g,nt){action=null;var it=t.ApiUrl+"/icsevent.json",tt=h(u,e,o,s,c,l,a,v,y,p,w,b,k,d,g,nt);tt.eventId=f;jq.ajax({type:"put",url:it,data:tt,complete:function(t){var u=jq.evalJSON(t.responseText),f;if(r=null,u.status===0){for(f=0;f<u.response.length;f++)u.response[f].start=ASC.Api.TypeConverter.ServerTimeToClient(u.response[f].start),u.response[f].end=ASC.Api.TypeConverter.ServerTimeToClient(u.response[f].end),u.response[f].repeatRule=ASC.Api.iCal.ParseRRuleFromString(u.response[f].repeatRule);n({result:!0,event:u.response})}else n({result:!1}),i(u.error.message)}})};this.GetOffsetAndExecute=function(n,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){if(c){n(i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b);return}jq.ajax({type:"post",url:t.ApiUrl+"/utcoffset.json",data:{timeZone:l.id,startDate:ASC.Api.TypeConverter.ClientTimeToServer(e,0),endDate:ASC.Api.TypeConverter.ClientTimeToServer(o,0)},complete:function(t){var k=t.responseJSON.response;n(i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k)}})};this.CreateTodo=function(i,r,u,f,e,o){var h=t.ApiUrl+"/icstodo.json",s;f=f?new Date(f):f;s=c(i,r,u,f,o,!1);jq.ajax({type:"post",url:h,data:s,complete:function(t){var i=jq.evalJSON(t.responseText);i.status===0?n({result:!0,todo:i.response}):n({result:!1})}})};this.UpdateTodo=function(i,r,u,f,e,o,s){var l=t.ApiUrl+"/icstodo.json",h=c(i,r,u,f,e,o);h.todoId=s;jq.ajax({type:"put",url:l,data:h,complete:function(t){var i=jq.evalJSON(t.responseText);i.status===0?n({result:!0,todo:i.response}):n({result:!1})}})};this.DeleteTodo=function(i,r,u,f,e,o,s){jq.ajax({type:"delete",url:t.ApiUrl+"/todos/"+s+".json",complete:function(t){var i=jq.evalJSON(t.responseText);i.status===0?n({result:!0,event:undefined}):n({result:!1})}})};e=function(t){for(var i,u=[],r=0;r<t.items.length;r++)(i=t.items[r],i.selectedAction.id!="owner")&&u.push({objectId:i.id,name:i.name});n({result:!0,permissions:{users:u,data:t}})};r=null;this.RemovePermissions=function(n,t){var i,e,u;if(f=n.userId,n.permissions!=undefined&&n.permissions.data!=undefined)for(r==null&&(r=o(n.permissions)),i=0;i<n.permissions.data.items.length;i++)if((e=n.permissions.data.items[i],e.selectedAction.id!="owner")&&e.id==n.userId){for(n.permissions.data.items.splice(i,1),u=0;u<n.permissions.users.length;u++)if(n.permissions.users[u].objectId==n.userId){n.permissions.users.splice(u,1);break}t({result:!0,permissions:n.permissions});return}t({result:!1})};l=function(r){if(r.permissions.data==undefined)jq.ajax({type:"get",url:t.ApiUrl+"/sharing.json",complete:function(t){var r=jq.evalJSON(t.responseText);if(r.status===0){u.OnSave=e;u.UpdateSharingData(r.response);u.ShowDialog();return}n({result:!1});i(r.error.message)}});else{u.OnSave=e;u.UpdateSharingData(r.permissions.data);u.ShowDialog();return}};this.EditPermissions=function(t,i){u||(u=new SharingSettingsManager(undefined,null));n=i;r=t.permissions;setTimeout(function(){l(t)},0)};this.GetPermissions=function(r,u){if(r.permissions.data==undefined)jq.ajax({type:"get",url:t.ApiUrl+"/sharing.json",complete:function(t){var r=jq.evalJSON(t.responseText),o,f,e;if(r.status===0){for(o=[],f=0;f<r.response.items.length;f++)(e=r.response.items[f],e.selectedAction.id!="owner")&&o.push({objectId:e.id,name:e.name});u({result:r.status===0,permissions:{users:o,data:r.response}});return}n({result:!1});r.statusCode==403?window.location=window.location.origin:i(r.error.message)}});else{u({result:!0,permissions:r.permissions});return}};this.ViewChangedHandler=function(n,t){if(n!="")try{ASC.Controls.AnchorController.safemove(n+"/"+t.getTime())}catch(i){}};this.LoadSubscriptions=function(r){n=r;jq.ajax({type:"get",url:t.ApiUrl+"/subscriptions.json",complete:function(t){var r=jq.evalJSON(t.responseText);r.status===0?n({result:!0,subscriptions:r.response}):(n({result:!1}),i(r.error.message))}})};this.ManageSubscriptions=function(r,u){var e,f;for(n=u,e=[],f=0;f<r.length;f++)e.push({id:r[f].objectId,isAccepted:r[f].action==1});jq.ajax({type:"put",url:t.ApiUrl+"/subscriptions/manage.json",data:{states:e},complete:function(t){var r=jq.evalJSON(t.responseText);r.status===0?n({result:!0}):(n({result:!1}),i(r.error.message))}})};this.ReplaceSpecCharacter=function(n){return(n||"").trim().replace(ASC.CalendarController.characterRegExp,"_")};this.displayInfoPanel=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))}};
typeof ASC=="undefined"&&(ASC={});typeof ASC.Api=="undefined"&&(ASC.Api={});ASC.Api.iCal={};ASC.Api.iCal.Frequency={Never:0,Daily:3,Weekly:4,Monthly:5,Yearly:6};ASC.Api.iCal.DayOfWeek=function(n,t){this.Id=n;this.Order=0;t!=undefined&&(this.Order=t);this.Clone=function(){return new ASC.Api.iCal.DayOfWeek(this.Id,this.Order)}};ASC.Api.iCal.DayOfWeek.Monday=new ASC.Api.iCal.DayOfWeek("mo");ASC.Api.iCal.DayOfWeek.Tuesday=new ASC.Api.iCal.DayOfWeek("tu");ASC.Api.iCal.DayOfWeek.Wednesday=new ASC.Api.iCal.DayOfWeek("we");ASC.Api.iCal.DayOfWeek.Thursday=new ASC.Api.iCal.DayOfWeek("th");ASC.Api.iCal.DayOfWeek.Friday=new ASC.Api.iCal.DayOfWeek("fr");ASC.Api.iCal.DayOfWeek.Saturday=new ASC.Api.iCal.DayOfWeek("sa");ASC.Api.iCal.DayOfWeek.Sunday=new ASC.Api.iCal.DayOfWeek("su");ASC.Api.iCal.RecurrenceRule=function(){this.Freq=ASC.Api.iCal.Frequency.Never;this.Count=-1;this.Until=null;this.Interval=1;this.ByDay=[];this.AdditionalParams="";this.DateToiCalFormat=function(n){var t=n.getMonth()+1,i=n.getDate(),r=n.getHours(),u=n.getMinutes();return""+n.getFullYear()+(t>9?t:"0"+t)+(i>9?i:"0"+i)+"T"+(r>9?r:"0"+r)+(u>9?u:"0"+u)+"00Z"};this.Equals=function(n){return this.ToiCalString()==n.ToiCalString()};this.ToiCalString=function(){var n=new String,r,i,t;n+="freq=";switch(this.Freq){case ASC.Api.iCal.Frequency.Never:return"";case ASC.Api.iCal.Frequency.Daily:n+="daily";break;case ASC.Api.iCal.Frequency.Weekly:n+="weekly";break;case ASC.Api.iCal.Frequency.Monthly:n+="monthly";break;case ASC.Api.iCal.Frequency.Yearly:n+="yearly"}if(this.Until?n+=";until="+this.DateToiCalFormat(this.Until):this.Count>=0&&(n+=";count="+this.Count),this.Interval>1&&(n+=";interval="+this.Interval),this.ByDay!=null&&this.ByDay!=undefined&&this.ByDay.length>0)for(n+=";byday=",r=!0,i=0;i<this.ByDay.length;i++)t=this.ByDay[i],r?r=!1:n+=",",n+=t.Order!=0?t.Order+t.Id:t.Id;return this.AdditionalParams!=null&&this.AdditionalParams!=undefined&&this.AdditionalParams!=""&&(n+=this.AdditionalParams),n.toUpperCase()}};ASC.Api.iCal.ParseRRuleFromString=function(n){var c=function(n){var r=parseInt(n.substr(0,4),10),u=parseInt(n.substr(4,2),10)-1,f=parseInt(n.substr(6,2),10),t=0,i=0;return n.toLocaleLowerCase().indexOf("t")!=-1&&(t=parseInt(n.substr(9,2),10),i=parseInt(n.substr(11,2),10)),new Date(r,u,f,t,i)},t=new ASC.Api.iCal.RecurrenceRule,e,u,s,f,r,i,h,o;for(n=n.toLowerCase(),e=n.split(";"),u=0;u<e.length;u++){s=e[u].split("=")[0];f=e[u].split("=")[1];switch(s){case"freq":switch(f){case"daily":t.Freq=ASC.Api.iCal.Frequency.Daily;break;case"weekly":t.Freq=ASC.Api.iCal.Frequency.Weekly;break;case"monthly":t.Freq=ASC.Api.iCal.Frequency.Monthly;break;case"yearly":t.Freq=ASC.Api.iCal.Frequency.Yearly}break;case"interval":t.Interval=parseInt(f);break;case"count":t.Count=parseInt(f);break;case"until":t.Until=c(f);break;case"byday":for(r=f.split(","),i=0;i<r.length;i++)h=r[i].substr(r[i].length-2),o=new ASC.Api.iCal.DayOfWeek(h),r[i].length>2&&(o.Order=parseInt(r[i].substr(0,r[i].length-2))),t.ByDay.push(o);break;default:t.AdditionalParams+=";"+e[u]}}return t};ASC.Api.iCal.RecurrenceRule.Never=new ASC.Api.iCal.RecurrenceRule;ASC.Api.iCal.RecurrenceRule.EveryDay=ASC.Api.iCal.ParseRRuleFromString("FREQ=DAILY");ASC.Api.iCal.RecurrenceRule.EveryWeek=ASC.Api.iCal.ParseRRuleFromString("FREQ=WEEKLY");ASC.Api.iCal.RecurrenceRule.EveryMonth=ASC.Api.iCal.ParseRRuleFromString("FREQ=MONTHLY");ASC.Api.iCal.RecurrenceRule.EveryYear=ASC.Api.iCal.ParseRRuleFromString("FREQ=YEARLY");ASC.Api.iCal.RecurrenceRule.isVisibleYearlyEvent=function(n){var i,t,f,u,r;if(n.repeatRule&&n.repeatRule.Freq==ASC.Api.iCal.Frequency.Yearly&&n.repeatRule.AdditionalParams)for(i=n.repeatRule.AdditionalParams.split(";"),t=0;t<i.length;t++)if(i[t].startsWith("exdates="))for(f=jq.datepicker.formatDate("yymmdd",n.start),u=i[t].substr(8).split(","),r=0;r<u.length;r++)if(f==u[r])return!1;return!0};
(function(n){function i(i){var r=null;return n.each(t,function(n,t){return i.is(t.input)?(r=t,!1):!0}),r}function u(i){n.each(t,function(n,r){return i.is(r.obj)?(t.splice(n,1),!1):!0})}function f(t,i){var r=this;this.input=t;this.settings=i||{};this.container=i.container;this.organizer=i.organizer;this.cache=[];this.firstFailTerm="";this.canEdit=!0;this.Statuses=["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE"];this.Roles=["REQ-PARTICIPANT","OPT-PARTICIPANT"];this.convertAddressToAttendee=function(n){var t=new ICAL.Property("attendee");return t.setParameter("cutype","INDIVIDUAL"),t.setParameter("role",n.role||r.Roles[0]),t.setParameter("partstat",n.partstat||r.Statuses[0]),t.setParameter("rsvp","TRUE"),n.organizer&&t.setParameter("x-organizer","TRUE"),n.name&&t.setParameter("cn",n.name),t.setValue("mailto:"+n.email),t.jCal};this.parseEmails=function(t){var u,f,i;return t?(u=[],typeof t=="string"&&(f=ASC.Mail.Utility.ParseAddresses(t).addresses,n.each(f,function(n,t){t.isValid&&u.push(r.convertAddressToAttendee(t))})),Array.isArray(t)&&(u=t),i=[],n.each(u,function(n,t){typeof t=="object"&&i.push(t);typeof t=="string"&&(i=i.concat(r.parseEmails(t)))}),i):[]};this.addItem=function(t,i){var s=Array.isArray(t)?t.length:t,f=r.parseEmails(t),u;if(f.length)r.input.css("border-color","");else{s?r.input.css("border-color","#cc3300"):r.input.css("border-color","");return}if(u=n.map(r.getItems(),function(n){return n[3]}),i=!u.length&&i,i){var e=r.organizer.find("option:selected"),o=e.length?{email:e.attr("value"),name:Encoder.htmlDecode(e.attr("data-name"))}:ASC.Mail.DefaultAccount,h=r.convertAddressToAttendee({email:o.email,name:o.name,partstat:r.Statuses[1],organizer:!0});f.unshift(h)}n.each(f,function(t,i){if(i&&n.inArray(i[3],u)<0){var f={canEdit:r.canEdit,status:i[1].partstat,email:i[3].replace(new RegExp("mailto:","ig"),""),name:i[1].cn||"",role:i[1].role||r.Roles[0]};n("#attendeeTemplate").tmpl(f).data("item-data",i).appendTo(r.container);r.container.removeClass("display-none");r.container.find(".attendee-item:last .action select").val(f.role).tlcombobox();u.push(i[3]);r.input.val("")}});r.resizeList()};this.getItems=function(){var t=[];return n.each(r.container.find(".attendee-item"),function(i,r){t.push(n(r).data("item-data"))}),t};this.clearItems=function(){r.container.find(".attendee-item").remove();r.resizeList()};this.updateItemStatus=function(n){var t=n.parents(".attendee-item"),i=t.data("item-data");i[1].role=n.val();t.data("item-data",i)};this.removeItem=function(n){n.parents(".attendee-item").remove();r.resizeList()};this.setBindings=function(){r.input.on("keyup",function(t){t.keyCode==13&&r.addItem(n(this).val().trim(),!0)});r.input.parents(".input-container").find(".button").on("click",function(){n(this).hasClass("disable")||r.addItem(r.input.val().trim(),!0)});r.container.on("click",".removeItem",function(){r.removeItem(n(this))});r.container.on("change",".action select",function(){r.updateItemStatus(n(this))});r.container.on("click",".combobox-title",function(){n(this).closest(".sharingItem").is(".attendees-user-list .sharingItem:gt(-3)")&&r.container.scrollTo(n(".sharingItem:has(.combobox-container:visible)"))})};this.initAutocomplete=function(){r.input.autocomplete({minLength:2,delay:300,select:function(n,t){return r.addItem([t.item],!0),!1},search:function(){return r.input.is(":visible")},source:function(n,t){var i,u,f;if(r.settings.isInPopup&&(i=this.menu.element,u=r.input.parents(".blockUI.blockPage:first"),u.length!=0&&(u.css("position")=="fixed"?i.css("position","fixed"):i.css("position","absolute"))),n.term in r.cache)return f=r.cache[n.term],t(f);if(!n.term)return r.firstFailTerm="",t([]);if(r.firstFailTerm){if(n.term.indexOf(r.firstFailTerm)===0)return t([]);r.firstFailTerm=""}Teamlab.searchEmails({},{term:n.term},{before:function(){ASC.CalendarController.Search=!0},success:function(i,u){if(!u||u.length===0)return r.firstFailTerm=n.term,t([]);var f=r.parseEmails(u);return r.cache[n.term]=f,t(f)},error:function(n,t){console.log(t)},after:function(){ASC.CalendarController.Search=!1}})},create:function(){n(window).on("resize",function(){r.closeSelector()})},focus:function(){return!1}});r.input.data("ui-autocomplete")._renderMenu=function(t,i){var f=this,u;n.each(i,function(n,i){f._renderItemData(t,i)});r.settings.isInPopup&&n.browser.mobile&&t.parents(".blockUI.blockPage:first").length==0&&(u=r.input.parents(".blockUI.blockPage:first"),u.length!=0&&t.appendTo(u.children()))};r.input.data("ui-autocomplete")._renderItem=function(t,i){var r={email:i[3].replace(new RegExp("mailto:","ig"),""),name:i[1].cn||""};return n("#attendeeTemplateAutocomplete").tmpl(r).appendTo(t)};r.input.data("ui-autocomplete")._resizeMenu=function(){this.menu.element.outerWidth(r.input.outerWidth())};r.input.data("ui-autocomplete")._suggest=function(t){var i=this.menu.element.empty().zIndex(100500);this._renderMenu(i,t);this.menu.refresh();i.show();this._resizeMenu();i.position(n.extend({"of":this.element},this.options.position))}};this.init=function(){r.setBindings();r.initAutocomplete();r.clearItems();r.addItem(r.settings.items)};this.setItems=function(n,t){r.clearItems();r.canEdit=t==undefined?!0:t;r.addItem(n);r.canEdit?r.input.prop("disabled",!1).parents(".input-container").removeClass("display-none").find(".button").removeClass("disable"):r.input.prop("disabled",!0).parents(".input-container").addClass("display-none").find(".button").addClass("disable");n.length?r.container.removeClass("display-none"):r.container.addClass("display-none")};this.closeSelector=function(){var n=r.input.data("ui-autocomplete");n&&n.close()};this.resizeList=function(){var n=r.container.find(".sharingItem").length;n?r.container.removeClass("display-none"):r.container.addClass("display-none");n>7?r.container.addClass("scrollable"):r.container.removeClass("scrollable")}}var t=[],r={init:function(i){var e=n(this),r;return u(e),r=new f(e,i),t.push(r),r.init(),this},get:function(){var r=n(this),t=i(r);return t?t.getItems():null},set:function(t,r){var f=n(this),u=i(f);u&&u.setItems(t,r)}};n.fn.AttendeesSelector=function(n){return this.length&&r[n]?r[n].apply(this,Array.prototype.slice.call(arguments,1)):this}})(jQuery),function(n){function i(i){var r=null;return n.each(t,function(n,t){return i.is(t.selector)?(r=t,!1):!0}),r}function u(i){n.each(t,function(n,r){return i.is(r.obj)?(t.splice(n,1),!1):!0})}function f(t,i){var r=this;this.selector=t;this.permissions=i.permissions;this.container=i.container;this.canEdit=!0;this.removeItem=function(n){for(var t=0;t<r.permissions.data.items.length;t++)if(r.permissions.data.items[t].id==n){if(r.permissions.data.items[t].canEdit===!1||r.permissions.data.items[t].hideRemove)return!1;r.permissions.data.items[t].isGroup||r.selector.useradvancedSelector("unselect",[n]);r.permissions.data.items.splice(t,1);break}return r.container.find("#sharing_event_item_"+n).remove(),r.resizeList(),!0};this.addUsers=function(t,i){for(var f,o,e=n(i).map(function(n,t){return t.id}).toArray(),u=0;u<r.permissions.data.items.length;u++)f=r.permissions.data.items[u],f.isGroup||(o=n.inArray(f.id,e),o==-1?r.removeItem(f.id)&&u--:e.splice(o,1));n(i).each(function(t,i){n.inArray(i.id,e)!=-1&&r.addUserItem(i.id,i.title)})};this.addUserItem=function(t,i){for(var f,e=null,u=0;u<r.permissions.data.actions.length;u++)if(r.permissions.data.actions[u].defaultAction){e=r.permissions.data.actions[u];break}f={id:t,name:i,selectedAction:e,isGroup:!1,canEdit:r.canEdit};r.permissions.data.items.push(f);n("#sharingUserTemplate").tmpl({items:[f],actions:r.permissions.data.actions}).appendTo(r.container);r.container.find(".action:last select").tlcombobox();r.resizeList()};this.getItems=function(){for(var n,i=[],t=0;t<r.permissions.data.items.length;t++)(n=r.permissions.data.items[t],n.selectedAction.id!="owner")&&i.push({objectId:n.id,name:n.name});return{users:i,data:r.permissions.data}};this.renderContainer=function(){var u,f,i,t;for(r.container.empty(),n("#sharingUserTemplate").tmpl(r.permissions.data).appendTo(r.container),r.container.find(".action select").each(function(){n(this).tlcombobox()}),r.resizeList(),r.selector.useradvancedSelector("reset"),u=[],f=[],i=0;i<r.permissions.data.items.length;i++)t=r.permissions.data.items[i],t.isGroup||(u.push(t.id),(t.hideRemove||!t.canEdit)&&f.push(t.id));r.selector.useradvancedSelector("select",u);r.selector.useradvancedSelector("disable",f)};this.changeItemAction=function(n,t){for(var u=null,i=0;i<r.permissions.data.actions.length;i++)if(r.permissions.data.actions[i].id==t){u=r.permissions.data.actions[i];break}for(i=0;i<r.permissions.data.items.length;i++)if(r.permissions.data.items[i].id==n){r.permissions.data.items[i].selectedAction=u;break}};this.setBindings=function(){r.container.on("click",".removeItem",function(){r.removeItem(n(this).attr("data"))});r.container.on("change",".action select",function(){r.changeItemAction(n(this).attr("data"),n(this).val())});r.container.on("click",".combobox-title",function(){n(this).closest(".sharingItem").is(".shared-user-list .sharingItem:gt(-3)")&&r.container.scrollTo(n(".sharingItem:has(.combobox-container:visible)"))});r.selector.useradvancedSelector({showGroups:!0}).on("showList",r.addUsers)};this.init=function(){r.setBindings();r.renderContainer()};this.resizeList=function(){var n=r.container.find(".sharingItem").length;n?r.container.removeClass("display-none"):r.container.addClass("display-none");n>7?r.container.addClass("scrollable"):r.container.removeClass("scrollable")}}var t=[],r={init:function(i){var e=n(this),r;return u(e),r=new f(e,i),t.push(r),r.init(),this},get:function(){var r=n(this),t=i(r);return t?t.getItems():null},set:function(t,r){var f=n(this),u=i(f);u&&(u.permissions=t,u.canEdit=r==undefined?!0:r,u.renderContainer())}};n.fn.ShareUsersSelector=function(n){return this.length&&r[n]?r[n].apply(this,Array.prototype.slice.call(arguments,1)):this}}(jQuery);
(function(n){function it(t){var i=null;return n.each(c,function(n,r){return t.is(r.input)?(i=r,!1):!0}),i}function dt(t){n.each(c,function(n,i){return t.is(i.obj)?(c.splice(n,1),!1):!0})}function gt(r,u){var f=this;this.input=r;this.container=u.container;this.canEdit=!0;this.init=function(){$attachmentsClearBtn=n("#attachments_clear_btn");ki();window.CalendarDocumentsPopup.unbind(window.CalendarDocumentsPopup.events.SelectFiles);uploader=fi("attachments_browse_btn");uploader.fileupload({url:null,autoUpload:!1,singleFileUploads:!0,progressInterval:1e3,dropZone:!1});uploader.bind("fileuploadadd",ni).bind("fileuploadsubmit",ti).bind("fileuploadsend",ii).bind("fileuploadprogress",ri).bind("fileuploaddone",rt).bind("fileuploadfail",v).bind("fileuploadalways",ui);window.CalendarDocumentsPopup.bind(window.CalendarDocumentsPopup.events.SelectFiles,nr);n("#attachments_limit_txt").text(t.limitLabel.replace("%1",g));jq(document).on("click","#"+e+" .delete_attachment",function(){var n=this.id.replace("remove_attachment_","");return ht(n),!1});f.renderContainer()};this.renderContainer=function(){f.container.find("tbody").empty()};this.getItems=function(){return i};this.addAttachments=function(n){i=[];li(n)}}function ni(n,t){var i=t.files[0],r;i.orderNumber=s();i.percent=0;i.status=uploadStatus.QUEUED;i.title=i.name;r=ft(i);h(r);u();ei(n,t)||(i.status=uploadStatus.FAILED);uploadQueue.push(t);uploaderBusy||ut()}function ti(t,i){var r=i.files[0];r.status=uploadStatus.STARTED;r.needSaveToTemp=!1;n(this).fileupload("option","formData",[{name:"name",value:r.title}]);n(this).fileupload("option","url",di({eventId:0,copyToMy:0}))}function ii(n,t){var i=t.files[0];return y(i.orderNumber,!0),i.status==uploadStatus.STARTED}function ri(n,t){var i=t.files[0];i.percent=parseInt(t.loaded/t.total*100,10);st(i.orderNumber,i.percent)}function rt(t,i){var e=i.files[0],r,o;e.percent=100;e.status=uploadStatus.DONE;y(e.orderNumber,!1);r=n.parseJSON(i.result);r&&(r.Success||(r.Data||(r.Data={id:-1,title:e.title,orderNumber:e.orderNumber,fileUrl:""}),r.Data.error=r.Message,r.Data.size=0),r.Data.attachedAsLink?(r.Data.id=r.Data.id,r.Data.title=r.Data.title,r.Data.orderNumber=e.orderNumber,r.Data.fileUrl=r.FileURL,r.Data.error&&(p(e.orderNumber,r.Data.error),u(),o=b(f,e.orderNumber),o>-1&&f.splice(o,1))):ai(e.orderNumber,r.Data))}function v(t,i,r){var u=i.files[0],f,e;u.percent=0;u.status=i.errorThrown=="abort"?uploadStatus.STOPED:uploadStatus.FAILED;f=r||i.errorThrown||i.textStatus;i.jqXHR&&i.jqXHR.responseText&&(f=n.parseJSON(i.jqXHR.responseText).Message);(u.orderNumber==undefined||u.orderNumber<0)&&(u.orderNumber=s(),e=ft(u),h(e));i.result=JSON.stringify({Success:!1,Title:u.title,FileURL:"",Data:{contentId:null,contentType:"",id:-1,title:u.title,size:0,orderNumber:u.orderNumber,fileUrl:"",isNew:!0},Message:f});rt(t,i)}function ui(){ut()}function fi(t){var i=n("#fileupload"),r;if(i.length)return i;r=n("#"+t);i=n("<input/>").attr("id","fileupload").attr("type","file").attr("multiple","multiple").css("width","0").css("height","0").hide();i.appendTo(r.parent());r.on("click",function(t){t.preventDefault();n("#fileupload").click()});n("#attachments_clear_btn").on("click",function(){yi()});return i}function ei(n,i){var r=i.files[0];return r.size<=0?(v(n,i,t.emptyFileNotSupportedError),!1):bt<r.size?(v(n,i,t.fileSizeError),!1):!0}function ut(){var n=oi(uploadStatus.QUEUED);n&&(uploaderBusy=!0,n.submit())}function oi(n){for(var t=0;t<uploadQueue.length;t++)if(uploadQueue[t].files[0].status==n)return uploadQueue[t];return null}function si(n){for(var t=0;t<uploadQueue.length;t++)if(uploadQueue[t].files[0].orderNumber==n)return uploadQueue[t];return null}function ft(n){var t={contentId:null,contentType:"",id:-1,title:n.title,orderNumber:n.orderNumber,size:n.size,error:n.error||"",fileUrl:""};return k(t),t}function hi(n){var t={contentId:null,contentType:"",id:n.id,originalId:n.originalId,title:n.title,orderNumber:n.orderNumber,size:+n.size,storedName:"",streamId:"",error:n.error||"",fileUrl:n.fileUrl};return k(t),t}function ci(n){var u="",i,r;return n!=undefined&&(i=1048576,r=1024,u=n<=i?n<=r?n+" "+t.bytes:(n/r).toFixed(2)+" "+t.kilobytes:(n/i).toFixed(2)+" "+t.megabytes),u}function li(n){for(var r=n.length,i,t=0;t<r;t++)i=n[t],i.orderNumber=s(),h(i);u()}function h(t,r){t.operation=r?r:0;t.attachedAsLink=!1;t.isNew&&(t.isUploaded=!1);var u=ot(t);n("#"+e+" tbody").append(u);i.push(t);$attachmentsClearBtn.show()}function et(){var i=n("#"+e+" .file_info"),t;return i.length==0?undefined:(t=Math.max.apply(null,i.map(function(){return n(this).find(".file-name").outerWidth(!0)+n(this).find(".fullSizeLabel").outerWidth(!0)}).get()),n.isNumeric(t)?t+kt:t)}function u(){var i=n("#"+e+" .file_info"),t;i.length!=0&&(t=et(),n.isNumeric(t)&&i.animate({width:t},"normal"))}function ai(t,r){var f,u,o,s;t==undefined||t<0||(f=b(i,t),f>-1&&(u=i[f],u.contentType=r.contentType,u.id=r.id,u.title=r.title,u.size=r.size||0,u.error=r.error||"",u.attachedAsLink=r.attachedAsLink,u.fileUrl=r.fileUrl,k(u),o=ot(u),s=et(),n.isNumeric(s)&&n(o).find(".file_info").width(s),n("#"+e+" .row[data_id="+t+"]").replaceWith(o)))}function ot(t){if(t==undefined)return"";return n("#attachmentEventTmpl").tmpl(t,{cutFileName:gi,fileSizeToStr:ci,getFileNameWithoutExt:wi,getFileExtension:ct})}function y(t,i){var r=n("#item_progress_"+t);r!=undefined&&(i?r.show():r.hide())}function st(t,i){if(i!=undefined&&!(i<0)){var r=n("#item_progress_"+t+":visible .progress-slider");r!=undefined&&r.length==1&&r.css("width",i+"%")}}function p(t,i){var r=n('#calendar_event_attachments .row[data_id="'+t+'"]');r.find(".delete_attachment").show();r.find(".load_result").empty();r.find(".load_result").html('<span class="file-load-result red-text" title="'+i+'"> '+i+"<\/span>")}function w(t,i,r){var u=n('#calendar_event_attachments .row[data_id="'+t+'"]');u.addClass("inactive");u.find(".load_result .file-load-result").remove();i==100?(u.find(".load_result").html('<span class="file-load-result uploaded-text" title="'+r+'"> '+r+"<\/span>"),u.find(".attachment-progress").hide()):(u.find(".attachment-progress .progress-label").text(r),u.find(".attachment-progress .progress-slider").css("width",i+"%"),u.find(".attachment-progress").show())}function b(n,t){for(var r=-1,f=n.length,u,i=0;i<f;i++)if(u=n[i],u.orderNumber==t){r=i;break}return r}function vi(n){var i=si(n),t;i&&(t=i.files[0],t.status==uploadStatus.STARTED?i.abort():t.status==uploadStatus.QUEUED&&(t.status=uploadStatus.STOPED))}function ht(n,t){var r=b(i,n);r>-1&&(i.splice(r,1),i.length==0&&$attachmentsClearBtn.hide());pi(n);vi(n);(t==undefined||t)&&u()}function yi(){for(var t=i.slice(),u=t.length,r,n=0;n<u;n++)r=t[n],ht(r.orderNumber,!1);$attachmentsClearBtn.hide()}function pi(t){n("#"+e+" .row[data_id="+t+"]").remove()}function wi(n){if(n){var t=n.lastIndexOf(".");return t>-1?n.substr(0,t):n}return""}function ct(n){if(n){var t=n.lastIndexOf(".");return t>-1?n.substr(t):""}return""}function bi(n){switch(n){case".exe":return t.executableWarning;default:return""}}function ki(){n("#"+e+" tbody").empty();i=[];dataBeforeSave=[];documentsInLoad=[];a=[];r=[];f=[];failedUploadedFiles=[];uploadQueue.clear();nt&&n(window).Teamlab.unbind(nt)}function di(n){var t="UploadProgress.ashx?submit=ASC.Web.Calendar.Handlers.FilesUploader,ASC.Web.Calendar";for(var i in n)t+="&{0}={1}".format(i,n[i]);return t}function gi(n){return n.length<=tt?n:n.substr(0,tt-3)+"..."}function k(n){var t=n.title,i=ct(t),r=bi(i);return n.iconCls=window.ASC.Files.Utility.getCssClassByFileTitle(t,!0),n.warn=r,n.operation=0,n.isUploaded=!0,n.isNew=!0,n}function s(){return wt++}function nr(n,t){var i=t.data;a=a.concat(i);tr(i);u()}function tr(n){for(var u,e,t=0;t<n.length;t++)(u=n[t],i.find(n=>n.id==u.id||n.originalId==u.id))||(u.shareable&&!u.denySharing?r.push(u):f.push(u));if(f.length)setTimeout(hr,0);else{for(t=0;t<r.length;t++)at(r[t]),e=r[t],e.size=0,e.orderNumber=s(),h(e);lt(r);l()}}function lt(n){for(var i=0;i<n.length;i++)y(n[i].orderNumber,!0),w(n[i].orderNumber,100,t.uploadedLabel),n[i].isUploaded=!0;u()}function at(n){if(!n.fileUrl){var t=location.origin+ASC.Files.Utility.GetFileDownloadUrl(n.id);ASC.Files.Utility.CanWebView(n.title)&&(t=location.origin+ASC.Files.Utility.GetFileWebViewerUrl(n.id));n.fileUrl=t}}function ir(){for(var e=r.slice(0),i=f.slice(0),n=0;n<e.length;n++)e[n].orderNumber||(e[n].orderNumber=s());yt();i=i.filter(function(n){return n.denyDownload?(p(n.orderNumber,t.documentAccessDeniedError),!1):!0});ur(i,function(r,f){if(r){for(n=0;n<i.length;n++)p(i[n].orderNumber,t.copyFileToMyDocumentsFolderErrorMsg);u();l()}else{if(l(),f.length==i.length)for(n=0;n<i.length;n++)f[n].orderNumber=s(),f[n].originalId=i[n].id;var o=e.concat(f);er(o);lt(o)}})}function rr(){l();yt()}function ur(n,t){for(var r=[],i=0;i<n.length;i++)r.push(n[i].id);window.Teamlab.copyBatchItems({destFolderId:ASC.Files.Constants.FOLDER_ID_MY_FILES,fileIds:r,conflictResolveType:2},{success:function(i,r){var u=r.length&&r[0].id;u||t({});vt(u,n,ASC.Files.Constants.FOLDER_ID_MY_FILES,t)},error:function(n,i){t(i)}})}function vt(n,t,i,r){window.Teamlab.getOperationStatuses({success:function(u,f){var e=fr(f,n),s,o,h;if(e==null||e.error||e.progress!=100)e==null||e.error?r({}):(or(t,e),setTimeout(function(){vt(n,t,i,r)},500));else{for(s=[],o=0,h=e.files.length;o<h;o++)e.files[o].folderId==i&&s.push(e.files[o]);r(null,s)}},error:function(n,t){r(t)}})}function fr(n,t){for(var i=0;i<n.length;i++)if(n[i].id==t)return n[i];return null}function er(n){for(var i,u,r=0;r<n.length;r++)i=n[r],at(i),u=hi(i),u.size=0,i.forceCopying?w(i.orderNumber,0,t.copyingToMyDocumentsLabel):h(u,1,!0)}function or(n,t){for(var i=0;i<n.length;i++)st(n[i].orderNumber,t.progress)}function lt(n){for(var i=0;i<n.length;i++)w(n[i].orderNumber,100,t.insertedViaLink);u()}function sr(){o=n("#commonPopup");o.find("div.containerHeaderBlock:first td:first").html(t.warningLabel);o.find("div.containerBodyBlock:first").html(n("#filesCannotBeAttachedAsLinksTmpl").tmpl());jq("#copyFilesToMyDocuments").on("click",function(){return ir(),!1});jq("#cancelCopyingToMyDocuments").on("click",function(){return rr(),!1})}function hr(){o==null&&sr();StudioBlockUIManager.blockUI(o,530,{bindEvents:!1})}function yt(){o.is(":visible")&&n.unblockUI()}function l(){r=[];f=[]}var c=[],i=[],a=[],r=[],f=[],t=g_fcOptions.attachments,pt=0,wt=0,g=t.maxFileSizeInMegaBytes,bt=g*1048576,nt=null,e="calendar_event_attachments",tt=53,kt=4,o=null,d;uploader=null;uploadQueue=[];uploaderBusy=!1;uploadStatus={QUEUED:0,STARTED:1,STOPED:2,DONE:3,FAILED:4};d={init:function(t){var r=n(this),i;return dt(r),i=new gt(r,t),c.push(i),i.init(),this},get:function(){var i=n(this),t=it(i);return t?t.getItems():null},set:function(t,i){var u=n(this),r=it(u);r&&(r.addAttachments(t),r.canEdit=i==undefined?!0:i,r.renderContainer())}};n.fn.FileUpload=function(n){return this.length&&d[n]?d[n].apply(this,Array.prototype.slice.call(arguments,1)):this}})(jQuery);
(function(n,t,i){n.fn.jScrollPane=function(t){function r(t,r){function ci(r){var h,d,g,y,p,k,nt=!1,tt=!1;if(u=r,f===i)p=t.scrollTop(),k=t.scrollLeft(),t.css({overflow:"hidden",padding:0}),s=t.innerWidth()+st,o=t.innerHeight(),t.width(s),f=n('<div class="jspPane" />').css("padding",vi).append(t.children()),e=n('<div class="jspContainer" />').css({width:s+"px",height:o+"px"}).append(f).appendTo(t);else{if(t.css("width",""),nt=u.stickToBottom&&sr(),tt=u.stickToRight&&hr(),y=t.innerWidth()+st!=s||t.outerHeight()!=o,y&&(s=t.innerWidth()+st,o=t.innerHeight(),e.css({width:s+"px",height:o+"px"})),!y&&yi==v&&f.outerHeight()==a){t.width(s);return}yi=v;f.css("width","");t.width(s);e.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}f.css("overflow","auto");v=r.contentWidth?r.contentWidth:f[0].scrollWidth;a=f[0].scrollHeight;f.css("overflow","");ei=v/s;dt=a/o;b=dt>1;w=ei>1;w||b?(t.addClass("jspScrollable"),h=u.maintainPosition&&(c||l),h&&(d=ft(),g=et()),tr(),ir(),rr(),h&&(at(tt?v-s:d,!1),ut(nt?a-o:g,!1)),ar(),cr(),br(),u.enableKeyboardNavigation&&yr(),u.clickOnTrack&&fr(),wr(),u.hijackInternalLinks&&nr()):(t.removeClass("jspScrollable"),f.css({top:0,width:e.width()-st}),lr(),vr(),pr(),ki(),gi());u.autoReinitialise&&!ti?ti=setInterval(function(){ci(u)},u.autoReinitialiseDelay):!u.autoReinitialise&&ti&&clearInterval(ti);p&&t.scrollTop(0)&&ut(p,!1);k&&t.scrollLeft(0)&&at(k,!1);t.trigger("jsp-initialised",[w||b])}function tr(){b&&(e.append(n('<div class="jspVerticalBar" />').append(n('<div class="jspCap jspCapTop" />'),n('<div class="jspTrack" />').append(n('<div class="jspDrag" />').append(n('<div class="jspDragTop" />'),n('<div class="jspDragBottom" />'))),n('<div class="jspCap jspCapBottom" />'))),gt=e.find(">.jspVerticalBar"),d=gt.find(">.jspTrack"),y=d.find(">.jspDrag"),u.showArrows&&(yt=n('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",rt(0,-1)).bind("click.jsp",vt),pt=n('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",rt(0,1)).bind("click.jsp",vt),u.arrowScrollOnHover&&(yt.bind("mouseover.jsp",rt(0,-1,yt)),pt.bind("mouseover.jsp",rt(0,1,pt))),bi(d,u.verticalArrowPositions,yt,pt)),ct=o,e.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){ct-=n(this).outerHeight()}),y.hover(function(){y.addClass("jspHover")},function(){y.removeClass("jspHover")}).bind("mousedown.jsp",function(t){n("html").bind("dragstart.jsp selectstart.jsp",vt);y.addClass("jspActive");var i=t.pageY-y.position().top;return n("html").bind("mousemove.jsp",function(n){ht(n.pageY-i,!1)}).bind("mouseup.jsp mouseleave.jsp",di),!1}),pi())}function pi(){d.height(ct+"px");c=0;oi=u.verticalGutter+d.outerWidth();f.width(s-oi-st);try{gt.position().left===0&&f.css("margin-left",oi+"px")}catch(n){}}function ir(){w&&(e.append(n('<div class="jspHorizontalBar" />').append(n('<div class="jspCap jspCapLeft" />'),n('<div class="jspTrack" />').append(n('<div class="jspDrag" />').append(n('<div class="jspDragLeft" />'),n('<div class="jspDragRight" />'))),n('<div class="jspCap jspCapRight" />'))),ni=e.find(">.jspHorizontalBar"),g=ni.find(">.jspTrack"),p=g.find(">.jspDrag"),u.showArrows&&(wt=n('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",rt(-1,0)).bind("click.jsp",vt),bt=n('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",rt(1,0)).bind("click.jsp",vt),u.arrowScrollOnHover&&(wt.bind("mouseover.jsp",rt(-1,0,wt)),bt.bind("mouseover.jsp",rt(1,0,bt))),bi(g,u.horizontalArrowPositions,wt,bt)),p.hover(function(){p.addClass("jspHover")},function(){p.removeClass("jspHover")}).bind("mousedown.jsp",function(t){n("html").bind("dragstart.jsp selectstart.jsp",vt);p.addClass("jspActive");var i=t.pageX-p.position().left;return n("html").bind("mousemove.jsp",function(n){lt(n.pageX-i,!1)}).bind("mouseup.jsp mouseleave.jsp",di),!1}),ot=e.innerWidth(),wi())}function wi(){e.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){ot-=n(this).outerWidth()});g.width(ot+"px");l=0}function rr(){if(w&&b){var t=g.outerHeight(),i=d.outerWidth();ct-=t;n(ni).find(">.jspCap:visible,>.jspArrow").each(function(){ot+=n(this).outerWidth()});ot-=i;o-=i;s-=t;g.parent().append(n('<div class="jspCorner" />').css("width",t+"px"));pi();wi()}w&&f.width(e.outerWidth()-st+"px");a=f.outerHeight();dt=a/o;w&&(it=Math.ceil(1/ei*ot),it>u.horizontalDragMaxWidth?it=u.horizontalDragMaxWidth:it<u.horizontalDragMinWidth&&(it=u.horizontalDragMinWidth),p.width(it+"px"),nt=ot-it,ai(l));b&&(tt=Math.ceil(1/dt*ct),tt>u.verticalDragMaxHeight?tt=u.verticalDragMaxHeight:tt<u.verticalDragMinHeight&&(tt=u.verticalDragMinHeight),y.height(tt+"px"),k=ct-tt,li(c))}function bi(n,t,i,r){var u="before",f="after",e;t=="os"&&(t=/Mac/.test(navigator.platform)?"after":"split");t==u?f=t:t==f&&(u=t,e=i,i=r,r=e);n[u](i)[f](r)}function rt(n,t,i){return function(){return ur(n,t,this,i),this.blur(),!1}}function ur(t,i,r,f){r=n(r).addClass("jspActive");var o,e,s=!0,c=function(){t!==0&&h.scrollByX(t*u.arrowButtonSpeed);i!==0&&h.scrollByY(i*u.arrowButtonSpeed);e=setTimeout(c,s?u.initialDelay:u.arrowRepeatFreq);s=!1};c();o=f?"mouseout.jsp":"mouseup.jsp";f=f||n("html");f.bind(o,function(){r.removeClass("jspActive");e&&clearTimeout(e);e=null;f.unbind(o)})}function fr(){ki();b&&d.bind("mousedown.jsp",function(t){if(t.originalTarget===i||t.originalTarget==t.currentTarget){var e=n(this),y=e.offset(),s=t.pageY-y.top-c,r,l=!0,v=function(){var p=e.offset(),n=t.pageY-p.top-tt/2,i=o*u.scrollPagePercent,y=k*i/(a-o);if(s<0)c-y>n?h.scrollByY(-i):ht(n);else if(s>0)c+y<n?h.scrollByY(i):ht(n);else{f();return}r=setTimeout(v,l?u.initialDelay:u.trackClickRepeatFreq);l=!1},f=function(){r&&clearTimeout(r);r=null;n(document).unbind("mouseup.jsp",f)};return v(),n(document).bind("mouseup.jsp",f),!1}});w&&g.bind("mousedown.jsp",function(t){if(t.originalTarget===i||t.originalTarget==t.currentTarget){var e=n(this),y=e.offset(),o=t.pageX-y.left-l,r,c=!0,a=function(){var p=e.offset(),n=t.pageX-p.left-it/2,i=s*u.scrollPagePercent,y=nt*i/(v-s);if(o<0)l-y>n?h.scrollByX(-i):lt(n);else if(o>0)l+y<n?h.scrollByX(i):lt(n);else{f();return}r=setTimeout(a,c?u.initialDelay:u.trackClickRepeatFreq);c=!1},f=function(){r&&clearTimeout(r);r=null;n(document).unbind("mouseup.jsp",f)};return a(),n(document).bind("mouseup.jsp",f),!1}})}function ki(){g&&g.unbind("mousedown.jsp");d&&d.unbind("mousedown.jsp")}function di(){n("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");y&&y.removeClass("jspActive");p&&p.removeClass("jspActive")}function ht(n,t){b&&(n<0?n=0:n>k&&(n=k),t===i&&(t=u.animateScroll),t?h.animate(y,"top",n,li):(y.css("top",n),li(n)))}function li(n){n===i&&(n=y.position().top);e.scrollTop(0);c=n;var r=c===0,u=c==k,h=n/k,s=-h*(a-o);(ii!=r||ui!=u)&&(ii=r,ui=u,t.trigger("jsp-arrow-change",[ii,ui,ri,fi]));er(r,u);f.css("top",s);t.trigger("jsp-scroll-y",[-s,r,u]).trigger("scroll")}function lt(n,t){w&&(n<0?n=0:n>nt&&(n=nt),t===i&&(t=u.animateScroll),t?h.animate(p,"left",n,ai):(p.css("left",n),ai(n)))}function ai(n){n===i&&(n=p.position().left);e.scrollTop(0);l=n;var r=l===0,u=l==nt,h=n/nt,o=-h*(v-s);(ri!=r||fi!=u)&&(ri=r,fi=u,t.trigger("jsp-arrow-change",[ii,ui,ri,fi]));or(r,u);f.css("left",o);t.trigger("jsp-scroll-x",[-o,r,u]).trigger("scroll")}function er(n,t){u.showArrows&&(yt[n?"addClass":"removeClass"]("jspDisabled"),pt[t?"addClass":"removeClass"]("jspDisabled"))}function or(n,t){u.showArrows&&(wt[n?"addClass":"removeClass"]("jspDisabled"),bt[t?"addClass":"removeClass"]("jspDisabled"))}function ut(n,t){var i=n/(a-o);ht(i*k,t)}function at(n,t){var i=n/(v-s);lt(i*nt,t)}function kt(t,i,r){var f,v,y,h=0,c=0,p,w,b,k,l,a;try{f=n(t)}catch(d){return}for(v=f.outerHeight(),y=f.outerWidth(),e.scrollTop(0),e.scrollLeft(0);!f.is(".jspPane");)if(h+=f.position().top,c+=f.position().left,f=f.offsetParent(),/^body|html$/i.test(f[0].nodeName))return;p=et();b=p+o;h<p||i?l=h-u.verticalGutter:h+v>b&&(l=h-o+v+u.verticalGutter);l&&ut(l,r);w=ft();k=w+s;c<w||i?a=c-u.horizontalGutter:c+y>k&&(a=c-s+y+u.horizontalGutter);a&&at(a,r)}function ft(){return-f.position().left}function et(){return-f.position().top}function sr(){var n=a-o;return n>20&&n-et()<10}function hr(){var n=v-s;return n>20&&n-ft()<10}function cr(){e.unbind(hi).bind(hi,function(n,t,i,r){var f=l,e=c;return h.scrollBy(i*u.mouseWheelSpeed,-r*u.mouseWheelSpeed,!1),f==l&&e==c})}function lr(){e.unbind(hi)}function vt(){return!1}function ar(){f.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(n){kt(n.target,!1)})}function vr(){f.find(":input,a").unbind("focus.jsp")}function yr(){function v(){var n=l,t=c;switch(i){case 40:h.scrollByY(u.keyboardSpeed,!1);break;case 38:h.scrollByY(-u.keyboardSpeed,!1);break;case 34:case 32:h.scrollByY(o*u.scrollPagePercent,!1);break;case 33:h.scrollByY(-o*u.scrollPagePercent,!1);break;case 39:h.scrollByX(u.keyboardSpeed,!1);break;case 37:h.scrollByX(-u.keyboardSpeed,!1)}return r=n!=l||t!=c}var i,r,s=[];w&&s.push(ni[0]);b&&s.push(gt[0]);f.focus(function(){t.focus()});t.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(t){if(t.target===this||s.length&&n(t.target).closest(s).length){var u=l,f=c;switch(t.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:i=t.keyCode;v();break;case 35:ut(a-o);i=null;break;case 36:ut(0);i=null}return r=t.keyCode==i&&u!=l||f!=c,!r}}).bind("keypress.jsp",function(n){return n.keyCode==i&&v(),!r});u.hideFocus?(t.css("outline","none"),"hideFocus"in e[0]&&t.attr("hideFocus",!0)):(t.css("outline",""),"hideFocus"in e[0]&&t.attr("hideFocus",!1))}function pr(){t.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function wr(){if(location.hash&&location.hash.length>1){var t,i;try{t=n(location.hash)}catch(r){return}t.length&&f.find(location.hash)&&(e.scrollTop()===0?i=setInterval(function(){e.scrollTop()>0&&(kt(location.hash,!0),n(document).scrollTop(e.position().top),clearInterval(i))},50):(kt(location.hash,!0),n(document).scrollTop(e.position().top)))}}function gi(){n("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function nr(){gi();n("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var t=this.href.split("#"),n;if(t.length>1&&(n=t[1],n.length>0&&f.find("#"+n).length>0))return kt("#"+n,!0),!1})}function br(){var u,f,t,i,n,r=!1;e.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(e){var o=e.originalEvent.touches[0];u=ft();f=et();t=o.pageX;i=o.pageY;n=!1;r=!0}).bind("touchmove.jsp",function(e){if(r){var o=e.originalEvent.touches[0],s=l,a=c;return h.scrollTo(u+t-o.pageX,f+i-o.pageY),n=n||Math.abs(t-o.pageX)>5||Math.abs(i-o.pageY)>5,s==l&&a==c}}).bind("touchend.jsp",function(){r=!1}).bind("click.jsp-touchclick",function(){if(n)return n=!1,!1})}function kr(){var n=et(),i=ft();t.removeClass("jspScrollable").unbind(".jsp");t.replaceWith(si.append(f.children()));si.scrollTop(n);si.scrollLeft(i)}var u,h=this,f,s,o,e,v,a,ei,dt,b,w,y,k,c,p,nt,l,gt,d,oi,ct,tt,yt,pt,ni,g,ot,it,wt,bt,ti,vi,st,yi,ii=!0,ri=!0,ui=!1,fi=!1,si=t.clone(!1,!1).empty(),hi=n.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";vi=t.css("paddingTop")+" "+t.css("paddingRight")+" "+t.css("paddingBottom")+" "+t.css("paddingLeft");st=(parseInt(t.css("paddingLeft"),10)||0)+(parseInt(t.css("paddingRight"),10)||0);n.extend(h,{reinitialise:function(t){t=n.extend({},u,t);ci(t)},scrollToElement:function(n,t,i){kt(n,t,i)},scrollTo:function(n,t,i){at(n,i);ut(t,i)},scrollToX:function(n,t){at(n,t)},scrollToY:function(n,t){ut(n,t)},scrollToPercentX:function(n,t){at(n*(v-s),t)},scrollToPercentY:function(n,t){ut(n*(a-o),t)},scrollBy:function(n,t,i){h.scrollByX(n,i);h.scrollByY(t,i)},scrollByX:function(n,t){n=n>=0?Math.max(n,1):Math.min(n,-1);var i=ft()+n,r=i/(v-s);lt(r*nt,t)},scrollByY:function(n,t){n=n>=0?Math.max(n,1):Math.min(n,-1);var i=et()+n,r=i/(a-o);ht(r*k,t)},positionDragX:function(n,t){lt(n,t)},positionDragY:function(n,t){ht(n,t)},animate:function(n,t,i,r){var f={};f[t]=i;n.animate(f,{duration:u.animateDuration,ease:u.animateEase,queue:!1,step:r})},getContentPositionX:function(){return ft()},getContentPositionY:function(){return et()},getContentWidth:function(){return v},getContentHeight:function(){return a},getPercentScrolledX:function(){return ft()/(v-s)},getPercentScrolledY:function(){return et()/(a-o)},getIsScrollableH:function(){return w},getIsScrollableV:function(){return b},getContentPane:function(){return f},scrollToBottom:function(n){ht(k,n)},hijackInternalLinks:function(){nr()},destroy:function(){kr()}});ci(r)}return t=n.extend({},n.fn.jScrollPane.defaults,t),n.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){t[this]=t[this]||t.speed}),this.each(function(){var u=n(this),i=u.data("jsp");i?i.reinitialise(t):(i=new r(u,t),u.data("jsp",i))})};n.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:i,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}})(jQuery,this);
/*! Copyright (c) 2010 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.4
 * 
 * Requires: 1.2.2+
 */
(function(n){function i(t){var i=t||window.event,e=[].slice.call(arguments,1),r=0,f=0,u=0;return t=n.event.fix(i),t.type="mousewheel",i.wheelDelta&&(r=i.wheelDelta/120),i.detail&&(r=-i.detail/3),u=r,i.axis!==undefined&&i.axis===i.HORIZONTAL_AXIS&&(u=0,f=-1*r),i.wheelDeltaY!==undefined&&(u=i.wheelDeltaY/120),i.wheelDeltaX!==undefined&&(f=i.wheelDeltaX/-120),e.unshift(t,r,f,u),n.event.dispatch.apply(this,e)}var t=["DOMMouseScroll","mousewheel"];n.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var n=t.length;n;)this.addEventListener(t[--n],i,!1);else this.onmousewheel=i},teardown:function(){if(this.removeEventListener)for(var n=t.length;n;)this.removeEventListener(t[--n],i,!1);else this.onmousewheel=null}};n.fn.extend({mousewheel:function(n){return n?this.on("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.off("mousewheel",n)}})})(jQuery);
jQuery.cookie=function(n,t,i){var u,r,f,e;return arguments.length>1&&String(t)!=="[object Object]"?(i=jQuery.extend({},i),(t===null||t===undefined)&&(i.expires=-1),typeof i.expires=="number"&&(u=i.expires,r=i.expires=new Date,r.setDate(r.getDate()+u)),t=String(t),document.cookie=[encodeURIComponent(n),"=",i.raw?t:encodeURIComponent(t),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")):(i=t||{},e=i.raw?function(n){return n}:decodeURIComponent,(f=new RegExp("(?:^|; )"+encodeURIComponent(n)+"=([^;]*)").exec(document.cookie))?e(f[1]):null)};
/**
 * @preserve
 * FullCalendar v1.5.1
 * http://arshaw.com/fullcalendar/
 *
 * Use fullcalendar.css for basic styling.
 * For event drag & drop, requires jQuery UI draggable.
 * For event resizing, requires jQuery UI resizable.
 *
 * Copyright (c) 2011 Adam Shaw
 * Dual licensed under the MIT and GPL licenses, located in
 * MIT-LICENSE.txt and GPL-LICENSE.txt respectively.
 *
 * Date: Sat Apr 9 14:09:51 2011 -0700
 *
 */
(function(n,t){function ou(t){var e=t.categories,r=t.eventEditor,s=t.todoEditor,v=t.todoViewer,a=t.deleteTodoDialog,y=t.todoList,o=t.repeatSettings,c=t.deleteSettings,u=t.icalStream,l=t.confirmPopup,f={dialogHeaderAdd:i(e.dialogHeader_add),dialogHeaderImport:i(e.dialogHeader_import),dialogHeaderEdit:i(e.dialogHeader_edit),defaultCalendarName:i(e.defaultTitle),dialogBgColorLabel:i(e.dialogColor_label),dialogFontColorLabel:i(e.dialogTextColor_label),dialogAlertLabel:r.dialogAlertLabel,alertOptions:[{value:b,text:r.dialogAlertOption_never},{value:1,text:r.dialogAlertOption_5minutes},{value:2,text:r.dialogAlertOption_15minutes},{value:3,text:r.dialogAlertOption_30minutes},{value:4,text:r.dialogAlertOption_hour},{value:5,text:r.dialogAlertOption_2hours},{value:6,text:r.dialogAlertOption_day}],dialogTimezoneLabel:e.dialogTimezoneLabel,dialogInputiCalLabel:u.dialogInputiCalLabel,dialogImportExportLabel:u.dialogImportExportLabel,dialogImportLabel:u.dialogImportLabel,dialogImportLabelNew:u.dialogImportLabelNew,fileNotSelected:u.dialogButton_fileNotSelected,dialogStreamLink:u.dialogStreamLink,dialogExportLink:u.dialogExportLink,dialogButtonSave:e.dialogButton_save,dialogButtonCancel:e.dialogButton_cancel,dialogButtonDelete:e.dialogButton_delete,maxlength:h.eventMaxTitleLength};t.categories.dialogTemplate=n("#categoriesDialogTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={dialogHeader:i(e.subscriptionsDialogHeader),dialogBgColorLabel:i(e.dialogColor_label),dialogFontColorLabel:i(e.dialogTextColor_label),dialogAlertLabel:i(r.dialogAlertLabel),alertOptions:[{value:b,text:r.dialogAlertOption_never},{value:1,text:r.dialogAlertOption_5minutes},{value:2,text:r.dialogAlertOption_15minutes},{value:3,text:r.dialogAlertOption_30minutes},{value:4,text:r.dialogAlertOption_hour},{value:5,text:r.dialogAlertOption_2hours},{value:6,text:r.dialogAlertOption_day}],dialogTimezoneLabel:i(e.dialogTimezoneLabel),dialogOwnerLabel:e.subscriptionsDialogOwnerLabel,dialogSavediCalLabel:i(u.dialogSavediCalLabel),dialogImportExportLabel:i(u.dialogImportExportLabel),dialogImportLabel:i(u.dialogImportLabel),dialogImportLabelNew:i(u.dialogImportLabelNew),fileNotSelected:i(u.dialogButton_fileNotSelected),dialogStreamLink:i(u.dialogStreamLink),dialogExportLink:i(u.dialogExportLink),dialogButtonSave:e.dialogButton_save,dialogButtonCancel:e.dialogButton_cancel,dialogButtonDelete:e.dialogButton_delete,dialogButtonUnsubscribe:e.subscriptionsDialogButton_unsubscribe,maxlength:h.eventMaxTitleLength};t.categories.subscriptionsDialog=n("#categoriesSubscriptionsDialogTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={dialogTitle:i(e.subscriptionsManageDialog_title),dialogSearchText:i(e.subscriptionsManageDialog_qsearchText),dialogButtonSave:i(e.subscriptionsManageDialogButton_save),dialogButtonCancel:i(e.subscriptionsManageDialogButton_cancel),maxlength:h.eventMaxTitleLength};t.categories.subscriptionsManageDialog=n("#categoriesSubscriptionsManageDialogTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={dialogHeaderAdd:i(r.dialogHeader_add),defaultEventSummary:i(r.newEventTitle),eventButton:i(r.eventButton),todoButton:i(r.todoButton),dialogLocationLabel:i(r.dialogLocationLabel),dialogAttendeesLabel:i(r.dialogAttendeesLabel),dialogOwnerLabel:i(r.dialogOwnerLabel),dialogOrganizerLabel:i(r.dialogOrganizerLabel),dialogAllDayNoText:i(r.dialogAllDay_no),dialogAllDayYesText:i(r.dialogAllDay_yes),dialogFromLabel:i(r.dialogFromLabel),dialogToLabel:i(r.dialogToLabel),dialogAlertLabel:i(r.dialogAlertLabel),dialogRepeatLabel:i(r.dialogRepeatLabel),dialogSharingNoText:i(r.dialogSharing_no),dialogSharingYesText:i(t.sharedList.title),dialogCalendarLabel:i(r.dialogCalendarLabel),dialogDescriptionLabel:i(r.dialogDescriptionLabel),dialogSummaryLabel:i(r.dialogSummaryLabel),dialogAllDayLabel:i(r.dialogAllDayLabel),dialogSentInvitations:i(r.dialogSentInvitations),dialogAlertOptionDefault:i(r.dialogAlertOption_default),dialogRepeatOptionNever:i(r.dialogRepeatOption_never),dialogStatusLabel:i(r.dialogStatusLabel),dialogStatusOptionTentative:i(r.dialogStatusOption_tentative),dialogStatusOptionConfirmed:i(r.dialogStatusOption_confirmed),dialogStatusOptionCancelled:i(r.dialogStatusOption_cancelled),repeatFromLabel:i(o.dialogFromLabel),repeatRepeatOnLabel:i(o.dialogRepeatOnLabel),repeatRepeatOnDays:i(o.dialogRepeatOn_days),repeatEachLabel:i(o.dialogEachLabel),repeatIntervalOptionDay:i(o.dialogIntervalOption_day),repeatToLabel:i(o.dialogToLabel),repeatOptionNever:i(o.dialogOptionNever),repeatAfterLabel:i(o.dialogAfterLabel),repeatTimesLabel:i(o.dialogTimesLabel),dialogButtonEdit:i(r.dialogButton_edit),dialogButtonSave:i(r.dialogButton_save),dialogButtonClose:i(r.dialogButton_close),dialogButtonCancel:i(r.dialogButton_cancel),dialogButtonDelete:i(r.dialogButton_delete),dialogButtonUnsubscribe:i(r.dialogButton_unsubscribe),dialogButtonMoreDetails:i(r.dialogButton_moreDetails),dialogButtonDetails:i(r.dialogButton_details),maxlength:h.eventMaxTitleLength,dialogTodoDate:i(s.dialogDateLabel),dialogTodoNameLabel:i(s.titleLabel)};t.eventEditor.dialogTemplate=n("#eventEditorDialogTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={dialogHeader:i(c.dialogHeader),dialogSingleHeader:i(c.dialogSingleHeader),dialogSingleBody:i(c.dialogSingleBody),dialogDeleteOnlyThisLabel:i(c.dialogDeleteOnlyThisLabel),dialogDeleteFollowingLabel:i(c.dialogDeleteFollowingLabel),dialogDeleteAllLabel:i(c.dialogDeleteAllLabel),dialogButtonSave:i(c.dialogButton_save),dialogButtonCancel:i(c.dialogButton_cancel)};t.deleteSettings.dialogTemplate=n("#deleteSettingsDalogTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={dialogHeader:i(u.dialogHeader),dialogTodoDescription:i(u.dialogTodoDescription),dialogDescription:i(u.dialogDescription),dialogCaldavHelp:i(u.dialogCaldavHelp),dialogHelpCenter:i(u.dialogHelpCenter),dialogPreparingMessage:i(u.dialogPreparingMessage),dialogPreparingErrorMessage:i(u.dialogPreparingErrorMessage),dialogButtonClose:i(u.dialogButton_close),dialogExportCalDav:i(u.dialogExportCalDav),dialogCopyButton:i(u.dialogCopyButton),dialogTryAgainButton:i(u.dialogTryAgainButton),dialogExportIcal:i(u.dialogExportIcal)};t.icalStream.dialogTemplate=n("#icalStreamDialogTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={dialogHeader:i(l.dialogAddEventHeader),dialogBody:i(l.dialogAddEventBody),dialogButtonSend:i(l.dialogButtonSend),dialogButtonSendCustoms:i(l.dialogButtonSendCustoms),dialogButtonSendEveryone:i(l.dialogButtonSendEveryone),dialogButtonDontSend:i(l.dialogButtonDontSend)};t.confirmPopup.dialogTemplate=n("#attendeeConfirmNotificationTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={dialogTitle:i(s.dialogHeader_add),dialogDate:i(s.dialogDateLabel),dialogNameLabel:i(s.titleLabel),dialogDescriptionLabel:i(s.descriptionLabel),dialogButtonSave:i(s.dialogButton_save),dialogButtonCancel:i(s.dialogButton_cancel)};t.todoEditor.dialogTemplate=n("#todoEditorDialogTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={dialogButtonMarkOn:i(v.dialogButton_mark_on),dialogButtonMarkOff:i(v.dialogButton_mark_off),dialogButtonEdit:i(v.dialogButton_edit),dialogButtonDelete:i(v.dialogButton_delete)};t.todoViewer.dialogTemplate=n("#todoViewDialogTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={dialogHeader:i(a.dialogHeader),dialogText:i(a.deleleDialogText),dialogSingleBody:i(a.dialogSingleBody),dialogButton_apply:i(a.dialogButton_apply),dialogButton_cancel:i(a.dialogButton_cancel)};t.deleteTodoDialog.dialogTemplate=n("#deleteTodoDalogTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");f={menuTodoInCalendar:i(y.menuTodoInCalendar),menuDeleteMarkedTodo:i(y.menuDeleteMarkedTodo),menuSyncLinks:i(y.menuSyncLinks)};t.todoList.menuTemplate=n("#todoMenuTemplate").tmpl(f).html().replace(/\>\s+\</g,"><");t.todoList.deleteIcon=n("#delete_todo_icon").tmpl(f).html().replace(/\>\s+\</g,"><");t.todoList.editIcon=n("#edit_todo_icon").tmpl(f).html().replace(/\>\s+\</g,"><");t.todoList.settingsIcon=n("#settings_todo_icon").tmpl(f).html().replace(/\>\s+\</g,"><")}function su(i,r,o){function wi(n){l?(vt(),ei(),hi(),d(n)):bi()}function bi(){function a(){function n(){function i(){var i=u.objectIsEditable(n)||u.objectIsEditable(n.source)||n.source&&!n.source.isSubscription,r=n.source==t||i;li(r,null,n)}var n=s.clientEvents(r.targetEventId)[0];n&&(n&&!isNaN(n.objectId)&&n.uniqueId?window.Teamlab.getCalendarEventById({},n.objectId,{success:function(t,r){if(r.eventUid===n.uniqueId&&r.mergedIcs){console.info(r);var u=gt(r.mergedIcs);n=jq.extend(n,u||{});i()}},error:function(n,t){console.error(t)},max_request_attempts:1}):i())}ASC.Mail.Initialized?n():setTimeout(a,500)}var f,c,o,e;pi=r.theme?"ui":"fc";i.addClass("fc");r.isRTL&&i.addClass("fc-rtl");r.theme&&i.addClass("ui-widget");f=n('<div id="fc_container"><table cellpadding="0" cellspacing="0" width="100%" class="fc_table"><tbody><tr><td class="fc-main"><\/td><\/tr><\/tbody><\/table><div class="fc-todo-list-container"><\/div><\/div>');c=f.find(".fc-todo-list-container");c.on("transitionend MSTransitionEnd webkitTransitionEnd oTransitionEnd",function(){at()});b=new hu(s,r);ht=b.render();ht&&ht.length>0&&f.prepend(ht);nt=new vu(s);n("#calendarSidePanelContent").append(nt.render());w=new yu(s);s.todolist=w;c.append(w.render());l=n("<div class='fc-content' style='position:relative'><div class='fc-modal'><\/div><\/div>").appendTo(f.find("td.fc-main"));tt=new pu(s,l.children(".fc-modal"));f.appendTo(i);o=h.defaultView;r.defaultView?o=r.defaultView:(e=n.cookie("fc_current_view"),e&&e.length>0&&e.search(/\w/)>=0&&(o=e));fi(o);n(window).on("resize",oi);nt.showMiniCalendar(parseInt(n.cookie("fc_show_minicalendar"),10)!==0);ri()||ii();r.targetEventId&&a()}function ii(){setTimeout(function(){!c.start&&ri()&&d()},0)}function ki(){n(window).off("resize",oi);b.destroy();l.remove();i.removeClass("fc fc-rtl ui-widget")}function lt(){return ot.style.display!="none"}function ri(){return n("body")[0].offsetWidth!==0}function di(){c.clearEvents();var t=n("#fc_container");t.toggleClass("open-todo-list");t.find(".fc-button-todo").toggleClass("fc-state-active")}function fi(t){if(!c||t!=c.name){k++;pt();var i=c,r;i?((i.beforeHide||fr)(),ui(l,l.height()),i.element.hide()):ui(l,1);l.css("overflow","hidden");c=ct[t];c?c.element.show():c=ct[t]=new p[t](r=n("<div class='fc-view fc-view-"+t+"'><\/div>").appendTo(l),s);n.cookie("fc_current_view",t+"",{expires:365});i&&b.deactivateButton(i.name);b.activateButton(t);b.resize();d();l.css("overflow","");i&&ui(l,1);r||(c.afterShow||fr)();k--}}function gi(n,t){b.clickButton(n,t)}function d(n){var r,u,f;lt()&&(k++,pt(),rt===t&&vt(),r=!1,!c.start||n||a<c.start||a>=c.end?(c.render(a,n||0),yt(!0),r=!0,u=jq(document).find(".fc-main"),u!=t&&u.length>0&&te.call(this,u[0])):c.sizeDirty?(c.clearEvents(),yt(),r=!0):c.eventsDirty&&(c.clearEvents(),r=!0),c.sizeDirty=!1,c.eventsDirty=!1,ir(r),wt=i.outerWidth(),b.updateTitle(c.title,c.name),f=new Date,f>=c.start&&f<c.end?b.disableButton("today"):b.enableButton("today"),nt.updateDatepicker(a),k--,c.trigger("viewDisplay",ot),ni("viewChanged",c,c.name,ai()))}function dt(){var n=tt.getEventObj(),u=s.todolist.getTodoElem(),i,r;s.openEventWin&&(s.openEventWin.isTodo||n==t?s.openEventWin.objectId!=null&&s.openEventWin.isTodo&&u!=t&&(r=jQuery(".fc-todo-open"),r.length>0&&tt.openEvent(r,u)):n.objectId?(i=jQuery(".fc-event-open"),i.length>0&&tt.openEvent(i,n)):(tt.closePopupEvent(!0),tt.addEvent(n.start,n.end,n.allDay,!0)))}function at(){c.name=="agendaWeek"&&c.updateHeader();b.resize();ei();lt()&&(c.clearEvents(),vt(),yt(),pt(),c.renderEvents(kt),c.sizeDirty=!1,tr())}function ei(){n.each(ct,function(n,t){t.sizeDirty=!0})}function vt(){r.contentHeight?rt=Math.max(r.contentHeight,r.minHeight||0):r.height?(typeof r.onHeightChange=="function"&&r.onHeightChange(),rt=Math.max(r.height,r.minHeight||0)-ASC.CalendarSizeManager.cache.fcHeaderHeight):rt=Math.max(Math.round(l.width()/Math.max(r.aspectRatio,.5)),r.minHeight||0)}function yt(n,t){var i,r;k++;c.setHeight(rt,n);i=l.width();c.setWidth(i,n);k--;var u=jq("#studioPageContent .mainPageLayout:not(.studio-top-panel)").outerHeight(!0)-jq("#studioPageContent .mainPageLayout:not(.studio-top-panel)").height(),f=jq(".mainPageTable .mainPageTableSidePanel.ui-resizable").outerHeight(!0)-jq(".mainPageTable .mainPageTableSidePanel.ui-resizable").height(),e=jq(".small_chat_down_panel").length>0?jq(".small_chat_down_panel").height():0;nt.resize(rt-u-f-e);w&&w.length>0&&w.resize(rt);r=l.width();i!=r&&(t||vt(),yt(!1,i>r))}function tr(){var n=document.querySelector(".fc-header");if(n&&!(window.innerWidth>1200)){var t=n.querySelector(".fc-header-left"),i=n.querySelector(".fc-header-center"),r=n.querySelector(".fc-header-right"),u=n.clientWidth-t.clientWidth-r.clientWidth;i.style.width=u+"px"}}function oi(){if(k)setTimeout(function(){n(window).trigger("resize")},200);else if(c.start){var t=++ti;setTimeout(function(){t==ti&&!k&&lt()&&(wt!=(wt=i.outerWidth())?(k++,at(),c.trigger("windowResize",ot),setTimeout(function(){dt();k--},200)):dt())},200)}else ii()}function ir(n){!r.lazyFetching||vi(c.visStart,c.visEnd)?si():n&&et()}function si(){yi(c.visStart,c.visEnd)}function rr(n){kt=n;et()}function ur(t,i){function f(t){v||(v=n(r.confirmPopup.dialogTemplate).addClass("asc-dialog").popupFrame({anchor:"right,top",direction:"right,down",offset:"0,0",showArrow:!1}),v.find(".title").text(r.confirmPopup.dialogUpdateEventHeader),v.find(".body").text(r.confirmPopup.dialogUpdateEventBody),v.find(".send-customs-btn, .send-everyone-btn").remove());v.find(".buttons .send-btn").off("click").on("click",function(){u(t,!0)});v.find(".buttons .dont-send-btn").off("click").on("click",function(){u(t,!1)})}function e(n){f(n);var t=jq(".fc-content .fc-modal");v.popupFrame("close");t.removeClass("fc-modal-transparent");v.popupFrame("open",{pageX:"center",pageY:"center"});v.css("position","fixed");v.popupFrame("isVisible")?t.show():t.hide()}function o(){v&&v.popupFrame("close");jq(".fc-content .fc-modal").hide()}function h(n){var t=jq.map(n.attendees,function(n){return n[3].replace(new RegExp("mailto:","ig"),"")});t.length&&(ASC.CalendarController.Busy=!0,window.LoadingBanner.displayLoading(),ASC.Mail.Utility.SendCalendarUpdate(n.sourceId,n.uniqueId,t).done(function(){console.log(r.confirmPopup.dialogSuccessToastText,arguments)}).fail(function(){toastr.error(r.confirmPopup.dialogErrorToastText);console.error(r.confirmPopup.dialogErrorToastText,arguments)}).always(function(){ASC.CalendarController.Busy=!1;window.LoadingBanner.hideLoading()}))}function u(i,r){if(o(),i&&i.source){i.newSourceId=i.sourceId;ni("editEvent",s,n.extend({action:bt,sourceId:i.source.objectId,newSourceId:i.source.objectId},i),function(n){var t,u;if(n.result){for(t=s.getCache(),u=0;u<t.length;++u)t[u].objectId==i.eventId&&t.splice(u,1);t.concat(n.event);s.refetchEvents();et();r&&h(i)}});return}et(t)}i&&!isNaN(i.objectId)&&i.uniqueId?Teamlab.getCalendarEventById({},i.objectId,{success:function(n,t){var s,r,f,o;t.eventUid===i.uniqueId&&t.mergedIcs&&(console.info(t),s=gt(t.mergedIcs),i=jq.extend(i,s||{}),r=!1,f=i.organizer?i.organizer[3].replace(new RegExp("mailto:","ig"),"").toLowerCase():"",jq.each(ASC.Mail.Accounts,function(n,t){return t.enabled&&f==t.email.toLowerCase()?(r=!0,!1):!0}),o=[],jq.each(i.attendees||[],function(n,t){var i=t[3].replace(new RegExp("mailto:","ig"),"");i.toLowerCase()!=f&&o.push(i)}),r&&o.length&&!i.source.isSubscription?e(i):u(i,!1))},error:function(n,t){console.error(t)},max_request_attempts:1}):u(i,!1)}function et(n){hi();lt()&&(c.clearEvents(),c.renderEvents(kt,n),c.eventsDirty=!1)}function er(n){nt.rerenderList();nt.updateDatepickerSize();w.rerenderList(n)}function hi(){n.each(ct,function(n,t){t.eventsDirty=!0})}function or(n,t){tt.openEvent(n,t)}function sr(n,t,i){tt.addEvent(n,t,i)}function hr(n){nt.addiCalCalendar(n)}function cr(n){nt.addNewCalendar(n)}function lr(){return tt.isVisible()}function ar(n){return w&&w.length>0?n===!1?w.hide():w.show():!1}function ci(){ut||(ut=new wu(s))}function vr(){ci();jq("#asc_event .event-editor .editor").is(":visible")?confirm(ASC.Resources.Master.ResourceJS.WarningMessageBeforeUnload)&&ut.addEvent():ut.addEvent()}function li(n,t,i){ci();ut.openEvent(n,t,i)}function yr(n,i,r){c.select(n,i,r===t?!0:r)}function pt(){c&&c.unselect()}function pr(n){d(t===n?-1:n)}function wr(n){d(t===n?1:n)}function br(){st(a,-1);d()}function kr(){st(a,1);d()}function dr(){a=new Date;d()}function gr(n,t,i){n instanceof Date?a=f(n):nr(a,n,t,i);d()}function nu(n,i,r){n!==t&&st(a,n);i!==t&&g(a,i);r!==t&&e(a,r);d()}function ai(){return f(a)}function tu(){return c}function iu(n,i){return i===t?r[n]:((n=="height"||n=="contentHeight"||n=="aspectRatio")&&(r[n]=i,at()),i)}function ni(n,i){return r[n]?r[n].apply(i||ot,Array.prototype.slice.call(arguments,2)):t}var s=this;s.options=r;s.render=wi;s.destroy=ki;s.refetchEvents=si;s.reportEvents=rr;s.reportEventChange=ur;s.rerenderEvents=et;s.rerenderCategories=er;s.changeView=fi;s.openTodoList=di;s.changeViewAndMode=gi;s.select=yr;s.unselect=pt;s.prev=pr;s.next=wr;s.prevYear=br;s.nextYear=kr;s.today=dr;s.gotoDate=gr;s.incrementDate=nu;s.formatDate=function(n,t){return y(n,t,r)};s.formatDates=function(n,t,i){return it(n,t,i,r)};s.getDate=ai;s.getView=tu;s.option=iu;s.trigger=ni;s.updateSize=at;s.updateEventWin=dt;s.editEvent=or;s.addAndEditEvent=sr;s.addNewCalendar=cr;s.addiCalCalendar=hr;s.isEditingEvent=lr;s.showTodo=ar;s.showEventPageEditor=vr;s.showEventPageViewer=li;bu.call(s,r,o);var vi=s.isFetchNeeded,yi=s.fetchEvents,ot=i[0],nt,w,tt,ut,b,ht,l,pi,c,ct={},wt,rt,ti=0,k=0,a=new Date,kt=[],ft,v;if(nr(a,r.year,r.month,r.date),r.droppable)n(document).on("dragstart",function(t,i){var f=t.target,e=n(f),u;e.parents(".fc").length||(u=r.dropAccept,(typeof u=="function"?u.call(f,e):e.is(u))&&(ft=f,c.dragStart(ft,t,i)))}).on("dragstop",function(n,t){ft&&(c.dragStop(ft,n,t),ft=null)})}function hu(u,f){function h(t){var r,i,o,s;return u[t]?r=u[t]:p[t]?r=function(){i.removeClass(e+"-state-hover");u.changeView(t)}:t=="todo"&&(r=function(){u.openTodoList()}),r&&(o=f.theme?at(f.buttonIcons,t):null,s=at(f.buttonText,t),i=n("<span class='fc-button fc-button-"+t+" "+e+"-state-default'><span class='fc-button-inner'><span class='fc-button-content'>"+(o?"<span class='fc-icon-wrap'><span class='ui-icon ui-icon-"+o+"'><\/span><\/span>":s)+"<\/span><\/span><\/span>"),i&&i.on("click",function(){i.hasClass(e+"-state-disabled")||r()}).on("mousedown",function(){i.not("."+e+"-state-active").not("."+e+"-state-disabled").addClass(e+"-state-down")}).on("mouseup",function(){i.removeClass(e+"-state-down")}).on("mouseenter",function(){i.not("."+e+"-state-active").not("."+e+"-state-disabled").addClass(e+"-state-hover")}).on("mouseleave",function(){i.removeClass(e+"-state-hover").removeClass(e+"-state-down")}).addClass(e+"-corner-left").addClass(e+"-corner-right")),i}function k(t){var i=n("<div class='fc-header-"+t+"'><\/div>"),r=f.header[t];return r&&n.each(r.split(" "),function(t){t>0&&i.append("<span class='fc-header-space'><\/span>");n.each(this.split(","),function(n,t){if(t=="title")i.append("<span class='fc-header-title'>&nbsp;<\/span>");else{var r=h.call(o,t);r&&r.appendTo(i)}})}),i}function rt(t){var e=i(u.options.addNewLabel),f;n('<ul class="menu-actions"><li class="menu-main-button without-separator big" title="'+e+'"><span class="main-button-text">'+e+'<\/span><span class="white-combobox">&nbsp;<\/span><\/li><\/ul>').appendTo(t);f=t.find(".menu-main-button");f.on("click",function(n){r.hideMenus(r.modeMenuAddNew);r.modeMenuAddNew.popupMenu("open",f);n.stopPropagation()});!r.modeMenuAddNew||r.modeMenuAddNew.length<1?r.modeMenuAddNew=n('<div id="fc_mode_menu_add_new"><\/div>'):(r.modeMenuAddNew.popupMenu("close"),r.modeMenuAddNew.popupMenu("destroy"));r.modeMenuAddNew.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:u.options.eventEditor.newEventTitle,click:function(){u.showEventPageEditor()}},{label:u.options.categories.defaultTitle,click:function(){u.addNewCalendar({pageX:"center",pageY:"center"})}},{label:"",cssClass:"dropdown-item-seporator"},{label:u.options.icalStream.importEventsTitle,click:function(){u.addiCalCalendar({pageX:"center",pageY:"center"})}}]})}function ut(t){var o=u.options.categories,r=new Date,e,f;e=window.moment?window.moment(r).calendar(null,{lastWeek:"dddd DD.MM.YYYY",sameElse:"dddd DD.MM.YYYY",nextWeek:"dddd DD.MM.YYYY"}).split(" ")[0]:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][r.getDay()];f=n('<div class="fc-header-today"><div class="date-box"><div class="today">'+e+', <\/div><div class="today-day">'+i(tt(r,o.dayFormat))+'<\/div><div class="today-month">'+i(tt(r,"MMM"))+"<\/div><\/div><\/div>");f.find(".date-box").children().on("click",function(){u.today()});f.appendTo(t.find(".fc-header-center"))}function it(n){v.text(c[n]);g.removeClass().addClass("icon").addClass(y[n]);for(var t=0;t<l.length;++t)l[t].css("display",t!=n?"none":"inline-block");nt=n;ft()}function ft(){var n=document.querySelector(".fc-header");!n||window.innerWidth>1200||setTimeout(function(){var t=n.querySelector(".fc-header-left"),i=n.querySelector(".fc-header-center"),r=n.querySelector(".fc-header-right"),u=n.clientWidth-t.clientWidth-r.clientWidth;i.style.width=u+"px"},100)}function d(n){it(n);a&&a.length>0&&o.clickButton(a,n)}function et(t){t.find(".fc-header-right").append('<span class="fc-calendar-buttons"><\/span><span class="fc-list-buttons"><\/span>');l[0]=t.find(".fc-calendar-buttons").append(h.call(o,"agendaDay")).append(h.call(o,"agendaWeek")).append(h.call(o,"month")).append(h.call(o,"list")).append(h.call(o,"todo"));l[1]=t.find(".fc-list-buttons").append(h.call(o,"listDay")).append(h.call(o,"listWeek")).append(h.call(o,"listMonth")).append(h.call(o,"list"));c[0]=f.modes.calendarViewLabel;c[1]=f.modes.listViewLabel;y[0]="calendar";y[1]="list";w[0]={listDay:"agendaDay",todoList:"todo",listWeek:"agendaWeek",listMonth:"month",list:"month",day:"agendaDay"};w[1]={agendaDay:"listDay",todo:"todoList",agendaWeek:"listWeek",month:"listMonth",day:"listDay"};b={agendaDay:0,agendaWeek:0,month:0,todo:0,listDay:1,listWeek:1,listMonth:1,list:0};v=t.find(".fc-view-selector .label");g=t.find(".fc-view-selector .icon");t.find(".fc-view-selector .label, .fc-view-selector .fc-dropdown").on("click",function(n){r.hideMenus(r.modeMenu);r.modeMenu.popupMenu("open",v);n.stopPropagation()});!r.modeMenu||r.modeMenu.length<1?r.modeMenu=n('<div id="fc_mode_menu"><\/div>'):(r.modeMenu.popupMenu("close"),r.modeMenu.popupMenu("destroy"));r.modeMenu.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:c[0],click:function(){d.call(o,0)}},{label:c[1],click:function(){d.call(o,1)}}]});d.call(o,0)}var o=this,s=n([]),e,v,g,c=[],l=[],y=[],w=[],b={},a,nt,tt=u.formatDate,ot=u.formatDates;this.render=function(){e=f.theme?"ui":"fc";var t=f.header;return t?(s=n('<div class="fc-header-outer"><\/div>').append(n('<div class="fc-header"><\/div>').append(k.call(this,"left")).append(k.call(this,"center")).append(k.call(this,"right"))),et.call(this,s),rt.call(this,n("#calendarSidePanelActions")),ut.call(this,s),s):null};this.destroy=function(){s.remove()};this.updateTitle=function(r,u){var f=s.find("span.fc-header-title").empty(),o,h,e;typeof r=="string"?f.append(n("<h2>"+i(r)+"<\/h2>")):(o=n(r).clone(!0),f.append(o.children()));f.removeClass().addClass("fc-header-title");h=u.split(/(?=[A-Z])/);e=h.pop();e!=t&&f.addClass(e.toLowerCase())};this.activateButton=function(n){a=n;it(b[n]!==t?b[n]:0);s.find("span.fc-button-"+n).addClass(e+"-state-active")};this.deactivateButton=function(n){s.find("span.fc-button-"+n).removeClass(e+"-state-active")};this.disableButton=function(n){s.find("span.fc-button-"+n).addClass(e+"-state-disabled")};this.enableButton=function(n){s.find("span.fc-button-"+n).removeClass(e+"-state-disabled")};this.clickButton=function(n,i){s.find(".fc-button-"+w[i!=t?i:nt][n]).trigger("click")};this.resize=function(){s.find(".fc-header-left")[0].style.width="";s.find(".fc-header-center")[0].style.width=""}}function kt(r,u,f){function y(n){e&&typeof e[n]=="function"&&e[n].apply(e.context!=t?e.context:window,Array.prototype.slice.call(arguments,1))}function w(){var n=r.options.sharedList;u.append('<div class="empty-list"><span class="add-icon"><\/span><span class="link">'+i(f)+'<\/span><\/div><div class="users-list"><div class="label">'+i(n.title)+'<\/div><div class="short-list"><\/div><div class="more-users"><span class="link">'+i(n.moreLink)+'<\/span><\/div><div class="add-users"><span class="add-icon"><\/span><span class="link">'+i(n.addLink)+"<\/span><\/div><\/div>");o=u.find(".users-list .short-list");c=u.find(".more-users .link");p=n.moreLink;l=n.shortListLength>0?n.shortListLength:5;u.find(".empty-list .link, .add-users .link, .add-users .add-icon").on("click",d)}function d(){r.trigger("editPermissions",s,{type:a,objectId:v,permissions:h},k)}function b(){var t=n(this).parent().index();r.trigger("removePermissions",s,{type:a,objectId:v,userId:h.users[t].objectId,permissions:h},k)}function k(n){n.result&&y.call(s,"onChange",n)}function g(n){return'<span class="user"><span class="icon">&nbsp;<\/span><span class="name">'+i(n.name)+'<\/span><span class="remove-btn">&nbsp;<\/span><\/span> '}var s=this,e={},o,p,c,l,h,a,v;this.setEventsHandlers=function(i){i!=t&&n.extend(e,i)};w();this.render=function(t,i,r){var e,k,f,d,nt;if(h=t,a=i,v=r,u.empty(),w(),u.removeClass("has-users more-users"),o.find(".user").remove(),c.off("click"),t&&t.users&&t.users.length>0){for(u.show(),u.addClass("has-users"),e="",k="",f=0;f<t.users.length;++f)d=g.call(s,t.users[f]),f<l?e+=d:k+=d;o.append(e);o.find(".user .remove-btn").on("click",b);if(nt=t.users.length-l,nt>0){u.addClass("more-users");c.text(p.replace("%d",nt)).on("click",function(){n(this).off("click");u.removeClass("more-users");o.append(k);o.find(".user .remove-btn").on("click",b);y.call(s,"onResize")})}}}}function cu(r){function bt(n){k&&typeof k[n]=="function"&&k[n].apply(k.context!=t?k.context:window,Array.prototype.slice.call(arguments,1))}function p(n){switch(n){case vt:return f.find(".title input");case ot:return f.find(".color .inner");case st:return f.find(".color .inner-for-text")}return t}function gt(n,t){for(var r=u.parseCssColor(n),i=(Math.round(r.r*.9)<<16|Math.round(r.g*.9)<<8|Math.round(r.b*.9)).toString(16);i.length<6;)i="0"+i;t.css("background-color",n).css("border-color","#"+i);t.parent().css("border-color","#"+i)}function ni(n){gt(n,p(ot));f.find(".title .bullet").css("background",n)}function ti(n){gt(n,p(st))}function l(n,t){a=n;switch(n){case lt:case g:f.removeClass("edit-mode");break;case dt:f.addClass("edit-mode")}t?f.addClass("import"):f.removeClass("import")}function fi(n){n.result&&(it=n.permissions,n.isShared!=t&&(e.isShared=n.isShared),ft.render(it,ct,e.objectId),f.popupFrame("updatePosition",d))}function w(){var n="";f.find(".choose_event_source").removeClass("hidden");f.find(".calendar").removeClass("hidden");for(key in s)n+=s[key];switch(n){case"1110":f.find(".title").removeClass("hidden");f.find(".color").removeClass("hidden");f.find(".shared-list").addClass("hidden");f.find(".row").addClass("hidden");f.find(".ical").addClass("hidden");f.find(".sync-with-calendar").removeClass("hidden");f.find(".ical-url-input").removeClass("hidden");f.find(".calendar select").val(-1);f.find(".calendar select").prop("disabled",!0);f.find(".calendar .bullet").css("color","transparent");l.call(o,g,!0);break;case"0110":f.find(".title").removeClass("hidden");f.find(".color").removeClass("hidden");f.find(".shared-list").removeClass("hidden");f.find(".row").removeClass("hidden");f.find(".sync-with-calendar").removeClass("hidden");f.find(".ical-url-input").removeClass("hidden");f.find(".ical").addClass("hidden");f.find(".calendar select").prop("disabled",!1);l.call(o,rt,!0);break;case"0010":f.find(".title").addClass("hidden");f.find(".color").addClass("hidden");f.find(".shared-list").addClass("hidden");f.find(".row").addClass("hidden");f.find(".ical").addClass("hidden");f.find(".sync-with-calendar").removeClass("hidden");f.find(".ical-url-input").removeClass("hidden");f.find(".calendar select").prop("disabled",!1);l.call(o,et,!0);break;case"0101":f.find(".title").removeClass("hidden");f.find(".color").removeClass("hidden");f.find(".shared-list").removeClass("hidden");f.find(".row").removeClass("hidden");f.find(".sync-with-calendar").addClass("hidden");f.find(".ical-url-input").addClass("hidden");f.find(".ical").removeClass("hidden");f.find(".calendar select").prop("disabled",!1);l.call(o,lt,!0);break;case"0001":f.find(".title").addClass("hidden");f.find(".color").addClass("hidden");f.find(".shared-list").addClass("hidden");f.find(".row").addClass("hidden");f.find(".sync-with-calendar").addClass("hidden");f.find(".ical-url-input").addClass("hidden");f.find(".ical").removeClass("hidden");f.find(".calendar select").prop("disabled",!1);l.call(o,at,!0);break;case"0000":f.find(".title").removeClass("hidden");f.find(".color").removeClass("hidden");f.find(".shared-list").removeClass("hidden");f.find(".row").removeClass("hidden");f.find(".choose_event_source").addClass("hidden");f.find(".ical").addClass("hidden");f.find(".calendar").addClass("hidden");f.find(".sync-with-calendar").addClass("hidden")}}function yt(i){n(document).on("keyup",ui);f.popupFrame("open",i);f.find("#ical-browse-btn").show();f.find(".ical-file-selected").hide();f.find(".ical-file-del").hide();f.find(".ical-url-input input").val("");f.find(".choose_event_source span").removeClass("active");f.find("#events_link").addClass("active");f.find(".buttons .save-btn").removeClass("disable");f.find(".sync-with-calendar input").prop("checked",!1);f.find(".sync-with-calendar input").on("click",function(){s.isSyncWithCalendar=+f.find(".sync-with-calendar input").is(":checked");s.isNewCalendar=1;w()});f.find(".choose_event_source span").on("click",function(){n(".choose_event_source span").removeClass("active");n(this).addClass("active");n(this)[0].id=="events_link"?(l.call(o,g),s.isExportLink=1,s.isExportFile=0,f.find(".buttons .save-btn").removeClass("disable")):(l.call(o,at),s.isExportLink=0,s.isExportFile=1,s.isSyncWithCalendar=0,v.isChanged||f.find(".buttons .save-btn").addClass("disable"),f.find(".sync-with-calendar input").prop("checked",!1));w()});f.find(".calendar select").on("change",function(){for(var a=n(this).val(),h=r.getEventSources(),o=0;o<h.length;++o){if(h[o].objectId!=a){if(a==-1){f.find(".calendar .bullet").css("background","transparent");f.find(".title input").trigger("focus");s.isNewCalendar=1;var l=r.options,v=l.categories,p=u.parseCssColor(u.randomHex(!0)),c=u.parseCssColor(u.randomHex(!1)),b=u.changeColorLightness(c.r,c.g,c.b,l.eventBg2BorderRatio);y=t;e={title:v.defaultTitle,textColor:p.origColor,backgroundColor:c.origColor,borderColor:b.color,isHidden:!1,events:[],todos:[],permissions:{users:[]},defaultAlert:{type:0},timeZone:n.extend({},l.defaultTimeZone)};d=i}w();continue}s.isNewCalendar=0;e=r.getEventSources()[o];y=h[1].isTodo===0?n(".categories .content-li")[o-1]:n(".categories .content-li")[o-2];w();f.find(".calendar .bullet").css("background",h[o].backgroundColor);return}});var a=h.eventMaxTitleLength,c=f.find(".title input");if(c.length>0)c.on("keyup",function(){c.val().length>a&&c.val(c.val().substr(0,a))});c.trigger("focus").trigger("select");v=new AjaxUpload("#ical-browse-btn",{action:"upload.php",autoSubmit:!1,onChange:function(n,t){if(!(t&&(/^(ics)$/.test(t)||/^(txt)$/.test(t)))){f.find(".ical-file-selected").html(nt.dialog_incorrectFormat).css("color","#cc3300");return}this.isChanged=!0;f.find(".buttons .save-btn").removeClass("disable");f.find("#ical-browse-btn").hide();f.find(".ical-file-del").show();f.find(".ical-file-selected").show().html(n).css("color","grey")},onSubmit:function(){LoadingBanner.displayLoading()},onComplete:function(){LoadingBanner.hideLoading(!0);r.refetchEvents()}});f.find(".ical-file-del").on("click",function(){v.isChanged=!1;f.find(".buttons .save-btn").addClass("disable");f.find("#ical-browse-btn").show();f.find(".ical-file-del").hide();f.find(".ical-file-selected").hide().html("")})}function ei(t){n(document).on("keyup",wt);r.trigger("getiCalUrl",o,e.objectId,function(n){if(n.result){var t="<a href="+n.url+" target='_blank'>"+n.url+"<\/a>";c.find(".saved-url-link").html(t)}});c.width(f.width()+160);c.popupFrame("open",t)}function ii(){var n,u;clearInterval(pt);n=c.find(".url-link.caldav");u=c.find(".caldav-help");n.find(".control").removeClass("success").removeClass("failure").addClass("disabled").addClass("processing");n.find(".control input").prop("disabled",!0);n.show();u.show();var i=0,t=nt.dialogPreparingMessage,f=nt.dialogPreparingErrorMessage;pt=setInterval(function(){t=t+".";i==4&&(t=nt.dialogPreparingMessage,i=0);n.find(".control input").val(t);i++},500);r.trigger("getCaldavUrl",o,e.objectId,function(t){clearInterval(pt);t.result&&(t.url!=""?(n.find(".control input").val(t.url),n.find(".control input").prop("disabled",!1),n.find(".control").removeClass("disabled").removeClass("processing").addClass("success")):(n.find(".control input").val(f),n.find(".control").removeClass("processing").addClass("failure")))})}function oi(t){n(document).on("keyup",wt);r.trigger("getiCalUrl",o,e.objectId,function(n){if(n.result){var t=c.find(".url-link.ical");t.show();t.find(".control input").val(n.url);ii()}});c.width(f.width());c.popupFrame("open",t)}function b(i,h){var l,a;if(ut.close(),!i||!1!=ht.call(o,!0)){if(n(document).off("keyup",ui),f.popupFrame("close"),c.popupFrame("close"),l=y,a=e,s.isNewCalendar==1&&s.isExportLink==1&&s.isSyncWithCalendar==1){var v=r.options,w=v.categories,b=u.parseCssColor(u.randomHex(!0)),p=u.parseCssColor(u.randomHex(!1)),k=u.changeColorLightness(p.r,p.g,p.b,v.eventBg2BorderRatio);l=t;a={title:e.title,textColor:e.textColor,backgroundColor:e.backgroundColor,borderColor:e.borderColor,isHidden:!1,events:[],todos:[],permissions:{users:[]},defaultAlert:{type:0},timeZone:n.extend({},v.defaultTimeZone),iCalUrl:e.iCalUrl}}bt.call(o,"onClose",l,a,i,h)}}function ri(){n(document).off("keyup",wt);c.popupFrame("close");f.popupFrame("isVisible")&&f.popupFrame("show")}function ui(n){n.which==27&&b.call(o,!1)}function wt(n){n.which==27&&ri.call(o)}function ht(s){var v=r.options,c={title:p(vt),bgColor:p(ot),textColor:p(st),alert:f.find(".alert select"),timezone:f.find(".timezone select"),iCalUrl:f.find(".ical-url-input input"),calendar:f.find(".calendar select"),calendar_b:f.find(".calendar .bullet")},h,y,ut,b,k,d,w,nt,l,tt;if(s){if(a==at)return!0;if(!1==u.validateInput(c.title,u.validateNonemptyString)||(a==g||a==et||a==rt)&&!1==u.validateInputHttp(c.iCalUrl,u.validateNonemptyString))return!1;if((a==g||a==et||a==rt)&&(e.iCalUrl=c.iCalUrl.val()),a==rt&&(e.withoutSync=!0),a==et)return!0;for(e.title=c.title.val().trim(),e.title=e.title.substr(0,Math.min(r.options.eventMaxTitleLength,e.title.length)),y=u.parseCssColor(c.bgColor.css("background-color")),y&&(ut=u.changeColorLightness(y.r,y.g,y.b,r.options.eventBg2BorderRatio),e.backgroundColor=y.origColor,e.borderColor=ut.color),e.textColor=c.textColor.css("background-color"),e.defaultAlert.type=parseInt(c.alert.val(),10),e.timeZone.id=c.timezone.val(),h=0;h<v.timeZones.length;++h)if(v.timeZones[h].id==e.timeZone.id){e.timeZone.name=v.timeZones[h].name;e.timeZone.delta=v.timeZones[h].offset-e.timeZone.offset;e.timeZone.offset=v.timeZones[h].offset;break}e.permissions=it}else{for(c.title.val(e.title),c.title.css("color","").css("border-color",""),b=u.parseCssColor(e.backgroundColor),ni.call(o,b.origColor),b=u.parseCssColor(e.textColor),ti.call(o,b.origColor),c.alert.val(e.defaultAlert.type),w="",h=0;h<v.timeZones.length;++h)k=v.timeZones[h],d=i(k.name),w+='<option value="'+i(k.id)+'" title="'+d+'">'+d+"<\/option>";for(c.timezone.html(w),c.timezone.val(e.timeZone.id),f.find(".timezone").removeClass("hidden"),it=e.permissions,ft.render(it,ct,e.objectId),w='<option value="-1" title="'+i(r.options.newLabel)+'" >&nbsp;&nbsp;&nbsp;&nbsp;'+i(r.options.newLabel)+'<\/option><option disabled="disabled"><\/option>',l=r.getEventSources(),h=0;h<l.length;++h)l[h].objectId!=t&&(l[h].isEditable||!l[h].isSubscription)&&l[h].isTodo!=1&&(nt=i(l[h].title),w+='<option value="'+i(l[h].objectId)+'" title="'+nt+'">&nbsp;&nbsp;&nbsp;&nbsp;'+nt+"<\/option>");c.calendar.prop("disabled",!1);c.calendar.html(w);c.calendar_b.css("background","transparent");tt=0;n.each(r.getEventSources(),function(n,i){i.objectId==t||i.isSubscription||i.isTodo==1||++tt});tt>1&&!jq("#asc_event .event-editor .editor").is(":visible")?f.find(".buttons").removeClass("read-only"):f.find(".buttons").addClass("read-only")}return!0}var o=this,k={},pt;this.setEventsHandlers=function(i){i!=t&&n.extend(k,i)};var f,c,nt=r.options.icalStream,ft,d,y,e,it,lt=1,dt=2,g=3,et=4,rt=5,at=6,s={isSyncWithCalendar:0,isNewCalendar:0,isExportLink:0,isExportFile:0},a,vt=1,ot=11,st=12;(function(){f=n(r.options.categories.dialogTemplate).addClass("asc-dialog").addClass("fc-shadow").popupFrame({anchor:"left,bottom",direction:"right,down",showArrow:!1,showModal:!0,beforeClose:function(){return b.call(o,!1),!1}});w();f.find(".ical-export .ical-link").on("click",function(){ei.call(o,{pageX:"center",pageY:"center"})});f.find(".export .export-link").on("click",function(){oi.call(o,{pageX:"center",pageY:"center"});f.popupFrame("hide")});f.find(".buttons .save-btn").on("click",function(){jq(this).hasClass("disable")||b.call(o,!0)});f.find(".buttons .cancel-btn, .header .close-btn").on("click",function(){b.call(o,!1)});f.find(".buttons .delete-btn").on("click",function(){bt.call(o,"onDelete",e);b.call(o,!1,!0)});p(vt).on("keyup",function(){u.validateInput(this,u.validateNonemptyString);var n=jq(this).val();n.search(ASC.CalendarController.characterRegExp)!=-1&&(jq(this).val(ASC.CalendarController.ReplaceSpecCharacter(n)),ASC.CalendarController.displayInfoPanel(r.options.categories.dialogErrorMassageSpecCharacter.format(ASC.CalendarController.characterString),!0))});f.find(".ical-url-input input").on("keyup",function(){u.validateInputHttp(this,u.validateNonemptyString)});p(ot).on("click",function(){ut.open(this,ni,tt.DefaultPicker)});p(st).on("click",function(){ut.open(this,ti,tt.TextPicker)});ft=new kt(r,f.find(".shared-list"),r.options.sharedList.addLink);ft.setEventsHandlers({context:o,onResize:function(){f.popupFrame("updatePosition",d)},onChange:fi})})(),function(){c=n(nt.dialogTemplate).addClass("asc-dialog").addClass("add-popup").popupFrame({anchor:"right,top",direction:"right,down",offset:"0,0",showArrow:!1});c.find(".buttons .cancel-btn, .header .close-btn").on("click",function(){ri.call(o,!1)});c.find(".url-link .control input").on("click",function(){n(this).trigger("select")});c.find(".url-link .control .button.copy").on("click",function(){var t=n(n(this)[0].parentNode);if(!t.hasClass("disabled")){t.find("input").trigger("select");try{document.execCommand("copy");ASC.CalendarController.displayInfoPanel(r.options.categories.dialogCopyMessage,!1)}catch(i){}}});c.find(".url-link .control .button.try-again").on("click",function(){ii()})}();this.edit=function(t,i){s.isExportFile=0;s.isExportLink=0;s.isNewCalendar=0;s.isSyncWithCalendar=0;w();t!=y&&(b.call(o,!1),y=t,e=r.getEventSources()[n(y).data("sourceIndex")]);d=i;ht.call(o);l.call(o,dt);f.find(".choose_event_source").addClass("hidden");f.find(".sync-with-calendar").addClass("hidden");f.find(".calendar").addClass("hidden");f.find(".ical").addClass("hidden");f.find(".export").removeClass("hidden");f.find(".ical-import").removeClass("hidden");f.find(".title").removeClass("hidden");f.find(".row").removeClass("hidden");f.find(".shared-list").removeClass("hidden");f.find(".export").removeClass("hidden");f.find(".ical-url-input").addClass("hidden");yt.call(o,i)};this.addNew=function(i){s.isExportFile=0;s.isExportLink=0;s.isNewCalendar=0;s.isSyncWithCalendar=0;w();var c=r.options,a=c.categories,v=u.parseCssColor(u.randomHex(!0)),h=u.parseCssColor(u.randomHex(!1)),p=u.changeColorLightness(h.r,h.g,h.b,c.eventBg2BorderRatio);y=t;e={title:a.defaultTitle,textColor:v.origColor,backgroundColor:h.origColor,borderColor:p.color,isHidden:!1,events:[],todos:[],permissions:{users:[]},defaultAlert:{type:0},timeZone:n.extend({},c.defaultTimeZone)};d=i;ht.call(o);l.call(o,lt);f.find(".export").addClass("hidden");f.find(".row").removeClass("hidden");f.find(".shared-list").removeClass("hidden");f.find(".ical-url-input").addClass("hidden");yt.call(o,i)};this.addiCalCalendar=function(i){s.isExportLink=1;s.isExportFile=0;s.isNewCalendar=1;s.isSyncWithCalendar=0;w();var c=r.options,a=c.categories,v=u.parseCssColor(u.randomHex(!0)),h=u.parseCssColor(u.randomHex(!1)),p=u.changeColorLightness(h.r,h.g,h.b,c.eventBg2BorderRatio);y=t;e={title:a.defaultTitle,textColor:v.origColor,backgroundColor:h.origColor,borderColor:p.color,isHidden:!1,events:[],todos:[],permissions:{users:[]},defaultAlert:{type:0},timeZone:n.extend({},c.defaultTimeZone)};d=i;s.isSyncWithCalendar==0?l.call(o,rt,!0):l.call(o,g,!0);ht.call(o);f.find(".export").addClass("hidden");yt.call(o,i)};this.close=function(n){b.call(o,n)}}function lu(r){function nt(n){p&&typeof p[n]=="function"&&p[n].apply(p.context!=t?p.context:window,Array.prototype.slice.call(arguments,1))}function l(n){switch(n){case rt:return f.find(".title input");case d:return f.find(".color .inner");case g:return f.find(".color .inner-for-text")}return t}function et(n,t){for(var r=u.parseCssColor(n),i=(Math.round(r.r*.9)<<16|Math.round(r.g*.9)<<8|Math.round(r.b*.9)).toString(16);i.length<6;)i="0"+i;t.css("background-color",n).css("border-color","#"+i);t.parent().css("border-color","#"+i)}function ot(n){et(n,l(d));f.find(".title .bullet").css("background",n)}function st(n){et(n,l(g))}function yt(n){n.result&&(c=n.permissions,n.isShared!=t&&(e.isShared=n.isShared),w.render(c,ct,e.objectId),f.popupFrame("updatePosition",it))}function pt(i){var o,u,s;n(document).on("keyup",lt);if(o=h.eventMaxTitleLength,u=f.find(".title input"),u.length>0)u.on("keyup",function(){u.val().length>o&&u.val(u.val().substr(0,o))});e.isiCalStream?(f.find(".ical").addClass("hidden"),f.find(".buttons").find(".delete-btn").removeClass("hidden"),e.iCalUrl!=t&&e.iCalUrl!=""&&(f.find(".ical-saved-url").removeClass("hidden"),s="<a href="+e.iCalUrl+" target='_blank'>"+e.iCalUrl+"<\/a>",f.find(".saved-url-link").html(s))):(f.find(".ical").removeClass("hidden"),f.find(".export").removeClass("hidden"),f.find(".ical-saved-url").addClass("hidden"),f.find(".buttons").find(".delete-btn").addClass("hidden"),f.find(".saved-url-link").html(""));e.isEditable&&!e.isSubscription?f.find(".ical-import").removeClass("hidden"):f.find(".ical-import").addClass("hidden");f.popupFrame("open",i);f.find(".ical-file-selected").html(y.dialogButton_fileNotSelected);v=new AjaxUpload("#ical-browse-btn-subs",{action:"upload.php",autoSubmit:!1,onChange:function(n,t){if(!(t&&(/^(ics)$/.test(t)||/^(txt)$/.test(t)))){f.find(".ical-file-selected").html(y.dialog_incorrectFormat).css("color","#cc3300");return}this.isChanged=!0;f.find(".ical-file-selected").html(y.dialogButton_fileSelected).css("color","grey")},onSubmit:function(){LoadingBanner.displayLoading()},onComplete:function(){LoadingBanner.hideLoading();r.refetchEvents()}})}function wt(){var n;clearInterval(ft);n=s.find(".url-link.caldav");n.find(".control").removeClass("success").removeClass("failure").addClass("disabled").addClass("processing");n.find(".control input").prop("disabled",!0);n.show();var i=0,t=y.dialogPreparingMessage,u=y.dialogPreparingErrorMessage;ft=setInterval(function(){t=t+".";i==4&&(t=y.dialogPreparingMessage,i=0);n.find(".control input").val(t);i++},500);r.trigger("getCaldavUrl",o,e.objectId,function(t){clearInterval(ft);t.result&&(t.url!=""?(n.find(".control input").val(t.url),n.find(".control input").prop("disabled",!1),n.find(".control").removeClass("disabled").removeClass("processing").addClass("success")):(n.find(".control input").val(u),n.find(".control").removeClass("processing").addClass("failure")))})}function bt(t){n(document).on("keyup",at);r.trigger("getiCalUrl",o,e.objectId,function(n){if(n.result){var t=s.find(".url-link.ical");t.show();t.find(".control input").val(n.url);wt()}});s.width(f.width());s.popupFrame("open",t)}function a(t,i){(ut.close(),t&&!1==vt.call(o,!0))||(n(document).off("keyup",lt),f.popupFrame("close"),s.popupFrame("close"),nt.call(o,"onClose",k,e,t,i))}function ht(){n(document).off("keyup",at);s.popupFrame("close")}function lt(n){n.which==27&&a.call(o,!1)}function at(n){n.which==27&&ht.call(o)}function vt(n){var a=r.options,h={title:l(rt),bgColor:l(d),textColor:l(g),alert:f.find(".alert select"),timezone:f.find(".timezone select"),owner:f.find(".owner .name")},it=e.isEditable,ut=e.canAlertModify===t||e.canAlertModify,ft=e.canEditTimeZone,v,et,p,k,nt,tt,y,s;if(n){if(!1==u.validateInput(h.title,u.validateNonemptyString))return!1;if(e.title=h.title.val().trim(),e.title=e.title.substr(0,Math.min(r.options.eventMaxTitleLength,e.title.length)),v=u.parseCssColor(h.bgColor.css("background-color")),v&&(et=u.changeColorLightness(v.r,v.g,v.b,r.options.eventBg2BorderRatio),e.backgroundColor=v.origColor,e.borderColor=et.color),e.textColor=h.textColor.css("background-color"),ut&&(e.defaultAlert.type=parseInt(h.alert.val(),10)),ft)for(e.timeZone.id=h.timezone.val(),s=0;s<a.timeZones.length;++s)if(a.timeZones[s].id==e.timeZone.id){e.timeZone.name=a.timeZones[s].name;e.timeZone.delta=a.timeZones[s].offset-e.timeZone.offset;e.timeZone.offset=a.timeZones[s].offset;break}it&&(e.permissions=c)}else{if(h.title.val(e.title),h.title.css("color","").css("border-color",""),p=u.parseCssColor(e.backgroundColor),ot.call(o,p.origColor),p=u.parseCssColor(e.textColor),st.call(o,p.origColor),ut&&!e.isiCalStream?(h.alert.val(e.defaultAlert.type),f.find(".alert").removeClass("hidden")):(h.alert.val(b),f.find(".alert").addClass("hidden")),ft&&!e.isiCalStream){for(k="",s=0;s<a.timeZones.length;++s)nt=a.timeZones[s],tt=i(nt.name),k+='<option value="'+i(nt.id)+'" title="'+tt+'">'+tt+"<\/option>";h.timezone.html(k);h.timezone.val(e.timeZone.id);f.find(".timezone").removeClass("hidden");f.find(".timezone-read-only").addClass("hidden")}else f.find(".timezone").addClass("hidden"),f.find(".timezone-read-only").removeClass("hidden"),f.find(".timezone-desc").html(i(e.timeZone.name));if(e.objectId!=="shared_events"&&e.owner&&e.owner.name&&e.owner.name.length>0?(h.owner.html(i(e.owner.name)),f.find(".owner").removeClass("hidden")):(h.owner.html(""),f.find(".owner").addClass("hidden")),c=e.permissions||{},c.users=c.users||[],it)w.render(c,ct,e.objectId);else{for(f.find(".shared-list").removeClass("has-users").empty(),y="",s=0;s<c.users.length;s++)s>0&&(y+=", "),y+=c.users[s].name;y.length>0?(f.find(".shared-list").show(),f.find(".shared-list").addClass("has-users").append('<div class="users-list"><div class="label">'+i(r.options.sharedList.title)+'<\/div><div class="short-list">'+i(y)+"<\/div><\/div>")):f.find(".shared-list").hide()}}return!0}var o=this,p={},ft;this.setEventsHandlers=function(i){i!=t&&n.extend(p,i)};var f,w,s,y=r.options.icalStream,k,e,it,c,rt=1,d=11,g=12;(function(){f=n(r.options.categories.subscriptionsDialog).addClass("asc-dialog").addClass("fc-shadow").popupFrame({anchor:"left,bottom",direction:"right,down",showArrow:!1,showModal:!0,beforeClose:function(){return a.call(o,!1),!1}});f.find(".ical-export .ical-link").on("click",function(){bt.call(o,{pageX:"center",pageY:"center"});f.popupFrame("hide")});f.find(".buttons .save-btn").on("click",function(){jq(this).hasClass("disable")||a.call(o,!0)});f.find(".buttons .cancel-btn, .header .close-btn").on("click",function(){a.call(o,!1)});f.find(".buttons .unsubs-btn").on("click",function(){nt.call(o,"onUnsubscribe",e);a.call(o,!1)});f.find(".buttons .delete-btn").on("click",function(){nt.call(o,"onDelete",e);a.call(o,!1,!0)});l(rt).on("keyup",function(){u.validateInput(this,u.validateNonemptyString)});l(d).on("click",function(){ut.open(this,ot,tt.DefaultPicker)});l(g).on("click",function(){ut.open(this,st,tt.TextPicker)});w=new kt(r,f.find(".shared-list"),r.options.sharedList.addLink);w.setEventsHandlers({context:o,onResize:function(){f.popupFrame("updatePosition",it)},onChange:yt})})(),function(){s=n(y.dialogTemplate).addClass("asc-dialog").addClass("add-popup").popupFrame({anchor:"right,top",direction:"right,down",offset:"0,0",showArrow:!1});s.find(".buttons .cancel-btn, .header .close-btn").on("click",function(){ht.call(o,!1);s.popupFrame("close");f.popupFrame("isVisible")&&f.popupFrame("show")});s.find(".url-link .control input").on("click",function(){n(this).trigger("select")});s.find(".url-link .control .button.copy").on("click",function(){var t=n(n(this)[0].parentNode);t.find("input").trigger("select");try{document.execCommand("copy");ASC.CalendarController.displayInfoPanel(r.options.categories.dialogCopyMessage,!1)}catch(i){}})}();this.edit=function(t,i){t!=k&&(a.call(o,!1),k=t,e=r.getEventSources()[n(k).data("sourceIndex")]);it=i;vt.call(o);pt.call(o,i)};this.close=function(n){a.call(o,n)}}function au(r){function y(n){o&&typeof o[n]=="function"&&o[n].apply(o.context!=t?o.context:window,Array.prototype.slice.call(arguments,1))}function l(){u.find(".qsearch input").val(r.options.categories.subscriptionsManageDialog_qsearchText)}function c(){}function s(t){n(document).off("keyup",a);u.popupFrame("close");t&&v.call(f,!0);y.call(f,"onClose",t)}function a(n){n.which==27&&s.call(f,!1)}function v(o){var p={list:u.find("div.groups")},w,a,s,h,b,k,v,y;if(o)w=[],u.find("ul.groups li li input").each(function(){var t=n(this);w.push({action:t.is(":checked")?fu:wi,objectId:e[parseInt(t.val(),10)].objectId,isNew:!1})}),r.trigger("manageSubscriptions",f,w,function(n){n.result&&r.refetchEvents()});else{for(l(),p.list.empty(),p.list.append('<div class="scroll-area"><ul class="groups"><\/ul><\/div>'),a={},s=0;s<e.length;++s)h=e[s].group!=t&&e[s].group!=null?e[s].group:"Unknown",Array.isArray(a[h])||(a[h]=[]),a[h].push({subscription:e[s],index:s});b=p.list.find("ul.groups");for(h in a)if(a.hasOwnProperty(h)){for(k=n('<li><span class="group-bullet"><\/span><span>'+h+"<\/span><\/li>"),v=n("<ul><\/ul>"),a[h].sort(function(n,t){return n.subscription.title.toLowerCase()<t.subscription.title.toLowerCase()?-1:1}).sort(function(n,t){return n.subscription.isNew?-1:t.subscription.isNew?1:-1}),s=0;s<a[h].length;++s)y=a[h][s].subscription,n('<li><label><input type="checkbox" name="checkedSubscriptions" value="'+a[h][s].index+'"'+(y.isSubscribed?' checked="checked"':"")+"/> "+i(y.title)+"<\/label><\/li>").addClass(y.isNew?"new-item":"").appendTo(v);v.length>0&&k.append(v);b.append(k)}b.find(".group-bullet").on("click",function(){var t=n(this);t.hasClass("folded")?(t.removeClass("folded"),t.parent().children("ul").slideDown(c)):(t.addClass("folded"),t.parent().children("ul").slideUp(c))})}}var f=this,o={},u,h,e;this.setEventsHandlers=function(i){i!=t&&n.extend(o,i)},function(){u=n(r.options.categories.subscriptionsManageDialog).addClass("asc-dialog").addClass("fc-shadow").popupFrame({anchor:"left,bottom",direction:"right,down",showArrow:!1,showModal:!0,beforeClose:function(){return s.call(f,!1),!1}});u.find("#fc_subscr_save").on("click",function(){s.call(f,!0)});u.find("#fc_subscr_cancel, .header .close-btn").on("click",function(){s.call(f,!1)});var t=r.options.categories.subscriptionsManageDialog_qsearchText;u.find(".qsearch input").on("focus",function(){var i=n(this);i.val().toLowerCase()==t.toLowerCase()&&i.val("")}).on("blur",function(){var i=n(this);i.val()==""&&i.val(t)}).on("keyup",function(){var t=n(this).val().toLowerCase();t.length>2?(u.find("ul.groups li li").filter(function(){return n(this).text().toLowerCase().indexOf(t)==-1}).hide(),u.find("ul.groups li li").filter(function(){return n(this).text().toLowerCase().indexOf(t)!=-1}).show()):u.find(".groups li").show();c()});u.find(".qsearch .clean-btn").on("click",function(){l();u.find(".groups li").show()})}();this.open=function(t){h=t;r.trigger("loadSubscriptions",f,function(t){if(t.result&&Array.isArray(t.subscriptions)){e=t.subscriptions;u.popupFrame("open",h);v.call(f);n(document).on("keyup",a);u.popupFrame("updatePosition",h)}})};this.close=function(n){s.call(f,n)}}function vu(o){function wt(n,t){return new Date(n.getTime()+t*6e4)}function bt(n,i){for(var r=0;r<n.length;++r)n[r].allDay!==t&&n[r].allDay||(n[r].start=wt(n[r].start,i),n[r].end instanceof Date&&(n[r].end=wt(n[r].end,i)))}function ri(n){ASC.CalendarController.CancelEditDialog();w.edit(n,{pageX:"center",pageY:"center"})}function kt(t){o.trigger("editCalendar",s,n.extend({action:nu},t),function(n){n.result&&(o.removeEventSource(t),o.rerenderEvents(),it.call(s),jq("#asc_event").is(":visible")&&(jq("#asc_event").find(".editor .calendar select option[value="+t.objectId+"]").remove(),jq("#asc_event").find(".editor .calendar select").trigger("change")))})}function ui(r,u,f,e){f?r?o.trigger("editCalendar",s,n.extend({action:hi},u),function(n){n.result&&(fi(u,n),lt.call(s,r),ct.call(r),u.timeZone!==t&&bt(u.events,u.timeZone.delta),v.isChanged!=t&&(v._settings.action=n.importUrl,v.submit()),o.addEventSource(n.source),it.call(s,ht,!0),o.refetchEvents())}):o.trigger("editCalendar",s,n.extend({action:gr},u),function(n){n.result&&(v.isChanged!=t&&(v._settings.action=n.importUrl,v.submit()),o.addEventSource(n.source),it.call(s,pt,!0),it.call(s,ht,!0),o.refetchEvents(),jq("#asc_event").is(":visible")&&jq("#asc_event").find(".editor .calendar select").append(jq("<option><\/option>").attr("value",n.source.objectId).attr("title",n.source.title).html("&nbsp;&nbsp;&nbsp;&nbsp;"+i(n.source.title))))}):e||o.trigger("editCalendar",s,n.extend({action:ci},u),function(n){!n.result})}function fi(n,t){t.source.objectId===n.objectId&&(n.isShared=t.source.isShared)}function ei(n){ft.edit(n,{pageX:"center",pageY:"center"})}function oi(i,r,u,f){u?i&&o.trigger("editCalendar",s,n.extend({action:hi},r),function(n){n.result&&(lt.call(s,i),ct.call(i),r.timeZone!==t&&bt(r.events,r.timeZone.delta),v.isChanged!=t?(v._settings.action=n.importUrl,v.submit()):o.refetchEvents())}):f||o.trigger("editCalendar",s,n.extend({action:ci},r),function(n){n.result&&o.refetchEvents()})}function si(n){o.trigger("manageSubscriptions",s,[{action:wi,objectId:n.objectId,isNew:!1}],function(t){t.result&&o.removeEventSource(n)})}function li(){at.open({pageX:"center",pageY:"center"})}function dt(t,r){return n('<div class="content-li">'+u.makeBullet(!r.isHidden,r.backgroundColor,o.options.categories.inactiveColor,r.isSubscription?!1:r.isShared)+'<div class="label" style="'+(r.isHidden?"color:"+o.options.categories.inactiveColor:"")+'">'+i(r.title?r.title:"Unknown")+'<\/div><div class="edit-icon" title="'+i(o.options.categories.dialogHeader_edit)+'"><\/div><\/div>').data("sourceIndex",t)}function ct(){var r=n(this),t=r.find(".label");t.attr("title",t.text());return}function lt(t){var r=n(t),i=o.getEventSources()[r.data("sourceIndex")];u.updateBullet(r.find(".bullet"),!i.isHidden,i.backgroundColor,o.options.categories.inactiveColor,i.isSubscription?!1:i.isShared);r.find(".label").text(i.title)}function gt(t){var r=n(t),i=o.getEventSources()[r.data("sourceIndex")],u=i.isHidden;i.isHidden=!u;o.trigger("editCalendar",s,n.extend({action:tu},i),function(n){if(!n.result){i.isHidden=u;return}lt.call(s,r);o.rerenderEvents()})}function ni(t){var e=o.getEventSources(),f,r,i,u;for(t.find(".my_calendars").removeClass("active"),f=t.find(".categories"),f.empty(),r=0;r<e.length;++r)if((i=e[r],i.isTodo!=1)&&i.title&&!(i.title.length<1)&&!i.isSubscription){i.isHidden=i.isHidden==!0?!0:!1;u=dt.call(s,r,i);u.find(".bullet, .label").on("click",function(){gt.call(s,n(this).parent().get(0))});u.find(".edit-icon").on("click",function(){ri.call(s,n(this).parent().get(0))});u.appendTo(f)}}function ti(t){var e=o.getEventSources(),f,r,i,u;if(t.find(".subscr").length)for(t.find(".other_calendars").removeClass("active"),f=t.find(".subscr"),f.empty(),r=0;r<e.length;++r)if(i=e[r],i.title&&!(i.title.length<1)&&i.isSubscription){i.isHidden=i.isHidden==!0?!0:!1;u=dt.call(s,r,i);u.find(".bullet, .label").on("click",function(){gt.call(s,n(this).parent().get(0))});u.find(".edit-icon").on("click",function(){ei.call(s,n(this).parent().get(0))});u.appendTo(f)}}function ai(){var t=n("div.fc-catlist .content");if(t.length<1){t=n('<div class="content"><div class="content-h first my_calendars"><span class="main-label">'+i(o.options.categories.title)+'<\/span><\/div><div class="categories"><\/div>'+(o.options.isPersonal?"":'<div class="content-h other_calendars"><span class="main-label">'+i(o.options.categories.subscriptionsTitle)+'<\/span><span class="manage-label" title="'+i(o.options.categories.subscriptionsManageLabel)+'"><\/span><\/div><div class="subscr"><\/div><\/div>'));t.find(".manage-label").on("click",function(n){return n.preventDefault(),li.call(s),t.find(".content-h.other_calendars,.content-h.my_calendars").removeClass("active"),t.find(".subscr,.categories").removeClass("hidden"),p(!0),!1});t.find(".content-h.my_calendars").on("click",function(){n(this).toggleClass("active");t.find(".categories").toggleClass("hidden");p(!0)});t.find(".content-h.other_calendars").on("click",function(){n(this).toggleClass("active");var i=t.find(".categories").height();t.find(".subscr").toggleClass("hidden");p(!0,i)})}return ni.call(s,t),ti.call(s,t),t}function p(t,i){var o,d,nt;if(!(h.length<1)){var u=h.find(".categories"),f=h.find(".subscr"),tt=u.hasClass("hidden"),y=f.hasClass("hidden");h.find(".content-li").each(ct);h.css("visibility","hidden");h.removeClass("fixed");var e=u.find(".content-li"),c=f.find(".content-li"),l=e.eq(0).length?e.eq(0).outerHeight(!0):22,a=e.length*l,it=e.length>1?2*l:l,p=c.eq(0).length?c.eq(0).outerHeight(!0):22,v=c.length*p,rt=c.length>1?2*p:p;u.height(a);f.height(v);o=n("#calendarSidePanelCalendar").find(".fc-catlist-picker").removeClass("fixed");d=o.position().top+o.outerHeight(!0)>b.height();d&&(o.addClass("fixed"),h.addClass("fixed"),h.css("bottom",o.outerHeight(!0)+"px"));var ut=h.height(),ft=(h.find(".date-box").length?h.find(".date-box").outerHeight(!0):0)+(h.find(".content-h").length?h.find(".content-h").outerHeight(!0)*2:0),w=ut-ft,g=u.outerHeight(!0)-u.height(),et=f.outerHeight(!0)-f.height(),r=Math.max(it,Math.round(w*a/(a+v))||0),s=Math.max(rt,Math.round(w*v/(a+v))||0),k=r+s-w;k>0&&(r>s?r=r-k:s=s-k);r=y?e.length*(l+1):r;y&&i?(nt=i?i:r-g,u.css("height",nt+"px")):(r+h.find(".content-h").outerHeight(!0)>h.height()&&(r=h.height()-f.outerHeight(!0)-h.find(".content-h").outerHeight(!0)),u.css("height",r-g+"px"));f.css("height",s-et+"px");h.css("visibility","visible");tt&&(u.addClass("hidden"),h.find(".my_calendars").addClass("active"));y&&(f.addClass("hidden"),h.find(".other_calendars").addClass("active"))}}function it(n,i){(n==t||n==yt||n==pt)&&ni.call(s,h);(n==t||n==yt||n==ht)&&ti.call(s,h);p.call(s,i)}function vi(){function u(t){r.dpMonthMenu=n("#fc_datepicker_mmenu").length?n("#fc_datepicker_mmenu"):n("<div id='fc_datepicker_mmenu'><\/div>");y&&r.dpMonthMenu.css("z-index",2001);r.dpMonthMenu.popupMenu({anchor:t?"left,top":"right,bottom",direction:t?"right,up":"left,down",arrow:t?"down":"up",arrowPosition:"50%",showArrow:!1,cssClassName:"asc-popupmenu",items:o.options.monthNames,itemClick:function(t,i){c=y?n("#fc_common_dp .asc-datepicker").datepicker("getDate")!==null?n("#fc_common_dp .asc-datepicker").datepicker("getDate"):c:c;var r=y?i.itemIndex-c.getMonth():i.itemIndex-l.getMonth();f(r,"M")}})}function e(t,i){y&&r.dpYearMenu.css("z-index",2001);r.dpYearMenu.popupMenu({anchor:i?"left,top":"right,bottom",direction:i?"right,up":"left,down",arrow:i?"down":"up",arrowPosition:"50%",showArrow:!1,cssClassName:"asc-popupmenu",items:[(t+3).toString(),(t+2).toString(),(t+1).toString(),"divider",(t-1).toString(),(t-2).toString(),(t-3).toString()],itemClick:function(i,r){c=y?n("#fc_common_dp .asc-datepicker").datepicker("getDate")!==null?n("#fc_common_dp .asc-datepicker").datepicker("getDate"):c:c;var u=y?parseInt(r.item,10)-c.getFullYear():parseInt(r.item,10)-t;f(u,"Y")}})}function f(t,i){if(t!=0)if(y){if(i==="M")c=g(c,t);else if(i==="Y")c=st(c,t);else return;n("#fc_common_dp .asc-datepicker").datepicker("setDate",c)}else{if(i==="M")l=g(l,t);else if(i==="Y")l=st(l,t);else return;nt=!0;n.datepicker._adjustDate("#fc_datepicker",t,i);nt=!1;rt.call(s,l)}}var t=n('<div class="fc-catlist-picker"><div><div id="fc_datepicker" class="asc-datepicker"><\/div><div class="hide"><span>'+i(o.options.categories.datepickerHideLabel)+"<\/span><\/div><\/div><\/div>");t.find(".hide span").on("click",function(){ii.call(s,!d)});a=t.find("#fc_datepicker").datepicker({firstDay:o.options.firstDay,onChangeMonthYear:function(n,t){nt!=!0&&(l=new Date(n,t-1,1),setTimeout(function(){rt(l)},0))},onSelect:function(){var n=!1;jq("#asc_event .event-editor .editor").is(":visible")?confirm(ASC.Resources.Master.ResourceJS.WarningMessageBeforeUnload)&&(window.toastr.remove(),jq("#asc_event").hide(),jq("#asc_calendar").show(),o.updateSize(),n=!0):(window.toastr.remove(),jq("#asc_event").hide(),jq("#asc_calendar").show(),o.updateSize(),n=!0);n&&(et=!0,l=a.datepicker("getDate"),o.gotoDate(l),o.changeViewAndMode("day"),et=!1,setTimeout(rt,0))}});u(!0);n(document).on("click","#fc_datepicker .ui-datepicker-title , #fc_common_dp .ui-datepicker-title",function(t){var i=n(t.target).offset().top>r.dpMonthMenu.outerHeight(!0)+10,f;if(y=n("div").is("#fc_common_dp")&&n("#fc_common_dp").is(":visible"),t.target.className=="ui-datepicker-month"){u(i);r.hideMenus(r.dpMonthMenu);r.dpMonthMenu.popupMenu("open",t.target);return}if(t.target.className=="ui-datepicker-year"){ot&&ot==t.target||(ot=t.target,c=y?n("#fc_common_dp .asc-datepicker").datepicker("getDate")!==null?n("#fc_common_dp .asc-datepicker").datepicker("getDate"):c:c,f=y?c.getFullYear():l.getFullYear(),!r.dpYearMenu||r.dpYearMenu.length<1?r.dpYearMenu=n("#fc_datepicker_ymenu").length?n("#fc_datepicker_ymenu"):n("<div id='fc_datepicker_ymenu'><\/div>"):(r.dpYearMenu.popupMenu("close"),r.dpYearMenu.popupMenu("destroy")),e(f,i));r.hideMenus(r.dpYearMenu);r.dpYearMenu.popupMenu("open",t.target);return}});return t}function ii(t){var r,i,u;yi.call(s);n.cookie("fc_show_minicalendar",t?"1":"0",{expires:365});r=n("#calendarSidePanelCalendar .fc-catlist-picker");i=r.find(".hide span");t==!1?d&&(a.hide(),i.text(o.options.categories.datepickerShowLabel),d=!1):d||(a.show(),i.text(o.options.categories.datepickerHideLabel),d=!0);u=n("#calendarSidePanelCalendar .fc-catlist-picker").outerHeight(!0);h.css("bottom",u+"px");p.call(s)}function yi(){if(ut===t&&(ut=(new Date).getTime()),tt=tt?tt+1:1,tt>=6){if((new Date).getTime()-ut<=5e3){var r="ver_"+(new Date).getTime();n('<div class="fc-label-tooltip" style="padding:2em;" id="'+r+'">'+i("FullCalendar v"+n.fullCalendar.version)+"<\/div>").appendTo("body").offset(o.getView().getViewRect());setTimeout(function(){n("#"+r).remove()},3e3)}ut=t;tt=0}}function rt(t){a.find(".ui-datepicker-prev .ui-icon").removeClass("ui-icon-circle-triangle-w").addClass("ui-icon-carat-1-w");a.find(".ui-datepicker-next .ui-icon").removeClass("ui-icon-circle-triangle-e").addClass("ui-icon-carat-1-e");var u=t instanceof Date?t:o.getDate(),i=new Date(u.getFullYear(),u.getMonth(),1),r=i.getDay()-o.options.firstDay;e(i,-(r>=0?r:r+7));var h=o.clientEvents(),c=new Date(i.getFullYear(),i.getMonth()-1,1),l=new Date(i.getFullYear(),i.getMonth()+2,1);o.trigger("getMonthEvents",s,n.extend({startDate:c,endDate:l}),function(t){if(t.result){var u=t.days;a.find(".ui-datepicker-calendar tbody td").each(function(t,f){for(var o,s,h=n(f),e=0;e<u.length;++e)if(o=k(new Date(u[e].getFullYear(),u[e].getMonth(),u[e].getDate()+r)).toString(),s=k(new Date(i.getFullYear(),i.getMonth(),i.getDate()+t+r)).toString(),o===s){h.addClass("has-events");return}})}});a.find(".ui-datepicker-calendar tbody td").each(function(t,r){for(var a=n(r),s=e(f(i),t),o=0;o<h.length;++o){var u=h[o],c=k(f(u.start)),l=k(f(u.end||u.start));if(c<=s&&s<=l&&(!u.source||!u.source.isHidden))return}})}function pi(){var n=b.find(".fc-catlist-picker").outerHeight(!0);n!=vt&&(p.call(s),vt=n)}var s=this,b,h,w,ft,at,a,l,c=new Date,y=!1,d=!0,et=!1,nt=!1,ot,vt=0,ut,tt,yt=0,pt=1,ht=2,bi=o.formatDate,ki=o.formatDates;this.render=function(){return h=ai.call(s),b=n('<div class="fc-catlist asc-dialog"><div class="fc-modal"><\/div><\/div>').append(h),n("#calendarSidePanelCalendar").append(vi.call(s)),w=new cu(o),w.setEventsHandlers({context:s,onClose:ui,onDelete:kt}),ft=new lu(o),ft.setEventsHandlers({context:s,onClose:oi,onUnsubscribe:si,onDelete:kt}),at=new au(o),b};this.rerenderList=function(){it.call(s)};this.resize=function(n){b.css("height",n+"px");p.call(s)};this.updateDatepicker=function(n){a.length<1||et||(nt=!0,l=n,a.datepicker("setDate",n),nt=!1,rt.call(s))};this.updateDatepickerSize=function(){pi.call(s)};this.updateDatepickerCells=function(){rt.call(s)};this.showMiniCalendar=function(n){ii.call(s,n)};this.addNewCalendar=function(n){w.addNew(n)};this.addiCalCalendar=function(n){w.addiCalCalendar(n)}}function yu(f){function ui(n,t){var f=n.val(),e=f.search(/\S/)<0,i,o,r;return e?(r=-1,i=null,o=null):(i=u.validateDateString(f),r=i===null?0:1),t.date={isEmpty:e,isValid:i!==null,value:i},r}function ft(r,l){var p={title:h.find("#fc_todo_title"),start_d:h.find("#fc_todo_start_date"),start_t:h.find("#fc_todo_start_time"),completed:h.find("#fc_todo_completed"),priority:h.find("#fc_todo_priority"),cal:h.find("#fc_todo_cal"),description:h.find("#fc_todo_description"),ok:h.find("#fc_todo_ok")},d={title:o.find(".title")[0],start_d:o.find(".date-time .date")[0],description:o.find(".description .text")[0],mark_btn:o.find(".buttons .mark-btn")[0]},ot=n(c),b=f.getEventSources(),g=b[ot.data("sourceIndex")],tt,a=g.todos[ot.data("todoId")],it,st,ut,w,ft,et,ht;if(r){if((a.title=p.title.val().trim(),!1==u.validateInput(p.title,u.validateNonemptyString))||(a.completed=p.completed.is(":checked"),a.description=p.description.val().trim(),a.priority=p.priority.val(),a.completed=p.completed==!0?!0:!1,it={},st=ti(it),!st&&!it.data.date.isEmpty))return!1;if(a.start=s(it.data.date.value+"T23:59:59"),ut=p.cal.val(),ut!=g.title)for(w=0;w<b.length;++w)if(b[w].title==ut){tt=b[w];tt.todos=tt.todos||[];tt.todos.push(a);g.todos=n.grep(g.todos,function(n){return n!=a});break}nt(a);c=t;v.call(e);rt.call(e)}else{for(p.title.val(Encoder.htmlDecode(a.title.trim())),p.title.css("color","").css("border-color",""),p.start_d.css("color","").css("border-color",""),p.start_t.css("color","").css("border-color",""),h.find(".header .title").text(a.objectId?window.g_fcOptions.todoEditor.dialogHeader_edit:window.g_fcOptions.todoEditor.dialogHeader_add),a.completed==!0?p.completed.prop("checked",!0):p.completed.prop("checked",!1),ft=new Date(1,0,1),a.start instanceof Date&&!(a.start.getFullYear()<=ft.getFullYear())?(p.start_d.val(y(a.start,f.options.eventEditor.dateFormat)),p.start_t.val(y(a.start,f.options.eventEditor.timeFormat))):(p.start_d.val(k!=null?y(k,f.options.eventEditor.dateFormat):""),p.start_t.val(k!=null?"00:00":""),k=null),p.priority.val(a.priority!=t?a.priority:"2"),et="",w=0;w<b.length;++w)ht=b[w],et+="<option>"+i(ht.title)+"<\/option>";p.cal.html(et);p.cal.val(g.title);p.description.val(a.description!=t?a.description:"");l!=t&&(d.mark_btn.innerText=a.completed?f.options.todoViewer.dialogButton_mark_off:f.options.todoViewer.dialogButton_mark_on,d.title.innerText=a.title,d.description.innerText=a.description!=t?a.description:"",a.start instanceof Date&&!(ft.getTime()==a.start.getTime())?d.start_d.innerText=y(a.start,f.options.eventEditor.dateFormat):(d.start_d.innerText=k!=null?y(k,f.options.eventEditor.dateFormat):"",k=null));pt=a}}function nt(t,i){var u=iu,r;t.objectId&&(u=ru);r=!1;f.trigger("editTodo",e,n.extend({action:u},t),function(n){var o,s,u,t,e;if(n.result){for(o=f.getEventSources(),s=f.getCache(),u=0;u<o.length;++u)if(t=o[u],n.todo.length>0&&t.todos&&t.objectId==n.todo[0].sourceId){for(n.todo[0].completed=new Date(n.todo[0].completed).getTime()==ri?!1:!0,n.todo[0].start=ASC.Api.TypeConverter.ServerTimeToClient(n.todo[0].start),n.todo[0].source=t,e=0;e<s.length;e++)s[e].objectId==n.todo[0].objectId&&(f.fetchEvents(f.getView().visStart,f.getView().visEnd,i),r=!0);r||(t.todos=t.todos.concat(n.todo[0]))}!r&&n.todo[0]&&f.fetchEvents(f.getView().visStart,f.getView().visEnd,i)}})}function wt(t){var i=n(n(t)[0].parentNode),r=i.data("date")==null?new Date(1,0,1,23,59,59).getTime():i.data("date");b[r]=!b[r];i.toggleClass("close")}function fi(){var n=f.getView().getViewRect(),t=u.getElementRect(tt),h=o.outerWidth(!0),i=o.outerHeight(!0),e,l,r,a,s,c;t.right+h<=n.right-250||t.left-h<n.left?(o.popupFrame("option","anchor","right,top"),o.popupFrame("option","direction","right,down"),o.popupFrame("option","arrow","left"),o.popupFrame("option","offset","-4px,0"),o.popupFrame("updatePosition",tt),h=o.outerWidth(!0),e=t.right+h-n.right,e=e<0?-4:-e,o.popupFrame("option","offset",e+"px,0")):(o.popupFrame("option","anchor","left,top"),o.popupFrame("option","direction","left,down"),o.popupFrame("option","arrow","right"),o.popupFrame("option","offset","2px,0"));o.popupFrame("updatePosition",tt);l=!1;(t.top<n.top||t.bottom>n.bottom)&&(t=u.getElementRect(tt),t.top<n.top&&(l=!0,r=o.popupFrame("option","offset").match(/^([+-]?\d+(\.\d+)?)(px)?,([+-]?\d+(\.\d+)?)(px)?/i),a=r[1]+(r[3]?r[3]:"")+","+(n.top-t.top+parseInt(r[4],10))+(r[6]?r[6]:""),o.popupFrame("option","offset",a)));s=(Math.max(t.top,n.top)+Math.min(t.bottom,n.bottom)-i)*.5;c=50;l||(s<n.top?c=Math.round((i*.5-n.top+s)*100/i):s+i>n.bottom&&(c=Math.round((i*.5+s+i-n.bottom)*100/i)));o.popupFrame("option","arrowPosition",c+"%")}function ei(n,t){a.addClass("modal");p.show();o.popupFrame("option","showArrow",!0);tt=t;fi.call(e);o.popupFrame("close");o.popupFrame("open",t);p.addClass("fc-modal-transparent");n!=c&&(h.popupFrame("close"),c=n,ft.call(e,!1,!0))}function et(n){n!=c&&(h.popupFrame("close"),c=n,ft.call(e));a.addClass("modal");p.show();h.popupFrame("open",{pageX:"center",pageY:"center"},n);h.find("#fc_todo_title").trigger("focus")}function bt(){for(var n,i=f.getEventSources(),t=0;t<i.length;++t)n=i[t],n.todos&&n.todos.length>0&&(n.todos=n.todos.filter(function(n){return!!n.objectId}));v.call(e)}function ot(){g.popupFrame("close");p.hide();c=null}function rt(){h.popupFrame("close");p.hide();a.removeClass("modal");bt();f.openEventWin=null}function st(){o.popupFrame("close");p.hide();p.removeClass("fc-modal-transparent");a.removeClass("modal");f.openEventWin=null}function oi(n){for(var t,i,s,e=[],u={},o=n?n:f.getEventSources(),r=0;r<o.length;++r)if(t=o[r],t.todos&&t.todos.length>0)for(i=0;i<t.todos.length;++i)t.todos[i].source=t,t.todos[i].sourceIndex=r,t.todos[i].id=i,u[t.todos[i].objectId]=t.todos[i];for(s in u)e.push(u[s]);return e}function kt(n){a.addClass("modal");p.show();c=n;g.popupFrame("open",{pageX:"center",pageY:"center"})}function v(r){var w=a.find(".content .items"),nt,l;w.empty();var ft=oi.call(e),d=ft.sort(function(n,t){return n.start-t.start}),rt=new Date(1,0,2,23,59,59),tt=new Date,g=new Date(tt.getFullYear(),tt.getMonth(),tt.getDate(),23,59,59).valueOf(),ut,u=null,it=0;for(nt=0;nt<d.length;nt++){var o=d[nt],h=o.start?new Date(o.start.getFullYear(),o.start.getMonth(),o.start.getDate(),23,59,59).valueOf():rt.valueOf(),s="",y="",p=o.start?dt(o.start).split(" "):"";if(it++,it==d.length&&u!=null&&u.appendTo(w),!o.completed||!f.hideCompletedTodos){l=n('<div class="content-li"><label><input type="checkbox"'+(o.completed?'checked="checked"':"")+' class="bullet"/><span><\/span><\/label><span class="label">'+i(o.title?o.title:"Unknown")+'<\/span> <span class="description">'+i(o.description?o.description:"")+'<\/span><div class="edit-todo-button" title="'+i(f.options.todoEditor.dialogHeader_edit)+'">'+f.options.todoList.editIcon+'<\/div><div class="del-todo-button" title="'+i(f.options.deleteTodoDialog.dialogHeader)+'">'+f.options.todoList.deleteIcon+"<\/div><\/div>");l.find(".bullet").on("change",function(){ii.call(e,n(n(this).parent()).parent())});l.find(".label").on("click",lt);l.find(".edit-todo-button").on("click",function(){et.call(e,n(this).parent())});l.find(".del-todo-button").on("click",function(){kt.call(e,n(this).parent())});l.find(".description").on("click",function(){et.call(e,n(this).parent())});if(o.completed&&l.addClass("completed"),l.data({sourceIndex:o.sourceIndex,todoId:o.id}),ut==h)l.appendTo(u);else{if(h<=rt.valueOf())s="no_due_date",y=i(f.options.todoList.noDueDate);else if(h<g-864e5||h<g)if(u!=null&&u.hasClass("overdue")){l.appendTo(u);continue}else s="overdue",y=i(f.options.todoList.overdue);else h==g?(s="today",y=p.length>0?p[p.length-1]:""):864e5+g==h?(s="tomorrow",y=p.length>0?p[p.length-1]:""):(s="future",y=dt(o.start));u==null?(u=n('<div class="todo-container '+s+'"><span class="title">'+y+'<\/span><span class="add-todo"><\/span><\/div>'),u.data({date:s=="no_due_date"?0:s=="overdue"?-1:h}),u.appendTo(w)):(u.appendTo(w),u=n('<div class="todo-container '+s+'"><span class="title">'+y+'<\/span><span class="add-todo"><\/span><\/div>'),u.data({date:s=="no_due_date"?0:s=="overdue"?-1:h}));s=="no_due_date"&&b["0"]!=t?u.addClass(b["0"]?"close":""):s=="overdue"&&b["-1"]!=t?u.addClass(b["-1"]?"close":""):b[h]!=t&&u.addClass(b[h]?"close":"");b[h]=u.hasClass("close");u.find(".title").on("click",function(){wt(this)});u.find(".add-todo").on("click",function(){var r=n(n(this).parent()[0]).data("date"),f,u,i,o;if(k=r!=null&&r!=0&&r!=-1?new Date(r):null,f=vt.call(e,k),f){for(c=t,v.call(e),u=a.find(".todo-container"),i=0;i<u.length;i++)n(u[i]).data("date")==r&&n(u[i]).hasClass("close")&&wt(n(u[i]).find(".title"));o=yt.call(e,f.sourceIndex,f.todoId);o.find(".label").val("");o.find(".label").trigger("click")}});l.appendTo(u)}ut=h;it==d.length&&u.appendTo(w)}}r!=t&&typeof r=="object"&&r.resolve&&hi(r)}function li(){!r.todoMenu||r.todoMenu.length<1?r.todoMenu=n(f.options.todoList.menuTemplate):(r.todoMenu.popupMenu("close"),r.todoMenu.popupMenu("destroy"));r.todoMenu.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,cssClassName:"asc-popupmenu",closeTimeout:-1});r.todoMenu.find("#todo-in-cal-check").prop("checked",localStorageManager.getItem("showTodosInCalendar"));r.todoMenu.find("#todo-in-cal-check").on("change",function(){wi.call(e)});r.todoMenu.find("#del-mark-td-check").prop("checked",localStorageManager.getItem("hideCompletedTodos"));r.todoMenu.find("#del-mark-td-check").on("change",function(){bi.call(e)});r.todoMenu.find("#sync-lnk").on("click",function(){vi.call(e,{pageX:"center",pageY:"center"})})}function ai(){for(var t=f.getEventSources(),n=0;n<t.length;n++)if(t[n].isTodo==1)return t[n];return null}function gt(){w.popupFrame("close");p.hide()}function ni(){var r=ai(),n=w.find(".url-link.caldav"),i,t;n.show();n.find(".control").removeClass("success").removeClass("failure").addClass("disabled").addClass("processing");n.find(".control input").prop("disabled",!0);i=0;t=it.dialogPreparingMessage;at=setInterval(function(){t=t+".";i==4&&(t=it.dialogPreparingMessage,i=0);n.find(".control input").val(t);i++},500);f.trigger("getCaldavUrl",e,r!=null?r.objectId:"todo_calendar",function(t){if(clearInterval(at),t.result){var i=it.dialogPreparingErrorMessage;t.url!=""&&n?(n.find(".control input").val(t.url),n.find(".control input").prop("disabled",!1),n.find(".control").removeClass("disabled").removeClass("processing").addClass("success")):(n.find(".control input").val(i),n.find(".control").removeClass("processing").addClass("failure"))}})}function vi(n){w.find(".url-link .control .button.try-again").on("click",function(){clearInterval(at);ni()});ni();p.show();w.width(372);w.popupFrame("open",n)}function yi(){!r.sortMenu||r.sortMenu.length<1?r.sortMenu=n("<div id='fc_todo_sort_menu'><\/div>"):(r.sortMenu.popupMenu("close"),r.sortMenu.popupMenu("destroy"));r.sortMenu.popupMenu({anchor:"right,top",direction:"left,up",arrow:"down",cssClassName:"asc-popupmenu",items:[{label:f.options.todoList.sortByCalendarLabel,click:function(){ht=0;ut.text(f.options.todoList.sortByCalendarLabel);v.call(e)}},{label:f.options.todoList.sortByPriorityLabel,click:function(){ht=1;ut.text(f.options.todoList.sortByPriorityLabel);v.call(e)}},{label:f.options.todoList.sortAlphabeticallyLabel,click:function(){ht=2;ut.text(f.options.todoList.sortAlphabeticallyLabel);v.call(e)}}]})}function ti(n){var f={date:h.find(".date")},i={},e=ui(f.date,i),r,u;return i.dateTime=e==1?s(i.date.value+"T23:59:59"):null,e==1?(u=!0,r=""):(u=!1,r=i.date.isValid?"":"#cc3300"),f.date.css("color","").css("border-color",r),n!=t&&(n.data=i),u}function pi(){function i(n,t,i){var r=d(n.val());t.datepicker("setDate",r instanceof Date?r:i)}function r(n,t){n.val(y(t.datepicker("getDate"),f.options.eventEditor.dateFormat));n.trigger("change")}function s(n){var i,t,r;return n.selectionStart?n.selectionStart:document.selection?(n.focus(),i=document.selection.createRange(),i==null)?0:(t=n.createTextRange(),r=t.duplicate(),t.moveToBookmark(i.getBookmark()),r.setEndPoint("EndToStart",t),r.text.length):0}h=n(f.options.todoEditor.dialogTemplate).addClass("asc-dialog").addClass("fc-shadow").popupFrame({anchor:"left,bottom",direction:"right,down",showArrow:!1,showModal:!0});o=n(f.options.todoViewer.dialogTemplate).addClass("asc-dialog").addClass("fc-shadow").popupFrame({anchor:"right,top",direction:"right,down",offset:"-2px,0",arrow:"left",arrowPosition:"50%",showArrow:!1});g=n(f.options.deleteTodoDialog.dialogTemplate).addClass("asc-dialog").addClass("fc-shadow").popupFrame({anchor:"left,bottom",direction:"right,down",showArrow:!1,showModal:!0});var t=h.find(".date");h.find(".cal-icon").on("click",function(){l.open(f,this,function(n){i(t,n,null)},function(n,i){this.close();r(t,i)})});h.on("keypress",function(n){var t;if((event.keyCode==10||event.keyCode==13)&&event.ctrlKey){if(t=h.find("#fc_todo_description"),t.is(":focus")){var i=s(document.getElementById("fc_todo_description")),r=t.val(),u=r.substr(0,i),f=r.substr(i);t.val(u+"\n"+f);document.getElementById("fc_todo_description").setSelectionRange(i+1,i+1)}}else n.which==13&&ft.call(e,!0)});h.find(".time").mask("00:00");h.find(".time, .date").on("keyup change",function(t){n(this).val()?ti(t):n(this).css("border-color","")});h.find("#fc_todo_title").on("keyup",function(){u.validateInput(this,u.validateNonemptyString)});h.find("#fc_todo_ok").on("click",function(){ft.call(e,!0)});h.find(".close-btn").on("click",function(){rt.call(e)});h.find("#fc_todo_cancel").on("click",function(){rt.call(e)});g.find(".save-btn").on("click",function(){ki.call(e,c)});g.find(".close-btn").on("click",function(){ot.call(e)});g.find(".cancel-btn").on("click",function(){ot.call(e)});o.find(".mark-btn").on("click",function(){ii.call(e,c);st.call(e)});o.find(".edit-btn").on("click",function(){st.call(e);et.call(e,c)});o.find(".delete-btn").on("click",function(){st.call(e);kt.call(e,c)})}function vt(n){var t=f.getEventSources(),i;return t.length<1?null:(i={title:" ",completed:!1,start:n?n:null},t[0].todos.push(i),{sourceIndex:0,todoId:t[0].todos.length-1})}function yt(t,i){var r=a.find(".content .items .content-li").filter(function(){var r=n(this);return r.data("sourceIndex")==t&&r.data("todoId")==i});return r.length>0?r:null}function wi(){f.showTodosInCalendar=!f.showTodosInCalendar;localStorageManager.setItem("showTodosInCalendar",f.showTodosInCalendar);f.fetchEvents(f.getView().visStart,f.getView().visEnd)}function bi(){f.hideCompletedTodos=!f.hideCompletedTodos;localStorageManager.setItem("hideCompletedTodos",f.hideCompletedTodos);v.call(e);f.fetchEvents(f.getView().visStart,f.getView().visEnd)}function ii(i){var r=n(i),o=f.getEventSources()[r.data("sourceIndex")],u=o.todos[r.data("todoId")];u.completed=!u.completed;var e=n(i),s=f.getEventSources(),h=s[e.data("sourceIndex")],l=h.todos[r.data("todoId")];nt(l);c=t;u.completed?e.addClass("completed"):e.removeClass("completed")}function ki(t){var u=n(t),i=f.getEventSources(),r=i[u.data("sourceIndex")].todos[u.data("todoId")];f.trigger("editTodo",e,n.extend({action:uu},r),function(n){var u,t,o;if(n.result){for(u=f.getCache(),t=0;t<i.length;++t)i[t].todos&&i[t].todos.length>0&&(i[t].todos=i[t].todos.filter(function(n){return n.objectId!=r.objectId}));for(o=0;o<u.length;++o)if(u[o].objectId==r.objectId){u.splice(o,1);break}f.reportEvents(u);v.call(e);ot.call(e)}})}var e=this,a,b={},h,o,tt,c,pt,ht=0,ut,p,k=null,g,w,ri=-621355968e5,it=f.options.icalStream,at;(function(){w=n(it.dialogTemplate).addClass("asc-dialog").addClass("add-popup").popupFrame({anchor:"right,top",direction:"right,down",offset:"0,0",showArrow:!1});w.find(".buttons .cancel-btn, .header .close-btn").on("click",function(){gt.call(e)});w.find(".ical-description span")[0].innerHTML=it.dialogTodoDescription;w.find(".url-link .control input").on("click",function(){n(this).trigger("select")});w.find(".url-link .control .button.copy").on("click",function(){var t=n(n(this)[0].parentNode);t.find("input").trigger("select");try{document.execCommand("copy");ASC.CalendarController.displayInfoPanel(f.options.categories.dialogCopyMessage,!1)}catch(i){}})})();var si=function(n,t,i,r){var u="",o=[],s=!1,f=n.getHours(),c=f<12,h="",l="",e,a;for(i=i||["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=r||["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],t.search(/%p|%P/)!==-1&&(f>12?f=f-12:f==0&&(f=12)),window.moment?(h=window.moment(n).calendar(null,{lastWeek:"dddd DD.MM.YYYY",sameElse:"dddd DD.MM.YYYY",nextWeek:"dddd DD.MM.YYYY"}).split(" ")[0],l=window.moment(n).calendar(null,{sameDay:"D MMMM",nextDay:"D MMMM",nextWeek:"D MMMM",lastDay:"D MMMM",lastWeek:"D MMMM",sameElse:"D MMMM"}).split(" ")[1]):h=r[n.getDay()],e=0,a=t.length;e<a;++e)if(u=t.charAt(e),s){switch(u){case"h":u=""+f;break;case"H":u=ct(f);break;case"M":u=ct(n.getMinutes());break;case"S":u=ct(n.getSeconds());break;case"d":u=""+n.getDate();break;case"m":u=""+(n.getMonth()+1);break;case"y":u=""+n.getFullYear();break;case"b":u=""+window.moment?l:i[n.getMonth()];break;case"p":u=c?"am":"pm";break;case"P":u=c?"AM":"PM";break;case"D":u=""+h}o.push(u);s=!1}else u=="%"?s=!0:o.push(u);return o.join("")},dt=function(n){var t=si(n,"%d %b, %D",ASC.Resources.Master.MonthNamesFull,ASC.Resources.Master.DayNamesFull);return t!==""?t:n.toLocaleTimeString()},ct=function(n){return n=""+n,n.length===1?"0"+n:n},hi=function(n){var t=n.containerDate;ci(t)},ci=function(n){var u=Date.parse(n)!=0?n:null,i=vt.call(e,u),r;i&&(c=t,v.call(e),r=yt.call(e,i.sourceIndex,i.todoId),r.find(".label").val(""),r.find(".label").trigger("click"))},lt=function(){var r=n(n(this).parent()),h=f.getEventSources(),l=h[r.data("sourceIndex")],e=l.todos[r.data("todoId")],i=n(this),a=i.text(),o=n('<input type="text" class="editable-label-text" maxlength="150" value="'+a+'" />'),s=n(n(r).parent()[0]),v=s.data("date")!=null?new Date(s.data("date")):null;r.addClass("edit");i.replaceWith(o);o.trigger("focus");o.on("blur",function(){var s=n(this).val();if(!1!=u.validateInput(n(this),u.validateNonemptyString)){i.text(s);e.title=s;nt(e);r.removeClass("edit");o.replaceWith(i);i.on("click",lt);bt()}else e.objectId==t&&(f.cleanEmptyEventSources(),r.detach())}).on("keydown",function(s){if(s.keyCode==13){var h=n(this).val();if(!1!=u.validateInput(n(this),u.validateNonemptyString)){i.text(h);e.title=h;nt(e,{resolve:!0,containerDate:v});i.on("click",lt);o.replaceWith(i);r.removeClass("edit");c=t}else e.objectId==t&&(f.cleanEmptyEventSources(),o.trigger("blur"))}})};this.render=function(){var t=n("<div><div class='fc-todo-list'><div class='content'><div class='content-h'><span class='label'>"+i(f.options.todoList.title)+"<\/span><span class='fc-settings' title='"+i(f.options.categories.subscriptionsManageLabel)+"'>"+f.options.todoList.settingsIcon+"<\/span><div class='close-btn' title='"+i(f.options.categories.dialogButton_cancel)+"'>&times;<\/div><\/div><div class='items'><\/div><span class='add-btn'>"+i(f.options.todoList.addTodoLabel)+"<span class='add-todo'><\/span><\/span><\/div><div class='fc-modal'><\/div><\/div><\/div>");a=t.find(".fc-todo-list");ut=t.find(".sort-label .label");t.find(".add-btn").on("click",function(){e.addNewTodo()});t.find(".content-h .close-btn").on("click",function(){var t=n("#fc_container");t.toggleClass("open-todo-list");t.find(".fc-button-todo").toggleClass("fc-state-active")});t.find(".content-h .label, .content-h .fc-settings").on("click",function(){r.hideMenus(r.todoMenu);r.todoMenu.popupMenu("open",n(this).parent().find(".label"))});t.find(".sort-label .label, .sort-label .fc-dropdown").on("click",function(){r.hideMenus(r.sortMenu);r.sortMenu.popupMenu("open",n(this).parent().find(".label"))});return p=t.find(".fc-modal").on("click",function(){rt.call(e);ot.call(e);gt.call(e);st.call(e)}),v.call(this),li.call(this),yi.call(this),pi.call(this),t.children()};this.createTodo=function(n){nt(n);c=t;v.call(e);rt.call(e)};this.openTodoEditor=function(t,i){for(var u=n(".fc-todo-list .content-li"),r=0;r<u.length;r++)n(u[r]).data("todoId")==t.id&&ei.call(e,u[r],i)};this.updateTodo=function(n){nt(n)};this.getTodoElem=function(){return pt};this.rerenderList=function(n){v.call(this,n)};this.resize=function(n){a.css("height",n+"px")};this.addNewTodo=function(){var n=vt.call(e),i;n&&(c=t,v.call(e),i=yt.call(e,n.sourceIndex,n.todoId),i&&et.call(e,i[0]))};this.show=function(){a.parent().removeClass("hidden");a.show();f.updateSize()};this.hide=function(){a.hide();a.parent().addClass("hidden");f.updateSize()}}function pu(f,e){function ir(n){var u={},y=ni(a.find(".editor .from-date"),a.find(".editor .from-time"),u),e={},p=ni(a.find(".editor .to-date"),a.find(".editor .to-time"),e),r=y==1?s(u.date.value+"T"+u.time.value):null,o=p==1?s(e.date.value+"T"+e.time.value):null,l,t,i,h;if(r&&o){if(st.call(v,!1),l=a.find(".editor .all-day input").is(":checked"),c.title=a.find(".title input").val(),c.start=r,c._start=r,c.end=n?r:o,c._end=n?r:o,c.allDay=n?!0:l,c.location=a.find(".editor .location input").val(),t=f.getEventSources(),a.find(".editor .calendar select").val()!=null||n)for(i=0;i<t.length;++i)t[i].objectId!=a.find(".editor .calendar select").val()||n?n&&t[i].isTodo==1&&(c.afretResizeSource=t[i],c.textColor=t[i].textColor,c.backgroundColor=t[i].backgroundColor,c.borderColor=t[i].borderColor):(c.afretResizeSource=t[i],c.textColor=t[i].textColor,c.backgroundColor=t[i].backgroundColor,c.borderColor=t[i].borderColor);else c.afretResizeSource=t[2],c.textColor=t[2].textColor,c.backgroundColor=t[2].backgroundColor,c.borderColor=t[2].borderColor;(f.renderEvent(c),h=f.getView().getEventElement(c),h)&&si.call(v,"addPopup",h,c)}}function wi(){y.find(".fc-days-week").addClass("hidden");y.find(".fc-month-radio").addClass("hidden")}function wr(){y.find(".fc-month-radio").addClass("hidden");y.find(".fc-days-week").removeClass("hidden")}function br(){y.find(".fc-days-week").addClass("hidden");y.find(".fc-month-radio").removeClass("hidden")}function kr(){y.find(".fc-repeat-cycles").addClass("hidden");y.find(".fc-end-date").addClass("hidden")}function dr(){y.find(".fc-end-date").addClass("hidden");y.find(".fc-repeat-cycles").removeClass("hidden");ei.call(v)}function gr(){y.find(".fc-repeat-cycles").addClass("hidden");y.find(".fc-end-date").removeClass("hidden");ei.call(v)}function wt(n){var t=d(y.find(".from-date").val()),i=parseInt(y.find(".fc-interval-selector").find("option:selected").text(),10);switch(n){case it.day:return f.formatDate(new Date(t.getFullYear(),t.getMonth(),t.getDate()+i+1,0,0,0),k.dateFormat);case it.week:return f.formatDate(new Date(t.getFullYear(),t.getMonth(),t.getDate()+i*7+1,0,0,0),k.dateFormat);case it.month:return f.formatDate(new Date(t.getFullYear(),t.getMonth()+i,t.getDate()+1,0,0,0),k.dateFormat);case it.year:return f.formatDate(new Date(t.getFullYear()+i,t.getMonth(),t.getDate()+1,0,0,0),k.dateFormat)}}function bi(){ii||ct.call(v);a.popupFrame("updatePosition",tt)}function ct(){var n=f.getView().getViewRect(),t=u.getElementRect(tt),s=a.outerWidth(!0),i=a.outerHeight(!0),e,l,r,v,o,h;t.right+s<=n.right-y.outerWidth(!0)||t.left-s<n.left?(a.popupFrame("option","anchor","right,top"),a.popupFrame("option","direction","right,down"),a.popupFrame("option","arrow","left"),a.popupFrame("option","offset","-4px,0"),a.popupFrame("updatePosition",tt),s=a.outerWidth(!0),e=t.right+s-n.right,e=e<0?-4:-e,a.popupFrame("option","offset",e+"px,0")):(a.popupFrame("option","anchor","left,top"),a.popupFrame("option","direction","left,down"),a.popupFrame("option","arrow","right"),a.popupFrame("option","offset","2px,0"));a.popupFrame("updatePosition",tt);l=!1;(t.top<n.top||t.bottom>n.bottom)&&(f.getView().resetScroll(c.start.getHours()),t=u.getElementRect(tt),t.top<n.top&&(l=!0,r=a.popupFrame("option","offset").match(/^([+-]?\d+(\.\d+)?)(px)?,([+-]?\d+(\.\d+)?)(px)?/i),v=r[1]+(r[3]?r[3]:"")+","+(n.top-t.top+parseInt(r[4],10))+(r[6]?r[6]:""),a.popupFrame("option","offset",v)));o=(Math.max(t.top,n.top)+Math.min(t.bottom,n.bottom)-i)*.5;h=50;l||(o<n.top?h=Math.round((i*.5-n.top+o)*100/i):o+i>n.bottom&&(h=Math.round((i*.5+o+i-n.bottom)*100/i)));a.popupFrame("option","arrowPosition",h+"%")}function oi(){a.removeClass("add-dialog add-popup edit-popup todo-popup");ii=t}function au(n){oi.call(v);ii=!1;a.popupFrame("option","showArrow",!0);ct.call(v);a.popupFrame("open",n);e.addClass("fc-modal-transparent")}function dt(){oi.call(v);ir(!1);a.addClass("edit-popup");a.find(".title input").trigger("focus")}function vu(){oi.call(v);ir(!0);a.addClass("edit-popup todo-popup");a.find(".title input").trigger("focus")}function ht(n){if(n!=t)switch(n){case w:return f.options.eventEditor.dialogAlertOption_default;case b:return f.options.eventEditor.dialogAlertOption_never;case 1:return f.options.eventEditor.dialogAlertOption_5minutes;case 2:return f.options.eventEditor.dialogAlertOption_15minutes;case 3:return f.options.eventEditor.dialogAlertOption_30minutes;case 4:return f.options.eventEditor.dialogAlertOption_hour;case 5:return f.options.eventEditor.dialogAlertOption_2hours;case 6:return f.options.eventEditor.dialogAlertOption_day;default:return"Unknown"}}function ui(n){if(n!=t)return n.Equals(ASC.Api.iCal.RecurrenceRule.Never)?f.options.eventEditor.dialogRepeatOption_never:n.Equals(ASC.Api.iCal.RecurrenceRule.EveryDay)?f.options.eventEditor.dialogRepeatOption_day:n.Equals(ASC.Api.iCal.RecurrenceRule.EveryWeek)?f.options.eventEditor.dialogRepeatOption_week:n.Equals(ASC.Api.iCal.RecurrenceRule.EveryMonth)?f.options.eventEditor.dialogRepeatOption_month:n.Equals(ASC.Api.iCal.RecurrenceRule.EveryYear)?f.options.eventEditor.dialogRepeatOption_year:f.options.eventEditor.dialogRepeatOption_custom}function yu(){y.find(".fc-interval-selector").prop("disabled",!0);y.find("input").each(function(){el=n(this);el.prop("disabled",!0)});y.find(".fc-dwm-selector").find(".fc-selector-link").addClass("not-active");y.find(".fc-endrepeat-selector").find(".fc-selector-link").addClass("not-active")}function pu(){y.find(".fc-interval-selector").prop("disabled",!1);y.find("input").each(function(){el=n(this);el.prop("disabled",!1)});y.find(".fc-dwm-selector").find(".fc-selector-link").removeClass("not-active");y.find(".fc-endrepeat-selector").find(".fc-selector-link").removeClass("not-active")}function vt(n){n?a.find(".repeat-alert").find(".right").css("background-color","#f5f5f5"):a.find(".repeat-alert").find(".right").css("background-color","transparent")}function wu(){var i=a.find(".fc-view-repeat"),t;a.find(".fc-view-repeat").on("click",function(n){r.hideMenus(r.modeMenuRepeat);r.modeMenuRepeat.popupMenu("open",i);n.stopPropagation()});!r.modeMenuRepeat||r.modeMenuRepeat.length<1?r.modeMenuRepeat=n('<div id="fc_mode_menu_repeat"><\/div>'):(r.modeMenuRepeat.popupMenu("close"),r.modeMenuRepeat.popupMenu("destroy"));r.modeMenuRepeat.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:f.options.eventEditor.dialogRepeatOption_never,click:function(){p=ASC.Api.iCal.RecurrenceRule.Never;i.find(".fc-selector-link").text(ui.call(v,p));lt.call(v,!1);a.find(".repeat-settings").addClass("hidden");vt.call(v,0);ct.call(v)}},{label:f.options.eventEditor.dialogRepeatOption_day,click:function(){p=ASC.Api.iCal.RecurrenceRule.EveryDay;i.find(".fc-selector-link").text(ui.call(v,p));lt.call(v,!1);a.find(".repeat-settings").addClass("hidden");vt.call(v,0);ct.call(v)}},{label:f.options.eventEditor.dialogRepeatOption_week,click:function(){p=ASC.Api.iCal.RecurrenceRule.EveryWeek;i.find(".fc-selector-link").text(ui.call(v,p));lt.call(v,!1);a.find(".repeat-settings").addClass("hidden");vt.call(v,0);ct.call(v)}},{label:f.options.eventEditor.dialogRepeatOption_month,click:function(){p=ASC.Api.iCal.RecurrenceRule.EveryMonth;i.find(".fc-selector-link").text(ui.call(v,p));lt.call(v,!1);a.find(".repeat-settings").addClass("hidden");vt.call(v,0);ct.call(v)}},{label:f.options.eventEditor.dialogRepeatOption_year,click:function(){p=ASC.Api.iCal.RecurrenceRule.EveryYear;i.find(".fc-selector-link").text(ui.call(v,p));lt.call(v,!1);a.find(".repeat-settings").addClass("hidden");vt.call(v,0);ct.call(v)}},{label:f.options.eventEditor.dialogRepeatOption_custom,click:function(){i.find(".fc-selector-link").text(f.options.eventEditor.dialogRepeatOption_custom);iu.call(v);a.find(".repeat-settings").removeClass("hidden");pu.call(v);vt.call(v,1);ct.call(v);rr.call(v)}}]});t=a.find(".fc-view-alert");a.find(".fc-view-alert").on("click",function(n){r.hideMenus(r.modeMenuAlert);r.modeMenuAlert.popupMenu("open",t);n.stopPropagation()});!r.modeMenuAlert||r.modeMenuAlert.length<1?r.modeMenuAlert=n('<div id="fc_mode_menu_alert"><\/div>'):(r.modeMenuAlert.popupMenu("close"),r.modeMenuAlert.popupMenu("destroy"));r.modeMenuAlert.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:f.options.eventEditor.dialogAlertOption_default,click:function(){rt=w;t.find(".fc-selector-link").text(ht.call(v,rt))}},{label:f.options.eventEditor.dialogAlertOption_never,click:function(){rt=b;t.find(".fc-selector-link").text(ht.call(v,rt))}},{label:f.options.eventEditor.dialogAlertOption_5minutes,click:function(){rt=1;t.find(".fc-selector-link").text(ht.call(v,rt))}},{label:f.options.eventEditor.dialogAlertOption_15minutes,click:function(){rt=2;t.find(".fc-selector-link").text(ht.call(v,rt))}},{label:f.options.eventEditor.dialogAlertOption_30minutes,click:function(){rt=3;t.find(".fc-selector-link").text(ht.call(v,rt))}},{label:f.options.eventEditor.dialogAlertOption_hour,click:function(){rt=4;t.find(".fc-selector-link").text(ht.call(v,rt))}},{label:f.options.eventEditor.dialogAlertOption_2hours,click:function(){rt=5;t.find(".fc-selector-link").text(ht.call(v,rt))}},{label:f.options.eventEditor.dialogAlertOption_day,click:function(){rt=6;t.find(".fc-selector-link").text(ht.call(v,rt))}}]})}function bu(){tt={pageX:"center",pageY:"center"};oi.call(v);ii=!0;a.addClass("add-dialog");a.popupFrame("option","showArrow",!1);a.popupFrame("open",tt);e.removeClass("fc-modal-transparent")}function ku(n){oi.call(v);ii=!1;a.addClass("add-popup");a.popupFrame("option","showArrow",!0);ct.call(v);a.popupFrame("open",n);e.addClass("fc-modal-transparent")}function du(){tt={pageX:"center",pageY:"center"};nt.popupFrame("open",tt);nt.addClass("add-popup");nt.addClass("fc-shadow");e.removeClass("fc-modal-transparent")}function nu(){var n,t;for(c.permissions=c.permissions||{},c.permissions.users=c.permissions.users||[],n="",t=0;t<c.permissions.users.length;t++)t>0&&(n+=", "),n+=c.permissions.users[t].name;f.options.isPersonal?a.find(".shared-list").remove():(a.find(".viewer .shared-list .users-list").html(i(n)),n.length>0?a.find(".viewer .shared-list").addClass("has-users"):a.find(".viewer .shared-list").removeClass("has-users"));tr.render(c.permissions,pi,c.objectId)}function gu(n){n.result&&(c.permissions=n.permissions,n.isShared!=t&&(c.isShared=n.isShared),nu.call(v),bi(),rr.call(v))}function si(i,r,f){a.popupFrame("close");e.hide();a.find(".repeat-settings").addClass("hidden");vt.call(v,0);var s=h.eventMaxTitleLength,o=a.find(".editor .title input, .editor .location input");if(o.length>0)o.on("keyup",function(){o.val().length>s&&o.val(o.val().substr(0,s))});c=f;c.sourceId=c.sourceId||(c.source?c.source.objectId:t);p=c.repeatRule;pr=c.source==t||c.source&&!c.source.isSubscription;ri=u.objectIsEditable(c)||u.objectIsEditable(c.source)||c.source&&!c.source.isSubscription;ot=c.source==t||ri;ci=c&&c.canUnsubscribe&&c.source&&c.source.isSubscription;ot?a.find(".buttons").addClass("editable"):a.find(".buttons").removeClass("editable");ri?a.find(".buttons").addClass("erasable"):a.find(".buttons").removeClass("erasable");ot||ri?a.find(".buttons").removeClass("readonly"):a.find(".buttons").addClass("readonly");ci?a.find(".buttons").addClass("shared"):a.find(".buttons").removeClass("shared");f.allDay&&(f.start==f.end||f.end==null)?a.find(".viewer .date-time .right").hide():a.find(".viewer .date-time .right").show();hi.call(v);tt=r;nr[i].call(v,r,f);bi();a.find(".editor .title input").trigger("focus").trigger("select");rr.call(v);n(document).on("keyup",ki);a.popupFrame("isVisible")?e.show():e.hide()}function rr(){y.height("auto");y.height(a.find(".end-point").offset().top-a.find(".start-point").offset().top-(a.hasClass("add-dialog")?a.find(".header").outerHeight():0))}function nf(t,i){var u,r,f;if(t<=i){for(u="",r=1;r<i;r++)u+="<option"+(t==r?" selected":"")+" value='"+r+"'>"+r+"<\/option>";f=n(u);y.find(".fc-interval-selector").html(f);y.find(".fc-interval-selector").on("change",function(){y.find(".to-date").val(wt.call(v,ut))})}}function tf(t){for(var o,s,f,l,e="",u,h=[],c=[],r=0;r<k.dayNamesShort.length;r++)o={index:r,name:k.dayNamesShort[r]},r<g_fcOptions.firstDay?h.push(o):c.push(o);for(u=c.concat(h),r=0;r<u.length;r++){for(s=!1,f=0;f<t.length;f++)if(u[r].index==t[f]){s=!0;break}e+="<div class='checkbox-day'><input class='repeat-day-"+u[r].index+"' type='checkbox' "+(s==!0?"checked":"")+"><div>"+i(u[r].name)+"<\/div><\/div>"}e+="<div class='clear'><\/div>";l=n(e);y.find(".fc-days-week").html(l)}function rf(){var n,t,i;if(indexArr=[],y.find(".fc-days-week.hidden").length==0)for(n=0;n<k.dayNamesShort.length;n++)t=".repeat-day-"+n,i=y.find(t).is(":checked"),i==!0&&indexArr.push(n);return indexArr}function tu(n){switch(n){case 0:return ASC.Api.iCal.DayOfWeek.Sunday;case 1:return ASC.Api.iCal.DayOfWeek.Monday;case 2:return ASC.Api.iCal.DayOfWeek.Tuesday;case 3:return ASC.Api.iCal.DayOfWeek.Wednesday;case 4:return ASC.Api.iCal.DayOfWeek.Thursday;case 5:return ASC.Api.iCal.DayOfWeek.Friday;case 6:return ASC.Api.iCal.DayOfWeek.Saturday}}function iu(){var c=a.find(".editor .from-date"),b,e,o;y.find(".from-date").val(c.val());ei.call(v);var r=d(c.val()),nt=t,g=32-new Date(r.getFullYear(),r.getMonth(),32).getDate(),s=r.getDay(),u=r.getDate(),i=Math.floor((u-1)/7),l=i+Math.floor((g-u)/7),w=f.options.repeatSettings.dayNames[s],h="";switch(i){case 0:case 1:case 2:case 4:h=k.dayAliasNames[i];break;case 3:h=i!=l?k.dayAliasNames[i]:k.dayAliasNames[i+1]}b=n("<div><div style='margin-bottom: 0.5em;'><input class='only-day' type='radio' name='day-radio' value='"+u+"' />&nbsp;<span class='only-day-label'>"+k.dialogEachLabel+" "+u+" "+k.dialogIntervalOption_day+"<\/span><\/div><input class='each-day' type='radio' name='day-radio' value='"+w+"'/>&nbsp;<span class='each-day-label'>"+k.dialogAliasLabel+" "+h+" "+w+"<\/span><\/div>");y.find(".fc-month-radio").html(b);y.find(".only-day").prop("checked",!0);y.find(".only-day-label").on("click",function(){y.find(".only-day").trigger("click")});y.find(".each-day-label").on("click",function(){y.find(".each-day").trigger("click")});ti=t;y.find(".each-day").on("click",function(){ti=tu.call(v,s);var n=0;switch(i){case 0:case 1:case 2:n=i+1;break;case 3:n=-2;break;case 4:n=-1}i==l&&(n=-1);ti.Order=n});y.find(".only-day").on("click",function(){ti=t});for(nf.call(this,p.Interval,31),y.find(".fc-cycle-times").val(p.Count>0?p.Count:3),e=[],o=0;o<p.ByDay.length;o++)e.push(k.dayIndexResponse[p.ByDay[o].Id]);tf.call(this,e.length?e:[s]);p.Freq==ASC.Api.iCal.Frequency.Never||p.Freq==ASC.Api.iCal.Frequency.Daily?(wi.call(v),ut=it.day,y.find(".fc-dwm-selector").find(".fc-selector-link").text(k.dialogRepeatOn_days),y.find(".fc-interval-label").text(k.dialogIntervalOption_day)):p.Freq==ASC.Api.iCal.Frequency.Weekly?(wr.call(v),ut=it.week,y.find(".fc-dwm-selector").find(".fc-selector-link").text(k.dialogRepeatOn_weeks),y.find(".fc-interval-label").text(k.dialogIntervalOption_week)):p.Freq==ASC.Api.iCal.Frequency.Monthly?(br.call(v),ut=it.month,y.find(".fc-dwm-selector").find(".fc-selector-link").text(k.dialogRepeatOn_months),y.find(".fc-interval-label").text(k.dialogIntervalOption_month),p.ByDay.length==1&&p.ByDay[0].Order!=0?(y.find(".only-day").prop("checked",!1),y.find(".each-day").prop("checked",!0).trigger("click")):(y.find(".each-day").prop("checked",!1),y.find(".only-day").prop("checked",!0))):p.Freq==ASC.Api.iCal.Frequency.Yearly&&(wi.call(v),ut=it.year,y.find(".fc-dwm-selector").find(".fc-selector-link").text(k.dialogRepeatOn_years),y.find(".fc-interval-label").text(k.dialogIntervalOption_year));y.find(".to-date").val(p.Until?f.formatDate(p.Until,k.dateFormat):wt.call(v,ut));p.Until?(gr.call(v),y.find(".fc-endrepeat-selector").find(".fc-selector-link").text(k.dialogOptionDate)):p.Count>0?(dr.call(v),y.find(".fc-endrepeat-selector").find(".fc-selector-link").text(k.dialogOptionCount)):(kr.call(v),y.find(".fc-endrepeat-selector").find(".fc-selector-link").text(k.dialogOptionNever))}function uf(t,i){a.popupFrame("close");n(document).off("keyup",ki);i?nt.addClass("single"):nt.removeClass("single");nt.popupFrame("close");nt.find("input[type=radio]:first").prop("checked",!0);e.hide();nr[t].call(v);n(document).on("keyup",fr);nt.popupFrame("isVisible")?e.show():e.hide()}function st(i,r){if(f.openEventWin=null,i){if(dt==pt.event){if(!ot||!1==hi.call(v,!0))return;hu.call(v)}else{if(!1==hi.call(v,!0))return;cf.call(v)}return}c.source==t&&c._id!=t&&f.removeEvents(c._id);c.source==t||i||r||hu.call(v,!0);n(document).off("keyup",ki);er.call(v)}function lt(n){n&&ot&&sf.call(v)}function ur(t){if(t){if(!ot)return;ru.call(v);return}n(document).off("keyup",fr);ru.call(v)}function ki(n){n.which==27&&st.call(v,!1)}function fr(n){n.which==27&&ur.call(v,!1)}function er(){l.close();a.popupFrame("close");e.hide()}function di(n){n?a.find(".buttons .save-btn").addClass("disable"):a.find(".buttons .save-btn").removeClass("disable")}function ru(){nt.popupFrame("close");e.hide()}function ff(){var t,i,n;return(g.notificationUsers.newGuests=[],g.notificationUsers.updatedGuests=[],g.notificationUsers.removedGuests=[],g.selectedViewMode=g.viewMode.none,g.selectedNotificationMode=g.notificationMode.nobody,c.status==2||c.source&&c.source.isSubscription)?g.selectedViewMode:(t=!1,i=c.organizer?c.organizer[3].replace(new RegExp("mailto:","ig"),"").toLowerCase():"",jq.each(ASC.Mail.Accounts,function(n,r){return r.enabled&&i==r.email.toLowerCase()?(t=!0,!1):!0}),!t)?g.selectedViewMode:(n=[],jq.each(c.attendees||[],function(t,r){var u=r[3].replace(new RegExp("mailto:","ig"),"");u.toLowerCase()!=i&&n.push(u)}),n.length&&(g.selectedViewMode=g.viewMode.deleteEvent,g.notificationUsers.removedGuests=n,g.notificationUsers.updatedGuests=n),g.selectedViewMode)}function ef(){switch(g.selectedViewMode){case g.viewMode.deleteEvent:et.find(".title").text(f.options.confirmPopup.dialogDeleteEventHeader);et.find(".body").text(f.options.confirmPopup.dialogDeleteEventBody);et.find(".send-btn").show();et.find(".send-customs-btn, .send-everyone-btn").hide()}a.popupFrame("close");n(document).off("keyup",ki);nt.popupFrame("close");n(document).off("keyup",fr);et.popupFrame("close");et.popupFrame("open",{pageX:"center",pageY:"center"});et.css("position","fixed");e.removeClass("fc-modal-transparent");et.popupFrame("isVisible")?e.show():e.hide()}function uu(){et.popupFrame("close");e.hide()}function or(n){g.selectedNotificationMode=n;su.call(v,g.selectedDeleteMode,c._start);st.call(v,!1,!0);uu.call(v)}function lr(n,t,i,r){var u=[],e=null;switch(i){case g.notificationType.cancel:switch(g.selectedNotificationMode){case g.notificationMode.everybody:case g.notificationMode.partially:u=g.notificationUsers.removedGuests;e=ASC.Mail.Utility.SendCalendarCancel}break;case g.notificationType.update:switch(g.selectedNotificationMode){case g.notificationMode.everybody:case g.notificationMode.partially:u=g.notificationUsers.updatedGuests;e=ASC.Mail.Utility.SendCalendarUpdate}}u.length&&e?(ASC.CalendarController.Busy=!0,window.LoadingBanner.displayLoading(),e.call(this,n,t,u).done(function(){console.log(f.options.confirmPopup.dialogSuccessToastText,arguments);r&&r()}).fail(function(){toastr.error(f.options.confirmPopup.dialogErrorToastText);console.error(f.options.confirmPopup.dialogErrorToastText,arguments)}).always(function(){ASC.CalendarController.Busy=!1;window.LoadingBanner.hideLoading()})):r&&r()}function ni(n,t,i){var s=n.val(),h=t.val(),c=s.search(/\S/)<0,e=h.search(/\S/)<0,r,f,o;return c&&e?(o=-1,r=null,f=null):(r=u.validateDateString(s),f=u.validateTimeString(h),o=r===null||!e&&f===null?0:1),i.date={isEmpty:c,isValid:r!==null,value:r},i.time={isEmpty:e,isValid:f!==null,value:f},o}function fu(n){var r={date:a.find(".editor .todo_editor .date"),time:a.find(".editor .todo_editor .time")},i={},e=ni(r.date,r.time,i),u,f;return i.dateTime=e==1?s(i.date.value+"T23:59:59"):null,e==1?(f=!0,u=""):(f=!1,u=i.date.isValid?"":r.date.val()===""?"":"#cc3300"),r.date.css("color","").css("border-color",u),n!=t&&(n.todoDate=i),f}function gi(i){var b=a.find(".editor .all-day input").is(":checked"),f={from:a.find(".editor .from-date"),from_t:a.find(".editor .from-time"),to:a.find(".editor .to-date"),to_t:a.find(".editor .to-time")},e={},l=ni(f.from,f.from_t,e),r={},y=ni(f.to,f.to_t,r),k,d,g,nt,p,w,tt,it,h,u,rt,o;return e.dateTime=l==1?s(e.date.value+"T"+e.time.value):null,r.dateTime=y==1?s(r.date.value+"T"+r.time.value):null,!b&&l==1&&y==1&&(w=r.dateTime-e.dateTime>0)||b&&l==1&&y==-1||b&&l==1&&y==1&&(w=r.dateTime-e.dateTime>=0)?(p=!0,k=d=g=nt=""):(p=!1,k=e.date.isValid?"":"#cc3300",d=e.time.isValid?"":"#cc3300",g=r.date.isValid&&w?"":"#cc3300",nt=r.time.isValid&&w?"":"#cc3300"),f.from.css("color","").css("border-color",k),f.from_t.css("color","").css("border-color",d),f.to.css("color","").css("border-color",g),f.to_t.css("color","").css("border-color",nt),i&&(n(i.currentTarget).hasClass("from-time")||n(i.currentTarget).hasClass("from-date"))&&(tt=new Date(Date.parse(c._start?c._start:c.start)),it=new Date(Date.parse(e.dateTime)),fi!=null&&(tt=fi),h=it.getTime()-tt.getTime(),h!=NaN&&h!=0&&(u=new Date,u.setTime(Date.parse(r.dateTime)+h),u!="Invalid Date"&&(r.dateTime.setTime(Date.parse(r.dateTime)+h),fi=it,n(i.currentTarget).hasClass("from-time")?(rt=(r.dateTime.getHours()<10?"0"+r.dateTime.getHours():r.dateTime.getHours())+":"+(r.dateTime.getMinutes()<10?"0"+r.dateTime.getMinutes():r.dateTime.getMinutes()),o=u.getFullYear()+"-"+(u.getMonth()+1<10?"0"+(u.getMonth()+1):u.getMonth()+1)+"-"+(u.getDate()<10?"0"+u.getDate():u.getDate()),r.date.value=o,r.time.value=rt,f.to[0].value=o,f.to_t[0].value=rt):n(i.currentTarget).hasClass("from-date")&&(o=u.getFullYear()+"-"+(u.getMonth()+1<10?"0"+(u.getMonth()+1):u.getMonth()+1)+"-"+(u.getDate()<10?"0"+u.getDate():u.getDate()),r.date.value=o,f.to[0].value=o),p=gi.call(v)))),i!=t&&(i.fromDate=e,i.toDate=r),p}function ei(n){var f=!0,c=a.find(".editor .all-day input").is(":checked"),i={from:y.find(".from-date"),from_t:y.find(".from-time"),to:y.find(".to-date"),to_t:y.find(".to-time"),cycles:y.find(".fc-cycle-times")},l,v,p,w,h,b,k;if(!y.find(".fc-end-date").hasClass("hidden")){var r={},e=ni(i.from,i.from_t,r),u={},o=ni(i.to,i.to_t,u);r.dateTime=e==1?s(r.date.value+"T"+r.time.value):null;u.dateTime=o==1?s(u.date.value+"T"+u.time.value):null;!c&&e==1&&o==1&&(h=u.dateTime-r.dateTime>0)||c&&e==1&&o==-1||c&&e==1&&o==1&&(h=u.dateTime-r.dateTime>=0)?(f=!0,l=v=p=w=""):(f=!1,l=r.date.isValid?"":"#cc3300",v=r.time.isValid?"":"#cc3300",p=u.date.isValid&&h?"":"#cc3300",w=u.time.isValid&&h?"":"#cc3300");i.from.css("color","").css("border-color",l);i.from_t.css("color","").css("border-color",v);i.to.css("color","").css("border-color",p);i.to_t.css("color","").css("border-color",w);n!=t&&(n.fromDate=r,n.toDate=u)}return y.find(".fc-repeat-cycles").hasClass("hidden")||(b="",f=!0,k=i.cycles.val().match("^[0-9]+$"),i.cycles.find(".hidden").length!=0||k||(f=!1,b=!f||f&&i.cycles.val()<0?"#cc3300":""),i.cycles.css("color","").css("border-color",b)),f}function ar(){var i,n,t;fi=null;i=a.find(".editor .all-day input").is(":checked");n={from:a.find(".editor .from-date"),from_t:a.find(".editor .from-time"),to:a.find(".editor .to-date"),to_t:a.find(".editor .to-time")};i?(n.from_t.val("").prop("disabled",!0),n.to_t.val("").prop("disabled",!0)):(t=new Date(c.start.getFullYear(),c.start.getMonth(),c.start.getDate(),c.start.getHours(),c.start.getMinutes()+30),n.from.val()||n.from.val(ft(c.start,f.options.eventEditor.dateFormat)),n.from_t.val(ft(c.start,f.options.eventEditor.timeFormat)).prop("disabled",!1),n.to_t.val(c.end instanceof Date?ft(c.end,f.options.eventEditor.timeFormat):ft(t,f.options.eventEditor.timeFormat)).prop("disabled",!1),n.to.val()||n.to.val(c.end instanceof Date?ft(c.end,f.options.eventEditor.dateFormat):ft(t,f.options.eventEditor.dateFormat)));gi()}function sf(){var i,r,n,u;p&&(p=t);i={from:y.find(".from-date"),to:y.find(".to-date"),interval:y.find(".fc-interval-selector"),cycles:y.find(".fc-cycle-times")};p=ASC.Api.iCal.RecurrenceRule.EveryDay;switch(ut){case it.day:p=ASC.Api.iCal.ParseRRuleFromString("FREQ=DAILY");break;case it.week:p=ASC.Api.iCal.ParseRRuleFromString("FREQ=WEEKLY");break;case it.month:p=ASC.Api.iCal.ParseRRuleFromString("FREQ=MONTHLY");break;case it.year:p=ASC.Api.iCal.ParseRRuleFromString("FREQ=YEARLY")}for(p.Interval=i.interval.find("option:selected").text(),p.Count=y.find(".fc-repeat-cycles.hidden").length?p.Count:i.cycles.val(),r=rf.call(v),n=0;n<r.length;n++)p.ByDay.push(tu.call(this,r[n]));if(y.find(".fc-month-radio.hidden").length==0&&ti!=t&&p.ByDay.push(ti),y.find(".fc-end-date.hidden").length==0){if(u={},!ei(u))return!1;p.Until=u.toDate.dateTime}return c.repeatRule=p,p!=t}function hi(r,e){var l=f.getEventSources(),k=u.objectIsValid(c.source),lt=k&&(c.source.canAlertModify!=t&&c.source.canAlertModify||c.source.canAlertModify==t)||!k,o={viewer:{title:a.find(".viewer .title"),location:a.find(".viewer .location"),attendees:a.find(".viewer .attendees"),replybuttons:a.find(".viewer .reply-buttons"),owner:a.find(".viewer .owner .name"),allday:a.find(".viewer .all-day"),from:a.find(".viewer .from-date"),from_t:a.find(".viewer .from-time"),to:a.find(".viewer .to-date"),to_t:a.find(".viewer .to-time"),repeat:a.find(".viewer .repeat"),alert:a.find(".viewer .alert"),calendar:a.find(".viewer .calendar .name"),calendar_b:a.find(".viewer .calendar .bullet"),description:a.find(".viewer .description .text"),status:a.find(".viewer .status"),attachments:a.find(".viewer .attachments tbody")},editor:{title:a.find(".editor .title input"),location:a.find(".editor .location input"),attendees:a.find(".editor .attendees input"),allday:a.find(".editor .all-day input"),from:a.find(".editor .from-date"),from_t:a.find(".editor .from-time"),to:a.find(".editor .to-date"),to_t:a.find(".editor .to-time"),repeat:a.find(".editor .fc-view-repeat .fc-selector-link"),alert:a.find(".editor .fc-view-alert .fc-selector-link"),calendar:a.find(".editor .calendar select"),calendar_b:a.find(".editor .calendar .bullet"),description:a.find(".editor .description textarea"),status:a.find(".editor .status"),attachments:a.find(".editor .attachments-list")},todo:{title:a.find(".editor .title input"),date:a.find(".editor .todo_editor .date"),time:a.find(".editor .todo_editor .time"),description:a.find(".editor .todo_editor .description textarea")},infoText:a.find(".info-text")},h,it,ct,yt,d,s,ut,g,et,nt,st,tt;if(r){if(!ot)return!1;if(dt==pt.event){if(!1==u.validateInput(o.editor.title,u.validateNonemptyString)&&!e||(c.title=o.editor.title.val().trim(),c.title=c.title.substr(0,Math.min(f.options.eventMaxTitleLength,c.title.length)),c.location=o.editor.location.val().trim(),c.allDay=o.editor.allday.is(":checked"),d={},!gi(d)))return!1;c.start=d.fromDate.dateTime;c.end=d.toDate.dateTime;lt&&(c.repeatRule=p,c.alert.type=rt);c.newSourceId=o.editor.calendar.val();c.status=(o.editor.status.val()||"").trim();c.attendees=[];c.attachments=[];!c.organizer&&ASC.Mail.DefaultAccount&&(it=new ICAL.Property("organizer"),it.setParameter("cn",ASC.Mail.DefaultAccount.name),it.setValue("mailto:"+ASC.Mail.DefaultAccount.email),c.organizer=it.jCal);n.each(l,function(){return this.objectId==c.newSourceId?(ct=this,!1):!0});ct&&(c.newTimeZone=n.extend({},ct.timeZone));yt=o.editor.description.val().trim();c.description=yt;delete c.textColor;delete c.backgroundColor;delete c.borderColor;f.normalizeEvent(c)}else{if((at={title:f.options.todoList.newTodoTitle,completed:!1,start:null},!1==u.validateInput(o.todo.title,u.validateNonemptyString))||(at.title=o.editor.title.val().trim(),at.title=at.title.substr(0,Math.min(f.options.eventMaxTitleLength,at.title.length)),d={},!fu(d)&&!d.todoDate.date.isEmpty))return!1;at.start=d.todoDate.dateTime;at.description=o.todo.description.val().trim()}}else{o.editor.title.css("color","").css("border-color","").val(Encoder.htmlDecode(c.title));o.viewer.title.text(Encoder.htmlDecode(c.title));c.status==2?o.infoText.show():o.infoText.hide();o.editor.location.val(c.location||"");o.viewer.location.text(c.location||"");c.location?o.viewer.location.show():o.viewer.location.hide();c.attendees&&c.attendees.length?(s={needsAction:"NEEDS-ACTION",needsActionCount:0,accepted:"ACCEPTED",acceptedCount:0,declined:"DECLINED",declinedCount:0,tentative:"TENTATIVE",tentativeCount:0},ut=!1,jq(c.attendees).each(function(n,t){var r=t[3].replace(new RegExp("mailto:","ig"),""),i=t[1].partstat.toUpperCase();ut||jq(ASC.Mail.Accounts).each(function(n,t){return t.enabled&&r.toLowerCase()==t.email.toLowerCase()?(ut=!0,o.viewer.replybuttons.find(".reply-button").removeClass("active"),o.viewer.replybuttons.find(".reply-button."+i.toLowerCase()).addClass("active"),!1):!0});switch(i){case s.accepted:s.acceptedCount++;break;case s.declined:s.declinedCount++;break;case s.tentative:s.tentativeCount++;break;case s.needsAction:s.needsActionCount++}}),o.viewer.attendees.find(".guests-count").text(c.attendees.length),o.viewer.attendees.find(".accepted-count").text(s.acceptedCount),o.viewer.attendees.find(".declined-count").text(s.declinedCount),o.viewer.attendees.show(),ot&&ut&&c.status!=2&&!c.source.isSubscription?o.viewer.replybuttons.show():o.viewer.replybuttons.hide()):(o.viewer.replybuttons.hide(),o.viewer.attendees.hide());c.attachments&&c.attachments.length?(o.viewer.attachments.empty().parent().parent().show(),jq(c.attachments).each(function(t,i){var r=n("#attachmentEventDialogTmpl").tmpl(i,{cutFileName:sr,getFileNameWithoutExt:hr,getFileExtension:cr});n(".attachments-list-viewer tbody").append(r)})):o.viewer.attachments.empty().parent().parent().hide();g=c.organizer&&c.organizer.length>1?c.organizer[1].cn:"";g=g?g:c.owner&&c.owner.name?c.owner.name:"";g?(o.viewer.owner.html(i(g)),a.find(".viewer .owner").removeClass("hidden")):(o.viewer.owner.html(""),a.find(".viewer .owner").addClass("hidden"));c.allDay==!0?(o.editor.allday.prop("checked",!0),o.viewer.allday.addClass("yes")):(o.editor.allday.prop("checked",!1),o.viewer.allday.removeClass("yes"));o.editor.from.css("color","").css("border-color","");o.editor.from_t.css("color","").css("border-color","");o.todo.date.css("color","").css("border-color","");o.todo.time.css("color","").css("border-color","");o.todo.date.val(ft(c.start,f.options.eventEditor.dateFormat));o.todo.time.val("00:00");c.start instanceof Date?(o.editor.from.val(ft(c.start,f.options.eventEditor.dateFormat)),c.allDay==!1?o.editor.from_t.val(ft(c.start,f.options.eventEditor.timeFormat)):o.editor.from_t.val("")):(o.editor.from.val(""),o.editor.from_t.val(""));o.editor.to.css("color","").css("border-color","");o.editor.to_t.css("color","").css("border-color","");c.end instanceof Date?(o.editor.to.val(ft(c.end,f.options.eventEditor.dateFormat)),c.allDay==!1?o.editor.to_t.val(ft(c.end,f.options.eventEditor.timeFormat)):o.editor.to_t.val("")):c.allDay&&c.start instanceof Date?o.editor.to.val(ft(c.start,f.options.eventEditor.dateFormat)):(o.editor.to.val(""),o.editor.to_t.val(""));o.viewer.from.text(o.editor.from.val());c.start instanceof Date&&!c.allDay||c.start instanceof Date&&c.allDay&&c.isSegmEvent?o.viewer.from_t.text(ft(c.start,f.options.axisFormat)):o.viewer.from_t.text("");o.viewer.to.text(o.editor.to.val());c.end instanceof Date&&!c.allDay||c.end instanceof Date&&c.allDay&&c.isSegmEvent?o.viewer.to_t.text(ft(c.end,f.options.axisFormat)):o.viewer.to_t.text("");var bt=eu(),kt=u.objectIsValid(c.afretResizeSource),wt=k?c.source:kt?c.afretResizeSource:bt;if(o.editor.repeat.text(function(){return c.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.Never)||c.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.EveryDay)||c.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.EveryWeek)||c.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.EveryMonth)||c.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.EveryYear)||(iu.call(v),y.removeClass("hidden"),yu.call(v),vt.call(v,1)),ui.call(v,c.repeatRule)}),o.editor.alert.text(k?ht.call(v,c.alert.type):ht.call(v,w)),lt?(a.find(".viewer .repeat-alert").removeClass("hidden"),a.find(".editor .repeat-alert").removeClass("hidden")):(o.editor.repeat.text(ASC.Api.iCal.RecurrenceRule.Never),o.editor.alert.text(b),a.find(".viewer .repeat-alert").addClass("hidden"),a.find(".editor .repeat-alert").addClass("hidden")),o.viewer.repeat.text(o.editor.repeat.text()),o.viewer.alert.text(o.editor.alert.text()),et="",pr){for(h=0;h<l.length;++h)l[h].objectId!=t&&(l[h].isEditable||!l[h].isSubscription)&&l[h].isTodo!=1&&(nt=i(l[h].title),et+='<option value="'+i(l[h].objectId)+'" title="'+nt+'">&nbsp;&nbsp;&nbsp;&nbsp;'+nt+"<\/option>");st=wt.objectId;tt=wt.backgroundColor;o.editor.calendar.prop("disabled",!1)}else st=k?c.source.objectId:-1,tt=k?c.source.backgroundColor:f.options.eventBackgroundColor,nt=i(k?c.source.title:""),et='<option value="'+i(st)+'" title="'+nt+'">&nbsp;&nbsp;&nbsp;&nbsp;'+nt+"<\/option>",o.editor.calendar.prop("disabled",!0);o.editor.calendar.html(et);o.editor.calendar.val(st);o.viewer.calendar.text(k?c.source.title:o.editor.calendar.find("option:selected").text());tt=i(tt);o.editor.calendar_b.css("background",tt);o.viewer.calendar_b.css("background",tt);o.editor.status.val(c.status);o.viewer.status.text(o.editor.status.find("option:selected").text());o.editor.description.val(c.description!=t?c.description:"");setTimeout(function(){o.viewer.description.empty();o.viewer.description.append('<div><div class="inner">'+i(o.editor.description.val())+"<\/div><\/div>");var n=o.viewer.description.find(".inner");n.css("width",n.width()+"px");o.viewer.description.children("div").jScrollPane();n.css("width","");c.sourceId=="users_birthdays"?o.viewer.description.prev().hide():o.viewer.description.prev().show();bi()},0);nu.call(v);ar.call(v);fi=null}return!0}function eu(){for(var i=f.getEventSources(),r,n=0;n<i.length;++n)if(u.objectIsValid(i[n])&&(u.objectIsEditable(i[n])||!i[n].isSubscription)&&i[n].isTodo!=1&&(r==t&&(r=i[n]),!i[n].isHidden))return i[n];return r}function ou(n,t,i){var u={title:"",description:"",allDay:i,start:n,end:t,repeatRule:ASC.Api.iCal.RecurrenceRule.Never,alert:{type:w},isShared:!1,permissions:{users:[]},attendees:[]},r;return ASC.Mail.DefaultAccount&&(r=new ICAL.Property("organizer"),r.setParameter("cn",ASC.Mail.DefaultAccount.name),r.setValue("mailto:"+ASC.Mail.DefaultAccount.email),u.organizer=r.jCal),u}function su(i,r){function e(){var u=c._id;f.trigger("editEvent",v,n.extend({action:ai,sourceId:c.source.objectId,type:i,date:r},c),function(n){if(n.result&&(f.removeEvents(u),n.event!=t)){if(!n.event.length){c.repeatRule.Freq!=ASC.Api.iCal.Frequency.Never&&g.selectedDeleteMode!=yt.allSeries&&lr(c.sourceId,c.uniqueId,g.notificationType.cancel,function(){ASC.CalendarController.RemoveEvent(u,yt.allSeries,r)});return}for(var e=f.getEventSources(),i=0;i<n.event.length;)vr(n.event[i],e),i++;f.addEvents(n.event);c.repeatRule.Freq!=ASC.Api.iCal.Frequency.Never&&g.selectedDeleteMode!=yt.allSeries&&lr(c.sourceId,c.uniqueId,g.notificationType.update)}})}ri&&u.objectIsValid(c)&&u.objectIsValid(c.source)&&(c.sourceId&&c.uniqueId&&(c.repeatRule.Freq==ASC.Api.iCal.Frequency.Never||g.selectedDeleteMode==yt.allSeries)?lr(c.sourceId,c.uniqueId,g.notificationType.cancel,e):e())}function hf(){if(ci&&u.objectIsValid(c)&&u.objectIsValid(c.source)){var t=c._id;f.trigger("editEvent",v,n.extend({action:vi,sourceId:c.source.objectId},c),function(n){n.result&&(f.removeEvents(t),st.call(v,!1))})}}function vr(n,i){if(n.sourceId==t&&(n.sourceId=n.newSourceId),!n.source&&n.sourceId!=t)for(var r=0;r<i.length;++r)if(i[r].objectId!=t&&i[r].objectId==n.sourceId){n.source=i[r];break}}function cf(){f.todolist.createTodo(at);a.popupFrame("close");e.hide()}function hu(t){if(ot){if(t){f.trigger("editEvent",v,n.extend({action:yi,sourceId:c.source.objectId},c),function(){});return}if(c.source)di(!0),f.trigger("editEvent",v,n.extend({action:bt,sourceId:c.source.objectId},c),function(n){var i,t;if((di(!1),n.result)&&(er.call(v),!(n.event.length<1))){for(i=f.getEventSources(),n.event[0]&&f.removeEvents(n.event[0].objectId),t=0;t<n.event.length;++t)vr(n.event[t],i);f.addEvents(n.event)}});else{di(!0);var i=c._id;f.trigger("editEvent",v,n.extend({action:li},c),function(n){var r,t;if((di(!1),n.result)&&(er.call(v),f.removeEvents(i),!(n.event.length<1))){for(r=f.getEventSources(),n.event[0]&&f.removeEvents(n.event[0].objectId),t=0;t<n.event.length;++t)vr(n.event[t],r);f.addEvents(n.event)}})}}}function yr(n){if(c.attendees&&c.attendees.length){var i=typeof n=="boolean"?n?"ACCEPTED":"DECLINED":"TENTATIVE",t=null;jq(c.attendees).each(function(n,r){var u=r[3].replace(new RegExp("mailto:","ig"),""),f=r[1].partstat.toUpperCase();return jq(ASC.Mail.Accounts).each(function(n,r){return r.enabled&&u.toLowerCase()==r.email.toLowerCase()&&f!=i?(t=u,!1):!0}),t==null});c.sourceId&&c.uniqueId&&t&&lf(c.sourceId,c.uniqueId,t,i)}}function lf(n,t,i,r){a.find(".viewer .reply-button").removeClass("active");ASC.CalendarController.Busy=!0;window.LoadingBanner.displayLoading();ASC.Mail.Utility.SendCalendarReply(n,t,i,r).done(function(){af(i,r)}).fail(function(){toastr.error(f.options.confirmPopup.dialogErrorToastText);console.error(f.options.confirmPopup.dialogErrorToastText,arguments)}).always(function(){ASC.CalendarController.Busy=!1;window.LoadingBanner.hideLoading()})}function af(n,t){a.find(".viewer .reply-buttons ."+t.toLowerCase()).addClass("active");jq(c.attendees).each(function(i,r){var u=r[3].replace(new RegExp("mailto:","ig"),"");return u.toLowerCase()==n.toLowerCase()?(r[1].partstat=t,r[1].rsvp="FALSE",!1):!0});var i={n:"NEEDS-ACTION",nc:0,a:"ACCEPTED",ac:0,d:"DECLINED",dc:0,t:"TENTATIVE",tc:0};jq(c.attendees).each(function(n,t){var r=t[1].partstat.toUpperCase();switch(r){case i.a:i.ac++;break;case i.d:i.dc++;break;case i.t:i.tc++;break;case i.n:i.nc++}});a.find(".attendees .guests-count").text(c.attendees.length);a.find(".attendees .accepted-count").text(i.ac);a.find(".attendees .declined-count").text(i.dc)}var v=this,k=f.options.repeatSettings,cu=f.options.deleteSettings,lu=f.options.confirmPopup,nr={view:au,todo:vu,edit:dt,addDialog:bu,addPopup:ku,addPopupDelSettings:du},it={day:0,week:1,month:2,year:3},yt={single:0,allFollowing:1,allSeries:2},g={viewMode:{none:0,addEvent:1,updateEvent:2,updateGuests:3,deleteEvent:4},notificationMode:{nobody:0,partially:1,everybody:2},notificationType:{request:1,update:2,cancel:4},notificationUsers:{newGuests:[],removedGuests:[],updatedGuests:[]},selectedViewMode:0,selectedNotificationMode:0,selectedDeleteMode:0},a,rt=w,p=ASC.Api.iCal.RecurrenceRule.EveryDay,ut=it.day,ti=t,y,nt,et,ii,tr,tt,c,at,ot,ri,pr,ci,ft=f.formatDate,vf=f.formatDates,pt={event:0,todo:1},dt=pt.event,fi;(function(){function r(t){var u,r,e,i;if(a.find(".buttonGroup span.active").removeClass("active"),t.addClass("active"),r=f.getEventSources(),t.hasClass("event"))for(dt=pt.event,u="edit",e=a.find(".editor .calendar select").val(),i=0;i<r.length;++i)r[i].objectId==e&&(tt.find(".fc-event-skin, .fc-event-skin-day").css("border-color",r[i].backgroundColor).css("background-color",r[i].backgroundColor).css("color",r[i].textColor),n(tt.find(".fc-event-skin, .fc-event-skin-day")).parent().css("border-color",r[i].backgroundColor).css("background-color",r[i].backgroundColor).css("color",r[i].textColor));else for(dt=pt.todo,u="todo",i=0;i<r.length;++i)r[i].isTodo==1&&(tt.find(".fc-event-skin, .fc-event-skin-day").css("border-color",r[i].backgroundColor).css("background-color",r[i].backgroundColor).css("color",r[i].textColor),n(tt.find(".fc-event-skin, .fc-event-skin-day")).parent().css("border-color",r[i].backgroundColor).css("background-color",r[i].backgroundColor).css("color",r[i].textColor));nr[u].call(v)}function i(n,t,i){var r=d(n.val());t.datepicker("setDate",r instanceof Date?r:i)}function t(n,t,i){n.val(ft(i.datepicker("getDate"),f.options.eventEditor.dateFormat));!t.is(":disabled")&&t.val().trim().length<1&&t.val("00:00");n.trigger("change")}a=n(f.options.eventEditor.dialogTemplate).addClass("asc-dialog").addClass("fc-shadow").popupFrame({anchor:"right,top",direction:"right,down",offset:"-2px,0",arrow:"left",arrowPosition:"50%",showArrow:!1});a.find(".buttons .edit-btn").on("click",function(){st.call(v,!1);f.showEventPageViewer(ot,tt,c)});a.find(".buttonGroup span").on("click",function(){r(n(this))});a.find(".buttonGroup span").on("touchstart",function(t){r(n(this));t.preventDefault();a.find(".title input").trigger("click").trigger("focus")});a.find(".buttons .save-btn").on("click",function(){if(!jq(this).hasClass("disable")){if(dt==pt.event){var n=!y.hasClass("hidden");if(n){if(!ei.call(v))return;lt.call(v,n)}}st.call(v,!0)}});a.find(".buttons .close-btn").on("click",function(){st.call(v,!1);f.showEventPageViewer(ot,tt,c)});a.find(".buttons .delete-btn").on("click",function(){ri&&uf.call(v,"addPopupDelSettings",c.repeatRule.Freq==ASC.Api.iCal.Frequency.Never)});a.find(".buttons .unsubs-btn").on("click",function(){ci&&hf.call(v)});a.find(".buttons .view-details").on("click",function(){st.call(v,!1);hi.call(v,!0,!0);f.showEventPageViewer(ot,tt,c)});wu.call(v);tr=new kt(f,a.find(".editor .shared-list"),f.options.sharedList.addLink);tr.setEventsHandlers({context:v,onResize:bi,onChange:gu});a.find(".viewer .reply-buttons .accepted").on("click",function(){jq(this).hasClass("active")||yr(!0)});a.find(".viewer .reply-buttons .tentative").on("click",function(){jq(this).hasClass("active")||yr()});a.find(".viewer .reply-buttons .declined").on("click",function(){jq(this).hasClass("active")||yr(!1)});a.find(".editor .title input").on("keyup",function(){u.validateInput(this,u.validateNonemptyString)});a.find(".editor .all-day input").on("click",ar);a.find(".editor .all-day .label").css("cursor","pointer").on("click",function(){a.find(".editor .all-day .cb").trigger("click");ar.call(v)});var o=a.find(".editor .from-date"),p=a.find(".editor .from-time"),s=a.find(".editor .to-date"),w=a.find(".editor .to-time"),h=a.find(".editor .todo_editor .date"),b=a.find(".editor .todo_editor .time");a.find(".editor .todo_editor .cal-icon").on("click",function(){l.open(f,this,function(n){i(h,n,c.start)},function(n,i){this.close();t(h,b,i)})});a.find(".editor .from.cal-icon").on("click",function(){l.open(f,this,function(n){i(o,n,c.start)},function(n,i){this.close();t(o,p,i);var r=y.find(".from-date"),u=y.find(".from-time");t(r,u,i)})});a.find(".editor .to.cal-icon").on("click",function(){l.open(f,this,function(n){i(s,n,c.end||c.start)},function(n,i){this.close();t(s,w,i)})});a.find(".editor .from-time, .editor .to-time").mask("00:00");a.find(".editor .from-date, .editor .from-time, .editor .to-date, .editor .to-time").on("keyup change",function(t){var i=gi(t);!i||n(t.currentTarget).hasClass("from-time")||n(t.currentTarget).hasClass("to-time")||ir()});a.find(".editor .todo_editor .time").mask("00:00");a.find(".editor .todo_editor .date, .editor .todo_editor .time").on("keyup change",fu);a.find(".editor .calendar select").on("change",function(){for(var r=n(this).val(),i=f.getEventSources(),t=0;t<i.length;++t)if(i[t].objectId==r&&i[t].isTodo!=1){if(a.find(".editor .calendar .bullet").css("background",i[t].backgroundColor),!tt.length)return;tt.is(".fc-event-skin-day")?(tt.css("border-color",i[t].backgroundColor).css("background-color",i[t].backgroundColor).css("color",i[t].textColor),tt.find(".fc-event-skin, .fc-event-skin-day").css("border-color",i[t].backgroundColor).css("background-color",i[t].backgroundColor).css("color",i[t].textColor)):tt.find(".bullet").css("color",i[t].backgroundColor);return}});if(e&&e.length>0)e.on("click",function(){a.is(":visible")&&(st.call(v,!1),lt.call(v,!1))})})(),function(){function e(n,t,i){var r=d(n.val());t.datepicker("setDate",r instanceof Date?r:i)}function u(n,t,i){n.val(ft(i.datepicker("getDate"),k.dateFormat));!t.is(":disabled")&&t.val().trim().length<1&&t.val("00:00");n.trigger("change")}var t,i;y=a.find(".repeat-settings");y.find(".buttons .save-btn").on("click",function(){jq(this).hasClass("disable")||lt.call(v,!0)});y.find(".buttons .cancel-btn, .buttons .close-btn, .header .close-btn").on("click",function(){lt.call(v,!1)});t=y.find(".fc-dwm-selector");y.find(".fc-dwm-selector").on("click",function(i){if(n(this).find(".fc-selector-link").hasClass("not-active"))return!1;r.hideMenus(r.modeMenuDWM);r.modeMenuDWM.popupMenu("open",t);i.stopPropagation()});!r.modeMenuDWM||r.modeMenuDWM.length<1?r.modeMenuDWM=n('<div id="fc_mode_menu_dwm"><\/div>'):(r.modeMenuDWM.popupMenu("close"),r.modeMenuDWM.popupMenu("destroy"));r.modeMenuDWM.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:k.dialogRepeatOn_days,click:function(){t.find(".fc-selector-link").text(k.dialogRepeatOn_days);y.find(".fc-interval-label").text(k.dialogIntervalOption_day);ut=it.day;wi.call(v);y.find(".to-date").val(wt.call(v,ut))}},{label:f.options.repeatSettings.dialogRepeatOn_weeks,click:function(){t.find(".fc-selector-link").text(k.dialogRepeatOn_weeks);y.find(".fc-interval-label").text(k.dialogIntervalOption_week);ut=it.week;wr.call(v);y.find(".to-date").val(wt.call(v,ut))}},{label:f.options.repeatSettings.dialogRepeatOn_months,click:function(){t.find(".fc-selector-link").text(k.dialogRepeatOn_months);y.find(".fc-interval-label").text(k.dialogIntervalOption_month);ut=it.month;br.call(v);y.find(".to-date").val(wt.call(v,ut))}},{label:f.options.repeatSettings.dialogRepeatOn_years,click:function(){t.find(".fc-selector-link").text(k.dialogRepeatOn_years);y.find(".fc-interval-label").text(k.dialogIntervalOption_year);ut=it.year;wi.call(v);y.find(".to-date").val(wt.call(v,ut))}}]});i=y.find(".fc-endrepeat-selector");y.find(".fc-endrepeat-selector").on("click",function(t){if(n(this).find(".fc-selector-link").hasClass("not-active"))return!1;r.hideMenus(r.modeMenuEndRepeat);r.modeMenuEndRepeat.popupMenu("open",i);t.stopPropagation()});!r.modeMenuEndRepeat||r.modeMenuEndRepeat.length<1?r.modeMenuEndRepeat=n('<div id="fc_mode_menu_end_repeat"><\/div>'):(r.modeMenuEndRepeat.popupMenu("close"),r.modeMenuEndRepeat.popupMenu("destroy"));r.modeMenuEndRepeat.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:f.options.repeatSettings.dialogOptionNever,click:function(){i.find(".fc-selector-link").text(k.dialogOptionNever);kr.call(v)}},{label:f.options.repeatSettings.dialogOptionCount,click:function(){i.find(".fc-selector-link").text(k.dialogOptionCount);y.find(".fc-cycle-times").val(3);dr.call(v)}},{label:f.options.repeatSettings.dialogOptionDate,click:function(){i.find(".fc-selector-link").text(k.dialogOptionDate);y.find(".to-date").val(wt.call(v,ut));gr.call(v)}}]});var o=y.find(".from-date"),h=y.find(".from-time"),s=y.find(".to-date"),p=y.find(".to-time");y.find(".from.cal-icon").on("click",function(){if(y.find(".fc-endrepeat-selector").find(".fc-selector-link").hasClass("not-active"))return!1;l.open(f,this,function(n){e(o,n,c.start)},function(n,t){this.close();u(o,h,t);var i=a.find(".from-date"),r=a.find(".from-time");u(i,r,t)})});y.find(".to.cal-icon").on("click",function(){if(y.find(".fc-endrepeat-selector").find(".fc-selector-link").hasClass("not-active"))return!1;l.open(f,this,function(n){e(s,n,c.end||c.start)},function(n,t){this.close();u(s,p,t)})});y.find(".from-date, .to-date, .fc-cycle-times").on("keyup change",ei);y.find(".calendar select").on("change",function(){for(var r=n(this).val(),i=f.getEventSources(),t=0;t<i.length;++t)if(i[t].objectId==r){y.find(".calendar .bullet").css("color",i[t].backgroundColor);return}})}(),function(){function i(n,i){n!=t&&n.length!=0&&n.prop("checked",i)}nt=n(cu.dialogTemplate).addClass("asc-dialog").popupFrame({anchor:"right,top",direction:"right,down",offset:"0,0",showArrow:!1});nt.find(".delete-selector .delete-this-label").on("click",function(){i.call(v,nt.find(".delete-selector .delete-this"),!0)});nt.find(".delete-selector .delete-following-label").on("click",function(){i.call(v,nt.find(".delete-selector .delete-following"),!0)});nt.find(".delete-selector .delete-all-label").on("click",function(){i.call(v,nt.find(".delete-selector .delete-all"),!0)});nt.find(".buttons .save-btn").on("click",function(){if(!jq(this).hasClass("disable")){var n=yt.single;nt.hasClass("single")||(nt.find(".delete-following").is(":checked")?n=yt.allFollowing:nt.find(".delete-all").is(":checked")&&(n=yt.allSeries));ur.call(v,!0);ff.call(v)?(g.selectedDeleteMode=n,ef.call(v)):(su.call(v,n,c._start),st.call(v,!1,!0))}});nt.find(".buttons .cancel-btn, .buttons .close-btn, .header .close-btn").on("click",function(){ur.call(v,!1)})}(),function(){et=n(lu.dialogTemplate).addClass("asc-dialog").popupFrame({anchor:"right,top",direction:"right,down",offset:"0,0",showArrow:!1});et.find(".buttons .send-btn, .buttons .send-everyone-btn").on("click",function(){or.call(v,g.notificationMode.everybody)});et.find(".buttons .send-customs-btn").on("click",function(){or.call(v,g.notificationMode.partially)});et.find(".buttons .dont-send-btn").on("click",function(){or.call(v,g.notificationMode.nobody)});et.find(".header .close-btn").on("click",function(){uu.call(v,!1)})}();fi=null;this.openEvent=function(n,t){if(f.openEventWin={objectId:t.objectId,isTodo:t.isTodo},ASC.CalendarController.Busy)return console.log("ASC.CalendarController.Busy"),!1;ASC.CalendarController.CancelEditDialog();t&&!isNaN(t.objectId)&&t.uniqueId&&!t.isTodo&&Teamlab.getCalendarEventById({},t.objectId,{success:function(i,r){if(r.eventUid===t.uniqueId&&r.mergedIcs){console.info(r);var u=gt(r.mergedIcs);t=jq.extend(t,u||{});si.call(v,"view",n,t)}},error:function(n,t){console.error(t)},max_request_attempts:1});t.isTodo?f.todolist.openTodoEditor(t,n):si.call(v,"view",n,t)};this.addEvent=function(n,i,r,u){var s,e,l,h;if(ASC.CalendarController.Busy)return console.log("ASC.CalendarController.Busy"),!1;if(f.openEventWin={objectId:null,isTodo:!1},ASC.CalendarController.CancelEditDialog(),s=eu(),s==t)return!1;if(a.find(".buttonGroup span.active").removeClass("active"),a.find(".buttonGroup span.event").addClass("active"),dt=pt.event,n!=t){if(e=ou(n,i,r),u&&c){for(e.alert=c.alert,e.allDay=c.allDay,e.location=c.location,e.start=c.start,e.end=c.end,e.title=c.title,l=f.getEventSources(),h=0;h<l.length;++h)c.newSourceId!=t&&c.newSourceId==l[h].objectId&&(e.afretResizeSource=l[h]);e.textColor=s.textColor;e.backgroundColor=s.backgroundColor;e.borderColor=s.borderColor}else e.textColor=s.textColor,e.backgroundColor=s.backgroundColor,e.borderColor=s.borderColor;f.renderEvent(e);si.call(v,"addPopup",f.getView().getEventElement(e),e)}else e=ou(new Date,o(new Date,f.options.defaultEventMinutes),!1),si.call(v,"addDialog",t,e)};this.isVisible=function(){return a.popupFrame("isVisible")};this.closePopupEvent=function(n){n&&(hi.call(v,!0),f.openEventWin={objectId:null,isTodo:!1});this.isVisible()&&!ii&&st.call(v,!1)};this.getEventObj=function(){return c}}function wu(f){function ni(){a.find(".fc-days-week").addClass("hidden").parent().addClass("hidden");a.find(".fc-month-radio").addClass("hidden").parent().addClass("hidden")}function ki(){a.find(".fc-month-radio").addClass("hidden").parent().addClass("hidden");a.find(".fc-days-week").removeClass("hidden").parent().removeClass("hidden")}function di(){a.find(".fc-days-week").addClass("hidden").parent().addClass("hidden");a.find(".fc-month-radio").removeClass("hidden").parent().removeClass("hidden")}function gi(){a.find(".fc-repeat-cycles").addClass("hidden");a.find(".fc-end-date").addClass("hidden")}function nr(){a.find(".fc-end-date").addClass("hidden");a.find(".fc-repeat-cycles").removeClass("hidden");kt.call(c)}function tr(){a.find(".fc-repeat-cycles").addClass("hidden");a.find(".fc-end-date").removeClass("hidden");kt.call(c)}function ct(n){var t=d(a.find(".from-date").val()),i=parseInt(a.find(".fc-interval-selector").find("option:selected").text(),10);switch(n){case tt.day:return f.formatDate(new Date(t.getFullYear(),t.getMonth(),t.getDate()+i+1,0,0,0),p.dateFormat);case tt.week:return f.formatDate(new Date(t.getFullYear(),t.getMonth(),t.getDate()+i*7+1,0,0,0),p.dateFormat);case tt.month:return f.formatDate(new Date(t.getFullYear(),t.getMonth()+i,t.getDate()+1,0,0,0),p.dateFormat);case tt.year:return f.formatDate(new Date(t.getFullYear()+i,t.getMonth(),t.getDate()+1,0,0,0),p.dateFormat)}}function ot(n){if(n!=t)switch(n){case w:return f.options.eventEditor.dialogAlertOption_default;case b:return f.options.eventEditor.dialogAlertOption_never;case 1:return f.options.eventEditor.dialogAlertOption_5minutes;case 2:return f.options.eventEditor.dialogAlertOption_15minutes;case 3:return f.options.eventEditor.dialogAlertOption_30minutes;case 4:return f.options.eventEditor.dialogAlertOption_hour;case 5:return f.options.eventEditor.dialogAlertOption_2hours;case 6:return f.options.eventEditor.dialogAlertOption_day;default:return"Unknown"}}function yt(n){if(n!=t)return n.Equals(ASC.Api.iCal.RecurrenceRule.Never)?f.options.eventEditor.dialogRepeatOption_never:n.Equals(ASC.Api.iCal.RecurrenceRule.EveryDay)?f.options.eventEditor.dialogRepeatOption_day:n.Equals(ASC.Api.iCal.RecurrenceRule.EveryWeek)?f.options.eventEditor.dialogRepeatOption_week:n.Equals(ASC.Api.iCal.RecurrenceRule.EveryMonth)?f.options.eventEditor.dialogRepeatOption_month:n.Equals(ASC.Api.iCal.RecurrenceRule.EveryYear)?f.options.eventEditor.dialogRepeatOption_year:f.options.eventEditor.dialogRepeatOption_custom}function wr(){a.find(".fc-interval-selector").prop("disabled",!0);a.find("input").prop("disabled",!0);a.find(".fc-dwm-selector").find(".fc-selector-link").addClass("not-active");a.find(".fc-endrepeat-selector").find(".fc-selector-link").addClass("not-active")}function br(){a.find(".fc-interval-selector").prop("disabled",!1);a.find("input").prop("disabled",!1);a.find(".fc-dwm-selector").find(".fc-selector-link").removeClass("not-active");a.find(".fc-endrepeat-selector").find(".fc-selector-link").removeClass("not-active")}function kr(){var i=o.find(".fc-view-repeat"),t;o.find(".fc-view-repeat").on("click",function(n){r.hideMenus(r.modeMenuRepeatEventPage);r.modeMenuRepeatEventPage.popupMenu("open",i);n.stopPropagation()});!r.modeMenuRepeatEventPage||r.modeMenuRepeatEventPage.length<1?r.modeMenuRepeatEventPage=n('<div id="fc_mode_menu_repeat_eventpage"><\/div>'):(r.modeMenuRepeatEventPage.popupMenu("close"),r.modeMenuRepeatEventPage.popupMenu("destroy"));r.modeMenuRepeatEventPage.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:f.options.eventEditor.dialogRepeatOption_never,click:function(){y=ASC.Api.iCal.RecurrenceRule.Never;i.find(".fc-selector-link").text(yt.call(c,y));pt.call(c,!1);o.find(".repeat-settings").addClass("hidden")}},{label:f.options.eventEditor.dialogRepeatOption_day,click:function(){y=ASC.Api.iCal.RecurrenceRule.EveryDay;i.find(".fc-selector-link").text(yt.call(c,y));pt.call(c,!1);o.find(".repeat-settings").addClass("hidden")}},{label:f.options.eventEditor.dialogRepeatOption_week,click:function(){y=ASC.Api.iCal.RecurrenceRule.EveryWeek;i.find(".fc-selector-link").text(yt.call(c,y));pt.call(c,!1);o.find(".repeat-settings").addClass("hidden")}},{label:f.options.eventEditor.dialogRepeatOption_month,click:function(){y=ASC.Api.iCal.RecurrenceRule.EveryMonth;i.find(".fc-selector-link").text(yt.call(c,y));pt.call(c,!1);o.find(".repeat-settings").addClass("hidden")}},{label:f.options.eventEditor.dialogRepeatOption_year,click:function(){y=ASC.Api.iCal.RecurrenceRule.EveryYear;i.find(".fc-selector-link").text(yt.call(c,y));pt.call(c,!1);o.find(".repeat-settings").addClass("hidden")}},{label:f.options.eventEditor.dialogRepeatOption_custom,click:function(){i.find(".fc-selector-link").text(f.options.eventEditor.dialogRepeatOption_custom);rr.call(c);o.find(".repeat-settings").removeClass("hidden")}}]});t=o.find(".fc-view-alert");o.find(".fc-view-alert").on("click",function(n){r.hideMenus(r.modeMenuAlertEventPage);r.modeMenuAlertEventPage.popupMenu("open",t);n.stopPropagation()});!r.modeMenuAlertEventPage||r.modeMenuAlertEventPage.length<1?r.modeMenuAlertEventPage=n('<div id="fc_mode_menu_alert_eventpage"><\/div>'):(r.modeMenuAlertEventPage.popupMenu("close"),r.modeMenuAlertEventPage.popupMenu("destroy"));r.modeMenuAlertEventPage.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:f.options.eventEditor.dialogAlertOption_default,click:function(){nt=w;t.find(".fc-selector-link").text(ot.call(c,nt))}},{label:f.options.eventEditor.dialogAlertOption_never,click:function(){nt=b;t.find(".fc-selector-link").text(ot.call(c,nt))}},{label:f.options.eventEditor.dialogAlertOption_5minutes,click:function(){nt=1;t.find(".fc-selector-link").text(ot.call(c,nt))}},{label:f.options.eventEditor.dialogAlertOption_15minutes,click:function(){nt=2;t.find(".fc-selector-link").text(ot.call(c,nt))}},{label:f.options.eventEditor.dialogAlertOption_30minutes,click:function(){nt=3;t.find(".fc-selector-link").text(ot.call(c,nt))}},{label:f.options.eventEditor.dialogAlertOption_hour,click:function(){nt=4;t.find(".fc-selector-link").text(ot.call(c,nt))}},{label:f.options.eventEditor.dialogAlertOption_2hours,click:function(){nt=5;t.find(".fc-selector-link").text(ot.call(c,nt))}},{label:f.options.eventEditor.dialogAlertOption_day,click:function(){nt=6;t.find(".fc-selector-link").text(ot.call(c,nt))}}]})}function fi(n,i,r){f.trigger("getPermissions",c,{type:pi,objectId:r.objectId,permissions:r.permissions},function(u){u.result&&(r.permissions=u.permissions,u.isShared!=t&&(r.isShared=u.isShared));dr(n,i,r)})}function dr(n,i,r){o.find(".repeat-settings").addClass("hidden");var s=h.eventMaxTitleLength,f=o.find(".editor .title input, .editor .location input");if(f.length>0)f.on("keyup",function(){f.val().length>s&&f.val(f.val().substr(0,s))});e=r;e.sourceId=e.sourceId||(e.source?e.source.objectId:t);y=e.repeatRule;nt=e.alert.type;bi=e.source==t||e.source&&!e.source.isSubscription;vt=u.objectIsEditable(e)||u.objectIsEditable(e.source)||e.source&&!e.source.isSubscription;et=e.source==t||vt;gt=e&&e.canUnsubscribe&&e.source&&e.source.isSubscription;et?o.find(".buttons").addClass("editable"):o.find(".buttons").removeClass("editable");vt?o.find(".buttons").addClass("erasable"):o.find(".buttons").removeClass("erasable");et||vt?o.find(".buttons").removeClass("readonly"):o.find(".buttons").addClass("readonly");gt?o.find(".buttons").addClass("shared"):o.find(".buttons").removeClass("shared");ui.call(c);o.find(".viewer .repeat-settings").remove();n=="edit"?(o.find(".event-header span").text(e.objectId?window.g_fcOptions.eventEditor.dialogHeader_editEvent:window.g_fcOptions.eventEditor.dialogHeader_createEvent),o.find(".event-editor").addClass("edit-popup"),br.call(c)):(o.find(".event-header span").text(window.g_fcOptions.eventEditor.dialogHeader_viewEvent),o.find(".event-editor").removeClass("edit-popup"),wr.call(c),o.find(".editor .repeat-settings").clone().insertAfter(o.find(".viewer .repeat-alert")));jq("#asc_calendar").hide();jq("#asc_event").show();o.find(".editor .title input").trigger("focus").trigger("select")}function gr(t,i){var u,r,f;if(t<=i){for(u="",r=1;r<i;r++)u+="<option"+(t==r?" selected":"")+" value='"+r+"'>"+r+"<\/option>";f=n(u);a.find(".fc-interval-selector").html(f);a.find(".fc-interval-selector").on("change",function(){a.find(".to-date").val(ct.call(c,it))})}}function nu(t){for(var o,s,f,l,e="",u,h=[],c=[],r=0;r<p.dayNamesShort.length;r++)o={index:r,name:p.dayNamesShort[r]},r<g_fcOptions.firstDay?h.push(o):c.push(o);for(u=c.concat(h),r=0;r<u.length;r++){for(s=!1,f=0;f<t.length;f++)if(u[r].index==t[f]){s=!0;break}e+="<div class='checkbox-day'><input class='repeat-day-"+u[r].index+"' type='checkbox' "+(s==!0?"checked":"")+"><div>"+i(u[r].name)+"<\/div><\/div>"}e+="<div class='clear'><\/div>";l=n(e);a.find(".fc-days-week").html(l)}function tu(){var n,t,i;if(indexArr=[],a.find(".fc-days-week.hidden").length==0)for(n=0;n<p.dayNamesShort.length;n++)t=".repeat-day-"+n,i=a.find(t).is(":checked"),i==!0&&indexArr.push(n);return indexArr}function ir(n){switch(n){case 0:return ASC.Api.iCal.DayOfWeek.Sunday;case 1:return ASC.Api.iCal.DayOfWeek.Monday;case 2:return ASC.Api.iCal.DayOfWeek.Tuesday;case 3:return ASC.Api.iCal.DayOfWeek.Wednesday;case 4:return ASC.Api.iCal.DayOfWeek.Thursday;case 5:return ASC.Api.iCal.DayOfWeek.Friday;case 6:return ASC.Api.iCal.DayOfWeek.Saturday}}function rr(){var v=o.find(".editor .from-date"),k,e,s;a.find(".from-date").val(v.val());kt.call(c);var r=d(v.val()),nt=t,g=32-new Date(r.getFullYear(),r.getMonth(),32).getDate(),h=r.getDay(),u=r.getDate(),i=Math.floor((u-1)/7),w=i+Math.floor((g-u)/7),b=f.options.repeatSettings.dayNames[h],l="";switch(i){case 0:case 1:case 2:case 4:l=p.dayAliasNames[i];break;case 3:l=i!=w?p.dayAliasNames[i]:p.dayAliasNames[i+1]}k=n("<div><div style='margin-bottom: 0.5em;'><input class='only-day' type='radio' name='day-radio' value='"+u+"' />&nbsp;<span class='only-day-label'>"+p.dialogEachLabel+" "+u+" "+p.dialogIntervalOption_day+"<\/span><\/div><input class='each-day' type='radio' name='day-radio' value='"+b+"'/>&nbsp;<span class='each-day-label'>"+p.dialogAliasLabel+" "+l+" "+b+"<\/span><\/div>");a.find(".fc-month-radio").html(k);a.find(".only-day").prop("checked",!0);a.find(".only-day-label").on("click",function(){a.find(".only-day").trigger("click")});a.find(".each-day-label").on("click",function(){a.find(".each-day").trigger("click")});at=t;a.find(".each-day").on("click",function(){at=ir.call(c,h);var n=0;switch(i){case 0:case 1:case 2:n=i+1;break;case 3:n=-2;break;case 4:n=-1}i==w&&(n=-1);at.Order=n});a.find(".only-day").on("click",function(){at=t});for(gr.call(this,y.Interval,31),a.find(".fc-cycle-times").val(y.Count>0?y.Count:3),e=[],s=0;s<y.ByDay.length;s++)e.push(p.dayIndexResponse[y.ByDay[s].Id]);nu.call(this,e.length?e:[h]);y.Freq==ASC.Api.iCal.Frequency.Never||y.Freq==ASC.Api.iCal.Frequency.Daily?(ni.call(c),it=tt.day,a.find(".fc-dwm-selector").find(".fc-selector-link").text(p.dialogRepeatOn_days),a.find(".fc-interval-label").text(p.dialogIntervalOption_day)):y.Freq==ASC.Api.iCal.Frequency.Weekly?(ki.call(c),it=tt.week,a.find(".fc-dwm-selector").find(".fc-selector-link").text(p.dialogRepeatOn_weeks),a.find(".fc-interval-label").text(p.dialogIntervalOption_week)):y.Freq==ASC.Api.iCal.Frequency.Monthly?(di.call(c),it=tt.month,a.find(".fc-dwm-selector").find(".fc-selector-link").text(p.dialogRepeatOn_months),a.find(".fc-interval-label").text(p.dialogIntervalOption_month),y.ByDay.length==1&&y.ByDay[0].Order!=0?(a.find(".only-day").prop("checked",!1),a.find(".each-day").prop("checked",!0).trigger("click")):(a.find(".each-day").prop("checked",!1),a.find(".only-day").prop("checked",!0))):y.Freq==ASC.Api.iCal.Frequency.Yearly&&(ni.call(c),it=tt.year,a.find(".fc-dwm-selector").find(".fc-selector-link").text(p.dialogRepeatOn_years),a.find(".fc-interval-label").text(p.dialogIntervalOption_year));a.find(".to-date").val(y.Until?f.formatDate(y.Until,p.dateFormat):ct.call(c,it));y.Until?(tr.call(c),a.find(".fc-endrepeat-selector").find(".fc-selector-link").text(p.dialogOptionDate)):y.Count>0?(nr.call(c),a.find(".fc-endrepeat-selector").find(".fc-selector-link").text(p.dialogOptionCount)):(gi.call(c),a.find(".fc-endrepeat-selector").find(".fc-selector-link").text(p.dialogOptionNever))}function iu(t){g.popupFrame("close");t?g.addClass("single"):g.removeClass("single");g.find("input[type=radio]:first").prop("checked",!0);ft.hide();g.popupFrame("open",{pageX:"center",pageY:"center"});g.addClass("add-popup");g.addClass("fc-shadow");g.css("position","fixed");n(document).on("keyup",oi);g.popupFrame("isVisible")?ft.show():ft.hide()}function st(n,i){if(n){if(!et||!1==ui.call(c,!0))return;vr.call(c);return}e.source==t&&e._id!=t&&f.removeEvents(e._id);e.source==t||n||i||vr.call(c,!0);si.call(c)}function pt(n){n&&et&&uu.call(c)}function ei(t){if(t){if(!et)return;or.call(c);return}n(document).off("keyup",oi);or.call(c)}function oi(n){n.which==27&&ei.call(c,!1)}function ur(n){var t,s,o,r,f,u,i,h,l;if((v.notificationUsers.newGuests=[],v.notificationUsers.updatedGuests=[],v.notificationUsers.removedGuests=[],v.selectedViewMode=v.viewMode.none,v.selectedNotificationMode=v.notificationMode.nobody,e.status==2||e.source&&e.source.isSubscription)||(t=jq.extend({},e),!n&&(s=ui.call(c,!0),!s))||(o=!1,r=e.organizer?e.organizer[3].replace(new RegExp("mailto:","ig"),"").toLowerCase():"",jq.each(ASC.Mail.Accounts,function(n,t){return t.enabled&&r==t.email.toLowerCase()?(o=!0,!1):!0}),!o))return v.selectedViewMode;if(n)return f=[],jq.each(e.attendees||[],function(n,t){var i=t[3].replace(new RegExp("mailto:","ig"),"");i.toLowerCase()!=r&&f.push(i)}),f.length&&(v.selectedViewMode=v.viewMode.deleteEvent,v.notificationUsers.removedGuests=f),v.selectedViewMode;if(u=[],jq.each(t.attendees||[],function(n,t){var i=t[3].replace(new RegExp("mailto:","ig"),"");i.toLowerCase()!=r&&u.push(i)}),i=[],jq.each(e.attendees||[],function(n,t){var u=t[3].replace(new RegExp("mailto:","ig"),"");u.toLowerCase()!=r&&i.push(u)}),u.length==0&&i.length==0)return v.selectedViewMode;if(!t.objectId)return i.length&&(v.selectedViewMode=v.viewMode.addEvent,v.notificationUsers.newGuests=i),v.selectedViewMode;if(h=t.attachments||[],l=e.attachments||[],h.length==0&&l.length==0)return v.selectedViewMode;var a=t.organizer?t.organizer[3].replace(new RegExp("mailto:","ig"),"").toLowerCase():"",y=a&&a!=r,p=t.start?t.start.getTime():null,w=e.start?e.start.getTime():null,b=t.end?t.end.getTime():null,k=e.end?e.end.getTime():null;return(y||t.title!=e.title||t.location!=e.location||t.description!=e.description||p!=w||b!=k||t.allDay!=e.allDay||t.sourceId!=e.newSourceId||t.repeatRule.ToiCalString()!=e.repeatRule.ToiCalString()||t.attachments!=e.attachments)&&(v.selectedViewMode=v.viewMode.updateEvent),jq.each(i,function(n,t){jq.inArray(t,u)<0?v.notificationUsers.newGuests.push(t):v.notificationUsers.updatedGuests.push(t)}),v.notificationUsers.removedGuests=jq.grep(u,function(n){return jq.inArray(n,i)<0}),(v.notificationUsers.newGuests.length||v.notificationUsers.removedGuests.length)&&(v.selectedViewMode=v.viewMode.updateGuests),v.selectedViewMode}function fr(){switch(v.selectedViewMode){case v.viewMode.addEvent:k.find(".title").text(f.options.confirmPopup.dialogAddEventHeader);k.find(".body").text(f.options.confirmPopup.dialogAddEventBody);k.find(".send-btn").show();k.find(".send-customs-btn, .send-everyone-btn").hide();break;case v.viewMode.updateEvent:k.find(".title").text(f.options.confirmPopup.dialogUpdateEventHeader);k.find(".body").text(f.options.confirmPopup.dialogUpdateEventBody);k.find(".send-btn").show();k.find(".send-customs-btn, .send-everyone-btn").hide();break;case v.viewMode.updateGuests:k.find(".title").text(f.options.confirmPopup.dialogUpdateEventHeader);k.find(".body").text(f.options.confirmPopup.dialogUpdateGuestsBody);k.find(".send-btn").hide();k.find(".dont-send-btn").hide();k.find(".send-customs-btn, .send-everyone-btn").show();break;case v.viewMode.deleteEvent:k.find(".title").text(f.options.confirmPopup.dialogDeleteEventHeader);k.find(".body").text(f.options.confirmPopup.dialogDeleteEventBody);k.find(".send-btn").show();k.find(".send-customs-btn, .send-everyone-btn").hide()}g.popupFrame("close");n(document).off("keyup",oi);k.popupFrame("close");ft.hide();k.popupFrame("open",{pageX:"center",pageY:"center"});k.css("position","fixed");k.popupFrame("isVisible")?ft.show():ft.hide()}function er(){k.popupFrame("close");ft.hide()}function dt(n){v.selectedNotificationMode=n;v.selectedViewMode==v.viewMode.deleteEvent?(ar.call(c,v.selectedDeleteMode,e._start),st.call(c,!1,!0)):st.call(c,!0);er.call(c)}function lt(n,t,i,r){var u=[],e=null;switch(i){case v.notificationType.request:switch(v.selectedNotificationMode){case v.notificationMode.everybody:case v.notificationMode.partially:u=v.notificationUsers.newGuests;e=ASC.Mail.Utility.SendCalendarRequest}break;case v.notificationType.update:switch(v.selectedNotificationMode){case v.notificationMode.everybody:u=v.notificationUsers.updatedGuests;e=ASC.Mail.Utility.SendCalendarUpdate}break;case v.notificationType.cancel:switch(v.selectedNotificationMode){case v.notificationMode.everybody:case v.notificationMode.partially:u=v.notificationUsers.removedGuests;e=ASC.Mail.Utility.SendCalendarCancel}}u.length&&e?(ASC.CalendarController.Busy=!0,window.LoadingBanner.displayLoading(),e.call(this,n,t,u).done(function(){console.log(f.options.confirmPopup.dialogSuccessToastText,arguments);r&&r()}).fail(function(){toastr.error(f.options.confirmPopup.dialogErrorToastText);console.error(f.options.confirmPopup.dialogErrorToastText,arguments)}).always(function(){ASC.CalendarController.Busy=!1;window.LoadingBanner.hideLoading()})):r&&r()}function ru(n,t){ut.sendReply&&ut.email&&ut.decision&&(ASC.CalendarController.Busy=!0,window.LoadingBanner.displayLoading(),ASC.Mail.Utility.SendCalendarReply(n,t,ut.email,ut.decision).done(function(){console.log(f.options.confirmPopup.dialogSuccessToastText,arguments)}).fail(function(){toastr.error(f.options.confirmPopup.dialogErrorToastText);console.error(f.options.confirmPopup.dialogErrorToastText,arguments)}).always(function(){ASC.CalendarController.Busy=!1;window.LoadingBanner.hideLoading()}))}function si(){window.toastr.remove();jq("#asc_event").hide();jq("#asc_calendar").show();f.updateSize();ft.hide()}function ti(n){n?o.find(".buttons .save-btn").addClass("disable"):o.find(".buttons .save-btn").removeClass("disable")}function or(){g.popupFrame("close");ft.hide()}function ii(n,t,i){var s=n.val(),h=t.val(),c=s.search(/\S/)<0,e=h.search(/\S/)<0,r,f,o;return c&&e?(o=-1,r=null,f=null):(r=u.validateDateString(s),f=u.validateTimeString(h),o=r===null||!e&&f===null?0:1),i.date={isEmpty:c,isValid:r!==null,value:r},i.time={isEmpty:e,isValid:f!==null,value:f},o}function ri(i){var p=o.find(".editor .all-day input").is(":checked"),h={from:o.find(".editor .from-date"),from_t:o.find(".editor .from-time"),to:o.find(".editor .to-date"),to_t:o.find(".editor .to-time")},u={},a=ii(h.from,h.from_t,u),r={},v=ii(h.to,h.to_t,r),w,b,k,d,g,y,nt,tt,l,f,it,rt;return u.dateTime=a==1?s(u.date.value+"T"+u.time.value):null,r.dateTime=v==1?s(r.date.value+"T"+r.time.value):null,!p&&a==1&&v==1&&(y=r.dateTime-u.dateTime>0)||p&&a==1&&v==-1||p&&a==1&&v==1&&(y=r.dateTime-u.dateTime>=0)?(g=!0,w=b=k=d=""):(g=!1,w=u.date.isValid?"":"#cc3300",b=u.time.isValid?"":"#cc3300",k=r.date.isValid&&y?"":"#cc3300",d=r.time.isValid&&y?"":"#cc3300"),h.from.css("color","").css("border-color",w),h.from_t.css("color","").css("border-color",b),h.to.css("color","").css("border-color",k),h.to_t.css("color","").css("border-color",d),(n(this).hasClass("from-time")||n(this).hasClass("from-date"))&&(nt=new Date(Date.parse(e._start?e._start:e.start)),tt=new Date(Date.parse(u.dateTime)),wt!=null&&(nt=wt),l=tt.getTime()-nt.getTime(),l!=NaN&&l!=0&&(f=new Date,f.setTime(Date.parse(r.dateTime)+l),f!="Invalid Date"&&(r.dateTime.setTime(Date.parse(r.dateTime)+l),wt=tt,n(this).hasClass("from-time")?(it=(r.dateTime.getHours()<10?"0"+r.dateTime.getHours():r.dateTime.getHours())+":"+(r.dateTime.getMinutes()<10?"0"+r.dateTime.getMinutes():r.dateTime.getMinutes()),r.time.value=it,n("input.to-time").val(it)):n(this).hasClass("from-date")&&(rt=f.getFullYear()+"-"+(f.getMonth()+1<10?"0"+(f.getMonth()+1):f.getMonth()+1)+"-"+(f.getDate()<10?"0"+f.getDate():f.getDate()),r.date.value=rt,n("input.to-date")[0].value=rt),ri.call(c)))),i!=t&&(i.fromDate=u,i.toDate=r),g}function kt(n){var f=!0,l=o.find(".editor .all-day input").is(":checked"),i={from:a.find(".from-date"),from_t:a.find(".from-time"),to:a.find(".to-date"),to_t:a.find(".to-time"),cycles:a.find(".fc-cycle-times")},v,y,p,w,c,b,k;if(!a.find(".fc-end-date").hasClass("hidden")){var r={},e=ii(i.from,i.from_t,r),u={},h=ii(i.to,i.to_t,u);r.dateTime=e==1?s(r.date.value+"T"+r.time.value):null;u.dateTime=h==1?s(u.date.value+"T"+u.time.value):null;!l&&e==1&&h==1&&(c=u.dateTime-r.dateTime>0)||l&&e==1&&h==-1||l&&e==1&&h==1&&(c=u.dateTime-r.dateTime>=0)?(f=!0,v=y=p=w=""):(f=!1,v=r.date.isValid?"":"#cc3300",y=r.time.isValid?"":"#cc3300",p=u.date.isValid&&c?"":"#cc3300",w=u.time.isValid&&c?"":"#cc3300");i.from.css("color","").css("border-color",v);i.from_t.css("color","").css("border-color",y);i.to.css("color","").css("border-color",p);i.to_t.css("color","").css("border-color",w);n!=t&&(n.fromDate=r,n.toDate=u)}return a.find(".fc-repeat-cycles").hasClass("hidden")||(b="",f=!0,k=i.cycles.val().match("^[0-9]+$"),i.cycles.find(".hidden").length!=0||k||(f=!1,b=!f||f&&i.cycles.val()<0?"#cc3300":""),i.cycles.css("color","").css("border-color",b)),f}function hi(){var i=o.find(".editor .all-day input").is(":checked"),n={from:o.find(".editor .from-date"),from_t:o.find(".editor .from-time"),to:o.find(".editor .to-date"),to_t:o.find(".editor .to-time")},t;i?(n.from_t.val("").prop("disabled",!0),n.to_t.val("").prop("disabled",!0)):(t=new Date(e.start.getFullYear(),e.start.getMonth(),e.start.getDate(),e.start.getHours(),e.start.getMinutes()+30),n.from.val()||n.from.val(rt(e.start,f.options.eventEditor.dateFormat)),n.from_t.val(rt(e.start,f.options.eventEditor.timeFormat)).prop("disabled",!1),e.end==e.start&&(e.end=new Date(e.end.getFullYear(),e.end.getMonth(),e.end.getDate(),e.end.getHours(),e.end.getMinutes()+30)),n.to_t.val(e.end instanceof Date?rt(e.end,f.options.eventEditor.timeFormat):rt(t,f.options.eventEditor.timeFormat)).prop("disabled",!1),n.to.val()||n.to.val(e.end instanceof Date?rt(e.end,f.options.eventEditor.dateFormat):rt(t,f.options.eventEditor.dateFormat)));ri()}function uu(){var i,r,n,u;y&&(y=t);i={from:a.find(".from-date"),to:a.find(".to-date"),interval:a.find(".fc-interval-selector"),cycles:a.find(".fc-cycle-times")};y=ASC.Api.iCal.RecurrenceRule.EveryDay;switch(it){case tt.day:y=ASC.Api.iCal.ParseRRuleFromString("FREQ=DAILY");break;case tt.week:y=ASC.Api.iCal.ParseRRuleFromString("FREQ=WEEKLY");break;case tt.month:y=ASC.Api.iCal.ParseRRuleFromString("FREQ=MONTHLY");break;case tt.year:y=ASC.Api.iCal.ParseRRuleFromString("FREQ=YEARLY")}for(y.Interval=i.interval.find("option:selected").text(),y.Count=a.find(".fc-repeat-cycles.hidden").length?y.Count:i.cycles.val(),r=tu.call(c),n=0;n<r.length;n++)y.ByDay.push(ir.call(this,r[n]));if(a.find(".fc-month-radio.hidden").length==0&&at!=t&&y.ByDay.push(at),a.find(".fc-end-date.hidden").length==0){if(u={},!kt(u))return!1;y.Until=u.toDate.dateTime}return y!=t}function ui(n){var r=f.getEventSources(),i=u.objectIsValid(e.source),s=i&&(e.source.canAlertModify!=t&&e.source.canAlertModify||e.source.canAlertModify==t)||!i,h={viewer:{title:o.find(".viewer .title .text"),location:o.find(".viewer .location .text"),attendees:o.find(".viewer .attendees-user-list"),owner:o.find(".viewer .owner .name"),allday:o.find(".viewer .all-day"),from:o.find(".viewer .from-date"),from_t:o.find(".viewer .from-time"),to:o.find(".viewer .to-date"),to_t:o.find(".viewer .to-time"),repeat:o.find(".viewer .repeat"),alert:o.find(".viewer .alert"),calendar:o.find(".viewer .calendar .name"),calendar_b:o.find(".viewer .calendar .bullet"),users:o.find(".viewer .shared-user-list"),description:o.find(".viewer .description .text"),attachments:o.find(".viewer .attachments tbody")},editor:{replybuttons:o.find(".reply-buttons"),title:o.find(".editor .title input"),location:o.find(".editor .location input"),owner:o.find(".editor .owner .name"),ownerSelector:o.find(".editor .owner select"),attendees:o.find(".editor .attendees input"),attendeesInputBtn:o.find(".editor .attendees .btn-container .button"),attendeesInputContainer:o.find(".editor .attendees .input-container"),attendeesList:o.find(".editor .attendees .attendees-user-list"),attendeesNoAccount:o.find(".editor .attendees .attendees-noaccount"),attendeesHelpSwitcher:o.find("#attendeesHelpSwitcher"),attachments:o.find(".editor .attachLink"),attachmentsHelpSwitcher:o.find("#attachmentsHelpSwitcher"),attachmentsList:o.find(".editor .attachments-list"),allday:o.find(".editor .all-day input"),from:o.find(".editor .from-date"),from_t:o.find(".editor .from-time"),to:o.find(".editor .to-date"),to_t:o.find(".editor .to-time"),repeat:o.find(".editor .fc-view-repeat .fc-selector-link"),alert:o.find(".editor .fc-view-alert .fc-selector-link"),calendar:o.find(".editor .calendar select"),calendar_b:o.find(".editor .calendar .bullet"),users:o.find(".editor .addUserLink"),usersList:o.find(".editor .shared-user-list"),description:CKEDITOR.instances.ckEditor,sent_invitations:o.find(".editor .sent-invitations input")},infoText:o.find(".info-text")};return n?fu.call(c,h,r,i,s):eu.call(c,h,r,i,s)}function fu(t,i,r,o){var c,w,k,b;if(!et||!1==u.validateInput(t.editor.title,u.validateNonemptyString)||(c={},!ri(c)))return!1;e.title=t.editor.title.val().trim();e.title=e.title.substr(0,Math.min(f.options.eventMaxTitleLength,e.title.length));e.location=t.editor.location.val().trim();e.description=DOMPurify.sanitize(t.editor.description.getData().replace(/\n|\t/g,""),{ADD_ATTR:["target"]});e.allDay=t.editor.allday.is(":checked");e.start=c.fromDate.dateTime;e.end=c.toDate.dateTime;o&&(e.repeatRule=y,e.alert.type=nt);e.newSourceId=t.editor.calendar.val();!e.sourceId&&ci(e.newSourceId).isSubscription?e.attendees=[]:(t.editor.attendeesInputBtn.trigger("click"),e.attendees=t.editor.attendees.AttendeesSelector("get"));var l=null,a=null,v=t.editor.replybuttons.find(".reply-radio:checked").attr("data-value");jq(e.attendees).each(function(n,t){var r=t[3].replace(new RegExp("mailto:","ig"),""),u=t[1].partstat.toUpperCase(),i=!0;return jq(ASC.Mail.Accounts).each(function(n,t){return t.enabled&&r.toLowerCase()==t.email.toLowerCase()?(i=!1,v&&v!=u&&(a=t.email,l=v),i):i}),i});ut.sendReply&&a&&l?(ut.email=a,ut.decision=l):(ut.email=null,ut.decision=null,ut.sendReply=!1);e.attachments=t.editor.attachments.FileUpload("get");e.permissions=t.editor.users.ShareUsersSelector("get");var s=new ICAL.Property("organizer"),p=t.editor.ownerSelector.find("option:selected"),h=p.length?{email:p.attr("value"),name:Encoder.htmlDecode(p.attr("data-name"))}:ASC.Mail.DefaultAccount;return e.sourceId?(w=!1,e.organizer&&e.organizer[3]&&(k=e.organizer[3].replace(new RegExp("mailto:","ig"),"").toLowerCase(),jq(ASC.Mail.Accounts).each(function(n,t){return k==t.email.toLowerCase()?(w=!0,!1):!0})),w&&h&&(s.setParameter("cn",h.name),s.setValue("mailto:"+h.email),e.organizer=s.jCal)):h&&(s.setParameter("cn",h.name),s.setValue("mailto:"+h.email),e.organizer=s.jCal),n.each(i,function(){return this.objectId==e.newSourceId?(b=this,!1):!0}),b&&(e.newTimeZone=n.extend({},b.timeZone)),delete e.textColor,delete e.backgroundColor,delete e.borderColor,f.normalizeEvent(e),!0}function eu(r,u,s,h){var y,kt,lt,tt,d,at,dt,gt,it,ft,p,st,k,v,vt,pt;r.editor.title.css("color","").css("border-color","");r.editor.title.val(Encoder.htmlDecode(e.title)||"");r.viewer.title.text(Encoder.htmlDecode(e.title)||"");r.editor.attendeesInputContainer.find("input")[0].value="";r.editor.attachmentsList.find("tbody").empty();r.editor.sent_invitations.prop("checked",!0);e.status==2?r.infoText.show():r.infoText.hide();r.editor.location.val(e.location||"");r.viewer.location.text(e.location||"");e.location?r.viewer.location.parent().show():r.viewer.location.parent().hide();y=e.organizer&&e.organizer.length>1?e.organizer[1].cn:"";y=y?y:e.owner?e.owner.name:"";y?(r.editor.owner.html(i(y)),r.viewer.owner.html(i(y)),o.find(".owner").show()):(r.editor.owner.html(""),r.viewer.owner.html(""),o.find(".owner").hide());var wt=!e.sourceId,bt=ASC.Mail.Accounts.length>0,l=!1,ht=!1,g=!1,nt=!1,ct=!1;if(wt?(l=!0,bt?(ht=!0,g=!0,nt=!0,r.editor.ownerSelector.val(ASC.Mail.DefaultAccount.email).trigger("change")):ct=!0):(e.organizer&&e.organizer[3]?(kt=e.organizer[3].replace(new RegExp("mailto:","ig"),"").toLowerCase(),jq(ASC.Mail.Accounts).each(function(n,t){return kt==t.email.toLowerCase()?(l=!0,r.editor.ownerSelector.val(t.email).trigger("change"),!1):!0})):e.owner&&e.owner.objectId===Teamlab.profile.id&&(l=!0),bt?(ht=l,g=l,nt=l):ct=l),ht?(r.editor.ownerSelector.parents(".selector").show(),r.editor.owner.hide()):(r.editor.ownerSelector.parents(".selector").hide(),r.editor.owner.show()),lt=e.attendees||[],et&&lt.length&&(e.source.isSubscription?tt=f.options.confirmPopup.editorInfoTextSubscription:l||(tt=f.options.confirmPopup.editorInfoText),tt&&window.toastr.warning(tt,"",{closeButton:!1,timeOut:"0",extendedTimeOut:"0"})),ASC.Mail.Enabled&&ct?r.editor.attendeesNoAccount.removeClass("display-none"):r.editor.attendeesNoAccount.addClass("display-none"),g?r.editor.attendeesHelpSwitcher.show():r.editor.attendeesHelpSwitcher.hide(),nt?r.editor.attachmentsHelpSwitcher.show():r.editor.attachmentsHelpSwitcher.hide(),r.editor.attendees.AttendeesSelector("set",lt,g),e.attendees&&e.attendees.length?(r.viewer.attendees.empty().parent().show(),d=null,jq.each(e.attendees,function(n,t){var i=t[3].replace(new RegExp("mailto:","ig"),""),u=t[1].partstat.toUpperCase(),f=t[1].role,e=t[1].cn,o={canEdit:!1,status:u,email:i,name:e||"",role:f};jq("#attendeeTemplate").tmpl(o).appendTo(r.viewer.attendees);d||jq(ASC.Mail.Accounts).each(function(n,t){return i.toLowerCase()==t.email.toLowerCase()?(d=u.toLowerCase(),!1):!0})}),r.editor.attendeesList.hasClass("scrollable")?r.viewer.attendees.addClass("scrollable"):r.viewer.attendees.removeClass("scrollable"),r.editor.replybuttons.hide().find(".reply-radio").prop("checked",!1),et&&d&&e.status!=2&&!e.source.isSubscription&&(r.editor.replybuttons.find(".reply-radio."+d).prop("checked",!0),r.editor.replybuttons.show(),ut.sendReply=!0)):(r.viewer.attendees.empty().parent().hide(),r.editor.replybuttons.hide().find(".reply-radio").prop("checked",!1),ut.sendReply=!1),r.editor.users.ShareUsersSelector("set",e.permissions,!0),e.permissions&&e.permissions.users&&e.permissions.users.length?(at=jq.extend(!0,{},e.permissions.data),jq(at.items).each(function(n,t){t.canEdit=!1}),r.viewer.users.empty().parent().show(),jq("#sharingUserTemplate").tmpl(at).appendTo(r.viewer.users),r.editor.usersList.hasClass("scrollable")?r.viewer.users.addClass("scrollable"):r.viewer.users.removeClass("scrollable")):r.viewer.users.empty().parent().hide(),dt=e.attachments||[],r.editor.attachments.FileUpload("set",dt,nt),e.attachments&&e.attachments.length?(r.viewer.attachments.empty().parent().parent().show(),jq.each(e.attachments,function(t,i){var r=n("#attachmentEventViewerTmpl").tmpl(i,{cutFileName:sr,getFileNameWithoutExt:hr,getFileExtension:cr});n("#calendar_event_attachments_view tbody").append(r)}),n("#attachments_clear_btn").show()):(r.viewer.attachments.empty().parent().parent().hide(),n("#attachments_clear_btn").hide()),e.allDay==!0?(r.editor.allday.prop("checked",!0),r.viewer.allday.addClass("yes")):(r.editor.allday.prop("checked",!1),r.viewer.allday.removeClass("yes")),r.editor.from.css("color","").css("border-color",""),r.editor.from_t.css("color","").css("border-color",""),e.start instanceof Date?(r.editor.from.val(rt(e.start,f.options.eventEditor.dateFormat)),r.editor.from_t.val(e.allDay?"":rt(e.start,f.options.eventEditor.timeFormat))):(r.editor.from.val(""),r.editor.from_t.val("")),r.viewer.from.text(r.editor.from.val()),r.viewer.from_t.text(r.editor.from_t.val()),r.editor.to.css("color","").css("border-color",""),r.editor.to_t.css("color","").css("border-color",""),e.end instanceof Date?(r.editor.to.val(rt(e.end,f.options.eventEditor.dateFormat)),r.editor.to_t.val(e.allDay?"":rt(e.end,f.options.eventEditor.timeFormat))):e.allDay&&e.start instanceof Date?r.editor.to.val(rt(e.start,f.options.eventEditor.dateFormat)):(r.editor.to.val(""),r.editor.to_t.val("")),r.viewer.to.text(r.editor.to.val()),r.viewer.to_t.text(r.editor.to_t.val()),e.start instanceof Date?r.viewer.from_t.text(e.allDay?"":rt(e.start,f.options.axisFormat)):r.viewer.from_t.text(""),e.end instanceof Date?r.viewer.to_t.text(e.allDay?"":rt(e.end,f.options.axisFormat)):r.viewer.to_t.text(""),r.viewer.to.text()?r.viewer.to.parent(".wrapper").show():r.viewer.to.parent(".wrapper").hide(),gt=ci(wt?e.newSourceId:null),it=s?e.source:gt,l&&it.isSubscription?o.find(".editor .attendees").hide():r.editor.attendeesInputContainer.hasClass("display-none")&&r.editor.attendeesList.hasClass("display-none")&&r.editor.attendeesNoAccount.hasClass("display-none")?o.find(".editor .attendees").hide():o.find(".editor .attendees").show(),r.editor.repeat.text(function(){return e.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.Never)||e.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.EveryDay)||e.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.EveryWeek)||e.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.EveryMonth)||e.repeatRule.Equals(ASC.Api.iCal.RecurrenceRule.EveryYear)||(rr.call(c),a.removeClass("hidden")),yt.call(c,e.repeatRule)}),r.editor.alert.text(s?ot.call(c,e.alert.type):ot.call(c,w)),h?o.find(".repeat-alert").show():(r.editor.repeat.text(ASC.Api.iCal.RecurrenceRule.Never),r.editor.alert.text(b),o.find(".repeat-alert").hide()),r.viewer.repeat.text(r.editor.repeat.text()),r.viewer.alert.text(r.editor.alert.text()),ft="",bi){for(v=0;v<u.length;++v)u[v].isTodo!=1&&u[v].objectId!=t&&(u[v].isEditable||!u[v].isSubscription)&&(p=i(u[v].title),ft+='<option value="'+i(u[v].objectId)+'" title="'+p+'">&nbsp;&nbsp;&nbsp;&nbsp;'+p+"<\/option>");st=it.objectId;k=it.backgroundColor;r.editor.calendar.prop("disabled",!1)}else st=s?e.source.objectId:-1,k=s?e.source.backgroundColor:f.options.eventBackgroundColor,p=i(s?e.source.title:""),ft='<option value="'+i(st)+'" title="'+p+'">&nbsp;&nbsp;&nbsp;&nbsp;'+p+"<\/option>",r.editor.calendar.prop("disabled",!0),vt=n(r.viewer.calendar[0].parentElement),vt&&(pt=n(vt)[0].parentElement,pt&&n(pt).addClass("readonly"));return r.editor.calendar.html(ft),r.editor.calendar.val(st),r.viewer.calendar.text(s?e.source.title:r.editor.calendar.find("option:selected").text()),k=i(k),r.editor.calendar_b.css("background",k),r.viewer.calendar_b.css("background",k),r.editor.description.setData(e.description||""),r.viewer.description.html(DOMPurify.sanitize(e.description,{ADD_ATTR:["target"]})||""),e.sourceId!="users_birthdays"&&e.description?r.viewer.description.parent().show():r.viewer.description.parent().hide(),e.sourceId!="users_birthdays"&&e.attachments&&e.attachments.length?r.viewer.attachments.parent().parent().show():r.viewer.attachments.parent().parent().hide(),hi.call(c),!0}function ci(n){for(var r,e=f.getEventSources(),t=[],i=0;i<e.length;++i)u.objectIsValid(e[i])&&(u.objectIsEditable(e[i])||!e[i].isSubscription)&&e[i].isTodo!=1&&t.push(e[i]);for(r=0;r<t.length;++r)if(n){if(t[r].objectId==n)return t[r]}else if(!t[r].isHidden)return t[r];return t.length?t[0]:null}function lr(n,t,i){var u,r;return wt=null,u={title:"",description:"",allDay:i,start:n,end:t,repeatRule:ASC.Api.iCal.RecurrenceRule.Never,alert:{type:w},isShared:!1,permissions:{users:[]},attendees:[],attachments:[]},ASC.Mail.DefaultAccount&&(r=new ICAL.Property("organizer"),r.setParameter("cn",ASC.Mail.DefaultAccount.name),r.setValue("mailto:"+ASC.Mail.DefaultAccount.email),u.organizer=r.jCal),u}function ar(i,r){function o(){var u=e._id;f.trigger("editEvent",c,n.extend({action:ai,sourceId:e.source.objectId,type:i,date:r},e),function(n){if(n.result&&(f.removeEvents(u),n.event!=t)){if(!n.event.length){e.repeatRule.Freq!=ASC.Api.iCal.Frequency.Never&&v.selectedDeleteMode!=ht.allSeries&&lt(e.sourceId,e.uniqueId,v.notificationType.cancel,function(){ASC.CalendarController.RemoveEvent(u,ht.allSeries,r)});return}for(var o=f.getEventSources(),i=0;i<n.event.length;)wi(n.event[i],o),i++;f.addEvents(n.event);e.repeatRule.Freq!=ASC.Api.iCal.Frequency.Never&&v.selectedDeleteMode!=ht.allSeries&&(v.notificationUsers.updatedGuests=v.notificationUsers.removedGuests,lt(e.sourceId,e.uniqueId,v.notificationType.update))}})}vt&&u.objectIsValid(e)&&u.objectIsValid(e.source)&&(e.sourceId&&e.uniqueId&&(e.repeatRule.Freq==ASC.Api.iCal.Frequency.Never||v.selectedDeleteMode==ht.allSeries)?lt(e.sourceId,e.uniqueId,v.notificationType.cancel,o):o())}function ou(){if(gt&&u.objectIsValid(e)&&u.objectIsValid(e.source)){var t=e._id;f.trigger("editEvent",c,n.extend({action:vi,sourceId:e.source.objectId},e),function(n){n.result&&(st.call(c,!1),f.removeEvents(t))})}}function wi(n,i){if(n.sourceId==t&&(n.sourceId=n.newSourceId),!n.source&&n.sourceId!=t)for(var r=0;r<i.length;++r)if(i[r].objectId!=t&&i[r].objectId==n.sourceId){n.source=i[r];break}}function vr(t){function i(){f.trigger("editEvent",c,n.extend({action:bt,sourceId:e.source.objectId},e),function(n){var i,t;if((ti(!1),n.result)&&(si.call(c),!(n.event.length<1))){for(i=f.getEventSources(),f.removeEvents(n.event[0].objectId),t=0;t<n.event.length;++t)wi(n.event[t],i);f.addEvents(n.event);lt(n.event[0].sourceId,n.event[0].uniqueId,v.notificationType.request);lt(n.event[0].sourceId,n.event[0].uniqueId,v.notificationType.update);ru(n.event[0].sourceId,n.event[0].uniqueId)}})}if(et){if(t){f.trigger("editEvent",c,n.extend({action:yi,sourceId:e.source.objectId},e),function(){});return}if(e.source)ti(!0),e.sourceId&&e.uniqueId?lt(e.sourceId,e.uniqueId,v.notificationType.cancel,i):i();else{ti(!0);var r=e._id;f.trigger("editEvent",c,n.extend({action:li},e),function(n){var i,t;if((ti(!1),n.result)&&(si.call(c),f.removeEvents(r),!(n.event.length<1))){for(i=f.getEventSources(),f.removeEvents(n.event[0].objectId),t=0;t<n.event.length;++t)wi(n.event[t],i);f.addEvents(n.event);lt(n.event[0].sourceId,n.event[0].uniqueId,v.notificationType.request)}})}}}var c=this,p=f.options.repeatSettings,yr=f.options.deleteSettings,pr=f.options.confirmPopup,tt={day:0,week:1,month:2,year:3},ht={single:0,allFollowing:1,allSeries:2},v={viewMode:{none:0,addEvent:1,updateEvent:2,updateGuests:3,deleteEvent:4},notificationMode:{nobody:0,partially:1,everybody:2},notificationType:{request:1,update:2,cancel:4},notificationUsers:{newGuests:[],removedGuests:[],updatedGuests:[]},selectedViewMode:0,selectedNotificationMode:0,selectedDeleteMode:0},ut={sendReply:!0,email:null,decision:null},o,a,g,k,ft,nt=w,y=ASC.Api.iCal.RecurrenceRule.EveryDay,it=tt.day,at=t,e,et,vt,bi,gt,rt=f.formatDate,su=f.formatDates,wt;(function(){function w(){function u(t,f,e){var o,s,h;if(isNaN(t)&&isNaN(f)&&typeof t=="number"&&typeof f=="number"||t===f)return n;if(typeof t=="function"&&typeof f=="function"||t instanceof Date&&f instanceof Date||t instanceof RegExp&&f instanceof RegExp||t instanceof String&&f instanceof String||t instanceof Number&&f instanceof Number)return t.toString()===f.toString();if(!(t instanceof Object&&f instanceof Object)||t.isPrototypeOf(f)||f.isPrototypeOf(t)||t.constructor!==f.constructor||t.prototype!==f.prototype||i.indexOf(t)>-1||r.indexOf(f)>-1)return n.isCompare=!1,n;for(o in f)f.hasOwnProperty(o)!==t.hasOwnProperty(o)&&o!="newSourceId"&&o!="newTimeZone"?(n.isCompare=!1,e||n.differentsList.push(o)):typeof f[o]!=typeof t[o]&&o!="newSourceId"&&o!="newTimeZone"&&(n.isCompare=!1,e||n.differentsList.push(o));for(o in t)if(f.hasOwnProperty(o)!==t.hasOwnProperty(o)?(n.isCompare=!1,e||n.differentsList.push(o)):typeof f[o]!=typeof t[o]&&(n.isCompare=!1,e||n.differentsList.push(o)),t[o]==null&&f[o]!=null)n.differentsList.push(o);else switch(typeof t[o]){case"object":case"function":i.push(t);r.push(f);o=="attendees"?(s=Object.assign({},n),n={isCompare:!0,differentsList:[]},h=u(t[o],f[o],!0),h.isCompare||(n.isCompare=!1,n.differentsList.push(o)),n.isCompare=n.isCompare?s.isCompare:n.isCompare,n.differentsList=n.differentsList.concat(s.differentsList),h=s=null):u(t[o],f[o])||(n.isCompare=!1,e||n.differentsList.push(o));i.pop();r.pop();break;default:o=="sourceId"?(t[o]!==f.sourceId||t[o]!==f.newSourceId)&&(n.isCompare=!1,e||n.differentsList.push(o)):t[o]!==f[o]&&(n.isCompare=!1,e||n.differentsList.push(o))}return n}var t,f,i,r,n={isCompare:!0,differentsList:[]};if(arguments.length<1)return n;for(t=1,f=arguments.length;t<f;t++)i=[],r=[],u(arguments[0],arguments[t]);return n}function s(n,t,i){var r=d(n.val());t.datepicker("setDate",r instanceof Date?r:i)}function r(n,t,i){n.val(rt(i.datepicker("getDate"),f.options.eventEditor.dateFormat));!t.is(":disabled")&&t.val().trim().length<1&&t.val("00:00");n.trigger("change")}var i;o=jq("#asc_event").empty();jq("#eventPageTemplate").tmpl({maxlength:h.eventMaxTitleLength}).appendTo(o);CKEDITOR.replace("ckEditor",{toolbar:"Calendar",height:"182px"});i=jq("#asc_event .editor .owner select");jq.each(ASC.Mail.Accounts,function(n,t){var r=t.name?Encoder.htmlEncode(t.name):Teamlab.profile.displayName,u=jq("<option><\/option>").attr("value",t.email).attr("data-name",Encoder.htmlDecode(r)).html("{0} &lt;{1}&gt;".format(r,t.email));i.append(u)});i.tlcombobox({align:"left"});ft=o.find(".fc-modal");o.find(".buttons .save-btn").on("click",function(){var i,f,s;if(!jq(this).hasClass("disable")){if(i=!a.hasClass("hidden"),i){if(!kt.call(c))return;pt.call(c,i)}var r=Object.assign({},e),n={},h=o.find(".editor .sent-invitations input").is(":checked"),u=ur.call(c);if(h)if(r.sourceId!=t){if(f=ui.call(c,!0),!f)return;s=Object.assign({},e);e=Object.assign({},r);n=w(r,s);n.isCompare?st.call(c,!0):n.differentsList.length==1&&n.differentsList.indexOf("attendees")!=-1?u?fr.call(c):st.call(c,!0):n.differentsList.length>=1&&(u?dt.call(c,v.notificationMode.everybody):st.call(c,!0))}else u?dt.call(c,v.notificationMode.everybody):st.call(c,!0);else st.call(c,!0)}});o.find(".event-header .header-back-link, .buttons .cancel-btn, .buttons .close-btn").on("click",function(){st.call(c,!1)});o.find(".buttons .delete-btn").on("click",function(){vt&&iu.call(c,e.repeatRule.Freq==ASC.Api.iCal.Frequency.Never)});o.find(".buttons .unsubs-btn").on("click",function(){gt&&ou.call(c)});kr.call(c);o.find(".editor .title input").on("keyup",function(){u.validateInput(this,u.validateNonemptyString)});o.find(".editor .attendees input.textEdit").AttendeesSelector("init",{isInPopup:!1,items:[],container:o.find(".editor .attendees .attendees-user-list"),organizer:o.find(".editor .owner select")});o.find(".editor .addUserLink").ShareUsersSelector("init",{permissions:{data:{actions:[],items:[]},users:[]},container:o.find(".editor .shared-user-list")});o.find(".editor .attachLink").FileUpload("init",{container:o.find(".editor .attachments-list tbody")});o.find(".editor .owner select").on("change",function(){var r=jq(this).val(),n=o.find(".editor .attendees input.textEdit"),t=n.AttendeesSelector("get"),i=!1;jq.each(t,function(n,t){Boolean(t[1]["x-organizer"])&&(t[3]="mailto:"+r,i=!0)});i&&n.AttendeesSelector("set",t)});o.find(".editor .all-day input").on("click",hi);o.find(".editor .all-day .label").css("cursor","pointer").on("click",function(){o.find(".editor .all-day .cb").trigger("click");hi.call(c)});var y=o.find(".editor .from-to .from-date"),b=o.find(".editor .from-to .from-time"),p=o.find(".editor .from-to .to-date"),k=o.find(".editor .from-to .to-time");o.find(".editor .from-to .from.cal-icon").on("click",function(){l.open(f,this,function(n){s(y,n,e.start)},function(n,t){this.close();r(y,b,t);var i=a.find(".from-date"),u=a.find(".from-time");r(i,u,t)})});o.find(".editor .from-to .to.cal-icon").on("click",function(){l.open(f,this,function(n){s(p,n,e.end||e.start)},function(n,t){this.close();r(p,k,t)})});o.find(".editor .from-to .from-time, .editor .from-to .to-time").mask("00:00");o.find(".editor .from-to .from-date, .editor .from-to .from-time, .editor .from-to .to-date, .editor .from-to .to-time").on("keyup change",ri);o.find(".editor .calendar select").on("change",function(){for(var r=n(this).val(),i=f.getEventSources(),t=0;t<i.length;++t)if(i[t].objectId==r&&i[t].isTodo!=1){o.find(".editor .calendar .bullet").css("background",i[t].backgroundColor);i[t].isSubscription?o.find(".editor .attendees").hide():o.find(".editor .attendees .input-container").hasClass("display-none")&&o.find(".editor .attendees .attendees-user-list").hasClass("display-none")&&o.find(".editor .attendees .attendees-noaccount").hasClass("display-none")?o.find(".editor .attendees").hide():o.find(".editor .attendees").show();return}});jq("#attendeesHelpSwitcher").on("click",function(){jq(this).helper({BlockHelperID:"attendeesHelpInfo"})});jq("#attachmentsHelpSwitcher").on("click",function(){jq(this).helper({BlockHelperID:"attachmentsHelpInfo"})});window.onbeforeunload==null&&(window.onbeforeunload=function(){if(jq("#asc_event .event-editor .editor").is(":visible"))return ASC.Resources.Master.ResourceJS.WarningMessageBeforeUnload})})(),function(){function s(n,t,i){var r=d(n.val());t.datepicker("setDate",r instanceof Date?r:i)}function u(n,t,i){n.val(rt(i.datepicker("getDate"),p.dateFormat));!t.is(":disabled")&&t.val().trim().length<1&&t.val("00:00");n.trigger("change")}var t,i;a=o.find(".repeat-settings");t=a.find(".fc-dwm-selector");a.find(".fc-dwm-selector").on("click",function(i){n(this).find(".fc-selector-link").hasClass("not-active")||(r.hideMenus(r.modeMenuDWMEventPage),r.modeMenuDWMEventPage.popupMenu("open",t),i.stopPropagation())});!r.modeMenuDWMEventPage||r.modeMenuDWMEventPage.length<1?r.modeMenuDWMEventPage=n('<div id="fc_mode_menu_dwm_eventpage"><\/div>'):(r.modeMenuDWMEventPage.popupMenu("close"),r.modeMenuDWMEventPage.popupMenu("destroy"));r.modeMenuDWMEventPage.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:p.dialogRepeatOn_days,click:function(){t.find(".fc-selector-link").text(p.dialogRepeatOn_days);a.find(".fc-interval-label").text(p.dialogIntervalOption_day);it=tt.day;ni.call(c);a.find(".to-date").val(ct.call(c,it))}},{label:f.options.repeatSettings.dialogRepeatOn_weeks,click:function(){t.find(".fc-selector-link").text(p.dialogRepeatOn_weeks);a.find(".fc-interval-label").text(p.dialogIntervalOption_week);it=tt.week;ki.call(c);a.find(".to-date").val(ct.call(c,it))}},{label:f.options.repeatSettings.dialogRepeatOn_months,click:function(){t.find(".fc-selector-link").text(p.dialogRepeatOn_months);a.find(".fc-interval-label").text(p.dialogIntervalOption_month);it=tt.month;di.call(c);a.find(".to-date").val(ct.call(c,it))}},{label:f.options.repeatSettings.dialogRepeatOn_years,click:function(){t.find(".fc-selector-link").text(p.dialogRepeatOn_years);a.find(".fc-interval-label").text(p.dialogIntervalOption_year);it=tt.year;ni.call(c);a.find(".to-date").val(ct.call(c,it))}}]});i=a.find(".fc-endrepeat-selector");a.find(".fc-endrepeat-selector").on("click",function(t){if(n(this).find(".fc-selector-link").hasClass("not-active"))return!1;r.hideMenus(r.modeMenuEndRepeatEventPage);r.modeMenuEndRepeatEventPage.popupMenu("open",i);t.stopPropagation()});!r.modeMenuEndRepeatEventPage||r.modeMenuEndRepeatEventPage.length<1?r.modeMenuEndRepeatEventPage=n('<div id="fc_mode_menu_end_reapeat_eventpage"><\/div>'):(r.modeMenuEndRepeatEventPage.popupMenu("close"),r.modeMenuEndRepeatEventPage.popupMenu("destroy"));r.modeMenuEndRepeatEventPage.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",showArrow:!1,closeTimeout:-1,cssClassName:"asc-popupmenu",items:[{label:f.options.repeatSettings.dialogOptionNever,click:function(){i.find(".fc-selector-link").text(p.dialogOptionNever);gi.call(c)}},{label:f.options.repeatSettings.dialogOptionCount,click:function(){i.find(".fc-selector-link").text(p.dialogOptionCount);a.find(".fc-cycle-times").val(3);nr.call(c)}},{label:f.options.repeatSettings.dialogOptionDate,click:function(){i.find(".fc-selector-link").text(p.dialogOptionDate);a.find(".to-date").val(ct.call(c,it));tr.call(c)}}]});var h=a.find(".from-date"),y=a.find(".from-time"),v=a.find(".to-date"),w=a.find(".to-time");a.find(".from.cal-icon").on("click",function(){if(a.find(".fc-endrepeat-selector").find(".fc-selector-link").hasClass("not-active"))return!1;l.open(f,this,function(n){s(h,n,e.start)},function(n,t){this.close();u(h,y,t);var i=o.find(".from-date"),r=o.find(".from-time");u(i,r,t)})});a.find(".to.cal-icon").on("click",function(){if(a.find(".fc-endrepeat-selector").find(".fc-selector-link").hasClass("not-active"))return!1;l.open(f,this,function(n){s(v,n,e.end||e.start)},function(n,t){this.close();u(v,w,t)})});a.find(".from-date, .to-date, .fc-cycle-times").on("keyup change",kt);a.find(".calendar select").on("change",function(){for(var r=n(this).val(),i=f.getEventSources(),t=0;t<i.length;++t)if(i[t].objectId==r&&i[t].isTodo!=1){a.find(".calendar .bullet").css("color",i[t].backgroundColor);return}})}(),function(){function i(n,i){n!=t&&n.length!=0&&n.prop("checked",i)}g=n(yr.dialogTemplate).addClass("asc-dialog").popupFrame({anchor:"right,top",direction:"right,down",offset:"0,0",showArrow:!1});g.find(".delete-selector .delete-this-label").on("click",function(){i.call(c,g.find(".delete-selector .delete-this"),!0)});g.find(".delete-selector .delete-following-label").on("click",function(){i.call(c,g.find(".delete-selector .delete-following"),!0)});g.find(".delete-selector .delete-all-label").on("click",function(){i.call(c,g.find(".delete-selector .delete-all"),!0)});g.find(".buttons .save-btn").on("click",function(){if(!jq(this).hasClass("disable")){var n=ht.single;g.hasClass("single")||(g.find(".delete-following").is(":checked")?n=ht.allFollowing:g.find(".delete-all").is(":checked")&&(n=ht.allSeries));ei.call(c,!0);ur.call(c,!0)?(v.selectedDeleteMode=n,fr.call(c)):(ar.call(c,n,e._start),st.call(c,!1,!0))}});g.find(".buttons .cancel-btn, .buttons .close-btn, .header .close-btn").on("click",function(){ei.call(c,!1)})}(),function(){k=n(pr.dialogTemplate).addClass("asc-dialog").popupFrame({anchor:"right,top",direction:"right,down",offset:"0,0",showArrow:!1});k.find(".buttons .send-btn, .buttons .send-everyone-btn").on("click",function(){dt.call(c,v.notificationMode.everybody)});k.find(".buttons .send-customs-btn").on("click",function(){dt.call(c,v.notificationMode.partially)});k.find(".buttons .dont-send-btn").on("click",function(){dt.call(c,v.notificationMode.nobody)});k.find(".header .close-btn").on("click",function(){er.call(c,!1)})}();wt=null;this.openEvent=function(n,t,i){wt=null;fi.call(c,n?"edit":"view",t,i)};this.addEvent=function(n,i,r){var e=ci(),u,o,s;e!=t&&(n!=t?(u=lr(n,i,r),u.textColor=e.textColor,u.backgroundColor=e.backgroundColor,u.borderColor=e.borderColor,f.renderEvent(u),fi.call(c,"edit",f.getView().getEventElement(u),u)):(o=new Date,s=new Date(o.getFullYear(),o.getMonth(),o.getDate()),u=lr(s,s,!0),fi.call(c,"edit",t,u)))};this.isVisible=function(){return o.is(":visible")}}function bu(i){function et(n,t){return!h||n<h||t>v}function ot(n,t,i){h=function(n){var t=f(n,!0);return t.getDate()!=1&&t.setDate(1),t}(n);v=function(n){var t=f(n,!0),i=t.getMonth(),r=t.getFullYear();return i=t.getDate()==1?i:i<11?i+1:(++r,0),t.setFullYear(r,i,1),t}(t);r=[];var u=++b;p("loadEventSources",e,h,v,function(n){var t,r;if(n.result&&Array.isArray(n.eventSources)){for(o.splice(1,o.length-1),t=0;t<n.eventSources.length;++t)nt(n.eventSources[t]);for(r=o.length,y=r,t=0;t<r;++t)d(o[t],u);e.rerenderCategories(i)}})}function d(n,i){g(n,function(u){var o,s,f;if(i==b){if(u.events){for(o=0;o<u.events.length;o++)u.events[o].source=n,u.events[o].false=!0,l(u.events[o]);r=r.concat(u.events)}if(u.todos&&e.showTodosInCalendar){for(s=[],f=0;f<u.todos.length;f++)(!e.hideCompletedTodos||e.hideCompletedTodos&&u.todos[f].completed==!1)&&(u.todos[f].source=n,u.todos[f].isTodo=!0,s.push(u.todos[f]),l(s[s.length-1]));n.objectId!=t&&(r=r.concat(s))}y--;y||a(r)}})}function g(t,r){for(var a=c.sourceFetchers,o,u,s,y,e=0;e<a.length;e++){if(o=a[e](t,h,v,r),o===!0)return;if(typeof o=="object"){g(o,r);return}}if(u=t.events,s=t.todos,u)typeof u=="function"?(tt(),u(f(h),f(v),function(n){r({result:!0,events:n,todos:s});it()})):Array.isArray(u)?r({result:!0,events:u,todos:s}):r({result:!1,events:[],todos:[]});else if(y=t.url,y){var b=t.success,k=t.error,d=t.complete,l=n.extend({},t.data||{}),p=ht(t.startParam,i.startParam),w=ht(t.endParam,i.endParam);p&&(l[p]=Math.round(+h/1e3));w&&(l[w]=Math.round(+v/1e3));tt();n.ajax(n.extend({},bi,t,{data:l,success:function(n){n=n||[];var t=pt(b,this,arguments);Array.isArray(t)&&(n=t);r({result:!0,events:n})},error:function(){pt(k,this,arguments);r({result:!1,events:[]})},complete:function(){pt(d,this,arguments);it()}}))}else r({result:!1,events:[]})}function st(n){n=nt(n);n&&(y++,d(n,b))}function nt(n){return(typeof n=="function"||Array.isArray(n)?n={events:n}:typeof n=="string"&&(n={url:n}),typeof n=="object")?(gt(n),o.push(n),n):t}function ct(t){o=n.grep(o,function(n){return!rt(n,t)});r=n.grep(r,function(n){return!rt(n.source,t)});a(r);e.rerenderCategories()}function lt(){return r}function at(){return o}function vt(){for(var n=0;n<o.length;n++)o[n].isTodo!=1&&(o[n].todos=[])}function yt(n){l(n);for(var o=r.length,i,f=ft().defaultEventEnd,s=n.start-n._start,e=n.end?n.end-(n._end||f(n)):0,u=0;u<o;u++)i=r[u],i._id==n._id&&i!=n&&(i.start=new Date(+i.start+s),i.end=n.end?i.end?new Date(+i.end+e):new Date(+f(i)+e):null,n.title!=t&&(i.title=n.title),n.url!=t&&(i.url=n.url),n.allDay!=t&&(i.allDay=n.allDay),n.className!=t&&(i.className=n.className),n.editable!=t&&(i.editable=n.editable),n.color!=t&&(i.color=n.color),n.backgroundColor!=t&&(i.backgroundColor=n.backgroundColor),n.borderColor!=t&&(i.borderColor=n.borderColor),n.textColor!=t&&(i.textColor=n.textColor),n.description!=t&&(i.description=n.description),n.repeat!=t&&(i.repeat=n.repeat),n.alert!=t&&(i.alert=n.alert),n.objectId!=t&&(i.objectId=n.objectId),n.sourceId!=t&&(i.sourceId=n.sourceId),n.source!=t&&(i.source=n.source),n.isShared!=t&&(i.isShared=n.isShared),n.permissions!=t&&(i.permissions=n.permissions),n.owner!=t&&(i.owner=n.owner),l(i));a(r)}function wt(n,t){l(n);n.source||(t&&(w.events.push(n),n.source=w),r.push(n));a(r)}function bt(n){for(var t=0;t<n.length;)l(n[t]),t++;r=r.concat(n);a(r)}function kt(t){var i,u;if(t)for(typeof t!="function"&&(u=t+"",t=function(n){return n._id==u}),r=n.grep(r,t,!0),i=0;i<o.length;i++)Array.isArray(o[i].events)&&(o[i].events=n.grep(o[i].events,t,!0));else for(r=[],i=0;i<o.length;i++)Array.isArray(o[i].events)&&(o[i].events=[]);a(r)}function dt(t){return typeof t=="function"?n.grep(r,t):t?(t+="",n.grep(r,function(n){return n._id==t})):r}function tt(){k++||p("loading",null,!0)}function it(){--k||p("loading",null,!1)}function l(n){var r=n.source||{},u=ht(r.ignoreTimezone,i.ignoreTimezone);n._id=n.objectId!==t?n.objectId+"":n._id!==t?n._id:n.id!==t?n.id+"":"_fc"+ki++;n.date&&(n.start||(n.start=n.date),delete n.date);n._start=f(n.start=s(n.start,u));n.end=s(n.end,u);n.end&&n.end<=n.start&&(n.end=null);n._end=n.end?f(n.end):null;n.allDay===t&&(n.allDay=n.isTodo?!0:ht(r.allDayDefault,i.allDayDefault));n.className?typeof n.className=="string"&&(n.className=n.className.split(/\s+/)):n.className=[]}function gt(n){var t,e,f,r;for(n.backgroundColor&&!n.borderColor&&(t=u.parseCssColor(n.backgroundColor),t&&(e=u.changeColorLightness(t.r,t.g,t.b,i.eventBg2BorderRatio),n.borderColor=e.color)),n.className?typeof n.className=="string"&&(n.className=n.className.split(/\s+/)):n.className=[],f=c.sourceNormalizers,r=0;r<f.length;r++)f[r](n)}function rt(n,t){return n&&t&&ut(n)==ut(t)}function ut(n){return(typeof n=="object"?n.events||n.url:"")||n}var e=this;localStorageManager.getItem("showTodosInCalendar")==t&&localStorageManager.setItem("showTodosInCalendar",!0);e.isFetchNeeded=et;e.fetchEvents=ot;e.addEvents=bt;e.addEventSource=st;e.removeEventSource=ct;e.getEventSources=at;e.cleanEmptyEventSources=vt;e.updateEvent=yt;e.renderEvent=wt;e.removeEvents=kt;e.clientEvents=dt;e.normalizeEvent=l;e.getCache=lt;e.showTodosInCalendar=localStorageManager.getItem("showTodosInCalendar");e.hideCompletedTodos=localStorageManager.getItem("hideCompletedTodos");var p=e.trigger,ft=e.getView,a=e.reportEvents,w={events:[],todos:[]},o=[w],h,v,b=0,y=0,k=0,r=[]}function st(n,t,i){return n.setFullYear(n.getFullYear()+t),i||k(n),n}function g(n,t,i){if(+n){var u=n.getMonth()+t,r=f(n);for(r.setDate(1),r.setMonth(u),n.setMonth(u),i||k(n);n.getMonth()!=r.getMonth();)n.setDate(n.getDate()+(n<r?1:-1))}return n}function e(n,t,i){if(+n){var u=n.getDate()+t,r=f(n);r.setHours(9);r.setDate(u);n.setDate(u);i||k(n);dt(n,r)}return n}function dt(n,t){if(+n)while(n.getDate()!=t.getDate())n.setTime(+n+(n<t?1:-1)*du)}function o(n,t){return n.setMinutes(n.getMinutes()+t),n}function k(n){return n.setHours(0,0,0,0),n}function f(n,t){return t?k(new Date(+n)):new Date(+n)}function gi(){var t=0,n;do n=new Date(1970,t++,1);while(n.getHours());return n}function nt(n,t,i){for(t=t||1;!n.getDay()||i&&n.getDay()==1||!i&&n.getDay()==6;)e(n,t);return n}function a(n,t){return Math.round((f(n,!0)-f(t,!0))/di)}function nr(n,i,r,u){i!==t&&i!=n.getFullYear()&&(n.setDate(1),n.setMonth(0),n.setFullYear(i));r!==t&&r!=n.getMonth()&&(n.setDate(1),n.setMonth(r));u!==t&&n.setDate(u)}function gt(n){var u,i,t,r,s;if(!n)return null;try{if((u=window.ICAL.parse(n),i=new window.ICAL.Component(u),i.name!=="vcalendar")||(t=i.getFirstSubcomponent("vevent"),!t))return null;var f=new window.ICAL.Event(t),e=t.getFirstProperty("organizer"),o=[];return jq.each(f.attendees,function(n,t){o.push(t.jCal)}),r=[],s=t.getAllProperties("attach"),jq.each(s,function(n,t){var i={},u;i.iconCls=window.ASC.Files.Utility.getCssClassByFileTitle(t.jCal[1].filename,!0);i.title=t.jCal[1].filename;i.contentType=t.jCal[1].fmttype;i.fileUrl=t.jCal[3];i.isUploaded=!0;i.isNew=!1;i.error="";i.warn="";i.size=0;u=new URL(t.jCal[3]);i.id=u.searchParams.get("fileid");r.push(i)}),{location:f.location,attendees:o,attachments:r,organizer:e==null?null:e.jCal}}catch(h){return console.error(h),null}}function s(n,i){return typeof n=="object"?n:typeof n=="number"?new Date(n*1e3):typeof n=="string"?n.match(/^\d+(\.\d+)?$/)?new Date(parseFloat(n)*1e3):(i===t&&(i=!0),d(n,i)||(isNaN(Date.parse(n))?null:new Date(n))):null}function d(n,t){var i=n.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/),r,u,f;return i?(r=new Date(i[1],0,1,1),t||!i[14]?(u=new Date(i[1],0,1,9,0),i[3]&&(r.setMonth(i[3]-1),u.setMonth(i[3]-1)),i[5]&&(r.setDate(i[5]),u.setDate(i[5])),dt(r,u),i[7]&&r.setHours(i[7]),i[8]&&r.setMinutes(i[8]),i[10]&&r.setSeconds(i[10]),i[12]&&r.setMilliseconds(Number("0."+i[12])*1e3),dt(r,u)):(r.setUTCFullYear(i[1],i[3]?i[3]-1:0,i[5]||1),r.setUTCHours(i[7]||0,i[8]||0,i[10]||0,i[12]?Number("0."+i[12])*1e3:0),f=Number(i[16])*60+(i[18]?Number(i[18]):0),f*=i[15]=="-"?1:-1,r=new Date(+r+f*6e4)),r):null}function ni(n){var t,i;return typeof n=="number"?n*60:typeof n=="object"?n.getHours()*60+n.getMinutes():(t=n.match(/(\d+)(?::(\d+))?\s*(\w+)?/),t)?(i=parseInt(t[1],10),t[3]&&(i%=12,t[3].toLowerCase().charAt(0)=="p"&&(i+=12)),i*60+(t[2]?parseInt(t[2],10):0)):0}function y(n,t,i){return it(n,null,t,i)}function it(n,t,i,r){var p;r=r||h;for(var e=n,a=t,l=i.length,o,u,v,s="",c,f=0;f<l;f++)if(o=i.charAt(f),o=="'"){for(u=f+1;u<l;u++)if(i.charAt(u)=="'"){e&&(s+=u==f+1?"'":i.substring(f+1,u),f=u);break}}else if(o=="("){for(u=f+1;u<l;u++)if(i.charAt(u)==")"){c=y(e,i.substring(f+1,u),r);parseInt(c.replace(/\D/,""),10)&&(s+=c);f=u;break}}else if(o=="["){for(u=f+1;u<l;u++)if(i.charAt(u)=="]"){p=i.substring(f+1,u);c=y(e,p,r);c!=y(a,p,r)&&(s+=c);f=u;break}}else if(o=="{")e=t,a=n;else if(o=="}")e=n,a=t;else{for(u=l;u>f;u--)if(v=tr[i.substring(f,u)],v){e&&(s+=v(e,r));f=u-1;break}u==f&&e&&(s+=o)}return s}function ft(n){return n.end?nf(n.end,n.allDay):e(f(n.start),1)}function nf(n,t){return n=f(n),t||n.getHours()||n.getMinutes()?e(n,1):k(n)}function tf(n,i){return n.event.source===t?-1:i.event.source===t?1:(i.msLength-n.msLength)*100+(n.event.start-i.event.start)}function ir(n,t){return n.end>t.start&&n.start<t.end}function lt(n,t,i,r){for(var v=[],y=n.length,u,o,s,h,c,l,a,e=0;e<y;e++)u=n[e],o=u.start,s=t(u),(!u.source||!u.source.isHidden)&&s>i&&o<r&&ASC.Api.iCal.RecurrenceRule.isVisibleYearlyEvent(u)&&(o<i?(h=f(i),l=!1):(h=o,l=!0),s>r?(c=f(r),a=!1):(c=s,a=!0),v.push({event:u,start:h,end:c,isStart:l,isEnd:a,msLength:c-h}));return v.sort(tf)}function ti(n){for(var i=[],o=n.length,u,t,e,f,r=0;r<o;r++){for(u=n[r],t=0;;){if(e=!1,i[t])for(f=0;f<i[t].length;f++)if(ir(i[t][f],u)){e=!0;break}if(e)t++;else break}i[t]?i[t].push(u):i[t]=[u]}return i}function rr(i,r,u){i.off("mouseover").on("mouseover",function(i){for(var f=i.target,o,e;f&&f!=this;){if(f._fci!==t)break;f=f.parentNode}(o=f._fci)!==t&&(f._fci=t,e=r[o],u(e.event,e.element,e),n(i.target).trigger(i));i.stopPropagation()})}function rt(t,i,r){for(var u=0,f;u<t.length;u++)f=n(t[u]),f.width(Math.max(0,i-ii(f,r)))}function ur(t,i,r){for(var u=0,f;u<t.length;u++)f=n(t[u]),f.height(Math.max(0,i-ri(f,r)))}function ii(n,t){var i=window.getComputedStyle(n[0]);return rf(i)+ff(i)+(t?uf(i):0)}function rf(n){return(parseFloat(n.paddingLeft)||0)+(parseFloat(n.paddingRight)||0)}function uf(n){return(parseFloat(n.marginLeft)||0)+(parseFloat(n.marginRight)||0)}function ff(n){return(parseFloat(n.borderLeftWidth)||0)+(parseFloat(n.borderRightWidth)||0)}function ri(n,t){var i=window.getComputedStyle(n[0]);return ef(i)+hf(i)+(t?sf(i):0)}function ef(n){return(parseFloat(n.paddingTop)||0)+(parseFloat(n.paddingBottom)||0)}function sf(n){return(parseFloat(n.marginTop)||0)+(parseFloat(n.marginBottom)||0)}function hf(n){return(parseFloat(n.borderTopWidth)||0)+(parseFloat(n.borderBottomWidth)||0)}function ui(n,t,i){t=typeof t=="number"?t+"px":t;n.each(function(n,r){r.style.cssText+=";min-height:"+t+(i?";height:"+t:"")+";_height:"+t+";"})}function fr(){}function er(n,t){return n-t}function et(n){return(n<10?"0":"")+n}function at(n,i){if(n[i]!==t)return n[i];for(var f=i.split(/(?=[A-Z])/),r=f.length-1,u;r>=0;r--)if(u=n[f[r].toLowerCase()],u!==t)return u;return n[""]}function i(n){return typeof n!="string"?n:n.replace(/&(\s|[^#\w]|\w+(?:[^;\w]|$))/g,"&amp;$1").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br/>")}function cf(n){return n.id+"/"+n.className+"/"+n.style.cssText.replace(/(^|;)\s*(top|left|width|height)\s*:[^;]*/ig,"")}function fi(n){n.attr("unselectable","on").css("MozUserSelect","none").on("selectstart.ui",function(){return!1})}function vt(n){n.children().removeClass("fc-first fc-last").filter(":first-child").addClass("fc-first").end().filter(":last-child").addClass("fc-last")}function yt(n,t){n.className=n.className.replace(/^fc-\w*/,"fc-"+ku[t.getDay()])}function or(n,t,r){var u=n.source||{},o=n.color,s=u.color,h=t("eventColor"),e=r==="month"&&(!n.allDay||n.sourceId=="users_birthdays")&&(!(n.end instanceof Date)||n.end.getFullYear()==n.start.getFullYear()&&n.end.getMonth()==n.start.getMonth()&&(n.end.getDate()==n.start.getDate()||n.end.getDate()-n.start.getDate()==1&&n.end.getHours()==0&&n.end.getMinutes()==0)),c=e?"transparent":n.backgroundColor||o||u.backgroundColor||s||t("eventBackgroundColor")||h,l=e?"transparent":n.backgroundColor||o||u.backgroundColor||s||t("eventBorderColor")||h,a=e?t("eventTextColor"):n.textColor||u.textColor||t("eventTextColor"),f=[];return c&&f.push("background-color:"+i(c)),l&&f.push("border-color:"+i(l)),a&&f.push("color:"+i(a)),f.join(";")}function pt(n,t,i){if(typeof n=="function"&&(n=[n]),n){for(var u,r=0;r<n.length;r++)u=n[r].apply(t,i)||u;return u}return!1}function ht(){for(var n=0;n<arguments.length;n++)if(arguments[n]!==t)return arguments[n];return!1}function sr(n){return n.length<=ei?n:n.substr(0,ei-3)+"..."}function hr(n){if(n){var t=n.lastIndexOf(".");return t>-1?n.substr(0,t):n}return""}function cr(n){if(n){var t=n.lastIndexOf(".");return t>-1?n.substr(t):""}return""}function ot(t){function u(n){var t=" "+n+" ";return t=t.replace(/([^A-Za-z])(M+)([^A-Za-z])/g,"$1'<span class=\"month\">'$2'<\/span>'$3"),t=t.replace(/([^A-Za-z])(y+)([^A-Za-z])/g,"$1'<span class=\"year\">'$2'<\/span>'$3"),t.replace(/^\s+|\s+$/g,"")}function o(f){var o=u(t.options.titleFormat.month),e=n('<span><span class="title-text"><span class="h2">'+i(f,o)+"<\/span><\/span><\/span>");return r.buildTitleMenus(t,e),e}function s(i,f){var o=t.options.titleFormat.week.replace(/MMMM/g,"MMM"),h=o+"[, yyyy]{ '&#8212;' "+o+", "+u("yyyy}"),c=e(i,f,h),s=n('<span><span class="title-text"><span class="h2">'+c+"<\/span><\/span><\/span>");return r.buildTitleMenus(t,s),s}function h(r){var f=(t.options.titleFormat.day.indexOf("ddd")<0&&t.options.titleFormat.day.indexOf("dddd")<0?"dddd, ":"")+t.options.titleFormat.day,e=f.replace(/dddd/g,"ddd"),u=n('<span><span class="title-text"><span class="h2">'+i(r,e)+"<\/span><\/span><\/span>");u.find(".title-text .h2").on("click",function(){l.open(t,this,function(n){n.datepicker("setDate",t.getDate())},function(n,i){this.close();t.gotoDate(i.datepicker("getDate"))})});return u}var f={month:o,week:s,day:h},i=t.formatDate,e=t.formatDates;this.render=function(t,i,r){var u=at(f,t);return u?u.call(this,i,r):n("<span><\/span>")}}function lf(n,t){function o(n,o){var s,a,p;o&&(g(n,o),n.setDate(1));s=f(n,!0);s.setDate(1);var v=g(f(s),1),c=f(s),h=f(v),y=r("firstDay"),l=r("weekends")?0:1;l&&(nt(c),nt(h,-1,!0));e(c,-((c.getDay()-Math.max(y,l)+7)%7));e(h,(7-h.getDay()+Math.max(y,l))%7);a=Math.round((h-c)/(di*7));r("weekMode")=="fixed"&&(e(h,(6-a)*7),a=6);p=new ot(t);i.title=p.render(i.name,s,v);i.start=s;i.end=v;i.visStart=c;i.visEnd=h;u(6,a,l?5:7,!0)}var i=this;i.render=o;oi.call(i,n,t,"month");var r=i.opt,u=i.renderBasic,s=t.formatDate;this._afterRenderDaySegs=function(){}}function af(n,t){function s(n,t){t&&e(n,t*7);var s=e(f(n),-((n.getDay()-r("firstDay")+7)%7)),l=e(f(s),7),h=f(s),c=f(l),a=r("weekends");a||(nt(h),nt(c,-1,!0));i.title=o(h,e(f(c),-1),r("titleFormat"));i.start=s;i.end=l;i.visStart=h;i.visEnd=c;u(1,1,a?7:5,!1)}var i=this;i.render=s;oi.call(i,n,t,"basicWeek");var r=i.opt,u=i.renderBasic,o=t.formatDates}function vf(n,t){function s(n,t){t&&(e(n,t),r("weekends")||nt(n,t<0?-1:1));i.title=o(n,r("titleFormat"));i.start=i.visStart=f(n,!0);i.end=i.visEnd=e(f(i.start),1);u(1,1,1,!1)}var i=this;i.render=s;oi.call(i,n,t,"basicDay");var r=i.opt,u=i.renderBasic,o=t.formatDate}function oi(t,i,r){function ci(n,t,i,r){s=t;o=i;li();var u=!d;u?ai(n,r):ri();vi(u)}function li(){ot=c("isRTL");ot?(y=-1,p=o-1):(y=1,p=0);lt=c("firstDay");at=c("weekends")?0:1;w=c("theme")?"ui":"fc";pt=c("columnFormat")}function ai(i,r){for(var c=w+"-widget-header",a=w+"-widget-content",e,s,u="<table class='fc-border-separate' style='width:100%' cellspacing='0'><thead><tr>",f=0;f<o;f++)u+="<th class='fc- "+c+"'><\/th>";for(u+="<\/tr><\/thead><tbody>",f=0;f<i;f++){for(u+="<tr class='fc-week"+f+"'>",e=0;e<o;e++)u+="<td class='fc- "+a+" fc-day"+(f*o+e)+"'><div>"+(r?"<div class='fc-day-number'><\/div>":"")+"<div class='fc-day-content'><div style='position:relative;height:100%;'>&nbsp;<\/div><\/div><\/div><\/td>";u+="<\/tr>"}u+="<\/tbody><\/table>";s=n(u).appendTo(t);b=s.find("thead");v=b.find("th");d=s.find("tbody");h=d.find("tr");l=d.find("td");hi=l.filter(":first-child");ut=h.eq(0).find("div.fc-day-content div");vt(b.add(b.find("tr")));vt(h);h.eq(0).addClass("fc-first");wt(l);ht=n("<div style='position:absolute;z-index:8;top:0;left:0'><\/div>").appendTo(t)}function vi(t){var o=t||s==1,a=u.start.getMonth(),y=k(new Date),r,c,f,e;o&&v.each(function(n,t){r=st(n);t.innerHTML=oi(r,pt);yt(t,r)});l.each(function(n,t){r=st(n);r.getMonth()==a?t.classList.remove("fc-other-month"):t.classList.add("fc-other-month");+r==+y?(t.classList.add(w+"-state-highlight","fc-today"),e=t.previousSibling,e&&e.classList.add("fc-today-left"),f=t.parentElement.previousSibling,f&&f.childNodes[t.cellIndex].classList.add("fc-today-top"),c=n):t.classList.remove(w+"-state-highlight","fc-today","fc-today-left","fc-today-top");t.querySelector(".fc-day-number").innerHTML="<span>"+r.getDate()+"<\/span>";o&&yt(t,r)});h.each(function(n,t){n<s?n==s-1?t.classList.add("fc-last"):t.classList.remove("fc-last"):t.style.display="none"});c<7&&(ut=h.eq(1).find("div.fc-day-content div"));l.find(".fc-day-number > span").on("mousedown",function(t){if(t.which==1){var r=i.getDate();i.gotoDate(r.getFullYear(),r.getMonth(),n(this).text());i.changeView("agendaDay")}})}function yi(n){ct=n;var t=ASC.CalendarSizeManager.cache,r=ct-t.fcMonthContentTheadHeight,i,u;c("weekMode")=="variable"?i=u=Math.floor(r/(s==1?2:6)):(i=Math.floor(r/s),u=r-i*(s-1));l.each(function(n,r){var f=(Math.floor(n/7)==s-1?u:i)-t.fcMonthContentCellVSides+1,e=r.querySelector("div"),o;e.style.cssText=";min-height:"+f+"px;height:"+f+"px;";o=e.querySelector(".fc-day-content");f=f-t.fcMonthContentCellNumberHeight-t.fcMonthContentCellNumberVSides;o.style.cssText+=";min-height:"+f+"px;height:"+f+"px;"})}function pi(t){ft=t;tt.clear();et=Math.floor(ft/o)-ii(n(v[0]));for(var i=0;i<v.length;i++)v[i].style.width=et+"px"}function wt(n){n.on("click",wi).on("mousedown",ei)}function wi(n){if(!c("selectable")){var t=parseInt(this.className.match(/fc\-day(\d+)/)[1]),i=st(t);it("dayClick",this,i,!0,n)}}function bt(n,t,i){var r,v,h,c,l,w,b;for(i&&g.build(),r=f(u.visStart),v=e(f(r),o),h=0;h<s;h++)c=new Date(Math.max(r,n)),l=new Date(Math.min(v,t)),c<l&&(ot?(w=a(l,r)*y+p+1,b=a(c,r)*y+p+1):(w=a(c,r),b=a(l,r)),wt(kt(h,w,h,b-1))),e(r,7),e(v,7)}function kt(n,i,r,u){var f=g.rect(n,i,r,u,t);return ui(f,t)}function bi(n){return f(n)}function ki(n,t){bt(n,e(f(t),1),!0)}function di(){rt()}function gi(n,t,i){var r=dt(n),u=l[r.row*o+r.col];it("dayClick",u,n,t,i)}function nr(n,t){nt.start(function(n){rt();n&&kt(n.row,n.col,n.row,n.col)},t)}function tr(n,t,i){var r=nt.stop(),u;rt();r&&(u=gt(r),it("drop",n,u,!0,t,i))}function ir(n){return f(n.start)}function rr(n){return tt.left(n)}function ur(n){return tt.right(n)}function dt(n){return{row:Math.floor(a(n,u.visStart)/7),col:ti(n.getDay())}}function gt(n){return ni(n.row,n.col)}function ni(n,t){return e(f(u.visStart),n*7+t*y+p)}function st(n){return ni(Math.floor(n/o),n%o)}function ti(n){return(n-Math.max(lt,at)+o)%o*y+p}function fr(n){return h.eq(n)}function er(){return{left:0,right:ft}}function or(n,t){var i=h.eq(n).find("td:eq("+t+")");return i.length>0?{left:i[0].offsetLeft,top:i[0].offsetTop,right:i[0].offsetLeft+i[0].offsetWidth,bottom:i[0].offsetTop+i[0].offsetHeight}:{top:0,right:0,bottom:0,left:0}}var u=this;u.renderBasic=ci;u.setHeight=yi;u.setWidth=pi;u.renderDayOverlay=bt;u.defaultSelectionEnd=bi;u.renderSelection=ki;u.clearSelection=di;u.reportDayClick=gi;u.dragStart=nr;u.dragStop=tr;u.defaultEventEnd=ir;u.getHoverListener=function(){return nt};u.colContentLeft=rr;u.colContentRight=ur;u.dayOfWeekCol=ti;u.dateCell=dt;u.cellDate=gt;u.cellIsAllDay=function(){return!0};u.allDayRow=fr;u.allDayBounds=er;u.getRowCnt=function(){return s};u.getColCnt=function(){return o};u.getColWidth=function(){return et};u.getDaySegmentContainer=function(){return ht};u.getCellBounds=or;si.call(u,t,i,r);yr.call(u);vr.call(u);yf.call(u);var c=u.opt,it=u.trigger,ri=u.clearEvents,ui=u.renderOverlay,rt=u.clearOverlays,ei=u.daySelectionMousedown,oi=i.formatDate,b,v,d,h,l,hi,ut,ht,ft,ct,et,s,o,g,nt,tt,ot,y,p,lt,at,w,pt;fi(t.addClass("fc-grid"));g=new pr(function(t,i){var f,r,u;v.each(function(t,e){f=n(e);r=f.offset().left;t&&(u[1]=r);u=[r];i[t]=u});u[1]=r+f.outerWidth();h.each(function(i,e){i<s&&(f=n(e),r=f.offset().top,i&&(u[1]=r),u=[r],t[i]=u)});u[1]=r+f.outerHeight()});nt=new wr(g);tt=new br(function(n){return ut.eq(n)})}function yf(){function tt(n,t){h(n);g(u(n),t)}function it(){c();for(var n=p()[0],t;t=n.lastChild;)n.removeChild(t)}function u(t){for(var v=k(),y=d(),s=f(n.visStart),l=e(f(s),y),h,i,c,u,o,a=[],r=0;r<v;r++){for(h=ti(lt(t,ft,s,l)),i=0;i<h.length;i++)for(c=h[i],u=0;u<c.length;u++)o=c[u],o.row=r,o.level=i,a.push(o);e(s,7);e(l,7)}return a}function rt(n,t,i){o(n)&&ut(n,t);i.isEnd&&s(n)&&nt(n,t,i);l(n,t)}function ut(n,u){var s=w(),o;u.draggable({zIndex:9,delay:50,opacity:t("dragOpacity"),revertDuration:t("dragRevertDuration"),start:function(h,c){i("eventDragStart",u,n,h,c);v(n,u);s.start(function(i,s,h,c){u.draggable("option","revert",!i||!h&&!c);r();i?(o=h*7+c*(t("isRTL")?-1:1),b(e(f(n.start),o),e(ft(n),o))):o=0},h,"drag")},stop:function(t,f){s.stop();r();i("eventDragStop",u,n,t,f);o?y(this,n,o,0,n.allDay,t,f):(u.css("filter",""),a(n,u))}})}var n=this;n.renderEvents=tt;n.compileDaySegs=u;n.clearEvents=it;n.bindDaySeg=rt;ar.call(n);var t=n.opt,i=n.trigger,o=n.isEventDraggable,s=n.isEventResizable,h=n.reportEvents,c=n.reportEventClear,l=n.eventElementHandlers,a=n.showEvents,v=n.hideEvents,y=n.eventDrop,p=n.getDaySegmentContainer,w=n.getHoverListener,b=n.renderDayOverlay,r=n.clearOverlays,k=n.getRowCnt,d=n.getColCnt,g=n.renderDaySegs,nt=n.resizableDayEvent}function pf(n,t){var i=this;lr.call(i,n,t,"agendaWeek");var r=i.opt,u=i.renderAgenda,o=t.formatDates;this.render=function(n,o){var v;o&&e(n,o*7);var s=e(f(n),-((n.getDay()-r("firstDay")+7)%7)),h=e(f(s),7),c=f(s),l=f(h),a=r("weekends");a||(nt(c),nt(l,-1,!0));v=new ot(t);i.title=v.render(i.name,s,e(f(s),6));i.start=s;i.end=h;i.visStart=c;i.visEnd=l;u(a?7:5)}}function wf(n,t){function h(n,i){i&&(e(n,i),o("weekends")||nt(n,i<0?-1:1));var u=f(n,!0),h=e(f(u),1),l=new ot(t);r.title=l.render(r.name,u,h);r.start=r.visStart=u;r.end=r.visEnd=h;s(1,!1);c.call(r)}function c(){var f=u();if(f){var n=t.options.dayView.dateFormat,e=t.options.dayView.alldayTasksTitle,s=t.options.dayView.todayTasksTitle;f.html('<div class="big-date-box"><div class="top-text">'+i(it(r.visStart,r.visEnd,n.topText))+'<\/div><div class="big-text">'+i(it(r.visStart,r.visEnd,n.bigText))+'<\/div><div class="bottom-text">'+i(it(r.visStart,r.visEnd,n.bottomText))+'<\/div><div class="today-label"><div class="inner">'+o("todayLabel")+'<\/div><\/div><\/div><div class="allday-box"><div class="allday-tasks-title">'+i(e)+'<\/div><div class="allday-tasks-scroller"><table class="allday-tasks-list" border="0" cellspacing="0" cellpadding="0"><\/table><\/div><\/div><div class="tasks-title">'+i(s)+'<\/div><div class="tasks-scroller"><table class="tasks-list" border="0" cellspacing="0" cellpadding="0"><\/table><\/div>')}}var r=this;r.render=h;lr.call(r,n,t,"agendaDay");var o=r.opt,s=r.renderAgenda,l=t.formatDate,u=r.getDayList;this._onSetHeight=function(n){var t=u(),i,r,f;t&&(i=t.find(".tasks-title"),r=i.position(),r.top+=i.outerHeight(!0),t.find(".tasks-scroller").css("top",r.top+"px").css("height",n-r.top+"px"),f=t.find(".big-date-box"),t.find(".allday-box").css("top",f.position().top+"px").css("height",f.outerHeight(!0)+"px"),i=t.find(".allday-tasks-title"),t.find(".allday-tasks-scroller").css("top",i.position().top+i.outerHeight(!0)+"px"))};this._onSetWidth=function(){var n=u(),t,f,i,r;n&&(t=n.find(".tasks-title"),f=t.position(),n.find(".tasks-scroller").css("left",f.left+"px").css("width",t.outerWidth(!0)),i=n.find(".big-date-box"),r=i.outerWidth(!0),n.find(".allday-box").css("left",i.position().left+r+"px").css("width",n.width()-r+"px"))};this._afterRenderSlotSegs=function(n){var e=u();if(e){var c=n.length,s=e.find("table.tasks-list"),f,r,h="";for(n.sort(function(n,t){return n.event.start<t.event.start?-1:n.event.start>t.event.start?1:n.event.title.toLowerCase()<t.event.title.toLowerCase()?-1:1}),f=0;f<c;++f)r=n[f].event,h+='<tr><td class="task-img"><span class="bullet" style="color:'+i(r.source.isHidden?t.options.categories.inactiveColor:r.source.backgroundColor)+';">'+i(t.options.categories.itemBullet)+'&nbsp;<\/span><\/td><td class="task-title"><div class="task-title">'+i(r.title)+"<\/div>"+(r.description&&r.description.length>0?'<div class="task-note">'+i(r.description)+"<\/div>":"")+'<\/td><td class="task-time"><div class="task-time">'+i(it(r.start,r.end||r.start,o("taskListTimeFormat")))+"<\/div><\/td><\/tr>";s.html("<tbody>"+h+"<\/tbody>");s.find("tr:last").addClass("last")}};this._afterRenderDaySegs=function(n){var e=u();if(e){var h=n.length,o=e.find("table.allday-tasks-list"),f,r,s="";for(n.sort(function(n,t){return n.event.title.toLowerCase()<t.event.title.toLowerCase()?-1:1}),f=0;f<h;++f)(r=n[f].event,r)&&(s+='<tr><td class="task-img"><span class="bullet" style="color:'+i(r.source.isHidden?t.options.categories.inactiveColor:r.source.backgroundColor)+';">'+i(t.options.categories.itemBullet)+'&nbsp;<\/span><\/td><td class="task-title"><div class="task-title">'+i(r.title)+"<\/div><\/td><\/tr>");o.html("<tbody>"+s+"<\/tbody>");o.find("tr:last").addClass("last")}}}function lr(r,u,s){function gu(n,t){l=n;nu();lt?yu():tf(t);iu()}function nf(){nu();iu()}function nu(){gt=c("theme")?"ui":"fc";gr=c("weekends")?0:1;dr=c("firstDay");di=c("isRTL");di?(it=-1,ut=l-1):(it=1,ut=0);ht=ni(c("minTime"));ci=ni(c("maxTime"));v=c("columnFormat");h.name=="agendaWeek"?window.innerWidth<1270?v=v.replace("dddd","ddd"):v.indexOf("dddd")<0&&v.indexOf("ddd")<0&&(v="dddd, "+v):v.indexOf("dddd")<0&&v.indexOf("ddd")<0&&(v="dddd, "+v);l<2&&(v="'<div class=\"center\">'"+v+"'<\/div>'")}function tu(){bi=tt.find("tr:eq(1)").outerHeight(!0)}function tf(u){var h=gt+"-widget-header",v=gt+"-widget-content",e,s,a,b,y,it=c("slotMinutes")%15==0,k=n("<table class='fc-agenda-inner' cellspacing='0'><tbody><tr>"+(l<2&&u?"<td class='td-day-list'><div class='day-list'>&nbsp;<\/div><\/td>":"")+"<td><div class='main-container'><\/div><\/td><\/tr><\/tbody><\/table>").appendTo(r);for(ft=l<2&&u?k.find(".day-list"):t,yi=k.find(".main-container"),e="<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'><thead><tr><th class='fc-agenda-axis "+h+"'>&nbsp;<\/th>",s=0;s<l;s++)e+="<th class='fc- fc-col"+s+" "+h+"'><\/th>";for(e+="<th class='fc-agenda-gutter "+h+"'>&nbsp;<\/th><\/tr><\/thead><tbody><tr><th class='fc-agenda-axis "+h+"'>&nbsp;<\/th>",s=0;s<l;s++)e+="<td class='fc- fc-col"+s+" "+v+"'><div><div class='fc-day-content'><div style='position:relative;max-height: 150px;'>&nbsp;<\/div><\/div><\/div><\/td>";for(e+="<td class='fc-agenda-gutter "+v+"'>&nbsp;<\/td><\/tr><\/tbody><\/table>",lt=n(e).appendTo(yi),bt=lt.find("thead"),g=bt.find("th").slice(1,-1),kt=lt.find("tbody"),d=kt.find("td").slice(0,-1),sr=d.find("div.fc-day-content div"),pi=d.eq(0),hr=pi.find("> div"),vt(bt.add(bt.find("tr"))),vt(kt.add(kt.find("tr"))),at=bt.find("th:first"),pt=lt.find(".fc-agenda-gutter"),nt=n("<div style='position:absolute;z-index:2;left:0;width:100%'><\/div>").appendTo(yi),c("allDaySlot")?(wi=n("<div style='position:absolute;z-index:9;top:0;left:0'><\/div>").appendTo(nt),e="<table style='width:100%' class='fc-agenda-allday' cellspacing='0'><tr><th class='"+h+" fc-agenda-axis'>"+c("allDayText")+"<\/th><td><div class='fc-day-content'><div style='position:relative;max-height: 150px;'><\/div><\/div><\/td><th class='"+h+" fc-agenda-gutter'>&nbsp;<\/th><\/tr><\/table>",dt=n(e).appendTo(nt),ei=dt.find("tr"),uu(ei.find("td")),at=at.add(dt.find("th:first")),pt=pt.add(dt.find("th.fc-agenda-gutter")),nt.append("<div class='fc-agenda-divider "+h+"'><div class='fc-agenda-divider-inner'><\/div><\/div>")):wi=n([]),p=n("<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'><\/div>").appendTo(nt),w=n("<div style='position:relative;width:100%;overflow:hidden'><\/div>").appendTo(p),cr=n("<div style='position:absolute;z-index:8;top:0;left:0'><\/div>").appendTo(w),e="<table class='fc-agenda-slots' style='width:100%' cellspacing='0'><tbody>",a=gi(),b=o(f(a),ci),o(a,ht),kr=0,s=0;a<b;s++)y=a.getMinutes(),e+="<tr class='fc-slot"+s+" "+(y?"fc-minor":"")+"'><th class='fc-agenda-axis "+h+"'>"+(!it||!y?"<div"+(s==0?' style="margin-top:0;"':"")+">"+i(vi(a,c("axisFormat")))+"<\/div>&nbsp;":"&nbsp;")+"<\/th><td class='"+v+"'><div style='position:relative'>&nbsp;<\/div><\/td><\/tr>",o(a,c("slotMinutes")),kr++;e+="<\/tbody><\/table>";tt=n(e).appendTo(w);tu();ir(tt.find("td"));at=at.add(tt.find("th:first"))}function rf(t){(!y||y.length<1)&&(y=n("<div class='fc-time-marker'><span class='title'><\/span><div class='left-side'><\/div><div class='center-line'><\/div><div class='right-side'><\/div><\/div>").appendTo(w),nr=t);ti()}function ti(){if(tr!=t&&clearTimeout(tr),y)if(l>0){var i=3,n=new Date,f=new Date(n.getTime()+n.getTimezoneOffset()*6e4),r=new Date(f.getTime()+ASC.Resources.Master.CurrentTenantTimeZone.UtcOffset*6e4),e=n.getHours()+":"+(n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes()),o=ct(r,r),u=hu(0)-i,s=cu(l-1)+i-u,h=y.find(".left-side").outerWidth(!0),c=y.find(".left-side").outerHeight(!0);y.css("left",u-h+"px");y.css("top",Math.round(o-.5*c)+"px");y.find(".center-line").css("width",s+"px");y.find(".title")[0].innerText=e;nr!==t?y.css("visibility","visible"):y.css("visibility","hidden");tr=setTimeout(ti,6e4)}else y.css("visibility","hidden")}function iu(){var r,e,n,f,o,i,s=k(new Date);for(d.eq(0).prev().removeClass("fc-today-left"),r=0;r<l;r++)i=rr(r),n=g.eq(r),n.html(i.getFullYear()==s.getFullYear()&&v.indexOf("yyyy")!=-1?vi(i,v.substring(0,v.indexOf("yyyy"))):vi(i,v)),function(n,t){var i=t.find(".number");if(i.length>0)i.on("click",function(){u.gotoDate(n);u.changeView("agendaDay")})}(i,n),f=d.eq(r),+i==+s?(f.addClass(gt+"-state-highlight fc-today"),n.addClass("fc-today"),e=r,o=f.prev(),o.length>0&&o.addClass("fc-today-left")):(f.removeClass(gt+"-state-highlight fc-today"),f.removeClass("fc-today-left"),n.removeClass("fc-today")),yt(n[0],i),yt(f[0],i);ft!=t&&(n=g.eq(0),ft.removeClass("fc-sat fc-sun fc-today"),n.hasClass("fc-sat")?ft.addClass("fc-sat"):n.hasClass("fc-sun")&&ft.addClass("fc-sun"),e!=t&&ft.addClass("fc-today"));y&&y.length>0?(nr=e,ti()):e!==t&&rf(e)}function uf(n,i){n===t&&(n=lr);lr=n;ki={};var r=kt.position().top,u=p.position().top,f=Math.min(n-r,tt.height()+u+1);hr.height(f-ri(pi));nt.css("top",r);p.height(f-u-1);tu();i&&ru();ti();typeof h._onSetHeight=="function"&&h._onSetHeight(n)}function ff(t){var r,i,u;du=t;hi.clear();et=0;rt(at.width("").each(function(t,i){et=Math.max(et,n(i).outerWidth())}),et);r=p[0].clientWidth;oi=p.width()-r;oi?(rt(pt,oi),pt.show().prev().removeClass("fc-last")):pt.hide().prev().addClass("fc-last");i=r-et;u=i%l;ot=Math.floor(i/l);u==0?rt(g,ot):(rt(g.filter(":even"),ot),rt(g.filter(":odd"),ot+1),rt(g.last(),i-ot*(l-1)-Math.floor(l/2)));ti();typeof h._onSetWidth=="function"&&h._onSetWidth(t)}function ru(n){function e(){p.scrollTop(u)}var i=gi(),r=f(i),u;r.setHours(n!==t?n:c("firstHour"));u=ct(i,r)+1;e();setTimeout(e,0)}function ef(){ar=p.scrollTop()}function sf(){p.scrollTop(ar)}function uu(n){n.on("click",fu).on("mousedown",bu)}function ir(n){n.on("click",fu).on("mousedown",pf)}function fu(n){var r,f;if(!c("selectable")){var i=Math.min(l-1,Math.floor((n.pageX-lt.offset().left-et)/ot)),t=rr(i),u=this.parentNode.className.match(/fc-slot(\d+)/);u?(r=parseInt(u[1])*c("slotMinutes"),f=Math.floor(r/60),t.setHours(f),t.setMinutes(r%60+ht),ui("dayClick",d[i],t,!1,n)):ui("dayClick",d[i],t,!0,n)}}function eu(n,t,i){i&&st.build();var e=f(h.visStart),r,u;di?(r=a(t,e)*it+ut+1,u=a(n,e)*it+ut+1):(r=a(n,e),u=a(t,e));r=Math.max(0,r);u=Math.min(l,u);r<u&&uu(ou(0,r,0,u-1))}function ou(n,t,i,r){var u=st.rect(n,t,i,r,nt);return or(u,nt)}function su(n,t){for(var u,o,i=f(h.visStart),c=e(f(i),1),r=0;r<l;r++){if(u=new Date(Math.max(i,n)),o=new Date(Math.min(c,t)),u<o){var a=r*it+ut,s=st.rect(0,a,0,a,w),v=ct(i,u),y=ct(i,o);s.top=v;s.height=y-v;ir(or(s,w))}e(i,1);e(c,1)}}function hu(n){return hi.left(n)}function cu(n){return hi.right(n)}function hf(n){return{row:Math.floor(a(n,h.visStart)/7),col:fr(n.getDay())}}function ii(n){var i=rr(n.col),t=n.row;return c("allDaySlot")&&t--,t>=0&&o(i,ht+t*c("slotMinutes")),i}function rr(n){return e(f(h.visStart),n*it+ut)}function li(n){return c("allDaySlot")&&!n.row}function fr(n){return(n-Math.max(dr,gr)+l)%l*it+ut}function ct(n,i){if(n=f(n,!0),i<o(f(n),ht))return 0;if(i>=o(f(n),ci))return tt.height();var r=c("slotMinutes"),s=i.getHours()*60+i.getMinutes()-ht,u=Math.floor(s/r),e=ki[u];return e===t&&(e=ki[u]=tt.find("tr:eq("+u+") td div")[0].offsetTop),Math.max(0,Math.round(e-1+bi*(s%r/r)))}function cf(){return{left:et,right:dt.width()-1-oi}}function lf(){return ei}function af(n){var t=f(n.start);return n.allDay?t:o(t,c("defaultEventMinutes"))}function vf(n,t){return t?f(n):o(f(n),c("slotMinutes"))}function yf(n,t,i){i?c("allDaySlot")&&eu(n,e(f(t),1),!0):lu(n,t)}function lu(t,i){var f=c("selectHelper"),u,o;if(st.build(),f){if(u=a(t,h.visStart)*it+ut,u>=0&&u<l){var r=st.rect(0,u,0,u,w),e=ct(t,t),s=ct(t,i);s>e&&(r.top=e,r.height=s-e,r.left+=2,r.width-=5,typeof f=="function"?(o=f(t,i),o&&(r.position="absolute",r.zIndex=8,b=n(o).css(r).appendTo(w))):(r.isStart=!0,r.isEnd=!0,b=n(ku({title:"",start:t,end:i,className:["fc-select-helper"],editable:!1},r)),b.css("opacity",c("dragOpacity"))),b&&(ir(b),w.append(b),rt(b,r.width,!0),ur(b,r.height,!0)))}}else su(t,i)}function au(){ai();b&&(b.remove(),b=null)}function pf(t){if(t.which==1&&c("selectable")){wu(t);var i;wt.start(function(n,t){if(au(),n&&n.col==t.col&&!li(n)){var r=ii(t),u=ii(n);i=[r,o(f(r),c("slotMinutes")),u,o(f(u),c("slotMinutes"))].sort(er);lu(i[0],i[3])}else i=null},t);n(document).one("mouseup",function(n){wt.stop();i&&(+i[0]==+i[1]&&vu(i[0],!1,n),pu(i[0],i[3],!1,n))})}}function vu(n,t,i){ui("dayClick",d[fr(n.getDay())],n,t,i)}function wf(n,t){wt.start(function(n){if(ai(),n)if(li(n))ou(n.row,n.col,n.row,n.col);else{var t=ii(n),i=o(f(t),c("defaultEventMinutes"));su(t,i)}},t)}function kf(n,t,i){var r=wt.stop();ai();r&&ui("drop",n,ii(r),li(r),t,i)}function df(t,i){var f=d.length>1,r=n(".fc-agenda-allday .fc-day-content:visible")[0],u=f?d[i]:r.parentElement;return r&&u?{left:u.offsetLeft,top:r.offsetTop,right:u.offsetLeft+u.offsetWidth,bottom:r.offsetTop+r.offsetHeight,hratio:f?1.4:1,wratio:f?1.4:1}:{top:0,right:0,bottom:0,left:0}}var h=this;h.renderAgenda=gu;h.setWidth=ff;h.setHeight=uf;h.beforeHide=ef;h.afterShow=sf;h.defaultEventEnd=af;h.timePosition=ct;h.dayOfWeekCol=fr;h.dateCell=hf;h.cellDate=ii;h.cellIsAllDay=li;h.allDayRow=lf;h.allDayBounds=cf;h.getHoverListener=function(){return wt};h.colContentLeft=hu;h.colContentRight=cu;h.getDaySegmentContainer=function(){return wi};h.getSlotSegmentContainer=function(){return cr};h.getMinMinute=function(){return ht};h.getMaxMinute=function(){return ci};h.getBodyContent=function(){return w};h.getRowCnt=function(){return 1};h.getColCnt=function(){return l};h.getColWidth=function(){return ot};h.getSlotHeight=function(){return bi};h.defaultSelectionEnd=vf;h.renderDayOverlay=eu;h.renderSelection=yf;h.clearSelection=au;h.reportDayClick=vu;h.dragStart=wf;h.dragStop=kf;h.getDayList=function(){return ft};h.resetScroll=ru;h.getCellBounds=df;h.updateHeader=nf;si.call(h,r,u,s);yr.call(h);vr.call(h);bf.call(h);var c=h.opt,ui=h.trigger,yu=h.clearEvents,or=h.renderOverlay,ai=h.clearOverlays,pu=h.reportSelection,wu=h.unselect,bu=h.daySelectionMousedown,ku=h.slotSegHtml,vi=u.formatDate,yi,ft,lt,bt,g,kt,d,sr,pi,hr,nt,wi,dt,ei,p,w,cr,tt,at,pt,b,du,lr,et,ot,oi,bi,ar,l,kr,st,wt,hi,ki={},gt,dr,gr,di,it,ut,ht,ci,v,y,nr,tr;fi(r.addClass("fc-agenda"));st=new pr(function(t,i){function a(n){return Math.max(h,Math.min(v,n))}var u,r,f,e,s;g.each(function(t,e){u=n(e);r=u.offset().left;t&&(f[1]=r);f=[r];i[t]=f});f[1]=r+u.outerWidth();c("allDaySlot")&&(u=ei,r=u.offset().top,t[0]=[r,r+u.outerHeight()]);var o=w.offset().top,h=p.offset().top,v=h+p.outerHeight(),l=tt.find("th");for(e=0;e<l.length;e++)s=l.eq(e).outerHeight(!0),t.push([a(o),a(o+s)]),o+=s});wt=new wr(st);hi=new br(function(n){return sr.eq(n)})}function bf(){function si(n,i){var s,e,h,o;yt(n);for(var v=n.length,l=[],a=[],c=0;c<v;c++)n[c].allDay?l.push(n[c]):a.push(n[c]);if(u("allDaySlot")){if(s=ht(a),r.name=="agendaDay"){if(s.length>0)for(e=0;e<s.length;e++)h=new Date(s[e].start),h.setDate(h.getDate()+1),h.getTime()==f(s[e].end,!0).getTime()&&(o={},Object.assign(o,s[e].event),o._start=o.start=s[e].event.start,o._end=o.end=s[e].event.end,o.isEditable=!1,o.isSegmEvent=!0,l.push(o))}else if(r.name=="agendaWeek"&&s.length>0)for(e=0;e<s.length;e++)h=new Date(s[e].start),h.setDate(h.getDate()+1),h.getTime()==f(s[e].end,!0).getTime()&&(o={},Object.assign(o,s[e].event),o._start=o.start=s[e].event.start,o._end=o.end=s[e].event.end,s[e].event.isSegmEventWeek=!0,l.find(function(n){return n.objectId===o.objectId})==t&&l.push(o));ni(st(l),i);wt()}ai(ht(a),i)}function hi(){pt();bt().empty();g().empty()}function st(n){for(var e=ti(lt(n,ft,r.visStart,r.visEnd)),s=e.length,f,i,u,o=[],t=0;t<s;t++)for(f=e[t],i=0;i<f.length;i++)u=f[i],u.row=0,u.level=t,o.push(u);return o}function ci(n){for(var i,r,f,e,u,t=n.length-1;t>0;t--)for(f=n[t],i=0;i<f.length;i++)for(e=f[i],r=0;r<n[t-1].length;r++)u=n[t-1][r],ir(e,u)&&(u.forward=Math.max(u.forward||0,(e.forward||0)+1))}function ht(n){for(var p=a(),v=tt(),w=kt(),c=o(f(r.visStart),v),u,t,l,s,h,y=[],i=0;i<p;i++){for(u=ti(lt(n,li,c,o(f(c),w-v))),ci(u),t=0;t<u.length;t++)for(l=u[t],s=0;s<l.length;s++)h=l[s],h.col=i,h.level=t,y.push(h);e(c,1,!0)}return y}function li(n){return n.end?f(n.end):o(f(n.start),u("defaultEventMinutes"))}function ai(e,o){var l,et=e.length,h,v,yt,ni,pt,w,b,wt,y,bt,ti,ui="",fi,c,ot,k,d,oi={},si={},st,p,nt,hi,tt,ci,ht=g(),kt,rt,lt,li=a(),ut,ft,vt;for(kt=u("isRTL"),kt?(rt=-1,lt=li-1):(rt=1,lt=0),l=0;l<et;l++)h=e[l],v=h.event,yt=it(h.start,h.start),ni=it(h.start,h.end),pt=h.col,w=h.level,b=h.forward||0,wt=dt(pt*rt+lt),y=gt(pt*rt+lt)-wt,y=Math.min(y-6,y*.95),bt=w?y/(w+b+1):b?(y/(b+1)-6)*2:y,ti=wt+y/(w+b+1)*w*rt+(kt?y-bt:0),h.top=yt,h.left=ti,h.outerWidth=bt,h.outerHeight=ni-yt,ut=ct(v,h),ft=n(ut),r.name=="agendaDay"?(vt=new Date(h.start),vt.setDate(vt.getDate()+1),vt.getTime()==f(h.end,!0).getTime()&&(ft.addClass("hidden"),ut=n("<div>").append(ft.clone()).html())):r.name=="agendaWeek"&&h.event.isSegmEventWeek&&(ft.addClass("hidden"),ut=n("<div>").append(ft.clone()).html()),ui+=ut;for(ht[0].innerHTML=ui,fi=ht.children(),l=0;l<et;l++)h=e[l],v=h.event,c=n(fi[l]),d=s("eventRender",v,v,c),d===!1?c.remove():(d&&d!==!0&&(c.remove(),c=n(d).css({position:"absolute",top:h.top,left:h.left}).appendTo(ht)),h.element=c,v._id===o?at(v,c,h):c[0]._fci=l,ei(v,c));for(rr(ht,e,at),l=0;l<et;l++)h=e[l],c=h.element,c&&(p=oi[st=h.key=cf(c[0])],h.vsides=p===t?oi[st]=ri(c,!0):p,p=si[st],h.hsides=p===t?si[st]=ii(c,!0):p,nt=c.find("div.fc-event-content"),nt.length&&(h.contentTop=nt[0].offsetTop));for(l=0;l<et;l++)h=e[l],c=h.element,c&&(hi=Math.max(0,h.outerWidth-h.hsides),tt=Math.max(0,h.outerHeight-h.vsides),c[0].style.width=hi+"px",c[0].style.height=tt>0?tt+"px":"auto",nt=c.find(".fc-event-content"),ci=tt-c.find(".fc-event-head").outerHeight(!0),nt.css("height",ci+"px"),ot=c.find(".fc-event-title"),k=c.find(".fc-event-time"),v=h.event,h.contentTop!==t&&tt-h.contentTop<10&&(k.html(k.html()+" "+i(ot.text())),ot.hasClass("fc-event-cancelled")?k.addClass("fc-event-cancelled"):k.removeClass("fc-event-cancelled"),ot.remove()),s("eventAfterRender",v,v,c));typeof r._afterRenderSlotSegs=="function"&&r._afterRenderSlotSegs(e)}function ct(n,t){var f="<",h=n.url,e=or(n,u),s=e?' style="'+e+'"':"",r=["fc-event","fc-event-skin","fc-event-vert"],o;return c(n)&&r.push("fc-event-draggable"),t.isStart&&r.push("fc-corner-top"),t.isEnd&&r.push("fc-corner-bottom"),r=r.concat(n.className),n.source&&(r=r.concat(n.source.className||[])),f+="div",o=i(n.title),f+=' class="'+r.join(" ")+'" style="position:absolute;z-index:8;top:'+t.top+"px;left:"+t.left+"px;"+e+'"><div class="fc-event-inner fc-event-skin"'+s+'><div class="fc-event-head fc-event-skin"'+s+'><div class="fc-event-time">'+i(k(n.start,n.end,u("timeFormat")))+(n.repeat&&n.repeat.type>eu?'<span class="fc-event-repeat"><\/span>':"")+(n.alert&&(n.alert.type>b||n.alert.type==w&&n.source&&n.source.defaultAlert.type>b)?'<span class="fc-event-alert"><\/span>':"")+(n.hasAttachments?'<div class="fc-event-has-attachments-not-all-day"><\/div>':"")+'<\/div><\/div><div class="fc-event-content" title="'+o+'"><div class="fc-event-title'+(n.status==2?" fc-event-cancelled":"")+'">'+o+'<\/div><\/div><div class="fc-event-bg"><\/div><\/div>',t.isEnd&&l(n)&&(f+='<div class="ui-resizable-handle ui-resizable-s">&nbsp;<\/div>'),f+"<\/div>"}function vi(n,t,i){c(n)&&yi(n,t,i.isStart);i.isEnd&&l(n)&&ui(n,t,i);d(n,t)}function at(n,t,i){var r=t.find("div.fc-event-time");c(n)&&pi(n,t,r);i.isEnd&&l(n)&&wi(n,t,r);d(n,t)}function yi(n,t,i){function l(){o||(t.width(a).height("").draggable("option","grid",null),o=!0)}var a,r,o=!0,c,d=u("isRTL")?-1:1,w=nt(),b=rt(),k=v(),g=tt();t.draggable({zIndex:9,opacity:u("dragOpacity","month"),revertDuration:u("dragRevertDuration"),start:function(v,y){s("eventDragStart",t,n,v,y);p(n,t);a=t.width();w.start(function(s,a,v,y){h();s?(r=!1,c=y*d,s.row?i?o&&(t.width(b-10),ur(t,k*Math.round((n.end?(n.end-n.start)/gu:u("defaultEventMinutes"))/u("slotMinutes"))),t.draggable("option","grid",[b,1]),o=!1):r=!0:(et(e(f(n.start),c),e(ft(n),c)),l()),r=r||o&&!c):(l(),r=!0);t.draggable("option","revert",r)},v,"drag")},stop:function(i,f){if(w.stop(),h(),s("eventDragStop",t,n,i,f),r)l(),t.css("filter",""),y(n,t);else{var e=0;o||(e=Math.round((t.offset().top-fi().offset().top)/k)*u("slotMinutes")+g-(n.start.getHours()*60+n.start.getMinutes()));ut(this,n,c,e,o,i,f)}}})}function pi(n,t,i){function it(r){var s=o(f(n.start),r),e;n.end&&(e=o(f(n.end),r));i.text(k(s,e,u("timeFormat"))+(t.height()<28?" "+n.title:""))}function ot(){r&&(i.css("display",""),t.draggable("option","grid",[tt,d]),r=!1)}var w,r=!1,l,c,b,st=u("isRTL")?-1:1,g=nt(),ht=a(),tt=rt(),d=v();t.draggable({zIndex:9,scroll:!1,grid:[tt,d],axis:ht==1?"y":!1,opacity:u("dragOpacity"),revertDuration:u("dragRevertDuration"),start:function(o,a){s("eventDragStart",t,n,o,a);p(n,t);w=t.position();c=b=0;g.start(function(o,s,c,a){t.draggable("option","revert",!o);h();o&&(l=a*st,u("allDaySlot")&&!o.row?(r||(r=!0,i.hide(),t.draggable("option","grid",null)),et(e(f(n.start),l),e(ft(n),l))):ot())},o,"drag")},drag:function(n,t){c=Math.round((t.position.top-w.top)/d)*u("slotMinutes");c!=b&&(r||it(c),b=c)},stop:function(i,u){var f=g.stop();h();s("eventDragStop",t,n,i,u);f&&(l||c||r)?ut(this,n,l,r?0:c,r,i,u):(ot(),t.css("filter",""),t.css(w),it(0),y(n,t))}})}function wi(n,t,i){var r,f,e=v();t.resizable({handles:{s:"div.ui-resizable-s"},grid:e,start:function(i,u){r=f=0;p(n,t);t.css("z-index",9);s("eventResizeStart",this,n,i,u)},resize:function(s,h){r=Math.round((Math.max(e,t.height())-h.originalSize.height)/e);r!=f&&(i.text(k(n.start,!r&&!n.end?null:o(vt(n),u("slotMinutes")*r),u("timeFormat"))),f=r)},stop:function(i,f){s("eventResizeStop",this,n,i,f);r?oi(this,n,0,u("slotMinutes")*r,i,f):(t.css("z-index",8),y(n,t));i.stopImmediatePropagation()}})}var r=this;r.renderEvents=si;r.compileDaySegs=st;r.clearEvents=hi;r.slotSegHtml=ct;r.bindDaySeg=vi;ar.call(r);var u=r.opt,s=r.trigger,c=r.isEventDraggable,l=r.isEventResizable,vt=r.eventEnd,yt=r.reportEvents,pt=r.reportEventClear,d=r.eventElementHandlers,wt=r.setHeight,bt=r.getDaySegmentContainer,g=r.getSlotSegmentContainer,nt=r.getHoverListener,kt=r.getMaxMinute,tt=r.getMinMinute,it=r.timePosition,dt=r.colContentLeft,gt=r.colContentRight,ni=r.renderDaySegs,ui=r.resizableDayEvent,a=r.getColCnt,rt=r.getColWidth,v=r.getSlotHeight,fi=r.getBodyContent,ei=r.reportEventElement,y=r.showEvents,p=r.hideEvents,ut=r.eventDrop,oi=r.eventResize,et=r.renderDayOverlay,h=r.clearOverlays,ot=r.calendar,bi=ot.formatDate,k=ot.formatDates}function wt(r,u,s){function y(){c==t&&(c=n('<div class="fc-lv-scroller"><\/div>').appendTo(r))}function p(n){return lt(n,ft,h.start,h.end).sort(function(n,t){var i=f(n.event.start,n.event.allDay),r=f(t.event.start,t.event.allDay);return i<r?-1:i>r?1:n.event.title.toLowerCase()<t.event.title.toLowerCase()?-1:1})}function w(r){var ht,ii;v.call(h);for(var g=u.options.listView,it=new Date,k,rt,vt,ut,d,ft,nt,o,w,wt,bt,et,yt,b,ot,tt=g.timeFormat,ti=g.monthTitleFormat,st=(g.dayTitleFormat.indexOf("dddd")<0&&g.dayTitleFormat.indexOf("ddd")<0?"dddd, ":"")+g.dayTitleFormat,kt=p.call(h,r),s={},y=0;y<kt.length;++y){nt=kt[y];o=nt.event;w=f(nt.start,!0);wt=nt.end!=t?f(nt.end,!0):f(w);bt=typeof o.title=="string"?o.title.replace(/(.+)\.?\s*$/i,"$1"):"";et=typeof o.description=="string"?o.description.replace(/(.+)\.?\s*$/i,"$1"):"";yt='<tr class="event-row" id="event_'+o._id+'"><td class="time first"><span class="time">'+i(o.allDay?u.options.allDayText:a(o.start,o.end||o.start,tt))+'<\/span><\/td><td class="attachments">'+(o.hasAttachments?'<div class="has-attachments"><\/div>':"")+'<\/td><td class="bullet"><span class="bullet" style="color:'+i(o.source.isHidden?u.options.categories.inactiveColor:o.source.backgroundColor)+';">'+i(u.options.categories.itemBullet)+'&nbsp;<\/span><\/td><td class="title last'+(o.status==2?" fc-event-cancelled":"")+'"><span class="title '+(o.isTodo==!0&&o.completed==!0?"completed":"")+'">'+i(bt)+"<\/span>"+(et&&et.length>0?'<div class="note">'+DOMPurify.sanitize(et,{ADD_ATTR:["target"]})+"<\/div>":"")+"<\/td><\/tr>";for(var pt=w.getTime(),dt=!o.allDay&&o.start!=null?new Date(o.start.getFullYear(),o.start.getMonth(),o.start.getDate()):null,gt=!o.allDay&&o.end!=null?new Date(o.end.getFullYear(),o.end.getMonth(),o.end.getDate()):null;w<wt;e(w,1)){if(ht=null,!o.allDay&&dt!=null&&gt!=null){var ni=n(yt),ct=ni[0].firstChild.firstChild,lt=pt-dt.getTime(),at=gt.getTime()-pt;lt==0&&at==0?ct.innerHTML=l(o.start,tt)+"<span class='dash'><\/span>"+l(o.end,tt):lt==0&&at!=0?ct.innerHTML=l(o.start,tt)+"<span class='dash'><\/span><span>...<\/span>":lt!=0&&at==0?ct.innerHTML="<span>...<\/span><span class='dash'><\/span>"+l(o.end,tt):lt!=0&&at!=0&&(ct.innerHTML=u.options.allDayText);ht=ni[0].outerHTML;pt+=864e5}vt=l(w,ti);ut=w.getFullYear()==it.getFullYear()&&st.indexOf("yyyy")!=-1?l(w,st.substring(0,st.indexOf("yyyy"))):l(w,st);d="_"+encodeURIComponent(vt).replace(/[^a-z0-9_]/gi,"_");ft="_"+encodeURIComponent(ut).replace(/[^a-z0-9_]/gi,"_");s[d]===t&&(s[d]={title:'<div class="fc-lv-month-title">'+i(vt)+"<\/div>"});s[d][ft]===t&&(s[d][ft]={title:'<tr><th colspan="3"><span>'+i(ut.split(",")[0])+"<\/span><span>"+i(ut.split(",")[1])+"<\/span><\/th><\/tr>",today:it.getDate()==w.getDate()&&it.getMonth()==w.getMonth()&&it.getFullYear()==w.getFullYear(),events:[]});s[d][ft].events.push(ht!=null?ht:yt)}}ot=!0;b="";for(y in s)if(s[y].title!==t){h.showMonthTitle&&(b+=s[y].title,ot=!0);for(k in s[y])if(s[y][k].title!==t){for(b+='<table class="fc-lv-events'+(ot?(ot=!1," first"):"")+(s[y][k].today?" today":"")+'" border="0" cellspacing="0" cellpadding="0"><tbody><td style="width: 25%"><table><tbody>'+s[y][k].title+'<\/tbody><\/table><\/td><td style="width: 75%"><table style="width: 100%"><tbody>',rt=0;rt<s[y][k].events.length;++rt)b+=s[y][k].events[rt];b+="<\/tbody><\/table><\/td><\/tbody><\/table>"}}if(b.length>0){ii=c[0].clientWidth-6;c.html('<div">'+b+"<\/div>");c.find("table.fc-lv-events").find("tr:last").addClass("last");c.find("tr.event-row").on("click",function(t){var r=n(this),f=r.attr("id"),i=u.clientEvents(f.substring(f.search("event_")+6)),e;i.length>0&&i[0]&&(e=r.find(".title .title"),u.editEvent(e,i[0]),u.trigger("eventClick",this,i[0],t))})}else c.html('<div class="fc-lv-no-events">'+i(u.options.listView.noEventsMessage)+"<\/div>")}function v(){for(var n=c[0],t;t=n.lastChild;)n.removeChild(t)}function b(n){c.height(n)}function k(){}function d(){}function g(){}function nt(n){var t=f(n.start);return n.allDay?t:o(t,h.opt("defaultEventMinutes"))}function tt(){}function it(){}var h=this,l,a,c;h.renderBasic=y;h.renderEvents=w;h.clearEvents=v;h.setWidth=k;h.setHeight=b;h.beforeHide=d;h.afterShow=g;h.defaultEventEnd=nt;h.select=tt;h.unselect=it;h.showMonthTitle=!1;si.call(h,r,u,s);l=u.formatDate;a=u.formatDates}function kf(r,u){function y(n,i){var r,h,s;this.close();r=i.datepicker("getDate");w.call(o,n,r);o.visStart<=r&&r<o.visEnd&&(h=a(o.end,o.start),o.start=r,s=e(f(o.start),h),s>=o.visEnd?(o.end=o.visEnd=s,u.refetchEvents()):(o.end=s,o.eventsDirty=!0),c.call(o,t,s));u.gotoDate(r)}function p(n,t){var r,i,s;this.close();r=t.datepicker("getDate");i=e(f(r),1);c.call(o,n,i);r<o.visStart?(s=a(o.end,o.start),u.gotoDate(e(r,-s))):i>=o.visEnd?(o.end=o.visEnd=i,u.refetchEvents()):(o.end=i,u.rerenderEvents())}function w(i,r){var f=n(i),e=s(r,u.options.listView.headerDateFormat);f!=t&&f.length>0&&f.find(".inner").text(e);o.title.find(".from.link .inner").text(e)}function c(i,r){var h=n(i),c=s(e(f(r),-1),u.options.listView.headerDateFormat);h!=t&&h.length>0&&h.find(".inner").text(c);o.title.find(".to.link .inner").text(c)}function b(t,r){var c=u.options.listView,h=n('<span><span class="from link"><span class="inner">'+i(s(t,c.headerDateFormat))+'<\/span><\/span><span class="delimiter">&#8212;<\/span><span class="to link"><span class="inner">'+i(s(r,c.headerDateFormat))+"<\/span><\/span><\/span>");h.find(".from.link").on("click",function(){l.open(u,this,function(n){n.datepicker("setDate",o.start)},y)});h.find(".to.link").on("click",function(){l.open(u,this,function(n){n.datepicker("setDate",e(f(o.end),-1))},p)});return h}var o=this,s,v,h;wt.call(o,r,u,"list");s=u.formatDate;v=u.formatDates;this.render=function(n,t){var r,i;t&&e(n,t);h&&(r=a(o.end,o.start));h?(o.start=n<o.visStart||n>=o.visEnd?o.visStart=f(n,!0):f(n,!0),i=e(f(o.start),r),o.end=i<o.visStart||i>=o.visEnd?o.visEnd=i:i):(o.start=o.visStart=f(n,!0),o.end=o.visEnd=g(f(o.start),3));o.title=b.call(o,o.start,e(f(o.end),-1));o.renderBasic();h||(o.afterShow(),h=!0)};this.beforeHide=function(){var t=n("#fc_container .fc-header");t.find(".fc-button-next, .fc-button-prev").show()};this.afterShow=function(){var t=n("#fc_container .fc-header");t.find(".fc-button-next, .fc-button-prev").hide()}}function df(n,t){var i=this;wt.call(i,n,t,"listMonth");this.render=function(n,r){r&&(g(n,r),n.setDate(1));i.start=i.visStart=f(n,!0);i.start.setDate(1);i.end=i.visEnd=e(g(f(i.start),1),0);var u=new ot(t);i.title=u.render(i.name,i.start,i.end);i.renderBasic()}}function gf(n,t){var i=this;wt.call(i,n,t,"listWeek");this.render=function(n,r){var u,o,s;r&&e(n,r*7);u=e(f(n),-((n.getDay()-i.opt("firstDay")+7)%7));o=e(f(u),7);i.start=i.visStart=u;i.end=i.visEnd=o;s=new ot(t);i.title=s.render(i.name,i.start,e(f(i.end),-1));i.renderBasic()}}function ne(n,t){var i=this;wt.call(i,n,t,"listDay");this.render=function(n,r){r&&e(n,r);i.start=i.visStart=f(n,!0);i.end=i.visEnd=e(f(n,!0),1);var u=new ot(t);i.title=u.render(i.name,i.start,e(f(i.end),-1));i.renderBasic()}}function si(i,r,s){function rt(){return u.getElementRect(i)}function y(n,t){var i=p[n];return typeof i=="object"?at(i,t||s):i}function a(n,t){return r.trigger.apply(r,[n,t||h].concat(Array.prototype.slice.call(arguments,2),[h]))}function ut(n){return d(n)&&!y("disableDragging")}function ft(n){return d(n)&&!y("disableResizing")}function d(n){return ht(n.editable,(n.source||{}).editable,y("editable"))&&(n.source==t||u.objectIsEditable(n)||u.objectIsEditable(n.source)||n.source&&!n.source.isSubscription)}function et(n){c={};for(var r=n.length,t,i=0;i<r;i++)t=n[i],c[t._id]?c[t._id].push(t):c[t._id]=[t]}function g(n){return n.end?f(n.end):it(n)}function ot(n,t){k.push(t);l[n._id]?l[n._id].push(t):l[n._id]=[t]}function st(){k=[];l={}}function ct(i,u){if(n.browser.msie)u.on("mouseup",function(f){return!u.hasClass("ui-draggable-dragging")&&!u.hasClass("ui-resizable-resizing")&&!n(f.target).hasClass("ui-resizable-handle")?(r.editEvent(u,i),a("eventClick",this,i,f)):t});else u.on("click",function(f){return!u.hasClass("ui-draggable-dragging")&&!u.hasClass("ui-resizable-resizing")&&!n(f.target).hasClass("ui-resizable-handle")?(r.editEvent(u,i),a("eventClick",this,i,f)):t});u.on("mouseenter",function(n){a("eventMouseover",this,i,n)}).on("mouseleave",function(n){a("eventMouseout",this,i,n)})}function lt(n,t){nt(n,t,"show")}function vt(n,t){nt(n,t,"hide")}function nt(n,t,i){for(var u=l[n._id],f=u.length,r=0;r<f;r++)t&&u[r][0]==t[0]||u[r][i]()}function yt(n){return n._id!=t&&l[n._id]?l[n._id][0]:null}function pt(n,t,i,u,f,e,o){var h=t.allDay,s=t._id;t.isTodo?(w(c[s],i,u,f),r.todolist.updateTodo(t)):(w(c[s],i,u,f),a("eventDrop",n,t,i,u,f,function(){w(c[s],-i,-u,h);v(s,t)},e,o),v(s,t))}function wt(n,t,i,r,u,f){var e=t._id;tt(c[e],i,r);a("eventResize",n,t,i,r,function(){tt(c[e],-i,-r);v(e,t)},u,f);v(e,t)}function w(n,i,r,u){r=r||0;for(var f,h=n.length,s=0;s<h;s++)f=n[s],u!==t&&(f.allDay=u),o(e(f.start,i,!0),r),f.end?f.end=o(e(f.end,i,!0),r):u||(f.end=new Date(f.start.getFullYear(),f.start.getMonth(),f.start.getDate(),f.start.getHours(),f.start.getMinutes()+30)),b(f,p)}function tt(n,t,i){i=i||0;for(var r,f=n.length,u=0;u<f;u++)r=n[u],r.end=o(e(g(r),t,!0),i),b(r,p)}var h=this;h.element=i;h.calendar=r;h.name=s;h.opt=y;h.trigger=a;h.isEventDraggable=ut;h.isEventResizable=ft;h.reportEvents=et;h.eventEnd=g;h.reportEventElement=ot;h.reportEventClear=st;h.eventElementHandlers=ct;h.showEvents=lt;h.hideEvents=vt;h.eventDrop=pt;h.eventResize=wt;h.getEventElement=yt;h.getViewRect=rt;var it=h.defaultEventEnd,b=r.normalizeEvent,v=r.reportEventChange,c={},k=[],l={},p=r.options}function ar(){function lt(t,i,u){for(var s=t.length,o,e,h=i.children(),c,f=0;f<s;f++)o=t[f],e=n(h[f]),b(o,e),pt(o),wt(o,f,u),r("eventAfterRender",o.event,o.event,e);for(f=0,s=h.length;f<s;f++)if(e=h[f],e.className=="fc-event-info"){c=e.id.split("_");n(e).on("click",{row:c[1],col:c[2],segs:t},bt)}rr(i,t,v)}function at(n,i){var r=a();r[0].innerHTML=w(n);lt(n,r,i);typeof t._afterRenderDaySegs=="function"&&t._afterRenderDaySegs(n)}function vt(t,i,u,f){for(var c=t.length,s,o,l=i.children(),h=[],e=0;e<c;e++)s=t[e],o=n(l[e]),b(s,o),r("eventAfterRender",s.event,s.event,o),o=t[e].element,o&&(t[e].row===u&&o.css("top",f),h.push(o[0]));return n(h)}function yt(n,t,i){var r=a();return r[0].innerHTML=w(n),vt(n,r,t,i)}function w(n){var dt=u("isRTL"),ot,fi=n.length,r,f,e,gt=ut(),ni=gt.left,ti=gt.right,tt,it,rt,lt,st,c="",l=ASC.CalendarSizeManager.cache,ft=0,ht=0,et,a,ei=l.fcMonthContentCellContentVSides,ii=l.fcMonthContentCellContentSegmentHSides,ri=l.fcMonthContentCellContentSegmentHeight+ii,v={},at=0,vt,p,ct,b,g,yt,ui,pt,wt,w,bt,kt,nt;for(t.name=="month"?(ft=l.fcMonthContentTheadHeight,ht=l.fcMonthContentCellNumberHeight,et=document.querySelector(".fc-content .fc-view-month .fc-day-content"),a=parseFloat(et.style.height)+ei):t.name=="agendaWeek"?(et=document.querySelector(".fc-content .fc-view-agendaWeek .fc-agenda-allday .fc-day-content"),a=l.fcMonthContentCellContentMaxHeight):t.name=="agendaDay"&&(et=document.querySelector(".fc-content .fc-view-agendaDay .fc-agenda-allday .fc-day-content"),a=l.fcMonthContentCellContentMaxHeight),ot=0;ot<fi;ot++){if(r=n[ot],f=r.event,vt=!1,t.calendar.openEventWin&&f.objectId==t.calendar.openEventWin.objectId&&(vt=!0),e=f.sourceId=="users_birthdays"?["fc-event","fc-event-skin","fc-event-birthdays"]:["fc-event",f.allDay?"fc-event-skin-day":"fc-event-skin",f.isTodo&&f.completed?"fc-todo-completed":"",vt?f.isTodo?"fc-todo-open":"fc-event-open":"","fc-event-hori",k(f)?"fc-event-draggable":""],dt?(r.isStart&&e.push("fc-corner-right"),r.isEnd&&e.push("fc-corner-left"),tt=s(r.end.getDay()-1),it=s(r.start.getDay()),rt=r.isEnd?o(tt):ni,lt=r.isStart?h(it):ti):(r.isStart&&e.push("fc-corner-left"),r.isEnd&&e.push("fc-corner-right"),tt=s(r.start.getDay()),it=s(r.end.getDay()-1),rt=r.isStart?o(tt):ni,lt=r.isEnd?h(it):ti),e=e.concat(f.className),f.source&&(e=e.concat(f.source.className||[])),r.left=rt,r.outerWidth=lt-rt,r.startCol=tt,r.endCol=it+1,r.hsides=ii,r.outerHeight=ri,r.top=r.outerHeight*r.level+(r.row*(ht+a)+ht+l.fcMonthContentCellVBorders*r.row)+ft,at<r.level&&(at=r.level),st=or(f,u,t.name),p="",r.isStart==!1&&r.isEnd==!0?(e.push("fc-segm-right"),p="width:"+(Math.max(0,r.outerWidth-r.hsides)-10)+"px;"):r.isStart==!0&&r.isEnd==!1?(e.push("fc-segm-left"),p="width:"+(Math.max(0,r.outerWidth-r.hsides)-10)+"px;"):r.isStart==!1&&r.isEnd==!1?(e.push("fc-segm-right"),e.push("fc-segm-left"),p="width:"+(Math.max(0,r.outerWidth-r.hsides)-20)+"px;"):p="width:"+Math.max(0,r.outerWidth-r.hsides)+"px;",p+="top:"+r.top+"px;",t.name=="month"?ct=(r.row+1)*(ht+a)+ft:t.name=="agendaWeek"?ct=a+ft:t.name=="agendaDay"&&(ct=a+ft),r.top+r.outerHeight>ct-r.outerHeight)for(p+="display: none;",b=r.startCol;b<r.endCol;)g="cell_"+r.row+"_"+b,v[g]||(v[g]={seg:r,text:""}),v[g].width=h(b)-o(b),v[g].left=o(b),yt=v[g].text.match(/(\d+)/),ui=parseInt(yt?yt[1]:0,10)||0,v[g].text=t.calendar.options.moreEventsLabel.replace("%d",ui+1),b++;pt=f.hasAttachments;wt=pt?"fc-event-inner-with-attachments":"";c+="<div class='"+e.join(" ")+"' style='position:absolute;z-index:7;left:"+rt+"px;"+p+st+"'><div"+(f.allDay&&f.sourceId!="users_birthdays"?" class='fc-event-inner "+wt+" fc-event-skin-day'":" class='fc-event-inner "+wt+" fc-event-skin'")+(st?" style='"+st+"'":"")+">";f.sourceId=="users_birthdays"?(w=i(f.source?f.source.backgroundColor:f.backgroundColor||t.calendar.options.eventBackgroundColor),c+='<div class=\'birthday_icon\'><svg width="12" height="13" viewBox="0 0 12 13" fill="'+w+'" xmlns="http://www.w3.org/2000/svg"><path d="M0.947174 1.5C1.04808 2.00458 1.34961 2.00298 1.83701 2.00039C1.87273 2.0002 1.90945 2 1.94717 2C1.98488 2 2.02161 2.00019 2.05731 2.00038C2.54475 2.00294 2.84619 2.00452 2.9471 1.5C3.08517 0.809662 1.94717 0 1.94717 0C1.94717 0 0.809097 0.809647 0.947174 1.5Z" fill="'+w+'"/><path d="M1 3H3V5H5V3H7V5H9V3H11V5.26756C11.3804 5.48759 11.6815 5.82929 11.8503 6.23945L10.4472 6.94098L8.67085 6.05279C8.53009 5.9824 8.3644 5.9824 8.22363 6.05279L6.44724 6.94098L4.67085 6.05279C4.53009 5.9824 4.3644 5.9824 4.22363 6.05279L2.44724 6.94098L0.670853 6.05279C0.536514 5.98562 0.379471 5.98255 0.243073 6.04359C0.419281 5.72059 0.681961 5.45154 1 5.26756V3Z" fill="'+w+'"/><path d="M5.8371 2.00039C5.3497 2.00298 5.04808 2.00458 4.94717 1.5C4.8091 0.809647 5.94717 0 5.94717 0C5.94717 0 7.08517 0.809662 6.9471 1.5C6.84619 2.00452 6.54485 2.00294 6.05754 2.00038C6.02174 2.00019 5.985 2 5.94727 2C5.92973 2 5.9124 2.00005 5.89529 2.00011C5.87561 2.00018 5.85622 2.00029 5.8371 2.00039Z" fill="'+w+'"/><path d="M8.95889 1.5C9.0598 2.00452 9.35118 2.00298 9.83711 2.00039C9.87279 2.0002 9.9095 2 9.94727 2C9.98497 2 10.0217 2.00019 10.0576 2.00038C10.5463 2.00294 10.8579 2.00457 10.9588 1.5C11.0969 0.809662 9.95889 0 9.95889 0C9.95889 0 8.82082 0.809647 8.95889 1.5Z" fill ="'+w+'"/><path d="M10.6709 7.94721L12 7.28263V9.1646L10.4472 9.94098L8.67085 9.05279C8.53009 8.9824 8.3644 8.9824 8.22363 9.05279L6.44724 9.94098L4.67085 9.05279C4.53009 8.9824 4.3644 8.9824 4.22363 9.05279L2.44724 9.94098L0.670853 9.05279C0.530075 8.9824 0.364395 8.9824 0.223633 9.05279L0 9.1646V7.28263L0.447235 7.05901L2.22363 7.94721C2.3644 8.01759 2.53008 8.01759 2.67085 7.94721L4.44724 7.05901L6.22363 7.94721C6.3644 8.01759 6.53009 8.01759 6.67085 7.94721L8.44724 7.05901L10.2236 7.94721C10.3644 8.01759 10.5301 8.01759 10.6709 7.94721Z" fill="'+w+'"/><path d="M10.6709 10.9472L12 10.2826V11C12 12.1046 11.1046 13 10 13H2C0.895432 13 0 12.1046 0 11V10.2826L0.447235 10.059L2.22363 10.9472C2.3644 11.0176 2.53008 11.0176 2.67085 10.9472L4.44724 10.059L6.22363 10.9472C6.3644 11.0176 6.53009 11.0176 6.67085 10.9472L8.44724 10.059L10.2236 10.9472C10.3644 11.0176 10.5301 11.0176 10.6709 10.9472Z" fill="'+w+'"/><\/svg ><\/div>'):!f.allDay&&r.isStart?(c+="<span class='fc-event-time'>"+i(y(f.start,f.end,u("timeFormat")))+"&nbsp;<\/span>",c+="<span class='bullet' style='color:"+i(f.source?f.source.backgroundColor:f.backgroundColor||t.calendar.options.eventBackgroundColor)+";'>"+i(t.calendar.options.categories.itemBullet)+"&nbsp;<\/span>"):c+="<span>&nbsp;<\/span>";bt=i(f.title);c+="<span class='fc-event-title"+(f.status==2?" fc-event-cancelled":"")+"' title='"+bt+"'>"+bt+"<\/span><\/div>";pt&&(c+='<div class="fc-event-has-attachments"><\/div>');r.isEnd&&d(f)&&f.allDay&&(c+=f.isTodo==!0?"":"<div class='ui-resizable-handle ui-resizable-"+(dt?"w":"e")+"'>&nbsp;&nbsp;&nbsp;<\/div>");c+="<\/div>"}for(kt in v)nt=v[kt],c+="<div id='"+kt+"' style='width:"+nt.width+"px;top:"+nt.seg.top+"px;left:"+nt.left+"px;height:"+nt.seg.outerHeight+"px;line-height:"+nt.seg.outerHeight+"px;' class='fc-event-info'>"+nt.text+"<\/div>";return(t.name=="agendaWeek"||t.name=="agendaDay")&&(et.style.height=Math.min(ri*(at+2),a)+"px"),c}function b(t,i){var f=t.event,u=r("eventRender",f,f,i);u===!1?i.remove():(u&&u!==!0&&(u=n(u).css({position:"absolute",left:t.left}),i.replaceWith(u),i=u),t.element=i)}function pt(n){n.element&&nt(n.event,n.element)}function wt(n,t,i){var r=n.element,u;r&&(u=n.event,u._id===i?v(u,r,n):r[0]._fci=t)}function bt(r){var nt=t.calendar.options,tt=n(this),w=tt.parent(),u=w.find("#cell_popup"),p,o,e,s,g;if(u.length<1){u=n("<div id='cell_popup' class='fc-event-popup'><\/div>");n(document).on("mouseup",function(i){u.has(i.target).length===0&&n(i.target)[0].id!=u[0].id&&(t.calendar.isEditingEvent()||u.hide())});document.onkeydown=function(i){i=i||window.event;i.keyCode===27&&u.has(i.target).length===0&&n(i.target)[0].id!==u[0].id&&(t.calendar.isEditingEvent()||u.hide())};u.appendTo(w)}var f=ct(r.data.row,r.data.col),a=f.right-f.left,v=f.bottom-f.top,it=f.wratio||1.4,rt=f.hratio||1.4;for(u.width(Math.floor(a*it)),u.height("auto"),p=et(r.data),u.empty(),u.append(n("<div class='fc-day-number'>"+i(nt.dayNames[p.getDay()]+", "+y(p,null,t.calendar.options.popupCellFormat))+"<\/div>")),u.show(),o=0;o<r.data.segs.length;++o)e=r.data.segs[o],e.row==r.data.row&&e.startCol<=r.data.col&&r.data.col<e.endCol&&(s=e.element.clone(),s.css("display","block").css("left","").css("top","").css("position","").css("width","auto").show(),t.eventElementHandlers(e.event,s),u.append(s));u.find(".ui-resizable-e").remove();var b=Math.floor(v*rt),k=u.height(),ut=b>k?b:k;u.height(ut);var d=u.outerWidth(!0),ft=r.data.col==0?f.left+1:r.data.col==l()-1?Math.floor(f.left-(d-a))-1:Math.floor(f.left-(d-a)*.5),h=u.outerHeight(!0);h>190?(u.css("overflow-y","auto").css("overflow-x","hidden").css("max-height","190px"),h=190):u.css("overflow-y","hidden");g=r.data.row==0?f.top+1:r.data.row==c()-1?Math.floor(f.top-(h-v))-1:Math.floor(f.top-(h-v)*.5);u.css("left",ft+"px");u.css("top",g+"px")}function kt(i,o,s){var h=u("isRTL"),a=h?"w":"e",y=o.find("div.ui-resizable-"+a),v=!1;fi(o);o.on("mousedown",function(n){n.preventDefault()}).on("click",function(n){v&&(n.preventDefault(),n.stopImmediatePropagation())});y.on("mousedown",function(u){function at(u){r("eventResizeStop",this,i,u);n("body").css("cursor","");k.stop();p();w?rt(this,i,w,0,u):t.calendar.rerenderEvents();setTimeout(function(){v=!1},0)}if(u.which==1){v=!0;var k=t.getHoverListener(),et=c(),ct=l(),d=h?-1:1,nt=h?ct-1:0,lt=o.css("top"),w,y,ut=n.extend({},i),b=ft(i.start);ht();n("body").css("cursor",a+"-resize").one("mouseup",at);r("eventResizeStart",this,i,u);k.start(function(n,t){var u,r,o,c;n&&(u=Math.max(b.row,n.row),r=n.col,et==1&&(u=0),u==b.row&&(r=h?Math.min(b.col,r):Math.max(b.col,r)),w=u*7+r*d+nt-(t.row*7+t.col*d+nt),o=e(g(i),w,!0),w?(ut.end=o,c=y,y=yt(ot([ut]),s.row,lt),y.find("*").css("cursor",a+"-resize"),c&&c.remove(),it(i)):y&&(tt(i),y.remove(),y=null),p(),st(i.start,e(f(o),1)))},u)}})}var t=this;t.renderDaySegs=at;t.resizableDayEvent=kt;var u=t.opt,r=t.trigger,k=t.isEventDraggable,d=t.isEventResizable,g=t.eventEnd,nt=t.reportEventElement,tt=t.showEvents,it=t.hideEvents,rt=t.eventResize,c=t.getRowCnt,l=t.getColCnt,dt=t.getColWidth,gt=t.allDayRow,ut=t.allDayBounds,o=t.colContentLeft,h=t.colContentRight,s=t.dayOfWeekCol,ft=t.dateCell,et=t.cellDate,ot=t.compileDaySegs,a=t.getDaySegmentContainer,v=t.bindDaySeg,y=t.calendar.formatDates,st=t.renderDayOverlay,p=t.clearOverlays,ht=t.clearSelection,ct=t.getCellBounds}function vr(){function c(n,t,i){r();t||(t=h(n,i));e(n,t,i)}function r(n){u&&(u=!1,o(),f("unselect",null,n))}function s(n,i,r,e){u=!0;t.calendar.addAndEditEvent(n,i,r);f("select",null,n,i,r,e);t.calendar.unselect()}function l(u){var h=t.cellDate,l=t.cellIsAllDay,c=t.getHoverListener(),a=t.reportDayClick,v,f;if(u.which==1&&i("selectable")){r(u);v=this;c.start(function(n,t){o();n&&l(n)?(f=[h(t),h(n)].sort(er),e(f[0],f[1],!0)):f=null},u);n(document).one("mouseup",function(n){c.stop();f&&(+f[0]==+f[1]&&a(f[0],!0,n),s(f[0],f[1],!0,n))})}}var t=this;t.select=c;t.unselect=r;t.reportSelection=s;t.daySelectionMousedown=l;var i=t.opt,f=t.trigger,h=t.defaultSelectionEnd,e=t.renderSelection,o=t.clearSelection,u=!1;if(i("selectable")&&i("unselectAuto"))n(document).on("mousedown",function(t){var u=i("unselectCancel");u&&n(t.target).parents(u).length||r(t)})}function yr(){function u(r,u){var f=i.shift();return f||(f=n("<div class='fc-cell-overlay' style='position:absolute;z-index:3'><\/div>")),f[0].parentNode!=u[0]&&f.appendTo(u),t.push(f.css(r).show()),f}function f(){for(var n;n=t.shift();)i.push(n.hide().off())}var r=this,t,i;r.renderOverlay=u;r.clearOverlays=f;t=[];i=[]}function pr(n){var r=this,t,i;this.build=function(){t=[];i=[];n(t,i)};this.cell=function(n,r){for(var o=t.length,s=i.length,f=-1,e=-1,u=0;u<o;u++)if(r>=t[u][0]&&r<t[u][1]){f=u;break}for(u=0;u<s;u++)if(n>=i[u][0]&&n<i[u][1]){e=u;break}return f>=0&&e>=0?{row:f,col:e}:null};this.rect=function(n,r,u,f,e){var o=e.offset();return{top:t[n][0]-o.top,left:i[r][0]-o.left,width:i[f][1]-i[r][0],height:t[u][1]-t[n][0]}}}function wr(t){function e(n){ie(n);var u=t.cell(n.pageX,n.pageY);(!u!=!r||u&&(u.row!=r.row||u.col!=r.col))&&(u?(i||(i=u),f(u,i,u.row-i.row,u.col-i.col)):f(u,i),r=u)}var o=this,u,f,i,r;o.start=function(o,s,h){f=o;i=r=null;t.build();e(s);u=h||"mousemove";n(document).on(u,e)};o.stop=function(){return n(document).off(u,e),r}}function br(n){function f(t){return u[t]=u[t]||n(t)}var e=this,u={},i={},r={};this.left=function(n){return i[n]=i[n]===t?f(n).position().left:i[n]};this.right=function(n){return r[n]=r[n]===t?e.left(n)+f(n).width():r[n]};this.clear=function(){u={};i={};r={}}}function te(n){function t(n,t,i){n.attachEvent?n.attachEvent("on"+t,i):n.addEventListener&&n.addEventListener(t,i,!1)}function r(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.clear&&document.selection.clear()}function u(n){var n=n||window.event,i=n.target||n.srcElement,t;i.tagName.match(/INPUT|TEXTAREA/i)||(t=n.keyCode||n.which,n.ctrlKey&&t=="A".charCodeAt(0)&&(r(),n.preventDefault?n.preventDefault():n.returnValue=!1))}var i=!1;t(n,"mousemove",function(){i&&r()});t(n,"mousedown",function(n){var n=n||window.event,t=n.target||n.srcElement;i=!t.tagName.match(/INPUT|TEXTAREA/i)});t(n,"mouseup",function(){i&&r();i=!1});t(n,"keydown",u);t(n,"keyup",u)}function ie(n){n.pageX===t&&(n.pageX=n.originalEvent.pageX,n.pageY=n.originalEvent.pageY)}var h=function(){return{defaultView:"month",aspectRatio:1.35,minHeight:500,header:{left:"prev,next,title",center:"",right:""},weekends:!0,weekMode:"fixed",editable:!0,allDayDefault:!0,ignoreTimezone:!0,lazyFetching:!0,startParam:"start",endParam:"end",titleFormat:{month:"MMMM yyyy",week:"MMM d",day:"ddd, MMM d, yyyy"},columnFormat:{month:"dddd",week:"'<div style=\"white-space: nowrap;\"><div class=\"fc-head-col-name\">'dddd'<\/div>' '<span class=\"number fc-head-col-number\">'dd'<\/span><\/div>'",day:"'<div class=\"center\">'dddd'&nbsp;&nbsp;'d'<\/div>'"},timeFormat:{"":"h(:mm)t",agenda:"h:mm{ - h:mm}"},allDaySlot:!0,allDayText:"all-day",firstHour:6,slotMinutes:30,defaultEventMinutes:1,axisFormat:"h(:mm)tt",dragOpacity:{agenda:.5},minTime:0,maxTime:24,isRTL:!1,firstDay:0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],buttonText:{prev:'<span class="triangle-w">&nbsp;<\/span>',next:'<span class="triangle-e">&nbsp;<\/span>',prevYear:"&nbsp;&lt;&lt;&nbsp;",nextYear:"&nbsp;&gt;&gt;&nbsp;",today:"Today",month:"Month",week:"Week",day:"Day",list:"List",todo:"Todo"},defaultTimeZone:{name:"UTC:00",id:"UTC",offset:0},theme:!1,buttonIcons:{prev:"circle-triangle-w",next:"circle-triangle-e"},selectable:!0,selectHelper:!0,unselectAuto:!0,dropAccept:"*",eventTextColor:"#000",eventBackgroundColor:"#87CEFA",eventBorderColor:"#297FB4",eventBg2BorderRatio:.8,eventMaxTitleLength:250,todayLabel:"Today",moreEventsLabel:"events",addNewEventLabel:"Add event",addNewLabel:"Create",modes:{calendarViewLabel:"Calendar view",listViewLabel:"List view"},sharedList:{title:"Shared with:",moreLink:"Show %d more users",addLink:"Add users for sharing",shortListLength:5},categories:{width:201,itemBullet:"&#9632;",inactiveColor:"#aaa",defaultTitle:"New calendar",title:"My Calendars",addNewCategoryLabel:"Add",dialogTemplate:"",dialogHeader_add:"Add new calendar",dialogHeader_edit:"Edit calendar",dialogColor_label:"Color:",dialogTextColor_label:"Text color:",dialogTimezoneLabel:"Timezone:",dialogButton_save:"Save",dialogButton_cancel:"Cancel",dialogButton_delete:"Delete",dialogErrorMassageSpecCharacter:"The title cannot contain any of the following characters: {0}",dialogCopyMessage:"Link has been copied to the clipboard",subscriptionsTitle:"Subscriptions",subscriptionsDialog:"",subscriptionsDialogHeader:"Edit subscription",subscriptionsDialogOwnerLabel:"Owner:",subscriptionsDialogButton_unsubscribe:"Unsubscribe",subscriptionsManageLabel:"Manage",subscriptionsManageDialog:"",subscriptionsManageDialog_title:"Manage subscriptions",subscriptionsManageDialog_qsearchText:"Quick search",subscriptionsManageDialogButton_save:"Save",subscriptionsManageDialogButton_cancel:"Cancel",datepickerHideLabel:"Hide mini calendar",datepickerShowLabel:"Show mini calendar",dayFormat:"d",monthFormat:"MMMM",yearFormat:"yyyy"},todoList:{title:"To-do",hideLabel:"Hide ToDo List",showLabel:"Show ToDo List",addTodoLabel:"New todo",newTodoTitle:"new todo",overdue:"Overdue",noDueDate:"No due date",menuTemplate:"",deleteIcon:"",editIcon:"",settingsIcon:"",menu:{hideColmpletedTodos:{hide:"Hide completed items",show:"Show completed items"},deleteCompletedTodos:"Delete completed items"},sortByCalendarLabel:"Sort by calendar",sortByPriorityLabel:"Sort by priority",sortAlphabeticallyLabel:"Sort alphabetically",menuTodoInCalendar:"Show to-do in calendar",menuDeleteMarkedTodo:"Hide to-do marked as done on page load",menuSyncLinks:"Export and Sync"},deleteTodoDialog:{dialogTemplate:"",dialogHeader:"Delete todo",dialogSingleBody:"The deleted todo cannot be restored. Are you sure you want to continue?",dialogButton_apply:"Apply",dialogButton_cancel:"Cancel"},todoEditor:{dialogTemplate:"",dialogHeader_add:"Create todo",dialogHeader_edit:"Edit todo",dialogDateLabel:"Date",titleLabel:"Title",descriptionLabel:"Description",dialogButton_save:"Save",dialogButton_cancel:"Cancel"},todoViewer:{dialogTemplate:"",dialogButton_mark_on:"Mark as done",dialogButton_mark_off:"Mark as not done",dialogButton_edit:"Edit",dialogButton_delete:"Delete"},eventEditor:{dateFormat:"yyyy-MM-dd",timeFormat:"HH:mm",newEventTitle:"New event",dialogTemplate:"",dialogHeader_add:"Add new event",dialogSummaryLabel:"Event name:",eventButton:"Event",todoButton:"Todo",dialogLocationLabel:"Where:",dialogAttendeesLabel:"Guests:",dialogOwnerLabel:"Owner:",dialogOrganizerLabel:"Organizer:",dialogAllDayLabel:"All-day event",dialogSentInvitations:"Sent invitations",dialogAllDay_no:"This event is not all-day.",dialogAllDay_yes:"This is all-day event.",dialogFromLabel:"From:",dialogToLabel:"To:",dialogRepeatLabel:"Repeat:",dialogStatusLabel:"Status:",dialogRepeatOption_never:"never",dialogRepeatOption_day:"every day",dialogRepeatOption_week:"every week",dialogRepeatOption_month:"every month",dialogRepeatOption_year:"every year",dialogAlertLabel:"Alert:",dialogAlertOption_default:"default",dialogAlertOption_never:"never",dialogAlertOption_5minutes:"5 minutes",dialogAlertOption_15minutes:"15 minutes",dialogAlertOption_30minutes:"half an hour",dialogAlertOption_hour:"an hour",dialogAlertOption_2hours:"2 hours",dialogAlertOption_day:"a day",dialogSharing_no:"This event is not shared.",dialogCalendarLabel:"Calendar:",dialogDescriptionLabel:"Description:",dialogButton_edit:"Edit",dialogButton_save:"Save",dialogButton_close:"Close",dialogButton_cancel:"Cancel",dialogButton_delete:"Delete",dialogButton_unsubscribe:"Unsubscribe",dialogButton_moreDetails:"More details",dialogButton_details:"Details",dialogRepeatOption_custom:"настройка",dialogHeader_createEvent:"Create new event",dialogHeader_editEvent:"Edit event",dialogHeader_viewEvent:"View event"},repeatSettings:{dateFormat:"yyyy-MM-dd",timeFormat:"HH:mm",dialogTemplate:"",dialogHeader:"Recurrence setup",dialogFromLabel:"starting with",dialogToLabel:"end",dialogOptionNever:"never",dialogOptionDate:"date",dialogOptionCount:"number of times",dialogAfterLabel:"after",dialogTimesLabel:"times",dialogRepeatOnLabel:"by",dialogRepeatOn_days:"days",dialogRepeatOn_weeks:"weeks",dialogRepeatOn_months:"months",dialogRepeatOn_years:"years",dialogEachLabel:"every",dialogAliasLabel:"every",dialogIntervalOption_day:"day",dialogIntervalOption_week:"week",dialogIntervalOption_month:"month",dialogIntervalOption_year:"yesr",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayIndexResponse:{su:0,mo:1,tu:2,we:3,th:4,fr:5,sa:6},dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayAliasNames:["first","second","third","last but one","last"],dialogButton_save:"Save",dialogButton_cancel:"Cancel"},deleteSettings:{dialogTemplate:"",dialogHeader:"Delete recurring event",dialogSingleHeader:"Delete event",dialogSingleBody:"The deleted event cannot be restored. Are you sure you want to continue?",dialogDeleteOnlyThisLabel:"This event only",dialogDeleteFollowingLabel:"This event and all that follow",dialogDeleteAllLabel:"All events in the series",dialogButton_save:"Apply",dialogButton_cancel:"Cancel"},confirmPopup:{dialogTemplate:"",dialogAddEventHeader:"Sending invitations",dialogUpdateEventHeader:"Sending updates",dialogDeleteEventHeader:"Sending cancellations",dialogAddEventBody:"Would you like to send invitations to guests?",dialogUpdateEventBody:"Would you like to send updates to existing guests?",dialogUpdateGuestsBody:"Would you like to send updates only to new guests and cancellations or just everyone?",dialogDeleteEventBody:"Would you like to send cancellations to existing guests?",dialogSuccessToastText:"Notifications successfully sent",dialogErrorToastText:"An error occurred while sending notifications",dialogButtonSend:"Send",dialogButtonSendCustoms:"New guests and cancellations",dialogButtonSendEveryone:"Everyone",dialogButtonDontSend:"Don't Send"},icalStream:{dialogTemplate:"",newiCalTitle:"Calendar from iCal feed",importEventsTitle:"Import events",dialogHeader:"Calendar event export",dialogDescription:"Use the following address to access your calendar from other applications. You can copy and enter this information into any calendar supporting iCal format. You can save the data into a file in iCal format and export the events into another calendar or application.",dialogCaldavHelp:"Connection instructions in the ",dialogHelpCenter:"Help Center",dialogTodoDescription:"To configure the export of todos  to another calendar, copy the corresponding link and add it to the required calendar.",dialogImportExportLabel:"Import/Export",dialogStreamLink:"Export events from ONLYOFFICE calendar",dialogImportLabel:"Import events into ONLYOFFICE calendar",dialogImportLabelNew:"Select iCal file",dialogExportLink:"Export and Sync",dialogButton_fileSelected:"file is selected",dialogButton_fileNotSelected:"no file is selected",dialog_incorrectFormat:"Wrong format of the iCal file",dialogInputiCalLabel:"Enter the iCal feed link",dialogSavediCalLabel:"iCal feed link:",dialogButton_close:"Close",dialogButton_browse:"Select file"},dayView:{dateFormat:{topText:"dddd",bigText:"d",bottomText:"MMMM,'<br/>' yyyy"},todayTasksTitle:"Today's tasks",alldayTasksTitle:"All-day tasks"},taskListTimeFormat:"HH:mm{[ - HH:mm]}",listView:{headerDateFormat:"MM/dd/yy",monthTitleFormat:"MMMM yyyy",dayTitleFormat:"ddd, MMM d, yyyy",timeFormat:"HH:mm",noEventsMessage:"There are no events to show."},popupCellFormat:"dd.MM.yy",attachments:{bytes:"B",kilobytes:"KB",megabytes:"MB",maxFileSizeInMegaBytes:15,attachDeleteAllLabel:"Delete All",attachFilesFromDocuments:"Attach files from Documents",attachmentsLabelHelpInfo:"All documents will be with access rights 'Read only' for guests",copyFileToMyDocumentsFolderErrorMsg:"Error occured while copying file",copyFilesToMyDocumentsBtn:"Copy to 'My documents'",copyingToMyDocumentsLabel:"Copying to 'My documents' folder",documentAccessDeniedError:"Access to the document is denied.",emptyFileNotSupportedError:"Empty files are not supported.",executableWarning:"executable files may be not allowed by some services (e.g. Gmail)",fileSizeError:"Size of attachment exceeds limit.",insertedViaLink:"Inserted via link",limitLabel:"Note: the file size must not exceed {0} MB.",uploadFile:"Upload file",uploadedLabel:"Uploaded",uploadingLabel:"Uploading",warningLabel:"Warning"}}}(),kr=function(){return{header:{left:"",center:"next,title,prev",right:""},buttonText:{prev:"&nbsp;&#9658;&nbsp;",next:"&nbsp;&#9668;&nbsp;",prevYear:"&nbsp;&gt;&gt;&nbsp;",nextYear:"&nbsp;&lt;&lt;&nbsp;"},buttonIcons:{prev:"circle-triangle-e",next:"circle-triangle-w"}}}(),c=n.fullCalendar={version:"2.0.1"},tt=function(){var n={};return n.DefaultPicker=["#F48454","#FFB45E","#FFD267","#B7D269","#6BBD72","#77CF9A","#6AC6DD","#4682B6","#6A9AD2","#8A98D8","#7E6EB2","#B58FD6","#D28CC8","#E795C1","#F2A9BE","#DF7895"],n.TextPicker=["#FFF","#000"],n}(),p=c.views={},r=function(){var i={};return i.hideMenus=function(n){for(var i in this)if(this.hasOwnProperty(i)){if(typeof this[i]=="function")continue;if(/.+Menu$/i.test(i)){if(n!==t&&n==this[i])continue;this[i].popupMenu("close")}}},i.createHeaderYearMenu=function(t){var i=t.getDate().getFullYear();!this.headerYearMenu||this.headerYearMenu.length<1?this.headerYearMenu=n("<div id='fc_header_year_menu'><\/div>"):(this.headerYearMenu.popupMenu("close"),this.headerYearMenu.popupMenu("destroy"));this.headerYearMenu.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",arrowPosition:"50%",showArrow:!1,cssClassName:"asc-popupmenu",items:[(i+3).toString(),(i+2).toString(),(i+1).toString(),"divider",(i-1).toString(),(i-2).toString(),(i-3).toString()],itemClick:function(n,i){var r=t.getDate();r.setFullYear(parseInt(i.item,10));t.gotoDate(r)}})},i.createHeaderMonthMenu=function(t){!this.headerMonthMenu||this.headerMonthMenu.length<1?this.headerMonthMenu=n("<div id='fc_header_month_menu'><\/div>"):(this.headerMonthMenu.popupMenu("close"),this.headerMonthMenu.popupMenu("destroy"));this.headerMonthMenu.popupMenu({anchor:"left,bottom",direction:"right,down",arrow:"up",arrowPosition:"50%",showArrow:!1,cssClassName:"asc-popupmenu",items:t.options.monthNames,itemClick:function(n,i){var r=t.getDate();r.setMonth(i.itemIndex);t.gotoDate(r)}})},i.buildTitleMenus=function(n,i){var r=this,f=t,u;i.find(".month").on("click",function(){f&&f==this||(f=this,r.createHeaderMonthMenu(n));r.hideMenus(r.headerMonthMenu);r.headerMonthMenu.popupMenu("open",this)});u=t;i.find(".year").on("click",function(){u&&u==this||(u=this,r.createHeaderYearMenu(n));r.hideMenus(r.headerYearMenu);r.headerYearMenu.popupMenu("open",this)})},i}(),u=function(){var r={};return r.rgbToHsv=function(n,t,i){n=n/255;t=t/255;i=i/255;var r=Math.max(n,t,i),e=Math.min(n,t,i),u,o,s=r,f=r-e;if(o=r==0?0:f/r,r==e)u=0;else{switch(r){case n:u=(t-i)/f+(t<i?6:0);break;case t:u=(i-n)/f+2;break;case i:u=(n-t)/f+4}u/=6}return[u,o,s]},r.hsvToRgb=function(n,t,i){var r,u,f,h=Math.floor(n*6),c=n*6-h,e=i*(1-t),o=i*(1-c*t),s=i*(1-(1-c)*t);switch(h%6){case 0:r=i;u=s;f=e;break;case 1:r=o;u=i;f=e;break;case 2:r=e;u=i;f=s;break;case 3:r=e;u=o;f=i;break;case 4:r=s;u=e;f=i;break;case 5:r=i;u=e;f=o}return[Math.floor(r*255),Math.floor(u*255),Math.floor(f*255)]},r.rgbToHsl=function(n,t,i){var f;n/=255;t/=255;i/=255;var r=Math.max(n,t,i),e=Math.min(n,t,i),u=0,o=0,s=(r+e)/2;if(r==e)u=o=0;else{f=r-e;o=s>.5?f/(2-r-e):f/(r+e);switch(r){case n:u=(t-i)/f+(t<i?6:0);break;case t:u=(i-n)/f+2;break;case i:u=(n-t)/f+4}u/=6}return[u,o,s]},r.hslToRgb=function(n,t,i){var f,e,o,r,u;if(t==0)f=e=o=i;else{function s(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}r=i<.5?i*(1+t):i+t-i*t;u=2*i-r;f=s(u,r,n+1/3);e=s(u,r,n);o=s(u,r,n-1/3)}return[Math.floor(f*255),Math.floor(e*255),Math.floor(o*255)]},r.randomHex=function(n){return n?tt.TextPicker[1]:tt.DefaultPicker[Math.floor(Math.random()*tt.DefaultPicker.length)]},r.parseCssColor=function(n){var o=/\s*#([0-9a-f]{6}\s*$|[0-9a-f]{3}\s*$)|\s*rgba?\(\s*([0-9]+\s*,\s*[0-9]+\s*,\s*[0-9]+\s*(?:,\s*(?:[0-9]+(?:\.[0-9]+)?|[0-9]*\.[0-9]+))?)\s*\)/i.exec(n),e,f;if(!o)return null;var t=/^([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$|^([0-9a-f])([0-9a-f])([0-9a-f])$|^([0-9]{1,3}),\s*([0-9]{1,3}),\s*([0-9]{1,3})(?:,\s*([0-9.]+))?$/i.exec(o[1]||o[2]),s=typeof t[1]=="string"||typeof t[4]=="string"?0:typeof t[10]=="string"?2:1,i=t[1]||t[4],r=t[2]||t[5],u=t[3]||t[6];for(i=i?parseInt(i.length>1?i:i+i,16):parseInt(t[7],10),r=r?parseInt(r.length>1?r:r+r,16):parseInt(t[8],10),u=u?parseInt(u.length>1?u:u+u,16):parseInt(t[9],10),e=t[10],e=e?Math.round(parseFloat(e)*100)*.01:1,f=(i<<16|r<<8|u).toString(16);f.length<6;)f="0"+f;f="#"+f;var h=i+", "+r+", "+u,c="rgb("+h+")",l="rgba("+h+", "+e+")";return{type:s,r:i,g:r,b:u,a:e,rgb:c,rgba:l,color:f,origColor:s===0?f:s===1?c:l}},r.changeColorLightness=function(n,t,i,r){for(var u=[Math.round(n*r),Math.round(t*r),Math.round(i*r)],f=(u[0]<<16|u[1]<<8|u[2]).toString(16);f.length<6;)f="0"+f;return{r:u[0],g:u[1],b:u[2],color:"#"+f}},r.EventSourcesIterator=function(n,i){function f(){for(;n&&n.length>0&&u<n.length;++u){for(var f=n[u];f&&f[i]&&f[i].length>0&&r<f[i].length;++r)if(f[i][r]!=t)return f[i][r++];r=0}return t}function e(){if(n&&n.length>0)for(u==t&&(u=n.length-1);u>=0;--u){var f=n[u];if(f&&f[i]&&f[i].length>0)for(r==t&&(r=f[i].length-1);r>=0;--r)if(f[i][r]!=t)return f[i][r--];r=t}return t}var u=0,r=0;this.first=function(){return u=0,r=0,f.call(this)};this.next=function(){return f.call(this)};this.last=function(){return u=t,r=t,e.call(this)};this.prev=function(){return e.call(this)}},r.objectIsValid=function(n){return n!==t&&n!==null&&n.objectId!==t&&n.objectId!==null},r.objectIsEditable=function(n){return n!==t&&n!==null&&n.isEditable},r.eventIsEditable=function(n){return n.source===t||n.source===null||r.objectIsEditable(n)||r.objectIsEditable(n.source)||n.source&&!n.source.isSubscription},r.getElementRect=function(n){var t=n.offset();return{left:t.left,top:t.top,right:t.left+n.outerWidth(),bottom:t.top+n.outerHeight()}},r.isLeapYear=function(n){return n%4==0&&(n%100!=0||n%400==0)},r.validateDateString=function(n){var t=n.replace(/^\s+|\s+$/g,"").match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/i),i;if(!t||(i=parseInt(t[2],10),i<1||i>12))return null;var f=r.isLeapYear(parseInt(t[1],10)),u=parseInt(t[3],10),e=[31,f?29:28,31,30,31,30,31,31,30,31,30,31];return u<1||u>e[i-1]?null:t[1]+"-"+(t[2].length>1?t[2]:"0"+t[2])+"-"+(t[3].length>1?t[3]:"0"+t[3])},r.validateTimeString=function(n){var u=n.replace(/^\s+|\s+$/g,""),t,i,r;return u.length<1?"00:00":(t=u.match(/^(\d{1,2}):(\d{1,2})$/i),!t)?null:(i=parseInt(t[1],10),i<0||i>23)?null:(r=parseInt(t[2],10),r<0||r>59)?null:(t[1].length>1?t[1]:"0"+t[1])+":"+(t[2].length>1?t[2]:"0"+t[2])},r.validateNonemptyString=function(n){var t=n.replace(/^\s+|\s+$/g,"");return t.length>0?t:null},r.validateInput=function(t,i,r){var u=n(t),f=i(u.val());return null==f?(u.css("color","#cc3300").css("border-color","#cc3300"),!1):(u.css("color","").css("border-color",""),r&&(r.value=f),!0)},r.validateInputHttp=function(t,i,r){var f=n(t),u=i(f.val());return null===u?(f.css("color","#cc3300").css("border-color","#cc3300"),!1):u.indexOf("http://")&&u.indexOf("https://")&&u.indexOf("webcal://")?(f.css("color","#cc3300").css("border-color","#cc3300"),!1):(f.css("color","").css("border-color",""),r&&(r.value=u),!0)},r.makeBullet=function(n,t,r,u){var f=i(t);return'<div class="bullet" style="border: 1px solid '+f+";"+(n?"background-color:"+f:"")+'">'+(u?'<div class="shared"><\/div>':"")+"<\/div>"},r.updateBullet=function(n,t,r,u,f){var o=i(r),e=n.find(".shared");n.css("background-color",t?o:"");n.next(".label").css("color",t?"":u);f&&e.length<1?n.append('<div class="shared"><\/div>'):!f&&e.length>0&&e.remove()},r}(),ut=function(){function e(t){i=n("<div id='fc_color_picker'><\/div>").colorPicker({arrowPosition:"50%",showArrow:!1,anchorToBorder:!0,showModal:!0,colors:{1:t},colorSet:1})}var r={},i,f;return r.open=function(t,r,o){e(o);f!=t&&i.colorPicker("close");f=t;var s=n(t),h=u.parseCssColor(s.css("background-color"));i.colorPicker("option","selectedColor",h.origColor);i.colorPicker("option","select",function(n,t){typeof r=="function"&&r(t)});i.colorPicker("open",s.parent())},r.close=function(){i&&i.length>0&&(i.colorPicker("close"),f=t)},r}(),l=function(){function f(r){(!t||t.length<1)&&(t=n('<div id="fc_common_dp"><div class="asc-datepicker"><\/div><\/div>').popupFrame({anchor:"left,bottom",direction:"right,down",arrow:"up",arrowPosition:"50%",showArrow:!1,showModal:!0}),i=t.find(".asc-datepicker").datepicker({firstDay:r.options.firstDay}))}function u(){setTimeout(function(){i.find(".ui-datepicker-prev .ui-icon").removeClass("ui-icon-circle-triangle-w").addClass("ui-icon-carat-1-w");i.find(".ui-datepicker-next .ui-icon").removeClass("ui-icon-circle-triangle-e").addClass("ui-icon-carat-1-e")},0)}var r={},t,i;return r.open=function(n,e,o,s){f(n);i.datepicker("option","onSelect",function(){s.call(r,e,i)});i.datepicker("option","onChangeMonthYear",u);o.call(r,i);u();t.popupFrame("open",e)},r.close=function(){isOpenCommonDatePicker=!1;t&&t.length>0&&t.popupFrame("close")},r}(),dr=0,gr=1,hi=2,nu=3,tu=4,ci=5,li=1,bt=2,ai=3,vi=4,yi=5,iu=1,ru=2,uu=3,ct=1,pi=2,fu=1,wi=3,w=-1,b=0,eu=0,v=t,bi,ki,tr,ei;n.fn.fullCalendar=function(i){var e,r,f;return typeof i=="string"?(e=Array.prototype.slice.call(arguments,1),r=t,this.each(function(){var u=n.data(this,"fullCalendar"),f;u&&typeof u[i]=="function"&&(f=u[i].apply(u,e),r===t&&(r=f),i=="destroy"&&n.removeData(this,"fullCalendar"))}),r!==t?r:this):(f=i.eventSources||[],delete i.eventSources,i.events&&(f.push(i.events),delete i.events),i=n.extend(!0,{},h,i.isRTL||i.isRTL===t&&h.isRTL?kr:{},window.g_fcOptions?window.g_fcOptions:{},i),ou(i),typeof i.loadEvents=="function"&&(c.sourceFetchers[0]=i.loadEvents),i.eventResize=i.eventResize||function(n,t,i,r){u.eventIsEditable(n)||r()},i.eventDrop=i.eventDrop||function(n,t,i,r,f){u.eventIsEditable(n)||f()},this.each(function(t,r){var u=n(r),e=new su(u,i,f);u.data("fullCalendar",e);e.render()}),this)};c.sourceNormalizers=[];c.sourceFetchers=[];bi={dataType:"json",cache:!1};ki=1;c.addDays=e;c.cloneDate=f;c.parseDate=s;c.parseISO8601=d;c.parseTime=ni;c.formatDate=y;c.formatDates=it;var ku=["sun","mon","tue","wed","thu","fri","sat"],di=864e5,du=36e5,gu=6e4;tr={s:function(n){return n.getSeconds()},ss:function(n){return et(n.getSeconds())},m:function(n){return n.getMinutes()},mm:function(n){return et(n.getMinutes())},h:function(n){return n.getHours()%12||12},hh:function(n){return et(n.getHours()%12||12)},H:function(n){return n.getHours()},HH:function(n){return et(n.getHours())},d:function(n){return n.getDate()},dd:function(n){return et(n.getDate())},ddd:function(n,t){return t.dayNamesShort[n.getDay()]},dddd:function(n,t){return t.dayNames[n.getDay()]},M:function(n){return n.getMonth()+1},MM:function(n){return et(n.getMonth()+1)},MMM:function(n,t){return t.monthNamesShort[n.getMonth()]},MMMM:function(n,t){return t.monthNames[n.getMonth()]},yy:function(n){return(n.getFullYear()+"").substring(2)},yyyy:function(n){return n.getFullYear()},t:function(n){return n.getHours()<12?"a":"p"},tt:function(n){return n.getHours()<12?"am":"pm"},T:function(n){return n.getHours()<12?"A":"P"},TT:function(n){return n.getHours()<12?"AM":"PM"},u:function(n){return y(n,"yyyy-MM-dd'T'HH:mm:ss'Z'")},S:function(n){var t=n.getDate();return t>10&&t<20?"th":["st","nd","rd"][t%10-1]||"th"}};c.applyAll=pt;ei=33;p.month=lf;p.basicWeek=af;p.basicDay=vf;p.agendaWeek=pf;p.agendaDay=wf;p.list=kf;p.listMonth=df;p.listWeek=gf;p.listDay=ne})(jQuery);
typeof jq=="undefined"&&(jq=jQuery.noConflict());typeof ASC=="undefined"&&(ASC={});typeof ASC.Files=="undefined"&&(ASC.Files=function(){return{}}());typeof ASC.Files.Constants=="undefined"&&(ASC.Files.Constants={});ASC.Files.Constants.REQUEST_STATUS_DELAY=2e3;ASC.Files.Constants.REQUEST_CONVERT_DELAY=2e3;ASC.Files.Constants.COUNT_ON_PAGE=30;ASC.Files.Constants.entryIdRegExpStr="(\\d+|[a-z]+-\\d+(-.+)*)";ASC.Files.Constants.storageKeyRecent="TeamLabRecentDocuments";ASC.Files.Constants.storageKeyCompactView="TeamLabDocumentsCompactView";ASC.Files.Constants.storageKeyUploaderCompactView="TeamLabDocumentsUploaderCompactView";ASC.Files.Common=function(){var t=function(n){if(typeof n=="undefined"||n===null||n===0)return!1;var t=new RegExp("^"+ASC.Files.Constants.entryIdRegExpStr);return t.test(n)},i=function(n){return jq.browser.safari||jq.browser.mozilla?encodeURI(n):n},r=function(t,i){var r="",f,u;if(typeof t=="object")if(t===null)typeof i!="undefined"&&(r+="<"+i+"><\/"+i+">");else if(t.constructor.toString().indexOf("Array")!==-1)for(u=0,f=t.length;u<f;u++)r+=typeof i!="undefined"?"<"+i+">"+arguments.callee(t[u])+"<\/"+i+">":arguments.callee(t[u]);else{for(u in t)r+=arguments.callee(t[u],u);typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")}else typeof t=="string"?(r=n(t),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">")):typeof t!="undefined"&&typeof t.toString!="undefined"&&(r=n(t.toString()),typeof i!="undefined"&&(r="<"+i+">"+r+"<\/"+i+">"));return r},n=function(n){return n.replace(/&/gim,"&amp;").replace(/</gim,"&lt;").replace(/>/gim,"&gt;")},u=function(){var n=jq.url.attr("protocol");return n+="://",n+=jq.url.attr("host"),jq.url.attr("port")!=null&&(n+=":",n+=jq.url.attr("port")),n},f=function(n){n||(n=window.event);n.cancelBubble=!0;n.stopPropagation&&n.stopPropagation()},e=new RegExp('[\t*+:"<>?|\\\\/]',"gim"),o=function(n){return(n||"").trim().replace(ASC.Files.Common.characterRegExp,"_")};return{getSitePath:u,cancelBubble:f,keyCode:{enter:13,ctrl:17,esc:27,spaceBar:32,pageUP:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40,insertKey:45,deleteKey:46,A:65,C:67,F:70,N:78,F2:113},characterString:'*+:"<>?|/',characterRegExp:e,replaceSpecCharacter:o,isCorrectId:t,getCorrectHash:i,jsonToXml:r,storeOriginal:!1}}();
window.ASC.Files.UI=function(){var t=!1,i=null,u=new PopupBox("pb_filesUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl"}),n=function(){var t=null,n=[];return{getFiles:function(){return n},setFolder:function(i){i!=t&&(t=i,n=[])},setFile:function(t){n.indexOf(t)<0&&n.push(t)}}}(),f=function(){t===!1&&(t=!0);jq(window).on("resize",function(){r();ASC.Files.UI.fixContentHeaderWidth();e()});jq(window).on("resizeWinTimerWithMaxDelay",function(){r();ASC.Files.UI.fixContentHeaderWidth()});isAutoCleanUpOn=jq("#cbxAutomaticallyCleanUp").is(":checked");autoCleanUpGap=isAutoCleanUpOn?parseInt(jq("#selectGapToAutoCleanUp").val()):-1;ASC.Files.UI.autoCleanUpSetting={isAutoCleanUp:isAutoCleanUpOn,gap:autoCleanUpGap};isAutoCleanUpOn||jq("#selectGapToAutoCleanUp").val("1").trigger("change")},e=function(){jq("#filesMainContent").hasClass("thumbnails")&&(jq("#contentVersions").remove(),clearTimeout(i),i=setTimeout(function(){var n=jq(".display-versions");n.length&&ASC.Files.Folders.showVersions(n)},500))},o=function(){},s=function(n){n=jq(n);n.hasClass("display-versions")&&ASC.Files.Folders.closeVersions();n.remove()},h=function(n,t){return n&&t?ASC.Files.Common.isCorrectId(t)?jq("#filesMainContent .file-row"+ASC.Files.UI.getSelectorId(n+"_"+t)):null:null},c=function(n){return'[data-id="'+(n+"").replace(/\\/g,"\\\\").replace(/\"/g,'\\"')+'"]'},l=function(n){var r,u,i,t;return(n=jq(n),r='input:hidden[name="entry_data"]',n.is(".file-row")||(u=".file-row",n.is(".jstree *")?(u=".tree-node",r='> a input:hidden[name="entry_data"]'):n.closest("#contentVersions").length&&(n=jq(".display-versions")),n=n.closest(u)),n.length==0)?null:(i=n.find(r),!i.length)?null:(t={},t.id=t.entryId=i.attr("data-id"),!ASC.Files.Common.isCorrectId(t.id))?null:(t.entryObject=n,t.access=i.attr("data-access"),t.comment=i.attr("data-comment"),t.content_length=i.attr("data-content_length"),t.content_length_string=i.attr("data-content_length_string"),t.create_by=i.attr("data-create_by"),t.create_by_id=i.attr("data-create_by_id"),t.create_on=i.attr("data-create_on"),t.entryType=(i.attr("data-entryType")||"").trim()==="file"?"file":"folder",t.error=i.attr("data-error"),t.error=t.error!=""?t.error:!1,t.file_status=i.attr("data-file_status"),t.isnew=i.attr("data-isnew")|0,t.modified_by=i.attr("data-modified_by"),t.modified_on=i.attr("data-modified_on"),t.provider_id=i.attr("data-provider_id")|0,t.provider_key=i.attr("data-provider_key"),t.shared=i.attr("data-shared")==="true",t.deny_download=i.attr("data-deny_download")==="true",t.deny_sharing=i.attr("data-deny_sharing")==="true",t.title=(i.attr("data-title")||"").trim(),t.version=i.attr("data-version")|0,t.version_group=i.attr("data-version_group")|0,t.folderUrl=i.attr("data-folder_url"),t.folder_id=i.attr("data-folder_id"),t.folder_is_favorite=i.attr("data-folder_is_favorite"),t.encrypted=i.attr("data-encrypted")==="true",t.thumbnail_status=i.attr("data-thumbnail_status"),t.deleted_permanently_date=i.attr("data-deleted_permanently_date"),t)},a=function(n,t,i){if(n=jq(n),n.length!=0){var r=n.find('input:hidden[name="entry_data"]');r.length&&r.attr(t,i)}},v=function(n){if(typeof n=="undefined"||n==null)return null;var t=n.indexOf("file_")=="0"?"file":"folder",i=n.substring((t+"_").length);return ASC.Files.Common.isCorrectId(i)?{entryType:t,entryId:i}:null},y=function(n,t){return ASC.Files.Common.isCorrectId(t)?ASC.Files.UI.getObjectTitle(ASC.Files.UI.getEntryObject(n,t)):null},p=function(n){return(n=jq(n),n.is(".file-row")||(n=n.closest(".file-row")),n.length==0)?null:ASC.Files.UI.getObjectData(n).title.trim()},w=function(n,t,i){if(n=="file"){var r=ASC.Files.Utility.GetFileDownloadUrl(t);ASC.Files.Utility.CanWebEdit(i)&&!ASC.Files.Utility.MustConvert(i)?r=ASC.Files.Utility.GetFileWebEditorUrl(t):ASC.Files.Utility.CanWebView(i)?r=ASC.Files.Utility.GetFileWebViewerUrl(t):typeof ASC.Files.ImageViewer!="undefined"&&ASC.Files.Utility.CanImageView(i)?r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.ImageViewer.getPreviewHash(t)):typeof ASC.Files.MediaPlayer!="undefined"&&ASC.Files.MediaPlayer.canPlay(i,!0)&&(r="#"+ASC.Files.Common.getCorrectHash(ASC.Files.MediaPlayer.getPlayHash(t)))}else r=ASC.Files.Constants.URL_BASE+"#"+ASC.Files.Common.getCorrectHash(t);return r},b=function(){if(!ASC.Files.Common.isCorrectId(ASC.Files.Folders.currentFolder.id)){ASC.Files.Anchor.move("");return}ASC.Files.UI.hideAllContent(!0);ASC.Files.UI.stickContentHeader();ASC.Files.Folders.getFolderItems(!1)},k=function(t){var u=ASC.Files.Constants.storageKeyCompactView,i,r;typeof t=="undefined"&&(i=localStorageManager.getItem(u)||!1,t=i,typeof i=="boolean"&&(t=i?"compact":"normal"));ASC.Files.Folders.closeVersions();jq("#switchViewFolder, #filesMainContent").removeClass("thumbnails normal compact");jq("#switchViewFolder, #filesMainContent").addClass(t);localStorageManager.setItem(u,t);ASC.Files.Folders.showMore&&t!="compact"&&ASC.Files.UI.trackShowMore();ASC.Files.Mouse&&ASC.Files.Mouse.updateMainContentArea();t=="thumbnails"&&(jq("#filesMainContent").find(".file-row .thumb-img img[src='']").each(function(){var n=jq(this),t=n.attr("data-src");n.on("error",ASC.Files.EventHandler.onThumbnailError).attr("src",t)}),r=n.getFiles(),r.length&&Teamlab.createThumbnails(null,{fileIds:r}))},d=function(){return jq("#settingCommon, #settingAdmin, #settingThirdPartyPanel, #helpPanel").is(":visible")},g=function(){var n=jq("#mainContentHeader.stick-panel:visible");n.css("width",n.parent().innerWidth()-parseInt(n.css("margin-left"))-parseInt(n.css("margin-right")))},r=function(){var n=jq("#mainContentHeader.stick-panel:visible"),t=jq(window);n.length!=0&&n.css("left",n.parent().offset().left-t.scrollLeft())},nt=function(){var n=jq("#mainContentHeader .down_arrow");n.length&&(ASC.Files.UI.stickMovingPanel("mainContentHeader",jq("#filesSelectorPanel:visible")),ASC.Files.UI.fixContentHeaderWidth())},tt=function(n,t){var i=jq("#"+n),u,r,o,f,s,e;i.is(":visible")&&(t&&t.hide(),u=n+"Spacer",r=jq("#"+u),o=jq("#"+u+":visible").length==0?i.offset().top:r.offset().top,f=jq(window),s=f.scrollTop(),s>=o?(i.hasClass("stick-panel")||(r.length==0&&(e=document.createElement("div"),e.id=u,document.body.appendChild(e),r=jq("#"+u),r.insertAfter(i),r.css({height:i.css("height"),"padding-bottom":i.css("padding-bottom"),"padding-top":i.css("padding-top")})),r.show(),i.addClass("stick-panel")),i.css("left",i.parent().offset().left-f.scrollLeft())):i.hasClass("stick-panel")&&(r.hide(),i.removeClass("stick-panel"),jq("#mainContentHeader").css("width","auto")))},it=function(n){typeof n=="undefined"&&(n=jq(window).width()>=1200||ASC.Desktop);n?jq(".files-content-panel").height()-jq(".mainPageContent").height()<=jq(".mainPageContent").scrollTop()+350&&ASC.Files.Folders.showMore():jq(document).height()-jq(window).height()<=jq(window).scrollTop()+350&&ASC.Files.Folders.showMore()},rt=function(){var n=jq("#filesTemplateList .file-row");n.eq(n.length-1).position().top==271&&ASC.Files.Folders.getTemplateList(!0)},ut=function(n,t,i,r,u){return ASC.Files.UI.blockObject(ASC.Files.UI.getEntryObject(n,t),i,r,u)},ft=function(n,t,i,r){if(t=t===!0,n=jq(n),n.length&&n.hasClass("checkloading")!=t){jq(n).removeClass("row-hover");n.toggleClass("loading checkloading",t===!0);t===!0?(n.block({message:"",baseZ:99}),typeof i!="undefined"&&i&&n.children("div.blockUI.blockOverlay").attr("title",i)):(n.unblock(),n.css("position",""));var u=n.hasClass("row-selected"),f=n.attr("data-selected")=="true";ASC.Files.UI.selectRow(n,!t&&f);t&&n.attr("data-selected",u);r||ASC.Files.UI.updateMainContentHeader()}},et=function(n){return!n.hasClass("folder-row")&&n.hasClass("on-edit")},ot=function(n){return n.hasClass("file-locked-by")},st=function(n){var t=n.entryObject,i=n.entryType,r=n.title;return i=="file"&&ASC.Files.Folders.folderContainer!="trash"&&!t.hasClass("row-rename")&&ASC.Files.UI.accessEdit(n,t,!0)&&ASC.Files.Utility.CanWebEdit(r)},ht=function(n,t){var i=ASC.Files.Utility.GetFileExtension(t),r=t.substring(0,t.length-i.length);n.html('{0}<span class="file-extension">{1}<\/span>'.format(r,i))},ct=function(t){var u=t||jq("#filesMainContent .file-row"),i=jq("#filesMainContent .files-separator").length>0,r;n.setFolder(ASC.Files.Folders.currentFolder.id);r=ASC.Files.UI.autoCleanUpSetting.isAutoCleanUp;u.each(function(){var u=ASC.Files.UI.getObjectData(this),h=u.entryId,f=u.entryType,t=u.entryObject,o=u.title,s,a,e,c,l,v;ASC.Files.Folders.folderContainer=="trash"?(t.find(".file-lock").remove(),t.find(".template-action").remove(),t.find(".entry-descr .title-created").remove(),t.find(".entry-descr .title-removed").show(),f=="folder"&&(t.find(".create-date").remove(),t.find(".modified-date").show()),r?(t.find(".entry-descr .title-removed").remove(),t.find(".create-date").remove(),t.find(".modified-date").remove(),t.find(".deleted-permanently").show(),t.find(".entry-descr .title-removed-permanently").show()):(t.find(".entry-descr .title-removed-permanently").remove(),t.find(".entry-descr .title-removed").show(),t.find(".deleted-permanently-date").remove(),t.find(".modified-date").show())):(t.find(".entry-descr .title-removed").remove(),t.find(".entry-descr .title-removed-permanently").remove(),t.find(".deleted-permanently-date").remove(),f=="folder"&&t.find(".modified-date").remove());s=t.find(".entry-title .name a");a=f=="file"?ASC.Files.Utility.getCssClassByFileTitle(o):ASC.Files.Utility.getFolderCssClass();t.find(".thumb-img, .thumb-"+f).addClass(a);u.thumbnail_status!=0||ASC.Files.ThirdParty&&ASC.Files.ThirdParty.isThirdParty(u)||n.setFile(h);u.thumbnail_status==1&&t.find(".thumb-img img").attr("data-src",ASC.Files.Utility.GetFileThumbnailUrl(h,u.version));f!="folder"||ASC.Files.Folders.folderContainer=="forme"||t.hasClass("new-folder")||t.addClass("min");f!="file"||i||ASC.Files.Folders.folderContainer=="forme"||(t.before("<div class='files-separator'><\/div>"),i=!0);t.hasClass("checkloading")||(f=="file"?(s.is(":not(:has(.file-extension))")&&ASC.Files.UI.highlightExtension(s,o),ASC.Files.Folders.folderContainer!="trash"&&(e=ASC.Files.UI.getEntryLink(f,h,o),s.attr("href",e).attr("target","_blank"),c=t.find(".file-lock"),ASC.Files.UI.accessEdit(u,t)?t.hasClass("file-locked")&&(l=ASC.Files.FilesJSResource.TitleLockedFile,ASC.Files.UI.lockedForMe(t)&&(v=c.attr("data-name"),l=ASC.Files.FilesJSResource.TitleLockedFileBy.format(v),(ASC.Files.Constants.ADMIN||ASC.Files.Folders.folderContainer=="my")&&t.addClass("file-can-unlock")),c.attr("title",l)):c.remove()),ASC.Files.Utility.MustConvert(o)&&!u.encrypted?(t.find(".pencil:not(.convert-action)").remove(),Teamlab.profile.isVisitor&&!ASC.Files.UI.accessEdit()||ASC.Files.UI.denyDownload(u)||ASC.Files.Folders.folderContainer=="trash"?t.find(".convert-action").remove():t.find(".convert-action").show()):ASC.Files.Utility.CanWebRestrictedEditing(o)&&!u.encrypted?(t.find(".pencil:not(.fillform-action)").remove(),t.find(".fillform-action").show()):(u.encrypted&&(ASC.Desktop?(e=ASC.Files.Utility.GetFileWebEditorUrl(h),s.attr("href",e),t.find(".file-edit").attr("href",e)):(s.removeAttr("href"),t.find(".file-edit").removeAttr("href"))),ASC.Files.UI.editableFile(u)&&(!u.encrypted||ASC.Files.Folders.folderContainer=="privacy"&&ASC.Files.Utility.CanWebEncrypt(o)&&ASC.Desktop&&ASC.Desktop.encryptionSupport())?(ASC.Files.UI.lockEditFile(t,ASC.Files.UI.editingFile(t)),t.find(".convert-action, .fillform-action").remove(),ASC.Files.Utility.CanCoAuhtoring(o)&&!t.hasClass("on-edit-alone")&&t.addClass("can-coauthoring"),u.encrypted||(e=ASC.Files.Utility.GetFileWebEditorUrl(h),t.find(".file-edit").attr("href",e))):(t.addClass("cannot-edit"),t.find(".pencil").remove())),u.encrypted&&(ASC.Files.Folders.folderContainer!="privacy"||!ASC.Desktop||!ASC.Desktop.encryptionSupport()||ASC.Resources.Master.Personal)?t.addClass("without-share"):ASC.Resources.Master.Personal&&!ASC.Files.Utility.CanWebView(o)&&t.addClass("without-share")):ASC.Files.Folders.folderContainer!="trash"&&(e=ASC.Files.UI.getEntryLink(f,h),s.attr("href",e)),(ASC.Files.Folders.folderContainer=="trash"||u.error)&&s.attr("href",ASC.Files.UI.getEntryLink("folder",ASC.Files.Folders.currentFolder.id)),jq("#filesMainContent").hasClass("without-share")?ASC.Files.Folders.folderContainer!="forme"||u.access!=ASC.Files.Constants.AceStatusEnum.ReadWrite||u.deny_sharing||Teamlab.profile.isVisitor||t.addClass("can-share"):(ASC.Files.Folders.folderContainer=="forme"&&(!ASC.Files.UI.accessEdit(u,t)||ASC.Files.UI.denySharing(u))||ASC.Files.Folders.folderContainer=="privacy"&&(f=="folder"||!ASC.Files.UI.accessEdit(u,t)||ASC.Files.UI.denySharing(u))||ASC.Resources.Master.Personal&&f=="folder"||Teamlab.profile.isVisitor===!0)&&t.addClass("without-share"),jq.browser.msie&&t.find("*").attr("unselectable","on"))});jq("#switchToNormal").length&&ASC.Files.UI.switchFolderView()},lt=function(n,t){var r=jq.fixEvent(n),i,u;if(!(r.button==0||jq.browser.msie&&r.button==1))return!0;t=t||jq(r.srcElement||r.target);try{if(t.is("a, .menu-small"))return!0}catch(r){return!0}if(i=t.is(".file-row")?t:t.closest(".file-row"),u=!jq(i).hasClass("row-selected")||jq(i).find(".checkbox input:visible").is("[type=radio]"),r.shiftKey){ASC.Files.UI.lastSelectedEntry||(ASC.Files.UI.lastSelectedEntry=i);u=!0;var f=jq(".file-row").index(i),e=jq(".file-row").index(ASC.Files.UI.lastSelectedEntry.entryObj),o=Math.min(f,e),s=Math.max(f,e);jq(".file-row:lt("+s+"):gt("+o+")").each(function(){ASC.Files.UI.selectRow(jq(this),u)})}else r.ctrlKey||t.is(".checkbox, .checkbox input")||(jq(".row-selected").length>1&&(u=!0),ASC.Files.UI.checkSelectAll(!1));return ASC.Files.UI.selectRow(i,u),ASC.Files.UI.updateMainContentHeader(),ASC.Files.UI.lastSelectedEntry=u?{entryObj:i}:null,!0},at=function(){ASC.Files.UI.resetSelectAll(jq("#filesMainContent .file-row:has(.checkbox input[type=checkbox]:not(:checked))").length==0);jq("#filesMainContent .file-row:has(.checkbox input:checked)").length==0?(jq("#mainContentHeader .menuAction.unlockAction").removeClass("unlockAction"),ASC.Files.Folders.folderContainer=="trash"&&jq("#mainEmptyTrash").addClass("unlockAction")):ASC.Files.Actions&&ASC.Files.Actions.showActionsViewPanel();typeof ASC.Files.UI.filesSelectedHandler=="function"&&ASC.Files.UI.filesSelectedHandler()},vt=function(n,t){return n?(n.hasClass("file-row")||(n=n.closest(".file-row")),n.hasClass("row-selected")==t)?!1:n.hasClass("checkloading")&&t?!1:((n.hasClass("new-folder")||jq(n).hasClass("row-rename"))&&(t=!1),t===!0&&n.find(".checkbox input:visible").is("[type=radio]")&&(jq("#filesMainContent .checkbox input:checked").prop("checked",!1),jq("#filesMainContent .file-row.row-selected").removeClass("row-selected")),n.find(".checkbox input").prop("checked",t===!0),n.toggleClass("row-selected",t).removeAttr("data-selected"),jq("#filesMainContent .menu-small.active").removeClass("active"),!0):!1},yt=function(n){var t=n!==!0&&jq("#filesMainContent .file-row .checkbox input:checked").length!=0;jq("#filesSelectAllCheck").prop("checked",n===!0||t===!0);jq("#filesSelectAllCheck").prop("indeterminate",t)},pt=function(n){var t=!1,i=".row-selected";n&&(i=":not("+i+")");jq("#filesMainContent .file-row"+i+":not(.checkloading)").each(function(){t=ASC.Files.UI.selectRow(jq(this),n)||t});t&&ASC.Files.UI.updateMainContentHeader();ASC.Files.UI.lastSelectedEntry=null},wt=function(n){ASC.Files.Actions.hideAllActionPanels();jq("#filesMainContent .file-row:not(.checkloading)").each(function(){var t,i=ASC.Files.UI.getObjectTitle(this);switch(n){case"folder":t=jq(this).hasClass("folder-row");break;case"file":t=!jq(this).hasClass("folder-row");break;case"document":t=ASC.Files.Utility.FileIsDocument(i)&&!jq(this).hasClass("folder-row");break;case"presentation":t=ASC.Files.Utility.FileIsPresentation(i)&&!jq(this).hasClass("folder-row");break;case"spreadsheet":t=ASC.Files.Utility.FileIsSpreadsheet(i)&&!jq(this).hasClass("folder-row");break;case"image":t=ASC.Files.Utility.FileIsImage(i)&&!jq(this).hasClass("folder-row");break;case"media":t=(ASC.Files.Utility.FileIsAudio(i)||ASC.Files.Utility.FileIsVideo(i))&&!jq(this).hasClass("folder-row");break;case"archive":t=ASC.Files.Utility.FileIsArchive(i)&&!jq(this).hasClass("folder-row");break;default:return!1}return ASC.Files.UI.selectRow(jq(this),t),!0});ASC.Files.UI.updateMainContentHeader()},bt=function(n,t){n!==""&&typeof n!="undefined"&&(t===!0?toastr.error(n):toastr.success(n))},kt=function(n,t,i){var r,u,f;if(Teamlab.profile.isOutsider||(n=n||(t?ASC.Files.UI.getObjectData(t):ASC.Files.Folders.currentFolder),r=n?n.entryId:null,u=n?n.entryType:null,u=="folder"&&(r==ASC.Files.Constants.FOLDER_ID_COMMON_FILES&&!ASC.Files.Constants.ADMIN||r==ASC.Files.Constants.FOLDER_ID_SHARE||r==ASC.Files.Constants.FOLDER_ID_RECENT||r==ASC.Files.Constants.FOLDER_ID_FAVORITES||r==ASC.Files.Constants.FOLDER_ID_TEMPLATES||r==ASC.Files.Constants.FOLDER_ID_TRASH||r==ASC.Files.Constants.FOLDER_ID_PROJECT)))return!1;f=parseInt(n?n.access:ASC.Files.Constants.AceStatusEnum.None);u=="folder"&&ASC.Files.Folders&&ASC.Files.Folders.currentFolder&&r==ASC.Files.Folders.currentFolder.id&&(f=parseInt(ASC.Files.Folders.currentFolder.access));switch(f){case ASC.Files.Constants.AceStatusEnum.None:case ASC.Files.Constants.AceStatusEnum.ReadWrite:return!0;case ASC.Files.Constants.AceStatusEnum.Read:case ASC.Files.Constants.AceStatusEnum.Restrict:return!1;case ASC.Files.Constants.AceStatusEnum.CustomFilter:case ASC.Files.Constants.AceStatusEnum.Review:case ASC.Files.Constants.AceStatusEnum.FillForms:case ASC.Files.Constants.AceStatusEnum.Comment:return!!i;default:return n&&n.entryType=="folder"&&(n.entryId===ASC.Files.Constants.FOLDER_ID_SHARE||n.entryId===ASC.Files.Constants.FOLDER_ID_RECENT||n.entryId===ASC.Files.Constants.FOLDER_ID_FAVORITES||n.entryId===ASC.Files.Constants.FOLDER_ID_TEMPLATES||n.entryId===ASC.Files.Constants.FOLDER_ID_PROJECT||n.entryId===ASC.Files.Constants.FOLDER_ID_TRASH)?!1:ASC.Files.Constants.ADMIN||!n||n.create_by_id==Teamlab.profile.id}},dt=function(n){if(Teamlab.profile.isOutsider)return!1;var t=n?ASC.Files.UI.getObjectData(n):ASC.Files.Folders.currentFolder,i=parseInt(t?t.access:ASC.Files.Constants.AceStatusEnum.None),r=t?t.entryId:null,u=t?t.entryType:null;return(u=="folder"&&r==ASC.Files.Folders.currentFolder.id&&(i=ASC.Files.Folders.currentFolder.access),i==ASC.Files.Constants.AceStatusEnum.Restrict)?(ASC.Files.UI.removeEntryObject(n),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.AceStatusEnum_Restrict,!0),!1):ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_PROJECT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_RECENT||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_FAVORITES||ASC.Files.Folders.currentFolder.id==ASC.Files.Constants.FOLDER_ID_TEMPLATES?!1:i==ASC.Files.Constants.AceStatusEnum.Read?!1:i==ASC.Files.Constants.AceStatusEnum.None||ASC.Files.Folders.folderContainer=="corporate"&&ASC.Files.Constants.ADMIN||ASC.Files.Folders.currentFolder.id!=ASC.Files.Constants.FOLDER_ID_PROJECT&&t.create_by_id==Teamlab.profile.id},gt=function(n){return!n||!n.deny_download?!1:n.access==ASC.Files.Constants.AceStatusEnum.Read||n.access==ASC.Files.Constants.AceStatusEnum.Comment},ni=function(n){return n?n.access!=ASC.Files.Constants.AceStatusEnum.None&&n.access!=ASC.Files.Constants.AceStatusEnum.ReadWrite?!0:n.access==ASC.Files.Constants.AceStatusEnum.ReadWrite&&n.deny_sharing:!1},ti=function(n,t,i){var r=ASC.Files.UI.getEntryObject("file",n);return ASC.Files.UI.lockEditFile(r,t,i)},ii=function(n,t,i){if(!n.hasClass("folder-row"))if(t){n.addClass("on-edit");var r=ASC.Files.FilesJSResource.TitleEditingFile;i&&(r=ASC.Files.FilesJSResource.TitleEditingFileBy.format(i));n.find(".pencil.file-editing").attr("title",r)}else n.removeClass("on-edit")},ri=function(){var t=jq(".files-content-panel #filesMainContent .file-row.on-edit:visible:not(.cannot-edit)"),n;t.length!=0&&(n={entry:jq(t).map(function(n,t){return ASC.Files.UI.getObjectData(t).entryId}).toArray()},ASC.Files.ServiceManager.checkEditing(ASC.Files.ServiceManager.events.CheckEditing,{list:n.entry},{stringList:n}))},ui=function(){clearTimeout(ASC.Files.UI.timeCheckEditing);ASC.Files.UI.timeCheckEditing=setTimeout(ASC.Files.UI.checkEditing,2e4)},fi=function(n,t,i){var f;n=n||ASC.Files.UI.getEntryObject(t,i);var h=localStorageManager.getItem(ASC.Files.Constants.storageKeyCompactView)=="thumbnails"?!0:!1,r=ASC.Files.UI.getObjectData(n),c={entryTooltip:{type:t,title:r.title,create_by:r.create_by,date_type:ASC.Files.Folders.folderContainer=="trash"?"remove":t=="folder"?"create":r.version>1?"update":"upload",modified_on:t=="file"?r.modified_on:ASC.Files.Folders.folderContainer=="trash"?r.modified_on:r.create_on,version:r.version,length_string:r.content_length_string,thumbnail:r.thumbnail_status==1&&!h?ASC.Files.Utility.GetFileThumbnailUrl(i,r.version):!1,error:r.error,provider_key:r.provider_key,total_files:parseInt(n.find(".countFiles").html())||0,total_sub_folder:parseInt(n.find(".countFolders").html())||0,comment:r.comment}},l=ASC.Files.Common.jsonToXml(c),a=ASC.Files.TemplateManager.translateFromString(l),u=n.find(".checkbox"),e=jq("#entryTooltip"),o=jq(window),s=12;e.html(a);f=u.offset().top+u.outerHeight()+e.outerHeight()+s>o.height()+o.scrollTop();jq.dropdownToggle().toggle(u,"entryTooltip",f?s:0,0,!1,null,null,null,f)},ei=function(){clearTimeout(ASC.Files.UI.timeTooltip);jq("#entryTooltip").hide();var n=jq("#filesMainContent .file-row .entry-title .name a[data-title]").removeAttr("data-title");n.attr("title",n.text())},oi=function(){var n=ASC.Files.Constants.COUNT_ON_PAGE-jq("#filesMainContent .file-row").length;n>0&&(ASC.Files.UI.currentPage<ASC.Files.UI.amountPage?ASC.Files.Folders.getFolderItems(!0,n):ASC.Files.Folders.folderContainer&&n>=ASC.Files.Constants.COUNT_ON_PAGE&&ASC.Files.EmptyScreen.displayEmptyScreen())},si=function(n,t){if(ASC.Files.Tree&&ASC.Files.Tree.pathParts.length>1){var i=ASC.Files.Tree.pathParts[ASC.Files.Tree.pathParts.length-2],r=ASC.Files.Tree.getFolderTitle(i);jq(n).attr("data-id",i).attr("href",ASC.Files.UI.getEntryLink("folder",i)).attr("title",r).show();jq(t||n).show()}else jq(t||n).hide()},hi=function(n){jq(n).off("keyup").on("keyup",function(){var n=jq(this).val();n.search(ASC.Files.Common.characterRegExp)!=-1&&(jq(this).val(ASC.Files.Common.replaceSpecCharacter(n)),ASC.Files.UI.displayInfoPanel(ASC.Files.FilesJSResource.ErrorMassage_SpecCharacter.format(ASC.Files.Common.characterString),!0))})},ci=function(n){if(ASC.Files.UI.canSetDocumentTitle){n=n||ASC.Files.Folders.currentFolder.title;n=n?n+" - ":"";var t=jq(".files-content-panel").attr("data-title")||"TeamLab";document.title=n+t}},li=function(n){ASC.Files.MediaPlayer&&ASC.Files.MediaPlayer.isView&&ASC.Files.MediaPlayer.closePlayer();n=!!n;n||(jq("#treeViewContainer .selected").removeClass("selected"),jq("#treeViewContainer .parent-selected").removeClass("parent-selected"),jq("#mainContentHeader, .files-filter").hide());jq("#treeSecondary .currentCategory").removeClass("currentCategory");jq("#treeSecondary .active").removeClass("active");jq("#settingCommon, #settingAdmin").hide();jq("#settingThirdPartyPanel").hide();jq("#helpPanel").hide();jq("#moreFeatures").hide();jq(".files-content-panel").toggle(n);jq(".mainPageContent").children(".loader-page").remove()},ai=function(n){if(!jq("#helpPanel").length){ASC.Files.Anchor.defaultFolderSet();return}ASC.Files.UI.hideAllContent();var t={helpId:n};if(jq("#helpPanel").text().trim().length)ASC.Files.EventHandler.onGetHelpCenter(null,t);else t.update=!0,ASC.Files.ServiceManager.getHelpCenter(ASC.Files.ServiceManager.events.GetHelpCenter,t)},vi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeViewContainer .node-selected").removeClass("node-selected");jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-common").addClass("active");jq("#settingCommon").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsCommon)},yi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();jq("#treeViewContainer .node-selected").removeClass("node-selected");jq("#treeSetting").addClass("currentCategory open");jq(".settings-link-admin").addClass("active");jq("#settingAdmin").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleSettingsAdmin)},pi=function(){ASC.Files.UI.hideAllContent();LoadingBanner.hideLoading();ASC.Files.CreateMenu.disableMenu();jq("#moreFeatures").show();ASC.Files.UI.setDocumentTitle(ASC.Files.FilesJSResource.TitleMoreFeaturs)},wi=function(){return jq("#personalLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#personalLimitExceedStoragePanel",500),!0):!1},bi=function(){return jq("#tariffLimitExceedStoragePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedStoragePanel",500),!0):!1},ki=function(){return jq("#tariffLimitExceedFileSizePanel").length?(ASC.Files.UI.blockUI("#tariffLimitExceedFileSizePanel",500),!0):!1},di=function(n,t){return ASC.Files.Mouse&&(ASC.Files.Mouse.finishMoveTo(),ASC.Files.Mouse.finishSelecting()),StudioBlockUIManager.blockUI(n,t)},gi=function(n,t){var f,i,r,e,o,u;t=t|0;n=jq(n);n.is("progress")||(n=n.find("progress"));f=50;i=n.data("timer");clearInterval(i);r=n.val();!t||r>t?n.val(t):(e=function(t,r){var u=Math.min(r,n.val()+t);n.val(u);u==r&&clearInterval(i)},o=Math.max(1,(t-r)/f),i=setInterval(function(){e(o,t)},1),n.data("timer",i));u=n.find(".asc-progress-value");t?u.animate({width:t+"%"}):u.css("width",t+"%")},nr=function(n){n.find(".userLink").each(function(){var n=jq(this).attr("id").trim();n!=null&&n!=""&&u.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')})};return{init:f,parseItemId:v,removeEntryObject:s,getEntryObject:h,getObjectData:l,setObjectData:a,getSelectorId:c,getEntryTitle:y,getObjectTitle:p,getEntryLink:w,currentPage:0,amountPage:0,countTotal:0,autoCleanUpSetting:null,updateFolderView:b,switchFolderView:k,isSettingsPanel:d,blockObjectById:ut,blockObject:ft,highlightExtension:ht,addRowHandlers:ct,updateMainContentHeader:at,lastSelectedEntry:null,checkSelectAll:pt,checkSelect:wt,selectRow:vt,clickRow:lt,resetSelectAll:yt,displayInfoPanel:bt,editingFile:et,editableFile:st,lockedForMe:ot,checkEditing:ri,timeCheckEditing:null,checkEditingDefer:ui,lockEditFileById:ti,lockEditFile:ii,accessEdit:kt,accessDelete:dt,denyDownload:gt,denySharing:ni,checkCharacter:hi,canSetDocumentTitle:!0,setDocumentTitle:ci,stickContentHeader:nt,fixContentHeaderWidth:g,stickMovingPanel:tt,trackShowMore:it,trackShowMoreTemplates:rt,displayEntryTooltip:fi,hideEntryTooltip:ei,timeTooltip:null,checkEmptyContent:oi,checkButtonBack:si,hideAllContent:li,displayHelp:ai,displayCommonSetting:vi,displayAdminSetting:yi,displayMoreFeaturs:pi,displayPersonalLimitStorageExceed:wi,displayTariffLimitStorageExceed:bi,displayTariffFileSizeExceed:ki,blockUI:di,setProgressValue:gi,filesSelectedHandler:o,registerUserProfilePopup:nr}}(),function(n){ASC.Files.UI.init();n(function(){jq("#switchToNormal").on("click",function(){ASC.Files.UI.switchFolderView("normal")});jq("#switchToCompact").on("click",function(){ASC.Files.UI.switchFolderView("compact")});jq("#switchToThumbnails").on("click",function(){ASC.Files.UI.switchFolderView("thumbnails")});jq("#filesMainContent").on("click",".file-row",ASC.Files.UI.clickRow);jq("#filesMainContent").on("dblclick",".file-row:not(.checkloading)",function(n){jq(n.srcElement||n.target).is("input, .checkbox, .file-lock, .version, .pencil, .is-new, .btn-row, .menu-small, #contentVersions, #contentVersions *")||jq(this).closest(".file-row").find(".entry-title .name a").trigger("click")});jq("#filesMainContent").on("click",".checkbox input",function(n){ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels();ASC.Files.UI.clickRow(n,jq(this));jq(this).trigger("blur");ASC.Files.Common.cancelBubble(n)});jq(".menu-action-on-top").on("click",function(){return jq(document).scrollTop(0),!1});jq(document).on("keydown",function(n){var t,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq(".studio-action-panel:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);i=t.target||t.srcElement;try{if(jq(i).is("input,textarea"))return!0}catch(t){return!0}return(r=t.keyCode||t.which,r==ASC.Files.Common.keyCode.A&&t.ctrlKey)?(jq.browser.opera&&setTimeout(function(){jq("#filesSelectAllCheck").trigger("focus")},1),ASC.Files.UI.checkSelectAll(!0),!1):!0});jq(document).on("keyup",function(n){var t,u,i,r;if(jq(".blockUI:visible").length!=0||jq("#fileViewerDialog:visible,#mediaPlayer:visible").length!=0||jq("#promptRename").length!=0||jq("#promptCreateFolder").length!=0||jq("#promptCreateFile").length!=0)return!0;t||(t=n);t=jq.fixEvent(t);u=t.target||t.srcElement;try{if(jq(u).is("input,textarea"))return!0}catch(t){return!0}if(i=t.keyCode||t.which,ASC.Files.Folders){if(i==ASC.Files.Common.keyCode.deleteKey&&!t.shiftKey&&!t.altKey)return ASC.Files.Folders.deleteItem(),!1;if(i==ASC.Files.Common.keyCode.F&&t.shiftKey)return ASC.Files.Folders.createFolder(),!1;if(i==ASC.Files.Common.keyCode.N&&t.shiftKey)return ASC.Files.Utility.CanWebEdit(ASC.Files.Utility.Resource.InternalFormats.Document)&&(ASC.Files.Folders.typeNewDoc="document",ASC.Files.Folders.createNewDoc()),!1;i==ASC.Files.Common.keyCode.F2&&jq("#filesMainContent .file-row.row-selected:visible").length==1&&(r=ASC.Files.UI.getObjectData(jq("#filesMainContent .file-row.row-selected")),ASC.Files.Actions.hideAllActionPanels(),ASC.Files.Folders.rename(r.entryType,r.id))}if(i==ASC.Files.Common.keyCode.esc){if(ASC.Files.Mouse){if(jq("#filesMovingTooltip").is(":visible"))return ASC.Files.Mouse.finishMoveTo(),!1;if(jq("#filesSelector").is(":visible"))return ASC.Files.Mouse.finishSelecting(),!1}return ASC.Files.Actions&&ASC.Files.Actions.hideAllActionPanels(),ASC.Files.ChunkUploads&&ASC.Files.ChunkUploads.hideDragHighlight(),!0}return!0});jq("#bottomLoaderPanel").draggable({axis:"x",handle:".progress-dialog-header",containment:"body"});jq("#bottomLoaderPanel").on("drag",".progress-dialog-header",function(){ASC.Files.Actions.hideAllActionPanels()})})}(jQuery);
var SharingSettingsManager=function(n,t){var f=jq("#shareUserSelector"),e=jq("#shareGroupSelector"),y=new PopupBox("pb_SharingUserProfileInfo",320,140,"tintLight","borderBaseShadow","",{apiMethodName:"Teamlab.getProfile",tmplName:"userProfileCardTmpl",tmplParams:{blank:!0}}),o=function(n){if(!n||"object"!=typeof n)return n;var r="function"==typeof n.pop?[]:{},i,t;for(i in n)n.hasOwnProperty(i)&&(t=n[i],r[i]=t&&"object"==typeof t?o(t):t);return r};this.OnSave=null;this.OnCopyLink=null;this.OnChange=null;var s=t,i=o(t),l=!1,h=null,r=this;jq(function(){if(n!=undefined)jq("#"+n).on("click",function(){r.ShowDialog()});jq("#studio_sharingSettingsDialog").on("click",".sharing-save-button",r.SaveAndCloseDialog);jq("#studio_sharingSettingsDialog").on("click",".sharing-cancel-button",r.CloseDialog);jq("#studio_sharingSettingsDialog").on("click",".removeItem",function(){a(jq(this).attr("data"))});jq("#sharingSettingsItems").on("change",".action select",function(){w(jq(this).attr("data"),jq(this).val())});jq("#sharingSettingsItems").on("click",".combobox-title",function(){jq(this).closest(".sharingItem").is("#sharingSettingsItems .sharingItem:gt(-3)")&&jq("#sharingSettingsItems").scrollTo(jq(".sharingItem:has(.combobox-container:visible)"))});jq("#shareAddMessage").on("click",function(){return p(),!1});jq("#shareRemoveMessage").on("click",function(){return c(),jq("#shareMessage").val(""),!1});jq("#shareMessageSend").on("change",function(){jq("#shareMessageSend").is(":checked")||c()});f.useradvancedSelector({showGroups:!0,inPopup:!0}).on("showList",b);e.groupadvancedSelector({inPopup:!0,witheveryone:!0,withadmin:!0}).on("showList",d);c();ASC.Clipboard.enable||jq("#shareGetLink").remove();jq.dropdownToggle({switcherSelector:"#shareUserDefAction",dropdownID:"shareUserDefSelect",inPopup:!0,addLeft:-5,addTop:4});jq("#shareUserDefSelect").on("click",".dropdown-item",function(){var t,n;for(jq("#shareUserDefSelect .dropdown-item.active").removeClass("active"),jq(this).addClass("active"),jq("#shareUserDefSelect").hide(),t=jq(this).attr("data-id"),n=0;n<i.actions.length;n++)i.actions[n].defaultUserAction=i.actions[n].id==t;v()});jq.dropdownToggle({switcherSelector:"#shareGroupDefAction",dropdownID:"shareGroupDefSelect",inPopup:!0,addLeft:-5,addTop:4});jq("#shareGroupDefSelect").on("click",".dropdown-item",function(){var t,n;for(jq("#shareGroupDefSelect .dropdown-item.active").removeClass("active"),jq(this).addClass("active"),jq("#shareGroupDefSelect").hide(),t=jq(this).attr("data-id"),n=0;n<i.actions.length;n++)i.actions[n].defaultGroupAction=i.actions[n].id==t;v()})});var c=function(){jq("#shareRemoveMessage").hide();jq("#sharingSettingsDialogBody").removeClass("with-message");jq("#shareAddMessage").show()},p=function(){jq("#shareAddMessage").hide();jq("#shareRemoveMessage").show();jq("#sharingSettingsDialogBody").addClass("with-message");jq("#shareMessageSend").prop("checked",!0)},w=function(n,t){for(var f=null,r=0;r<i.actions.length;r++)if(i.actions[r].id==t){f=i.actions[r];break}for(r=0;r<i.items.length;r++)if(i.items[r].id==n){i.items[r].selectedAction=f;break}u(!0)},a=function(n){for(var t=0;t<i.items.length;t++)if(i.items[t].id==n){if(i.items[t].canEdit===!1||i.items[t].hideRemove)return!1;i.items[t].isGroup?e.groupadvancedSelector("unselect",[n]):f.useradvancedSelector("unselect",[n]);i.items.splice(t,1);break}return jq("#sharing_item_"+n).remove(),jq("#sharingSettingsItems div.sharingItem.tintMedium").removeClass("tintMedium"),jq("#sharingSettingsItems div.sharingItem:even").addClass("tintMedium"),jq(".sharing-empty").toggle(i.items.length<=1),u(!0),!0},b=function(n,t){for(var u,o,f,e=jq(t).map(function(n,t){return t.id}).toArray(),r=0;r<i.items.length;r++)u=i.items[r],u.isGroup||(o=jq.inArray(u.id,e),o==-1?a(u.id)&&r--:e.splice(o,1));jq(t).each(function(n,t){jq.inArray(t.id,e)!=-1&&(k(t),f=f||t.id)});f&&jq("#sharingSettingsItems").scrollTo(jq("#sharing_item_"+f).prev());jq(".sharing-empty").toggle(i.items.length<=1)},k=function(n){for(var s,h,f,e=null,t=o(i.actions),r=0;r<t.length;r++){if(t[r].defaultUserAction){e=t[r];break}t[r].defaultAction&&(e=t[r]);n.isVisitor&&t[r].hideForVisitor&&(t[r].disabled=!0)}s={id:n.id,name:n.title,selectedAction:e,isGroup:!1,canEdit:!0};i.items.push(s);jq("#sharingSettingsItems").append(jq.tmpl("sharingListTemplate",{items:[s],actions:t}));jq("#studio_sharingSettingsDialog .action select:last").tlcombobox({parent:"#sharingSettingsItems"});h=jq("#studio_sharingSettingsDialog .userLink:last");f=h.attr("id");f!=null&&f!=""&&y.RegistryElement(f,'"'+h.attr("data-uid")+'"');jq("#sharingSettingsItems div.sharingItem.tintMedium").removeClass("tintMedium");jq("#sharingSettingsItems div.sharingItem:even").addClass("tintMedium");u(!0)},d=function(n,t){for(var u,o,f,e=jq(t).map(function(n,t){return t.id}).toArray(),r=0;r<i.items.length;r++)u=i.items[r],u.isGroup&&(o=jq.inArray(u.id,e),o==-1?a(u.id)&&r--:e.splice(o,1));jq(t).each(function(n,t){jq.inArray(t.id,e)!=-1&&(g(t.id,t.title),f=f||t.id)});f&&jq("#sharingSettingsItems").scrollTo(jq("#sharing_item_"+f).prev());jq(".sharing-empty").toggle(i.items.length<=1)},g=function(n,t){for(var e,f=null,r=0;r<i.actions.length;r++){if(i.actions[r].defaultGroupAction){f=i.actions[r];break}i.actions[r].defaultAction&&(f=i.actions[r])}e={id:n,name:t,selectedAction:f,isGroup:!0,canEdit:!0};i.items.push(e);jq("#sharingSettingsItems").append(jq.tmpl("sharingListTemplate",{items:[e],actions:i.actions}));jq("#studio_sharingSettingsDialog .action select:last").tlcombobox({parent:"#sharingSettingsItems"});jq("#sharingSettingsItems div.sharingItem.tintMedium").removeClass("tintMedium");jq("#sharingSettingsItems div.sharingItem:even").addClass("tintMedium");u(!0)},nt=function(){var t,n;jq("#sharingSettingsItems").html(jq.tmpl("sharingListTemplate",i));jq(".sharing-empty").toggle(i.items.length<=1);jq.browser.mobile&&jq("#sharingSettingsItems").addClass("isMobileAgent");jq("#studio_sharingSettingsDialog .action select").each(function(){jq(this).tlcombobox({parent:"#sharingSettingsItems"})});f.useradvancedSelector("reset");e.groupadvancedSelector("reset");var r=[],u=[],o=[],s=[];for(t=0;t<i.items.length;t++)n=i.items[t],n.isGroup?(u.push(n.id),(n.hideRemove||!n.canEdit)&&s.push(n.id)):(r.push(n.id),(n.hideRemove||!n.canEdit)&&o.push(n.id));f.useradvancedSelector("select",r);f.useradvancedSelector("disable",o);e.groupadvancedSelector("select",u);e.groupadvancedSelector("disable",s)},tt=function(){jq("#shareUserDefSelect").html(jq.tmpl("sharingActionsTemplate",i));jq("#shareGroupDefSelect").html(jq.tmpl("sharingActionsTemplate",i));v()},v=function(){for(var t=!0,r=!0,u="",n=0;n<i.actions.length;n++)i.actions[n].defaultUserAction&&t?(jq("#shareUserDefAction").addClass("share-def-action-"+i.actions[n].defaultStyle),t=!1):jq("#shareUserDefAction").removeClass("share-def-action-"+i.actions[n].defaultStyle),i.actions[n].defaultGroupAction&&r?(jq("#shareGroupDefAction").addClass("share-def-action-"+i.actions[n].defaultStyle),r=!1):jq("#shareGroupDefAction").removeClass("share-def-action-"+i.actions[n].defaultStyle),i.actions[n].defaultAction&&(u=i.actions[n].defaultStyle);t&&jq("#shareUserDefAction").addClass("share-def-action-"+u);r&&jq("#shareGroupDefAction").addClass("share-def-action-"+u)},u=function(n){l=n;jq(".sharing-notchanged-buttons").toggleClass("display-none",n);jq(".sharing-changed-buttons").toggleClass("display-none",!n);r.OnChange!=null&&r.OnChange(l,i)};this.WhereChanges=function(n){return n&&u(!0),l};this.UpdateSharingData=function(n,t){s=n;i=o(n);t&&jq("#shareGetLink").length?(jq("#shareGetLink").show(),h=ASC.Clipboard.destroy(h),h=ASC.Clipboard.create(t,"shareGetLink",{onComplete:r.OnCopyLink})):jq("#shareGetLink").hide();u(!1)};this.GetSharingData=function(){return s};this.ShowDialog=function(n,t,i,r){nt();tt();c();jq("#shareGroupSelector, #shareGroupDefAction").toggle(!r);jq("#studio_sharingSettingsDialog .userLink").each(function(){var n=jq(this).attr("id");n!=null&&n!=""&&y.RegistryElement(n,'"'+jq(this).attr("data-uid")+'"')});jq("#shareMessage").val("");jq("#shareMessageSend").prop("checked",!0);n=n||600;i?jq("#studio_sharingSettingsDialog").show().css({display:"block",width:n-48}):StudioBlockUIManager.blockUI("#studio_sharingSettingsDialog",n);PopupKeyUpActionProvider.EnterAction=PopupKeyUpActionProvider.CtrlEnterAction="jq(\".sharing-save-button:visible\").trigger('click');"};this.SaveAndCloseDialog=function(){s=i;var n=!0;return(r.OnSave!=null&&r.OnSave(s)===!1&&(n=!1),n)?r.CloseDialog():!1};this.CloseDialog=function(){return ASC.Clipboard.destroy(h),PopupKeyUpActionProvider.CloseDialog()}};
window.CalendarDocumentsPopup=function(){function a(){t=jq("#popupDocumentUploader");r=t.find(".loader-page");n=t.find("#attachFrame");u=n.data("frame");jq("<iframe/>",{frameborder:0,height:"532px",id:"fileChoiceFrame",scrolling:"no",src:u,onload:"javascript:CalendarDocumentsPopup.onFrameLoaded();return false;"}).appendTo("#attachFrame");f=n.find("iframe").get(0)}function v(n,t){var u,r,i,f,s;try{for(u=[],r=0;r<n.length;r++)i=n[r],f=location.origin+ASC.Files.Utility.GetFileDownloadUrl(i.id),ASC.Files.Utility.CanWebView(i.title)&&(f=location.origin+ASC.Files.Utility.GetFileWebViewerUrl(i.id)),s={title:i.title,id:i.id,fileUrl:f,size:i.content_length,operation:0,isUploaded:!0,isNew:!0,error:"",warn:"",iconCls:ASC.Files.Utility.getCssClassByFileTitle(i.title,!0),shareable:!!t&&!i.encrypted&&(i.access==ASC.Files.Constants.AceStatusEnum.None||i.access==ASC.Files.Constants.AceStatusEnum.ReadWrite),denySharing:ASC.Files.UI.denySharing(i)},u.push(s);PopupKeyUpActionProvider.EnableEsc=!0;e.trigger(o.SelectFiles,{data:u,asLinks:!0});jq.unblockUI()}catch(h){console.error(h)}}function y(){window.addEventListener("message",function(n){if(u.indexOf(n.source.location.pathname)!==-1){try{var t=jq.parseJSON(n.data)}catch(i){console.error(i);return}if(!t.files){PopupKeyUpActionProvider.EnableEsc=!0;jq.unblockUI();return}v(t.files,t.folderShareable)}},!1)}function s(){i||(i=!0,a(),y())}function p(){i||s();PopupKeyUpActionProvider.EnableEsc=!1;StudioBlockUIManager.blockUI(t,1e3,{bindEvents:!1});k()}function w(n,t){e.bind(n,t)}function b(n){e.unbind(n)}function k(){r.show();n.css("visibility","hidden")}function h(){r.hide();n.css("visibility","visible")}function d(){try{var t=f.contentWindow,n=t.ASC.Files.FileChoice;n.eventAfter=c;n.isEventAfterTriggered&&n.isEventAfterTriggered()&&c()}catch(i){l(i)}}function c(){try{var t=f.contentWindow,n=t.ASC.Files.FileSelector.fileSelectorTree;(n.selectedFolderId==ASC.Files.Constants.FOLDER_ID_RECENT||n.selectedFolderId==ASC.Files.Constants.FOLDER_ID_FAVORITES)&&n.clickOnFolder(ASC.Files.Constants.FOLDER_ID_MY_FILES);n.getFolderData(ASC.Files.Constants.FOLDER_ID_RECENT).entryObject.toggleClass("display-none",!0);n.getFolderData(ASC.Files.Constants.FOLDER_ID_FAVORITES).entryObject.toggleClass("display-none",!0);h()}catch(i){l(i)}}function l(n){console.error(n);h()}var i=!1,t,r,n,u,f,o={SelectFiles:"on_documents_selected"},e=jq({});return{init:s,bind:w,unbind:b,events:o,showPortalDocUploader:p,onFrameLoaded:d}}(jQuery);
typeof ASC=="undefined"&&(ASC={});typeof ASC.ZopimLiveChat=="undefined"&&(ASC.ZopimLiveChat={});ASC.ZopimLiveChat=function(){var t,i=null,r=0,o=100,n=jq("#liveChatSwitch .switch-btn"),s=function(i){if(n.length){t=i;jq("#liveChatSwitch").on("click",function(){if(!jq(this).hasClass("disabled")){if(window.$zopim===undefined||window.$zopim.livechat===undefined){jq(this).addClass("disabled");u();return}e(localStorage.getItem("livechat")==="off")}});localStorage.getItem("livechat")==="on"&&(jq("#liveChatSwitch").addClass("disabled"),u())}},u=function(){window.$zopim||function(n,i){var r=$zopim=function(n){r._.push(n)},u=r.s=n.createElement(i),e=n.getElementsByTagName(i)[0];r.set=function(n){r.set._.push(n)};r._=[];r.set._=[];u.async=!0;u.setAttribute("charset","utf-8");u.src="https://v2.zopim.com/?"+t;r.t=+new Date;u.type="text/javascript";u.onload=f;e.parentNode.insertBefore(u,e)}(document,"script")},f=function(){if(clearTimeout(i),r<o){if(window.$zopim.livechat===undefined){console.log("livechat undefined");i=setTimeout(f,200);r+=1;return}e(!0)}},e=function(t){jq("#liveChatSwitch").removeClass("disabled");t?(n.addClass("switch-on"),$zopim.livechat.setDisableSound(!1),$zopim.livechat.window.hide(),localStorage.setItem("livechat","on")):(n.removeClass("switch-on"),$zopim.livechat.setDisableSound(!0),$zopim.livechat.hideAll(),localStorage.setItem("livechat","off"))};return{init:s}}();

